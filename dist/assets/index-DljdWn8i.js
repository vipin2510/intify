function jz(e,n){for(var a=0;a<n.length;a++){const u=n[a];if(typeof u!="string"&&!Array.isArray(u)){for(const f in u)if(f!=="default"&&!(f in e)){const _=Object.getOwnPropertyDescriptor(u,f);_&&Object.defineProperty(e,f,_.get?_:{enumerable:!0,get:()=>u[f]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const f of document.querySelectorAll('link[rel="modulepreload"]'))u(f);new MutationObserver(f=>{for(const _ of f)if(_.type==="childList")for(const w of _.addedNodes)w.tagName==="LINK"&&w.rel==="modulepreload"&&u(w)}).observe(document,{childList:!0,subtree:!0});function a(f){const _={};return f.integrity&&(_.integrity=f.integrity),f.referrerPolicy&&(_.referrerPolicy=f.referrerPolicy),f.crossOrigin==="use-credentials"?_.credentials="include":f.crossOrigin==="anonymous"?_.credentials="omit":_.credentials="same-origin",_}function u(f){if(f.ep)return;f.ep=!0;const _=a(f);fetch(f.href,_)}})();var kd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function RE(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var D4={exports:{}},$1={},F4={exports:{}},On={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Vg=Symbol.for("react.element"),Gz=Symbol.for("react.portal"),Hz=Symbol.for("react.fragment"),Wz=Symbol.for("react.strict_mode"),qz=Symbol.for("react.profiler"),Zz=Symbol.for("react.provider"),Xz=Symbol.for("react.context"),Yz=Symbol.for("react.forward_ref"),Kz=Symbol.for("react.suspense"),Jz=Symbol.for("react.memo"),Qz=Symbol.for("react.lazy"),AM=Symbol.iterator;function eB(e){return e===null||typeof e!="object"?null:(e=AM&&e[AM]||e["@@iterator"],typeof e=="function"?e:null)}var L4={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},O4=Object.assign,N4={};function dp(e,n,a){this.props=e,this.context=n,this.refs=N4,this.updater=a||L4}dp.prototype.isReactComponent={};dp.prototype.setState=function(e,n){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,n,"setState")};dp.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function z4(){}z4.prototype=dp.prototype;function DE(e,n,a){this.props=e,this.context=n,this.refs=N4,this.updater=a||L4}var FE=DE.prototype=new z4;FE.constructor=DE;O4(FE,dp.prototype);FE.isPureReactComponent=!0;var CM=Array.isArray,B4=Object.prototype.hasOwnProperty,LE={current:null},U4={key:!0,ref:!0,__self:!0,__source:!0};function V4(e,n,a){var u,f={},_=null,w=null;if(n!=null)for(u in n.ref!==void 0&&(w=n.ref),n.key!==void 0&&(_=""+n.key),n)B4.call(n,u)&&!U4.hasOwnProperty(u)&&(f[u]=n[u]);var T=arguments.length-2;if(T===1)f.children=a;else if(1<T){for(var o=Array(T),k=0;k<T;k++)o[k]=arguments[k+2];f.children=o}if(e&&e.defaultProps)for(u in T=e.defaultProps,T)f[u]===void 0&&(f[u]=T[u]);return{$$typeof:Vg,type:e,key:_,ref:w,props:f,_owner:LE.current}}function tB(e,n){return{$$typeof:Vg,type:e.type,key:n,ref:e.ref,props:e.props,_owner:e._owner}}function OE(e){return typeof e=="object"&&e!==null&&e.$$typeof===Vg}function rB(e){var n={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(a){return n[a]})}var kM=/\/+/g;function cb(e,n){return typeof e=="object"&&e!==null&&e.key!=null?rB(""+e.key):n.toString(36)}function Ly(e,n,a,u,f){var _=typeof e;(_==="undefined"||_==="boolean")&&(e=null);var w=!1;if(e===null)w=!0;else switch(_){case"string":case"number":w=!0;break;case"object":switch(e.$$typeof){case Vg:case Gz:w=!0}}if(w)return w=e,f=f(w),e=u===""?"."+cb(w,0):u,CM(f)?(a="",e!=null&&(a=e.replace(kM,"$&/")+"/"),Ly(f,n,a,"",function(k){return k})):f!=null&&(OE(f)&&(f=tB(f,a+(!f.key||w&&w.key===f.key?"":(""+f.key).replace(kM,"$&/")+"/")+e)),n.push(f)),1;if(w=0,u=u===""?".":u+":",CM(e))for(var T=0;T<e.length;T++){_=e[T];var o=u+cb(_,T);w+=Ly(_,n,a,o,f)}else if(o=eB(e),typeof o=="function")for(e=o.call(e),T=0;!(_=e.next()).done;)_=_.value,o=u+cb(_,T++),w+=Ly(_,n,a,o,f);else if(_==="object")throw n=String(e),Error("Objects are not valid as a React child (found: "+(n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n)+"). If you meant to render a collection of children, use an array instead.");return w}function Kx(e,n,a){if(e==null)return e;var u=[],f=0;return Ly(e,u,"","",function(_){return n.call(a,_,f++)}),u}function nB(e){if(e._status===-1){var n=e._result;n=n(),n.then(function(a){(e._status===0||e._status===-1)&&(e._status=1,e._result=a)},function(a){(e._status===0||e._status===-1)&&(e._status=2,e._result=a)}),e._status===-1&&(e._status=0,e._result=n)}if(e._status===1)return e._result.default;throw e._result}var os={current:null},Oy={transition:null},iB={ReactCurrentDispatcher:os,ReactCurrentBatchConfig:Oy,ReactCurrentOwner:LE};On.Children={map:Kx,forEach:function(e,n,a){Kx(e,function(){n.apply(this,arguments)},a)},count:function(e){var n=0;return Kx(e,function(){n++}),n},toArray:function(e){return Kx(e,function(n){return n})||[]},only:function(e){if(!OE(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};On.Component=dp;On.Fragment=Hz;On.Profiler=qz;On.PureComponent=DE;On.StrictMode=Wz;On.Suspense=Kz;On.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=iB;On.cloneElement=function(e,n,a){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var u=O4({},e.props),f=e.key,_=e.ref,w=e._owner;if(n!=null){if(n.ref!==void 0&&(_=n.ref,w=LE.current),n.key!==void 0&&(f=""+n.key),e.type&&e.type.defaultProps)var T=e.type.defaultProps;for(o in n)B4.call(n,o)&&!U4.hasOwnProperty(o)&&(u[o]=n[o]===void 0&&T!==void 0?T[o]:n[o])}var o=arguments.length-2;if(o===1)u.children=a;else if(1<o){T=Array(o);for(var k=0;k<o;k++)T[k]=arguments[k+2];u.children=T}return{$$typeof:Vg,type:e.type,key:f,ref:_,props:u,_owner:w}};On.createContext=function(e){return e={$$typeof:Xz,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:Zz,_context:e},e.Consumer=e};On.createElement=V4;On.createFactory=function(e){var n=V4.bind(null,e);return n.type=e,n};On.createRef=function(){return{current:null}};On.forwardRef=function(e){return{$$typeof:Yz,render:e}};On.isValidElement=OE;On.lazy=function(e){return{$$typeof:Qz,_payload:{_status:-1,_result:e},_init:nB}};On.memo=function(e,n){return{$$typeof:Jz,type:e,compare:n===void 0?null:n}};On.startTransition=function(e){var n=Oy.transition;Oy.transition={};try{e()}finally{Oy.transition=n}};On.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};On.useCallback=function(e,n){return os.current.useCallback(e,n)};On.useContext=function(e){return os.current.useContext(e)};On.useDebugValue=function(){};On.useDeferredValue=function(e){return os.current.useDeferredValue(e)};On.useEffect=function(e,n){return os.current.useEffect(e,n)};On.useId=function(){return os.current.useId()};On.useImperativeHandle=function(e,n,a){return os.current.useImperativeHandle(e,n,a)};On.useInsertionEffect=function(e,n){return os.current.useInsertionEffect(e,n)};On.useLayoutEffect=function(e,n){return os.current.useLayoutEffect(e,n)};On.useMemo=function(e,n){return os.current.useMemo(e,n)};On.useReducer=function(e,n,a){return os.current.useReducer(e,n,a)};On.useRef=function(e){return os.current.useRef(e)};On.useState=function(e){return os.current.useState(e)};On.useSyncExternalStore=function(e,n,a){return os.current.useSyncExternalStore(e,n,a)};On.useTransition=function(){return os.current.useTransition()};On.version="18.2.0";F4.exports=On;var Ie=F4.exports;const dr=RE(Ie),aB=jz({__proto__:null,default:dr},[Ie]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sB=Ie,oB=Symbol.for("react.element"),lB=Symbol.for("react.fragment"),cB=Object.prototype.hasOwnProperty,uB=sB.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,hB={key:!0,ref:!0,__self:!0,__source:!0};function $4(e,n,a){var u,f={},_=null,w=null;a!==void 0&&(_=""+a),n.key!==void 0&&(_=""+n.key),n.ref!==void 0&&(w=n.ref);for(u in n)cB.call(n,u)&&!hB.hasOwnProperty(u)&&(f[u]=n[u]);if(e&&e.defaultProps)for(u in n=e.defaultProps,n)f[u]===void 0&&(f[u]=n[u]);return{$$typeof:oB,type:e,key:_,ref:w,props:f,_owner:uB.current}}$1.Fragment=lB;$1.jsx=$4;$1.jsxs=$4;D4.exports=$1;var Lr=D4.exports,lT={},j4={exports:{}},Xs={},G4={exports:{}},H4={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function n(st,Ve){var Et=st.length;st.push(Ve);e:for(;0<Et;){var Dt=Et-1>>>1,Se=st[Dt];if(0<f(Se,Ve))st[Dt]=Ve,st[Et]=Se,Et=Dt;else break e}}function a(st){return st.length===0?null:st[0]}function u(st){if(st.length===0)return null;var Ve=st[0],Et=st.pop();if(Et!==Ve){st[0]=Et;e:for(var Dt=0,Se=st.length,at=Se>>>1;Dt<at;){var He=2*(Dt+1)-1,Xe=st[He],yt=He+1,Jt=st[yt];if(0>f(Xe,Et))yt<Se&&0>f(Jt,Xe)?(st[Dt]=Jt,st[yt]=Et,Dt=yt):(st[Dt]=Xe,st[He]=Et,Dt=He);else if(yt<Se&&0>f(Jt,Et))st[Dt]=Jt,st[yt]=Et,Dt=yt;else break e}}return Ve}function f(st,Ve){var Et=st.sortIndex-Ve.sortIndex;return Et!==0?Et:st.id-Ve.id}if(typeof performance=="object"&&typeof performance.now=="function"){var _=performance;e.unstable_now=function(){return _.now()}}else{var w=Date,T=w.now();e.unstable_now=function(){return w.now()-T}}var o=[],k=[],R=1,F=null,B=3,V=!1,G=!1,U=!1,J=typeof setTimeout=="function"?setTimeout:null,X=typeof clearTimeout=="function"?clearTimeout:null,Y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Z(st){for(var Ve=a(k);Ve!==null;){if(Ve.callback===null)u(k);else if(Ve.startTime<=st)u(k),Ve.sortIndex=Ve.expirationTime,n(o,Ve);else break;Ve=a(k)}}function _e(st){if(U=!1,Z(st),!G)if(a(o)!==null)G=!0,qt(ke);else{var Ve=a(k);Ve!==null&&Ot(_e,Ve.startTime-st)}}function ke(st,Ve){G=!1,U&&(U=!1,X(De),De=-1),V=!0;var Et=B;try{for(Z(Ve),F=a(o);F!==null&&(!(F.expirationTime>Ve)||st&&!rt());){var Dt=F.callback;if(typeof Dt=="function"){F.callback=null,B=F.priorityLevel;var Se=Dt(F.expirationTime<=Ve);Ve=e.unstable_now(),typeof Se=="function"?F.callback=Se:F===a(o)&&u(o),Z(Ve)}else u(o);F=a(o)}if(F!==null)var at=!0;else{var He=a(k);He!==null&&Ot(_e,He.startTime-Ve),at=!1}return at}finally{F=null,B=Et,V=!1}}var Ae=!1,me=null,De=-1,we=5,Je=-1;function rt(){return!(e.unstable_now()-Je<we)}function Re(){if(me!==null){var st=e.unstable_now();Je=st;var Ve=!0;try{Ve=me(!0,st)}finally{Ve?St():(Ae=!1,me=null)}}else Ae=!1}var St;if(typeof Y=="function")St=function(){Y(Re)};else if(typeof MessageChannel<"u"){var Lt=new MessageChannel,We=Lt.port2;Lt.port1.onmessage=Re,St=function(){We.postMessage(null)}}else St=function(){J(Re,0)};function qt(st){me=st,Ae||(Ae=!0,St())}function Ot(st,Ve){De=J(function(){st(e.unstable_now())},Ve)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(st){st.callback=null},e.unstable_continueExecution=function(){G||V||(G=!0,qt(ke))},e.unstable_forceFrameRate=function(st){0>st||125<st?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):we=0<st?Math.floor(1e3/st):5},e.unstable_getCurrentPriorityLevel=function(){return B},e.unstable_getFirstCallbackNode=function(){return a(o)},e.unstable_next=function(st){switch(B){case 1:case 2:case 3:var Ve=3;break;default:Ve=B}var Et=B;B=Ve;try{return st()}finally{B=Et}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(st,Ve){switch(st){case 1:case 2:case 3:case 4:case 5:break;default:st=3}var Et=B;B=st;try{return Ve()}finally{B=Et}},e.unstable_scheduleCallback=function(st,Ve,Et){var Dt=e.unstable_now();switch(typeof Et=="object"&&Et!==null?(Et=Et.delay,Et=typeof Et=="number"&&0<Et?Dt+Et:Dt):Et=Dt,st){case 1:var Se=-1;break;case 2:Se=250;break;case 5:Se=1073741823;break;case 4:Se=1e4;break;default:Se=5e3}return Se=Et+Se,st={id:R++,callback:Ve,priorityLevel:st,startTime:Et,expirationTime:Se,sortIndex:-1},Et>Dt?(st.sortIndex=Et,n(k,st),a(o)===null&&st===a(k)&&(U?(X(De),De=-1):U=!0,Ot(_e,Et-Dt))):(st.sortIndex=Se,n(o,st),G||V||(G=!0,qt(ke))),st},e.unstable_shouldYield=rt,e.unstable_wrapCallback=function(st){var Ve=B;return function(){var Et=B;B=Ve;try{return st.apply(this,arguments)}finally{B=Et}}}})(H4);G4.exports=H4;var fB=G4.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var W4=Ie,Hs=fB;function lr(e){for(var n="https://reactjs.org/docs/error-decoder.html?invariant="+e,a=1;a<arguments.length;a++)n+="&args[]="+encodeURIComponent(arguments[a]);return"Minified React error #"+e+"; visit "+n+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var q4=new Set,hg={};function uf(e,n){ep(e,n),ep(e+"Capture",n)}function ep(e,n){for(hg[e]=n,e=0;e<n.length;e++)q4.add(n[e])}var gc=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),cT=Object.prototype.hasOwnProperty,dB=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,MM={},IM={};function pB(e){return cT.call(IM,e)?!0:cT.call(MM,e)?!1:dB.test(e)?IM[e]=!0:(MM[e]=!0,!1)}function mB(e,n,a,u){if(a!==null&&a.type===0)return!1;switch(typeof n){case"function":case"symbol":return!0;case"boolean":return u?!1:a!==null?!a.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function gB(e,n,a,u){if(n===null||typeof n>"u"||mB(e,n,a,u))return!0;if(u)return!1;if(a!==null)switch(a.type){case 3:return!n;case 4:return n===!1;case 5:return isNaN(n);case 6:return isNaN(n)||1>n}return!1}function ls(e,n,a,u,f,_,w){this.acceptsBooleans=n===2||n===3||n===4,this.attributeName=u,this.attributeNamespace=f,this.mustUseProperty=a,this.propertyName=e,this.type=n,this.sanitizeURL=_,this.removeEmptyString=w}var ka={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){ka[e]=new ls(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var n=e[0];ka[n]=new ls(n,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){ka[e]=new ls(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){ka[e]=new ls(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){ka[e]=new ls(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){ka[e]=new ls(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){ka[e]=new ls(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){ka[e]=new ls(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){ka[e]=new ls(e,5,!1,e.toLowerCase(),null,!1,!1)});var NE=/[\-:]([a-z])/g;function zE(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var n=e.replace(NE,zE);ka[n]=new ls(n,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var n=e.replace(NE,zE);ka[n]=new ls(n,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var n=e.replace(NE,zE);ka[n]=new ls(n,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){ka[e]=new ls(e,1,!1,e.toLowerCase(),null,!1,!1)});ka.xlinkHref=new ls("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){ka[e]=new ls(e,1,!1,e.toLowerCase(),null,!0,!0)});function BE(e,n,a,u){var f=ka.hasOwnProperty(n)?ka[n]:null;(f!==null?f.type!==0:u||!(2<n.length)||n[0]!=="o"&&n[0]!=="O"||n[1]!=="n"&&n[1]!=="N")&&(gB(n,a,f,u)&&(a=null),u||f===null?pB(n)&&(a===null?e.removeAttribute(n):e.setAttribute(n,""+a)):f.mustUseProperty?e[f.propertyName]=a===null?f.type===3?!1:"":a:(n=f.attributeName,u=f.attributeNamespace,a===null?e.removeAttribute(n):(f=f.type,a=f===3||f===4&&a===!0?"":""+a,u?e.setAttributeNS(u,n,a):e.setAttribute(n,a))))}var Ec=W4.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Jx=Symbol.for("react.element"),Id=Symbol.for("react.portal"),Pd=Symbol.for("react.fragment"),UE=Symbol.for("react.strict_mode"),uT=Symbol.for("react.profiler"),Z4=Symbol.for("react.provider"),X4=Symbol.for("react.context"),VE=Symbol.for("react.forward_ref"),hT=Symbol.for("react.suspense"),fT=Symbol.for("react.suspense_list"),$E=Symbol.for("react.memo"),gu=Symbol.for("react.lazy"),Y4=Symbol.for("react.offscreen"),PM=Symbol.iterator;function Tm(e){return e===null||typeof e!="object"?null:(e=PM&&e[PM]||e["@@iterator"],typeof e=="function"?e:null)}var Fi=Object.assign,ub;function Nm(e){if(ub===void 0)try{throw Error()}catch(a){var n=a.stack.trim().match(/\n( *(at )?)/);ub=n&&n[1]||""}return`
`+ub+e}var hb=!1;function fb(e,n){if(!e||hb)return"";hb=!0;var a=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(n)if(n=function(){throw Error()},Object.defineProperty(n.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(n,[])}catch(k){var u=k}Reflect.construct(e,[],n)}else{try{n.call()}catch(k){u=k}e.call(n.prototype)}else{try{throw Error()}catch(k){u=k}e()}}catch(k){if(k&&u&&typeof k.stack=="string"){for(var f=k.stack.split(`
`),_=u.stack.split(`
`),w=f.length-1,T=_.length-1;1<=w&&0<=T&&f[w]!==_[T];)T--;for(;1<=w&&0<=T;w--,T--)if(f[w]!==_[T]){if(w!==1||T!==1)do if(w--,T--,0>T||f[w]!==_[T]){var o=`
`+f[w].replace(" at new "," at ");return e.displayName&&o.includes("<anonymous>")&&(o=o.replace("<anonymous>",e.displayName)),o}while(1<=w&&0<=T);break}}}finally{hb=!1,Error.prepareStackTrace=a}return(e=e?e.displayName||e.name:"")?Nm(e):""}function _B(e){switch(e.tag){case 5:return Nm(e.type);case 16:return Nm("Lazy");case 13:return Nm("Suspense");case 19:return Nm("SuspenseList");case 0:case 2:case 15:return e=fb(e.type,!1),e;case 11:return e=fb(e.type.render,!1),e;case 1:return e=fb(e.type,!0),e;default:return""}}function dT(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case Pd:return"Fragment";case Id:return"Portal";case uT:return"Profiler";case UE:return"StrictMode";case hT:return"Suspense";case fT:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case X4:return(e.displayName||"Context")+".Consumer";case Z4:return(e._context.displayName||"Context")+".Provider";case VE:var n=e.render;return e=e.displayName,e||(e=n.displayName||n.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case $E:return n=e.displayName||null,n!==null?n:dT(e.type)||"Memo";case gu:n=e._payload,e=e._init;try{return dT(e(n))}catch{}}return null}function xB(e){var n=e.type;switch(e.tag){case 24:return"Cache";case 9:return(n.displayName||"Context")+".Consumer";case 10:return(n._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=n.render,e=e.displayName||e.name||"",n.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return n;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return dT(n);case 8:return n===UE?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n}return null}function Lu(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function K4(e){var n=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(n==="checkbox"||n==="radio")}function yB(e){var n=K4(e)?"checked":"value",a=Object.getOwnPropertyDescriptor(e.constructor.prototype,n),u=""+e[n];if(!e.hasOwnProperty(n)&&typeof a<"u"&&typeof a.get=="function"&&typeof a.set=="function"){var f=a.get,_=a.set;return Object.defineProperty(e,n,{configurable:!0,get:function(){return f.call(this)},set:function(w){u=""+w,_.call(this,w)}}),Object.defineProperty(e,n,{enumerable:a.enumerable}),{getValue:function(){return u},setValue:function(w){u=""+w},stopTracking:function(){e._valueTracker=null,delete e[n]}}}}function Qx(e){e._valueTracker||(e._valueTracker=yB(e))}function J4(e){if(!e)return!1;var n=e._valueTracker;if(!n)return!0;var a=n.getValue(),u="";return e&&(u=K4(e)?e.checked?"true":"false":e.value),e=u,e!==a?(n.setValue(e),!0):!1}function t1(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function pT(e,n){var a=n.checked;return Fi({},n,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:a??e._wrapperState.initialChecked})}function RM(e,n){var a=n.defaultValue==null?"":n.defaultValue,u=n.checked!=null?n.checked:n.defaultChecked;a=Lu(n.value!=null?n.value:a),e._wrapperState={initialChecked:u,initialValue:a,controlled:n.type==="checkbox"||n.type==="radio"?n.checked!=null:n.value!=null}}function Q4(e,n){n=n.checked,n!=null&&BE(e,"checked",n,!1)}function mT(e,n){Q4(e,n);var a=Lu(n.value),u=n.type;if(a!=null)u==="number"?(a===0&&e.value===""||e.value!=a)&&(e.value=""+a):e.value!==""+a&&(e.value=""+a);else if(u==="submit"||u==="reset"){e.removeAttribute("value");return}n.hasOwnProperty("value")?gT(e,n.type,a):n.hasOwnProperty("defaultValue")&&gT(e,n.type,Lu(n.defaultValue)),n.checked==null&&n.defaultChecked!=null&&(e.defaultChecked=!!n.defaultChecked)}function DM(e,n,a){if(n.hasOwnProperty("value")||n.hasOwnProperty("defaultValue")){var u=n.type;if(!(u!=="submit"&&u!=="reset"||n.value!==void 0&&n.value!==null))return;n=""+e._wrapperState.initialValue,a||n===e.value||(e.value=n),e.defaultValue=n}a=e.name,a!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,a!==""&&(e.name=a)}function gT(e,n,a){(n!=="number"||t1(e.ownerDocument)!==e)&&(a==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+a&&(e.defaultValue=""+a))}var zm=Array.isArray;function jd(e,n,a,u){if(e=e.options,n){n={};for(var f=0;f<a.length;f++)n["$"+a[f]]=!0;for(a=0;a<e.length;a++)f=n.hasOwnProperty("$"+e[a].value),e[a].selected!==f&&(e[a].selected=f),f&&u&&(e[a].defaultSelected=!0)}else{for(a=""+Lu(a),n=null,f=0;f<e.length;f++){if(e[f].value===a){e[f].selected=!0,u&&(e[f].defaultSelected=!0);return}n!==null||e[f].disabled||(n=e[f])}n!==null&&(n.selected=!0)}}function _T(e,n){if(n.dangerouslySetInnerHTML!=null)throw Error(lr(91));return Fi({},n,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function FM(e,n){var a=n.value;if(a==null){if(a=n.children,n=n.defaultValue,a!=null){if(n!=null)throw Error(lr(92));if(zm(a)){if(1<a.length)throw Error(lr(93));a=a[0]}n=a}n==null&&(n=""),a=n}e._wrapperState={initialValue:Lu(a)}}function eR(e,n){var a=Lu(n.value),u=Lu(n.defaultValue);a!=null&&(a=""+a,a!==e.value&&(e.value=a),n.defaultValue==null&&e.defaultValue!==a&&(e.defaultValue=a)),u!=null&&(e.defaultValue=""+u)}function LM(e){var n=e.textContent;n===e._wrapperState.initialValue&&n!==""&&n!==null&&(e.value=n)}function tR(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function xT(e,n){return e==null||e==="http://www.w3.org/1999/xhtml"?tR(n):e==="http://www.w3.org/2000/svg"&&n==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var ey,rR=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(n,a,u,f){MSApp.execUnsafeLocalFunction(function(){return e(n,a,u,f)})}:e}(function(e,n){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=n;else{for(ey=ey||document.createElement("div"),ey.innerHTML="<svg>"+n.valueOf().toString()+"</svg>",n=ey.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;n.firstChild;)e.appendChild(n.firstChild)}});function fg(e,n){if(n){var a=e.firstChild;if(a&&a===e.lastChild&&a.nodeType===3){a.nodeValue=n;return}}e.textContent=n}var Wm={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},vB=["Webkit","ms","Moz","O"];Object.keys(Wm).forEach(function(e){vB.forEach(function(n){n=n+e.charAt(0).toUpperCase()+e.substring(1),Wm[n]=Wm[e]})});function nR(e,n,a){return n==null||typeof n=="boolean"||n===""?"":a||typeof n!="number"||n===0||Wm.hasOwnProperty(e)&&Wm[e]?(""+n).trim():n+"px"}function iR(e,n){e=e.style;for(var a in n)if(n.hasOwnProperty(a)){var u=a.indexOf("--")===0,f=nR(a,n[a],u);a==="float"&&(a="cssFloat"),u?e.setProperty(a,f):e[a]=f}}var wB=Fi({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function yT(e,n){if(n){if(wB[e]&&(n.children!=null||n.dangerouslySetInnerHTML!=null))throw Error(lr(137,e));if(n.dangerouslySetInnerHTML!=null){if(n.children!=null)throw Error(lr(60));if(typeof n.dangerouslySetInnerHTML!="object"||!("__html"in n.dangerouslySetInnerHTML))throw Error(lr(61))}if(n.style!=null&&typeof n.style!="object")throw Error(lr(62))}}function vT(e,n){if(e.indexOf("-")===-1)return typeof n.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var wT=null;function jE(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var bT=null,Gd=null,Hd=null;function OM(e){if(e=Gg(e)){if(typeof bT!="function")throw Error(lr(280));var n=e.stateNode;n&&(n=q1(n),bT(e.stateNode,e.type,n))}}function aR(e){Gd?Hd?Hd.push(e):Hd=[e]:Gd=e}function sR(){if(Gd){var e=Gd,n=Hd;if(Hd=Gd=null,OM(e),n)for(e=0;e<n.length;e++)OM(n[e])}}function oR(e,n){return e(n)}function lR(){}var db=!1;function cR(e,n,a){if(db)return e(n,a);db=!0;try{return oR(e,n,a)}finally{db=!1,(Gd!==null||Hd!==null)&&(lR(),sR())}}function dg(e,n){var a=e.stateNode;if(a===null)return null;var u=q1(a);if(u===null)return null;a=u[n];e:switch(n){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(u=!u.disabled)||(e=e.type,u=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!u;break e;default:e=!1}if(e)return null;if(a&&typeof a!="function")throw Error(lr(231,n,typeof a));return a}var TT=!1;if(gc)try{var Em={};Object.defineProperty(Em,"passive",{get:function(){TT=!0}}),window.addEventListener("test",Em,Em),window.removeEventListener("test",Em,Em)}catch{TT=!1}function bB(e,n,a,u,f,_,w,T,o){var k=Array.prototype.slice.call(arguments,3);try{n.apply(a,k)}catch(R){this.onError(R)}}var qm=!1,r1=null,n1=!1,ET=null,TB={onError:function(e){qm=!0,r1=e}};function EB(e,n,a,u,f,_,w,T,o){qm=!1,r1=null,bB.apply(TB,arguments)}function SB(e,n,a,u,f,_,w,T,o){if(EB.apply(this,arguments),qm){if(qm){var k=r1;qm=!1,r1=null}else throw Error(lr(198));n1||(n1=!0,ET=k)}}function hf(e){var n=e,a=e;if(e.alternate)for(;n.return;)n=n.return;else{e=n;do n=e,n.flags&4098&&(a=n.return),e=n.return;while(e)}return n.tag===3?a:null}function uR(e){if(e.tag===13){var n=e.memoizedState;if(n===null&&(e=e.alternate,e!==null&&(n=e.memoizedState)),n!==null)return n.dehydrated}return null}function NM(e){if(hf(e)!==e)throw Error(lr(188))}function AB(e){var n=e.alternate;if(!n){if(n=hf(e),n===null)throw Error(lr(188));return n!==e?null:e}for(var a=e,u=n;;){var f=a.return;if(f===null)break;var _=f.alternate;if(_===null){if(u=f.return,u!==null){a=u;continue}break}if(f.child===_.child){for(_=f.child;_;){if(_===a)return NM(f),e;if(_===u)return NM(f),n;_=_.sibling}throw Error(lr(188))}if(a.return!==u.return)a=f,u=_;else{for(var w=!1,T=f.child;T;){if(T===a){w=!0,a=f,u=_;break}if(T===u){w=!0,u=f,a=_;break}T=T.sibling}if(!w){for(T=_.child;T;){if(T===a){w=!0,a=_,u=f;break}if(T===u){w=!0,u=_,a=f;break}T=T.sibling}if(!w)throw Error(lr(189))}}if(a.alternate!==u)throw Error(lr(190))}if(a.tag!==3)throw Error(lr(188));return a.stateNode.current===a?e:n}function hR(e){return e=AB(e),e!==null?fR(e):null}function fR(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var n=fR(e);if(n!==null)return n;e=e.sibling}return null}var dR=Hs.unstable_scheduleCallback,zM=Hs.unstable_cancelCallback,CB=Hs.unstable_shouldYield,kB=Hs.unstable_requestPaint,Zi=Hs.unstable_now,MB=Hs.unstable_getCurrentPriorityLevel,GE=Hs.unstable_ImmediatePriority,pR=Hs.unstable_UserBlockingPriority,i1=Hs.unstable_NormalPriority,IB=Hs.unstable_LowPriority,mR=Hs.unstable_IdlePriority,j1=null,Ml=null;function PB(e){if(Ml&&typeof Ml.onCommitFiberRoot=="function")try{Ml.onCommitFiberRoot(j1,e,void 0,(e.current.flags&128)===128)}catch{}}var Zo=Math.clz32?Math.clz32:FB,RB=Math.log,DB=Math.LN2;function FB(e){return e>>>=0,e===0?32:31-(RB(e)/DB|0)|0}var ty=64,ry=4194304;function Bm(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function a1(e,n){var a=e.pendingLanes;if(a===0)return 0;var u=0,f=e.suspendedLanes,_=e.pingedLanes,w=a&268435455;if(w!==0){var T=w&~f;T!==0?u=Bm(T):(_&=w,_!==0&&(u=Bm(_)))}else w=a&~f,w!==0?u=Bm(w):_!==0&&(u=Bm(_));if(u===0)return 0;if(n!==0&&n!==u&&!(n&f)&&(f=u&-u,_=n&-n,f>=_||f===16&&(_&4194240)!==0))return n;if(u&4&&(u|=a&16),n=e.entangledLanes,n!==0)for(e=e.entanglements,n&=u;0<n;)a=31-Zo(n),f=1<<a,u|=e[a],n&=~f;return u}function LB(e,n){switch(e){case 1:case 2:case 4:return n+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function OB(e,n){for(var a=e.suspendedLanes,u=e.pingedLanes,f=e.expirationTimes,_=e.pendingLanes;0<_;){var w=31-Zo(_),T=1<<w,o=f[w];o===-1?(!(T&a)||T&u)&&(f[w]=LB(T,n)):o<=n&&(e.expiredLanes|=T),_&=~T}}function ST(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function gR(){var e=ty;return ty<<=1,!(ty&4194240)&&(ty=64),e}function pb(e){for(var n=[],a=0;31>a;a++)n.push(e);return n}function $g(e,n,a){e.pendingLanes|=n,n!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,n=31-Zo(n),e[n]=a}function NB(e,n){var a=e.pendingLanes&~n;e.pendingLanes=n,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=n,e.mutableReadLanes&=n,e.entangledLanes&=n,n=e.entanglements;var u=e.eventTimes;for(e=e.expirationTimes;0<a;){var f=31-Zo(a),_=1<<f;n[f]=0,u[f]=-1,e[f]=-1,a&=~_}}function HE(e,n){var a=e.entangledLanes|=n;for(e=e.entanglements;a;){var u=31-Zo(a),f=1<<u;f&n|e[u]&n&&(e[u]|=n),a&=~f}}var ci=0;function _R(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var xR,WE,yR,vR,wR,AT=!1,ny=[],Au=null,Cu=null,ku=null,pg=new Map,mg=new Map,xu=[],zB="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function BM(e,n){switch(e){case"focusin":case"focusout":Au=null;break;case"dragenter":case"dragleave":Cu=null;break;case"mouseover":case"mouseout":ku=null;break;case"pointerover":case"pointerout":pg.delete(n.pointerId);break;case"gotpointercapture":case"lostpointercapture":mg.delete(n.pointerId)}}function Sm(e,n,a,u,f,_){return e===null||e.nativeEvent!==_?(e={blockedOn:n,domEventName:a,eventSystemFlags:u,nativeEvent:_,targetContainers:[f]},n!==null&&(n=Gg(n),n!==null&&WE(n)),e):(e.eventSystemFlags|=u,n=e.targetContainers,f!==null&&n.indexOf(f)===-1&&n.push(f),e)}function BB(e,n,a,u,f){switch(n){case"focusin":return Au=Sm(Au,e,n,a,u,f),!0;case"dragenter":return Cu=Sm(Cu,e,n,a,u,f),!0;case"mouseover":return ku=Sm(ku,e,n,a,u,f),!0;case"pointerover":var _=f.pointerId;return pg.set(_,Sm(pg.get(_)||null,e,n,a,u,f)),!0;case"gotpointercapture":return _=f.pointerId,mg.set(_,Sm(mg.get(_)||null,e,n,a,u,f)),!0}return!1}function bR(e){var n=Hh(e.target);if(n!==null){var a=hf(n);if(a!==null){if(n=a.tag,n===13){if(n=uR(a),n!==null){e.blockedOn=n,wR(e.priority,function(){yR(a)});return}}else if(n===3&&a.stateNode.current.memoizedState.isDehydrated){e.blockedOn=a.tag===3?a.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Ny(e){if(e.blockedOn!==null)return!1;for(var n=e.targetContainers;0<n.length;){var a=CT(e.domEventName,e.eventSystemFlags,n[0],e.nativeEvent);if(a===null){a=e.nativeEvent;var u=new a.constructor(a.type,a);wT=u,a.target.dispatchEvent(u),wT=null}else return n=Gg(a),n!==null&&WE(n),e.blockedOn=a,!1;n.shift()}return!0}function UM(e,n,a){Ny(e)&&a.delete(n)}function UB(){AT=!1,Au!==null&&Ny(Au)&&(Au=null),Cu!==null&&Ny(Cu)&&(Cu=null),ku!==null&&Ny(ku)&&(ku=null),pg.forEach(UM),mg.forEach(UM)}function Am(e,n){e.blockedOn===n&&(e.blockedOn=null,AT||(AT=!0,Hs.unstable_scheduleCallback(Hs.unstable_NormalPriority,UB)))}function gg(e){function n(f){return Am(f,e)}if(0<ny.length){Am(ny[0],e);for(var a=1;a<ny.length;a++){var u=ny[a];u.blockedOn===e&&(u.blockedOn=null)}}for(Au!==null&&Am(Au,e),Cu!==null&&Am(Cu,e),ku!==null&&Am(ku,e),pg.forEach(n),mg.forEach(n),a=0;a<xu.length;a++)u=xu[a],u.blockedOn===e&&(u.blockedOn=null);for(;0<xu.length&&(a=xu[0],a.blockedOn===null);)bR(a),a.blockedOn===null&&xu.shift()}var Wd=Ec.ReactCurrentBatchConfig,s1=!0;function VB(e,n,a,u){var f=ci,_=Wd.transition;Wd.transition=null;try{ci=1,qE(e,n,a,u)}finally{ci=f,Wd.transition=_}}function $B(e,n,a,u){var f=ci,_=Wd.transition;Wd.transition=null;try{ci=4,qE(e,n,a,u)}finally{ci=f,Wd.transition=_}}function qE(e,n,a,u){if(s1){var f=CT(e,n,a,u);if(f===null)Eb(e,n,u,o1,a),BM(e,u);else if(BB(f,e,n,a,u))u.stopPropagation();else if(BM(e,u),n&4&&-1<zB.indexOf(e)){for(;f!==null;){var _=Gg(f);if(_!==null&&xR(_),_=CT(e,n,a,u),_===null&&Eb(e,n,u,o1,a),_===f)break;f=_}f!==null&&u.stopPropagation()}else Eb(e,n,u,null,a)}}var o1=null;function CT(e,n,a,u){if(o1=null,e=jE(u),e=Hh(e),e!==null)if(n=hf(e),n===null)e=null;else if(a=n.tag,a===13){if(e=uR(n),e!==null)return e;e=null}else if(a===3){if(n.stateNode.current.memoizedState.isDehydrated)return n.tag===3?n.stateNode.containerInfo:null;e=null}else n!==e&&(e=null);return o1=e,null}function TR(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(MB()){case GE:return 1;case pR:return 4;case i1:case IB:return 16;case mR:return 536870912;default:return 16}default:return 16}}var bu=null,ZE=null,zy=null;function ER(){if(zy)return zy;var e,n=ZE,a=n.length,u,f="value"in bu?bu.value:bu.textContent,_=f.length;for(e=0;e<a&&n[e]===f[e];e++);var w=a-e;for(u=1;u<=w&&n[a-u]===f[_-u];u++);return zy=f.slice(e,1<u?1-u:void 0)}function By(e){var n=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&n===13&&(e=13)):e=n,e===10&&(e=13),32<=e||e===13?e:0}function iy(){return!0}function VM(){return!1}function Ys(e){function n(a,u,f,_,w){this._reactName=a,this._targetInst=f,this.type=u,this.nativeEvent=_,this.target=w,this.currentTarget=null;for(var T in e)e.hasOwnProperty(T)&&(a=e[T],this[T]=a?a(_):_[T]);return this.isDefaultPrevented=(_.defaultPrevented!=null?_.defaultPrevented:_.returnValue===!1)?iy:VM,this.isPropagationStopped=VM,this}return Fi(n.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():typeof a.returnValue!="unknown"&&(a.returnValue=!1),this.isDefaultPrevented=iy)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():typeof a.cancelBubble!="unknown"&&(a.cancelBubble=!0),this.isPropagationStopped=iy)},persist:function(){},isPersistent:iy}),n}var pp={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},XE=Ys(pp),jg=Fi({},pp,{view:0,detail:0}),jB=Ys(jg),mb,gb,Cm,G1=Fi({},jg,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:YE,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Cm&&(Cm&&e.type==="mousemove"?(mb=e.screenX-Cm.screenX,gb=e.screenY-Cm.screenY):gb=mb=0,Cm=e),mb)},movementY:function(e){return"movementY"in e?e.movementY:gb}}),$M=Ys(G1),GB=Fi({},G1,{dataTransfer:0}),HB=Ys(GB),WB=Fi({},jg,{relatedTarget:0}),_b=Ys(WB),qB=Fi({},pp,{animationName:0,elapsedTime:0,pseudoElement:0}),ZB=Ys(qB),XB=Fi({},pp,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),YB=Ys(XB),KB=Fi({},pp,{data:0}),jM=Ys(KB),JB={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},QB={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},e8={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function t8(e){var n=this.nativeEvent;return n.getModifierState?n.getModifierState(e):(e=e8[e])?!!n[e]:!1}function YE(){return t8}var r8=Fi({},jg,{key:function(e){if(e.key){var n=JB[e.key]||e.key;if(n!=="Unidentified")return n}return e.type==="keypress"?(e=By(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?QB[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:YE,charCode:function(e){return e.type==="keypress"?By(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?By(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),n8=Ys(r8),i8=Fi({},G1,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),GM=Ys(i8),a8=Fi({},jg,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:YE}),s8=Ys(a8),o8=Fi({},pp,{propertyName:0,elapsedTime:0,pseudoElement:0}),l8=Ys(o8),c8=Fi({},G1,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),u8=Ys(c8),h8=[9,13,27,32],KE=gc&&"CompositionEvent"in window,Zm=null;gc&&"documentMode"in document&&(Zm=document.documentMode);var f8=gc&&"TextEvent"in window&&!Zm,SR=gc&&(!KE||Zm&&8<Zm&&11>=Zm),HM=" ",WM=!1;function AR(e,n){switch(e){case"keyup":return h8.indexOf(n.keyCode)!==-1;case"keydown":return n.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function CR(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Rd=!1;function d8(e,n){switch(e){case"compositionend":return CR(n);case"keypress":return n.which!==32?null:(WM=!0,HM);case"textInput":return e=n.data,e===HM&&WM?null:e;default:return null}}function p8(e,n){if(Rd)return e==="compositionend"||!KE&&AR(e,n)?(e=ER(),zy=ZE=bu=null,Rd=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(n.ctrlKey||n.altKey||n.metaKey)||n.ctrlKey&&n.altKey){if(n.char&&1<n.char.length)return n.char;if(n.which)return String.fromCharCode(n.which)}return null;case"compositionend":return SR&&n.locale!=="ko"?null:n.data;default:return null}}var m8={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function qM(e){var n=e&&e.nodeName&&e.nodeName.toLowerCase();return n==="input"?!!m8[e.type]:n==="textarea"}function kR(e,n,a,u){aR(u),n=l1(n,"onChange"),0<n.length&&(a=new XE("onChange","change",null,a,u),e.push({event:a,listeners:n}))}var Xm=null,_g=null;function g8(e){BR(e,0)}function H1(e){var n=Ld(e);if(J4(n))return e}function _8(e,n){if(e==="change")return n}var MR=!1;if(gc){var xb;if(gc){var yb="oninput"in document;if(!yb){var ZM=document.createElement("div");ZM.setAttribute("oninput","return;"),yb=typeof ZM.oninput=="function"}xb=yb}else xb=!1;MR=xb&&(!document.documentMode||9<document.documentMode)}function XM(){Xm&&(Xm.detachEvent("onpropertychange",IR),_g=Xm=null)}function IR(e){if(e.propertyName==="value"&&H1(_g)){var n=[];kR(n,_g,e,jE(e)),cR(g8,n)}}function x8(e,n,a){e==="focusin"?(XM(),Xm=n,_g=a,Xm.attachEvent("onpropertychange",IR)):e==="focusout"&&XM()}function y8(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return H1(_g)}function v8(e,n){if(e==="click")return H1(n)}function w8(e,n){if(e==="input"||e==="change")return H1(n)}function b8(e,n){return e===n&&(e!==0||1/e===1/n)||e!==e&&n!==n}var Jo=typeof Object.is=="function"?Object.is:b8;function xg(e,n){if(Jo(e,n))return!0;if(typeof e!="object"||e===null||typeof n!="object"||n===null)return!1;var a=Object.keys(e),u=Object.keys(n);if(a.length!==u.length)return!1;for(u=0;u<a.length;u++){var f=a[u];if(!cT.call(n,f)||!Jo(e[f],n[f]))return!1}return!0}function YM(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function KM(e,n){var a=YM(e);e=0;for(var u;a;){if(a.nodeType===3){if(u=e+a.textContent.length,e<=n&&u>=n)return{node:a,offset:n-e};e=u}e:{for(;a;){if(a.nextSibling){a=a.nextSibling;break e}a=a.parentNode}a=void 0}a=YM(a)}}function PR(e,n){return e&&n?e===n?!0:e&&e.nodeType===3?!1:n&&n.nodeType===3?PR(e,n.parentNode):"contains"in e?e.contains(n):e.compareDocumentPosition?!!(e.compareDocumentPosition(n)&16):!1:!1}function RR(){for(var e=window,n=t1();n instanceof e.HTMLIFrameElement;){try{var a=typeof n.contentWindow.location.href=="string"}catch{a=!1}if(a)e=n.contentWindow;else break;n=t1(e.document)}return n}function JE(e){var n=e&&e.nodeName&&e.nodeName.toLowerCase();return n&&(n==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||n==="textarea"||e.contentEditable==="true")}function T8(e){var n=RR(),a=e.focusedElem,u=e.selectionRange;if(n!==a&&a&&a.ownerDocument&&PR(a.ownerDocument.documentElement,a)){if(u!==null&&JE(a)){if(n=u.start,e=u.end,e===void 0&&(e=n),"selectionStart"in a)a.selectionStart=n,a.selectionEnd=Math.min(e,a.value.length);else if(e=(n=a.ownerDocument||document)&&n.defaultView||window,e.getSelection){e=e.getSelection();var f=a.textContent.length,_=Math.min(u.start,f);u=u.end===void 0?_:Math.min(u.end,f),!e.extend&&_>u&&(f=u,u=_,_=f),f=KM(a,_);var w=KM(a,u);f&&w&&(e.rangeCount!==1||e.anchorNode!==f.node||e.anchorOffset!==f.offset||e.focusNode!==w.node||e.focusOffset!==w.offset)&&(n=n.createRange(),n.setStart(f.node,f.offset),e.removeAllRanges(),_>u?(e.addRange(n),e.extend(w.node,w.offset)):(n.setEnd(w.node,w.offset),e.addRange(n)))}}for(n=[],e=a;e=e.parentNode;)e.nodeType===1&&n.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof a.focus=="function"&&a.focus(),a=0;a<n.length;a++)e=n[a],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var E8=gc&&"documentMode"in document&&11>=document.documentMode,Dd=null,kT=null,Ym=null,MT=!1;function JM(e,n,a){var u=a.window===a?a.document:a.nodeType===9?a:a.ownerDocument;MT||Dd==null||Dd!==t1(u)||(u=Dd,"selectionStart"in u&&JE(u)?u={start:u.selectionStart,end:u.selectionEnd}:(u=(u.ownerDocument&&u.ownerDocument.defaultView||window).getSelection(),u={anchorNode:u.anchorNode,anchorOffset:u.anchorOffset,focusNode:u.focusNode,focusOffset:u.focusOffset}),Ym&&xg(Ym,u)||(Ym=u,u=l1(kT,"onSelect"),0<u.length&&(n=new XE("onSelect","select",null,n,a),e.push({event:n,listeners:u}),n.target=Dd)))}function ay(e,n){var a={};return a[e.toLowerCase()]=n.toLowerCase(),a["Webkit"+e]="webkit"+n,a["Moz"+e]="moz"+n,a}var Fd={animationend:ay("Animation","AnimationEnd"),animationiteration:ay("Animation","AnimationIteration"),animationstart:ay("Animation","AnimationStart"),transitionend:ay("Transition","TransitionEnd")},vb={},DR={};gc&&(DR=document.createElement("div").style,"AnimationEvent"in window||(delete Fd.animationend.animation,delete Fd.animationiteration.animation,delete Fd.animationstart.animation),"TransitionEvent"in window||delete Fd.transitionend.transition);function W1(e){if(vb[e])return vb[e];if(!Fd[e])return e;var n=Fd[e],a;for(a in n)if(n.hasOwnProperty(a)&&a in DR)return vb[e]=n[a];return e}var FR=W1("animationend"),LR=W1("animationiteration"),OR=W1("animationstart"),NR=W1("transitionend"),zR=new Map,QM="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function $u(e,n){zR.set(e,n),uf(n,[e])}for(var wb=0;wb<QM.length;wb++){var bb=QM[wb],S8=bb.toLowerCase(),A8=bb[0].toUpperCase()+bb.slice(1);$u(S8,"on"+A8)}$u(FR,"onAnimationEnd");$u(LR,"onAnimationIteration");$u(OR,"onAnimationStart");$u("dblclick","onDoubleClick");$u("focusin","onFocus");$u("focusout","onBlur");$u(NR,"onTransitionEnd");ep("onMouseEnter",["mouseout","mouseover"]);ep("onMouseLeave",["mouseout","mouseover"]);ep("onPointerEnter",["pointerout","pointerover"]);ep("onPointerLeave",["pointerout","pointerover"]);uf("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));uf("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));uf("onBeforeInput",["compositionend","keypress","textInput","paste"]);uf("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));uf("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));uf("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Um="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),C8=new Set("cancel close invalid load scroll toggle".split(" ").concat(Um));function eI(e,n,a){var u=e.type||"unknown-event";e.currentTarget=a,SB(u,n,void 0,e),e.currentTarget=null}function BR(e,n){n=(n&4)!==0;for(var a=0;a<e.length;a++){var u=e[a],f=u.event;u=u.listeners;e:{var _=void 0;if(n)for(var w=u.length-1;0<=w;w--){var T=u[w],o=T.instance,k=T.currentTarget;if(T=T.listener,o!==_&&f.isPropagationStopped())break e;eI(f,T,k),_=o}else for(w=0;w<u.length;w++){if(T=u[w],o=T.instance,k=T.currentTarget,T=T.listener,o!==_&&f.isPropagationStopped())break e;eI(f,T,k),_=o}}}if(n1)throw e=ET,n1=!1,ET=null,e}function vi(e,n){var a=n[FT];a===void 0&&(a=n[FT]=new Set);var u=e+"__bubble";a.has(u)||(UR(n,e,2,!1),a.add(u))}function Tb(e,n,a){var u=0;n&&(u|=4),UR(a,e,u,n)}var sy="_reactListening"+Math.random().toString(36).slice(2);function yg(e){if(!e[sy]){e[sy]=!0,q4.forEach(function(a){a!=="selectionchange"&&(C8.has(a)||Tb(a,!1,e),Tb(a,!0,e))});var n=e.nodeType===9?e:e.ownerDocument;n===null||n[sy]||(n[sy]=!0,Tb("selectionchange",!1,n))}}function UR(e,n,a,u){switch(TR(n)){case 1:var f=VB;break;case 4:f=$B;break;default:f=qE}a=f.bind(null,n,a,e),f=void 0,!TT||n!=="touchstart"&&n!=="touchmove"&&n!=="wheel"||(f=!0),u?f!==void 0?e.addEventListener(n,a,{capture:!0,passive:f}):e.addEventListener(n,a,!0):f!==void 0?e.addEventListener(n,a,{passive:f}):e.addEventListener(n,a,!1)}function Eb(e,n,a,u,f){var _=u;if(!(n&1)&&!(n&2)&&u!==null)e:for(;;){if(u===null)return;var w=u.tag;if(w===3||w===4){var T=u.stateNode.containerInfo;if(T===f||T.nodeType===8&&T.parentNode===f)break;if(w===4)for(w=u.return;w!==null;){var o=w.tag;if((o===3||o===4)&&(o=w.stateNode.containerInfo,o===f||o.nodeType===8&&o.parentNode===f))return;w=w.return}for(;T!==null;){if(w=Hh(T),w===null)return;if(o=w.tag,o===5||o===6){u=_=w;continue e}T=T.parentNode}}u=u.return}cR(function(){var k=_,R=jE(a),F=[];e:{var B=zR.get(e);if(B!==void 0){var V=XE,G=e;switch(e){case"keypress":if(By(a)===0)break e;case"keydown":case"keyup":V=n8;break;case"focusin":G="focus",V=_b;break;case"focusout":G="blur",V=_b;break;case"beforeblur":case"afterblur":V=_b;break;case"click":if(a.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":V=$M;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":V=HB;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":V=s8;break;case FR:case LR:case OR:V=ZB;break;case NR:V=l8;break;case"scroll":V=jB;break;case"wheel":V=u8;break;case"copy":case"cut":case"paste":V=YB;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":V=GM}var U=(n&4)!==0,J=!U&&e==="scroll",X=U?B!==null?B+"Capture":null:B;U=[];for(var Y=k,Z;Y!==null;){Z=Y;var _e=Z.stateNode;if(Z.tag===5&&_e!==null&&(Z=_e,X!==null&&(_e=dg(Y,X),_e!=null&&U.push(vg(Y,_e,Z)))),J)break;Y=Y.return}0<U.length&&(B=new V(B,G,null,a,R),F.push({event:B,listeners:U}))}}if(!(n&7)){e:{if(B=e==="mouseover"||e==="pointerover",V=e==="mouseout"||e==="pointerout",B&&a!==wT&&(G=a.relatedTarget||a.fromElement)&&(Hh(G)||G[_c]))break e;if((V||B)&&(B=R.window===R?R:(B=R.ownerDocument)?B.defaultView||B.parentWindow:window,V?(G=a.relatedTarget||a.toElement,V=k,G=G?Hh(G):null,G!==null&&(J=hf(G),G!==J||G.tag!==5&&G.tag!==6)&&(G=null)):(V=null,G=k),V!==G)){if(U=$M,_e="onMouseLeave",X="onMouseEnter",Y="mouse",(e==="pointerout"||e==="pointerover")&&(U=GM,_e="onPointerLeave",X="onPointerEnter",Y="pointer"),J=V==null?B:Ld(V),Z=G==null?B:Ld(G),B=new U(_e,Y+"leave",V,a,R),B.target=J,B.relatedTarget=Z,_e=null,Hh(R)===k&&(U=new U(X,Y+"enter",G,a,R),U.target=Z,U.relatedTarget=J,_e=U),J=_e,V&&G)t:{for(U=V,X=G,Y=0,Z=U;Z;Z=Td(Z))Y++;for(Z=0,_e=X;_e;_e=Td(_e))Z++;for(;0<Y-Z;)U=Td(U),Y--;for(;0<Z-Y;)X=Td(X),Z--;for(;Y--;){if(U===X||X!==null&&U===X.alternate)break t;U=Td(U),X=Td(X)}U=null}else U=null;V!==null&&tI(F,B,V,U,!1),G!==null&&J!==null&&tI(F,J,G,U,!0)}}e:{if(B=k?Ld(k):window,V=B.nodeName&&B.nodeName.toLowerCase(),V==="select"||V==="input"&&B.type==="file")var ke=_8;else if(qM(B))if(MR)ke=w8;else{ke=y8;var Ae=x8}else(V=B.nodeName)&&V.toLowerCase()==="input"&&(B.type==="checkbox"||B.type==="radio")&&(ke=v8);if(ke&&(ke=ke(e,k))){kR(F,ke,a,R);break e}Ae&&Ae(e,B,k),e==="focusout"&&(Ae=B._wrapperState)&&Ae.controlled&&B.type==="number"&&gT(B,"number",B.value)}switch(Ae=k?Ld(k):window,e){case"focusin":(qM(Ae)||Ae.contentEditable==="true")&&(Dd=Ae,kT=k,Ym=null);break;case"focusout":Ym=kT=Dd=null;break;case"mousedown":MT=!0;break;case"contextmenu":case"mouseup":case"dragend":MT=!1,JM(F,a,R);break;case"selectionchange":if(E8)break;case"keydown":case"keyup":JM(F,a,R)}var me;if(KE)e:{switch(e){case"compositionstart":var De="onCompositionStart";break e;case"compositionend":De="onCompositionEnd";break e;case"compositionupdate":De="onCompositionUpdate";break e}De=void 0}else Rd?AR(e,a)&&(De="onCompositionEnd"):e==="keydown"&&a.keyCode===229&&(De="onCompositionStart");De&&(SR&&a.locale!=="ko"&&(Rd||De!=="onCompositionStart"?De==="onCompositionEnd"&&Rd&&(me=ER()):(bu=R,ZE="value"in bu?bu.value:bu.textContent,Rd=!0)),Ae=l1(k,De),0<Ae.length&&(De=new jM(De,e,null,a,R),F.push({event:De,listeners:Ae}),me?De.data=me:(me=CR(a),me!==null&&(De.data=me)))),(me=f8?d8(e,a):p8(e,a))&&(k=l1(k,"onBeforeInput"),0<k.length&&(R=new jM("onBeforeInput","beforeinput",null,a,R),F.push({event:R,listeners:k}),R.data=me))}BR(F,n)})}function vg(e,n,a){return{instance:e,listener:n,currentTarget:a}}function l1(e,n){for(var a=n+"Capture",u=[];e!==null;){var f=e,_=f.stateNode;f.tag===5&&_!==null&&(f=_,_=dg(e,a),_!=null&&u.unshift(vg(e,_,f)),_=dg(e,n),_!=null&&u.push(vg(e,_,f))),e=e.return}return u}function Td(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function tI(e,n,a,u,f){for(var _=n._reactName,w=[];a!==null&&a!==u;){var T=a,o=T.alternate,k=T.stateNode;if(o!==null&&o===u)break;T.tag===5&&k!==null&&(T=k,f?(o=dg(a,_),o!=null&&w.unshift(vg(a,o,T))):f||(o=dg(a,_),o!=null&&w.push(vg(a,o,T)))),a=a.return}w.length!==0&&e.push({event:n,listeners:w})}var k8=/\r\n?/g,M8=/\u0000|\uFFFD/g;function rI(e){return(typeof e=="string"?e:""+e).replace(k8,`
`).replace(M8,"")}function oy(e,n,a){if(n=rI(n),rI(e)!==n&&a)throw Error(lr(425))}function c1(){}var IT=null,PT=null;function RT(e,n){return e==="textarea"||e==="noscript"||typeof n.children=="string"||typeof n.children=="number"||typeof n.dangerouslySetInnerHTML=="object"&&n.dangerouslySetInnerHTML!==null&&n.dangerouslySetInnerHTML.__html!=null}var DT=typeof setTimeout=="function"?setTimeout:void 0,I8=typeof clearTimeout=="function"?clearTimeout:void 0,nI=typeof Promise=="function"?Promise:void 0,P8=typeof queueMicrotask=="function"?queueMicrotask:typeof nI<"u"?function(e){return nI.resolve(null).then(e).catch(R8)}:DT;function R8(e){setTimeout(function(){throw e})}function Sb(e,n){var a=n,u=0;do{var f=a.nextSibling;if(e.removeChild(a),f&&f.nodeType===8)if(a=f.data,a==="/$"){if(u===0){e.removeChild(f),gg(n);return}u--}else a!=="$"&&a!=="$?"&&a!=="$!"||u++;a=f}while(a);gg(n)}function Mu(e){for(;e!=null;e=e.nextSibling){var n=e.nodeType;if(n===1||n===3)break;if(n===8){if(n=e.data,n==="$"||n==="$!"||n==="$?")break;if(n==="/$")return null}}return e}function iI(e){e=e.previousSibling;for(var n=0;e;){if(e.nodeType===8){var a=e.data;if(a==="$"||a==="$!"||a==="$?"){if(n===0)return e;n--}else a==="/$"&&n++}e=e.previousSibling}return null}var mp=Math.random().toString(36).slice(2),Al="__reactFiber$"+mp,wg="__reactProps$"+mp,_c="__reactContainer$"+mp,FT="__reactEvents$"+mp,D8="__reactListeners$"+mp,F8="__reactHandles$"+mp;function Hh(e){var n=e[Al];if(n)return n;for(var a=e.parentNode;a;){if(n=a[_c]||a[Al]){if(a=n.alternate,n.child!==null||a!==null&&a.child!==null)for(e=iI(e);e!==null;){if(a=e[Al])return a;e=iI(e)}return n}e=a,a=e.parentNode}return null}function Gg(e){return e=e[Al]||e[_c],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function Ld(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(lr(33))}function q1(e){return e[wg]||null}var LT=[],Od=-1;function ju(e){return{current:e}}function wi(e){0>Od||(e.current=LT[Od],LT[Od]=null,Od--)}function mi(e,n){Od++,LT[Od]=e.current,e.current=n}var Ou={},Wa=ju(Ou),bs=ju(!1),ef=Ou;function tp(e,n){var a=e.type.contextTypes;if(!a)return Ou;var u=e.stateNode;if(u&&u.__reactInternalMemoizedUnmaskedChildContext===n)return u.__reactInternalMemoizedMaskedChildContext;var f={},_;for(_ in a)f[_]=n[_];return u&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=n,e.__reactInternalMemoizedMaskedChildContext=f),f}function Ts(e){return e=e.childContextTypes,e!=null}function u1(){wi(bs),wi(Wa)}function aI(e,n,a){if(Wa.current!==Ou)throw Error(lr(168));mi(Wa,n),mi(bs,a)}function VR(e,n,a){var u=e.stateNode;if(n=n.childContextTypes,typeof u.getChildContext!="function")return a;u=u.getChildContext();for(var f in u)if(!(f in n))throw Error(lr(108,xB(e)||"Unknown",f));return Fi({},a,u)}function h1(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Ou,ef=Wa.current,mi(Wa,e),mi(bs,bs.current),!0}function sI(e,n,a){var u=e.stateNode;if(!u)throw Error(lr(169));a?(e=VR(e,n,ef),u.__reactInternalMemoizedMergedChildContext=e,wi(bs),wi(Wa),mi(Wa,e)):wi(bs),mi(bs,a)}var lc=null,Z1=!1,Ab=!1;function $R(e){lc===null?lc=[e]:lc.push(e)}function L8(e){Z1=!0,$R(e)}function Gu(){if(!Ab&&lc!==null){Ab=!0;var e=0,n=ci;try{var a=lc;for(ci=1;e<a.length;e++){var u=a[e];do u=u(!0);while(u!==null)}lc=null,Z1=!1}catch(f){throw lc!==null&&(lc=lc.slice(e+1)),dR(GE,Gu),f}finally{ci=n,Ab=!1}}return null}var Nd=[],zd=0,f1=null,d1=0,ao=[],so=0,tf=null,cc=1,uc="";function Vh(e,n){Nd[zd++]=d1,Nd[zd++]=f1,f1=e,d1=n}function jR(e,n,a){ao[so++]=cc,ao[so++]=uc,ao[so++]=tf,tf=e;var u=cc;e=uc;var f=32-Zo(u)-1;u&=~(1<<f),a+=1;var _=32-Zo(n)+f;if(30<_){var w=f-f%5;_=(u&(1<<w)-1).toString(32),u>>=w,f-=w,cc=1<<32-Zo(n)+f|a<<f|u,uc=_+e}else cc=1<<_|a<<f|u,uc=e}function QE(e){e.return!==null&&(Vh(e,1),jR(e,1,0))}function eS(e){for(;e===f1;)f1=Nd[--zd],Nd[zd]=null,d1=Nd[--zd],Nd[zd]=null;for(;e===tf;)tf=ao[--so],ao[so]=null,uc=ao[--so],ao[so]=null,cc=ao[--so],ao[so]=null}var js=null,$s=null,ki=!1,Go=null;function GR(e,n){var a=oo(5,null,null,0);a.elementType="DELETED",a.stateNode=n,a.return=e,n=e.deletions,n===null?(e.deletions=[a],e.flags|=16):n.push(a)}function oI(e,n){switch(e.tag){case 5:var a=e.type;return n=n.nodeType!==1||a.toLowerCase()!==n.nodeName.toLowerCase()?null:n,n!==null?(e.stateNode=n,js=e,$s=Mu(n.firstChild),!0):!1;case 6:return n=e.pendingProps===""||n.nodeType!==3?null:n,n!==null?(e.stateNode=n,js=e,$s=null,!0):!1;case 13:return n=n.nodeType!==8?null:n,n!==null?(a=tf!==null?{id:cc,overflow:uc}:null,e.memoizedState={dehydrated:n,treeContext:a,retryLane:1073741824},a=oo(18,null,null,0),a.stateNode=n,a.return=e,e.child=a,js=e,$s=null,!0):!1;default:return!1}}function OT(e){return(e.mode&1)!==0&&(e.flags&128)===0}function NT(e){if(ki){var n=$s;if(n){var a=n;if(!oI(e,n)){if(OT(e))throw Error(lr(418));n=Mu(a.nextSibling);var u=js;n&&oI(e,n)?GR(u,a):(e.flags=e.flags&-4097|2,ki=!1,js=e)}}else{if(OT(e))throw Error(lr(418));e.flags=e.flags&-4097|2,ki=!1,js=e}}}function lI(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;js=e}function ly(e){if(e!==js)return!1;if(!ki)return lI(e),ki=!0,!1;var n;if((n=e.tag!==3)&&!(n=e.tag!==5)&&(n=e.type,n=n!=="head"&&n!=="body"&&!RT(e.type,e.memoizedProps)),n&&(n=$s)){if(OT(e))throw HR(),Error(lr(418));for(;n;)GR(e,n),n=Mu(n.nextSibling)}if(lI(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(lr(317));e:{for(e=e.nextSibling,n=0;e;){if(e.nodeType===8){var a=e.data;if(a==="/$"){if(n===0){$s=Mu(e.nextSibling);break e}n--}else a!=="$"&&a!=="$!"&&a!=="$?"||n++}e=e.nextSibling}$s=null}}else $s=js?Mu(e.stateNode.nextSibling):null;return!0}function HR(){for(var e=$s;e;)e=Mu(e.nextSibling)}function rp(){$s=js=null,ki=!1}function tS(e){Go===null?Go=[e]:Go.push(e)}var O8=Ec.ReactCurrentBatchConfig;function $o(e,n){if(e&&e.defaultProps){n=Fi({},n),e=e.defaultProps;for(var a in e)n[a]===void 0&&(n[a]=e[a]);return n}return n}var p1=ju(null),m1=null,Bd=null,rS=null;function nS(){rS=Bd=m1=null}function iS(e){var n=p1.current;wi(p1),e._currentValue=n}function zT(e,n,a){for(;e!==null;){var u=e.alternate;if((e.childLanes&n)!==n?(e.childLanes|=n,u!==null&&(u.childLanes|=n)):u!==null&&(u.childLanes&n)!==n&&(u.childLanes|=n),e===a)break;e=e.return}}function qd(e,n){m1=e,rS=Bd=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&n&&(vs=!0),e.firstContext=null)}function uo(e){var n=e._currentValue;if(rS!==e)if(e={context:e,memoizedValue:n,next:null},Bd===null){if(m1===null)throw Error(lr(308));Bd=e,m1.dependencies={lanes:0,firstContext:e}}else Bd=Bd.next=e;return n}var Wh=null;function aS(e){Wh===null?Wh=[e]:Wh.push(e)}function WR(e,n,a,u){var f=n.interleaved;return f===null?(a.next=a,aS(n)):(a.next=f.next,f.next=a),n.interleaved=a,xc(e,u)}function xc(e,n){e.lanes|=n;var a=e.alternate;for(a!==null&&(a.lanes|=n),a=e,e=e.return;e!==null;)e.childLanes|=n,a=e.alternate,a!==null&&(a.childLanes|=n),a=e,e=e.return;return a.tag===3?a.stateNode:null}var _u=!1;function sS(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function qR(e,n){e=e.updateQueue,n.updateQueue===e&&(n.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function fc(e,n){return{eventTime:e,lane:n,tag:0,payload:null,callback:null,next:null}}function Iu(e,n,a){var u=e.updateQueue;if(u===null)return null;if(u=u.shared,qn&2){var f=u.pending;return f===null?n.next=n:(n.next=f.next,f.next=n),u.pending=n,xc(e,a)}return f=u.interleaved,f===null?(n.next=n,aS(u)):(n.next=f.next,f.next=n),u.interleaved=n,xc(e,a)}function Uy(e,n,a){if(n=n.updateQueue,n!==null&&(n=n.shared,(a&4194240)!==0)){var u=n.lanes;u&=e.pendingLanes,a|=u,n.lanes=a,HE(e,a)}}function cI(e,n){var a=e.updateQueue,u=e.alternate;if(u!==null&&(u=u.updateQueue,a===u)){var f=null,_=null;if(a=a.firstBaseUpdate,a!==null){do{var w={eventTime:a.eventTime,lane:a.lane,tag:a.tag,payload:a.payload,callback:a.callback,next:null};_===null?f=_=w:_=_.next=w,a=a.next}while(a!==null);_===null?f=_=n:_=_.next=n}else f=_=n;a={baseState:u.baseState,firstBaseUpdate:f,lastBaseUpdate:_,shared:u.shared,effects:u.effects},e.updateQueue=a;return}e=a.lastBaseUpdate,e===null?a.firstBaseUpdate=n:e.next=n,a.lastBaseUpdate=n}function g1(e,n,a,u){var f=e.updateQueue;_u=!1;var _=f.firstBaseUpdate,w=f.lastBaseUpdate,T=f.shared.pending;if(T!==null){f.shared.pending=null;var o=T,k=o.next;o.next=null,w===null?_=k:w.next=k,w=o;var R=e.alternate;R!==null&&(R=R.updateQueue,T=R.lastBaseUpdate,T!==w&&(T===null?R.firstBaseUpdate=k:T.next=k,R.lastBaseUpdate=o))}if(_!==null){var F=f.baseState;w=0,R=k=o=null,T=_;do{var B=T.lane,V=T.eventTime;if((u&B)===B){R!==null&&(R=R.next={eventTime:V,lane:0,tag:T.tag,payload:T.payload,callback:T.callback,next:null});e:{var G=e,U=T;switch(B=n,V=a,U.tag){case 1:if(G=U.payload,typeof G=="function"){F=G.call(V,F,B);break e}F=G;break e;case 3:G.flags=G.flags&-65537|128;case 0:if(G=U.payload,B=typeof G=="function"?G.call(V,F,B):G,B==null)break e;F=Fi({},F,B);break e;case 2:_u=!0}}T.callback!==null&&T.lane!==0&&(e.flags|=64,B=f.effects,B===null?f.effects=[T]:B.push(T))}else V={eventTime:V,lane:B,tag:T.tag,payload:T.payload,callback:T.callback,next:null},R===null?(k=R=V,o=F):R=R.next=V,w|=B;if(T=T.next,T===null){if(T=f.shared.pending,T===null)break;B=T,T=B.next,B.next=null,f.lastBaseUpdate=B,f.shared.pending=null}}while(!0);if(R===null&&(o=F),f.baseState=o,f.firstBaseUpdate=k,f.lastBaseUpdate=R,n=f.shared.interleaved,n!==null){f=n;do w|=f.lane,f=f.next;while(f!==n)}else _===null&&(f.shared.lanes=0);nf|=w,e.lanes=w,e.memoizedState=F}}function uI(e,n,a){if(e=n.effects,n.effects=null,e!==null)for(n=0;n<e.length;n++){var u=e[n],f=u.callback;if(f!==null){if(u.callback=null,u=a,typeof f!="function")throw Error(lr(191,f));f.call(u)}}}var ZR=new W4.Component().refs;function BT(e,n,a,u){n=e.memoizedState,a=a(u,n),a=a==null?n:Fi({},n,a),e.memoizedState=a,e.lanes===0&&(e.updateQueue.baseState=a)}var X1={isMounted:function(e){return(e=e._reactInternals)?hf(e)===e:!1},enqueueSetState:function(e,n,a){e=e._reactInternals;var u=ns(),f=Ru(e),_=fc(u,f);_.payload=n,a!=null&&(_.callback=a),n=Iu(e,_,f),n!==null&&(Xo(n,e,f,u),Uy(n,e,f))},enqueueReplaceState:function(e,n,a){e=e._reactInternals;var u=ns(),f=Ru(e),_=fc(u,f);_.tag=1,_.payload=n,a!=null&&(_.callback=a),n=Iu(e,_,f),n!==null&&(Xo(n,e,f,u),Uy(n,e,f))},enqueueForceUpdate:function(e,n){e=e._reactInternals;var a=ns(),u=Ru(e),f=fc(a,u);f.tag=2,n!=null&&(f.callback=n),n=Iu(e,f,u),n!==null&&(Xo(n,e,u,a),Uy(n,e,u))}};function hI(e,n,a,u,f,_,w){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(u,_,w):n.prototype&&n.prototype.isPureReactComponent?!xg(a,u)||!xg(f,_):!0}function XR(e,n,a){var u=!1,f=Ou,_=n.contextType;return typeof _=="object"&&_!==null?_=uo(_):(f=Ts(n)?ef:Wa.current,u=n.contextTypes,_=(u=u!=null)?tp(e,f):Ou),n=new n(a,_),e.memoizedState=n.state!==null&&n.state!==void 0?n.state:null,n.updater=X1,e.stateNode=n,n._reactInternals=e,u&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=f,e.__reactInternalMemoizedMaskedChildContext=_),n}function fI(e,n,a,u){e=n.state,typeof n.componentWillReceiveProps=="function"&&n.componentWillReceiveProps(a,u),typeof n.UNSAFE_componentWillReceiveProps=="function"&&n.UNSAFE_componentWillReceiveProps(a,u),n.state!==e&&X1.enqueueReplaceState(n,n.state,null)}function UT(e,n,a,u){var f=e.stateNode;f.props=a,f.state=e.memoizedState,f.refs=ZR,sS(e);var _=n.contextType;typeof _=="object"&&_!==null?f.context=uo(_):(_=Ts(n)?ef:Wa.current,f.context=tp(e,_)),f.state=e.memoizedState,_=n.getDerivedStateFromProps,typeof _=="function"&&(BT(e,n,_,a),f.state=e.memoizedState),typeof n.getDerivedStateFromProps=="function"||typeof f.getSnapshotBeforeUpdate=="function"||typeof f.UNSAFE_componentWillMount!="function"&&typeof f.componentWillMount!="function"||(n=f.state,typeof f.componentWillMount=="function"&&f.componentWillMount(),typeof f.UNSAFE_componentWillMount=="function"&&f.UNSAFE_componentWillMount(),n!==f.state&&X1.enqueueReplaceState(f,f.state,null),g1(e,a,f,u),f.state=e.memoizedState),typeof f.componentDidMount=="function"&&(e.flags|=4194308)}function km(e,n,a){if(e=a.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(a._owner){if(a=a._owner,a){if(a.tag!==1)throw Error(lr(309));var u=a.stateNode}if(!u)throw Error(lr(147,e));var f=u,_=""+e;return n!==null&&n.ref!==null&&typeof n.ref=="function"&&n.ref._stringRef===_?n.ref:(n=function(w){var T=f.refs;T===ZR&&(T=f.refs={}),w===null?delete T[_]:T[_]=w},n._stringRef=_,n)}if(typeof e!="string")throw Error(lr(284));if(!a._owner)throw Error(lr(290,e))}return e}function cy(e,n){throw e=Object.prototype.toString.call(n),Error(lr(31,e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e))}function dI(e){var n=e._init;return n(e._payload)}function YR(e){function n(X,Y){if(e){var Z=X.deletions;Z===null?(X.deletions=[Y],X.flags|=16):Z.push(Y)}}function a(X,Y){if(!e)return null;for(;Y!==null;)n(X,Y),Y=Y.sibling;return null}function u(X,Y){for(X=new Map;Y!==null;)Y.key!==null?X.set(Y.key,Y):X.set(Y.index,Y),Y=Y.sibling;return X}function f(X,Y){return X=Du(X,Y),X.index=0,X.sibling=null,X}function _(X,Y,Z){return X.index=Z,e?(Z=X.alternate,Z!==null?(Z=Z.index,Z<Y?(X.flags|=2,Y):Z):(X.flags|=2,Y)):(X.flags|=1048576,Y)}function w(X){return e&&X.alternate===null&&(X.flags|=2),X}function T(X,Y,Z,_e){return Y===null||Y.tag!==6?(Y=Db(Z,X.mode,_e),Y.return=X,Y):(Y=f(Y,Z),Y.return=X,Y)}function o(X,Y,Z,_e){var ke=Z.type;return ke===Pd?R(X,Y,Z.props.children,_e,Z.key):Y!==null&&(Y.elementType===ke||typeof ke=="object"&&ke!==null&&ke.$$typeof===gu&&dI(ke)===Y.type)?(_e=f(Y,Z.props),_e.ref=km(X,Y,Z),_e.return=X,_e):(_e=Wy(Z.type,Z.key,Z.props,null,X.mode,_e),_e.ref=km(X,Y,Z),_e.return=X,_e)}function k(X,Y,Z,_e){return Y===null||Y.tag!==4||Y.stateNode.containerInfo!==Z.containerInfo||Y.stateNode.implementation!==Z.implementation?(Y=Fb(Z,X.mode,_e),Y.return=X,Y):(Y=f(Y,Z.children||[]),Y.return=X,Y)}function R(X,Y,Z,_e,ke){return Y===null||Y.tag!==7?(Y=Kh(Z,X.mode,_e,ke),Y.return=X,Y):(Y=f(Y,Z),Y.return=X,Y)}function F(X,Y,Z){if(typeof Y=="string"&&Y!==""||typeof Y=="number")return Y=Db(""+Y,X.mode,Z),Y.return=X,Y;if(typeof Y=="object"&&Y!==null){switch(Y.$$typeof){case Jx:return Z=Wy(Y.type,Y.key,Y.props,null,X.mode,Z),Z.ref=km(X,null,Y),Z.return=X,Z;case Id:return Y=Fb(Y,X.mode,Z),Y.return=X,Y;case gu:var _e=Y._init;return F(X,_e(Y._payload),Z)}if(zm(Y)||Tm(Y))return Y=Kh(Y,X.mode,Z,null),Y.return=X,Y;cy(X,Y)}return null}function B(X,Y,Z,_e){var ke=Y!==null?Y.key:null;if(typeof Z=="string"&&Z!==""||typeof Z=="number")return ke!==null?null:T(X,Y,""+Z,_e);if(typeof Z=="object"&&Z!==null){switch(Z.$$typeof){case Jx:return Z.key===ke?o(X,Y,Z,_e):null;case Id:return Z.key===ke?k(X,Y,Z,_e):null;case gu:return ke=Z._init,B(X,Y,ke(Z._payload),_e)}if(zm(Z)||Tm(Z))return ke!==null?null:R(X,Y,Z,_e,null);cy(X,Z)}return null}function V(X,Y,Z,_e,ke){if(typeof _e=="string"&&_e!==""||typeof _e=="number")return X=X.get(Z)||null,T(Y,X,""+_e,ke);if(typeof _e=="object"&&_e!==null){switch(_e.$$typeof){case Jx:return X=X.get(_e.key===null?Z:_e.key)||null,o(Y,X,_e,ke);case Id:return X=X.get(_e.key===null?Z:_e.key)||null,k(Y,X,_e,ke);case gu:var Ae=_e._init;return V(X,Y,Z,Ae(_e._payload),ke)}if(zm(_e)||Tm(_e))return X=X.get(Z)||null,R(Y,X,_e,ke,null);cy(Y,_e)}return null}function G(X,Y,Z,_e){for(var ke=null,Ae=null,me=Y,De=Y=0,we=null;me!==null&&De<Z.length;De++){me.index>De?(we=me,me=null):we=me.sibling;var Je=B(X,me,Z[De],_e);if(Je===null){me===null&&(me=we);break}e&&me&&Je.alternate===null&&n(X,me),Y=_(Je,Y,De),Ae===null?ke=Je:Ae.sibling=Je,Ae=Je,me=we}if(De===Z.length)return a(X,me),ki&&Vh(X,De),ke;if(me===null){for(;De<Z.length;De++)me=F(X,Z[De],_e),me!==null&&(Y=_(me,Y,De),Ae===null?ke=me:Ae.sibling=me,Ae=me);return ki&&Vh(X,De),ke}for(me=u(X,me);De<Z.length;De++)we=V(me,X,De,Z[De],_e),we!==null&&(e&&we.alternate!==null&&me.delete(we.key===null?De:we.key),Y=_(we,Y,De),Ae===null?ke=we:Ae.sibling=we,Ae=we);return e&&me.forEach(function(rt){return n(X,rt)}),ki&&Vh(X,De),ke}function U(X,Y,Z,_e){var ke=Tm(Z);if(typeof ke!="function")throw Error(lr(150));if(Z=ke.call(Z),Z==null)throw Error(lr(151));for(var Ae=ke=null,me=Y,De=Y=0,we=null,Je=Z.next();me!==null&&!Je.done;De++,Je=Z.next()){me.index>De?(we=me,me=null):we=me.sibling;var rt=B(X,me,Je.value,_e);if(rt===null){me===null&&(me=we);break}e&&me&&rt.alternate===null&&n(X,me),Y=_(rt,Y,De),Ae===null?ke=rt:Ae.sibling=rt,Ae=rt,me=we}if(Je.done)return a(X,me),ki&&Vh(X,De),ke;if(me===null){for(;!Je.done;De++,Je=Z.next())Je=F(X,Je.value,_e),Je!==null&&(Y=_(Je,Y,De),Ae===null?ke=Je:Ae.sibling=Je,Ae=Je);return ki&&Vh(X,De),ke}for(me=u(X,me);!Je.done;De++,Je=Z.next())Je=V(me,X,De,Je.value,_e),Je!==null&&(e&&Je.alternate!==null&&me.delete(Je.key===null?De:Je.key),Y=_(Je,Y,De),Ae===null?ke=Je:Ae.sibling=Je,Ae=Je);return e&&me.forEach(function(Re){return n(X,Re)}),ki&&Vh(X,De),ke}function J(X,Y,Z,_e){if(typeof Z=="object"&&Z!==null&&Z.type===Pd&&Z.key===null&&(Z=Z.props.children),typeof Z=="object"&&Z!==null){switch(Z.$$typeof){case Jx:e:{for(var ke=Z.key,Ae=Y;Ae!==null;){if(Ae.key===ke){if(ke=Z.type,ke===Pd){if(Ae.tag===7){a(X,Ae.sibling),Y=f(Ae,Z.props.children),Y.return=X,X=Y;break e}}else if(Ae.elementType===ke||typeof ke=="object"&&ke!==null&&ke.$$typeof===gu&&dI(ke)===Ae.type){a(X,Ae.sibling),Y=f(Ae,Z.props),Y.ref=km(X,Ae,Z),Y.return=X,X=Y;break e}a(X,Ae);break}else n(X,Ae);Ae=Ae.sibling}Z.type===Pd?(Y=Kh(Z.props.children,X.mode,_e,Z.key),Y.return=X,X=Y):(_e=Wy(Z.type,Z.key,Z.props,null,X.mode,_e),_e.ref=km(X,Y,Z),_e.return=X,X=_e)}return w(X);case Id:e:{for(Ae=Z.key;Y!==null;){if(Y.key===Ae)if(Y.tag===4&&Y.stateNode.containerInfo===Z.containerInfo&&Y.stateNode.implementation===Z.implementation){a(X,Y.sibling),Y=f(Y,Z.children||[]),Y.return=X,X=Y;break e}else{a(X,Y);break}else n(X,Y);Y=Y.sibling}Y=Fb(Z,X.mode,_e),Y.return=X,X=Y}return w(X);case gu:return Ae=Z._init,J(X,Y,Ae(Z._payload),_e)}if(zm(Z))return G(X,Y,Z,_e);if(Tm(Z))return U(X,Y,Z,_e);cy(X,Z)}return typeof Z=="string"&&Z!==""||typeof Z=="number"?(Z=""+Z,Y!==null&&Y.tag===6?(a(X,Y.sibling),Y=f(Y,Z),Y.return=X,X=Y):(a(X,Y),Y=Db(Z,X.mode,_e),Y.return=X,X=Y),w(X)):a(X,Y)}return J}var np=YR(!0),KR=YR(!1),Hg={},Il=ju(Hg),bg=ju(Hg),Tg=ju(Hg);function qh(e){if(e===Hg)throw Error(lr(174));return e}function oS(e,n){switch(mi(Tg,n),mi(bg,e),mi(Il,Hg),e=n.nodeType,e){case 9:case 11:n=(n=n.documentElement)?n.namespaceURI:xT(null,"");break;default:e=e===8?n.parentNode:n,n=e.namespaceURI||null,e=e.tagName,n=xT(n,e)}wi(Il),mi(Il,n)}function ip(){wi(Il),wi(bg),wi(Tg)}function JR(e){qh(Tg.current);var n=qh(Il.current),a=xT(n,e.type);n!==a&&(mi(bg,e),mi(Il,a))}function lS(e){bg.current===e&&(wi(Il),wi(bg))}var Ri=ju(0);function _1(e){for(var n=e;n!==null;){if(n.tag===13){var a=n.memoizedState;if(a!==null&&(a=a.dehydrated,a===null||a.data==="$?"||a.data==="$!"))return n}else if(n.tag===19&&n.memoizedProps.revealOrder!==void 0){if(n.flags&128)return n}else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return null;n=n.return}n.sibling.return=n.return,n=n.sibling}return null}var Cb=[];function cS(){for(var e=0;e<Cb.length;e++)Cb[e]._workInProgressVersionPrimary=null;Cb.length=0}var Vy=Ec.ReactCurrentDispatcher,kb=Ec.ReactCurrentBatchConfig,rf=0,Di=null,oa=null,ma=null,x1=!1,Km=!1,Eg=0,N8=0;function za(){throw Error(lr(321))}function uS(e,n){if(n===null)return!1;for(var a=0;a<n.length&&a<e.length;a++)if(!Jo(e[a],n[a]))return!1;return!0}function hS(e,n,a,u,f,_){if(rf=_,Di=n,n.memoizedState=null,n.updateQueue=null,n.lanes=0,Vy.current=e===null||e.memoizedState===null?V8:$8,e=a(u,f),Km){_=0;do{if(Km=!1,Eg=0,25<=_)throw Error(lr(301));_+=1,ma=oa=null,n.updateQueue=null,Vy.current=j8,e=a(u,f)}while(Km)}if(Vy.current=y1,n=oa!==null&&oa.next!==null,rf=0,ma=oa=Di=null,x1=!1,n)throw Error(lr(300));return e}function fS(){var e=Eg!==0;return Eg=0,e}function Sl(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ma===null?Di.memoizedState=ma=e:ma=ma.next=e,ma}function ho(){if(oa===null){var e=Di.alternate;e=e!==null?e.memoizedState:null}else e=oa.next;var n=ma===null?Di.memoizedState:ma.next;if(n!==null)ma=n,oa=e;else{if(e===null)throw Error(lr(310));oa=e,e={memoizedState:oa.memoizedState,baseState:oa.baseState,baseQueue:oa.baseQueue,queue:oa.queue,next:null},ma===null?Di.memoizedState=ma=e:ma=ma.next=e}return ma}function Sg(e,n){return typeof n=="function"?n(e):n}function Mb(e){var n=ho(),a=n.queue;if(a===null)throw Error(lr(311));a.lastRenderedReducer=e;var u=oa,f=u.baseQueue,_=a.pending;if(_!==null){if(f!==null){var w=f.next;f.next=_.next,_.next=w}u.baseQueue=f=_,a.pending=null}if(f!==null){_=f.next,u=u.baseState;var T=w=null,o=null,k=_;do{var R=k.lane;if((rf&R)===R)o!==null&&(o=o.next={lane:0,action:k.action,hasEagerState:k.hasEagerState,eagerState:k.eagerState,next:null}),u=k.hasEagerState?k.eagerState:e(u,k.action);else{var F={lane:R,action:k.action,hasEagerState:k.hasEagerState,eagerState:k.eagerState,next:null};o===null?(T=o=F,w=u):o=o.next=F,Di.lanes|=R,nf|=R}k=k.next}while(k!==null&&k!==_);o===null?w=u:o.next=T,Jo(u,n.memoizedState)||(vs=!0),n.memoizedState=u,n.baseState=w,n.baseQueue=o,a.lastRenderedState=u}if(e=a.interleaved,e!==null){f=e;do _=f.lane,Di.lanes|=_,nf|=_,f=f.next;while(f!==e)}else f===null&&(a.lanes=0);return[n.memoizedState,a.dispatch]}function Ib(e){var n=ho(),a=n.queue;if(a===null)throw Error(lr(311));a.lastRenderedReducer=e;var u=a.dispatch,f=a.pending,_=n.memoizedState;if(f!==null){a.pending=null;var w=f=f.next;do _=e(_,w.action),w=w.next;while(w!==f);Jo(_,n.memoizedState)||(vs=!0),n.memoizedState=_,n.baseQueue===null&&(n.baseState=_),a.lastRenderedState=_}return[_,u]}function QR(){}function eD(e,n){var a=Di,u=ho(),f=n(),_=!Jo(u.memoizedState,f);if(_&&(u.memoizedState=f,vs=!0),u=u.queue,dS(nD.bind(null,a,u,e),[e]),u.getSnapshot!==n||_||ma!==null&&ma.memoizedState.tag&1){if(a.flags|=2048,Ag(9,rD.bind(null,a,u,f,n),void 0,null),ga===null)throw Error(lr(349));rf&30||tD(a,n,f)}return f}function tD(e,n,a){e.flags|=16384,e={getSnapshot:n,value:a},n=Di.updateQueue,n===null?(n={lastEffect:null,stores:null},Di.updateQueue=n,n.stores=[e]):(a=n.stores,a===null?n.stores=[e]:a.push(e))}function rD(e,n,a,u){n.value=a,n.getSnapshot=u,iD(n)&&aD(e)}function nD(e,n,a){return a(function(){iD(n)&&aD(e)})}function iD(e){var n=e.getSnapshot;e=e.value;try{var a=n();return!Jo(e,a)}catch{return!0}}function aD(e){var n=xc(e,1);n!==null&&Xo(n,e,1,-1)}function pI(e){var n=Sl();return typeof e=="function"&&(e=e()),n.memoizedState=n.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Sg,lastRenderedState:e},n.queue=e,e=e.dispatch=U8.bind(null,Di,e),[n.memoizedState,e]}function Ag(e,n,a,u){return e={tag:e,create:n,destroy:a,deps:u,next:null},n=Di.updateQueue,n===null?(n={lastEffect:null,stores:null},Di.updateQueue=n,n.lastEffect=e.next=e):(a=n.lastEffect,a===null?n.lastEffect=e.next=e:(u=a.next,a.next=e,e.next=u,n.lastEffect=e)),e}function sD(){return ho().memoizedState}function $y(e,n,a,u){var f=Sl();Di.flags|=e,f.memoizedState=Ag(1|n,a,void 0,u===void 0?null:u)}function Y1(e,n,a,u){var f=ho();u=u===void 0?null:u;var _=void 0;if(oa!==null){var w=oa.memoizedState;if(_=w.destroy,u!==null&&uS(u,w.deps)){f.memoizedState=Ag(n,a,_,u);return}}Di.flags|=e,f.memoizedState=Ag(1|n,a,_,u)}function mI(e,n){return $y(8390656,8,e,n)}function dS(e,n){return Y1(2048,8,e,n)}function oD(e,n){return Y1(4,2,e,n)}function lD(e,n){return Y1(4,4,e,n)}function cD(e,n){if(typeof n=="function")return e=e(),n(e),function(){n(null)};if(n!=null)return e=e(),n.current=e,function(){n.current=null}}function uD(e,n,a){return a=a!=null?a.concat([e]):null,Y1(4,4,cD.bind(null,n,e),a)}function pS(){}function hD(e,n){var a=ho();n=n===void 0?null:n;var u=a.memoizedState;return u!==null&&n!==null&&uS(n,u[1])?u[0]:(a.memoizedState=[e,n],e)}function fD(e,n){var a=ho();n=n===void 0?null:n;var u=a.memoizedState;return u!==null&&n!==null&&uS(n,u[1])?u[0]:(e=e(),a.memoizedState=[e,n],e)}function dD(e,n,a){return rf&21?(Jo(a,n)||(a=gR(),Di.lanes|=a,nf|=a,e.baseState=!0),n):(e.baseState&&(e.baseState=!1,vs=!0),e.memoizedState=a)}function z8(e,n){var a=ci;ci=a!==0&&4>a?a:4,e(!0);var u=kb.transition;kb.transition={};try{e(!1),n()}finally{ci=a,kb.transition=u}}function pD(){return ho().memoizedState}function B8(e,n,a){var u=Ru(e);if(a={lane:u,action:a,hasEagerState:!1,eagerState:null,next:null},mD(e))gD(n,a);else if(a=WR(e,n,a,u),a!==null){var f=ns();Xo(a,e,u,f),_D(a,n,u)}}function U8(e,n,a){var u=Ru(e),f={lane:u,action:a,hasEagerState:!1,eagerState:null,next:null};if(mD(e))gD(n,f);else{var _=e.alternate;if(e.lanes===0&&(_===null||_.lanes===0)&&(_=n.lastRenderedReducer,_!==null))try{var w=n.lastRenderedState,T=_(w,a);if(f.hasEagerState=!0,f.eagerState=T,Jo(T,w)){var o=n.interleaved;o===null?(f.next=f,aS(n)):(f.next=o.next,o.next=f),n.interleaved=f;return}}catch{}finally{}a=WR(e,n,f,u),a!==null&&(f=ns(),Xo(a,e,u,f),_D(a,n,u))}}function mD(e){var n=e.alternate;return e===Di||n!==null&&n===Di}function gD(e,n){Km=x1=!0;var a=e.pending;a===null?n.next=n:(n.next=a.next,a.next=n),e.pending=n}function _D(e,n,a){if(a&4194240){var u=n.lanes;u&=e.pendingLanes,a|=u,n.lanes=a,HE(e,a)}}var y1={readContext:uo,useCallback:za,useContext:za,useEffect:za,useImperativeHandle:za,useInsertionEffect:za,useLayoutEffect:za,useMemo:za,useReducer:za,useRef:za,useState:za,useDebugValue:za,useDeferredValue:za,useTransition:za,useMutableSource:za,useSyncExternalStore:za,useId:za,unstable_isNewReconciler:!1},V8={readContext:uo,useCallback:function(e,n){return Sl().memoizedState=[e,n===void 0?null:n],e},useContext:uo,useEffect:mI,useImperativeHandle:function(e,n,a){return a=a!=null?a.concat([e]):null,$y(4194308,4,cD.bind(null,n,e),a)},useLayoutEffect:function(e,n){return $y(4194308,4,e,n)},useInsertionEffect:function(e,n){return $y(4,2,e,n)},useMemo:function(e,n){var a=Sl();return n=n===void 0?null:n,e=e(),a.memoizedState=[e,n],e},useReducer:function(e,n,a){var u=Sl();return n=a!==void 0?a(n):n,u.memoizedState=u.baseState=n,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:n},u.queue=e,e=e.dispatch=B8.bind(null,Di,e),[u.memoizedState,e]},useRef:function(e){var n=Sl();return e={current:e},n.memoizedState=e},useState:pI,useDebugValue:pS,useDeferredValue:function(e){return Sl().memoizedState=e},useTransition:function(){var e=pI(!1),n=e[0];return e=z8.bind(null,e[1]),Sl().memoizedState=e,[n,e]},useMutableSource:function(){},useSyncExternalStore:function(e,n,a){var u=Di,f=Sl();if(ki){if(a===void 0)throw Error(lr(407));a=a()}else{if(a=n(),ga===null)throw Error(lr(349));rf&30||tD(u,n,a)}f.memoizedState=a;var _={value:a,getSnapshot:n};return f.queue=_,mI(nD.bind(null,u,_,e),[e]),u.flags|=2048,Ag(9,rD.bind(null,u,_,a,n),void 0,null),a},useId:function(){var e=Sl(),n=ga.identifierPrefix;if(ki){var a=uc,u=cc;a=(u&~(1<<32-Zo(u)-1)).toString(32)+a,n=":"+n+"R"+a,a=Eg++,0<a&&(n+="H"+a.toString(32)),n+=":"}else a=N8++,n=":"+n+"r"+a.toString(32)+":";return e.memoizedState=n},unstable_isNewReconciler:!1},$8={readContext:uo,useCallback:hD,useContext:uo,useEffect:dS,useImperativeHandle:uD,useInsertionEffect:oD,useLayoutEffect:lD,useMemo:fD,useReducer:Mb,useRef:sD,useState:function(){return Mb(Sg)},useDebugValue:pS,useDeferredValue:function(e){var n=ho();return dD(n,oa.memoizedState,e)},useTransition:function(){var e=Mb(Sg)[0],n=ho().memoizedState;return[e,n]},useMutableSource:QR,useSyncExternalStore:eD,useId:pD,unstable_isNewReconciler:!1},j8={readContext:uo,useCallback:hD,useContext:uo,useEffect:dS,useImperativeHandle:uD,useInsertionEffect:oD,useLayoutEffect:lD,useMemo:fD,useReducer:Ib,useRef:sD,useState:function(){return Ib(Sg)},useDebugValue:pS,useDeferredValue:function(e){var n=ho();return oa===null?n.memoizedState=e:dD(n,oa.memoizedState,e)},useTransition:function(){var e=Ib(Sg)[0],n=ho().memoizedState;return[e,n]},useMutableSource:QR,useSyncExternalStore:eD,useId:pD,unstable_isNewReconciler:!1};function ap(e,n){try{var a="",u=n;do a+=_B(u),u=u.return;while(u);var f=a}catch(_){f=`
Error generating stack: `+_.message+`
`+_.stack}return{value:e,source:n,stack:f,digest:null}}function Pb(e,n,a){return{value:e,source:null,stack:a??null,digest:n??null}}function VT(e,n){try{console.error(n.value)}catch(a){setTimeout(function(){throw a})}}var G8=typeof WeakMap=="function"?WeakMap:Map;function xD(e,n,a){a=fc(-1,a),a.tag=3,a.payload={element:null};var u=n.value;return a.callback=function(){w1||(w1=!0,KT=u),VT(e,n)},a}function yD(e,n,a){a=fc(-1,a),a.tag=3;var u=e.type.getDerivedStateFromError;if(typeof u=="function"){var f=n.value;a.payload=function(){return u(f)},a.callback=function(){VT(e,n)}}var _=e.stateNode;return _!==null&&typeof _.componentDidCatch=="function"&&(a.callback=function(){VT(e,n),typeof u!="function"&&(Pu===null?Pu=new Set([this]):Pu.add(this));var w=n.stack;this.componentDidCatch(n.value,{componentStack:w!==null?w:""})}),a}function gI(e,n,a){var u=e.pingCache;if(u===null){u=e.pingCache=new G8;var f=new Set;u.set(n,f)}else f=u.get(n),f===void 0&&(f=new Set,u.set(n,f));f.has(a)||(f.add(a),e=iU.bind(null,e,n,a),n.then(e,e))}function _I(e){do{var n;if((n=e.tag===13)&&(n=e.memoizedState,n=n!==null?n.dehydrated!==null:!0),n)return e;e=e.return}while(e!==null);return null}function xI(e,n,a,u,f){return e.mode&1?(e.flags|=65536,e.lanes=f,e):(e===n?e.flags|=65536:(e.flags|=128,a.flags|=131072,a.flags&=-52805,a.tag===1&&(a.alternate===null?a.tag=17:(n=fc(-1,1),n.tag=2,Iu(a,n,1))),a.lanes|=1),e)}var H8=Ec.ReactCurrentOwner,vs=!1;function Qa(e,n,a,u){n.child=e===null?KR(n,null,a,u):np(n,e.child,a,u)}function yI(e,n,a,u,f){a=a.render;var _=n.ref;return qd(n,f),u=hS(e,n,a,u,_,f),a=fS(),e!==null&&!vs?(n.updateQueue=e.updateQueue,n.flags&=-2053,e.lanes&=~f,yc(e,n,f)):(ki&&a&&QE(n),n.flags|=1,Qa(e,n,u,f),n.child)}function vI(e,n,a,u,f){if(e===null){var _=a.type;return typeof _=="function"&&!bS(_)&&_.defaultProps===void 0&&a.compare===null&&a.defaultProps===void 0?(n.tag=15,n.type=_,vD(e,n,_,u,f)):(e=Wy(a.type,null,u,n,n.mode,f),e.ref=n.ref,e.return=n,n.child=e)}if(_=e.child,!(e.lanes&f)){var w=_.memoizedProps;if(a=a.compare,a=a!==null?a:xg,a(w,u)&&e.ref===n.ref)return yc(e,n,f)}return n.flags|=1,e=Du(_,u),e.ref=n.ref,e.return=n,n.child=e}function vD(e,n,a,u,f){if(e!==null){var _=e.memoizedProps;if(xg(_,u)&&e.ref===n.ref)if(vs=!1,n.pendingProps=u=_,(e.lanes&f)!==0)e.flags&131072&&(vs=!0);else return n.lanes=e.lanes,yc(e,n,f)}return $T(e,n,a,u,f)}function wD(e,n,a){var u=n.pendingProps,f=u.children,_=e!==null?e.memoizedState:null;if(u.mode==="hidden")if(!(n.mode&1))n.memoizedState={baseLanes:0,cachePool:null,transitions:null},mi(Vd,zs),zs|=a;else{if(!(a&1073741824))return e=_!==null?_.baseLanes|a:a,n.lanes=n.childLanes=1073741824,n.memoizedState={baseLanes:e,cachePool:null,transitions:null},n.updateQueue=null,mi(Vd,zs),zs|=e,null;n.memoizedState={baseLanes:0,cachePool:null,transitions:null},u=_!==null?_.baseLanes:a,mi(Vd,zs),zs|=u}else _!==null?(u=_.baseLanes|a,n.memoizedState=null):u=a,mi(Vd,zs),zs|=u;return Qa(e,n,f,a),n.child}function bD(e,n){var a=n.ref;(e===null&&a!==null||e!==null&&e.ref!==a)&&(n.flags|=512,n.flags|=2097152)}function $T(e,n,a,u,f){var _=Ts(a)?ef:Wa.current;return _=tp(n,_),qd(n,f),a=hS(e,n,a,u,_,f),u=fS(),e!==null&&!vs?(n.updateQueue=e.updateQueue,n.flags&=-2053,e.lanes&=~f,yc(e,n,f)):(ki&&u&&QE(n),n.flags|=1,Qa(e,n,a,f),n.child)}function wI(e,n,a,u,f){if(Ts(a)){var _=!0;h1(n)}else _=!1;if(qd(n,f),n.stateNode===null)jy(e,n),XR(n,a,u),UT(n,a,u,f),u=!0;else if(e===null){var w=n.stateNode,T=n.memoizedProps;w.props=T;var o=w.context,k=a.contextType;typeof k=="object"&&k!==null?k=uo(k):(k=Ts(a)?ef:Wa.current,k=tp(n,k));var R=a.getDerivedStateFromProps,F=typeof R=="function"||typeof w.getSnapshotBeforeUpdate=="function";F||typeof w.UNSAFE_componentWillReceiveProps!="function"&&typeof w.componentWillReceiveProps!="function"||(T!==u||o!==k)&&fI(n,w,u,k),_u=!1;var B=n.memoizedState;w.state=B,g1(n,u,w,f),o=n.memoizedState,T!==u||B!==o||bs.current||_u?(typeof R=="function"&&(BT(n,a,R,u),o=n.memoizedState),(T=_u||hI(n,a,T,u,B,o,k))?(F||typeof w.UNSAFE_componentWillMount!="function"&&typeof w.componentWillMount!="function"||(typeof w.componentWillMount=="function"&&w.componentWillMount(),typeof w.UNSAFE_componentWillMount=="function"&&w.UNSAFE_componentWillMount()),typeof w.componentDidMount=="function"&&(n.flags|=4194308)):(typeof w.componentDidMount=="function"&&(n.flags|=4194308),n.memoizedProps=u,n.memoizedState=o),w.props=u,w.state=o,w.context=k,u=T):(typeof w.componentDidMount=="function"&&(n.flags|=4194308),u=!1)}else{w=n.stateNode,qR(e,n),T=n.memoizedProps,k=n.type===n.elementType?T:$o(n.type,T),w.props=k,F=n.pendingProps,B=w.context,o=a.contextType,typeof o=="object"&&o!==null?o=uo(o):(o=Ts(a)?ef:Wa.current,o=tp(n,o));var V=a.getDerivedStateFromProps;(R=typeof V=="function"||typeof w.getSnapshotBeforeUpdate=="function")||typeof w.UNSAFE_componentWillReceiveProps!="function"&&typeof w.componentWillReceiveProps!="function"||(T!==F||B!==o)&&fI(n,w,u,o),_u=!1,B=n.memoizedState,w.state=B,g1(n,u,w,f);var G=n.memoizedState;T!==F||B!==G||bs.current||_u?(typeof V=="function"&&(BT(n,a,V,u),G=n.memoizedState),(k=_u||hI(n,a,k,u,B,G,o)||!1)?(R||typeof w.UNSAFE_componentWillUpdate!="function"&&typeof w.componentWillUpdate!="function"||(typeof w.componentWillUpdate=="function"&&w.componentWillUpdate(u,G,o),typeof w.UNSAFE_componentWillUpdate=="function"&&w.UNSAFE_componentWillUpdate(u,G,o)),typeof w.componentDidUpdate=="function"&&(n.flags|=4),typeof w.getSnapshotBeforeUpdate=="function"&&(n.flags|=1024)):(typeof w.componentDidUpdate!="function"||T===e.memoizedProps&&B===e.memoizedState||(n.flags|=4),typeof w.getSnapshotBeforeUpdate!="function"||T===e.memoizedProps&&B===e.memoizedState||(n.flags|=1024),n.memoizedProps=u,n.memoizedState=G),w.props=u,w.state=G,w.context=o,u=k):(typeof w.componentDidUpdate!="function"||T===e.memoizedProps&&B===e.memoizedState||(n.flags|=4),typeof w.getSnapshotBeforeUpdate!="function"||T===e.memoizedProps&&B===e.memoizedState||(n.flags|=1024),u=!1)}return jT(e,n,a,u,_,f)}function jT(e,n,a,u,f,_){bD(e,n);var w=(n.flags&128)!==0;if(!u&&!w)return f&&sI(n,a,!1),yc(e,n,_);u=n.stateNode,H8.current=n;var T=w&&typeof a.getDerivedStateFromError!="function"?null:u.render();return n.flags|=1,e!==null&&w?(n.child=np(n,e.child,null,_),n.child=np(n,null,T,_)):Qa(e,n,T,_),n.memoizedState=u.state,f&&sI(n,a,!0),n.child}function TD(e){var n=e.stateNode;n.pendingContext?aI(e,n.pendingContext,n.pendingContext!==n.context):n.context&&aI(e,n.context,!1),oS(e,n.containerInfo)}function bI(e,n,a,u,f){return rp(),tS(f),n.flags|=256,Qa(e,n,a,u),n.child}var GT={dehydrated:null,treeContext:null,retryLane:0};function HT(e){return{baseLanes:e,cachePool:null,transitions:null}}function ED(e,n,a){var u=n.pendingProps,f=Ri.current,_=!1,w=(n.flags&128)!==0,T;if((T=w)||(T=e!==null&&e.memoizedState===null?!1:(f&2)!==0),T?(_=!0,n.flags&=-129):(e===null||e.memoizedState!==null)&&(f|=1),mi(Ri,f&1),e===null)return NT(n),e=n.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(n.mode&1?e.data==="$!"?n.lanes=8:n.lanes=1073741824:n.lanes=1,null):(w=u.children,e=u.fallback,_?(u=n.mode,_=n.child,w={mode:"hidden",children:w},!(u&1)&&_!==null?(_.childLanes=0,_.pendingProps=w):_=Q1(w,u,0,null),e=Kh(e,u,a,null),_.return=n,e.return=n,_.sibling=e,n.child=_,n.child.memoizedState=HT(a),n.memoizedState=GT,e):mS(n,w));if(f=e.memoizedState,f!==null&&(T=f.dehydrated,T!==null))return W8(e,n,w,u,T,f,a);if(_){_=u.fallback,w=n.mode,f=e.child,T=f.sibling;var o={mode:"hidden",children:u.children};return!(w&1)&&n.child!==f?(u=n.child,u.childLanes=0,u.pendingProps=o,n.deletions=null):(u=Du(f,o),u.subtreeFlags=f.subtreeFlags&14680064),T!==null?_=Du(T,_):(_=Kh(_,w,a,null),_.flags|=2),_.return=n,u.return=n,u.sibling=_,n.child=u,u=_,_=n.child,w=e.child.memoizedState,w=w===null?HT(a):{baseLanes:w.baseLanes|a,cachePool:null,transitions:w.transitions},_.memoizedState=w,_.childLanes=e.childLanes&~a,n.memoizedState=GT,u}return _=e.child,e=_.sibling,u=Du(_,{mode:"visible",children:u.children}),!(n.mode&1)&&(u.lanes=a),u.return=n,u.sibling=null,e!==null&&(a=n.deletions,a===null?(n.deletions=[e],n.flags|=16):a.push(e)),n.child=u,n.memoizedState=null,u}function mS(e,n){return n=Q1({mode:"visible",children:n},e.mode,0,null),n.return=e,e.child=n}function uy(e,n,a,u){return u!==null&&tS(u),np(n,e.child,null,a),e=mS(n,n.pendingProps.children),e.flags|=2,n.memoizedState=null,e}function W8(e,n,a,u,f,_,w){if(a)return n.flags&256?(n.flags&=-257,u=Pb(Error(lr(422))),uy(e,n,w,u)):n.memoizedState!==null?(n.child=e.child,n.flags|=128,null):(_=u.fallback,f=n.mode,u=Q1({mode:"visible",children:u.children},f,0,null),_=Kh(_,f,w,null),_.flags|=2,u.return=n,_.return=n,u.sibling=_,n.child=u,n.mode&1&&np(n,e.child,null,w),n.child.memoizedState=HT(w),n.memoizedState=GT,_);if(!(n.mode&1))return uy(e,n,w,null);if(f.data==="$!"){if(u=f.nextSibling&&f.nextSibling.dataset,u)var T=u.dgst;return u=T,_=Error(lr(419)),u=Pb(_,u,void 0),uy(e,n,w,u)}if(T=(w&e.childLanes)!==0,vs||T){if(u=ga,u!==null){switch(w&-w){case 4:f=2;break;case 16:f=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:f=32;break;case 536870912:f=268435456;break;default:f=0}f=f&(u.suspendedLanes|w)?0:f,f!==0&&f!==_.retryLane&&(_.retryLane=f,xc(e,f),Xo(u,e,f,-1))}return wS(),u=Pb(Error(lr(421))),uy(e,n,w,u)}return f.data==="$?"?(n.flags|=128,n.child=e.child,n=aU.bind(null,e),f._reactRetry=n,null):(e=_.treeContext,$s=Mu(f.nextSibling),js=n,ki=!0,Go=null,e!==null&&(ao[so++]=cc,ao[so++]=uc,ao[so++]=tf,cc=e.id,uc=e.overflow,tf=n),n=mS(n,u.children),n.flags|=4096,n)}function TI(e,n,a){e.lanes|=n;var u=e.alternate;u!==null&&(u.lanes|=n),zT(e.return,n,a)}function Rb(e,n,a,u,f){var _=e.memoizedState;_===null?e.memoizedState={isBackwards:n,rendering:null,renderingStartTime:0,last:u,tail:a,tailMode:f}:(_.isBackwards=n,_.rendering=null,_.renderingStartTime=0,_.last=u,_.tail=a,_.tailMode=f)}function SD(e,n,a){var u=n.pendingProps,f=u.revealOrder,_=u.tail;if(Qa(e,n,u.children,a),u=Ri.current,u&2)u=u&1|2,n.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=n.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&TI(e,a,n);else if(e.tag===19)TI(e,a,n);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break e;for(;e.sibling===null;){if(e.return===null||e.return===n)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}u&=1}if(mi(Ri,u),!(n.mode&1))n.memoizedState=null;else switch(f){case"forwards":for(a=n.child,f=null;a!==null;)e=a.alternate,e!==null&&_1(e)===null&&(f=a),a=a.sibling;a=f,a===null?(f=n.child,n.child=null):(f=a.sibling,a.sibling=null),Rb(n,!1,f,a,_);break;case"backwards":for(a=null,f=n.child,n.child=null;f!==null;){if(e=f.alternate,e!==null&&_1(e)===null){n.child=f;break}e=f.sibling,f.sibling=a,a=f,f=e}Rb(n,!0,a,null,_);break;case"together":Rb(n,!1,null,null,void 0);break;default:n.memoizedState=null}return n.child}function jy(e,n){!(n.mode&1)&&e!==null&&(e.alternate=null,n.alternate=null,n.flags|=2)}function yc(e,n,a){if(e!==null&&(n.dependencies=e.dependencies),nf|=n.lanes,!(a&n.childLanes))return null;if(e!==null&&n.child!==e.child)throw Error(lr(153));if(n.child!==null){for(e=n.child,a=Du(e,e.pendingProps),n.child=a,a.return=n;e.sibling!==null;)e=e.sibling,a=a.sibling=Du(e,e.pendingProps),a.return=n;a.sibling=null}return n.child}function q8(e,n,a){switch(n.tag){case 3:TD(n),rp();break;case 5:JR(n);break;case 1:Ts(n.type)&&h1(n);break;case 4:oS(n,n.stateNode.containerInfo);break;case 10:var u=n.type._context,f=n.memoizedProps.value;mi(p1,u._currentValue),u._currentValue=f;break;case 13:if(u=n.memoizedState,u!==null)return u.dehydrated!==null?(mi(Ri,Ri.current&1),n.flags|=128,null):a&n.child.childLanes?ED(e,n,a):(mi(Ri,Ri.current&1),e=yc(e,n,a),e!==null?e.sibling:null);mi(Ri,Ri.current&1);break;case 19:if(u=(a&n.childLanes)!==0,e.flags&128){if(u)return SD(e,n,a);n.flags|=128}if(f=n.memoizedState,f!==null&&(f.rendering=null,f.tail=null,f.lastEffect=null),mi(Ri,Ri.current),u)break;return null;case 22:case 23:return n.lanes=0,wD(e,n,a)}return yc(e,n,a)}var AD,WT,CD,kD;AD=function(e,n){for(var a=n.child;a!==null;){if(a.tag===5||a.tag===6)e.appendChild(a.stateNode);else if(a.tag!==4&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===n)break;for(;a.sibling===null;){if(a.return===null||a.return===n)return;a=a.return}a.sibling.return=a.return,a=a.sibling}};WT=function(){};CD=function(e,n,a,u){var f=e.memoizedProps;if(f!==u){e=n.stateNode,qh(Il.current);var _=null;switch(a){case"input":f=pT(e,f),u=pT(e,u),_=[];break;case"select":f=Fi({},f,{value:void 0}),u=Fi({},u,{value:void 0}),_=[];break;case"textarea":f=_T(e,f),u=_T(e,u),_=[];break;default:typeof f.onClick!="function"&&typeof u.onClick=="function"&&(e.onclick=c1)}yT(a,u);var w;a=null;for(k in f)if(!u.hasOwnProperty(k)&&f.hasOwnProperty(k)&&f[k]!=null)if(k==="style"){var T=f[k];for(w in T)T.hasOwnProperty(w)&&(a||(a={}),a[w]="")}else k!=="dangerouslySetInnerHTML"&&k!=="children"&&k!=="suppressContentEditableWarning"&&k!=="suppressHydrationWarning"&&k!=="autoFocus"&&(hg.hasOwnProperty(k)?_||(_=[]):(_=_||[]).push(k,null));for(k in u){var o=u[k];if(T=f!=null?f[k]:void 0,u.hasOwnProperty(k)&&o!==T&&(o!=null||T!=null))if(k==="style")if(T){for(w in T)!T.hasOwnProperty(w)||o&&o.hasOwnProperty(w)||(a||(a={}),a[w]="");for(w in o)o.hasOwnProperty(w)&&T[w]!==o[w]&&(a||(a={}),a[w]=o[w])}else a||(_||(_=[]),_.push(k,a)),a=o;else k==="dangerouslySetInnerHTML"?(o=o?o.__html:void 0,T=T?T.__html:void 0,o!=null&&T!==o&&(_=_||[]).push(k,o)):k==="children"?typeof o!="string"&&typeof o!="number"||(_=_||[]).push(k,""+o):k!=="suppressContentEditableWarning"&&k!=="suppressHydrationWarning"&&(hg.hasOwnProperty(k)?(o!=null&&k==="onScroll"&&vi("scroll",e),_||T===o||(_=[])):(_=_||[]).push(k,o))}a&&(_=_||[]).push("style",a);var k=_;(n.updateQueue=k)&&(n.flags|=4)}};kD=function(e,n,a,u){a!==u&&(n.flags|=4)};function Mm(e,n){if(!ki)switch(e.tailMode){case"hidden":n=e.tail;for(var a=null;n!==null;)n.alternate!==null&&(a=n),n=n.sibling;a===null?e.tail=null:a.sibling=null;break;case"collapsed":a=e.tail;for(var u=null;a!==null;)a.alternate!==null&&(u=a),a=a.sibling;u===null?n||e.tail===null?e.tail=null:e.tail.sibling=null:u.sibling=null}}function Ba(e){var n=e.alternate!==null&&e.alternate.child===e.child,a=0,u=0;if(n)for(var f=e.child;f!==null;)a|=f.lanes|f.childLanes,u|=f.subtreeFlags&14680064,u|=f.flags&14680064,f.return=e,f=f.sibling;else for(f=e.child;f!==null;)a|=f.lanes|f.childLanes,u|=f.subtreeFlags,u|=f.flags,f.return=e,f=f.sibling;return e.subtreeFlags|=u,e.childLanes=a,n}function Z8(e,n,a){var u=n.pendingProps;switch(eS(n),n.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ba(n),null;case 1:return Ts(n.type)&&u1(),Ba(n),null;case 3:return u=n.stateNode,ip(),wi(bs),wi(Wa),cS(),u.pendingContext&&(u.context=u.pendingContext,u.pendingContext=null),(e===null||e.child===null)&&(ly(n)?n.flags|=4:e===null||e.memoizedState.isDehydrated&&!(n.flags&256)||(n.flags|=1024,Go!==null&&(eE(Go),Go=null))),WT(e,n),Ba(n),null;case 5:lS(n);var f=qh(Tg.current);if(a=n.type,e!==null&&n.stateNode!=null)CD(e,n,a,u,f),e.ref!==n.ref&&(n.flags|=512,n.flags|=2097152);else{if(!u){if(n.stateNode===null)throw Error(lr(166));return Ba(n),null}if(e=qh(Il.current),ly(n)){u=n.stateNode,a=n.type;var _=n.memoizedProps;switch(u[Al]=n,u[wg]=_,e=(n.mode&1)!==0,a){case"dialog":vi("cancel",u),vi("close",u);break;case"iframe":case"object":case"embed":vi("load",u);break;case"video":case"audio":for(f=0;f<Um.length;f++)vi(Um[f],u);break;case"source":vi("error",u);break;case"img":case"image":case"link":vi("error",u),vi("load",u);break;case"details":vi("toggle",u);break;case"input":RM(u,_),vi("invalid",u);break;case"select":u._wrapperState={wasMultiple:!!_.multiple},vi("invalid",u);break;case"textarea":FM(u,_),vi("invalid",u)}yT(a,_),f=null;for(var w in _)if(_.hasOwnProperty(w)){var T=_[w];w==="children"?typeof T=="string"?u.textContent!==T&&(_.suppressHydrationWarning!==!0&&oy(u.textContent,T,e),f=["children",T]):typeof T=="number"&&u.textContent!==""+T&&(_.suppressHydrationWarning!==!0&&oy(u.textContent,T,e),f=["children",""+T]):hg.hasOwnProperty(w)&&T!=null&&w==="onScroll"&&vi("scroll",u)}switch(a){case"input":Qx(u),DM(u,_,!0);break;case"textarea":Qx(u),LM(u);break;case"select":case"option":break;default:typeof _.onClick=="function"&&(u.onclick=c1)}u=f,n.updateQueue=u,u!==null&&(n.flags|=4)}else{w=f.nodeType===9?f:f.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=tR(a)),e==="http://www.w3.org/1999/xhtml"?a==="script"?(e=w.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof u.is=="string"?e=w.createElement(a,{is:u.is}):(e=w.createElement(a),a==="select"&&(w=e,u.multiple?w.multiple=!0:u.size&&(w.size=u.size))):e=w.createElementNS(e,a),e[Al]=n,e[wg]=u,AD(e,n,!1,!1),n.stateNode=e;e:{switch(w=vT(a,u),a){case"dialog":vi("cancel",e),vi("close",e),f=u;break;case"iframe":case"object":case"embed":vi("load",e),f=u;break;case"video":case"audio":for(f=0;f<Um.length;f++)vi(Um[f],e);f=u;break;case"source":vi("error",e),f=u;break;case"img":case"image":case"link":vi("error",e),vi("load",e),f=u;break;case"details":vi("toggle",e),f=u;break;case"input":RM(e,u),f=pT(e,u),vi("invalid",e);break;case"option":f=u;break;case"select":e._wrapperState={wasMultiple:!!u.multiple},f=Fi({},u,{value:void 0}),vi("invalid",e);break;case"textarea":FM(e,u),f=_T(e,u),vi("invalid",e);break;default:f=u}yT(a,f),T=f;for(_ in T)if(T.hasOwnProperty(_)){var o=T[_];_==="style"?iR(e,o):_==="dangerouslySetInnerHTML"?(o=o?o.__html:void 0,o!=null&&rR(e,o)):_==="children"?typeof o=="string"?(a!=="textarea"||o!=="")&&fg(e,o):typeof o=="number"&&fg(e,""+o):_!=="suppressContentEditableWarning"&&_!=="suppressHydrationWarning"&&_!=="autoFocus"&&(hg.hasOwnProperty(_)?o!=null&&_==="onScroll"&&vi("scroll",e):o!=null&&BE(e,_,o,w))}switch(a){case"input":Qx(e),DM(e,u,!1);break;case"textarea":Qx(e),LM(e);break;case"option":u.value!=null&&e.setAttribute("value",""+Lu(u.value));break;case"select":e.multiple=!!u.multiple,_=u.value,_!=null?jd(e,!!u.multiple,_,!1):u.defaultValue!=null&&jd(e,!!u.multiple,u.defaultValue,!0);break;default:typeof f.onClick=="function"&&(e.onclick=c1)}switch(a){case"button":case"input":case"select":case"textarea":u=!!u.autoFocus;break e;case"img":u=!0;break e;default:u=!1}}u&&(n.flags|=4)}n.ref!==null&&(n.flags|=512,n.flags|=2097152)}return Ba(n),null;case 6:if(e&&n.stateNode!=null)kD(e,n,e.memoizedProps,u);else{if(typeof u!="string"&&n.stateNode===null)throw Error(lr(166));if(a=qh(Tg.current),qh(Il.current),ly(n)){if(u=n.stateNode,a=n.memoizedProps,u[Al]=n,(_=u.nodeValue!==a)&&(e=js,e!==null))switch(e.tag){case 3:oy(u.nodeValue,a,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&oy(u.nodeValue,a,(e.mode&1)!==0)}_&&(n.flags|=4)}else u=(a.nodeType===9?a:a.ownerDocument).createTextNode(u),u[Al]=n,n.stateNode=u}return Ba(n),null;case 13:if(wi(Ri),u=n.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(ki&&$s!==null&&n.mode&1&&!(n.flags&128))HR(),rp(),n.flags|=98560,_=!1;else if(_=ly(n),u!==null&&u.dehydrated!==null){if(e===null){if(!_)throw Error(lr(318));if(_=n.memoizedState,_=_!==null?_.dehydrated:null,!_)throw Error(lr(317));_[Al]=n}else rp(),!(n.flags&128)&&(n.memoizedState=null),n.flags|=4;Ba(n),_=!1}else Go!==null&&(eE(Go),Go=null),_=!0;if(!_)return n.flags&65536?n:null}return n.flags&128?(n.lanes=a,n):(u=u!==null,u!==(e!==null&&e.memoizedState!==null)&&u&&(n.child.flags|=8192,n.mode&1&&(e===null||Ri.current&1?la===0&&(la=3):wS())),n.updateQueue!==null&&(n.flags|=4),Ba(n),null);case 4:return ip(),WT(e,n),e===null&&yg(n.stateNode.containerInfo),Ba(n),null;case 10:return iS(n.type._context),Ba(n),null;case 17:return Ts(n.type)&&u1(),Ba(n),null;case 19:if(wi(Ri),_=n.memoizedState,_===null)return Ba(n),null;if(u=(n.flags&128)!==0,w=_.rendering,w===null)if(u)Mm(_,!1);else{if(la!==0||e!==null&&e.flags&128)for(e=n.child;e!==null;){if(w=_1(e),w!==null){for(n.flags|=128,Mm(_,!1),u=w.updateQueue,u!==null&&(n.updateQueue=u,n.flags|=4),n.subtreeFlags=0,u=a,a=n.child;a!==null;)_=a,e=u,_.flags&=14680066,w=_.alternate,w===null?(_.childLanes=0,_.lanes=e,_.child=null,_.subtreeFlags=0,_.memoizedProps=null,_.memoizedState=null,_.updateQueue=null,_.dependencies=null,_.stateNode=null):(_.childLanes=w.childLanes,_.lanes=w.lanes,_.child=w.child,_.subtreeFlags=0,_.deletions=null,_.memoizedProps=w.memoizedProps,_.memoizedState=w.memoizedState,_.updateQueue=w.updateQueue,_.type=w.type,e=w.dependencies,_.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),a=a.sibling;return mi(Ri,Ri.current&1|2),n.child}e=e.sibling}_.tail!==null&&Zi()>sp&&(n.flags|=128,u=!0,Mm(_,!1),n.lanes=4194304)}else{if(!u)if(e=_1(w),e!==null){if(n.flags|=128,u=!0,a=e.updateQueue,a!==null&&(n.updateQueue=a,n.flags|=4),Mm(_,!0),_.tail===null&&_.tailMode==="hidden"&&!w.alternate&&!ki)return Ba(n),null}else 2*Zi()-_.renderingStartTime>sp&&a!==1073741824&&(n.flags|=128,u=!0,Mm(_,!1),n.lanes=4194304);_.isBackwards?(w.sibling=n.child,n.child=w):(a=_.last,a!==null?a.sibling=w:n.child=w,_.last=w)}return _.tail!==null?(n=_.tail,_.rendering=n,_.tail=n.sibling,_.renderingStartTime=Zi(),n.sibling=null,a=Ri.current,mi(Ri,u?a&1|2:a&1),n):(Ba(n),null);case 22:case 23:return vS(),u=n.memoizedState!==null,e!==null&&e.memoizedState!==null!==u&&(n.flags|=8192),u&&n.mode&1?zs&1073741824&&(Ba(n),n.subtreeFlags&6&&(n.flags|=8192)):Ba(n),null;case 24:return null;case 25:return null}throw Error(lr(156,n.tag))}function X8(e,n){switch(eS(n),n.tag){case 1:return Ts(n.type)&&u1(),e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 3:return ip(),wi(bs),wi(Wa),cS(),e=n.flags,e&65536&&!(e&128)?(n.flags=e&-65537|128,n):null;case 5:return lS(n),null;case 13:if(wi(Ri),e=n.memoizedState,e!==null&&e.dehydrated!==null){if(n.alternate===null)throw Error(lr(340));rp()}return e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 19:return wi(Ri),null;case 4:return ip(),null;case 10:return iS(n.type._context),null;case 22:case 23:return vS(),null;case 24:return null;default:return null}}var hy=!1,$a=!1,Y8=typeof WeakSet=="function"?WeakSet:Set,Ar=null;function Ud(e,n){var a=e.ref;if(a!==null)if(typeof a=="function")try{a(null)}catch(u){Bi(e,n,u)}else a.current=null}function qT(e,n,a){try{a()}catch(u){Bi(e,n,u)}}var EI=!1;function K8(e,n){if(IT=s1,e=RR(),JE(e)){if("selectionStart"in e)var a={start:e.selectionStart,end:e.selectionEnd};else e:{a=(a=e.ownerDocument)&&a.defaultView||window;var u=a.getSelection&&a.getSelection();if(u&&u.rangeCount!==0){a=u.anchorNode;var f=u.anchorOffset,_=u.focusNode;u=u.focusOffset;try{a.nodeType,_.nodeType}catch{a=null;break e}var w=0,T=-1,o=-1,k=0,R=0,F=e,B=null;t:for(;;){for(var V;F!==a||f!==0&&F.nodeType!==3||(T=w+f),F!==_||u!==0&&F.nodeType!==3||(o=w+u),F.nodeType===3&&(w+=F.nodeValue.length),(V=F.firstChild)!==null;)B=F,F=V;for(;;){if(F===e)break t;if(B===a&&++k===f&&(T=w),B===_&&++R===u&&(o=w),(V=F.nextSibling)!==null)break;F=B,B=F.parentNode}F=V}a=T===-1||o===-1?null:{start:T,end:o}}else a=null}a=a||{start:0,end:0}}else a=null;for(PT={focusedElem:e,selectionRange:a},s1=!1,Ar=n;Ar!==null;)if(n=Ar,e=n.child,(n.subtreeFlags&1028)!==0&&e!==null)e.return=n,Ar=e;else for(;Ar!==null;){n=Ar;try{var G=n.alternate;if(n.flags&1024)switch(n.tag){case 0:case 11:case 15:break;case 1:if(G!==null){var U=G.memoizedProps,J=G.memoizedState,X=n.stateNode,Y=X.getSnapshotBeforeUpdate(n.elementType===n.type?U:$o(n.type,U),J);X.__reactInternalSnapshotBeforeUpdate=Y}break;case 3:var Z=n.stateNode.containerInfo;Z.nodeType===1?Z.textContent="":Z.nodeType===9&&Z.documentElement&&Z.removeChild(Z.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(lr(163))}}catch(_e){Bi(n,n.return,_e)}if(e=n.sibling,e!==null){e.return=n.return,Ar=e;break}Ar=n.return}return G=EI,EI=!1,G}function Jm(e,n,a){var u=n.updateQueue;if(u=u!==null?u.lastEffect:null,u!==null){var f=u=u.next;do{if((f.tag&e)===e){var _=f.destroy;f.destroy=void 0,_!==void 0&&qT(n,a,_)}f=f.next}while(f!==u)}}function K1(e,n){if(n=n.updateQueue,n=n!==null?n.lastEffect:null,n!==null){var a=n=n.next;do{if((a.tag&e)===e){var u=a.create;a.destroy=u()}a=a.next}while(a!==n)}}function ZT(e){var n=e.ref;if(n!==null){var a=e.stateNode;switch(e.tag){case 5:e=a;break;default:e=a}typeof n=="function"?n(e):n.current=e}}function MD(e){var n=e.alternate;n!==null&&(e.alternate=null,MD(n)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(n=e.stateNode,n!==null&&(delete n[Al],delete n[wg],delete n[FT],delete n[D8],delete n[F8])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function ID(e){return e.tag===5||e.tag===3||e.tag===4}function SI(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||ID(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function XT(e,n,a){var u=e.tag;if(u===5||u===6)e=e.stateNode,n?a.nodeType===8?a.parentNode.insertBefore(e,n):a.insertBefore(e,n):(a.nodeType===8?(n=a.parentNode,n.insertBefore(e,a)):(n=a,n.appendChild(e)),a=a._reactRootContainer,a!=null||n.onclick!==null||(n.onclick=c1));else if(u!==4&&(e=e.child,e!==null))for(XT(e,n,a),e=e.sibling;e!==null;)XT(e,n,a),e=e.sibling}function YT(e,n,a){var u=e.tag;if(u===5||u===6)e=e.stateNode,n?a.insertBefore(e,n):a.appendChild(e);else if(u!==4&&(e=e.child,e!==null))for(YT(e,n,a),e=e.sibling;e!==null;)YT(e,n,a),e=e.sibling}var Ta=null,jo=!1;function uu(e,n,a){for(a=a.child;a!==null;)PD(e,n,a),a=a.sibling}function PD(e,n,a){if(Ml&&typeof Ml.onCommitFiberUnmount=="function")try{Ml.onCommitFiberUnmount(j1,a)}catch{}switch(a.tag){case 5:$a||Ud(a,n);case 6:var u=Ta,f=jo;Ta=null,uu(e,n,a),Ta=u,jo=f,Ta!==null&&(jo?(e=Ta,a=a.stateNode,e.nodeType===8?e.parentNode.removeChild(a):e.removeChild(a)):Ta.removeChild(a.stateNode));break;case 18:Ta!==null&&(jo?(e=Ta,a=a.stateNode,e.nodeType===8?Sb(e.parentNode,a):e.nodeType===1&&Sb(e,a),gg(e)):Sb(Ta,a.stateNode));break;case 4:u=Ta,f=jo,Ta=a.stateNode.containerInfo,jo=!0,uu(e,n,a),Ta=u,jo=f;break;case 0:case 11:case 14:case 15:if(!$a&&(u=a.updateQueue,u!==null&&(u=u.lastEffect,u!==null))){f=u=u.next;do{var _=f,w=_.destroy;_=_.tag,w!==void 0&&(_&2||_&4)&&qT(a,n,w),f=f.next}while(f!==u)}uu(e,n,a);break;case 1:if(!$a&&(Ud(a,n),u=a.stateNode,typeof u.componentWillUnmount=="function"))try{u.props=a.memoizedProps,u.state=a.memoizedState,u.componentWillUnmount()}catch(T){Bi(a,n,T)}uu(e,n,a);break;case 21:uu(e,n,a);break;case 22:a.mode&1?($a=(u=$a)||a.memoizedState!==null,uu(e,n,a),$a=u):uu(e,n,a);break;default:uu(e,n,a)}}function AI(e){var n=e.updateQueue;if(n!==null){e.updateQueue=null;var a=e.stateNode;a===null&&(a=e.stateNode=new Y8),n.forEach(function(u){var f=sU.bind(null,e,u);a.has(u)||(a.add(u),u.then(f,f))})}}function No(e,n){var a=n.deletions;if(a!==null)for(var u=0;u<a.length;u++){var f=a[u];try{var _=e,w=n,T=w;e:for(;T!==null;){switch(T.tag){case 5:Ta=T.stateNode,jo=!1;break e;case 3:Ta=T.stateNode.containerInfo,jo=!0;break e;case 4:Ta=T.stateNode.containerInfo,jo=!0;break e}T=T.return}if(Ta===null)throw Error(lr(160));PD(_,w,f),Ta=null,jo=!1;var o=f.alternate;o!==null&&(o.return=null),f.return=null}catch(k){Bi(f,n,k)}}if(n.subtreeFlags&12854)for(n=n.child;n!==null;)RD(n,e),n=n.sibling}function RD(e,n){var a=e.alternate,u=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(No(n,e),bl(e),u&4){try{Jm(3,e,e.return),K1(3,e)}catch(U){Bi(e,e.return,U)}try{Jm(5,e,e.return)}catch(U){Bi(e,e.return,U)}}break;case 1:No(n,e),bl(e),u&512&&a!==null&&Ud(a,a.return);break;case 5:if(No(n,e),bl(e),u&512&&a!==null&&Ud(a,a.return),e.flags&32){var f=e.stateNode;try{fg(f,"")}catch(U){Bi(e,e.return,U)}}if(u&4&&(f=e.stateNode,f!=null)){var _=e.memoizedProps,w=a!==null?a.memoizedProps:_,T=e.type,o=e.updateQueue;if(e.updateQueue=null,o!==null)try{T==="input"&&_.type==="radio"&&_.name!=null&&Q4(f,_),vT(T,w);var k=vT(T,_);for(w=0;w<o.length;w+=2){var R=o[w],F=o[w+1];R==="style"?iR(f,F):R==="dangerouslySetInnerHTML"?rR(f,F):R==="children"?fg(f,F):BE(f,R,F,k)}switch(T){case"input":mT(f,_);break;case"textarea":eR(f,_);break;case"select":var B=f._wrapperState.wasMultiple;f._wrapperState.wasMultiple=!!_.multiple;var V=_.value;V!=null?jd(f,!!_.multiple,V,!1):B!==!!_.multiple&&(_.defaultValue!=null?jd(f,!!_.multiple,_.defaultValue,!0):jd(f,!!_.multiple,_.multiple?[]:"",!1))}f[wg]=_}catch(U){Bi(e,e.return,U)}}break;case 6:if(No(n,e),bl(e),u&4){if(e.stateNode===null)throw Error(lr(162));f=e.stateNode,_=e.memoizedProps;try{f.nodeValue=_}catch(U){Bi(e,e.return,U)}}break;case 3:if(No(n,e),bl(e),u&4&&a!==null&&a.memoizedState.isDehydrated)try{gg(n.containerInfo)}catch(U){Bi(e,e.return,U)}break;case 4:No(n,e),bl(e);break;case 13:No(n,e),bl(e),f=e.child,f.flags&8192&&(_=f.memoizedState!==null,f.stateNode.isHidden=_,!_||f.alternate!==null&&f.alternate.memoizedState!==null||(xS=Zi())),u&4&&AI(e);break;case 22:if(R=a!==null&&a.memoizedState!==null,e.mode&1?($a=(k=$a)||R,No(n,e),$a=k):No(n,e),bl(e),u&8192){if(k=e.memoizedState!==null,(e.stateNode.isHidden=k)&&!R&&e.mode&1)for(Ar=e,R=e.child;R!==null;){for(F=Ar=R;Ar!==null;){switch(B=Ar,V=B.child,B.tag){case 0:case 11:case 14:case 15:Jm(4,B,B.return);break;case 1:Ud(B,B.return);var G=B.stateNode;if(typeof G.componentWillUnmount=="function"){u=B,a=B.return;try{n=u,G.props=n.memoizedProps,G.state=n.memoizedState,G.componentWillUnmount()}catch(U){Bi(u,a,U)}}break;case 5:Ud(B,B.return);break;case 22:if(B.memoizedState!==null){kI(F);continue}}V!==null?(V.return=B,Ar=V):kI(F)}R=R.sibling}e:for(R=null,F=e;;){if(F.tag===5){if(R===null){R=F;try{f=F.stateNode,k?(_=f.style,typeof _.setProperty=="function"?_.setProperty("display","none","important"):_.display="none"):(T=F.stateNode,o=F.memoizedProps.style,w=o!=null&&o.hasOwnProperty("display")?o.display:null,T.style.display=nR("display",w))}catch(U){Bi(e,e.return,U)}}}else if(F.tag===6){if(R===null)try{F.stateNode.nodeValue=k?"":F.memoizedProps}catch(U){Bi(e,e.return,U)}}else if((F.tag!==22&&F.tag!==23||F.memoizedState===null||F===e)&&F.child!==null){F.child.return=F,F=F.child;continue}if(F===e)break e;for(;F.sibling===null;){if(F.return===null||F.return===e)break e;R===F&&(R=null),F=F.return}R===F&&(R=null),F.sibling.return=F.return,F=F.sibling}}break;case 19:No(n,e),bl(e),u&4&&AI(e);break;case 21:break;default:No(n,e),bl(e)}}function bl(e){var n=e.flags;if(n&2){try{e:{for(var a=e.return;a!==null;){if(ID(a)){var u=a;break e}a=a.return}throw Error(lr(160))}switch(u.tag){case 5:var f=u.stateNode;u.flags&32&&(fg(f,""),u.flags&=-33);var _=SI(e);YT(e,_,f);break;case 3:case 4:var w=u.stateNode.containerInfo,T=SI(e);XT(e,T,w);break;default:throw Error(lr(161))}}catch(o){Bi(e,e.return,o)}e.flags&=-3}n&4096&&(e.flags&=-4097)}function J8(e,n,a){Ar=e,DD(e)}function DD(e,n,a){for(var u=(e.mode&1)!==0;Ar!==null;){var f=Ar,_=f.child;if(f.tag===22&&u){var w=f.memoizedState!==null||hy;if(!w){var T=f.alternate,o=T!==null&&T.memoizedState!==null||$a;T=hy;var k=$a;if(hy=w,($a=o)&&!k)for(Ar=f;Ar!==null;)w=Ar,o=w.child,w.tag===22&&w.memoizedState!==null?MI(f):o!==null?(o.return=w,Ar=o):MI(f);for(;_!==null;)Ar=_,DD(_),_=_.sibling;Ar=f,hy=T,$a=k}CI(e)}else f.subtreeFlags&8772&&_!==null?(_.return=f,Ar=_):CI(e)}}function CI(e){for(;Ar!==null;){var n=Ar;if(n.flags&8772){var a=n.alternate;try{if(n.flags&8772)switch(n.tag){case 0:case 11:case 15:$a||K1(5,n);break;case 1:var u=n.stateNode;if(n.flags&4&&!$a)if(a===null)u.componentDidMount();else{var f=n.elementType===n.type?a.memoizedProps:$o(n.type,a.memoizedProps);u.componentDidUpdate(f,a.memoizedState,u.__reactInternalSnapshotBeforeUpdate)}var _=n.updateQueue;_!==null&&uI(n,_,u);break;case 3:var w=n.updateQueue;if(w!==null){if(a=null,n.child!==null)switch(n.child.tag){case 5:a=n.child.stateNode;break;case 1:a=n.child.stateNode}uI(n,w,a)}break;case 5:var T=n.stateNode;if(a===null&&n.flags&4){a=T;var o=n.memoizedProps;switch(n.type){case"button":case"input":case"select":case"textarea":o.autoFocus&&a.focus();break;case"img":o.src&&(a.src=o.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(n.memoizedState===null){var k=n.alternate;if(k!==null){var R=k.memoizedState;if(R!==null){var F=R.dehydrated;F!==null&&gg(F)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(lr(163))}$a||n.flags&512&&ZT(n)}catch(B){Bi(n,n.return,B)}}if(n===e){Ar=null;break}if(a=n.sibling,a!==null){a.return=n.return,Ar=a;break}Ar=n.return}}function kI(e){for(;Ar!==null;){var n=Ar;if(n===e){Ar=null;break}var a=n.sibling;if(a!==null){a.return=n.return,Ar=a;break}Ar=n.return}}function MI(e){for(;Ar!==null;){var n=Ar;try{switch(n.tag){case 0:case 11:case 15:var a=n.return;try{K1(4,n)}catch(o){Bi(n,a,o)}break;case 1:var u=n.stateNode;if(typeof u.componentDidMount=="function"){var f=n.return;try{u.componentDidMount()}catch(o){Bi(n,f,o)}}var _=n.return;try{ZT(n)}catch(o){Bi(n,_,o)}break;case 5:var w=n.return;try{ZT(n)}catch(o){Bi(n,w,o)}}}catch(o){Bi(n,n.return,o)}if(n===e){Ar=null;break}var T=n.sibling;if(T!==null){T.return=n.return,Ar=T;break}Ar=n.return}}var Q8=Math.ceil,v1=Ec.ReactCurrentDispatcher,gS=Ec.ReactCurrentOwner,lo=Ec.ReactCurrentBatchConfig,qn=0,ga=null,na=null,Sa=0,zs=0,Vd=ju(0),la=0,Cg=null,nf=0,J1=0,_S=0,Qm=null,ys=null,xS=0,sp=1/0,oc=null,w1=!1,KT=null,Pu=null,fy=!1,Tu=null,b1=0,eg=0,JT=null,Gy=-1,Hy=0;function ns(){return qn&6?Zi():Gy!==-1?Gy:Gy=Zi()}function Ru(e){return e.mode&1?qn&2&&Sa!==0?Sa&-Sa:O8.transition!==null?(Hy===0&&(Hy=gR()),Hy):(e=ci,e!==0||(e=window.event,e=e===void 0?16:TR(e.type)),e):1}function Xo(e,n,a,u){if(50<eg)throw eg=0,JT=null,Error(lr(185));$g(e,a,u),(!(qn&2)||e!==ga)&&(e===ga&&(!(qn&2)&&(J1|=a),la===4&&yu(e,Sa)),Es(e,u),a===1&&qn===0&&!(n.mode&1)&&(sp=Zi()+500,Z1&&Gu()))}function Es(e,n){var a=e.callbackNode;OB(e,n);var u=a1(e,e===ga?Sa:0);if(u===0)a!==null&&zM(a),e.callbackNode=null,e.callbackPriority=0;else if(n=u&-u,e.callbackPriority!==n){if(a!=null&&zM(a),n===1)e.tag===0?L8(II.bind(null,e)):$R(II.bind(null,e)),P8(function(){!(qn&6)&&Gu()}),a=null;else{switch(_R(u)){case 1:a=GE;break;case 4:a=pR;break;case 16:a=i1;break;case 536870912:a=mR;break;default:a=i1}a=VD(a,FD.bind(null,e))}e.callbackPriority=n,e.callbackNode=a}}function FD(e,n){if(Gy=-1,Hy=0,qn&6)throw Error(lr(327));var a=e.callbackNode;if(Zd()&&e.callbackNode!==a)return null;var u=a1(e,e===ga?Sa:0);if(u===0)return null;if(u&30||u&e.expiredLanes||n)n=T1(e,u);else{n=u;var f=qn;qn|=2;var _=OD();(ga!==e||Sa!==n)&&(oc=null,sp=Zi()+500,Yh(e,n));do try{rU();break}catch(T){LD(e,T)}while(!0);nS(),v1.current=_,qn=f,na!==null?n=0:(ga=null,Sa=0,n=la)}if(n!==0){if(n===2&&(f=ST(e),f!==0&&(u=f,n=QT(e,f))),n===1)throw a=Cg,Yh(e,0),yu(e,u),Es(e,Zi()),a;if(n===6)yu(e,u);else{if(f=e.current.alternate,!(u&30)&&!eU(f)&&(n=T1(e,u),n===2&&(_=ST(e),_!==0&&(u=_,n=QT(e,_))),n===1))throw a=Cg,Yh(e,0),yu(e,u),Es(e,Zi()),a;switch(e.finishedWork=f,e.finishedLanes=u,n){case 0:case 1:throw Error(lr(345));case 2:$h(e,ys,oc);break;case 3:if(yu(e,u),(u&130023424)===u&&(n=xS+500-Zi(),10<n)){if(a1(e,0)!==0)break;if(f=e.suspendedLanes,(f&u)!==u){ns(),e.pingedLanes|=e.suspendedLanes&f;break}e.timeoutHandle=DT($h.bind(null,e,ys,oc),n);break}$h(e,ys,oc);break;case 4:if(yu(e,u),(u&4194240)===u)break;for(n=e.eventTimes,f=-1;0<u;){var w=31-Zo(u);_=1<<w,w=n[w],w>f&&(f=w),u&=~_}if(u=f,u=Zi()-u,u=(120>u?120:480>u?480:1080>u?1080:1920>u?1920:3e3>u?3e3:4320>u?4320:1960*Q8(u/1960))-u,10<u){e.timeoutHandle=DT($h.bind(null,e,ys,oc),u);break}$h(e,ys,oc);break;case 5:$h(e,ys,oc);break;default:throw Error(lr(329))}}}return Es(e,Zi()),e.callbackNode===a?FD.bind(null,e):null}function QT(e,n){var a=Qm;return e.current.memoizedState.isDehydrated&&(Yh(e,n).flags|=256),e=T1(e,n),e!==2&&(n=ys,ys=a,n!==null&&eE(n)),e}function eE(e){ys===null?ys=e:ys.push.apply(ys,e)}function eU(e){for(var n=e;;){if(n.flags&16384){var a=n.updateQueue;if(a!==null&&(a=a.stores,a!==null))for(var u=0;u<a.length;u++){var f=a[u],_=f.getSnapshot;f=f.value;try{if(!Jo(_(),f))return!1}catch{return!1}}}if(a=n.child,n.subtreeFlags&16384&&a!==null)a.return=n,n=a;else{if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return!0;n=n.return}n.sibling.return=n.return,n=n.sibling}}return!0}function yu(e,n){for(n&=~_S,n&=~J1,e.suspendedLanes|=n,e.pingedLanes&=~n,e=e.expirationTimes;0<n;){var a=31-Zo(n),u=1<<a;e[a]=-1,n&=~u}}function II(e){if(qn&6)throw Error(lr(327));Zd();var n=a1(e,0);if(!(n&1))return Es(e,Zi()),null;var a=T1(e,n);if(e.tag!==0&&a===2){var u=ST(e);u!==0&&(n=u,a=QT(e,u))}if(a===1)throw a=Cg,Yh(e,0),yu(e,n),Es(e,Zi()),a;if(a===6)throw Error(lr(345));return e.finishedWork=e.current.alternate,e.finishedLanes=n,$h(e,ys,oc),Es(e,Zi()),null}function yS(e,n){var a=qn;qn|=1;try{return e(n)}finally{qn=a,qn===0&&(sp=Zi()+500,Z1&&Gu())}}function af(e){Tu!==null&&Tu.tag===0&&!(qn&6)&&Zd();var n=qn;qn|=1;var a=lo.transition,u=ci;try{if(lo.transition=null,ci=1,e)return e()}finally{ci=u,lo.transition=a,qn=n,!(qn&6)&&Gu()}}function vS(){zs=Vd.current,wi(Vd)}function Yh(e,n){e.finishedWork=null,e.finishedLanes=0;var a=e.timeoutHandle;if(a!==-1&&(e.timeoutHandle=-1,I8(a)),na!==null)for(a=na.return;a!==null;){var u=a;switch(eS(u),u.tag){case 1:u=u.type.childContextTypes,u!=null&&u1();break;case 3:ip(),wi(bs),wi(Wa),cS();break;case 5:lS(u);break;case 4:ip();break;case 13:wi(Ri);break;case 19:wi(Ri);break;case 10:iS(u.type._context);break;case 22:case 23:vS()}a=a.return}if(ga=e,na=e=Du(e.current,null),Sa=zs=n,la=0,Cg=null,_S=J1=nf=0,ys=Qm=null,Wh!==null){for(n=0;n<Wh.length;n++)if(a=Wh[n],u=a.interleaved,u!==null){a.interleaved=null;var f=u.next,_=a.pending;if(_!==null){var w=_.next;_.next=f,u.next=w}a.pending=u}Wh=null}return e}function LD(e,n){do{var a=na;try{if(nS(),Vy.current=y1,x1){for(var u=Di.memoizedState;u!==null;){var f=u.queue;f!==null&&(f.pending=null),u=u.next}x1=!1}if(rf=0,ma=oa=Di=null,Km=!1,Eg=0,gS.current=null,a===null||a.return===null){la=1,Cg=n,na=null;break}e:{var _=e,w=a.return,T=a,o=n;if(n=Sa,T.flags|=32768,o!==null&&typeof o=="object"&&typeof o.then=="function"){var k=o,R=T,F=R.tag;if(!(R.mode&1)&&(F===0||F===11||F===15)){var B=R.alternate;B?(R.updateQueue=B.updateQueue,R.memoizedState=B.memoizedState,R.lanes=B.lanes):(R.updateQueue=null,R.memoizedState=null)}var V=_I(w);if(V!==null){V.flags&=-257,xI(V,w,T,_,n),V.mode&1&&gI(_,k,n),n=V,o=k;var G=n.updateQueue;if(G===null){var U=new Set;U.add(o),n.updateQueue=U}else G.add(o);break e}else{if(!(n&1)){gI(_,k,n),wS();break e}o=Error(lr(426))}}else if(ki&&T.mode&1){var J=_I(w);if(J!==null){!(J.flags&65536)&&(J.flags|=256),xI(J,w,T,_,n),tS(ap(o,T));break e}}_=o=ap(o,T),la!==4&&(la=2),Qm===null?Qm=[_]:Qm.push(_),_=w;do{switch(_.tag){case 3:_.flags|=65536,n&=-n,_.lanes|=n;var X=xD(_,o,n);cI(_,X);break e;case 1:T=o;var Y=_.type,Z=_.stateNode;if(!(_.flags&128)&&(typeof Y.getDerivedStateFromError=="function"||Z!==null&&typeof Z.componentDidCatch=="function"&&(Pu===null||!Pu.has(Z)))){_.flags|=65536,n&=-n,_.lanes|=n;var _e=yD(_,T,n);cI(_,_e);break e}}_=_.return}while(_!==null)}zD(a)}catch(ke){n=ke,na===a&&a!==null&&(na=a=a.return);continue}break}while(!0)}function OD(){var e=v1.current;return v1.current=y1,e===null?y1:e}function wS(){(la===0||la===3||la===2)&&(la=4),ga===null||!(nf&268435455)&&!(J1&268435455)||yu(ga,Sa)}function T1(e,n){var a=qn;qn|=2;var u=OD();(ga!==e||Sa!==n)&&(oc=null,Yh(e,n));do try{tU();break}catch(f){LD(e,f)}while(!0);if(nS(),qn=a,v1.current=u,na!==null)throw Error(lr(261));return ga=null,Sa=0,la}function tU(){for(;na!==null;)ND(na)}function rU(){for(;na!==null&&!CB();)ND(na)}function ND(e){var n=UD(e.alternate,e,zs);e.memoizedProps=e.pendingProps,n===null?zD(e):na=n,gS.current=null}function zD(e){var n=e;do{var a=n.alternate;if(e=n.return,n.flags&32768){if(a=X8(a,n),a!==null){a.flags&=32767,na=a;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{la=6,na=null;return}}else if(a=Z8(a,n,zs),a!==null){na=a;return}if(n=n.sibling,n!==null){na=n;return}na=n=e}while(n!==null);la===0&&(la=5)}function $h(e,n,a){var u=ci,f=lo.transition;try{lo.transition=null,ci=1,nU(e,n,a,u)}finally{lo.transition=f,ci=u}return null}function nU(e,n,a,u){do Zd();while(Tu!==null);if(qn&6)throw Error(lr(327));a=e.finishedWork;var f=e.finishedLanes;if(a===null)return null;if(e.finishedWork=null,e.finishedLanes=0,a===e.current)throw Error(lr(177));e.callbackNode=null,e.callbackPriority=0;var _=a.lanes|a.childLanes;if(NB(e,_),e===ga&&(na=ga=null,Sa=0),!(a.subtreeFlags&2064)&&!(a.flags&2064)||fy||(fy=!0,VD(i1,function(){return Zd(),null})),_=(a.flags&15990)!==0,a.subtreeFlags&15990||_){_=lo.transition,lo.transition=null;var w=ci;ci=1;var T=qn;qn|=4,gS.current=null,K8(e,a),RD(a,e),T8(PT),s1=!!IT,PT=IT=null,e.current=a,J8(a),kB(),qn=T,ci=w,lo.transition=_}else e.current=a;if(fy&&(fy=!1,Tu=e,b1=f),_=e.pendingLanes,_===0&&(Pu=null),PB(a.stateNode),Es(e,Zi()),n!==null)for(u=e.onRecoverableError,a=0;a<n.length;a++)f=n[a],u(f.value,{componentStack:f.stack,digest:f.digest});if(w1)throw w1=!1,e=KT,KT=null,e;return b1&1&&e.tag!==0&&Zd(),_=e.pendingLanes,_&1?e===JT?eg++:(eg=0,JT=e):eg=0,Gu(),null}function Zd(){if(Tu!==null){var e=_R(b1),n=lo.transition,a=ci;try{if(lo.transition=null,ci=16>e?16:e,Tu===null)var u=!1;else{if(e=Tu,Tu=null,b1=0,qn&6)throw Error(lr(331));var f=qn;for(qn|=4,Ar=e.current;Ar!==null;){var _=Ar,w=_.child;if(Ar.flags&16){var T=_.deletions;if(T!==null){for(var o=0;o<T.length;o++){var k=T[o];for(Ar=k;Ar!==null;){var R=Ar;switch(R.tag){case 0:case 11:case 15:Jm(8,R,_)}var F=R.child;if(F!==null)F.return=R,Ar=F;else for(;Ar!==null;){R=Ar;var B=R.sibling,V=R.return;if(MD(R),R===k){Ar=null;break}if(B!==null){B.return=V,Ar=B;break}Ar=V}}}var G=_.alternate;if(G!==null){var U=G.child;if(U!==null){G.child=null;do{var J=U.sibling;U.sibling=null,U=J}while(U!==null)}}Ar=_}}if(_.subtreeFlags&2064&&w!==null)w.return=_,Ar=w;else e:for(;Ar!==null;){if(_=Ar,_.flags&2048)switch(_.tag){case 0:case 11:case 15:Jm(9,_,_.return)}var X=_.sibling;if(X!==null){X.return=_.return,Ar=X;break e}Ar=_.return}}var Y=e.current;for(Ar=Y;Ar!==null;){w=Ar;var Z=w.child;if(w.subtreeFlags&2064&&Z!==null)Z.return=w,Ar=Z;else e:for(w=Y;Ar!==null;){if(T=Ar,T.flags&2048)try{switch(T.tag){case 0:case 11:case 15:K1(9,T)}}catch(ke){Bi(T,T.return,ke)}if(T===w){Ar=null;break e}var _e=T.sibling;if(_e!==null){_e.return=T.return,Ar=_e;break e}Ar=T.return}}if(qn=f,Gu(),Ml&&typeof Ml.onPostCommitFiberRoot=="function")try{Ml.onPostCommitFiberRoot(j1,e)}catch{}u=!0}return u}finally{ci=a,lo.transition=n}}return!1}function PI(e,n,a){n=ap(a,n),n=xD(e,n,1),e=Iu(e,n,1),n=ns(),e!==null&&($g(e,1,n),Es(e,n))}function Bi(e,n,a){if(e.tag===3)PI(e,e,a);else for(;n!==null;){if(n.tag===3){PI(n,e,a);break}else if(n.tag===1){var u=n.stateNode;if(typeof n.type.getDerivedStateFromError=="function"||typeof u.componentDidCatch=="function"&&(Pu===null||!Pu.has(u))){e=ap(a,e),e=yD(n,e,1),n=Iu(n,e,1),e=ns(),n!==null&&($g(n,1,e),Es(n,e));break}}n=n.return}}function iU(e,n,a){var u=e.pingCache;u!==null&&u.delete(n),n=ns(),e.pingedLanes|=e.suspendedLanes&a,ga===e&&(Sa&a)===a&&(la===4||la===3&&(Sa&130023424)===Sa&&500>Zi()-xS?Yh(e,0):_S|=a),Es(e,n)}function BD(e,n){n===0&&(e.mode&1?(n=ry,ry<<=1,!(ry&130023424)&&(ry=4194304)):n=1);var a=ns();e=xc(e,n),e!==null&&($g(e,n,a),Es(e,a))}function aU(e){var n=e.memoizedState,a=0;n!==null&&(a=n.retryLane),BD(e,a)}function sU(e,n){var a=0;switch(e.tag){case 13:var u=e.stateNode,f=e.memoizedState;f!==null&&(a=f.retryLane);break;case 19:u=e.stateNode;break;default:throw Error(lr(314))}u!==null&&u.delete(n),BD(e,a)}var UD;UD=function(e,n,a){if(e!==null)if(e.memoizedProps!==n.pendingProps||bs.current)vs=!0;else{if(!(e.lanes&a)&&!(n.flags&128))return vs=!1,q8(e,n,a);vs=!!(e.flags&131072)}else vs=!1,ki&&n.flags&1048576&&jR(n,d1,n.index);switch(n.lanes=0,n.tag){case 2:var u=n.type;jy(e,n),e=n.pendingProps;var f=tp(n,Wa.current);qd(n,a),f=hS(null,n,u,e,f,a);var _=fS();return n.flags|=1,typeof f=="object"&&f!==null&&typeof f.render=="function"&&f.$$typeof===void 0?(n.tag=1,n.memoizedState=null,n.updateQueue=null,Ts(u)?(_=!0,h1(n)):_=!1,n.memoizedState=f.state!==null&&f.state!==void 0?f.state:null,sS(n),f.updater=X1,n.stateNode=f,f._reactInternals=n,UT(n,u,e,a),n=jT(null,n,u,!0,_,a)):(n.tag=0,ki&&_&&QE(n),Qa(null,n,f,a),n=n.child),n;case 16:u=n.elementType;e:{switch(jy(e,n),e=n.pendingProps,f=u._init,u=f(u._payload),n.type=u,f=n.tag=lU(u),e=$o(u,e),f){case 0:n=$T(null,n,u,e,a);break e;case 1:n=wI(null,n,u,e,a);break e;case 11:n=yI(null,n,u,e,a);break e;case 14:n=vI(null,n,u,$o(u.type,e),a);break e}throw Error(lr(306,u,""))}return n;case 0:return u=n.type,f=n.pendingProps,f=n.elementType===u?f:$o(u,f),$T(e,n,u,f,a);case 1:return u=n.type,f=n.pendingProps,f=n.elementType===u?f:$o(u,f),wI(e,n,u,f,a);case 3:e:{if(TD(n),e===null)throw Error(lr(387));u=n.pendingProps,_=n.memoizedState,f=_.element,qR(e,n),g1(n,u,null,a);var w=n.memoizedState;if(u=w.element,_.isDehydrated)if(_={element:u,isDehydrated:!1,cache:w.cache,pendingSuspenseBoundaries:w.pendingSuspenseBoundaries,transitions:w.transitions},n.updateQueue.baseState=_,n.memoizedState=_,n.flags&256){f=ap(Error(lr(423)),n),n=bI(e,n,u,a,f);break e}else if(u!==f){f=ap(Error(lr(424)),n),n=bI(e,n,u,a,f);break e}else for($s=Mu(n.stateNode.containerInfo.firstChild),js=n,ki=!0,Go=null,a=KR(n,null,u,a),n.child=a;a;)a.flags=a.flags&-3|4096,a=a.sibling;else{if(rp(),u===f){n=yc(e,n,a);break e}Qa(e,n,u,a)}n=n.child}return n;case 5:return JR(n),e===null&&NT(n),u=n.type,f=n.pendingProps,_=e!==null?e.memoizedProps:null,w=f.children,RT(u,f)?w=null:_!==null&&RT(u,_)&&(n.flags|=32),bD(e,n),Qa(e,n,w,a),n.child;case 6:return e===null&&NT(n),null;case 13:return ED(e,n,a);case 4:return oS(n,n.stateNode.containerInfo),u=n.pendingProps,e===null?n.child=np(n,null,u,a):Qa(e,n,u,a),n.child;case 11:return u=n.type,f=n.pendingProps,f=n.elementType===u?f:$o(u,f),yI(e,n,u,f,a);case 7:return Qa(e,n,n.pendingProps,a),n.child;case 8:return Qa(e,n,n.pendingProps.children,a),n.child;case 12:return Qa(e,n,n.pendingProps.children,a),n.child;case 10:e:{if(u=n.type._context,f=n.pendingProps,_=n.memoizedProps,w=f.value,mi(p1,u._currentValue),u._currentValue=w,_!==null)if(Jo(_.value,w)){if(_.children===f.children&&!bs.current){n=yc(e,n,a);break e}}else for(_=n.child,_!==null&&(_.return=n);_!==null;){var T=_.dependencies;if(T!==null){w=_.child;for(var o=T.firstContext;o!==null;){if(o.context===u){if(_.tag===1){o=fc(-1,a&-a),o.tag=2;var k=_.updateQueue;if(k!==null){k=k.shared;var R=k.pending;R===null?o.next=o:(o.next=R.next,R.next=o),k.pending=o}}_.lanes|=a,o=_.alternate,o!==null&&(o.lanes|=a),zT(_.return,a,n),T.lanes|=a;break}o=o.next}}else if(_.tag===10)w=_.type===n.type?null:_.child;else if(_.tag===18){if(w=_.return,w===null)throw Error(lr(341));w.lanes|=a,T=w.alternate,T!==null&&(T.lanes|=a),zT(w,a,n),w=_.sibling}else w=_.child;if(w!==null)w.return=_;else for(w=_;w!==null;){if(w===n){w=null;break}if(_=w.sibling,_!==null){_.return=w.return,w=_;break}w=w.return}_=w}Qa(e,n,f.children,a),n=n.child}return n;case 9:return f=n.type,u=n.pendingProps.children,qd(n,a),f=uo(f),u=u(f),n.flags|=1,Qa(e,n,u,a),n.child;case 14:return u=n.type,f=$o(u,n.pendingProps),f=$o(u.type,f),vI(e,n,u,f,a);case 15:return vD(e,n,n.type,n.pendingProps,a);case 17:return u=n.type,f=n.pendingProps,f=n.elementType===u?f:$o(u,f),jy(e,n),n.tag=1,Ts(u)?(e=!0,h1(n)):e=!1,qd(n,a),XR(n,u,f),UT(n,u,f,a),jT(null,n,u,!0,e,a);case 19:return SD(e,n,a);case 22:return wD(e,n,a)}throw Error(lr(156,n.tag))};function VD(e,n){return dR(e,n)}function oU(e,n,a,u){this.tag=e,this.key=a,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=n,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=u,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function oo(e,n,a,u){return new oU(e,n,a,u)}function bS(e){return e=e.prototype,!(!e||!e.isReactComponent)}function lU(e){if(typeof e=="function")return bS(e)?1:0;if(e!=null){if(e=e.$$typeof,e===VE)return 11;if(e===$E)return 14}return 2}function Du(e,n){var a=e.alternate;return a===null?(a=oo(e.tag,n,e.key,e.mode),a.elementType=e.elementType,a.type=e.type,a.stateNode=e.stateNode,a.alternate=e,e.alternate=a):(a.pendingProps=n,a.type=e.type,a.flags=0,a.subtreeFlags=0,a.deletions=null),a.flags=e.flags&14680064,a.childLanes=e.childLanes,a.lanes=e.lanes,a.child=e.child,a.memoizedProps=e.memoizedProps,a.memoizedState=e.memoizedState,a.updateQueue=e.updateQueue,n=e.dependencies,a.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext},a.sibling=e.sibling,a.index=e.index,a.ref=e.ref,a}function Wy(e,n,a,u,f,_){var w=2;if(u=e,typeof e=="function")bS(e)&&(w=1);else if(typeof e=="string")w=5;else e:switch(e){case Pd:return Kh(a.children,f,_,n);case UE:w=8,f|=8;break;case uT:return e=oo(12,a,n,f|2),e.elementType=uT,e.lanes=_,e;case hT:return e=oo(13,a,n,f),e.elementType=hT,e.lanes=_,e;case fT:return e=oo(19,a,n,f),e.elementType=fT,e.lanes=_,e;case Y4:return Q1(a,f,_,n);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case Z4:w=10;break e;case X4:w=9;break e;case VE:w=11;break e;case $E:w=14;break e;case gu:w=16,u=null;break e}throw Error(lr(130,e==null?e:typeof e,""))}return n=oo(w,a,n,f),n.elementType=e,n.type=u,n.lanes=_,n}function Kh(e,n,a,u){return e=oo(7,e,u,n),e.lanes=a,e}function Q1(e,n,a,u){return e=oo(22,e,u,n),e.elementType=Y4,e.lanes=a,e.stateNode={isHidden:!1},e}function Db(e,n,a){return e=oo(6,e,null,n),e.lanes=a,e}function Fb(e,n,a){return n=oo(4,e.children!==null?e.children:[],e.key,n),n.lanes=a,n.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},n}function cU(e,n,a,u,f){this.tag=n,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=pb(0),this.expirationTimes=pb(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=pb(0),this.identifierPrefix=u,this.onRecoverableError=f,this.mutableSourceEagerHydrationData=null}function TS(e,n,a,u,f,_,w,T,o){return e=new cU(e,n,a,T,o),n===1?(n=1,_===!0&&(n|=8)):n=0,_=oo(3,null,null,n),e.current=_,_.stateNode=e,_.memoizedState={element:u,isDehydrated:a,cache:null,transitions:null,pendingSuspenseBoundaries:null},sS(_),e}function uU(e,n,a){var u=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Id,key:u==null?null:""+u,children:e,containerInfo:n,implementation:a}}function $D(e){if(!e)return Ou;e=e._reactInternals;e:{if(hf(e)!==e||e.tag!==1)throw Error(lr(170));var n=e;do{switch(n.tag){case 3:n=n.stateNode.context;break e;case 1:if(Ts(n.type)){n=n.stateNode.__reactInternalMemoizedMergedChildContext;break e}}n=n.return}while(n!==null);throw Error(lr(171))}if(e.tag===1){var a=e.type;if(Ts(a))return VR(e,a,n)}return n}function jD(e,n,a,u,f,_,w,T,o){return e=TS(a,u,!0,e,f,_,w,T,o),e.context=$D(null),a=e.current,u=ns(),f=Ru(a),_=fc(u,f),_.callback=n??null,Iu(a,_,f),e.current.lanes=f,$g(e,f,u),Es(e,u),e}function ev(e,n,a,u){var f=n.current,_=ns(),w=Ru(f);return a=$D(a),n.context===null?n.context=a:n.pendingContext=a,n=fc(_,w),n.payload={element:e},u=u===void 0?null:u,u!==null&&(n.callback=u),e=Iu(f,n,w),e!==null&&(Xo(e,f,w,_),Uy(e,f,w)),w}function E1(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function RI(e,n){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var a=e.retryLane;e.retryLane=a!==0&&a<n?a:n}}function ES(e,n){RI(e,n),(e=e.alternate)&&RI(e,n)}function hU(){return null}var GD=typeof reportError=="function"?reportError:function(e){console.error(e)};function SS(e){this._internalRoot=e}tv.prototype.render=SS.prototype.render=function(e){var n=this._internalRoot;if(n===null)throw Error(lr(409));ev(e,n,null,null)};tv.prototype.unmount=SS.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var n=e.containerInfo;af(function(){ev(null,e,null,null)}),n[_c]=null}};function tv(e){this._internalRoot=e}tv.prototype.unstable_scheduleHydration=function(e){if(e){var n=vR();e={blockedOn:null,target:e,priority:n};for(var a=0;a<xu.length&&n!==0&&n<xu[a].priority;a++);xu.splice(a,0,e),a===0&&bR(e)}};function AS(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function rv(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function DI(){}function fU(e,n,a,u,f){if(f){if(typeof u=="function"){var _=u;u=function(){var k=E1(w);_.call(k)}}var w=jD(n,u,e,0,null,!1,!1,"",DI);return e._reactRootContainer=w,e[_c]=w.current,yg(e.nodeType===8?e.parentNode:e),af(),w}for(;f=e.lastChild;)e.removeChild(f);if(typeof u=="function"){var T=u;u=function(){var k=E1(o);T.call(k)}}var o=TS(e,0,!1,null,null,!1,!1,"",DI);return e._reactRootContainer=o,e[_c]=o.current,yg(e.nodeType===8?e.parentNode:e),af(function(){ev(n,o,a,u)}),o}function nv(e,n,a,u,f){var _=a._reactRootContainer;if(_){var w=_;if(typeof f=="function"){var T=f;f=function(){var o=E1(w);T.call(o)}}ev(n,w,e,f)}else w=fU(a,n,e,f,u);return E1(w)}xR=function(e){switch(e.tag){case 3:var n=e.stateNode;if(n.current.memoizedState.isDehydrated){var a=Bm(n.pendingLanes);a!==0&&(HE(n,a|1),Es(n,Zi()),!(qn&6)&&(sp=Zi()+500,Gu()))}break;case 13:af(function(){var u=xc(e,1);if(u!==null){var f=ns();Xo(u,e,1,f)}}),ES(e,1)}};WE=function(e){if(e.tag===13){var n=xc(e,134217728);if(n!==null){var a=ns();Xo(n,e,134217728,a)}ES(e,134217728)}};yR=function(e){if(e.tag===13){var n=Ru(e),a=xc(e,n);if(a!==null){var u=ns();Xo(a,e,n,u)}ES(e,n)}};vR=function(){return ci};wR=function(e,n){var a=ci;try{return ci=e,n()}finally{ci=a}};bT=function(e,n,a){switch(n){case"input":if(mT(e,a),n=a.name,a.type==="radio"&&n!=null){for(a=e;a.parentNode;)a=a.parentNode;for(a=a.querySelectorAll("input[name="+JSON.stringify(""+n)+'][type="radio"]'),n=0;n<a.length;n++){var u=a[n];if(u!==e&&u.form===e.form){var f=q1(u);if(!f)throw Error(lr(90));J4(u),mT(u,f)}}}break;case"textarea":eR(e,a);break;case"select":n=a.value,n!=null&&jd(e,!!a.multiple,n,!1)}};oR=yS;lR=af;var dU={usingClientEntryPoint:!1,Events:[Gg,Ld,q1,aR,sR,yS]},Im={findFiberByHostInstance:Hh,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},pU={bundleType:Im.bundleType,version:Im.version,rendererPackageName:Im.rendererPackageName,rendererConfig:Im.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Ec.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=hR(e),e===null?null:e.stateNode},findFiberByHostInstance:Im.findFiberByHostInstance||hU,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var dy=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!dy.isDisabled&&dy.supportsFiber)try{j1=dy.inject(pU),Ml=dy}catch{}}Xs.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=dU;Xs.createPortal=function(e,n){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!AS(n))throw Error(lr(200));return uU(e,n,null,a)};Xs.createRoot=function(e,n){if(!AS(e))throw Error(lr(299));var a=!1,u="",f=GD;return n!=null&&(n.unstable_strictMode===!0&&(a=!0),n.identifierPrefix!==void 0&&(u=n.identifierPrefix),n.onRecoverableError!==void 0&&(f=n.onRecoverableError)),n=TS(e,1,!1,null,null,a,!1,u,f),e[_c]=n.current,yg(e.nodeType===8?e.parentNode:e),new SS(n)};Xs.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var n=e._reactInternals;if(n===void 0)throw typeof e.render=="function"?Error(lr(188)):(e=Object.keys(e).join(","),Error(lr(268,e)));return e=hR(n),e=e===null?null:e.stateNode,e};Xs.flushSync=function(e){return af(e)};Xs.hydrate=function(e,n,a){if(!rv(n))throw Error(lr(200));return nv(null,e,n,!0,a)};Xs.hydrateRoot=function(e,n,a){if(!AS(e))throw Error(lr(405));var u=a!=null&&a.hydratedSources||null,f=!1,_="",w=GD;if(a!=null&&(a.unstable_strictMode===!0&&(f=!0),a.identifierPrefix!==void 0&&(_=a.identifierPrefix),a.onRecoverableError!==void 0&&(w=a.onRecoverableError)),n=jD(n,null,e,1,a??null,f,!1,_,w),e[_c]=n.current,yg(e),u)for(e=0;e<u.length;e++)a=u[e],f=a._getVersion,f=f(a._source),n.mutableSourceEagerHydrationData==null?n.mutableSourceEagerHydrationData=[a,f]:n.mutableSourceEagerHydrationData.push(a,f);return new tv(n)};Xs.render=function(e,n,a){if(!rv(n))throw Error(lr(200));return nv(null,e,n,!1,a)};Xs.unmountComponentAtNode=function(e){if(!rv(e))throw Error(lr(40));return e._reactRootContainer?(af(function(){nv(null,null,e,!1,function(){e._reactRootContainer=null,e[_c]=null})}),!0):!1};Xs.unstable_batchedUpdates=yS;Xs.unstable_renderSubtreeIntoContainer=function(e,n,a,u){if(!rv(a))throw Error(lr(200));if(e==null||e._reactInternals===void 0)throw Error(lr(38));return nv(e,n,a,!1,u)};Xs.version="18.2.0-next-9e3b772b8-20220608";function HD(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(HD)}catch(e){console.error(e)}}HD(),j4.exports=Xs;var Wg=j4.exports;const WD=RE(Wg);var FI=Wg;lT.createRoot=FI.createRoot,lT.hydrateRoot=FI.hydrateRoot;var qD={exports:{}};(function(e,n){var a={};(function(u,f){e.exports=f()})(kd,function(){var u,f,_;function w(o,k){if(!u)u=k;else if(!f)f=k;else{var R="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+u+")(sharedChunk); ("+f+")(sharedChunk); self.onerror = null;",F={};u(F),_=k(F),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(_.workerUrl=window.URL.createObjectURL(new Blob([R],{type:"text/javascript"})))}}w(["exports"],function(o){var k="3.3.0";let R;const F={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(R==null){const r=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{R=a.API_URL_REGEX!=null?new RegExp(a.API_URL_REGEX):r}catch{R=r}}return R},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!F.API_URL)return null;try{const r=new URL(F.API_URL);return r.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":r.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"};function B(r){return F.API_URL_REGEX.test(r)}function V(r){return r.indexOf("mapbox:")===0}function G(r){return F.API_CDN_URL_REGEX.test(r)}function U(r){return F.API_SPRITE_REGEX.test(r)}function J(r){return F.API_STYLE_REGEX.test(r)&&!U(r)}const X={create:"create",load:"load",fullLoad:"fullLoad"};function Y(r){const t=r.name.split("?")[0];return G(t)&&t.includes("mapbox-gl.js")?"javascript":G(t)&&t.includes("mapbox-gl.css")?"css":function(i){return F.API_FONTS_REGEX.test(i)}(t)?"fontRange":U(t)?"sprite":J(t)?"style":function(i){return F.API_TILEJSON_REGEX.test(i)}(t)?"tilejson":"other"}function Z(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var _e=ke;function ke(r,t,i,l){this.cx=3*r,this.bx=3*(i-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(l-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=t,this.p2x=i,this.p2y=l}ke.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,t){if(t===void 0&&(t=1e-6),r<0)return 0;if(r>1)return 1;for(var i=r,l=0;l<8;l++){var h=this.sampleCurveX(i)-r;if(Math.abs(h)<t)return i;var d=this.sampleCurveDerivativeX(i);if(Math.abs(d)<1e-6)break;i-=h/d}var g=0,y=1;for(i=r,l=0;l<20&&(h=this.sampleCurveX(i),!(Math.abs(h-r)<t));l++)r>h?g=i:y=i,i=.5*(y-g)+g;return i},solve:function(r,t){return this.sampleCurveY(this.solveCurveX(r,t))}};var Ae=Z(_e),me=De;function De(r,t){this.x=r,this.y=t}De.prototype={clone:function(){return new De(this.x,this.y)},add:function(r){return this.clone()._add(r)},sub:function(r){return this.clone()._sub(r)},multByPoint:function(r){return this.clone()._multByPoint(r)},divByPoint:function(r){return this.clone()._divByPoint(r)},mult:function(r){return this.clone()._mult(r)},div:function(r){return this.clone()._div(r)},rotate:function(r){return this.clone()._rotate(r)},rotateAround:function(r,t){return this.clone()._rotateAround(r,t)},matMult:function(r){return this.clone()._matMult(r)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(r){return this.x===r.x&&this.y===r.y},dist:function(r){return Math.sqrt(this.distSqr(r))},distSqr:function(r){var t=r.x-this.x,i=r.y-this.y;return t*t+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith:function(r){return this.angleWithSep(r.x,r.y)},angleWithSep:function(r,t){return Math.atan2(this.x*t-this.y*r,this.x*r+this.y*t)},_matMult:function(r){var t=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=t,this},_add:function(r){return this.x+=r.x,this.y+=r.y,this},_sub:function(r){return this.x-=r.x,this.y-=r.y,this},_mult:function(r){return this.x*=r,this.y*=r,this},_div:function(r){return this.x/=r,this.y/=r,this},_multByPoint:function(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint:function(r){return this.x/=r.x,this.y/=r.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var r=this.y;return this.y=this.x,this.x=-r,this},_rotate:function(r){var t=Math.cos(r),i=Math.sin(r),l=i*this.x+t*this.y;return this.x=t*this.x-i*this.y,this.y=l,this},_rotateAround:function(r,t){var i=Math.cos(r),l=Math.sin(r),h=t.y+l*(this.x-t.x)+i*(this.y-t.y);return this.x=t.x+i*(this.x-t.x)-l*(this.y-t.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},De.convert=function(r){return r instanceof De?r:Array.isArray(r)?new De(r[0],r[1]):r};var we=Z(me);const Je=Math.PI/180,rt=180/Math.PI;function Re(r){return r*Je}function St(r){return r*rt}const Lt=[[0,0],[1,0],[1,1],[0,1]];function We(r){if(r<=0)return 0;if(r>=1)return 1;const t=r*r,i=t*r;return 4*(r<.5?i:3*(r-t)+i-.75)}function qt(r,t,i,l){const h=new Ae(r,t,i,l);return function(d){return h.solve(d)}}const Ot=qt(.25,.1,.25,1);function st(r,t,i){return Math.min(i,Math.max(t,r))}function Ve(r,t,i){return(i=st((i-r)/(t-r),0,1))*i*(3-2*i)}function Et(r,t,i){const l=i-t,h=((r-t)%l+l)%l+t;return h===t?i:h}function Dt(r,t,i){if(!r.length)return i(null,[]);let l=r.length;const h=new Array(r.length);let d=null;r.forEach((g,y)=>{t(g,(b,E)=>{b&&(d=b),h[y]=E,--l==0&&i(d,h)})})}function Se(r,...t){for(const i of t)for(const l in i)r[l]=i[l];return r}let at=1;function He(){return at++}function Xe(){return function r(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,r)}()}function yt(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))}function Jt(r){return!!r&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(r)}function sr(r,t){r.forEach(i=>{t[i]&&(t[i]=t[i].bind(t))})}function Xt(r,t){return r.indexOf(t,r.length-t.length)!==-1}function zt(r,t,i){const l={};for(const h in r)l[h]=t.call(i||this,r[h],h,r);return l}function Or(r,t,i){const l={};for(const h in r)t.call(i||this,r[h],h,r)&&(l[h]=r[h]);return l}function Be(r){return Array.isArray(r)?r.map(Be):typeof r=="object"&&r?zt(r,Be):r}const Fn={};function Tr(r){Fn[r]||(typeof console<"u"&&console.warn(r),Fn[r]=!0)}function Er(r,t,i){return(i.y-r.y)*(t.x-r.x)>(t.y-r.y)*(i.x-r.x)}function Ir(r){let t=0;for(let i,l,h=0,d=r.length,g=d-1;h<d;g=h++)i=r[h],l=r[g],t+=(l.x-i.x)*(i.y+l.y);return t}function nr([r,t,i]){const l=Re(t+90),h=Re(i);return{x:r*Math.cos(l)*Math.sin(h),y:r*Math.sin(l)*Math.sin(h),z:r*Math.cos(h),azimuthal:t,polar:i}}function En(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Xn(r){const t={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,l,h,d)=>{const g=h||d;return t[l]=!g||g.toLowerCase(),""}),t["max-age"]){const i=parseInt(t["max-age"],10);isNaN(i)?delete t["max-age"]:t["max-age"]=i}return t}let wn,ei,bi,Mn,Nn,ti,gt=null;function le(r){try{const t=self[r];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch{return!1}}function Te(r,t){return[r[4*t],r[4*t+1],r[4*t+2],r[4*t+3]]}function Ne(r,t,i,l){for(;t<i;){const h=t+i>>1;r[h]<l?t=h+1:i=h}return t}function et(r,t,i,l){for(;t<i;){const h=t+i>>1;r[h]<=l?t=h+1:i=h}return t}function ut(){return wn==null&&(wn=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),wn}const _t={now:()=>Mn!==void 0?Mn:performance.now(),setNow(r){Mn=r},restoreNow(){Mn=void 0},frame(r){const t=requestAnimationFrame(r);return{cancel:()=>cancelAnimationFrame(t)}},getImageData(r,t=0){const{width:i,height:l}=r;Nn||(Nn=document.createElement("canvas"));const h=Nn.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return(i>Nn.width||l>Nn.height)&&(Nn.width=i,Nn.height=l),h.clearRect(-t,-t,i+2*t,l+2*t),h.drawImage(r,0,0,i,l),h.getImageData(-t,-t,i+2*t,l+2*t)},resolveURL:r=>(ei||(ei=document.createElement("a")),ei.href=r,ei.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(bi==null&&(bi=window.matchMedia("(prefers-reduced-motion: reduce)")),bi.matches)},hasCanvasFingerprintNoise(){if(ti!==void 0)return ti;if(!ut())return ti=!1,!1;const r=new OffscreenCanvas(85,1),t=r.getContext("2d",{willReadFrequently:!0});let i=0;for(let h=0;h<r.width;++h)t.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,t.fillRect(h,0,1,1);const l=t.getImageData(0,0,r.width,r.height);i=0;for(let h=0;h<l.data.length;++h)if(h%4!=3&&i++!==l.data[h])return ti=!0,!0;return ti=!1,!1}},$t="mapbox-tiles";let dt=500,kt=50,Vt,Wt;function br(){try{return caches}catch{}}function Hr(){const r=br();r&&!Vt&&(Vt=r.open($t))}function Nr(r){const t=r.indexOf("?");if(t<0)return r;const i=["language","worldview"],l=new URLSearchParams,h=new URLSearchParams(r.slice(t));for(const d of i){const g=h.get(d);g&&l.set(d,g)}return`${r.slice(0,t)}?${l.toString()}`}function tn(r,t){const i=r.indexOf("?");if(i<0)return`${r}?${new URLSearchParams(t).toString()}`;const l=new URLSearchParams(r.slice(i));for(const h in t)l.set(h,t[h]);return`${r.slice(0,i)}?${l.toString()}`}let ln=1/0;const Xr={supported:!1,testSupport:function(r){!fi&&kn&&(In?Mi(r):dn=r)}};let dn,kn,fi=!1,In=!1;const Li=typeof self<"u"?self:{};function Mi(r){const t=r.createTexture();r.bindTexture(r.TEXTURE_2D,t);try{if(r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,kn),r.isContextLost())return;Xr.supported=!0}catch{}r.deleteTexture(t),fi=!0}Li.document&&(kn=Li.document.createElement("img"),kn.onload=function(){dn&&Mi(dn),dn=null,In=!0},kn.onerror=function(){fi=!0,dn=null},kn.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Xi={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Xi);class Hn extends Error{constructor(t,i,l){i===401&&B(l)&&(t+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(t),this.status=i,this.url=l}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Wn=En()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,pt=function(r,t){if(!(/^file:/.test(i=r.url)||/^file:/.test(Wn())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(l,h){const d=new AbortController,g=new Request(l.url,{method:l.method||"GET",body:l.body,credentials:l.credentials,headers:l.headers,referrer:Wn(),referrerPolicy:l.referrerPolicy,signal:d.signal});let y=!1,b=!1;const E=(A=g.url).indexOf("sku=")>0&&B(A);var A;l.type==="json"&&g.headers.set("Accept","application/json");const M=(O,z,j)=>{if(b)return;if(O&&O.message!=="SecurityError"&&Tr(O.toString()),z&&j)return P(z);const q=Date.now();fetch(g).then(Q=>{if(Q.ok){const oe=E?Q.clone():null;return P(Q,oe,q)}return h(new Hn(Q.statusText,Q.status,l.url))}).catch(Q=>{Q.name!=="AbortError"&&h(new Error(`${Q.message} ${l.url}`))})},P=(O,z,j)=>{(l.type==="arrayBuffer"?O.arrayBuffer():l.type==="json"?O.json():O.text()).then(q=>{b||(z&&j&&function(Q,oe,pe){if(Hr(),!Vt)return;const de=Xn(oe.headers.get("Cache-Control")||"");if(de["no-store"])return;const Ce={status:oe.status,statusText:oe.statusText,headers:new Headers};oe.headers.forEach((je,Ze)=>Ce.headers.set(Ze,je)),de["max-age"]&&Ce.headers.set("Expires",new Date(pe+1e3*de["max-age"]).toUTCString());const Ee=Ce.headers.get("Expires");if(!Ee||new Date(Ee).getTime()-pe<42e4)return;let Le=Nr(Q.url);if(oe.status===206){const je=Q.headers.get("Range");if(!je)return;Ce.status=200,Le=tn(Le,{range:je})}(function(je,Ze){if(Wt===void 0)try{new Response(new ReadableStream),Wt=!0}catch{Wt=!1}Wt?Ze(je.body):je.blob().then(Ze)})(oe,je=>{const Ze=new Response(je,Ce);Hr(),Vt&&Vt.then(it=>it.put(Le,Ze)).catch(it=>Tr(it.message))})}(g,z,j),y=!0,h(null,q,O.headers.get("Cache-Control"),O.headers.get("Expires")))}).catch(q=>{b||h(new Error(q.message))})};return E?function(O,z){if(Hr(),!Vt)return z(null);Vt.then(j=>{let q=Nr(O.url);const Q=O.headers.get("Range");Q&&(q=tn(q,{range:Q})),j.match(q).then(oe=>{const pe=function(de){if(!de)return!1;const Ce=new Date(de.headers.get("Expires")||0),Ee=Xn(de.headers.get("Cache-Control")||"");return Ce>Date.now()&&!Ee["no-cache"]}(oe);j.delete(q),pe&&j.put(q,oe.clone()),z(null,oe,pe)}).catch(z)}).catch(z)}(g,M):M(null,null),{cancel:()=>{b=!0,y||d.abort()}}}(r,t);if(En()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",r,t,void 0,!0)}var i;return function(l,h){const d=new XMLHttpRequest;d.open(l.method||"GET",l.url,!0),l.type==="arrayBuffer"&&(d.responseType="arraybuffer");for(const g in l.headers)d.setRequestHeader(g,l.headers[g]);return l.type==="json"&&(d.responseType="text",d.setRequestHeader("Accept","application/json")),d.withCredentials=l.credentials==="include",d.onerror=()=>{h(new Error(d.statusText))},d.onload=()=>{if((d.status>=200&&d.status<300||d.status===0)&&d.response!==null){let g=d.response;if(l.type==="json")try{g=JSON.parse(d.response)}catch(y){return h(y)}h(null,g,d.getResponseHeader("Cache-Control"),d.getResponseHeader("Expires"))}else h(new Hn(d.statusText,d.status,l.url))},d.send(l.body),{cancel:()=>d.abort()}}(r,t)},xt=function(r,t){return pt(Se(r,{type:"arrayBuffer"}),t)};function Ft(r){const t=document.createElement("a");return t.href=r,t.protocol===location.protocol&&t.host===location.host}const re="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let fe,se;fe=[],se=0;const he=function(r,t){if(Xr.supported&&(r.headers||(r.headers={}),r.headers.accept="image/webp,*/*"),se>=F.MAX_PARALLEL_IMAGE_REQUESTS){const d={requestParameters:r,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return fe.push(d),d}se++;let i=!1;const l=()=>{if(!i)for(i=!0,se--;fe.length&&se<F.MAX_PARALLEL_IMAGE_REQUESTS;){const d=fe.shift(),{requestParameters:g,callback:y,cancelled:b}=d;b||(d.cancel=he(g,y).cancel)}},h=xt(r,(d,g,y,b)=>{l(),d?t(d):g&&(self.createImageBitmap?function(E,A){const M=new Blob([new Uint8Array(E)],{type:"image/png"});createImageBitmap(M).then(P=>{A(null,P)}).catch(P=>{A(new Error(`Could not load image because of ${P.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(g,(E,A)=>t(E,A,y,b)):function(E,A){const M=new Image;M.onload=()=>{A(null,M),URL.revokeObjectURL(M.src),M.onload=null,requestAnimationFrame(()=>{M.src=re})},M.onerror=()=>A(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const P=new Blob([new Uint8Array(E)],{type:"image/png"});M.src=E.byteLength?URL.createObjectURL(P):re}(g,(E,A)=>t(E,A,y,b)))});return{cancel:()=>{h.cancel(),l()}}},ge="01",be="NO_ACCESS_TOKEN",ze=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ce(r){const t=r.match(ze);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function Oe(r){const t=r.params.length?`?${r.params.join("&")}`:"";return`${r.protocol}://${r.authority}${r.path}${t}`}const Me="mapbox.eventData";function Ke(r){if(!r)return null;const t=r.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(decodeURIComponent(atob(t[1]).split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class At{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const i=Ke(F.ACCESS_TOKEN);let l="";return l=i&&i.u?btoa(encodeURIComponent(i.u).replace(/%([0-9A-F]{2})/g,(h,d)=>String.fromCharCode(+("0x"+d)))):F.ACCESS_TOKEN||"",t?`${Me}.${t}:${l}`:`${Me}:${l}`}fetchEventData(){const t=le("localStorage"),i=this.getStorageKey(),l=this.getStorageKey("uuid");if(t)try{const h=localStorage.getItem(i);h&&(this.eventData=JSON.parse(h));const d=localStorage.getItem(l);d&&(this.anonId=d)}catch{Tr("Unable to read from LocalStorage")}}saveEventData(){const t=le("localStorage"),i=this.getStorageKey(),l=this.getStorageKey("uuid"),h=this.anonId;if(t&&h)try{localStorage.setItem(l,h),Object.keys(this.eventData).length>=1&&localStorage.setItem(i,JSON.stringify(this.eventData))}catch{Tr("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,i,l,h){if(!F.EVENTS_URL)return;const d=ce(F.EVENTS_URL);d.params.push(`access_token=${h||F.ACCESS_TOKEN||""}`);const g={event:this.type,created:new Date(t).toISOString()},y=i?Se(g,i):g,b={url:Oe(d),headers:{"Content-Type":"text/plain"},body:JSON.stringify([y])};this.pendingRequest=function(E,A){return pt(Se(E,{method:"POST"}),A)}(b,E=>{this.pendingRequest=null,l(E),this.saveEventData(),this.processRequests(h)})}queueRequest(t,i){this.queue.push(t),this.processRequests(i)}}const Rt=new class extends At{constructor(r){super("appUserTurnstile"),this._customAccessToken=r}postTurnstileEvent(r,t){F.EVENTS_URL&&F.ACCESS_TOKEN&&Array.isArray(r)&&r.some(i=>V(i)||B(i))&&this.queueRequest(Date.now(),t)}processRequests(r){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=Ke(F.ACCESS_TOKEN),i=t?t.u:F.ACCESS_TOKEN;let l=i!==this.eventData.tokenU;Jt(this.anonId)||(this.anonId=Xe(),l=!0);const h=this.queue.shift();if(this.eventData.lastSuccess){const d=new Date(this.eventData.lastSuccess),g=new Date(h),y=(h-this.eventData.lastSuccess)/864e5;l=l||y>=1||y<-1||d.getDate()!==g.getDate()}else l=!0;l?this.postEvent(h,{sdkIdentifier:"mapbox-gl-js",sdkVersion:k,skuId:ge,"enabled.telemetry":!1,userId:this.anonId},d=>{d||(this.eventData.lastSuccess=h,this.eventData.tokenU=i)},r):this.processRequests()}},er=Rt.postTurnstileEvent.bind(Rt),Ht=new class extends At{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(r,t,i,l){this.skuToken=t,this.errorCb=l,F.EVENTS_URL&&(i||F.ACCESS_TOKEN?this.queueRequest({id:r,timestamp:Date.now()},i):this.errorCb(new Error(be)))}processRequests(r){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:i}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),Jt(this.anonId)||(this.anonId=Xe()),this.postEvent(i,{sdkIdentifier:"mapbox-gl-js",sdkVersion:k,skuId:ge,skuToken:this.skuToken,userId:this.anonId},l=>{l?this.errorCb(l):t&&(this.success[t]=!0)},r))}remove(){this.errorCb=null}},Nt=Ht.postMapLoadEvent.bind(Ht),yr=new class extends At{constructor(){super("gljs.performance")}postPerformanceEvent(r,t){F.EVENTS_URL&&(r||F.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},r)}processRequests(r){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,performanceData:i}=this.queue.shift(),l=function(h){const d=performance.getEntriesByType("resource"),g=performance.getEntriesByType("mark"),y=function(O){const z={};if(O){for(const j in O)if(j!=="other")for(const q of O[j]){const Q=`${j}ResolveRangeMin`,oe=`${j}ResolveRangeMax`,pe=`${j}RequestCount`,de=`${j}RequestCachedCount`;z[Q]=Math.min(z[Q]||1/0,q.startTime),z[oe]=Math.max(z[oe]||-1/0,q.responseEnd);const Ce=Ee=>{z[Ee]===void 0&&(z[Ee]=0),++z[Ee]};q.transferSize!==void 0&&q.transferSize===0&&Ce(de),Ce(pe)}}return z}(function(O,z){const j={};if(O)for(const q of O){const Q=z(q);j[Q]===void 0&&(j[Q]=[]),j[Q].push(q)}return j}(d,Y)),b=window.devicePixelRatio,E=navigator.connection||navigator.mozConnection||navigator.webkitConnection,A=E?E.effectiveType:void 0,M={counters:[],metadata:[],attributes:[]},P=(O,z,j)=>{j!=null&&O.push({name:z,value:j.toString()})};for(const O in y)P(M.counters,O,y[O]);if(h.interactionRange[0]!==1/0&&h.interactionRange[1]!==-1/0&&(P(M.counters,"interactionRangeMin",h.interactionRange[0]),P(M.counters,"interactionRangeMax",h.interactionRange[1])),g)for(const O of Object.keys(X)){const z=X[O],j=g.find(q=>q.name===z);j&&P(M.counters,z,j.startTime)}return P(M.counters,"visibilityHidden",h.visibilityHidden),P(M.attributes,"style",function(O){if(O)for(const z of O){const j=z.name.split("?")[0];if(J(j)){const q=j.split("/").slice(-2);if(q.length===2)return`mapbox://styles/${q[0]}/${q[1]}`}}}(d)),P(M.attributes,"terrainEnabled",h.terrainEnabled?"true":"false"),P(M.attributes,"fogEnabled",h.fogEnabled?"true":"false"),P(M.attributes,"projection",h.projection),P(M.attributes,"zoom",h.zoom),P(M.metadata,"devicePixelRatio",b),P(M.metadata,"connectionEffectiveType",A),P(M.metadata,"navigatorUserAgent",navigator.userAgent),P(M.metadata,"screenWidth",window.screen.width),P(M.metadata,"screenHeight",window.screen.height),P(M.metadata,"windowWidth",window.innerWidth),P(M.metadata,"windowHeight",window.innerHeight),P(M.metadata,"mapWidth",h.width/b),P(M.metadata,"mapHeight",h.height/b),P(M.metadata,"webglRenderer",h.renderer),P(M.metadata,"webglVendor",h.vendor),P(M.metadata,"sdkVersion",k),P(M.metadata,"sdkIdentifier","mapbox-gl-js"),M}(i);for(const h of l.metadata);for(const h of l.counters);for(const h of l.attributes);this.postEvent(t,l,()=>{},r)}},An=yr.postPerformanceEvent.bind(yr),cn=new class extends At{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(r,t,i,l){if(!F.API_URL||!F.SESSION_PATH)return;const h=ce(F.API_URL+F.SESSION_PATH);h.params.push(`sku=${t||""}`),h.params.push(`access_token=${l||F.ACCESS_TOKEN||""}`);const d={url:Oe(h),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(g,y){return pt(Se(g,{method:"GET"}),y)}(d,g=>{this.pendingRequest=null,i(g),this.saveEventData(),this.processRequests(l)})}getSessionAPI(r,t,i,l){this.skuToken=t,this.errorCb=l,F.SESSION_PATH&&F.API_URL&&(i||F.ACCESS_TOKEN?this.queueRequest({id:r,timestamp:Date.now()},i):this.errorCb(new Error(be)))}processRequests(r){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:i}=this.queue.shift();t&&this.success[t]||this.getSession(i,this.skuToken,l=>{l?this.errorCb(l):t&&(this.success[t]=!0)},r)}remove(){this.errorCb=null}},Ti=cn.getSessionAPI.bind(cn),Ma=new Set;function cs(r,t,i){i[r]&&i[r].indexOf(t)!==-1||(i[r]=i[r]||[],i[r].push(t))}function yo(r,t,i){if(i&&i[r]){const l=i[r].indexOf(t);l!==-1&&i[r].splice(l,1)}}class xa{constructor(t,i={}){Se(this,i),this.type=t}}class Nl extends xa{constructor(t,i={}){super("error",Se({error:t},i))}}class ha{on(t,i){return this._listeners=this._listeners||{},cs(t,i,this._listeners),this}off(t,i){return yo(t,i,this._listeners),yo(t,i,this._oneTimeListeners),this}once(t,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},cs(t,i,this._oneTimeListeners),this):new Promise(l=>this.once(t,l))}fire(t,i){typeof t=="string"&&(t=new xa(t,i||{}));const l=t.type;if(this.listens(l)){t.target=this;const h=this._listeners&&this._listeners[l]?this._listeners[l].slice():[];for(const y of h)y.call(this,t);const d=this._oneTimeListeners&&this._oneTimeListeners[l]?this._oneTimeListeners[l].slice():[];for(const y of d)yo(l,y,this._oneTimeListeners),y.call(this,t);const g=this._eventedParent;g&&(Se(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),g.fire(t))}else t instanceof Nl&&console.error(t.error);return this}listens(t){return!!(this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t))}setEventedParent(t,i){return this._eventedParent=t,this._eventedParentData=i,this}}o.y=void 0;var a_={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function vf(r){return(r=Math.round(r))<0?0:r>255?255:r}function Tp(r){return vf(r[r.length-1]==="%"?parseFloat(r)/100*255:parseInt(r))}function wf(r){return(t=r[r.length-1]==="%"?parseFloat(r)/100:parseFloat(r))<0?0:t>1?1:t;var t}function Ep(r,t,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?r+(t-r)*i*6:2*i<1?t:3*i<2?r+(t-r)*(2/3-i)*6:r}try{o.y={}.parseCSSColor=function(r){var t,i=r.replace(/ /g,"").toLowerCase();if(i in a_)return a_[i].slice();if(i[0]==="#")return i.length===4?(t=parseInt(i.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:i.length===7&&(t=parseInt(i.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var l=i.indexOf("("),h=i.indexOf(")");if(l!==-1&&h+1===i.length){var d=i.substr(0,l),g=i.substr(l+1,h-(l+1)).split(","),y=1;switch(d){case"rgba":if(g.length!==4)return null;y=wf(g.pop());case"rgb":return g.length!==3?null:[Tp(g[0]),Tp(g[1]),Tp(g[2]),y];case"hsla":if(g.length!==4)return null;y=wf(g.pop());case"hsl":if(g.length!==3)return null;var b=(parseFloat(g[0])%360+360)%360/360,E=wf(g[1]),A=wf(g[2]),M=A<=.5?A*(E+1):A+E-A*E,P=2*A-M;return[vf(255*Ep(P,M,b+1/3)),vf(255*Ep(P,M,b)),vf(255*Ep(P,M,b-1/3)),y];default:return null}}return null}}catch{}class Ia{constructor(t,i,l,h=1){this.r=t,this.g=i,this.b=l,this.a=h}static parse(t){if(!t)return;if(t instanceof Ia)return t;if(typeof t!="string")return;const i=o.y(t);return i?new Ia(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toString(){const[t,i,l,h]=this.toArray();return`rgba(${Math.round(t)},${Math.round(i)},${Math.round(l)},${h})`}toArray(){const{r:t,g:i,b:l,a:h}=this;return h===0?[0,0,0,0]:[255*t/h,255*i/h,255*l/h,h]}toArray01(){const{r:t,g:i,b:l,a:h}=this;return h===0?[0,0,0,0]:[t/h,i/h,l/h,h]}toArray01Scaled(t){const{r:i,g:l,b:h,a:d}=this;return d===0?[0,0,0]:[i/d*t,l/d*t,h/d*t]}toArray01PremultipliedAlpha(){const{r:t,g:i,b:l,a:h}=this;return[t,i,l,h]}toArray01Linear(){const{r:t,g:i,b:l,a:h}=this;return h===0?[0,0,0,0]:[Math.pow(t/h,2.2),Math.pow(i/h,2.2),Math.pow(l/h,2.2),h]}}Ia.black=new Ia(0,0,0,1),Ia.white=new Ia(1,1,1,1),Ia.transparent=new Ia(0,0,0,0),Ia.red=new Ia(1,0,0,1),Ia.blue=new Ia(0,0,1,1);var _i=Ia;function Kr(r,t,i){return r*(1-i)+t*i}function s_(r,t,i){return r.map((l,h)=>Kr(l,t[h],i))}var bf=Object.freeze({__proto__:null,array:s_,color:function(r,t,i){return new _i(Kr(r.r,t.r,i),Kr(r.g,t.g,i),Kr(r.b,t.b,i),Kr(r.a,t.a,i))},number:Kr});function Sp(r,...t){for(const i of t)for(const l in i)r[l]=i[l];return r}class xv extends Error{constructor(t,i){super(i),this.message=i,this.key=t}}var Ks=xv;class Ap{constructor(t,i=[]){this.parent=t,this.bindings={};for(const[l,h]of i)this.bindings[l]=h}concat(t){return new Ap(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}var yv=Ap;const Cc={kind:"null"},tr={kind:"number"},gn={kind:"string"},_n={kind:"boolean"},us={kind:"color"},kc={kind:"object"},nn={kind:"value"},Tf={kind:"collator"},Mc={kind:"formatted"},Wu={kind:"resolvedImage"};function Pa(r,t){return{kind:"array",itemType:r,N:t}}function pi(r){if(r.kind==="array"){const t=pi(r.itemType);return typeof r.N=="number"?`array<${t}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${t}>`}return r.kind}const _r=[Cc,tr,gn,_n,us,Mc,kc,Pa(nn),Wu];function zl(r,t){if(t.kind==="error")return null;if(r.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!zl(r.itemType,t.itemType))&&(typeof r.N!="number"||r.N===t.N))return null}else{if(r.kind===t.kind)return null;if(r.kind==="value"){for(const i of _r)if(!zl(i,t))return null}}return`Expected ${pi(r)} but found ${pi(t)} instead.`}function Cr(r,t){return t.some(i=>i.kind===r.kind)}function Qo(r,t){return t.some(i=>i==="null"?r===null:i==="array"?Array.isArray(r):i==="object"?r&&!Array.isArray(r)&&typeof r=="object":i===typeof r)}class jr{constructor(t,i,l){this.sensitivity=t?i?"variant":"case":i?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,i){return this.collator.compare(t,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Ic{constructor(t,i,l,h,d){this.text=t.normalize?t.normalize():t,this.image=i,this.scale=l,this.fontStack=h,this.textColor=d}}class Yi{constructor(t){this.sections=t}static fromString(t){return new Yi([new Ic(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.namePrimary.length!==0)}static factory(t){return t instanceof Yi?t:Yi.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}serialize(){const t=["format"];for(const i of this.sections){if(i.image){t.push(["image",i.image.namePrimary]);continue}t.push(i.text);const l={};i.fontStack&&(l["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(l["font-scale"]=i.scale),i.textColor&&(l["text-color"]=["rgba"].concat(i.textColor.toArray())),t.push(l)}return t}}class xr{constructor(t){this.namePrimary=t.namePrimary,t.nameSecondary&&(this.nameSecondary=t.nameSecondary),this.available=t.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(t,i){return t?new xr({namePrimary:t,nameSecondary:i,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function o_(r,t,i,l){return typeof r=="number"&&r>=0&&r<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof i=="number"&&i>=0&&i<=255?l===void 0||typeof l=="number"&&l>=0&&l<=1?null:`Invalid rgba value [${[r,t,i,l].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof l=="number"?[r,t,i,l]:[r,t,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Bl(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof _i||r instanceof jr||r instanceof Yi||r instanceof xr)return!0;if(Array.isArray(r)){for(const t of r)if(!Bl(t))return!1;return!0}if(typeof r=="object"){for(const t in r)if(!Bl(r[t]))return!1;return!0}return!1}function Ei(r){if(r===null)return Cc;if(typeof r=="string")return gn;if(typeof r=="boolean")return _n;if(typeof r=="number")return tr;if(r instanceof _i)return us;if(r instanceof jr)return Tf;if(r instanceof Yi)return Mc;if(r instanceof xr)return Wu;if(Array.isArray(r)){const t=r.length;let i;for(const l of r){const h=Ei(l);if(i){if(i===h)continue;i=nn;break}i=h}return Pa(i||nn,t)}return kc}function hs(r){const t=typeof r;return r===null?"":t==="string"||t==="number"||t==="boolean"?String(r):r instanceof _i||r instanceof Yi||r instanceof xr?r.toString():JSON.stringify(r)}class el{constructor(t,i){this.type=t,this.value=i}static parse(t,i){if(t.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Bl(t[1]))return i.error("invalid value");const l=t[1];let h=Ei(l);const d=i.expectedType;return h.kind!=="array"||h.N!==0||!d||d.kind!=="array"||typeof d.N=="number"&&d.N!==0||(h=d),new el(h,l)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof _i?["rgba"].concat(this.value.toArray()):this.value instanceof Yi?this.value.serialize():this.value}}var vo=el,Si=class{constructor(r){this.name="ExpressionEvaluationError",this.message=r}toJSON(){return this.message}};const Cp={string:gn,number:tr,boolean:_n,object:kc};class kp{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");let l,h=1;const d=t[0];if(d==="array"){let y,b;if(t.length>2){const E=t[1];if(typeof E!="string"||!(E in Cp)||E==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);y=Cp[E],h++}else y=nn;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return i.error('The length argument to "array" must be a positive integer literal',2);b=t[2],h++}l=Pa(y,b)}else l=Cp[d];const g=[];for(;h<t.length;h++){const y=i.parse(t[h],h,nn);if(!y)return null;g.push(y)}return new kp(l,g)}evaluate(t){for(let i=0;i<this.args.length;i++){const l=this.args[i].evaluate(t);if(!zl(this.type,Ei(l)))return l;if(i===this.args.length-1)throw new Si(`Expected value to be of type ${pi(this.type)}, but found ${pi(Ei(l))} instead.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=this.type,i=[t.kind];if(t.kind==="array"){const l=t.itemType;if(l.kind==="string"||l.kind==="number"||l.kind==="boolean"){i.push(l.kind);const h=t.N;(typeof h=="number"||this.args.length>1)&&i.push(h)}}return i.concat(this.args.map(l=>l.serialize()))}}var wo=kp;class Pc{constructor(t){this.type=Mc,this.sections=t}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");const l=t[1];if(!Array.isArray(l)&&typeof l=="object")return i.error("First argument must be an image or text section.");const h=[];let d=!1;for(let g=1;g<=t.length-1;++g){const y=t[g];if(d&&typeof y=="object"&&!Array.isArray(y)){d=!1;let b=null;if(y["font-scale"]&&(b=i.parse(y["font-scale"],1,tr),!b))return null;let E=null;if(y["text-font"]&&(E=i.parse(y["text-font"],1,Pa(gn)),!E))return null;let A=null;if(y["text-color"]&&(A=i.parse(y["text-color"],1,us),!A))return null;const M=h[h.length-1];M.scale=b,M.font=E,M.textColor=A}else{const b=i.parse(t[g],1,nn);if(!b)return null;const E=b.type.kind;if(E!=="string"&&E!=="value"&&E!=="null"&&E!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");d=!0,h.push({content:b,scale:null,font:null,textColor:null})}}return new Pc(h)}evaluate(t){return new Yi(this.sections.map(i=>{const l=i.content.evaluate(t);return Ei(l)===Wu?new Ic("",l,null,null,null):new Ic(hs(l),null,i.scale?i.scale.evaluate(t):null,i.font?i.font.evaluate(t).join(","):null,i.textColor?i.textColor.evaluate(t):null)}))}eachChild(t){for(const i of this.sections)t(i.content),i.scale&&t(i.scale),i.font&&t(i.font),i.textColor&&t(i.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const i of this.sections){t.push(i.content.serialize());const l={};i.scale&&(l["font-scale"]=i.scale.serialize()),i.font&&(l["text-font"]=i.font.serialize()),i.textColor&&(l["text-color"]=i.textColor.serialize()),t.push(l)}return t}}class Ul{constructor(t,i){this.type=Wu,this.inputPrimary=t,this.inputSecondary=i}static parse(t,i){if(t.length<2)return i.error("Expected two or more arguments.");const l=i.parse(t[1],1,gn);if(!l)return i.error("No image name provided.");if(t.length===2)return new Ul(l);const h=i.parse(t[2],1,gn);return h?new Ul(l,h):i.error("Secondary image variant is not a string.")}evaluate(t){const i=xr.fromString(this.inputPrimary.evaluate(t),this.inputSecondary?this.inputSecondary.evaluate(t):void 0);return i&&t.availableImages&&(i.available=t.availableImages.indexOf(i.namePrimary)>-1,i.nameSecondary&&i.available&&t.availableImages&&(i.available=t.availableImages.indexOf(i.nameSecondary)>-1)),i}eachChild(t){t(this.inputPrimary),this.inputSecondary&&t(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function Rc(r){return r instanceof Number?"number":r instanceof String?"string":r instanceof Boolean?"boolean":Array.isArray(r)?"array":r===null?"null":typeof r}const Ss={"to-boolean":_n,"to-color":us,"to-number":tr,"to-string":gn};class Ef{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");const l=t[0],h=[];let d=Cc;if(l==="to-array"){if(!Array.isArray(t[1]))return null;const g=t[1].length;if(i.expectedType){if(i.expectedType.kind!=="array")return i.error(`Expected ${i.expectedType.kind} but found array.`);d=Pa(i.expectedType.itemType,g)}else{if(!(g>0&&Bl(t[1][0])))return null;d=Pa(Ei(t[1][0]),g)}for(let y=0;y<g;y++){const b=t[1][y];let E;if(Rc(b)==="array")E=i.parse(b,void 0,d.itemType);else{const A=Rc(b);if(A!==d.itemType.kind)return i.error(`Expected ${d.itemType.kind} but found ${A}.`);E=i.registry.literal.parse(["literal",b===void 0?null:b],i)}if(!E)return null;h.push(E)}}else{if((l==="to-boolean"||l==="to-string")&&t.length!==2)return i.error("Expected one argument.");d=Ss[l];for(let g=1;g<t.length;g++){const y=i.parse(t[g],g,nn);if(!y)return null;h.push(y)}}return new Ef(d,h)}evaluate(t){if(this.type.kind==="boolean")return!!this.args[0].evaluate(t);if(this.type.kind==="color"){let i,l;for(const h of this.args){if(i=h.evaluate(t),l=null,i instanceof _i)return i;if(typeof i=="string"){const d=t.parseColor(i);if(d)return d}else if(Array.isArray(i)&&(l=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:o_(i[0],i[1],i[2],i[3]),!l))return new _i(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new Si(l||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const l of this.args){if(i=l.evaluate(t),i===null)return 0;const h=Number(i);if(!isNaN(h))return h}throw new Si(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?Yi.fromString(hs(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?xr.fromString(hs(this.args[0].evaluate(t))):this.type.kind==="array"?this.args.map(i=>i.evaluate(t)):hs(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Pc([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Ul(this.args[0]).serialize();const t=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(i=>{t.push(i.serialize())}),t}}var bo=Ef;const qu=["Unknown","Point","LineString","Polygon"];var l_=class{constructor(r,t){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=r,this.options=t}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?qu[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(r){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const r=this.featureDistanceData.center,t=this.featureDistanceData.scale,{x:i,y:l}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(i*t-r[0])+this.featureDistanceData.bearing[1]*(l*t-r[1])}return 0}parseColor(r){let t=this._parseColorCache[r];return t||(t=this._parseColorCache[r]=_i.parse(r)),t}getConfig(r){return this.options?this.options.get(r):null}};class Vl{constructor(t,i,l,h,d){this.name=t,this.type=i,this._evaluate=l,this.args=h,this._overloadIndex=d}evaluate(t){if(!this._evaluate){const i=Vl.definitions[this.name];this._evaluate=Array.isArray(i)?i[2]:i.overloads[this._overloadIndex][1]}return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(t=>t.serialize()))}static parse(t,i){const l=t[0],h=Vl.definitions[l];if(!h)return i.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0);const d=Array.isArray(h)?h[0]:h.type,g=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,y=[];let b=null,E=-1;for(const[A,M]of g){if(Array.isArray(A)&&A.length!==t.length-1)continue;y.push(A),E++,b=new m_(i.registry,i.path,null,i.scope,void 0,i._scope,i.options);const P=[];let O=!1;for(let z=1;z<t.length;z++){const j=t[z],q=Array.isArray(A)?A[z-1]:A.type,Q=b.parse(j,1+P.length,q);if(!Q){O=!0;break}P.push(Q)}if(!O)if(Array.isArray(A)&&A.length!==P.length)b.error(`Expected ${A.length} arguments, but found ${P.length} instead.`);else{for(let z=0;z<P.length;z++){const j=Array.isArray(A)?A[z]:A.type,q=P[z];b.concat(z+1).checkSubtype(j,q.type)}if(b.errors.length===0)return new Vl(l,d,M,P,E)}}if(y.length===1)i.errors.push(...b.errors);else{const A=(y.length?y:g.map(([P])=>P)).map(c_).join(" | "),M=[];for(let P=1;P<t.length;P++){const O=i.parse(t[P],1+M.length);if(!O)return null;M.push(pi(O.type))}i.error(`Expected arguments of type ${A}, but found (${M.join(", ")}) instead.`)}return null}static register(t,i){Vl.definitions=i;for(const l in i)t[l]=Vl}}function c_(r){return Array.isArray(r)?`(${r.map(pi).join(", ")})`:`(${pi(r.type)}...)`}var Qr=Vl;class Zu{constructor(t,i,l){this.type=Tf,this.locale=l,this.caseSensitive=t,this.diacriticSensitive=i}static parse(t,i){if(t.length!==2)return i.error("Expected one argument.");const l=t[1];if(typeof l!="object"||Array.isArray(l))return i.error("Collator options argument must be an object.");const h=i.parse(l["case-sensitive"]!==void 0&&l["case-sensitive"],1,_n);if(!h)return null;const d=i.parse(l["diacritic-sensitive"]!==void 0&&l["diacritic-sensitive"],1,_n);if(!d)return null;let g=null;return l.locale&&(g=i.parse(l.locale,1,gn),!g)?null:new Zu(h,d,g)}evaluate(t){return new jr(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}var Mp={exports:{}};Mp.exports=function(){function r(l,h,d,g,y){for(;g>d;){if(g-d>600){var b=g-d+1,E=h-d+1,A=Math.log(b),M=.5*Math.exp(2*A/3),P=.5*Math.sqrt(A*M*(b-M)/b)*(E-b/2<0?-1:1);r(l,h,Math.max(d,Math.floor(h-E*M/b+P)),Math.min(g,Math.floor(h+(b-E)*M/b+P)),y)}var O=l[h],z=d,j=g;for(t(l,d,h),y(l[g],O)>0&&t(l,d,g);z<j;){for(t(l,z,j),z++,j--;y(l[z],O)<0;)z++;for(;y(l[j],O)>0;)j--}y(l[d],O)===0?t(l,d,j):t(l,++j,g),j<=h&&(d=j+1),h<=j&&(g=j-1)}}function t(l,h,d){var g=l[h];l[h]=l[d],l[d]=g}function i(l,h){return l<h?-1:l>h?1:0}return function(l,h,d,g,y){r(l,h,d||0,g||l.length-1,y||i)}}();var vv=Z(Mp.exports);function wv(r){let t=0;for(let i,l,h=0,d=r.length,g=d-1;h<d;g=h++)i=r[h],l=r[g],t+=(l.x-i.x)*(i.y+l.y);return t}function tl(r,t){r[0]=Math.min(r[0],t[0]),r[1]=Math.min(r[1],t[1]),r[2]=Math.max(r[2],t[0]),r[3]=Math.max(r[3],t[1])}function rl(r,t){return!(r[0]<=t[0]||r[2]>=t[2]||r[1]<=t[1]||r[3]>=t[3])}function Sf(r,t,i){const l=r[0]-t[0],h=r[1]-t[1],d=r[0]-i[0],g=r[1]-i[1];return l*g-d*h==0&&l*d<=0&&h*g<=0}function Dc(r,t,i=!1){let l=!1;for(let y=0,b=t.length;y<b;y++){const E=t[y];for(let A=0,M=E.length,P=M-1;A<M;P=A++){const O=E[P],z=E[A];if(Sf(r,O,z))return i;(d=O)[1]>(h=r)[1]!=(g=z)[1]>h[1]&&h[0]<(g[0]-d[0])*(h[1]-d[1])/(g[1]-d[1])+d[0]&&(l=!l)}}var h,d,g;return l}function Ip(r,t,i,l){const h=l[0]-i[0],d=l[1]-i[1],g=(r[0]-i[0])*d-h*(r[1]-i[1]),y=(t[0]-i[0])*d-h*(t[1]-i[1]);return g>0&&y<0||g<0&&y>0}function To(r,t,i,l){return(h=[l[0]-i[0],l[1]-i[1]])[0]*(d=[t[0]-r[0],t[1]-r[1]])[1]-h[1]*d[0]!=0&&!(!Ip(r,t,i,l)||!Ip(i,l,r,t));var h,d}const nl=8192;function Xu(r,t){const i=(180+r[0])/360,l=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,h=Math.pow(2,t.z);return[Math.round(i*h*nl),Math.round(l*h*nl)]}function Pp(r,t){for(let i=0;i<t.length;i++)if(Dc(r,t[i]))return!0;return!1}function Rp(r,t,i){for(const l of i)for(let h=0,d=l.length,g=d-1;h<d;g=h++)if(To(r,t,l[g],l[h]))return!0;return!1}function fs(r,t){for(let i=0;i<r.length;++i)if(!Dc(r[i],t))return!1;for(let i=0;i<r.length-1;++i)if(Rp(r[i],r[i+1],t))return!1;return!0}function u_(r,t){for(let i=0;i<t.length;i++)if(fs(r,t[i]))return!0;return!1}function Dp(r,t,i){const l=[];for(let h=0;h<r.length;h++){const d=[];for(let g=0;g<r[h].length;g++){const y=Xu(r[h][g],i);tl(t,y),d.push(y)}l.push(d)}return l}function Fp(r,t,i){const l=[];for(let h=0;h<r.length;h++){const d=Dp(r[h],t,i);l.push(d)}return l}function Lp(r,t,i,l){if(r[0]<i[0]||r[0]>i[2]){const h=.5*l;let d=r[0]-i[0]>h?-l:i[0]-r[0]>h?l:0;d===0&&(d=r[0]-i[2]>h?-l:i[2]-r[0]>h?l:0),r[0]+=d}tl(t,r)}function Op(r,t,i,l){const h=Math.pow(2,l.z)*nl,d=[l.x*nl,l.y*nl],g=[];if(!r)return g;for(const y of r)for(const b of y){const E=[b.x+d[0],b.y+d[1]];Lp(E,t,i,h),g.push(E)}return g}function Np(r,t,i,l){const h=Math.pow(2,l.z)*nl,d=[l.x*nl,l.y*nl],g=[];if(!r)return g;for(const b of r){const E=[];for(const A of b){const M=[A.x+d[0],A.y+d[1]];tl(t,M),E.push(M)}g.push(E)}if(t[2]-t[0]<=h/2){(y=t)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(const b of g)for(const E of b)Lp(E,t,i,h)}var y;return g}class Fc{constructor(t,i){this.type=_n,this.geojson=t,this.geometries=i}static parse(t,i){if(t.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Bl(t[1])){const l=t[1];if(l.type==="FeatureCollection")for(let h=0;h<l.features.length;++h){const d=l.features[h].geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new Fc(l,l.features[h].geometry)}else if(l.type==="Feature"){const h=l.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new Fc(l,l.geometry)}else if(l.type==="Polygon"||l.type==="MultiPolygon")return new Fc(l,l)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(i,l){const h=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],g=i.canonicalID();if(!g)return!1;if(l.type==="Polygon"){const y=Dp(l.coordinates,d,g),b=Op(i.geometry(),h,d,g);if(!rl(h,d))return!1;for(const E of b)if(!Dc(E,y))return!1}if(l.type==="MultiPolygon"){const y=Fp(l.coordinates,d,g),b=Op(i.geometry(),h,d,g);if(!rl(h,d))return!1;for(const E of b)if(!Pp(E,y))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(i,l){const h=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],g=i.canonicalID();if(!g)return!1;if(l.type==="Polygon"){const y=Dp(l.coordinates,d,g),b=Np(i.geometry(),h,d,g);if(!rl(h,d))return!1;for(const E of b)if(!fs(E,y))return!1}if(l.type==="MultiPolygon"){const y=Fp(l.coordinates,d,g),b=Np(i.geometry(),h,d,g);if(!rl(h,d))return!1;for(const E of b)if(!u_(E,y))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Af=Fc,Yu={exports:{}};Yu.exports=function(){var r={kilometers:1,miles:.621371192237334,nauticalmiles:.5399568034557235,meters:1e3,metres:1e3,yards:1093.6132983377079,feet:3280.839895013123,inches:39370.078740157485},t=1/298.257223563,i=t*(2-t),l=Math.PI/180,h=function(E,A){if(E===void 0)throw new Error("No latitude given.");if(A&&!r[A])throw new Error("Unknown unit "+A+". Use one of: "+Object.keys(r).join(", "));var M=6378.137*l*(A?r[A]:1),P=Math.cos(E*l),O=1/(1-i*(1-P*P)),z=Math.sqrt(O);this.kx=M*z*P,this.ky=M*z*O*(1-i)},d={units:{configurable:!0}};function g(E,A){return E[0]===A[0]&&E[1]===A[1]}function y(E,A,M){var P=b(A[0]-E[0]);return[E[0]+P*M,E[1]+(A[1]-E[1])*M]}function b(E){for(;E<-180;)E+=360;for(;E>180;)E-=360;return E}return h.fromTile=function(E,A,M){var P=Math.PI*(1-2*(E+.5)/Math.pow(2,A)),O=Math.atan(.5*(Math.exp(P)-Math.exp(-P)))/l;return new h(O,M)},d.units.get=function(){return r},h.prototype.distance=function(E,A){var M=b(E[0]-A[0])*this.kx,P=(E[1]-A[1])*this.ky;return Math.sqrt(M*M+P*P)},h.prototype.bearing=function(E,A){var M=b(A[0]-E[0])*this.kx;return Math.atan2(M,(A[1]-E[1])*this.ky)/l},h.prototype.destination=function(E,A,M){var P=M*l;return this.offset(E,Math.sin(P)*A,Math.cos(P)*A)},h.prototype.offset=function(E,A,M){return[E[0]+A/this.kx,E[1]+M/this.ky]},h.prototype.lineDistance=function(E){for(var A=0,M=0;M<E.length-1;M++)A+=this.distance(E[M],E[M+1]);return A},h.prototype.area=function(E){for(var A=0,M=0;M<E.length;M++)for(var P=E[M],O=0,z=P.length,j=z-1;O<z;j=O++)A+=b(P[O][0]-P[j][0])*(P[O][1]+P[j][1])*(M?-1:1);return Math.abs(A)/2*this.kx*this.ky},h.prototype.along=function(E,A){var M=0;if(A<=0)return E[0];for(var P=0;P<E.length-1;P++){var O=E[P],z=E[P+1],j=this.distance(O,z);if((M+=j)>A)return y(O,z,(A-(M-j))/j)}return E[E.length-1]},h.prototype.pointToSegmentDistance=function(E,A,M){var P=A[0],O=A[1],z=b(M[0]-P)*this.kx,j=(M[1]-O)*this.ky,q=0;return z===0&&j===0||((q=(b(E[0]-P)*this.kx*z+(E[1]-O)*this.ky*j)/(z*z+j*j))>1?(P=M[0],O=M[1]):q>0&&(P+=z/this.kx*q,O+=j/this.ky*q)),z=b(E[0]-P)*this.kx,j=(E[1]-O)*this.ky,Math.sqrt(z*z+j*j)},h.prototype.pointOnLine=function(E,A){for(var M,P,O,z,j=1/0,q=0;q<E.length-1;q++){var Q=E[q][0],oe=E[q][1],pe=b(E[q+1][0]-Q)*this.kx,de=(E[q+1][1]-oe)*this.ky,Ce=0;pe===0&&de===0||((Ce=(b(A[0]-Q)*this.kx*pe+(A[1]-oe)*this.ky*de)/(pe*pe+de*de))>1?(Q=E[q+1][0],oe=E[q+1][1]):Ce>0&&(Q+=pe/this.kx*Ce,oe+=de/this.ky*Ce));var Ee=(pe=b(A[0]-Q)*this.kx)*pe+(de=(A[1]-oe)*this.ky)*de;Ee<j&&(j=Ee,M=Q,P=oe,O=q,z=Ce)}return{point:[M,P],index:O,t:Math.max(0,Math.min(1,z))}},h.prototype.lineSlice=function(E,A,M){var P=this.pointOnLine(M,E),O=this.pointOnLine(M,A);if(P.index>O.index||P.index===O.index&&P.t>O.t){var z=P;P=O,O=z}var j=[P.point],q=P.index+1,Q=O.index;!g(M[q],j[0])&&q<=Q&&j.push(M[q]);for(var oe=q+1;oe<=Q;oe++)j.push(M[oe]);return g(M[Q],O.point)||j.push(O.point),j},h.prototype.lineSliceAlong=function(E,A,M){for(var P=0,O=[],z=0;z<M.length-1;z++){var j=M[z],q=M[z+1],Q=this.distance(j,q);if((P+=Q)>E&&O.length===0&&O.push(y(j,q,(E-(P-Q))/Q)),P>=A)return O.push(y(j,q,(A-(P-Q))/Q)),O;P>E&&O.push(q)}return O},h.prototype.bufferPoint=function(E,A){var M=A/this.ky,P=A/this.kx;return[E[0]-P,E[1]-M,E[0]+P,E[1]+M]},h.prototype.bufferBBox=function(E,A){var M=A/this.ky,P=A/this.kx;return[E[0]-P,E[1]-M,E[2]+P,E[3]+M]},h.prototype.insideBBox=function(E,A){return b(E[0]-A[0])>=0&&b(E[0]-A[2])<=0&&E[1]>=A[1]&&E[1]<=A[3]},Object.defineProperties(h,d),h}();var il=Z(Yu.exports),zp={exports:{}};zp.exports=function(){var r=function(i,l){if(i===void 0&&(i=[]),l===void 0&&(l=t),this.data=i,this.length=this.data.length,this.compare=l,this.length>0)for(var h=(this.length>>1)-1;h>=0;h--)this._down(h)};function t(i,l){return i<l?-1:i>l?1:0}return r.prototype.push=function(i){this.data.push(i),this.length++,this._up(this.length-1)},r.prototype.pop=function(){if(this.length!==0){var i=this.data[0],l=this.data.pop();return this.length--,this.length>0&&(this.data[0]=l,this._down(0)),i}},r.prototype.peek=function(){return this.data[0]},r.prototype._up=function(i){for(var l=this.data,h=this.compare,d=l[i];i>0;){var g=i-1>>1,y=l[g];if(h(d,y)>=0)break;l[i]=y,i=g}l[i]=d},r.prototype._down=function(i){for(var l=this.data,h=this.compare,d=this.length>>1,g=l[i];i<d;){var y=1+(i<<1),b=l[y],E=y+1;if(E<this.length&&h(l[E],b)<0&&(y=E,b=l[E]),h(b,g)>=0)break;l[i]=b,i=y}l[i]=g},r}();var ds=Z(zp.exports),Kt=8192;function Cf(r,t){return t.dist-r.dist}const Bp=100,Ku=50;function Up(r){const t=[1/0,1/0,-1/0,-1/0];if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i]!==r[i])return!1;return!0}function al(r){return r[1]-r[0]+1}function As(r,t){const i=r[1]>=r[0]&&r[1]<t;return i||console.warn("Distance Expression: Index is out of range"),i}function Vp(r,t){if(r[0]>r[1])return[null,null];const i=al(r);if(t){if(i===2)return[r,null];const l=Math.floor(i/2);return[[r[0],r[0]+l],[r[0]+l,r[1]]]}{if(i===1)return[r,null];const l=Math.floor(i/2)-1;return[[r[0],r[0]+l],[r[0]+l+1,r[1]]]}}function $l(r,t){const i=[1/0,1/0,-1/0,-1/0];if(!As(t,r.length))return i;for(let l=t[0];l<=t[1];++l)tl(i,r[l]);return i}function kf(r){const t=[1/0,1/0,-1/0,-1/0];for(let i=0;i<r.length;++i)for(let l=0;l<r[i].length;++l)tl(t,r[i][l]);return t}function jl(r,t,i){if(Up(r)||Up(t))return NaN;let l=0,h=0;return r[2]<t[0]&&(l=t[0]-r[2]),r[0]>t[2]&&(l=r[0]-t[2]),r[1]>t[3]&&(h=r[1]-t[3]),r[3]<t[1]&&(h=t[1]-r[3]),i.distance([0,0],[l,h])}function $p(r){return 360*r-180}function bv(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}function Lc(r,t){const i=Math.pow(2,t.z),l=(r.y/Kt+t.y)/i;return[$p((r.x/Kt+t.x)/i),bv(l)]}function Tv(r,t){const i=[];for(let l=0;l<r.length;++l)i.push(Lc(r[l],t));return i}function h_(r,t,i){const l=i.pointOnLine(t,r).point;return i.distance(r,l)}function f_(r,t,i,l,h){const d=i.slice(l[0],l[1]+1);let g=1/0;for(let y=t[0];y<=t[1];++y)if((g=Math.min(g,h_(r[y],d,h)))===0)return 0;return g}function jp(r,t,i,l,h){const d=Math.min(h.pointToSegmentDistance(r,i,l),h.pointToSegmentDistance(t,i,l)),g=Math.min(h.pointToSegmentDistance(i,r,t),h.pointToSegmentDistance(l,r,t));return Math.min(d,g)}function Ev(r,t,i,l,h){if(!As(t,r.length)||!As(l,i.length))return NaN;let d=1/0;for(let g=t[0];g<t[1];++g)for(let y=l[0];y<l[1];++y){if(To(r[g],r[g+1],i[y],i[y+1]))return 0;d=Math.min(d,jp(r[g],r[g+1],i[y],i[y+1],h))}return d}function Sv(r,t,i,l,h){if(!As(t,r.length)||!As(l,i.length))return NaN;let d=1/0;for(let g=t[0];g<=t[1];++g)for(let y=l[0];y<=l[1];++y)if((d=Math.min(d,h.distance(r[g],i[y])))===0)return d;return d}function Av(r,t,i){if(Dc(r,t,!0))return 0;let l=1/0;for(const h of t){const d=h.length;if(d<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(h[0]!==h[d-1]&&(l=Math.min(l,i.pointToSegmentDistance(r,h[d-1],h[0])))===0||(l=Math.min(l,h_(r,h,i)))===0)return l}return l}function d_(r,t,i,l){if(!As(t,r.length))return NaN;for(let d=t[0];d<=t[1];++d)if(Dc(r[d],i,!0))return 0;let h=1/0;for(let d=t[0];d<t[1];++d)for(const g of i)for(let y=0,b=g.length,E=b-1;y<b;E=y++){if(To(r[d],r[d+1],g[E],g[y]))return 0;h=Math.min(h,jp(r[d],r[d+1],g[E],g[y],l))}return h}function Ju(r,t){for(const i of r)for(let l=0;l<=i.length-1;++l)if(Dc(i[l],t,!0))return!0;return!1}function Cv(r,t,i,l=1/0){const h=kf(r),d=kf(t);if(l!==1/0&&jl(h,d,i)>=l)return l;if(rl(h,d)){if(Ju(r,t))return 0}else if(Ju(t,r))return 0;let g=l;for(const y of r)for(let b=0,E=y.length,A=E-1;b<E;A=b++)for(const M of t)for(let P=0,O=M.length,z=O-1;P<O;z=P++){if(To(y[A],y[b],M[z],M[P]))return 0;g=Math.min(g,jp(y[A],y[b],M[z],M[P],i))}return g}function Mf(r,t,i,l,h,d,g){if(d===null||g===null)return;const y=jl($l(l,d),$l(h,g),i);y<t&&r.push({dist:y,range1:d,range2:g})}function Gp(r,t,i,l,h=1/0){let d=Math.min(l.distance(r[0],i[0][0]),h);if(d===0)return d;const g=new ds([{dist:0,range1:[0,r.length-1],range2:[0,0]}],Cf),y=t?Ku:Bp,b=kf(i);for(;g.length;){const E=g.pop();if(E.dist>=d)continue;const A=E.range1;if(al(A)<=y){if(!As(A,r.length))return NaN;if(t){const M=d_(r,A,i,l);if((d=Math.min(d,M))===0)return d}else for(let M=A[0];M<=A[1];++M){const P=Av(r[M],i,l);if((d=Math.min(d,P))===0)return d}}else{const M=Vp(A,t);if(M[0]!==null){const P=jl($l(r,M[0]),b,l);P<d&&g.push({dist:P,range1:M[0],range2:[0,0]})}if(M[1]!==null){const P=jl($l(r,M[1]),b,l);P<d&&g.push({dist:P,range1:M[1],range2:[0,0]})}}}return d}function p_(r,t,i,l,h,d=1/0){let g=Math.min(d,h.distance(r[0],i[0]));if(g===0)return g;const y=new ds([{dist:0,range1:[0,r.length-1],range2:[0,i.length-1]}],Cf),b=t?Ku:Bp,E=l?Ku:Bp;for(;y.length;){const A=y.pop();if(A.dist>=g)continue;const M=A.range1,P=A.range2;if(al(M)<=b&&al(P)<=E){if(!As(M,r.length)||!As(P,i.length))return NaN;if(t&&l?g=Math.min(g,Ev(r,M,i,P,h)):t||l?t&&!l?g=Math.min(g,f_(i,P,r,M,h)):!t&&l&&(g=Math.min(g,f_(r,M,i,P,h))):g=Math.min(g,Sv(r,M,i,P,h)),g===0)return g}else{const O=Vp(M,t),z=Vp(P,l);Mf(y,g,h,r,i,O[0],z[0]),Mf(y,g,h,r,i,O[0],z[1]),Mf(y,g,h,r,i,O[1],z[0]),Mf(y,g,h,r,i,O[1],z[1])}}return g}function Hp(r,t,i,l,h=1/0){let d=h;const g=$l(r,[0,r.length-1]);for(const y of i)if(!(d!==1/0&&jl(g,$l(y,[0,y.length-1]),l)>=d)&&(d=Math.min(d,p_(r,t,y,!0,l,d)),d===0))return d;return d}function If(r,t,i,l,h=1/0){let d=h;const g=$l(r,[0,r.length-1]);for(const y of i){if(d!==1/0&&jl(g,kf(y),l)>=d)continue;const b=Gp(r,t,y,l,d);if(isNaN(b))return b;if((d=Math.min(d,b))===0)return d}return d}function Wp(r){return r==="Point"||r==="MultiPoint"||r==="LineString"||r==="MultiLineString"||r==="Polygon"||r==="MultiPolygon"}class Gl{constructor(t,i){this.type=tr,this.geojson=t,this.geometries=i}static parse(t,i){if(t.length!==2)return i.error(`'distance' expression requires either one argument, but found ' ${t.length-1} instead.`);if(Bl(t[1])){const l=t[1];if(l.type==="FeatureCollection"){for(let h=0;h<l.features.length;++h)if(Wp(l.features[h].geometry.type))return new Gl(l,l.features[h].geometry)}else if(l.type==="Feature"){if(Wp(l.geometry.type))return new Gl(l,l.geometry)}else if(Wp(l.type))return new Gl(l,l)}return i.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(t){const i=t.geometry(),l=t.canonicalID();if(i!=null&&l!=null){if(t.geometryType()==="Point")return function(h,d,g){const y=[];for(const E of h)for(const A of E)y.push(Lc(A,d));const b=new il(y[0][1],"meters");return g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString"?p_(y,!1,g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",b):g.type==="MultiLineString"?Hp(y,!1,g.coordinates,b):g.type==="Polygon"||g.type==="MultiPolygon"?If(y,!1,g.type==="Polygon"?[g.coordinates]:g.coordinates,b):null}(i,l,this.geometries);if(t.geometryType()==="LineString")return function(h,d,g){const y=[];for(const E of h){const A=[];for(const M of E)A.push(Lc(M,d));y.push(A)}const b=new il(y[0][0][1],"meters");if(g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString")return Hp(g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",y,b);if(g.type==="MultiLineString"){let E=1/0;for(let A=0;A<g.coordinates.length;A++){const M=Hp(g.coordinates[A],!0,y,b,E);if(isNaN(M))return M;if((E=Math.min(E,M))===0)return E}return E}if(g.type==="Polygon"||g.type==="MultiPolygon"){let E=1/0;for(let A=0;A<y.length;A++){const M=If(y[A],!0,g.type==="Polygon"?[g.coordinates]:g.coordinates,b,E);if(isNaN(M))return M;if((E=Math.min(E,M))===0)return E}return E}return null}(i,l,this.geometries);if(t.geometryType()==="Polygon")return function(h,d,g){const y=[];for(const E of function(A,M){const P=A.length;if(P<=1)return[A];const O=[];let z,j;for(let q=0;q<P;q++){const Q=wv(A[q]);Q!==0&&(A[q].area=Math.abs(Q),j===void 0&&(j=Q<0),j===Q<0?(z&&O.push(z),z=[A[q]]):z.push(A[q]))}return z&&O.push(z),O}(h)){const A=[];for(let M=0;M<E.length;++M)A.push(Tv(E[M],d));y.push(A)}const b=new il(y[0][0][0][1],"meters");if(g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString")return If(g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",y,b);if(g.type==="MultiLineString"){let E=1/0;for(let A=0;A<g.coordinates.length;A++){const M=If(g.coordinates[A],!0,y,b,E);if(isNaN(M))return M;if((E=Math.min(E,M))===0)return E}return E}return g.type==="Polygon"||g.type==="MultiPolygon"?function(E,A,M){let P=1/0;for(const O of E)for(const z of A){const j=Cv(O,z,M,P);if(isNaN(j))return j;if((P=Math.min(P,j))===0)return P}return P}(g.type==="Polygon"?[g.coordinates]:g.coordinates,y,b):null}(i,l,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}var Pf=Gl;function Qu(r,t){switch(r){case"string":return hs(t);case"number":return+t;case"boolean":return!!t;case"color":return _i.parse(t);case"formatted":return Yi.fromString(hs(t));case"resolvedImage":return xr.fromString(hs(t))}return t}function qp(r,t,i,l){return l!==void 0&&(r=l*Math.round(r/l)),t!==void 0&&r<t&&(r=t),i!==void 0&&r>i&&(r=i),r}class eh{constructor(t,i,l){this.type=t,this.key=i,this.scope=l}static parse(t,i){let l=i.expectedType;if(l==null&&(l=nn),t.length<2||t.length>3)return i.error("Invalid number of arguments for 'config' expression.");const h=i.parse(t[1],1);if(!(h instanceof vo))return i.error("Key name of 'config' expression must be a string literal.");if(t.length>=3){const d=i.parse(t[2],2);return d instanceof vo?new eh(l,hs(h.value),hs(d.value)):i.error("Scope of 'config' expression must be a string literal.")}return new eh(l,hs(h.value))}evaluate(t){const i=[this.key,this.scope,t.scope].filter(Boolean).join(""),l=t.getConfig(i);if(!l)return null;const{type:h,value:d,values:g,minValue:y,maxValue:b,stepValue:E}=l,A=l.default.evaluate(t);let M=A;if(d){const P=t.scope;t.scope=(P||"").split("").slice(1).join(""),M=d.evaluate(t),t.scope=P}return h&&(M=Qu(h,M)),M===void 0||y===void 0&&b===void 0&&E===void 0||(typeof M=="number"?M=qp(M,y,b,E):Array.isArray(M)&&(M=M.map(P=>typeof P=="number"?qp(P,y,b,E):P))),d!==void 0&&M!==void 0&&g&&!g.includes(M)&&(M=A,h&&(M=Qu(h,M))),(h&&h!==this.type||M!==void 0&&Ei(M)!==this.type)&&(M=Qu(this.type.kind,M)),M}eachChild(){}outputDefined(){return!1}serialize(){const t=["config",this.key];return this.scope&&t.concat(this.key),t}}var Oc=eh;function Nc(r){if(r instanceof Qr&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof Af||r instanceof Pf)return!1;let t=!0;return r.eachChild(i=>{t&&!Nc(i)&&(t=!1)}),t}function th(r){if(r instanceof Qr&&r.name==="feature-state")return!1;let t=!0;return r.eachChild(i=>{t&&!th(i)&&(t=!1)}),t}function rh(r){if(r instanceof Oc)return!1;let t=!0;return r.eachChild(i=>{t&&!rh(i)&&(t=!1)}),t}function Ki(r,t){if(r instanceof Qr&&t.indexOf(r.name)>=0)return!1;let i=!0;return r.eachChild(l=>{i&&!Ki(l,t)&&(i=!1)}),i}class sl{constructor(t,i){this.type=i.type,this.name=t,this.boundExpression=i}static parse(t,i){if(t.length!==2||typeof t[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const l=t[1];return i.scope.has(l)?new sl(l,i.scope.get(l)):i.error(`Unknown variable "${l}". Make sure "${l}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var ya=sl;class Zp{constructor(t,i=[],l,h=new yv,d=[],g,y){this.registry=t,this.path=i,this.key=i.map(b=>`[${b}]`).join(""),this.scope=h,this.errors=d,this.expectedType=l,this._scope=g,this.options=y}parse(t,i,l,h,d={}){return i||l?this.concat(i,l,h)._parse(t,d):this._parse(t,d)}_parse(t,i){function l(h,d,g){return g==="assert"?new wo(d,[h]):g==="coerce"?new bo(d,[h]):h}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=typeof t[0]=="string"?this.registry[t[0]]:void 0;if(h){let d=h.parse(t,this);if(!d)return null;if(this.expectedType){const g=this.expectedType,y=d.type;if(g.kind!=="string"&&g.kind!=="number"&&g.kind!=="boolean"&&g.kind!=="object"&&g.kind!=="array"||y.kind!=="value")if(g.kind!=="color"&&g.kind!=="formatted"&&g.kind!=="resolvedImage"||y.kind!=="value"&&y.kind!=="string"){if(this.checkSubtype(g,y))return null}else d=l(d,g,i.typeAnnotation||"coerce");else d=l(d,g,i.typeAnnotation||"assert")}if(!(d instanceof vo)&&d.type.kind!=="resolvedImage"&&Xp(d)){const g=new l_(this._scope,this.options);try{d=new vo(d.type,d.evaluate(g))}catch(y){return this.error(y.message),null}}return d}return bo.parse(["to-array",t],this)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,i,l){const h=typeof t=="number"?this.path.concat(t):this.path,d=l?this.scope.concat(l):this.scope;return new Zp(this.registry,h,i||null,d,this.errors,this._scope,this.options)}error(t,...i){const l=`${this.key}${i.map(h=>`[${h}]`).join("")}`;this.errors.push(new Ks(l,t))}checkSubtype(t,i){const l=zl(t,i);return l&&this.error(l),l}}var m_=Zp;function Xp(r){if(r instanceof ya)return Xp(r.boundExpression);if(r instanceof Qr&&r.name==="error"||r instanceof Zu||r instanceof Af||r instanceof Pf||r instanceof Oc)return!1;const t=r instanceof bo||r instanceof wo;let i=!0;return r.eachChild(l=>{i=t?i&&Xp(l):i&&l instanceof vo}),!!i&&Nc(r)&&Ki(r,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Hl(r,t){const i=r.length-1;let l,h,d=0,g=i,y=0;for(;d<=g;)if(y=Math.floor((d+g)/2),l=r[y],h=r[y+1],l<=t){if(y===i||t<h)return y;d=y+1}else{if(!(l>t))throw new Si("Input is not a number.");g=y-1}return 0}class Rf{constructor(t,i,l){this.type=t,this.input=i,this.labels=[],this.outputs=[];for(const[h,d]of l)this.labels.push(h),this.outputs.push(d)}static parse(t,i){if(t.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return i.error("Expected an even number of arguments.");const l=i.parse(t[1],1,tr);if(!l)return null;const h=[];let d=null;i.expectedType&&i.expectedType.kind!=="value"&&(d=i.expectedType);for(let g=1;g<t.length;g+=2){const y=g===1?-1/0:t[g],b=t[g+1],E=g,A=g+1;if(typeof y!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(h.length&&h[h.length-1][0]>=y)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',E);const M=i.parse(b,A,d);if(!M)return null;d=d||M.type,h.push([y,M])}return new Rf(d,l,h)}evaluate(t){const i=this.labels,l=this.outputs;if(i.length===1)return l[0].evaluate(t);const h=this.input.evaluate(t);if(h<=i[0])return l[0].evaluate(t);const d=i.length;return h>=i[d-1]?l[d-1].evaluate(t):l[Hl(i,h)].evaluate(t)}eachChild(t){t(this.input);for(const i of this.outputs)t(i)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){const t=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&t.push(this.labels[i]),t.push(this.outputs[i].serialize());return t}}var nh=Rf;const g_=.95047,ol=1.08883,__=4/29,zc=6/29,Yp=3*zc*zc,x_=zc*zc*zc,kv=Math.PI/180,Cs=180/Math.PI;function Df(r){return r>x_?Math.pow(r,1/3):r/Yp+__}function Ff(r){return r>zc?r*r*r:Yp*(r-__)}function Lf(r){return 255*(r<=.0031308?12.92*r:1.055*Math.pow(r,1/2.4)-.055)}function Of(r){return(r/=255)<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function Kp(r){const t=Of(r.r),i=Of(r.g),l=Of(r.b),h=Df((.4124564*t+.3575761*i+.1804375*l)/g_),d=Df((.2126729*t+.7151522*i+.072175*l)/1);return{l:116*d-16,a:500*(h-d),b:200*(d-Df((.0193339*t+.119192*i+.9503041*l)/ol)),alpha:r.a}}function Jp(r){let t=(r.l+16)/116,i=isNaN(r.a)?t:t+r.a/500,l=isNaN(r.b)?t:t-r.b/200;return t=1*Ff(t),i=g_*Ff(i),l=ol*Ff(l),new _i(Lf(3.2404542*i-1.5371385*t-.4985314*l),Lf(-.969266*i+1.8760108*t+.041556*l),Lf(.0556434*i-.2040259*t+1.0572252*l),r.alpha)}function y_(r,t,i){const l=t-r;return r+i*(l>180||l<-180?l-360*Math.round(l/360):l)}const Bc={forward:Kp,reverse:Jp,interpolate:function(r,t,i){return{l:Kr(r.l,t.l,i),a:Kr(r.a,t.a,i),b:Kr(r.b,t.b,i),alpha:Kr(r.alpha,t.alpha,i)}}},Uc={forward:function(r){const{l:t,a:i,b:l}=Kp(r),h=Math.atan2(l,i)*Cs;return{h:h<0?h+360:h,c:Math.sqrt(i*i+l*l),l:t,alpha:r.a}},reverse:function(r){const t=r.h*kv,i=r.c;return Jp({l:r.l,a:Math.cos(t)*i,b:Math.sin(t)*i,alpha:r.alpha})},interpolate:function(r,t,i){return{h:y_(r.h,t.h,i),c:Kr(r.c,t.c,i),l:Kr(r.l,t.l,i),alpha:Kr(r.alpha,t.alpha,i)}}};var Qp=Object.freeze({__proto__:null,hcl:Uc,lab:Bc});class ih{constructor(t,i,l,h,d){this.type=t,this.operator=i,this.interpolation=l,this.input=h,this.labels=[],this.outputs=[];for(const[g,y]of d)this.labels.push(g),this.outputs.push(y)}static interpolationFactor(t,i,l,h){let d=0;if(t.name==="exponential")d=Vc(i,t.base,l,h);else if(t.name==="linear")d=Vc(i,1,l,h);else if(t.name==="cubic-bezier"){const g=t.controlPoints;d=new Ae(g[0],g[1],g[2],g[3]).solve(Vc(i,1,l,h))}return d}static parse(t,i){let[l,h,d,...g]=t;if(!Array.isArray(h)||h.length===0)return i.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){const E=h[1];if(typeof E!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:E}}else{if(h[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const E=h.slice(1);if(E.length!==4||E.some(A=>typeof A!="number"||A<0||A>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:E}}}if(t.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(d=i.parse(d,2,tr),!d)return null;const y=[];let b=null;l==="interpolate-hcl"||l==="interpolate-lab"?b=us:i.expectedType&&i.expectedType.kind!=="value"&&(b=i.expectedType);for(let E=0;E<g.length;E+=2){const A=g[E],M=g[E+1],P=E+3,O=E+4;if(typeof A!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(y.length&&y[y.length-1][0]>=A)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',P);const z=i.parse(M,O,b);if(!z)return null;b=b||z.type,y.push([A,z])}return b.kind==="number"||b.kind==="color"||b.kind==="array"&&b.itemType.kind==="number"&&typeof b.N=="number"?new ih(b,l,h,d,y):i.error(`Type ${pi(b)} is not interpolatable.`)}evaluate(t){const i=this.labels,l=this.outputs;if(i.length===1)return l[0].evaluate(t);const h=this.input.evaluate(t);if(h<=i[0])return l[0].evaluate(t);const d=i.length;if(h>=i[d-1])return l[d-1].evaluate(t);const g=Hl(i,h),y=ih.interpolationFactor(this.interpolation,h,i[g],i[g+1]),b=l[g].evaluate(t),E=l[g+1].evaluate(t);return this.operator==="interpolate"?bf[this.type.kind.toLowerCase()](b,E,y):this.operator==="interpolate-hcl"?Uc.reverse(Uc.interpolate(Uc.forward(b),Uc.forward(E),y)):Bc.reverse(Bc.interpolate(Bc.forward(b),Bc.forward(E),y))}eachChild(t){t(this.input);for(const i of this.outputs)t(i)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t;t=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const i=[this.operator,t,this.input.serialize()];for(let l=0;l<this.labels.length;l++)i.push(this.labels[l],this.outputs[l].serialize());return i}}function Vc(r,t,i,l){const h=l-i,d=r-i;return h===0?0:t===1?d/h:(Math.pow(t,d)-1)/(Math.pow(t,h)-1)}var Xa=ih;class $c{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expectected at least one argument.");let l=null;const h=i.expectedType;h&&h.kind!=="value"&&(l=h);const d=[];for(const y of t.slice(1)){const b=i.parse(y,1+d.length,l,void 0,{typeAnnotation:"omit"});if(!b)return null;l=l||b.type,d.push(b)}const g=h&&d.some(y=>zl(h,y.type));return new $c(g?nn:l,d)}evaluate(t){let i,l=null,h=0;for(const d of this.args){if(h++,l=d.evaluate(t),l&&l instanceof xr&&!l.available&&(i||(i=l),l=null,h===this.args.length))return i;if(l!==null)break}return l}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=["coalesce"];return this.eachChild(i=>{t.push(i.serialize())}),t}}var e0=$c;class Nf{constructor(t,i){this.type=i.type,this.bindings=[].concat(t),this.result=i}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const i of this.bindings)t(i[1]);t(this.result)}static parse(t,i){if(t.length<4)return i.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const l=[];for(let d=1;d<t.length-1;d+=2){const g=t[d];if(typeof g!="string")return i.error(`Expected string, but found ${typeof g} instead.`,d);if(/[^a-zA-Z0-9_]/.test(g))return i.error("Variable names must contain only alphanumeric characters or '_'.",d);const y=i.parse(t[d+1],d+1);if(!y)return null;l.push([g,y])}const h=i.parse(t[t.length-1],t.length-1,i.expectedType,l);return h?new Nf(l,h):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[i,l]of this.bindings)t.push(i,l.serialize());return t.push(this.result.serialize()),t}}var t0=Nf;class ll{constructor(t,i,l){this.type=t,this.index=i,this.input=l}static parse(t,i){if(t.length!==3)return i.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const l=i.parse(t[1],1,tr),h=i.parse(t[2],2,Pa(i.expectedType||nn));return l&&h?new ll(h.type.itemType,l,h):null}evaluate(t){const i=this.index.evaluate(t),l=this.input.evaluate(t);if(i<0)throw new Si(`Array index out of bounds: ${i} < 0.`);if(i>=l.length)throw new Si(`Array index out of bounds: ${i} > ${l.length-1}.`);if(i!==Math.floor(i))throw new Si(`Array index must be an integer, but found ${i} instead.`);return l[i]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var an=ll;class r0{constructor(t,i){this.type=_n,this.needle=t,this.haystack=i}static parse(t,i){if(t.length!==3)return i.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const l=i.parse(t[1],1,nn),h=i.parse(t[2],2,nn);return l&&h?Cr(l.type,[_n,gn,tr,Cc,nn])?new r0(l,h):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${pi(l.type)} instead`):null}evaluate(t){const i=this.needle.evaluate(t),l=this.haystack.evaluate(t);if(l==null)return!1;if(!Qo(i,["boolean","string","number","null"]))throw new Si(`Expected first argument to be of type boolean, string, number or null, but found ${pi(Ei(i))} instead.`);if(!Qo(l,["string","array"]))throw new Si(`Expected second argument to be of type array or string, but found ${pi(Ei(l))} instead.`);return l.indexOf(i)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Mv=r0;class zf{constructor(t,i,l){this.type=tr,this.needle=t,this.haystack=i,this.fromIndex=l}static parse(t,i){if(t.length<=2||t.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const l=i.parse(t[1],1,nn),h=i.parse(t[2],2,nn);if(!l||!h)return null;if(!Cr(l.type,[_n,gn,tr,Cc,nn]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${pi(l.type)} instead`);if(t.length===4){const d=i.parse(t[3],3,tr);return d?new zf(l,h,d):null}return new zf(l,h)}evaluate(t){const i=this.needle.evaluate(t),l=this.haystack.evaluate(t);if(!Qo(i,["boolean","string","number","null"]))throw new Si(`Expected first argument to be of type boolean, string, number or null, but found ${pi(Ei(i))} instead.`);if(!Qo(l,["string","array"]))throw new Si(`Expected second argument to be of type array or string, but found ${pi(Ei(l))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(t);return l.indexOf(i,h)}return l.indexOf(i)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var v_=zf;class n0{constructor(t,i,l,h,d,g){this.inputType=t,this.type=i,this.input=l,this.cases=h,this.outputs=d,this.otherwise=g}static parse(t,i){if(t.length<5)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return i.error("Expected an even number of arguments.");let l,h;i.expectedType&&i.expectedType.kind!=="value"&&(h=i.expectedType);const d={},g=[];for(let E=2;E<t.length-1;E+=2){let A=t[E];const M=t[E+1];Array.isArray(A)||(A=[A]);const P=i.concat(E);if(A.length===0)return P.error("Expected at least one branch label.");for(const z of A){if(typeof z!="number"&&typeof z!="string")return P.error("Branch labels must be numbers or strings.");if(typeof z=="number"&&Math.abs(z)>Number.MAX_SAFE_INTEGER)return P.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof z=="number"&&Math.floor(z)!==z)return P.error("Numeric branch labels must be integer values.");if(l){if(P.checkSubtype(l,Ei(z)))return null}else l=Ei(z);if(d[String(z)]!==void 0)return P.error("Branch labels must be unique.");d[String(z)]=g.length}const O=i.parse(M,E,h);if(!O)return null;h=h||O.type,g.push(O)}const y=i.parse(t[1],1,nn);if(!y)return null;const b=i.parse(t[t.length-1],t.length-1,h);return b?y.type.kind!=="value"&&i.concat(1).checkSubtype(l,y.type)?null:new n0(l,h,y,d,g,b):null}evaluate(t){const i=this.input.evaluate(t);return(Ei(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),l=[],h={};for(const g of i){const y=h[this.cases[g]];y===void 0?(h[this.cases[g]]=l.length,l.push([this.cases[g],[g]])):l[y][1].push(g)}const d=g=>this.inputType.kind==="number"?Number(g):g;for(const[g,y]of l)t.push(y.length===1?d(y[0]):y.map(d)),t.push(this.outputs[g].serialize());return t.push(this.otherwise.serialize()),t}}var w_=n0;class Bf{constructor(t,i,l){this.type=t,this.branches=i,this.otherwise=l}static parse(t,i){if(t.length<4)return i.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return i.error("Expected an odd number of arguments.");let l;i.expectedType&&i.expectedType.kind!=="value"&&(l=i.expectedType);const h=[];for(let g=1;g<t.length-1;g+=2){const y=i.parse(t[g],g,_n);if(!y)return null;const b=i.parse(t[g+1],g+1,l);if(!b)return null;h.push([y,b]),l=l||b.type}const d=i.parse(t[t.length-1],t.length-1,l);return d?new Bf(l,h,d):null}evaluate(t){for(const[i,l]of this.branches)if(i.evaluate(t))return l.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[i,l]of this.branches)t(i),t(l);t(this.otherwise)}outputDefined(){return this.branches.every(([t,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild(i=>{t.push(i.serialize())}),t}}var b_=Bf;class ah{constructor(t,i,l,h){this.type=t,this.input=i,this.beginIndex=l,this.endIndex=h}static parse(t,i){if(t.length<=2||t.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const l=i.parse(t[1],1,nn),h=i.parse(t[2],2,tr);if(!l||!h)return null;if(!Cr(l.type,[Pa(nn),gn,nn]))return i.error(`Expected first argument to be of type array or string, but found ${pi(l.type)} instead`);if(t.length===4){const d=i.parse(t[3],3,tr);return d?new ah(l.type,l,h,d):null}return new ah(l.type,l,h)}evaluate(t){const i=this.input.evaluate(t),l=this.beginIndex.evaluate(t);if(!Qo(i,["string","array"]))throw new Si(`Expected first argument to be of type array or string, but found ${pi(Ei(i))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(t);return i.slice(l,h)}return i.slice(l)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var jc=ah;function i0(r,t){return r==="=="||r==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function a0(r,t,i,l){return l.compare(t,i)===0}function Gc(r,t,i){const l=r!=="=="&&r!=="!=";return class ZD{constructor(d,g,y){this.type=_n,this.lhs=d,this.rhs=g,this.collator=y,this.hasUntypedArgument=d.type.kind==="value"||g.type.kind==="value"}static parse(d,g){if(d.length!==3&&d.length!==4)return g.error("Expected two or three arguments.");const y=d[0];let b=g.parse(d[1],1,nn);if(!b)return null;if(!i0(y,b.type))return g.concat(1).error(`"${y}" comparisons are not supported for type '${pi(b.type)}'.`);let E=g.parse(d[2],2,nn);if(!E)return null;if(!i0(y,E.type))return g.concat(2).error(`"${y}" comparisons are not supported for type '${pi(E.type)}'.`);if(b.type.kind!==E.type.kind&&b.type.kind!=="value"&&E.type.kind!=="value")return g.error(`Cannot compare types '${pi(b.type)}' and '${pi(E.type)}'.`);l&&(b.type.kind==="value"&&E.type.kind!=="value"?b=new wo(E.type,[b]):b.type.kind!=="value"&&E.type.kind==="value"&&(E=new wo(b.type,[E])));let A=null;if(d.length===4){if(b.type.kind!=="string"&&E.type.kind!=="string"&&b.type.kind!=="value"&&E.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(A=g.parse(d[3],3,Tf),!A)return null}return new ZD(b,E,A)}evaluate(d){const g=this.lhs.evaluate(d),y=this.rhs.evaluate(d);if(l&&this.hasUntypedArgument){const b=Ei(g),E=Ei(y);if(b.kind!==E.kind||b.kind!=="string"&&b.kind!=="number")throw new Si(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${b.kind}, ${E.kind}) instead.`)}if(this.collator&&!l&&this.hasUntypedArgument){const b=Ei(g),E=Ei(y);if(b.kind!=="string"||E.kind!=="string")return t(d,g,y)}return this.collator?i(d,g,y,this.collator.evaluate(d)):t(d,g,y)}eachChild(d){d(this.lhs),d(this.rhs),this.collator&&d(this.collator)}outputDefined(){return!0}serialize(){const d=[r];return this.eachChild(g=>{d.push(g.serialize())}),d}}}const s0=Gc("==",function(r,t,i){return t===i},a0),o0=Gc("!=",function(r,t,i){return t!==i},function(r,t,i,l){return!a0(0,t,i,l)}),Iv=Gc("<",function(r,t,i){return t<i},function(r,t,i,l){return l.compare(t,i)<0}),Pv=Gc(">",function(r,t,i){return t>i},function(r,t,i,l){return l.compare(t,i)>0}),T_=Gc("<=",function(r,t,i){return t<=i},function(r,t,i,l){return l.compare(t,i)<=0}),Rv=Gc(">=",function(r,t,i){return t>=i},function(r,t,i,l){return l.compare(t,i)>=0});class l0{constructor(t,i,l,h,d,g){this.type=gn,this.number=t,this.locale=i,this.currency=l,this.unit=h,this.minFractionDigits=d,this.maxFractionDigits=g}static parse(t,i){if(t.length!==3)return i.error("Expected two arguments.");const l=i.parse(t[1],1,tr);if(!l)return null;const h=t[2];if(typeof h!="object"||Array.isArray(h))return i.error("NumberFormat options argument must be an object.");let d=null;if(h.locale&&(d=i.parse(h.locale,1,gn),!d))return null;let g=null;if(h.currency&&(g=i.parse(h.currency,1,gn),!g))return null;let y=null;if(h.unit&&(y=i.parse(h.unit,1,gn),!y))return null;let b=null;if(h["min-fraction-digits"]&&(b=i.parse(h["min-fraction-digits"],1,tr),!b))return null;let E=null;return h["max-fraction-digits"]&&(E=i.parse(h["max-fraction-digits"],1,tr),!E)?null:new l0(l,d,g,y,b,E)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(t):void 0,unit:this.unit?this.unit.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.unit&&t(this.unit),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.unit&&(t.unit=this.unit.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class c0{constructor(t){this.type=tr,this.input=t}static parse(t,i){if(t.length!==2)return i.error(`Expected 1 argument, but found ${t.length-1} instead.`);const l=i.parse(t[1],1);return l?l.type.kind!=="array"&&l.type.kind!=="string"&&l.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${pi(l.type)} instead.`):new c0(l):null}evaluate(t){const i=this.input.evaluate(t);if(typeof i=="string"||Array.isArray(i))return i.length;throw new Si(`Expected value to be of type string or array, but found ${pi(Ei(i))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild(i=>{t.push(i.serialize())}),t}}function E_(r){return function(){r=1831565813+(r|=0)|0;let t=Math.imul(r^r>>>15,1|r);return t=t+Math.imul(t^t>>>7,61|t)^t,((t^t>>>14)>>>0)/4294967296}}const u0={"==":s0,"!=":o0,">":Pv,"<":Iv,">=":Rv,"<=":T_,array:wo,at:an,boolean:wo,case:b_,coalesce:e0,collator:Zu,format:Pc,image:Ul,in:Mv,"index-of":v_,interpolate:Xa,"interpolate-hcl":Xa,"interpolate-lab":Xa,length:c0,let:t0,literal:vo,match:w_,number:wo,"number-format":l0,object:wo,slice:jc,step:nh,string:wo,"to-boolean":bo,"to-color":bo,"to-number":bo,"to-string":bo,var:ya,within:Af,distance:Pf,config:Oc};function h0(r,[t,i,l,h]){t=t.evaluate(r),i=i.evaluate(r),l=l.evaluate(r);const d=h?h.evaluate(r):1,g=o_(t,i,l,d);if(g)throw new Si(g);return new _i(t/255*d,i/255*d,l/255*d,d)}function S_(r,[t,i,l,h]){t=t.evaluate(r),i=i.evaluate(r),l=l.evaluate(r);const d=h?h.evaluate(r):1,g=function(E,A,M,P){return typeof E=="number"&&E>=0&&E<=360?typeof A=="number"&&A>=0&&A<=100&&typeof M=="number"&&M>=0&&M<=100?P===void 0||typeof P=="number"&&P>=0&&P<=1?null:`Invalid hsla value [${[E,A,M,P].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof P=="number"?[E,A,M,P]:[E,A,M]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof P=="number"?[E,A,M,P]:[E,A,M]).join(", ")}]: 'h' must be between 0 and 360.`}(t,i,l,d);if(g)throw new Si(g);const y=`hsla(${t}, ${i}%, ${l}%, ${d})`,b=_i.parse(y);if(!b)throw new Si(`Failed to parse HSLA color: ${y}`);return b}function f0(r,t){return r in t}function d0(r,t){const i=t[r];return i===void 0?null:i}function Wl(r){return{type:r}}Qr.register(u0,{error:[{kind:"error"},[gn],(r,[t])=>{throw new Si(t.evaluate(r))}],typeof:[gn,[nn],(r,[t])=>pi(Ei(t.evaluate(r)))],"to-rgba":[Pa(tr,4),[us],(r,[t])=>t.evaluate(r).toArray()],rgb:[us,[tr,tr,tr],h0],rgba:[us,[tr,tr,tr,tr],h0],hsl:[us,[tr,tr,tr],S_],hsla:[us,[tr,tr,tr,tr],S_],has:{type:_n,overloads:[[[gn],(r,[t])=>f0(t.evaluate(r),r.properties())],[[gn,kc],(r,[t,i])=>f0(t.evaluate(r),i.evaluate(r))]]},get:{type:nn,overloads:[[[gn],(r,[t])=>d0(t.evaluate(r),r.properties())],[[gn,kc],(r,[t,i])=>d0(t.evaluate(r),i.evaluate(r))]]},"feature-state":[nn,[gn],(r,[t])=>d0(t.evaluate(r),r.featureState||{})],properties:[kc,[],r=>r.properties()],"geometry-type":[gn,[],r=>r.geometryType()],id:[nn,[],r=>r.id()],zoom:[tr,[],r=>r.globals.zoom],pitch:[tr,[],r=>r.globals.pitch||0],"distance-from-center":[tr,[],r=>r.distanceFromCenter()],"measure-light":[tr,[gn],(r,[t])=>r.measureLight(t.evaluate(r))],"heatmap-density":[tr,[],r=>r.globals.heatmapDensity||0],"line-progress":[tr,[],r=>r.globals.lineProgress||0],"raster-value":[tr,[],r=>r.globals.rasterValue||0],"raster-particle-speed":[tr,[],r=>r.globals.rasterParticleSpeed||0],"sky-radial-progress":[tr,[],r=>r.globals.skyRadialProgress||0],accumulated:[nn,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[tr,Wl(tr),(r,t)=>{let i=0;for(const l of t)i+=l.evaluate(r);return i}],"*":[tr,Wl(tr),(r,t)=>{let i=1;for(const l of t)i*=l.evaluate(r);return i}],"-":{type:tr,overloads:[[[tr,tr],(r,[t,i])=>t.evaluate(r)-i.evaluate(r)],[[tr],(r,[t])=>-t.evaluate(r)]]},"/":[tr,[tr,tr],(r,[t,i])=>t.evaluate(r)/i.evaluate(r)],"%":[tr,[tr,tr],(r,[t,i])=>t.evaluate(r)%i.evaluate(r)],ln2:[tr,[],()=>Math.LN2],pi:[tr,[],()=>Math.PI],e:[tr,[],()=>Math.E],"^":[tr,[tr,tr],(r,[t,i])=>Math.pow(t.evaluate(r),i.evaluate(r))],sqrt:[tr,[tr],(r,[t])=>Math.sqrt(t.evaluate(r))],log10:[tr,[tr],(r,[t])=>Math.log(t.evaluate(r))/Math.LN10],ln:[tr,[tr],(r,[t])=>Math.log(t.evaluate(r))],log2:[tr,[tr],(r,[t])=>Math.log(t.evaluate(r))/Math.LN2],sin:[tr,[tr],(r,[t])=>Math.sin(t.evaluate(r))],cos:[tr,[tr],(r,[t])=>Math.cos(t.evaluate(r))],tan:[tr,[tr],(r,[t])=>Math.tan(t.evaluate(r))],asin:[tr,[tr],(r,[t])=>Math.asin(t.evaluate(r))],acos:[tr,[tr],(r,[t])=>Math.acos(t.evaluate(r))],atan:[tr,[tr],(r,[t])=>Math.atan(t.evaluate(r))],min:[tr,Wl(tr),(r,t)=>Math.min(...t.map(i=>i.evaluate(r)))],max:[tr,Wl(tr),(r,t)=>Math.max(...t.map(i=>i.evaluate(r)))],abs:[tr,[tr],(r,[t])=>Math.abs(t.evaluate(r))],round:[tr,[tr],(r,[t])=>{const i=t.evaluate(r);return i<0?-Math.round(-i):Math.round(i)}],floor:[tr,[tr],(r,[t])=>Math.floor(t.evaluate(r))],ceil:[tr,[tr],(r,[t])=>Math.ceil(t.evaluate(r))],"filter-==":[_n,[gn,nn],(r,[t,i])=>r.properties()[t.value]===i.value],"filter-id-==":[_n,[nn],(r,[t])=>r.id()===t.value],"filter-type-==":[_n,[gn],(r,[t])=>r.geometryType()===t.value],"filter-<":[_n,[gn,nn],(r,[t,i])=>{const l=r.properties()[t.value],h=i.value;return typeof l==typeof h&&l<h}],"filter-id-<":[_n,[nn],(r,[t])=>{const i=r.id(),l=t.value;return typeof i==typeof l&&i<l}],"filter->":[_n,[gn,nn],(r,[t,i])=>{const l=r.properties()[t.value],h=i.value;return typeof l==typeof h&&l>h}],"filter-id->":[_n,[nn],(r,[t])=>{const i=r.id(),l=t.value;return typeof i==typeof l&&i>l}],"filter-<=":[_n,[gn,nn],(r,[t,i])=>{const l=r.properties()[t.value],h=i.value;return typeof l==typeof h&&l<=h}],"filter-id-<=":[_n,[nn],(r,[t])=>{const i=r.id(),l=t.value;return typeof i==typeof l&&i<=l}],"filter->=":[_n,[gn,nn],(r,[t,i])=>{const l=r.properties()[t.value],h=i.value;return typeof l==typeof h&&l>=h}],"filter-id->=":[_n,[nn],(r,[t])=>{const i=r.id(),l=t.value;return typeof i==typeof l&&i>=l}],"filter-has":[_n,[nn],(r,[t])=>t.value in r.properties()],"filter-has-id":[_n,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[_n,[Pa(gn)],(r,[t])=>t.value.indexOf(r.geometryType())>=0],"filter-id-in":[_n,[Pa(nn)],(r,[t])=>t.value.indexOf(r.id())>=0],"filter-in-small":[_n,[gn,Pa(nn)],(r,[t,i])=>i.value.indexOf(r.properties()[t.value])>=0],"filter-in-large":[_n,[gn,Pa(nn)],(r,[t,i])=>function(l,h,d,g){for(;d<=g;){const y=d+g>>1;if(h[y]===l)return!0;h[y]>l?g=y-1:d=y+1}return!1}(r.properties()[t.value],i.value,0,i.value.length-1)],all:{type:_n,overloads:[[[_n,_n],(r,[t,i])=>t.evaluate(r)&&i.evaluate(r)],[Wl(_n),(r,t)=>{for(const i of t)if(!i.evaluate(r))return!1;return!0}]]},any:{type:_n,overloads:[[[_n,_n],(r,[t,i])=>t.evaluate(r)||i.evaluate(r)],[Wl(_n),(r,t)=>{for(const i of t)if(i.evaluate(r))return!0;return!1}]]},"!":[_n,[_n],(r,[t])=>!t.evaluate(r)],"is-supported-script":[_n,[gn],(r,[t])=>{const i=r.globals&&r.globals.isSupportedScript;return!i||i(t.evaluate(r))}],upcase:[gn,[gn],(r,[t])=>t.evaluate(r).toUpperCase()],downcase:[gn,[gn],(r,[t])=>t.evaluate(r).toLowerCase()],concat:[gn,Wl(nn),(r,t)=>t.map(i=>hs(i.evaluate(r))).join("")],"resolved-locale":[gn,[Tf],(r,[t])=>t.evaluate(r).resolvedLocale()],random:[tr,[tr,tr,nn],(r,t)=>{const[i,l,h]=t.map(g=>g.evaluate(r));if(i>l||i===l)return i;let d;if(typeof h=="string")d=function(g){let y=0;if(g.length===0)return y;for(let b=0;b<g.length;b++)y=(y<<5)-y+g.charCodeAt(b),y|=0;return y}(h);else{if(typeof h!="number")throw new Si(`Invalid seed input: ${h}`);d=h}return i+E_(d)()*(l-i)}]});var Hc=u0;function p0(r){return{result:"success",value:r}}function ql(r){return{result:"error",value:r}}function A_(r,t){return!!r&&!!r.parameters&&r.parameters.indexOf(t)>-1}function Uf(r){return r["property-type"]==="data-driven"}function m0(r){return A_(r.expression,"measure-light")}function C_(r){return A_(r.expression,"zoom")}function g0(r){return!!r.expression&&r.expression.interpolated}function Vf(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}function k_(r){return r}function _0(r,t){const i=t.type==="color",l=r.stops&&typeof r.stops[0][0]=="object",h=l||!(l||r.property!==void 0),d=r.type||(g0(t)?"exponential":"interval");if(i&&((r=Sp({},r)).stops&&(r.stops=r.stops.map(E=>[E[0],_i.parse(E[1])])),r.default=_i.parse(r.default?r.default:t.default)),r.colorSpace&&r.colorSpace!=="rgb"&&!Qp[r.colorSpace])throw new Error(`Unknown color space: ${r.colorSpace}`);let g,y,b;if(d==="exponential")g=M_;else if(d==="interval")g=Fv;else if(d==="categorical"){g=Dv,y=Object.create(null);for(const E of r.stops)y[E[0]]=E[1];b=typeof r.stops[0][0]}else{if(d!=="identity")throw new Error(`Unknown function type "${d}"`);g=I_}if(l){const E={},A=[];for(let O=0;O<r.stops.length;O++){const z=r.stops[O],j=z[0].zoom;E[j]===void 0&&(E[j]={zoom:j,type:r.type,property:r.property,default:r.default,stops:[]},A.push(j)),E[j].stops.push([z[0].value,z[1]])}const M=[];for(const O of A)M.push([E[O].zoom,_0(E[O],t)]);const P={name:"linear"};return{kind:"composite",interpolationType:P,interpolationFactor:Xa.interpolationFactor.bind(void 0,P),zoomStops:M.map(O=>O[0]),evaluate:({zoom:O},z)=>M_({stops:M,base:r.base},t,O).evaluate(O,z)}}if(h){const E=d==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:Xa.interpolationFactor.bind(void 0,E),zoomStops:r.stops.map(A=>A[0]),evaluate:({zoom:A})=>g(r,t,A,y,b)}}return{kind:"source",evaluate(E,A){const M=A&&A.properties?A.properties[r.property]:void 0;return M===void 0?sh(r.default,t.default):g(r,t,M,y,b)}}}function sh(r,t,i){return r!==void 0?r:t!==void 0?t:i!==void 0?i:void 0}function Dv(r,t,i,l,h){return sh(typeof i===h?l[i]:void 0,r.default,t.default)}function Fv(r,t,i){if(Rc(i)!=="number")return sh(r.default,t.default);const l=r.stops.length;if(l===1||i<=r.stops[0][0])return r.stops[0][1];if(i>=r.stops[l-1][0])return r.stops[l-1][1];const h=Hl(r.stops.map(d=>d[0]),i);return r.stops[h][1]}function M_(r,t,i){const l=r.base!==void 0?r.base:1;if(Rc(i)!=="number")return sh(r.default,t.default);const h=r.stops.length;if(h===1||i<=r.stops[0][0])return r.stops[0][1];if(i>=r.stops[h-1][0])return r.stops[h-1][1];const d=Hl(r.stops.map(A=>A[0]),i),g=function(A,M,P,O){const z=O-P,j=A-P;return z===0?0:M===1?j/z:(Math.pow(M,j)-1)/(Math.pow(M,z)-1)}(i,l,r.stops[d][0],r.stops[d+1][0]),y=r.stops[d][1],b=r.stops[d+1][1];let E=bf[t.type]||k_;if(r.colorSpace&&r.colorSpace!=="rgb"){const A=Qp[r.colorSpace];E=(M,P)=>A.reverse(A.interpolate(A.forward(M),A.forward(P),g))}return typeof y.evaluate=="function"?{evaluate(...A){const M=y.evaluate.apply(void 0,A),P=b.evaluate.apply(void 0,A);if(M!==void 0&&P!==void 0)return E(M,P,g)}}:E(y,b,g)}function I_(r,t,i){return t.type==="color"?i=_i.parse(i):t.type==="formatted"?i=Yi.fromString(i.toString()):t.type==="resolvedImage"?i=xr.fromString(i.toString()):Rc(i)===t.type||t.type==="enum"&&t.values[i]||(i=void 0),sh(i,r.default,t.default)}class $f{constructor(t,i,l,h){this.expression=t,this._warningHistory={},this._evaluator=new l_(l,h),this._defaultValue=i?function(d){return d.type==="color"&&(Vf(d.default)||Array.isArray(d.default))?new _i(0,0,0,0):d.type==="color"?_i.parse(d.default)||null:d.default===void 0?null:d.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null}evaluateWithoutErrorHandling(t,i,l,h,d,g,y,b){return this._evaluator.globals=t,this._evaluator.feature=i,this._evaluator.featureState=l,this._evaluator.canonical=h||null,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=g,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=b||null,this.expression.evaluate(this._evaluator)}evaluate(t,i,l,h,d,g,y,b){this._evaluator.globals=t,this._evaluator.feature=i||null,this._evaluator.featureState=l||null,this._evaluator.canonical=h||null,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=g||null,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=b||null;try{const E=this.expression.evaluate(this._evaluator);if(E==null||typeof E=="number"&&E!=E)return this._defaultValue;if(this._enumValues&&!(E in this._enumValues))throw new Si(`Expected value to be one of ${Object.keys(this._enumValues).map(A=>JSON.stringify(A)).join(", ")}, but found ${JSON.stringify(E)} instead.`);return E}catch(E){return this._warningHistory[E.message]||(this._warningHistory[E.message]=!0,typeof console<"u"&&console.warn(E.message)),this._defaultValue}}}function oh(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in Hc}function jf(r,t,i,l){const h=new m_(Hc,[],t?function(g){const y={color:us,string:gn,number:tr,enum:gn,boolean:_n,formatted:Mc,resolvedImage:Wu};return g.type==="array"?Pa(y[g.value]||nn,g.length):y[g.type]}(t):void 0,void 0,void 0,i,l),d=h.parse(r,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return d?p0(new $f(d,t,i,l)):ql(h.errors)}class x0{constructor(t,i,l){this.kind=t,this._styleExpression=i,this.isLightConstant=l,this.isStateDependent=t!=="constant"&&!th(i.expression),this.isConfigDependent=!rh(i.expression)}evaluateWithoutErrorHandling(t,i,l,h,d,g){return this._styleExpression.evaluateWithoutErrorHandling(t,i,l,h,d,g)}evaluate(t,i,l,h,d,g){return this._styleExpression.evaluate(t,i,l,h,d,g)}}class lh{constructor(t,i,l,h,d){this.kind=t,this.zoomStops=l,this._styleExpression=i,this.isStateDependent=t!=="camera"&&!th(i.expression),this.isLightConstant=d,this.isConfigDependent=!rh(i.expression),this.interpolationType=h}evaluateWithoutErrorHandling(t,i,l,h,d,g){return this._styleExpression.evaluateWithoutErrorHandling(t,i,l,h,d,g)}evaluate(t,i,l,h,d,g){return this._styleExpression.evaluate(t,i,l,h,d,g)}interpolationFactor(t,i,l){return this.interpolationType?Xa.interpolationFactor(this.interpolationType,t,i,l):0}}function Gf(r,t,i,l){if((r=jf(r,t,i,l)).result==="error")return r;const h=r.value.expression,d=Nc(h);if(!d&&!Uf(t))return ql([new Ks("","data expressions not supported")]);const g=Ki(h,["zoom","pitch","distance-from-center"]);if(!g&&!C_(t))return ql([new Ks("","zoom expressions not supported")]);const y=Ki(h,["measure-light"]);if(!y&&!m0(t))return ql([new Ks("","measure-light expression not supported")]);const b=t.expression&&t.expression.relaxZoomRestriction,E=uh(h);return E||g||b?E instanceof Ks?ql([E]):E instanceof Xa&&!g0(t)?ql([new Ks("",'"interpolate" expressions cannot be used with this property')]):p0(E?new lh(d?"camera":"composite",r.value,E.labels,E instanceof Xa?E.interpolation:void 0,y):new x0(d?"constant":"source",r.value,y)):ql([new Ks("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class ch{constructor(t,i){this._parameters=t,this._specification=i,Sp(this,_0(this._parameters,this._specification))}static deserialize(t){return new ch(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function uh(r){let t=null;if(r instanceof t0)t=uh(r.result);else if(r instanceof e0){for(const i of r.args)if(t=uh(i),t)break}else(r instanceof nh||r instanceof Xa)&&r.input instanceof Qr&&r.input.name==="zoom"&&(t=r);return t instanceof Ks||r.eachChild(i=>{const l=uh(i);l instanceof Ks?t=l:t&&l&&t!==l&&(t=new Ks("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}var Lv=Ms,ks=3;function Ms(r,t,i){var l=this.cells=[];if(r instanceof ArrayBuffer){this.arrayBuffer=r;var h=new Int32Array(this.arrayBuffer);r=h[0],this.d=(t=h[1])+2*(i=h[2]);for(var d=0;d<this.d*this.d;d++){var g=h[ks+d],y=h[ks+d+1];l.push(g===y?null:h.subarray(g,y))}var b=h[ks+l.length+1];this.keys=h.subarray(h[ks+l.length],b),this.bboxes=h.subarray(b),this.insert=this._insertReadonly}else{this.d=t+2*i;for(var E=0;E<this.d*this.d;E++)l.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=r,this.padding=i,this.scale=t/r,this.uid=0;var A=i/t*r;this.min=-A,this.max=r+A}Ms.prototype.insert=function(r,t,i,l,h){this._forEachCell(t,i,l,h,this._insertCell,this.uid++),this.keys.push(r),this.bboxes.push(t),this.bboxes.push(i),this.bboxes.push(l),this.bboxes.push(h)},Ms.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Ms.prototype._insertCell=function(r,t,i,l,h,d){this.cells[h].push(d)},Ms.prototype.query=function(r,t,i,l,h){var d=this.min,g=this.max;if(r<=d&&t<=d&&g<=i&&g<=l&&!h)return Array.prototype.slice.call(this.keys);var y=[];return this._forEachCell(r,t,i,l,this._queryCell,y,{},h),y},Ms.prototype._queryCell=function(r,t,i,l,h,d,g,y){var b=this.cells[h];if(b!==null)for(var E=this.keys,A=this.bboxes,M=0;M<b.length;M++){var P=b[M];if(g[P]===void 0){var O=4*P;(y?y(A[O+0],A[O+1],A[O+2],A[O+3]):r<=A[O+2]&&t<=A[O+3]&&i>=A[O+0]&&l>=A[O+1])?(g[P]=!0,d.push(E[P])):g[P]=!1}}},Ms.prototype._forEachCell=function(r,t,i,l,h,d,g,y){for(var b=this._convertToCellCoord(r),E=this._convertToCellCoord(t),A=this._convertToCellCoord(i),M=this._convertToCellCoord(l),P=b;P<=A;P++)for(var O=E;O<=M;O++){var z=this.d*O+P;if((!y||y(this._convertFromCellCoord(P),this._convertFromCellCoord(O),this._convertFromCellCoord(P+1),this._convertFromCellCoord(O+1)))&&h.call(this,r,t,i,l,z,d,g,y))return}},Ms.prototype._convertFromCellCoord=function(r){return(r-this.padding)/this.scale},Ms.prototype._convertToCellCoord=function(r){return Math.max(0,Math.min(this.d-1,Math.floor(r*this.scale)+this.padding))},Ms.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var r=this.cells,t=ks+this.cells.length+1+1,i=0,l=0;l<this.cells.length;l++)i+=this.cells[l].length;var h=new Int32Array(t+i+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;for(var d=t,g=0;g<r.length;g++){var y=r[g];h[ks+g]=d,h.set(y,d),d+=y.length}return h[ks+r.length]=d,h.set(this.keys,d),h[ks+r.length+1]=d+=this.keys.length,h.set(this.bboxes,d),d+=this.bboxes.length,h.buffer};var Eo=Z(Lv);const hh={};function rr(r,t,i={}){Object.defineProperty(r,"_classRegistryKey",{value:t,writeable:!1}),hh[t]={klass:r,omit:i.omit||[]}}rr(Object,"Object"),Eo.serialize=function(r,t){const i=r.toArrayBuffer();return t&&t.add(i),{buffer:i}},Eo.deserialize=function(r){return new Eo(r.buffer)},Object.defineProperty(Eo,"name",{value:"Grid"}),rr(Eo,"Grid"),rr(_i,"Color"),rr(Error,"Error"),rr(Yi,"Formatted"),rr(Ic,"FormattedSection"),rr(Hn,"AJAXError"),rr(xr,"ResolvedImage"),rr(ch,"StylePropertyFunction"),rr($f,"StyleExpression",{omit:["_evaluator"]}),rr(lh,"ZoomDependentExpression"),rr(x0,"ZoomConstantExpression"),rr(Qr,"CompoundExpression",{omit:["_evaluate"]});for(const r in Hc)hh[Hc[r]._classRegistryKey]||rr(Hc[r],`Expression${r}`);function P_(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function Hf(r){return self.ImageBitmap&&r instanceof ImageBitmap}function cl(r,t){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp)return r;if(P_(r)||Hf(r))return t&&t.add(r),r;if(ArrayBuffer.isView(r)){const i=r;return t&&t.add(i.buffer),i}if(r instanceof ImageData)return t&&t.add(r.data.buffer),r;if(Array.isArray(r)){const i=[];for(const l of r)i.push(cl(l,t));return i}if(r instanceof Map){const i={$name:"Map"};for(const[l,h]of r.entries())i[l]=cl(h);return i}if(typeof r=="object"){const i=r.constructor,l=i._classRegistryKey;if(!l)throw new Error(`can't serialize object of unregistered class ${l}`);const h=i.serialize?i.serialize(r,t):{};if(!i.serialize){for(const d in r)r.hasOwnProperty(d)&&(hh[l].omit.indexOf(d)>=0||(h[d]=cl(r[d],t)));r instanceof Error&&(h.message=r.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return l!=="Object"&&(h.$name=l),h}throw new Error("can't serialize object of type "+typeof r)}function Zl(r){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||P_(r)||Hf(r)||ArrayBuffer.isView(r)||r instanceof ImageData)return r;if(Array.isArray(r))return r.map(Zl);if(typeof r=="object"){const t=r.$name||"Object";if(t==="Map"){const h=new Map;for(const d of Object.keys(r))d!=="$name"&&h.set(d,Zl(r[d]));return h}const{klass:i}=hh[t];if(!i)throw new Error(`can't deserialize unregistered class ${t}`);if(i.deserialize)return i.deserialize(r);const l=Object.create(i.prototype);for(const h of Object.keys(r))h!=="$name"&&(l[h]=Zl(r[h]));return l}throw new Error("can't deserialize object of type "+typeof r)}const cr={"Latin-1 Supplement":r=>r>=128&&r<=255,Arabic:r=>r>=1536&&r<=1791,"Arabic Supplement":r=>r>=1872&&r<=1919,"Arabic Extended-A":r=>r>=2208&&r<=2303,"Hangul Jamo":r=>r>=4352&&r<=4607,"Unified Canadian Aboriginal Syllabics":r=>r>=5120&&r<=5759,Khmer:r=>r>=6016&&r<=6143,"Unified Canadian Aboriginal Syllabics Extended":r=>r>=6320&&r<=6399,"General Punctuation":r=>r>=8192&&r<=8303,"Letterlike Symbols":r=>r>=8448&&r<=8527,"Number Forms":r=>r>=8528&&r<=8591,"Miscellaneous Technical":r=>r>=8960&&r<=9215,"Control Pictures":r=>r>=9216&&r<=9279,"Optical Character Recognition":r=>r>=9280&&r<=9311,"Enclosed Alphanumerics":r=>r>=9312&&r<=9471,"Geometric Shapes":r=>r>=9632&&r<=9727,"Miscellaneous Symbols":r=>r>=9728&&r<=9983,"Miscellaneous Symbols and Arrows":r=>r>=11008&&r<=11263,"CJK Radicals Supplement":r=>r>=11904&&r<=12031,"Kangxi Radicals":r=>r>=12032&&r<=12255,"Ideographic Description Characters":r=>r>=12272&&r<=12287,"CJK Symbols and Punctuation":r=>r>=12288&&r<=12351,Hiragana:r=>r>=12352&&r<=12447,Katakana:r=>r>=12448&&r<=12543,Bopomofo:r=>r>=12544&&r<=12591,"Hangul Compatibility Jamo":r=>r>=12592&&r<=12687,Kanbun:r=>r>=12688&&r<=12703,"Bopomofo Extended":r=>r>=12704&&r<=12735,"CJK Strokes":r=>r>=12736&&r<=12783,"Katakana Phonetic Extensions":r=>r>=12784&&r<=12799,"Enclosed CJK Letters and Months":r=>r>=12800&&r<=13055,"CJK Compatibility":r=>r>=13056&&r<=13311,"CJK Unified Ideographs Extension A":r=>r>=13312&&r<=19903,"Yijing Hexagram Symbols":r=>r>=19904&&r<=19967,"CJK Unified Ideographs":r=>r>=19968&&r<=40959,"Yi Syllables":r=>r>=40960&&r<=42127,"Yi Radicals":r=>r>=42128&&r<=42191,"Hangul Jamo Extended-A":r=>r>=43360&&r<=43391,"Hangul Syllables":r=>r>=44032&&r<=55215,"Hangul Jamo Extended-B":r=>r>=55216&&r<=55295,"Private Use Area":r=>r>=57344&&r<=63743,"CJK Compatibility Ideographs":r=>r>=63744&&r<=64255,"Arabic Presentation Forms-A":r=>r>=64336&&r<=65023,"Vertical Forms":r=>r>=65040&&r<=65055,"CJK Compatibility Forms":r=>r>=65072&&r<=65103,"Small Form Variants":r=>r>=65104&&r<=65135,"Arabic Presentation Forms-B":r=>r>=65136&&r<=65279,"Halfwidth and Fullwidth Forms":r=>r>=65280&&r<=65519,"CJK Unified Ideographs Extension B":r=>r>=131072&&r<=173791};function ul(r){for(const t of r)if(y0(t.charCodeAt(0)))return!0;return!1}function Ov(r){for(const t of r)if(!Nv(t.charCodeAt(0)))return!1;return!0}function Nv(r){return!(cr.Arabic(r)||cr["Arabic Supplement"](r)||cr["Arabic Extended-A"](r)||cr["Arabic Presentation Forms-A"](r)||cr["Arabic Presentation Forms-B"](r))}function y0(r){return!(r!==746&&r!==747&&(r<4352||!(cr["Bopomofo Extended"](r)||cr.Bopomofo(r)||cr["CJK Compatibility Forms"](r)&&!(r>=65097&&r<=65103)||cr["CJK Compatibility Ideographs"](r)||cr["CJK Compatibility"](r)||cr["CJK Radicals Supplement"](r)||cr["CJK Strokes"](r)||!(!cr["CJK Symbols and Punctuation"](r)||r>=12296&&r<=12305||r>=12308&&r<=12319||r===12336)||cr["CJK Unified Ideographs Extension A"](r)||cr["CJK Unified Ideographs"](r)||cr["Enclosed CJK Letters and Months"](r)||cr["Hangul Compatibility Jamo"](r)||cr["Hangul Jamo Extended-A"](r)||cr["Hangul Jamo Extended-B"](r)||cr["Hangul Jamo"](r)||cr["Hangul Syllables"](r)||cr.Hiragana(r)||cr["Ideographic Description Characters"](r)||cr.Kanbun(r)||cr["Kangxi Radicals"](r)||cr["Katakana Phonetic Extensions"](r)||cr.Katakana(r)&&r!==12540||!(!cr["Halfwidth and Fullwidth Forms"](r)||r===65288||r===65289||r===65293||r>=65306&&r<=65310||r===65339||r===65341||r===65343||r>=65371&&r<=65503||r===65507||r>=65512&&r<=65519)||!(!cr["Small Form Variants"](r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||cr["Unified Canadian Aboriginal Syllabics"](r)||cr["Unified Canadian Aboriginal Syllabics Extended"](r)||cr["Vertical Forms"](r)||cr["Yijing Hexagram Symbols"](r)||cr["Yi Syllables"](r)||cr["Yi Radicals"](r))))}function R_(r){return!(y0(r)||function(t){return!!(cr["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||cr["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||cr["Letterlike Symbols"](t)||cr["Number Forms"](t)||cr["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||cr["Control Pictures"](t)&&t!==9251||cr["Optical Character Recognition"](t)||cr["Enclosed Alphanumerics"](t)||cr["Geometric Shapes"](t)||cr["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||cr["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||cr["CJK Symbols and Punctuation"](t)||cr.Katakana(t)||cr["Private Use Area"](t)||cr["CJK Compatibility Forms"](t)||cr["Small Form Variants"](t)||cr["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(r))}function D_(r){return r>=1424&&r<=2303||cr["Arabic Presentation Forms-A"](r)||cr["Arabic Presentation Forms-B"](r)}function F_(r,t){return!(!t&&D_(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||cr.Khmer(r))}function v0(r){for(const t of r)if(D_(t.charCodeAt(0)))return!0;return!1}const w0="deferred",b0="loading",T0="loaded";let E0=null,Ra="unavailable",hl=null;const L_=function(r){r&&typeof r=="string"&&r.indexOf("NetworkError")>-1&&(Ra="error"),E0&&E0(r)};function S0(){A0.fire(new xa("pluginStateChange",{pluginStatus:Ra,pluginURL:hl}))}const A0=new ha,fl=function(){return Ra},C0=function(){if(Ra!==w0||!hl)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Ra=b0,S0(),hl&&xt({url:hl},r=>{r?L_(r):(Ra=T0,S0())})},Ya={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Ra===T0||Ya.applyArabicShaping!=null,isLoading:()=>Ra===b0,setState(r){Ra=r.pluginStatus,hl=r.pluginURL},isParsed:()=>Ya.applyArabicShaping!=null&&Ya.processBidirectionalText!=null&&Ya.processStyledBidirectionalText!=null,getPluginURL:()=>hl};class ri{constructor(t,i){this.zoom=t,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch,this.brightness=i.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(t){return function(i,l){for(const h of i)if(!F_(h.charCodeAt(0),l))return!1;return!0}(t,Ya.isLoaded())}}class Wf{constructor(t,i,l,h){this.property=t,this.value=i,this.expression=function(d,g,y,b){if(Vf(d))return new ch(d,g);if(oh(d)||Array.isArray(d)&&d.length>0){const E=Gf(d,g,y,b);if(E.result==="error")throw new Error(E.value.map(A=>`${A.key}: ${A.message}`).join(", "));return E.value}{let E=d;return typeof d=="string"&&g.type==="color"&&(E=_i.parse(d)),{kind:"constant",isConfigDependent:!1,evaluate:()=>E}}}(i===void 0?t.specification.default:i,t.specification,l,h)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,i,l){return this.property.possiblyEvaluate(this,t,i,l)}}class k0{constructor(t,i,l){this.property=t,this.value=new Wf(t,void 0,i,l)}transitioned(t,i){return new M0(this.property,this.value,i,Se({},t.transition,this.transition),t.now)}untransitioned(){return new M0(this.property,this.value,null,{},0)}}class So{constructor(t,i,l){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues),this._scope=i,this._options=l,this.isConfigDependent=!1}getValue(t){return Be(this._values[t].value.value)}setValue(t,i){this._values.hasOwnProperty(t)||(this._values[t]=new k0(this._values[t].property,this._scope,this._options)),this._values[t].value=new Wf(this._values[t].property,i===null?void 0:Be(i),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[t].value.expression.isConfigDependent}setTransitionOrValue(t,i){i&&(this._options=i);const l=this._properties.properties;if(t)for(const h in t){const d=t[h];if(Xt(h,"-transition")){const g=h.slice(0,-11);l[g]&&this.setTransition(g,d)}else l[h]&&this.setValue(h,d)}}getTransition(t){return Be(this._values[t].transition)}setTransition(t,i){this._values.hasOwnProperty(t)||(this._values[t]=new k0(this._values[t].property)),this._values[t].transition=Be(i)||void 0}serialize(){const t={};for(const i of Object.keys(this._values)){const l=this.getValue(i);l!==void 0&&(t[i]=l);const h=this.getTransition(i);h!==void 0&&(t[`${i}-transition`]=h)}return t}transitioned(t,i){const l=new Xl(this._properties);for(const h of Object.keys(this._values))l._values[h]=this._values[h].transitioned(t,i._values[h]);return l}untransitioned(){const t=new Xl(this._properties);for(const i of Object.keys(this._values))t._values[i]=this._values[i].untransitioned();return t}}class M0{constructor(t,i,l,h,d){const g=h.delay||0,y=h.duration||0;d=d||0,this.property=t,this.value=i,this.begin=d+g,this.end=this.begin+y,t.specification.transition&&(h.delay||h.duration)&&(this.prior=l)}possiblyEvaluate(t,i,l){const h=t.now||0,d=this.value.possiblyEvaluate(t,i,l),g=this.prior;if(g){if(h>this.end)return this.prior=null,d;if(this.value.isDataDriven())return this.prior=null,d;if(h<this.begin)return g.possiblyEvaluate(t,i,l);{const y=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(t,i,l),d,We(y))}}return d}}class Xl{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,i,l){const h=new fh(this._properties);for(const d of Object.keys(this._values))h._values[d]=this._values[d].possiblyEvaluate(t,i,l);return h}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class zv{constructor(t,i,l){this._properties=t,this._values=Object.create(t.defaultPropertyValues),this._scope=i,this._options=l,this.isConfigDependent=!1}getValue(t){return Be(this._values[t].value)}setValue(t,i){this._values[t]=new Wf(this._values[t].property,i===null?void 0:Be(i),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[t].expression.isConfigDependent}serialize(){const t={};for(const i of Object.keys(this._values)){const l=this.getValue(i);l!==void 0&&(t[i]=l)}return t}possiblyEvaluate(t,i,l){const h=new fh(this._properties);for(const d of Object.keys(this._values))h._values[d]=this._values[d].possiblyEvaluate(t,i,l);return h}}class Wc{constructor(t,i,l){this.property=t,this.value=i,this.parameters=l}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,i,l,h){return this.property.evaluate(this.value,this.parameters,t,i,l,h)}}class fh{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class jt{constructor(t){this.specification=t}possiblyEvaluate(t,i){return t.expression.evaluate(i)}interpolate(t,i,l){const h=bf[this.specification.type];return h?h(t,i,l):t}}class mr{constructor(t,i){this.specification=t,this.overrides=i}possiblyEvaluate(t,i,l,h){return new Wc(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(i,null,{},l,h)}:t.expression,i)}interpolate(t,i,l){if(t.value.kind!=="constant"||i.value.kind!=="constant")return t;if(t.value.value===void 0||i.value.value===void 0)return new Wc(this,{kind:"constant",value:void 0},t.parameters);const h=bf[this.specification.type];return h?new Wc(this,{kind:"constant",value:h(t.value.value,i.value.value,l)},t.parameters):t}evaluate(t,i,l,h,d,g){return t.kind==="constant"?t.value:t.evaluate(i,l,h,d,g)}}class Yl{constructor(t){this.specification=t}possiblyEvaluate(t,i,l,h){return!!t.expression.evaluate(i,null,{},l,h)}interpolate(){return!1}}class ni{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new ri(0,{});for(const l in t){const h=t[l];h.specification.overridable&&this.overridableProperties.push(l);const d=this.defaultPropertyValues[l]=new Wf(h,void 0),g=this.defaultTransitionablePropertyValues[l]=new k0(h);this.defaultTransitioningPropertyValues[l]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[l]=d.possiblyEvaluate(i)}}}function dh(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function ph(r){if(Array.isArray(r))return r.map(ph);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const t={};for(const i in r)t[i]=ph(r[i]);return t}return dh(r)}rr(mr,"DataDrivenProperty"),rr(jt,"DataConstantProperty"),rr(Yl,"ColorRampProperty");var tt=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function I0(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const t of r.slice(1))if(!I0(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}function Ka(r,t="fill"){if(r==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};I0(r)||(r=mh(r));const i=r;let l=!0;try{l=function(E){if(!qc(E))return E;let A=ph(E);return P0(A),A=O_(A),A}(i)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(i,null,2)}
        `)}const h=tt[`filter_${t}`],d=jf(l,h);let g=null;if(d.result==="error")throw new Error(d.value.map(E=>`${E.key}: ${E.message}`).join(", "));g=(E,A,M)=>d.value.evaluate(E,A,{},M);let y=null,b=null;if(l!==i){const E=jf(i,h);if(E.result==="error")throw new Error(E.value.map(A=>`${A.key}: ${A.message}`).join(", "));y=(A,M,P,O,z)=>E.value.evaluate(A,M,{},P,void 0,void 0,O,z),b=!Nc(E.value.expression)}return{filter:g,dynamicFilter:y||void 0,needGeometry:N_(l),needFeature:!!b}}function O_(r){if(!Array.isArray(r))return r;const t=function(i){if(Bv.has(i[0])){for(let l=1;l<i.length;l++)if(qc(i[l]))return!0}return i}(r);return t===!0?t:t.map(i=>O_(i))}function P0(r){let t=!1;const i=[];if(r[0]==="case"){for(let l=1;l<r.length-1;l+=2)t=t||qc(r[l]),i.push(r[l+1]);i.push(r[r.length-1])}else if(r[0]==="match"){t=t||qc(r[1]);for(let l=2;l<r.length-1;l+=2)i.push(r[l+1]);i.push(r[r.length-1])}else if(r[0]==="step"){t=t||qc(r[1]);for(let l=1;l<r.length-1;l+=2)i.push(r[l+1])}t&&(r.length=0,r.push("any",...i));for(let l=1;l<r.length;l++)P0(r[l])}function qc(r){if(!Array.isArray(r))return!1;if((t=r[0])==="pitch"||t==="distance-from-center")return!0;var t;for(let i=1;i<r.length;i++)if(qc(r[i]))return!0;return!1}const Bv=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Uv(r,t){return r<t?-1:r>t?1:0}function N_(r){if(!Array.isArray(r))return!1;if(r[0]==="within"||r[0]==="distance")return!0;for(let t=1;t<r.length;t++)if(N_(r[t]))return!0;return!1}function mh(r){if(!r)return!0;const t=r[0];return r.length<=1?t!=="any":t==="=="?gh(r[1],r[2],"=="):t==="!="?_h(gh(r[1],r[2],"==")):t==="<"||t===">"||t==="<="||t===">="?gh(r[1],r[2],t):t==="any"?(i=r.slice(1),["any"].concat(i.map(mh))):t==="all"?["all"].concat(r.slice(1).map(mh)):t==="none"?["all"].concat(r.slice(1).map(mh).map(_h)):t==="in"?R0(r[1],r.slice(2)):t==="!in"?_h(R0(r[1],r.slice(2))):t==="has"?z_(r[1]):t!=="!has"||_h(z_(r[1]));var i}function gh(r,t,i){switch(r){case"$type":return[`filter-type-${i}`,t];case"$id":return[`filter-id-${i}`,t];default:return[`filter-${i}`,r,t]}}function R0(r,t){if(t.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(i=>typeof i!=typeof t[0])?["filter-in-large",r,["literal",t.sort(Uv)]]:["filter-in-small",r,["literal",t]]}}function z_(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function _h(r){return["!",r]}const qf="";function D0(r,t){return t?`${r}${qf}${t}`:r}const xh="-transition";class Da extends ha{constructor(t,i,l,h){if(super(),this.id=t.id,this.fqid=D0(this.id,l),this.type=t.type,this.scope=l,this.options=h,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&t.type!=="sky"&&t.type!=="slot"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),t.slot&&(this.slot=t.slot),i.layout&&(this._unevaluatedLayout=new zv(i.layout,this.scope,h),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),i.paint)){this._transitionablePaint=new So(i.paint,this.scope,h);for(const d in t.paint)this.setPaintProperty(d,t.paint[d]);for(const d in t.layout)this.setLayoutProperty(d,t.layout[d]);this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new fh(i.paint)}}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,i){if(this.type==="custom"&&t==="visibility")return void(this.visibility=i);const l=this._unevaluatedLayout;l._properties.properties[t]&&(l.setValue(t,i),this.isConfigDependent=this.isConfigDependent||l.isConfigDependent,t==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(t){return Xt(t,xh)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,i){const l=this._transitionablePaint,h=l._properties.properties;if(Xt(t,xh)){const M=t.slice(0,-11);return h[M]&&l.setTransition(M,i||void 0),!1}if(!h[t])return!1;const d=l._values[t],g=d.value.isDataDriven(),y=d.value;l.setValue(t,i),this.isConfigDependent=this.isConfigDependent||l.isConfigDependent,this._handleSpecialPaintPropertyUpdate(t);const b=l._values[t].value,E=b.isDataDriven(),A=Xt(t,"pattern")||t==="line-dasharray";return E||g||A||this._handleOverridablePaintPropertyUpdate(t,y,b)}_handleSpecialPaintPropertyUpdate(t){}getProgramIds(){return null}getDefaultProgramParams(t,i){return null}_handleOverridablePaintPropertyUpdate(t,i,l){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,i)}serialize(){return Or({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(t,i)=>!(t===void 0||i==="layout"&&!Object.keys(t).length||i==="paint"&&!Object.keys(t).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const t in this.paint._values){const i=this.paint.get(t);if(i instanceof Wc&&Uf(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Ka(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(t){this._stats&&(t.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}}const Vv={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Zf{constructor(t,i){this._structArray=t,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Yn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,i){return t._trim(),i&&(t.isTransferred=!0,i.add(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const i=Object.create(this.prototype);return i.arrayBuffer=t.arrayBuffer,i.length=t.length,i.capacity=t.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...t){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...t){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function bn(r,t=1){let i=0,l=0;return{members:r.map(h=>{const d=Vv[h.type].BYTES_PER_ELEMENT,g=i=yh(i,Math.max(t,d)),y=h.components||1;return l=Math.max(l,d),i+=d*y,{name:h.name,type:h.type,components:y,offset:g}}),size:yh(i,Math.max(l,t)),alignment:t}}function yh(r,t){return Math.ceil(r/t)*t}class Is extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i){const l=this.length;return this.resize(l+1),this.emplace(l,t,i)}emplace(t,i,l){const h=2*t;return this.int16[h+0]=i,this.int16[h+1]=l,t}}Is.prototype.bytesPerElement=4,rr(Is,"StructArrayLayout2i4");class va extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,l){const h=this.length;return this.resize(h+1),this.emplace(h,t,i,l)}emplace(t,i,l,h){const d=3*t;return this.int16[d+0]=i,this.int16[d+1]=l,this.int16[d+2]=h,t}}va.prototype.bytesPerElement=6,rr(va,"StructArrayLayout3i6");class Ao extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,l,h){const d=this.length;return this.resize(d+1),this.emplace(d,t,i,l,h)}emplace(t,i,l,h,d){const g=4*t;return this.int16[g+0]=i,this.int16[g+1]=l,this.int16[g+2]=h,this.int16[g+3]=d,t}}Ao.prototype.bytesPerElement=8,rr(Ao,"StructArrayLayout4i8");class F0 extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,l,h,d){const g=this.length;return this.resize(g+1),this.emplace(g,t,i,l,h,d)}emplace(t,i,l,h,d,g){const y=5*t;return this.int16[y+0]=i,this.int16[y+1]=l,this.int16[y+2]=h,this.int16[y+3]=d,this.int16[y+4]=g,t}}F0.prototype.bytesPerElement=10,rr(F0,"StructArrayLayout5i10");class L0 extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,l,h,d,g,y){const b=this.length;return this.resize(b+1),this.emplace(b,t,i,l,h,d,g,y)}emplace(t,i,l,h,d,g,y,b){const E=6*t,A=12*t,M=3*t;return this.int16[E+0]=i,this.int16[E+1]=l,this.uint8[A+4]=h,this.uint8[A+5]=d,this.uint8[A+6]=g,this.uint8[A+7]=y,this.float32[M+2]=b,t}}L0.prototype.bytesPerElement=12,rr(L0,"StructArrayLayout2i4ub1f12");class dl extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,l,h){const d=this.length;return this.resize(d+1),this.emplace(d,t,i,l,h)}emplace(t,i,l,h,d){const g=4*t;return this.float32[g+0]=i,this.float32[g+1]=l,this.float32[g+2]=h,this.float32[g+3]=d,t}}dl.prototype.bytesPerElement=16,rr(dl,"StructArrayLayout4f16");class pl extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,l,h,d){const g=this.length;return this.resize(g+1),this.emplace(g,t,i,l,h,d)}emplace(t,i,l,h,d,g){const y=6*t,b=3*t;return this.uint16[y+0]=i,this.uint16[y+1]=l,this.uint16[y+2]=h,this.uint16[y+3]=d,this.float32[b+2]=g,t}}pl.prototype.bytesPerElement=12,rr(pl,"StructArrayLayout4ui1f12");class Zc extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,l,h){const d=this.length;return this.resize(d+1),this.emplace(d,t,i,l,h)}emplace(t,i,l,h,d){const g=4*t;return this.uint16[g+0]=i,this.uint16[g+1]=l,this.uint16[g+2]=h,this.uint16[g+3]=d,t}}Zc.prototype.bytesPerElement=8,rr(Zc,"StructArrayLayout4ui8");class Xf extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,l,h,d,g){const y=this.length;return this.resize(y+1),this.emplace(y,t,i,l,h,d,g)}emplace(t,i,l,h,d,g,y){const b=6*t;return this.int16[b+0]=i,this.int16[b+1]=l,this.int16[b+2]=h,this.int16[b+3]=d,this.int16[b+4]=g,this.int16[b+5]=y,t}}Xf.prototype.bytesPerElement=12,rr(Xf,"StructArrayLayout6i12");class vh extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,l,h,d,g,y,b,E,A,M,P){const O=this.length;return this.resize(O+1),this.emplace(O,t,i,l,h,d,g,y,b,E,A,M,P)}emplace(t,i,l,h,d,g,y,b,E,A,M,P,O){const z=12*t;return this.int16[z+0]=i,this.int16[z+1]=l,this.int16[z+2]=h,this.int16[z+3]=d,this.uint16[z+4]=g,this.uint16[z+5]=y,this.uint16[z+6]=b,this.uint16[z+7]=E,this.int16[z+8]=A,this.int16[z+9]=M,this.int16[z+10]=P,this.int16[z+11]=O,t}}vh.prototype.bytesPerElement=24,rr(vh,"StructArrayLayout4i4ui4i24");class O0 extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,l,h,d,g){const y=this.length;return this.resize(y+1),this.emplace(y,t,i,l,h,d,g)}emplace(t,i,l,h,d,g,y){const b=10*t,E=5*t;return this.int16[b+0]=i,this.int16[b+1]=l,this.int16[b+2]=h,this.float32[E+2]=d,this.float32[E+3]=g,this.float32[E+4]=y,t}}O0.prototype.bytesPerElement=20,rr(O0,"StructArrayLayout3i3f20");class N0 extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.uint32[1*t+0]=i,t}}N0.prototype.bytesPerElement=4,rr(N0,"StructArrayLayout1ul4");class Js extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i){const l=this.length;return this.resize(l+1),this.emplace(l,t,i)}emplace(t,i,l){const h=2*t;return this.uint16[h+0]=i,this.uint16[h+1]=l,t}}Js.prototype.bytesPerElement=4,rr(Js,"StructArrayLayout2ui4");class z0 extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,l,h,d,g,y,b,E,A,M,P,O){const z=this.length;return this.resize(z+1),this.emplace(z,t,i,l,h,d,g,y,b,E,A,M,P,O)}emplace(t,i,l,h,d,g,y,b,E,A,M,P,O,z){const j=20*t,q=10*t;return this.int16[j+0]=i,this.int16[j+1]=l,this.int16[j+2]=h,this.int16[j+3]=d,this.int16[j+4]=g,this.float32[q+3]=y,this.float32[q+4]=b,this.float32[q+5]=E,this.float32[q+6]=A,this.int16[j+14]=M,this.uint32[q+8]=P,this.uint16[j+18]=O,this.uint16[j+19]=z,t}}z0.prototype.bytesPerElement=40,rr(z0,"StructArrayLayout5i4f1i1ul2ui40");class wh extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,l,h,d,g,y){const b=this.length;return this.resize(b+1),this.emplace(b,t,i,l,h,d,g,y)}emplace(t,i,l,h,d,g,y,b){const E=8*t;return this.int16[E+0]=i,this.int16[E+1]=l,this.int16[E+2]=h,this.int16[E+4]=d,this.int16[E+5]=g,this.int16[E+6]=y,this.int16[E+7]=b,t}}wh.prototype.bytesPerElement=16,rr(wh,"StructArrayLayout3i2i2i16");class Yf extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,l,h,d){const g=this.length;return this.resize(g+1),this.emplace(g,t,i,l,h,d)}emplace(t,i,l,h,d,g){const y=4*t,b=8*t;return this.float32[y+0]=i,this.float32[y+1]=l,this.float32[y+2]=h,this.int16[b+6]=d,this.int16[b+7]=g,t}}Yf.prototype.bytesPerElement=16,rr(Yf,"StructArrayLayout2f1f2i16");class B0 extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,l,h){const d=this.length;return this.resize(d+1),this.emplace(d,t,i,l,h)}emplace(t,i,l,h,d){const g=12*t,y=3*t;return this.uint8[g+0]=i,this.uint8[g+1]=l,this.float32[y+1]=h,this.float32[y+2]=d,t}}B0.prototype.bytesPerElement=12,rr(B0,"StructArrayLayout2ub2f12");class Oi extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,l){const h=this.length;return this.resize(h+1),this.emplace(h,t,i,l)}emplace(t,i,l,h){const d=3*t;return this.uint16[d+0]=i,this.uint16[d+1]=l,this.uint16[d+2]=h,t}}Oi.prototype.bytesPerElement=6,rr(Oi,"StructArrayLayout3ui6");class Xc extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,i,l,h,d,g,y,b,E,A,M,P,O,z,j,q,Q,oe,pe,de,Ce){const Ee=this.length;return this.resize(Ee+1),this.emplace(Ee,t,i,l,h,d,g,y,b,E,A,M,P,O,z,j,q,Q,oe,pe,de,Ce)}emplace(t,i,l,h,d,g,y,b,E,A,M,P,O,z,j,q,Q,oe,pe,de,Ce,Ee){const Le=30*t,je=15*t,Ze=60*t;return this.int16[Le+0]=i,this.int16[Le+1]=l,this.int16[Le+2]=h,this.float32[je+2]=d,this.float32[je+3]=g,this.uint16[Le+8]=y,this.uint16[Le+9]=b,this.uint32[je+5]=E,this.uint32[je+6]=A,this.uint32[je+7]=M,this.uint16[Le+16]=P,this.uint16[Le+17]=O,this.uint16[Le+18]=z,this.float32[je+10]=j,this.float32[je+11]=q,this.uint8[Ze+48]=Q,this.uint8[Ze+49]=oe,this.uint8[Ze+50]=pe,this.uint32[je+13]=de,this.int16[Le+28]=Ce,this.uint8[Ze+58]=Ee,t}}Xc.prototype.bytesPerElement=60,rr(Xc,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Kf extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,i,l,h,d,g,y,b,E,A,M,P,O,z,j,q,Q,oe,pe,de,Ce,Ee,Le,je,Ze,it,Ye,mt,bt,ht,wt,lt){const vt=this.length;return this.resize(vt+1),this.emplace(vt,t,i,l,h,d,g,y,b,E,A,M,P,O,z,j,q,Q,oe,pe,de,Ce,Ee,Le,je,Ze,it,Ye,mt,bt,ht,wt,lt)}emplace(t,i,l,h,d,g,y,b,E,A,M,P,O,z,j,q,Q,oe,pe,de,Ce,Ee,Le,je,Ze,it,Ye,mt,bt,ht,wt,lt,vt){const Gt=20*t,Tt=40*t,ar=80*t;return this.float32[Gt+0]=i,this.float32[Gt+1]=l,this.int16[Tt+4]=h,this.int16[Tt+5]=d,this.int16[Tt+6]=g,this.int16[Tt+7]=y,this.int16[Tt+8]=b,this.int16[Tt+9]=E,this.int16[Tt+10]=A,this.int16[Tt+11]=M,this.int16[Tt+12]=P,this.uint16[Tt+13]=O,this.uint16[Tt+14]=z,this.uint16[Tt+15]=j,this.uint16[Tt+16]=q,this.uint16[Tt+17]=Q,this.uint16[Tt+18]=oe,this.uint16[Tt+19]=pe,this.uint16[Tt+20]=de,this.uint16[Tt+21]=Ce,this.uint16[Tt+22]=Ee,this.uint16[Tt+23]=Le,this.uint16[Tt+24]=je,this.uint16[Tt+25]=Ze,this.uint16[Tt+26]=it,this.uint16[Tt+27]=Ye,this.uint32[Gt+14]=mt,this.float32[Gt+15]=bt,this.float32[Gt+16]=ht,this.float32[Gt+17]=wt,this.float32[Gt+18]=lt,this.uint8[ar+76]=vt,t}}Kf.prototype.bytesPerElement=80,rr(Kf,"StructArrayLayout2f9i15ui1ul4f1ub80");class bh extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.float32[1*t+0]=i,t}}bh.prototype.bytesPerElement=4,rr(bh,"StructArrayLayout1f4");class ml extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,l,h,d){const g=this.length;return this.resize(g+1),this.emplace(g,t,i,l,h,d)}emplace(t,i,l,h,d,g){const y=5*t;return this.float32[y+0]=i,this.float32[y+1]=l,this.float32[y+2]=h,this.float32[y+3]=d,this.float32[y+4]=g,t}}ml.prototype.bytesPerElement=20,rr(ml,"StructArrayLayout5f20");class U0 extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,l,h,d,g,y){const b=this.length;return this.resize(b+1),this.emplace(b,t,i,l,h,d,g,y)}emplace(t,i,l,h,d,g,y,b){const E=7*t;return this.float32[E+0]=i,this.float32[E+1]=l,this.float32[E+2]=h,this.float32[E+3]=d,this.float32[E+4]=g,this.float32[E+5]=y,this.float32[E+6]=b,t}}U0.prototype.bytesPerElement=28,rr(U0,"StructArrayLayout7f28");class Th extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,l,h){const d=this.length;return this.resize(d+1),this.emplace(d,t,i,l,h)}emplace(t,i,l,h,d){const g=6*t;return this.uint32[3*t+0]=i,this.uint16[g+2]=l,this.uint16[g+3]=h,this.uint16[g+4]=d,t}}Th.prototype.bytesPerElement=12,rr(Th,"StructArrayLayout1ul3ui12");class V0 extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.uint16[1*t+0]=i,t}}V0.prototype.bytesPerElement=2,rr(V0,"StructArrayLayout1ui2");class Kl extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,l){const h=this.length;return this.resize(h+1),this.emplace(h,t,i,l)}emplace(t,i,l,h){const d=3*t;return this.float32[d+0]=i,this.float32[d+1]=l,this.float32[d+2]=h,t}}Kl.prototype.bytesPerElement=12,rr(Kl,"StructArrayLayout3f12");class Eh extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i){const l=this.length;return this.resize(l+1),this.emplace(l,t,i)}emplace(t,i,l){const h=2*t;return this.float32[h+0]=i,this.float32[h+1]=l,t}}Eh.prototype.bytesPerElement=8,rr(Eh,"StructArrayLayout2f8");class $0 extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,l,h,d,g,y,b,E,A,M,P,O,z,j,q){const Q=this.length;return this.resize(Q+1),this.emplace(Q,t,i,l,h,d,g,y,b,E,A,M,P,O,z,j,q)}emplace(t,i,l,h,d,g,y,b,E,A,M,P,O,z,j,q,Q){const oe=16*t;return this.float32[oe+0]=i,this.float32[oe+1]=l,this.float32[oe+2]=h,this.float32[oe+3]=d,this.float32[oe+4]=g,this.float32[oe+5]=y,this.float32[oe+6]=b,this.float32[oe+7]=E,this.float32[oe+8]=A,this.float32[oe+9]=M,this.float32[oe+10]=P,this.float32[oe+11]=O,this.float32[oe+12]=z,this.float32[oe+13]=j,this.float32[oe+14]=q,this.float32[oe+15]=Q,t}}$0.prototype.bytesPerElement=64,rr($0,"StructArrayLayout16f64");class Sh extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,l,h,d,g,y){const b=this.length;return this.resize(b+1),this.emplace(b,t,i,l,h,d,g,y)}emplace(t,i,l,h,d,g,y,b){const E=10*t,A=5*t;return this.uint16[E+0]=i,this.uint16[E+1]=l,this.uint16[E+2]=h,this.uint16[E+3]=d,this.float32[A+2]=g,this.float32[A+3]=y,this.float32[A+4]=b,t}}Sh.prototype.bytesPerElement=20,rr(Sh,"StructArrayLayout4ui3f20");class j0 extends Yn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(t){const i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.uint8[1*t+0]=i,t}}j0.prototype.bytesPerElement=1,rr(j0,"StructArrayLayout1ub1");class B_ extends Zf{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}B_.prototype.size=40;class U_ extends z0{get(t){return new B_(this,t)}}rr(U_,"CollisionBoxArray");class V_ extends Zf{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(t){this._structArray.uint8[this._pos1+49]=t}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(t){this._structArray.uint8[this._pos1+50]=t}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(t){this._structArray.uint32[this._pos4+13]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(t){this._structArray.uint8[this._pos1+58]=t}}V_.prototype.size=60;class $_ extends Xc{get(t){return new V_(this,t)}}rr($_,"PlacedSymbolArray");class j_ extends Zf{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(t){this._structArray.uint32[this._pos4+14]=t}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(t){this._structArray.float32[this._pos4+18]=t}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}j_.prototype.size=80;class G_ extends Kf{get(t){return new j_(this,t)}}rr(G_,"SymbolInstanceArray");class H_ extends bh{getoffsetX(t){return this.float32[1*t+0]}}rr(H_,"GlyphOffsetArray");class Ah extends Is{getx(t){return this.int16[2*t+0]}gety(t){return this.int16[2*t+1]}}rr(Ah,"SymbolLineVertexArray");class W_ extends Zf{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}W_.prototype.size=12;class q_ extends Th{get(t){return new W_(this,t)}}rr(q_,"FeatureIndexArray");class Ch extends Js{geta_centroid_pos0(t){return this.uint16[2*t+0]}geta_centroid_pos1(t){return this.uint16[2*t+1]}}rr(Ch,"FillExtrusionCentroidArray");const $v=bn([{name:"a_pos",components:2,type:"Int16"}],4),Z_=bn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class ui{constructor(t=[]){this.segments=t}_prepareSegment(t,i,l,h){let d=this.segments[this.segments.length-1];return t>ui.MAX_VERTEX_ARRAY_LENGTH&&Tr(`Max vertices per segment is ${ui.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!d||d.vertexLength+t>ui.MAX_VERTEX_ARRAY_LENGTH||d.sortKey!==h)&&(d={vertexOffset:i,primitiveOffset:l,vertexLength:0,primitiveLength:0},h!==void 0&&(d.sortKey=h),this.segments.push(d)),d}prepareSegment(t,i,l,h){return this._prepareSegment(t,i.length,l.length,h)}get(){return this.segments}destroy(){for(const t of this.segments)for(const i in t.vaos)t.vaos[i].destroy()}static simpleSegment(t,i,l,h){return new ui([{vertexOffset:t,primitiveOffset:i,vertexLength:l,primitiveLength:h,vaos:{},sortKey:0}])}}function G0(r,t){return 256*(r=st(Math.floor(r),0,255))+st(Math.floor(t),0,255)}ui.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,rr(ui,"SegmentVector");const X_=bn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Y_=bn([{name:"a_dash",components:4,type:"Uint16"}]);var kh={exports:{}},Jf={exports:{}};(function(r){r.exports=function(t,i){var l,h,d,g,y,b,E,A;for(h=t.length-(l=3&t.length),d=i,y=3432918353,b=461845907,A=0;A<h;)E=255&t.charCodeAt(A)|(255&t.charCodeAt(++A))<<8|(255&t.charCodeAt(++A))<<16|(255&t.charCodeAt(++A))<<24,++A,d=27492+(65535&(g=5*(65535&(d=(d^=E=(65535&(E=(E=(65535&E)*y+(((E>>>16)*y&65535)<<16)&4294967295)<<15|E>>>17))*b+(((E>>>16)*b&65535)<<16)&4294967295)<<13|d>>>19))+((5*(d>>>16)&65535)<<16)&4294967295))+((58964+(g>>>16)&65535)<<16);switch(E=0,l){case 3:E^=(255&t.charCodeAt(A+2))<<16;case 2:E^=(255&t.charCodeAt(A+1))<<8;case 1:d^=E=(65535&(E=(E=(65535&(E^=255&t.charCodeAt(A)))*y+(((E>>>16)*y&65535)<<16)&4294967295)<<15|E>>>17))*b+(((E>>>16)*b&65535)<<16)&4294967295}return d^=t.length,d=2246822507*(65535&(d^=d>>>16))+((2246822507*(d>>>16)&65535)<<16)&4294967295,d=3266489909*(65535&(d^=d>>>13))+((3266489909*(d>>>16)&65535)<<16)&4294967295,(d^=d>>>16)>>>0}})(Jf);var H0=Jf.exports,K_={exports:{}};(function(r){r.exports=function(t,i){for(var l,h=t.length,d=i^h,g=0;h>=4;)l=1540483477*(65535&(l=255&t.charCodeAt(g)|(255&t.charCodeAt(++g))<<8|(255&t.charCodeAt(++g))<<16|(255&t.charCodeAt(++g))<<24))+((1540483477*(l>>>16)&65535)<<16),d=1540483477*(65535&d)+((1540483477*(d>>>16)&65535)<<16)^(l=1540483477*(65535&(l^=l>>>24))+((1540483477*(l>>>16)&65535)<<16)),h-=4,++g;switch(h){case 3:d^=(255&t.charCodeAt(g+2))<<16;case 2:d^=(255&t.charCodeAt(g+1))<<8;case 1:d=1540483477*(65535&(d^=255&t.charCodeAt(g)))+((1540483477*(d>>>16)&65535)<<16)}return d=1540483477*(65535&(d^=d>>>13))+((1540483477*(d>>>16)&65535)<<16),(d^=d>>>15)>>>0}})(K_);var J_=H0,Q_=K_.exports;kh.exports=J_,kh.exports.murmur3=J_,kh.exports.murmur2=Q_;var W0=Z(kh.exports);class Mh{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(t,i,l,h){this.ids.push(ex(t)),this.positions.push(i,l,h)}eachPosition(t,i){const l=ex(t);let h=0,d=this.ids.length-1;for(;h<d;){const g=h+d>>1;this.ids[g]>=l?d=g:h=g+1}for(;this.ids[h]===l;)i(this.positions[3*h],this.positions[3*h+1],this.positions[3*h+2]),h++}static serialize(t,i){const l=new Float64Array(t.ids),h=new Uint32Array(t.positions);return q0(l,h,0,l.length-1),i&&(i.add(l.buffer),i.add(h.buffer)),{ids:l,positions:h}}static deserialize(t){const i=new Mh;let l;i.ids=t.ids,i.positions=t.positions;for(const h of i.ids)h!==l&&i.uniqueIds.push(h),l=h;return i.indexed=!0,i}}function ex(r){const t=+r;return!isNaN(t)&&Number.MIN_SAFE_INTEGER<=t&&t<=Number.MAX_SAFE_INTEGER?t:W0(String(r))}function q0(r,t,i,l){for(;i<l;){const h=r[i+l>>1];let d=i-1,g=l+1;for(;;){do d++;while(r[d]<h);do g--;while(r[g]>h);if(d>=g)break;Qf(r,d,g),Qf(t,3*d,3*g),Qf(t,3*d+1,3*g+1),Qf(t,3*d+2,3*g+2)}g-i<l-g?(q0(r,t,i,g),i=g+1):(q0(r,t,g+1,l),l=g)}}function Qf(r,t,i){const l=r[t];r[t]=r[i],r[i]=l}rr(Mh,"FeaturePositionMap");class Co{constructor(t){this.gl=t.gl,this.initialized=!1}fetchUniformLocation(t,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(t,i),this.initialized=!0),!!this.location}}class ed extends Co{constructor(t){super(t),this.current=0}set(t,i,l){this.fetchUniformLocation(t,i)&&this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))}}class fa extends Co{constructor(t){super(t),this.current=0}set(t,i,l){this.fetchUniformLocation(t,i)&&this.current!==l&&(this.current=l,this.gl.uniform1f(this.location,l))}}class gl extends Co{constructor(t){super(t),this.current=[0,0]}set(t,i,l){this.fetchUniformLocation(t,i)&&(l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1])))}}class tx extends Co{constructor(t){super(t),this.current=[0,0,0]}set(t,i,l){this.fetchUniformLocation(t,i)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2])))}}class p extends Co{constructor(t){super(t),this.current=[0,0,0,0]}set(t,i,l){this.fetchUniformLocation(t,i)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]&&l[3]===this.current[3]||(this.current=l,this.gl.uniform4f(this.location,l[0],l[1],l[2],l[3])))}}class s extends Co{constructor(t){super(t),this.current=_i.transparent}set(t,i,l){this.fetchUniformLocation(t,i)&&(l.r===this.current.r&&l.g===this.current.g&&l.b===this.current.b&&l.a===this.current.a||(this.current=l,this.gl.uniform4f(this.location,l.r,l.g,l.b,l.a)))}}const c=new Float32Array(16);class m extends Co{constructor(t){super(t),this.current=c}set(t,i,l){if(this.fetchUniformLocation(t,i)){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(let h=1;h<16;h++)if(l[h]!==this.current[h]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}}}}const x=new Float32Array(9),v=new Float32Array(4);class S extends Co{constructor(t){super(t),this.current=v}set(t,i,l){if(this.fetchUniformLocation(t,i)){for(let h=0;h<4;h++)if(l[h]!==this.current[h]){this.current=l,this.gl.uniformMatrix2fv(this.location,!1,l);break}}}}function C(r){return[G0(255*r.r,255*r.g),G0(255*r.b,255*r.a)]}class I{constructor(t,i,l){this.value=t,this.uniformNames=i.map(h=>`u_${h}`),this.type=l}setUniform(t,i,l,h,d){i.set(t,d,h.constantOr(this.value))}getBinding(t,i){return this.type==="color"?new s(t):new fa(t)}}class D{constructor(t,i){this.uniformNames=i.map(l=>`u_${l}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(t){this.pixelRatio=t.pixelRatio||1,this.pattern=t.tl.concat(t.br)}setUniform(t,i,l,h,d){const g=d==="u_pattern"||d==="u_dash"?this.pattern:d==="u_pixel_ratio"?this.pixelRatio:null;g&&i.set(t,d,g)}getBinding(t,i){return i==="u_pattern"||i==="u_dash"?new p(t):new fa(t)}}class L{constructor(t,i,l,h){this.expression=t,this.type=l,this.maxValue=0,this.paintVertexAttributes=i.map(d=>({name:`a_${d}`,type:"Float32",components:l==="color"?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(t,i,l,h,d,g,y){const b=this.paintVertexArray.length,E=this.expression.evaluate(new ri(0,{brightness:g}),i,{},d,h,y);this.paintVertexArray.resize(t),this._setPaintValue(b,t,E)}updatePaintArray(t,i,l,h,d,g,y){const b=this.expression.evaluate({zoom:0,brightness:y},l,h,void 0,d);this._setPaintValue(t,i,b)}_setPaintValue(t,i,l){if(this.type==="color"){const h=C(l);for(let d=t;d<i;d++)this.paintVertexArray.emplace(d,h[0],h[1])}else{for(let h=t;h<i;h++)this.paintVertexArray.emplace(h,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class N{constructor(t,i,l,h,d,g){this.expression=t,this.uniformNames=i.map(y=>`u_${y}_t`),this.type=l,this.useIntegerZoom=h,this.zoom=d,this.maxValue=0,this.paintVertexAttributes=i.map(y=>({name:`a_${y}`,type:"Float32",components:l==="color"?4:2,offset:0})),this.paintVertexArray=new g}populatePaintArray(t,i,l,h,d,g,y){const b=this.expression.evaluate(new ri(this.zoom,{brightness:g}),i,{},d,h,y),E=this.expression.evaluate(new ri(this.zoom+1,{brightness:g}),i,{},d,h,y),A=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(A,t,b,E)}updatePaintArray(t,i,l,h,d,g,y){const b=this.expression.evaluate({zoom:this.zoom,brightness:y},l,h,void 0,d),E=this.expression.evaluate({zoom:this.zoom+1,brightness:y},l,h,void 0,d);this._setPaintValue(t,i,b,E)}_setPaintValue(t,i,l,h){if(this.type==="color"){const d=C(l),g=C(h);for(let y=t;y<i;y++)this.paintVertexArray.emplace(y,d[0],d[1],g[0],g[1])}else{for(let d=t;d<i;d++)this.paintVertexArray.emplace(d,l,h);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(h))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,i,l,h,d){const g=this.useIntegerZoom?Math.floor(l.zoom):l.zoom,y=st(this.expression.interpolationFactor(g,this.zoom,this.zoom+1),0,1);i.set(t,d,y)}getBinding(t,i){return new fa(t)}}class H{constructor(t,i,l,h,d){this.expression=t,this.layerId=d,this.paintVertexAttributes=(l==="array"?Y_:X_).members;for(let g=0;g<i.length;++g);this.paintVertexArray=new h}populatePaintArray(t,i,l){const h=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValues(h,t,i.patterns&&i.patterns[this.layerId],l)}updatePaintArray(t,i,l,h,d,g,y){this._setPaintValues(t,i,l.patterns&&l.patterns[this.layerId],g)}_setPaintValues(t,i,l,h){if(!h||!l)return;const d=h[l];if(!d)return;const{tl:g,br:y,pixelRatio:b}=d;for(let E=t;E<i;E++)this.paintVertexArray.emplace(E,g[0],g[1],y[0],y[1],b)}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class W{constructor(t,i,l=()=>!0){this.binders={},this._buffers=[];const h=[];for(const d in t.paint._values){const g=t.paint.get(d);if(!l(d)||!(g instanceof Wc&&Uf(g.property.specification)))continue;const y=ne(d,t.type),b=g.value,E=g.property.specification.type,A=!!g.property.useIntegerZoom,M=d==="line-dasharray"||d.endsWith("pattern"),P=d==="line-dasharray"&&t.layout.get("line-cap").value.kind!=="constant";if(b.kind!=="constant"||P)if(b.kind==="source"||P||M){const O=xe(d,E,"source");this.binders[d]=M?new H(b,y,E,O,t.id):new L(b,y,E,O),h.push(`/a_${d}`)}else{const O=xe(d,E,"composite");this.binders[d]=new N(b,y,E,A,i,O),h.push(`/z_${d}`)}else this.binders[d]=M?new D(b.value,y):new I(b.value,y,E),h.push(`/u_${d}`)}this.cacheKey=h.sort().join("")}getMaxValue(t){const i=this.binders[t];return i instanceof L||i instanceof N?i.maxValue:0}populatePaintArrays(t,i,l,h,d,g,y){for(const b in this.binders){const E=this.binders[b];(E instanceof L||E instanceof N||E instanceof H)&&E.populatePaintArray(t,i,l,h,d,g,y)}}setConstantPatternPositions(t){for(const i in this.binders){const l=this.binders[i];l instanceof D&&l.setConstantPatternPositions(t)}}updatePaintArrays(t,i,l,h,d,g,y,b){let E=!1;const A=Object.keys(t),M=A.length!==0,P=M?A:i.uniqueIds;for(const O in this.binders){const z=this.binders[O];if((z instanceof L||z instanceof N||z instanceof H)&&(z.expression.isStateDependent===!0||z.expression.isLightConstant===!1)){const j=d.paint.get(O);z.expression=j.value;for(const q of P){const Q=t[q.toString()];i.eachPosition(q,(oe,pe,de)=>{const Ce=h.feature(oe);z.updatePaintArray(pe,de,Ce,Q,g,y,b)})}if(!M)for(const q of l.uniqueIds){const Q=t[q.toString()];l.eachPosition(q,(oe,pe,de)=>{const Ce=h.feature(oe);z.updatePaintArray(pe,de,Ce,Q,g,y,b)})}E=!0}}return E}defines(){const t=[];for(const i in this.binders){const l=this.binders[i];(l instanceof I||l instanceof D)&&t.push(...l.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return t}getBinderAttributes(){const t=[];for(const i in this.binders){const l=this.binders[i];if(l instanceof L||l instanceof N||l instanceof H)for(let h=0;h<l.paintVertexAttributes.length;h++)t.push(l.paintVertexAttributes[h].name)}return t}getBinderUniforms(){const t=[];for(const i in this.binders){const l=this.binders[i];if(l instanceof I||l instanceof D||l instanceof N)for(const h of l.uniformNames)t.push(h)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t){const i=[];for(const l in this.binders){const h=this.binders[l];if(h instanceof I||h instanceof D||h instanceof N)for(const d of h.uniformNames)i.push({name:d,property:l,binding:h.getBinding(t,d)})}return i}setUniforms(t,i,l,h,d){for(const{name:g,property:y,binding:b}of l)this.binders[y].setUniform(t,b,d,h.get(y),g)}updatePaintBuffers(){this._buffers=[];for(const t in this.binders){const i=this.binders[t];(i instanceof L||i instanceof N||i instanceof H)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}}upload(t){for(const i in this.binders){const l=this.binders[i];(l instanceof L||l instanceof N||l instanceof H)&&l.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const i=this.binders[t];(i instanceof L||i instanceof N||i instanceof H)&&i.destroy()}}}class te{constructor(t,i,l=()=>!0){this.programConfigurations={};for(const h of t)this.programConfigurations[h.id]=new W(h,i,l);this.needsUpload=!1,this._featureMap=new Mh,this._featureMapWithoutIds=new Mh,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(t,i,l,h,d,g,y,b){for(const E in this.programConfigurations)this.programConfigurations[E].populatePaintArrays(t,i,h,d,g,y,b);i.id!==void 0?this._featureMap.add(i.id,l,this._bufferOffset,t):(this._featureMapWithoutIds.add(this._idlessCounter,l,this._bufferOffset,t),this._idlessCounter+=1),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,i,l,h,d,g){for(const y of l)this.needsUpload=this.programConfigurations[y.id].updatePaintArrays(t,this._featureMap,this._featureMapWithoutIds,i,y,h,d,g||0)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}const ee={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function ne(r,t){return ee[r]||[r.replace(`${t}-`,"").replace(/-/g,"_")]}const K={"line-pattern":{source:pl,composite:pl},"fill-pattern":{source:pl,composite:pl},"fill-extrusion-pattern":{source:pl,composite:pl},"line-dasharray":{source:Zc,composite:Zc}},ae={color:{source:Eh,composite:dl},number:{source:bh,composite:Eh}};function xe(r,t,i){const l=K[r];return l&&l[i]||ae[t][i]}rr(I,"ConstantBinder"),rr(D,"PatternConstantBinder"),rr(L,"SourceExpressionBinder"),rr(H,"PatternCompositeBinder"),rr(N,"CompositeExpressionBinder"),rr(W,"ProgramConfiguration",{omit:["_buffers"]}),rr(te,"ProgramConfigurationSet");const ue=Kt/Math.PI/2,ye=5,ie=6,ve=16383,Pe=64,Fe=[Pe,32,16],$e=-ue,nt=ue;function Ge(r,t,i,l=ue){return i=Re(i),[r*Math.sin(i)*l,-t*l,r*Math.cos(i)*l]}function ft(r,t,i){return Ge(Math.cos(Re(r)),Math.sin(Re(r)),t,i)}const ct=63710088e-1,Ct=2*Math.PI*ct;class qe{constructor(t,i){if(isNaN(t)||isNaN(i))throw new Error(`Invalid LngLat object: (${t}, ${i})`);if(this.lng=+t,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new qe(Et(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const i=Math.PI/180,l=this.lat*i,h=t.lat*i,d=Math.sin(l)*Math.sin(h)+Math.cos(l)*Math.cos(h)*Math.cos((t.lng-this.lng)*i);return ct*Math.acos(Math.min(d,1))}toBounds(t=0){const i=360*t/40075017,l=i/Math.cos(Math.PI/180*this.lat);return new ot({lng:this.lng-l,lat:this.lat-i},{lng:this.lng+l,lat:this.lat+i})}toEcef(t){return ft(this.lat,this.lng,ue+t*ue/ct)}static convert(t){if(t instanceof qe)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new qe(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new qe(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class ot{constructor(t,i){t&&(i?this.setSouthWest(t).setNorthEast(i):t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}setNorthEast(t){return this._ne=t instanceof qe?new qe(t.lng,t.lat):qe.convert(t),this}setSouthWest(t){return this._sw=t instanceof qe?new qe(t.lng,t.lat):qe.convert(t),this}extend(t){const i=this._sw,l=this._ne;let h,d;if(t instanceof qe)h=t,d=t;else{if(!(t instanceof ot))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(ot.convert(t)):this.extend(qe.convert(t)):typeof t=="object"&&t!==null&&t.hasOwnProperty("lat")&&(t.hasOwnProperty("lon")||t.hasOwnProperty("lng"))?this.extend(qe.convert(t)):this;if(h=t._sw,d=t._ne,!h||!d)return this}return i||l?(i.lng=Math.min(h.lng,i.lng),i.lat=Math.min(h.lat,i.lat),l.lng=Math.max(d.lng,l.lng),l.lat=Math.max(d.lat,l.lat)):(this._sw=new qe(h.lng,h.lat),this._ne=new qe(d.lng,d.lat)),this}getCenter(){return new qe((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new qe(this.getWest(),this.getNorth())}getSouthEast(){return new qe(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:i,lat:l}=qe.convert(t);let h=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&h}static convert(t){return!t||t instanceof ot?t:new ot(t)}}var Ue={};(function(r,t){(function(i){function l(d,g,y){var b=h(256*d,256*(g=Math.pow(2,y)-g-1),y),E=h(256*(d+1),256*(g+1),y);return b[0]+","+b[1]+","+E[0]+","+E[1]}function h(d,g,y){var b=2*Math.PI*6378137/256/Math.pow(2,y);return[d*b-2*Math.PI*6378137/2,g*b-2*Math.PI*6378137/2]}i.getURL=function(d,g,y,b,E,A){return A=A||{},d+"?"+["bbox="+l(y,b,E),"format="+(A.format||"image/png"),"service="+(A.service||"WMS"),"version="+(A.version||"1.1.1"),"request="+(A.request||"GetMap"),"srs="+(A.srs||"EPSG:3857"),"width="+(A.width||256),"height="+(A.height||256),"layers="+g].join("&")},i.getTileBBox=l,i.getMercCoords=h,Object.defineProperty(i,"__esModule",{value:!0})})(t)})(0,Ue);var Qe=Ue;class Mt{constructor(t,i,l){this.z=t,this.x=i,this.y=l,this.key=Yt(0,t,t,i,l)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,i){const l=Qe.getTileBBox(this.x,this.y,this.z),h=function(d,g,y){let b,E="";for(let A=d;A>0;A--)b=1<<A-1,E+=(g&b?1:0)+(y&b?2:0);return E}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",h).replace("{bbox-epsg-3857}",l)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Ut{constructor(t,i){this.wrap=t,this.canonical=i,this.key=Yt(t,i.z,i.z,i.x,i.y)}}class Bt{constructor(t,i,l,h,d){this.overscaledZ=t,this.wrap=i,this.canonical=new Mt(l,+h,+d),this.key=i===0&&t===l?this.canonical.key:Yt(i,t,l,h,d)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){const i=this.canonical.z-t;return t>this.canonical.z?new Bt(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Bt(t,this.wrap,t,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(t,i=!0){if(this.overscaledZ===t&&i)return this.key;if(t>this.canonical.z)return Yt(this.wrap*+i,t,this.canonical.z,this.canonical.x,this.canonical.y);{const l=this.canonical.z-t;return Yt(this.wrap*+i,t,t,this.canonical.x>>l,this.canonical.y>>l)}}isChildOf(t){if(t.wrap!==this.wrap)return!1;const i=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.z<this.canonical.z&&t.canonical.x===this.canonical.x>>i&&t.canonical.y===this.canonical.y>>i}children(t){if(this.overscaledZ>=t)return[new Bt(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,l=2*this.canonical.x,h=2*this.canonical.y;return[new Bt(i,this.wrap,i,l,h),new Bt(i,this.wrap,i,l+1,h),new Bt(i,this.wrap,i,l,h+1),new Bt(i,this.wrap,i,l+1,h+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Bt(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Bt(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Ut(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Yt(r,t,i,l,h){const d=1<<Math.min(i,22);let g=d*(h%d)+l%d;return r&&i<22&&(g+=d*d*((r<0?-2*r-1:2*r)%(1<<2*(22-i)))),16*(32*g+i)+(t-i)}const or=[r=>{let t=r.canonical.x-1,i=r.wrap;return t<0&&(t=(1<<r.canonical.z)-1,i--),new Bt(r.overscaledZ,i,r.canonical.z,t,r.canonical.y)},r=>{let t=r.canonical.x+1,i=r.wrap;return t===1<<r.canonical.z&&(t=0,i++),new Bt(r.overscaledZ,i,r.canonical.z,t,r.canonical.y)},r=>new Bt(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,(r.canonical.y===0?1<<r.canonical.z:r.canonical.y)-1),r=>new Bt(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y===(1<<r.canonical.z)-1?0:r.canonical.y+1)];rr(Mt,"CanonicalTileID"),rr(Bt,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const pr=0,ur=25.5;function fr(r){return Ct*Math.cos(r*Math.PI/180)}function zr(r){return(180+r)/360}function Sr(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function Pr(r,t){return r/fr(t)}function Mr(r){return 360*r-180}function en(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}function Ln(r,t){return r*fr(en(t))}const Wr=85.051129;function ii(r){return Math.cos(Re(st(r,-Wr,Wr)))}function qr(r,t){const i=st(t,pr,ur),l=Math.pow(2,i);return ii(r)*Ct/(512*l)}function un(r){return 1/Math.cos(r*Math.PI/180)}function Zr(r,t=0){const i=Math.exp(Math.PI*(1-(r.y+t/Kt)/(1<<r.z)*2));return 80150034*i/(i*i+1)/Kt/(1<<r.z)}class sn{constructor(t,i,l=0){this.x=+t,this.y=+i,this.z=+l}static fromLngLat(t,i=0){const l=qe.convert(t);return new sn(zr(l.lng),Sr(l.lat),Pr(i,l.lat))}toLngLat(){return new qe(Mr(this.x),en(this.y))}toAltitude(){return Ln(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Ct*un(en(this.y))}}function Bn(r,t,i,l,h,d,g,y,b){const E=(t+l)/2,A=(i+h)/2,M=new we(E,A);y(M),function(P,O,z,j,q,Q){const oe=z-q,pe=j-Q;return Math.abs((j-O)*oe-(z-P)*pe)/Math.hypot(oe,pe)}(M.x,M.y,d.x,d.y,g.x,g.y)>=b?(Bn(r,t,i,E,A,d,M,y,b),Bn(r,E,A,l,h,M,g,y,b)):r.push(g)}function mn(r,t,i){let l=r[0],h=l.x,d=l.y;t(l);const g=[l];for(let y=1;y<r.length;y++){const b=r[y],{x:E,y:A}=b;t(b),Bn(g,h,d,E,A,l,b,t,i),h=E,d=A,l=b}return g}function Ni(r,t,i,l){if(l(t,i)){const h=t.add(i)._mult(.5);Ni(r,t,h,l),Ni(r,h,i,l)}else r.push(i)}function Ji(r,t){let i=r[0];const l=[i];for(let h=1;h<r.length;h++){const d=r[h];Ni(l,i,d,t),i=d}return l}const Fa=Math.pow(2,14)-1,Qs=-Fa-1;function La(r,t){const i=Math.round(r.x*t),l=Math.round(r.y*t);return r.x=st(i,Qs,Fa),r.y=st(l,Qs,Fa),(i<r.x||i>r.x+1||l<r.y||l>r.y+1)&&Tr("Geometry exceeds allowed extent, reduce your vector tile buffer size"),r}function zi(r,t,i){const l=r.loadGeometry(),h=r.extent,d=Kt/h;if(t&&i&&i.projection.isReprojectedInTileSpace){const g=1<<t.z,{scale:y,x:b,y:E,projection:A}=i,M=P=>{const O=Mr((t.x+P.x/h)/g),z=en((t.y+P.y/h)/g),j=A.project(O,z);P.x=(j.x*y-b)*h,P.y=(j.y*y-E)*h};for(let P=0;P<l.length;P++)if(r.type!==1)l[P]=mn(l[P],M,1);else{const O=[];for(const z of l[P])z.x<0||z.x>=h||z.y<0||z.y>=h||(M(z),O.push(z));l[P]=O}}for(const g of l)for(const y of g)La(y,d);return l}function Ai(r,t){return{type:r.type,id:r.id,properties:r.properties,geometry:t?zi(r):[]}}function da(r,t,i,l,h){r.emplaceBack(2*t+(l+1)/2,2*i+(h+1)/2)}function wa(r,t,i){r.emplaceBack(t.x,t.y,t.z,i[0]*16384,i[1]*16384,i[2]*16384)}class Oa{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=t.index,this.hasPattern=!1,this.projection=t.projection,this.layoutVertexArray=new Is,this.indexArray=new Oi,this.segments=new ui,this.programConfigurations=new te(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(t,i,l,h){const d=this.layers[0],g=[];let y=null;d.type==="circle"&&(y=d.layout.get("circle-sort-key"));for(const{feature:E,id:A,index:M,sourceLayerIndex:P}of t){const O=this.layers[0]._featureFilter.needGeometry,z=Ai(E,O);if(!this.layers[0]._featureFilter.filter(new ri(this.zoom),z,l))continue;const j=y?y.evaluate(z,{},l):void 0,q={id:A,properties:E.properties,type:E.type,sourceLayerIndex:P,index:M,geometry:O?z.geometry:zi(E,l,h),patterns:{},sortKey:j};g.push(q)}y&&g.sort((E,A)=>E.sortKey-A.sortKey);let b=null;h.projection.name==="globe"&&(this.globeExtVertexArray=new Xf,b=h.projection);for(const E of g){const{geometry:A,index:M,sourceLayerIndex:P}=E,O=t[M].feature;this.addFeature(E,A,M,i.availableImages,l,b,i.brightness),i.featureIndex.insert(O,A,M,P,this.index)}}update(t,i,l,h,d){const g=Object.keys(t).length!==0;g&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,i,g?this.stateDependentLayers:this.layers,l,h,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,$v.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,Z_.members))),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(t,i,l,h,d,g,y){for(const b of i)for(const E of b){const A=E.x,M=E.y;if(A<0||A>=Kt||M<0||M>=Kt)continue;if(g){const z=g.projectTilePoint(A,M,d),j=g.upVector(d,A,M),q=this.globeExtVertexArray;wa(q,z,j),wa(q,z,j),wa(q,z,j),wa(q,z,j)}const P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),O=P.vertexLength;da(this.layoutVertexArray,A,M,-1,-1),da(this.layoutVertexArray,A,M,1,-1),da(this.layoutVertexArray,A,M,1,1),da(this.layoutVertexArray,A,M,-1,1),this.indexArray.emplaceBack(O,O+1,O+2),this.indexArray.emplaceBack(O,O+2,O+3),P.vertexLength+=4,P.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,{},h,d,y)}}function eo(r,t){for(let i=0;i<r.length;i++)if(ko(t,r[i]))return!0;for(let i=0;i<t.length;i++)if(ko(r,t[i]))return!0;return!!Ph(r,t)}function _l(r,t,i){return!!ko(r,t)||!!Rh(t,r,i)}function Jl(r,t){if(r.length===1)return td(t,r[0]);for(let i=0;i<t.length;i++){const l=t[i];for(let h=0;h<l.length;h++)if(ko(r,l[h]))return!0}for(let i=0;i<r.length;i++)if(td(t,r[i]))return!0;for(let i=0;i<t.length;i++)if(Ph(r,t[i]))return!0;return!1}function Ih(r,t,i){if(r.length>1){if(Ph(r,t))return!0;for(let l=0;l<t.length;l++)if(Rh(t[l],r,i))return!0}for(let l=0;l<r.length;l++)if(Rh(r[l],t,i))return!0;return!1}function Ph(r,t){if(r.length===0||t.length===0)return!1;for(let i=0;i<r.length-1;i++){const l=r[i],h=r[i+1];for(let d=0;d<t.length-1;d++)if(Z0(l,h,t[d],t[d+1]))return!0}return!1}function Z0(r,t,i,l){return Er(r,i,l)!==Er(t,i,l)&&Er(r,t,i)!==Er(r,t,l)}function Rh(r,t,i){const l=i*i;if(t.length===1)return r.distSqr(t[0])<l;for(let h=1;h<t.length;h++)if(Yc(r,t[h-1],t[h])<l)return!0;return!1}function Yc(r,t,i){const l=t.distSqr(i);if(l===0)return r.distSqr(t);const h=((r.x-t.x)*(i.x-t.x)+(r.y-t.y)*(i.y-t.y))/l;return r.distSqr(h<0?t:h>1?i:i.sub(t)._mult(h)._add(t))}function td(r,t){let i,l,h,d=!1;for(let g=0;g<r.length;g++){i=r[g];for(let y=0,b=i.length-1;y<i.length;b=y++)l=i[y],h=i[b],l.y>t.y!=h.y>t.y&&t.x<(h.x-l.x)*(t.y-l.y)/(h.y-l.y)+l.x&&(d=!d)}return d}function ko(r,t){let i=!1;for(let l=0,h=r.length-1;l<r.length;h=l++){const d=r[l],g=r[h];d.y>t.y!=g.y>t.y&&t.x<(g.x-d.x)*(t.y-d.y)/(g.y-d.y)+d.x&&(i=!i)}return i}function vA(r,t,i,l,h){for(const g of r)if(t<=g.x&&i<=g.y&&l>=g.x&&h>=g.y)return!0;const d=[new we(t,i),new we(t,h),new we(l,h),new we(l,i)];if(r.length>2){for(const g of d)if(ko(r,g))return!0}for(let g=0;g<r.length-1;g++)if(d5(r[g],r[g+1],d))return!0;return!1}function d5(r,t,i){const l=i[0],h=i[2];if(r.x<l.x&&t.x<l.x||r.x>h.x&&t.x>h.x||r.y<l.y&&t.y<l.y||r.y>h.y&&t.y>h.y)return!1;const d=Er(r,t,i[0]);return d!==Er(r,t,i[1])||d!==Er(r,t,i[2])||d!==Er(r,t,i[3])}function rd(r,t,i,l,h,d){let g=t.y-r.y,y=r.x-t.x;if(d=d||0){const b=g*g+y*y;if(b===0)return!0;const E=Math.sqrt(b);g/=E,y/=E}return!((i.x-r.x)*g+(i.y-r.y)*y-d<0||(l.x-r.x)*g+(l.y-r.y)*y-d<0||(h.x-r.x)*g+(h.y-r.y)*y-d<0)}function jv(r,t,i,l,h,d,g){return!(rd(r,t,l,h,d,g)||rd(t,i,l,h,d,g)||rd(i,r,l,h,d,g)||rd(l,h,r,t,i,g)||rd(h,d,r,t,i,g)||rd(d,l,r,t,i,g))}function nd(r,t,i){const l=t.paint.get(r).value;return l.kind==="constant"?l.value:i.programConfigurations.get(t.id).getMaxValue(r)}function rx(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function wA(r,t,i,l,h){if(!t[0]&&!t[1])return r;const d=we.convert(t)._mult(h);i==="viewport"&&d._rotate(-l);const g=[];for(let y=0;y<r.length;y++)g.push(r[y].sub(d));return g}function bA(r,t,i,l){const h=we.convert(r)._mult(l);return t==="viewport"&&h._rotate(-i),h}rr(Oa,"CircleBucket",{omit:["layers"]});const p5=new ni({"circle-sort-key":new mr(tt.layout_circle["circle-sort-key"]),visibility:new jt(tt.layout_circle.visibility)});var m5={paint:new ni({"circle-radius":new mr(tt.paint_circle["circle-radius"]),"circle-color":new mr(tt.paint_circle["circle-color"]),"circle-blur":new mr(tt.paint_circle["circle-blur"]),"circle-opacity":new mr(tt.paint_circle["circle-opacity"]),"circle-translate":new jt(tt.paint_circle["circle-translate"]),"circle-translate-anchor":new jt(tt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new jt(tt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new jt(tt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new mr(tt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new mr(tt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new mr(tt.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new jt(tt.paint_circle["circle-emissive-strength"])}),layout:p5},$i={},ji={};Object.defineProperty(ji,"__esModule",{value:!0}),ji.setMatrixArrayType=function(r){ji.ARRAY_TYPE=EA=r},ji.toRadian=function(r){return r*_5},ji.equals=function(r,t){return Math.abs(r-t)<=TA*Math.max(1,Math.abs(r),Math.abs(t))},ji.RANDOM=ji.ARRAY_TYPE=ji.EPSILON=void 0;var TA=1e-6;ji.EPSILON=TA;var EA=typeof Float32Array<"u"?Float32Array:Array;ji.ARRAY_TYPE=EA;var g5=Math.random;ji.RANDOM=g5;var _5=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var r=0,t=arguments.length;t--;)r+=arguments[t]*arguments[t];return Math.sqrt(r)});var ai={};function Gv(r){return Gv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Gv(r)}Object.defineProperty(ai,"__esModule",{value:!0}),ai.create=function(){var r=new Kc.ARRAY_TYPE(4);return Kc.ARRAY_TYPE!=Float32Array&&(r[1]=0,r[2]=0),r[0]=1,r[3]=1,r},ai.clone=function(r){var t=new Kc.ARRAY_TYPE(4);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t},ai.copy=function(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r},ai.identity=function(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=1,r},ai.fromValues=function(r,t,i,l){var h=new Kc.ARRAY_TYPE(4);return h[0]=r,h[1]=t,h[2]=i,h[3]=l,h},ai.set=function(r,t,i,l,h){return r[0]=t,r[1]=i,r[2]=l,r[3]=h,r},ai.transpose=function(r,t){if(r===t){var i=t[1];r[1]=t[2],r[2]=i}else r[0]=t[0],r[1]=t[2],r[2]=t[1],r[3]=t[3];return r},ai.invert=function(r,t){var i=t[0],l=t[1],h=t[2],d=t[3],g=i*d-h*l;return g?(r[0]=d*(g=1/g),r[1]=-l*g,r[2]=-h*g,r[3]=i*g,r):null},ai.adjoint=function(r,t){var i=t[0];return r[0]=t[3],r[1]=-t[1],r[2]=-t[2],r[3]=i,r},ai.determinant=function(r){return r[0]*r[3]-r[2]*r[1]},ai.multiply=AA,ai.rotate=function(r,t,i){var l=t[0],h=t[1],d=t[2],g=t[3],y=Math.sin(i),b=Math.cos(i);return r[0]=l*b+d*y,r[1]=h*b+g*y,r[2]=l*-y+d*b,r[3]=h*-y+g*b,r},ai.scale=function(r,t,i){var l=t[1],h=t[2],d=t[3],g=i[0],y=i[1];return r[0]=t[0]*g,r[1]=l*g,r[2]=h*y,r[3]=d*y,r},ai.fromRotation=function(r,t){var i=Math.sin(t),l=Math.cos(t);return r[0]=l,r[1]=i,r[2]=-i,r[3]=l,r},ai.fromScaling=function(r,t){return r[0]=t[0],r[1]=0,r[2]=0,r[3]=t[1],r},ai.str=function(r){return"mat2("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+")"},ai.frob=function(r){return Math.hypot(r[0],r[1],r[2],r[3])},ai.LDU=function(r,t,i,l){return r[2]=l[2]/l[0],i[0]=l[0],i[1]=l[1],i[3]=l[3]-r[2]*i[1],[r,t,i]},ai.add=function(r,t,i){return r[0]=t[0]+i[0],r[1]=t[1]+i[1],r[2]=t[2]+i[2],r[3]=t[3]+i[3],r},ai.subtract=CA,ai.exactEquals=function(r,t){return r[0]===t[0]&&r[1]===t[1]&&r[2]===t[2]&&r[3]===t[3]},ai.equals=function(r,t){var i=r[0],l=r[1],h=r[2],d=r[3],g=t[0],y=t[1],b=t[2],E=t[3];return Math.abs(i-g)<=Kc.EPSILON*Math.max(1,Math.abs(i),Math.abs(g))&&Math.abs(l-y)<=Kc.EPSILON*Math.max(1,Math.abs(l),Math.abs(y))&&Math.abs(h-b)<=Kc.EPSILON*Math.max(1,Math.abs(h),Math.abs(b))&&Math.abs(d-E)<=Kc.EPSILON*Math.max(1,Math.abs(d),Math.abs(E))},ai.multiplyScalar=function(r,t,i){return r[0]=t[0]*i,r[1]=t[1]*i,r[2]=t[2]*i,r[3]=t[3]*i,r},ai.multiplyScalarAndAdd=function(r,t,i,l){return r[0]=t[0]+i[0]*l,r[1]=t[1]+i[1]*l,r[2]=t[2]+i[2]*l,r[3]=t[3]+i[3]*l,r},ai.sub=ai.mul=void 0;var Kc=function(r,t){if(r&&r.__esModule)return r;if(r===null||Gv(r)!=="object"&&typeof r!="function")return{default:r};var i=SA(void 0);if(i&&i.has(r))return i.get(r);var l={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in r)if(d!=="default"&&Object.prototype.hasOwnProperty.call(r,d)){var g=h?Object.getOwnPropertyDescriptor(r,d):null;g&&(g.get||g.set)?Object.defineProperty(l,d,g):l[d]=r[d]}return l.default=r,i&&i.set(r,l),l}(ji);function SA(r){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(SA=function(l){return l?i:t})(r)}function AA(r,t,i){var l=t[0],h=t[1],d=t[2],g=t[3],y=i[0],b=i[1],E=i[2],A=i[3];return r[0]=l*y+d*b,r[1]=h*y+g*b,r[2]=l*E+d*A,r[3]=h*E+g*A,r}function CA(r,t,i){return r[0]=t[0]-i[0],r[1]=t[1]-i[1],r[2]=t[2]-i[2],r[3]=t[3]-i[3],r}ai.mul=AA,ai.sub=CA;var oi={};function Hv(r){return Hv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Hv(r)}Object.defineProperty(oi,"__esModule",{value:!0}),oi.create=function(){var r=new xl.ARRAY_TYPE(6);return xl.ARRAY_TYPE!=Float32Array&&(r[1]=0,r[2]=0,r[4]=0,r[5]=0),r[0]=1,r[3]=1,r},oi.clone=function(r){var t=new xl.ARRAY_TYPE(6);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t},oi.copy=function(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r},oi.identity=function(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=1,r[4]=0,r[5]=0,r},oi.fromValues=function(r,t,i,l,h,d){var g=new xl.ARRAY_TYPE(6);return g[0]=r,g[1]=t,g[2]=i,g[3]=l,g[4]=h,g[5]=d,g},oi.set=function(r,t,i,l,h,d,g){return r[0]=t,r[1]=i,r[2]=l,r[3]=h,r[4]=d,r[5]=g,r},oi.invert=function(r,t){var i=t[0],l=t[1],h=t[2],d=t[3],g=t[4],y=t[5],b=i*d-l*h;return b?(r[0]=d*(b=1/b),r[1]=-l*b,r[2]=-h*b,r[3]=i*b,r[4]=(h*y-d*g)*b,r[5]=(l*g-i*y)*b,r):null},oi.determinant=function(r){return r[0]*r[3]-r[1]*r[2]},oi.multiply=MA,oi.rotate=function(r,t,i){var l=t[0],h=t[1],d=t[2],g=t[3],y=t[4],b=t[5],E=Math.sin(i),A=Math.cos(i);return r[0]=l*A+d*E,r[1]=h*A+g*E,r[2]=l*-E+d*A,r[3]=h*-E+g*A,r[4]=y,r[5]=b,r},oi.scale=function(r,t,i){var l=t[1],h=t[2],d=t[3],g=t[4],y=t[5],b=i[0],E=i[1];return r[0]=t[0]*b,r[1]=l*b,r[2]=h*E,r[3]=d*E,r[4]=g,r[5]=y,r},oi.translate=function(r,t,i){var l=t[0],h=t[1],d=t[2],g=t[3],y=t[4],b=t[5],E=i[0],A=i[1];return r[0]=l,r[1]=h,r[2]=d,r[3]=g,r[4]=l*E+d*A+y,r[5]=h*E+g*A+b,r},oi.fromRotation=function(r,t){var i=Math.sin(t),l=Math.cos(t);return r[0]=l,r[1]=i,r[2]=-i,r[3]=l,r[4]=0,r[5]=0,r},oi.fromScaling=function(r,t){return r[0]=t[0],r[1]=0,r[2]=0,r[3]=t[1],r[4]=0,r[5]=0,r},oi.fromTranslation=function(r,t){return r[0]=1,r[1]=0,r[2]=0,r[3]=1,r[4]=t[0],r[5]=t[1],r},oi.str=function(r){return"mat2d("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+", "+r[4]+", "+r[5]+")"},oi.frob=function(r){return Math.hypot(r[0],r[1],r[2],r[3],r[4],r[5],1)},oi.add=function(r,t,i){return r[0]=t[0]+i[0],r[1]=t[1]+i[1],r[2]=t[2]+i[2],r[3]=t[3]+i[3],r[4]=t[4]+i[4],r[5]=t[5]+i[5],r},oi.subtract=IA,oi.multiplyScalar=function(r,t,i){return r[0]=t[0]*i,r[1]=t[1]*i,r[2]=t[2]*i,r[3]=t[3]*i,r[4]=t[4]*i,r[5]=t[5]*i,r},oi.multiplyScalarAndAdd=function(r,t,i,l){return r[0]=t[0]+i[0]*l,r[1]=t[1]+i[1]*l,r[2]=t[2]+i[2]*l,r[3]=t[3]+i[3]*l,r[4]=t[4]+i[4]*l,r[5]=t[5]+i[5]*l,r},oi.exactEquals=function(r,t){return r[0]===t[0]&&r[1]===t[1]&&r[2]===t[2]&&r[3]===t[3]&&r[4]===t[4]&&r[5]===t[5]},oi.equals=function(r,t){var i=r[0],l=r[1],h=r[2],d=r[3],g=r[4],y=r[5],b=t[0],E=t[1],A=t[2],M=t[3],P=t[4],O=t[5];return Math.abs(i-b)<=xl.EPSILON*Math.max(1,Math.abs(i),Math.abs(b))&&Math.abs(l-E)<=xl.EPSILON*Math.max(1,Math.abs(l),Math.abs(E))&&Math.abs(h-A)<=xl.EPSILON*Math.max(1,Math.abs(h),Math.abs(A))&&Math.abs(d-M)<=xl.EPSILON*Math.max(1,Math.abs(d),Math.abs(M))&&Math.abs(g-P)<=xl.EPSILON*Math.max(1,Math.abs(g),Math.abs(P))&&Math.abs(y-O)<=xl.EPSILON*Math.max(1,Math.abs(y),Math.abs(O))},oi.sub=oi.mul=void 0;var xl=function(r,t){if(r&&r.__esModule)return r;if(r===null||Hv(r)!=="object"&&typeof r!="function")return{default:r};var i=kA(void 0);if(i&&i.has(r))return i.get(r);var l={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in r)if(d!=="default"&&Object.prototype.hasOwnProperty.call(r,d)){var g=h?Object.getOwnPropertyDescriptor(r,d):null;g&&(g.get||g.set)?Object.defineProperty(l,d,g):l[d]=r[d]}return l.default=r,i&&i.set(r,l),l}(ji);function kA(r){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(kA=function(l){return l?i:t})(r)}function MA(r,t,i){var l=t[0],h=t[1],d=t[2],g=t[3],y=t[4],b=t[5],E=i[0],A=i[1],M=i[2],P=i[3],O=i[4],z=i[5];return r[0]=l*E+d*A,r[1]=h*E+g*A,r[2]=l*M+d*P,r[3]=h*M+g*P,r[4]=l*O+d*z+y,r[5]=h*O+g*z+b,r}function IA(r,t,i){return r[0]=t[0]-i[0],r[1]=t[1]-i[1],r[2]=t[2]-i[2],r[3]=t[3]-i[3],r[4]=t[4]-i[4],r[5]=t[5]-i[5],r}oi.mul=MA,oi.sub=IA;var Pn={};function Wv(r){return Wv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Wv(r)}Object.defineProperty(Pn,"__esModule",{value:!0}),Pn.create=function(){var r=new Ps.ARRAY_TYPE(9);return Ps.ARRAY_TYPE!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r},Pn.fromMat4=function(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[4],r[4]=t[5],r[5]=t[6],r[6]=t[8],r[7]=t[9],r[8]=t[10],r},Pn.clone=function(r){var t=new Ps.ARRAY_TYPE(9);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t},Pn.copy=function(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r},Pn.fromValues=function(r,t,i,l,h,d,g,y,b){var E=new Ps.ARRAY_TYPE(9);return E[0]=r,E[1]=t,E[2]=i,E[3]=l,E[4]=h,E[5]=d,E[6]=g,E[7]=y,E[8]=b,E},Pn.set=function(r,t,i,l,h,d,g,y,b,E){return r[0]=t,r[1]=i,r[2]=l,r[3]=h,r[4]=d,r[5]=g,r[6]=y,r[7]=b,r[8]=E,r},Pn.identity=function(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=1,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r},Pn.transpose=function(r,t){if(r===t){var i=t[1],l=t[2],h=t[5];r[1]=t[3],r[2]=t[6],r[3]=i,r[5]=t[7],r[6]=l,r[7]=h}else r[0]=t[0],r[1]=t[3],r[2]=t[6],r[3]=t[1],r[4]=t[4],r[5]=t[7],r[6]=t[2],r[7]=t[5],r[8]=t[8];return r},Pn.invert=function(r,t){var i=t[0],l=t[1],h=t[2],d=t[3],g=t[4],y=t[5],b=t[6],E=t[7],A=t[8],M=A*g-y*E,P=-A*d+y*b,O=E*d-g*b,z=i*M+l*P+h*O;return z?(r[0]=M*(z=1/z),r[1]=(-A*l+h*E)*z,r[2]=(y*l-h*g)*z,r[3]=P*z,r[4]=(A*i-h*b)*z,r[5]=(-y*i+h*d)*z,r[6]=O*z,r[7]=(-E*i+l*b)*z,r[8]=(g*i-l*d)*z,r):null},Pn.adjoint=function(r,t){var i=t[0],l=t[1],h=t[2],d=t[3],g=t[4],y=t[5],b=t[6],E=t[7],A=t[8];return r[0]=g*A-y*E,r[1]=h*E-l*A,r[2]=l*y-h*g,r[3]=y*b-d*A,r[4]=i*A-h*b,r[5]=h*d-i*y,r[6]=d*E-g*b,r[7]=l*b-i*E,r[8]=i*g-l*d,r},Pn.determinant=function(r){var t=r[3],i=r[4],l=r[5],h=r[6],d=r[7],g=r[8];return r[0]*(g*i-l*d)+r[1]*(-g*t+l*h)+r[2]*(d*t-i*h)},Pn.multiply=RA,Pn.translate=function(r,t,i){var l=t[0],h=t[1],d=t[2],g=t[3],y=t[4],b=t[5],E=t[6],A=t[7],M=t[8],P=i[0],O=i[1];return r[0]=l,r[1]=h,r[2]=d,r[3]=g,r[4]=y,r[5]=b,r[6]=P*l+O*g+E,r[7]=P*h+O*y+A,r[8]=P*d+O*b+M,r},Pn.rotate=function(r,t,i){var l=t[0],h=t[1],d=t[2],g=t[3],y=t[4],b=t[5],E=t[6],A=t[7],M=t[8],P=Math.sin(i),O=Math.cos(i);return r[0]=O*l+P*g,r[1]=O*h+P*y,r[2]=O*d+P*b,r[3]=O*g-P*l,r[4]=O*y-P*h,r[5]=O*b-P*d,r[6]=E,r[7]=A,r[8]=M,r},Pn.scale=function(r,t,i){var l=i[0],h=i[1];return r[0]=l*t[0],r[1]=l*t[1],r[2]=l*t[2],r[3]=h*t[3],r[4]=h*t[4],r[5]=h*t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r},Pn.fromTranslation=function(r,t){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=1,r[5]=0,r[6]=t[0],r[7]=t[1],r[8]=1,r},Pn.fromRotation=function(r,t){var i=Math.sin(t),l=Math.cos(t);return r[0]=l,r[1]=i,r[2]=0,r[3]=-i,r[4]=l,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r},Pn.fromScaling=function(r,t){return r[0]=t[0],r[1]=0,r[2]=0,r[3]=0,r[4]=t[1],r[5]=0,r[6]=0,r[7]=0,r[8]=1,r},Pn.fromMat2d=function(r,t){return r[0]=t[0],r[1]=t[1],r[2]=0,r[3]=t[2],r[4]=t[3],r[5]=0,r[6]=t[4],r[7]=t[5],r[8]=1,r},Pn.fromQuat=function(r,t){var i=t[0],l=t[1],h=t[2],d=t[3],g=i+i,y=l+l,b=h+h,E=i*g,A=l*g,M=l*y,P=h*g,O=h*y,z=h*b,j=d*g,q=d*y,Q=d*b;return r[0]=1-M-z,r[3]=A-Q,r[6]=P+q,r[1]=A+Q,r[4]=1-E-z,r[7]=O-j,r[2]=P-q,r[5]=O+j,r[8]=1-E-M,r},Pn.normalFromMat4=function(r,t){var i=t[0],l=t[1],h=t[2],d=t[3],g=t[4],y=t[5],b=t[6],E=t[7],A=t[8],M=t[9],P=t[10],O=t[11],z=t[12],j=t[13],q=t[14],Q=t[15],oe=i*y-l*g,pe=i*b-h*g,de=i*E-d*g,Ce=l*b-h*y,Ee=l*E-d*y,Le=h*E-d*b,je=A*j-M*z,Ze=A*q-P*z,it=A*Q-O*z,Ye=M*q-P*j,mt=M*Q-O*j,bt=P*Q-O*q,ht=oe*bt-pe*mt+de*Ye+Ce*it-Ee*Ze+Le*je;return ht?(r[0]=(y*bt-b*mt+E*Ye)*(ht=1/ht),r[1]=(b*it-g*bt-E*Ze)*ht,r[2]=(g*mt-y*it+E*je)*ht,r[3]=(h*mt-l*bt-d*Ye)*ht,r[4]=(i*bt-h*it+d*Ze)*ht,r[5]=(l*it-i*mt-d*je)*ht,r[6]=(j*Le-q*Ee+Q*Ce)*ht,r[7]=(q*de-z*Le-Q*pe)*ht,r[8]=(z*Ee-j*de+Q*oe)*ht,r):null},Pn.projection=function(r,t,i){return r[0]=2/t,r[1]=0,r[2]=0,r[3]=0,r[4]=-2/i,r[5]=0,r[6]=-1,r[7]=1,r[8]=1,r},Pn.str=function(r){return"mat3("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+", "+r[4]+", "+r[5]+", "+r[6]+", "+r[7]+", "+r[8]+")"},Pn.frob=function(r){return Math.hypot(r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8])},Pn.add=function(r,t,i){return r[0]=t[0]+i[0],r[1]=t[1]+i[1],r[2]=t[2]+i[2],r[3]=t[3]+i[3],r[4]=t[4]+i[4],r[5]=t[5]+i[5],r[6]=t[6]+i[6],r[7]=t[7]+i[7],r[8]=t[8]+i[8],r},Pn.subtract=DA,Pn.multiplyScalar=function(r,t,i){return r[0]=t[0]*i,r[1]=t[1]*i,r[2]=t[2]*i,r[3]=t[3]*i,r[4]=t[4]*i,r[5]=t[5]*i,r[6]=t[6]*i,r[7]=t[7]*i,r[8]=t[8]*i,r},Pn.multiplyScalarAndAdd=function(r,t,i,l){return r[0]=t[0]+i[0]*l,r[1]=t[1]+i[1]*l,r[2]=t[2]+i[2]*l,r[3]=t[3]+i[3]*l,r[4]=t[4]+i[4]*l,r[5]=t[5]+i[5]*l,r[6]=t[6]+i[6]*l,r[7]=t[7]+i[7]*l,r[8]=t[8]+i[8]*l,r},Pn.exactEquals=function(r,t){return r[0]===t[0]&&r[1]===t[1]&&r[2]===t[2]&&r[3]===t[3]&&r[4]===t[4]&&r[5]===t[5]&&r[6]===t[6]&&r[7]===t[7]&&r[8]===t[8]},Pn.equals=function(r,t){var i=r[0],l=r[1],h=r[2],d=r[3],g=r[4],y=r[5],b=r[6],E=r[7],A=r[8],M=t[0],P=t[1],O=t[2],z=t[3],j=t[4],q=t[5],Q=t[6],oe=t[7],pe=t[8];return Math.abs(i-M)<=Ps.EPSILON*Math.max(1,Math.abs(i),Math.abs(M))&&Math.abs(l-P)<=Ps.EPSILON*Math.max(1,Math.abs(l),Math.abs(P))&&Math.abs(h-O)<=Ps.EPSILON*Math.max(1,Math.abs(h),Math.abs(O))&&Math.abs(d-z)<=Ps.EPSILON*Math.max(1,Math.abs(d),Math.abs(z))&&Math.abs(g-j)<=Ps.EPSILON*Math.max(1,Math.abs(g),Math.abs(j))&&Math.abs(y-q)<=Ps.EPSILON*Math.max(1,Math.abs(y),Math.abs(q))&&Math.abs(b-Q)<=Ps.EPSILON*Math.max(1,Math.abs(b),Math.abs(Q))&&Math.abs(E-oe)<=Ps.EPSILON*Math.max(1,Math.abs(E),Math.abs(oe))&&Math.abs(A-pe)<=Ps.EPSILON*Math.max(1,Math.abs(A),Math.abs(pe))},Pn.sub=Pn.mul=void 0;var Ps=function(r,t){if(r&&r.__esModule)return r;if(r===null||Wv(r)!=="object"&&typeof r!="function")return{default:r};var i=PA(void 0);if(i&&i.has(r))return i.get(r);var l={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in r)if(d!=="default"&&Object.prototype.hasOwnProperty.call(r,d)){var g=h?Object.getOwnPropertyDescriptor(r,d):null;g&&(g.get||g.set)?Object.defineProperty(l,d,g):l[d]=r[d]}return l.default=r,i&&i.set(r,l),l}(ji);function PA(r){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(PA=function(l){return l?i:t})(r)}function RA(r,t,i){var l=t[0],h=t[1],d=t[2],g=t[3],y=t[4],b=t[5],E=t[6],A=t[7],M=t[8],P=i[0],O=i[1],z=i[2],j=i[3],q=i[4],Q=i[5],oe=i[6],pe=i[7],de=i[8];return r[0]=P*l+O*g+z*E,r[1]=P*h+O*y+z*A,r[2]=P*d+O*b+z*M,r[3]=j*l+q*g+Q*E,r[4]=j*h+q*y+Q*A,r[5]=j*d+q*b+Q*M,r[6]=oe*l+pe*g+de*E,r[7]=oe*h+pe*y+de*A,r[8]=oe*d+pe*b+de*M,r}function DA(r,t,i){return r[0]=t[0]-i[0],r[1]=t[1]-i[1],r[2]=t[2]-i[2],r[3]=t[3]-i[3],r[4]=t[4]-i[4],r[5]=t[5]-i[5],r[6]=t[6]-i[6],r[7]=t[7]-i[7],r[8]=t[8]-i[8],r}Pn.mul=RA,Pn.sub=DA;var Ur={};function qv(r){return qv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},qv(r)}Object.defineProperty(Ur,"__esModule",{value:!0}),Ur.create=function(){var r=new di.ARRAY_TYPE(16);return di.ARRAY_TYPE!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r},Ur.clone=function(r){var t=new di.ARRAY_TYPE(16);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],t},Ur.copy=function(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r},Ur.fromValues=function(r,t,i,l,h,d,g,y,b,E,A,M,P,O,z,j){var q=new di.ARRAY_TYPE(16);return q[0]=r,q[1]=t,q[2]=i,q[3]=l,q[4]=h,q[5]=d,q[6]=g,q[7]=y,q[8]=b,q[9]=E,q[10]=A,q[11]=M,q[12]=P,q[13]=O,q[14]=z,q[15]=j,q},Ur.set=function(r,t,i,l,h,d,g,y,b,E,A,M,P,O,z,j,q){return r[0]=t,r[1]=i,r[2]=l,r[3]=h,r[4]=d,r[5]=g,r[6]=y,r[7]=b,r[8]=E,r[9]=A,r[10]=M,r[11]=P,r[12]=O,r[13]=z,r[14]=j,r[15]=q,r},Ur.identity=LA,Ur.transpose=function(r,t){if(r===t){var i=t[1],l=t[2],h=t[3],d=t[6],g=t[7],y=t[11];r[1]=t[4],r[2]=t[8],r[3]=t[12],r[4]=i,r[6]=t[9],r[7]=t[13],r[8]=l,r[9]=d,r[11]=t[14],r[12]=h,r[13]=g,r[14]=y}else r[0]=t[0],r[1]=t[4],r[2]=t[8],r[3]=t[12],r[4]=t[1],r[5]=t[5],r[6]=t[9],r[7]=t[13],r[8]=t[2],r[9]=t[6],r[10]=t[10],r[11]=t[14],r[12]=t[3],r[13]=t[7],r[14]=t[11],r[15]=t[15];return r},Ur.invert=function(r,t){var i=t[0],l=t[1],h=t[2],d=t[3],g=t[4],y=t[5],b=t[6],E=t[7],A=t[8],M=t[9],P=t[10],O=t[11],z=t[12],j=t[13],q=t[14],Q=t[15],oe=i*y-l*g,pe=i*b-h*g,de=i*E-d*g,Ce=l*b-h*y,Ee=l*E-d*y,Le=h*E-d*b,je=A*j-M*z,Ze=A*q-P*z,it=A*Q-O*z,Ye=M*q-P*j,mt=M*Q-O*j,bt=P*Q-O*q,ht=oe*bt-pe*mt+de*Ye+Ce*it-Ee*Ze+Le*je;return ht?(r[0]=(y*bt-b*mt+E*Ye)*(ht=1/ht),r[1]=(h*mt-l*bt-d*Ye)*ht,r[2]=(j*Le-q*Ee+Q*Ce)*ht,r[3]=(P*Ee-M*Le-O*Ce)*ht,r[4]=(b*it-g*bt-E*Ze)*ht,r[5]=(i*bt-h*it+d*Ze)*ht,r[6]=(q*de-z*Le-Q*pe)*ht,r[7]=(A*Le-P*de+O*pe)*ht,r[8]=(g*mt-y*it+E*je)*ht,r[9]=(l*it-i*mt-d*je)*ht,r[10]=(z*Ee-j*de+Q*oe)*ht,r[11]=(M*de-A*Ee-O*oe)*ht,r[12]=(y*Ze-g*Ye-b*je)*ht,r[13]=(i*Ye-l*Ze+h*je)*ht,r[14]=(j*pe-z*Ce-q*oe)*ht,r[15]=(A*Ce-M*pe+P*oe)*ht,r):null},Ur.adjoint=function(r,t){var i=t[0],l=t[1],h=t[2],d=t[3],g=t[4],y=t[5],b=t[6],E=t[7],A=t[8],M=t[9],P=t[10],O=t[11],z=t[12],j=t[13],q=t[14],Q=t[15];return r[0]=y*(P*Q-O*q)-M*(b*Q-E*q)+j*(b*O-E*P),r[1]=-(l*(P*Q-O*q)-M*(h*Q-d*q)+j*(h*O-d*P)),r[2]=l*(b*Q-E*q)-y*(h*Q-d*q)+j*(h*E-d*b),r[3]=-(l*(b*O-E*P)-y*(h*O-d*P)+M*(h*E-d*b)),r[4]=-(g*(P*Q-O*q)-A*(b*Q-E*q)+z*(b*O-E*P)),r[5]=i*(P*Q-O*q)-A*(h*Q-d*q)+z*(h*O-d*P),r[6]=-(i*(b*Q-E*q)-g*(h*Q-d*q)+z*(h*E-d*b)),r[7]=i*(b*O-E*P)-g*(h*O-d*P)+A*(h*E-d*b),r[8]=g*(M*Q-O*j)-A*(y*Q-E*j)+z*(y*O-E*M),r[9]=-(i*(M*Q-O*j)-A*(l*Q-d*j)+z*(l*O-d*M)),r[10]=i*(y*Q-E*j)-g*(l*Q-d*j)+z*(l*E-d*y),r[11]=-(i*(y*O-E*M)-g*(l*O-d*M)+A*(l*E-d*y)),r[12]=-(g*(M*q-P*j)-A*(y*q-b*j)+z*(y*P-b*M)),r[13]=i*(M*q-P*j)-A*(l*q-h*j)+z*(l*P-h*M),r[14]=-(i*(y*q-b*j)-g*(l*q-h*j)+z*(l*b-h*y)),r[15]=i*(y*P-b*M)-g*(l*P-h*M)+A*(l*b-h*y),r},Ur.determinant=function(r){var t=r[0],i=r[1],l=r[2],h=r[3],d=r[4],g=r[5],y=r[6],b=r[7],E=r[8],A=r[9],M=r[10],P=r[11],O=r[12],z=r[13],j=r[14],q=r[15];return(t*g-i*d)*(M*q-P*j)-(t*y-l*d)*(A*q-P*z)+(t*b-h*d)*(A*j-M*z)+(i*y-l*g)*(E*q-P*O)-(i*b-h*g)*(E*j-M*O)+(l*b-h*y)*(E*z-A*O)},Ur.multiply=OA,Ur.translate=function(r,t,i){var l,h,d,g,y,b,E,A,M,P,O,z,j=i[0],q=i[1],Q=i[2];return t===r?(r[12]=t[0]*j+t[4]*q+t[8]*Q+t[12],r[13]=t[1]*j+t[5]*q+t[9]*Q+t[13],r[14]=t[2]*j+t[6]*q+t[10]*Q+t[14],r[15]=t[3]*j+t[7]*q+t[11]*Q+t[15]):(h=t[1],d=t[2],g=t[3],y=t[4],b=t[5],E=t[6],A=t[7],M=t[8],P=t[9],O=t[10],z=t[11],r[0]=l=t[0],r[1]=h,r[2]=d,r[3]=g,r[4]=y,r[5]=b,r[6]=E,r[7]=A,r[8]=M,r[9]=P,r[10]=O,r[11]=z,r[12]=l*j+y*q+M*Q+t[12],r[13]=h*j+b*q+P*Q+t[13],r[14]=d*j+E*q+O*Q+t[14],r[15]=g*j+A*q+z*Q+t[15]),r},Ur.scale=function(r,t,i){var l=i[0],h=i[1],d=i[2];return r[0]=t[0]*l,r[1]=t[1]*l,r[2]=t[2]*l,r[3]=t[3]*l,r[4]=t[4]*h,r[5]=t[5]*h,r[6]=t[6]*h,r[7]=t[7]*h,r[8]=t[8]*d,r[9]=t[9]*d,r[10]=t[10]*d,r[11]=t[11]*d,r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r},Ur.rotate=function(r,t,i,l){var h,d,g,y,b,E,A,M,P,O,z,j,q,Q,oe,pe,de,Ce,Ee,Le,je,Ze,it,Ye,mt=l[0],bt=l[1],ht=l[2],wt=Math.hypot(mt,bt,ht);return wt<di.EPSILON?null:(mt*=wt=1/wt,bt*=wt,ht*=wt,h=Math.sin(i),d=Math.cos(i),b=t[1],E=t[2],A=t[3],P=t[5],O=t[6],z=t[7],q=t[9],Q=t[10],oe=t[11],pe=mt*mt*(g=1-d)+d,Ee=mt*bt*g-ht*h,Le=bt*bt*g+d,je=ht*bt*g+mt*h,Ze=mt*ht*g+bt*h,it=bt*ht*g-mt*h,Ye=ht*ht*g+d,r[0]=(y=t[0])*pe+(M=t[4])*(de=bt*mt*g+ht*h)+(j=t[8])*(Ce=ht*mt*g-bt*h),r[1]=b*pe+P*de+q*Ce,r[2]=E*pe+O*de+Q*Ce,r[3]=A*pe+z*de+oe*Ce,r[4]=y*Ee+M*Le+j*je,r[5]=b*Ee+P*Le+q*je,r[6]=E*Ee+O*Le+Q*je,r[7]=A*Ee+z*Le+oe*je,r[8]=y*Ze+M*it+j*Ye,r[9]=b*Ze+P*it+q*Ye,r[10]=E*Ze+O*it+Q*Ye,r[11]=A*Ze+z*it+oe*Ye,t!==r&&(r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r)},Ur.rotateX=function(r,t,i){var l=Math.sin(i),h=Math.cos(i),d=t[4],g=t[5],y=t[6],b=t[7],E=t[8],A=t[9],M=t[10],P=t[11];return t!==r&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[4]=d*h+E*l,r[5]=g*h+A*l,r[6]=y*h+M*l,r[7]=b*h+P*l,r[8]=E*h-d*l,r[9]=A*h-g*l,r[10]=M*h-y*l,r[11]=P*h-b*l,r},Ur.rotateY=function(r,t,i){var l=Math.sin(i),h=Math.cos(i),d=t[0],g=t[1],y=t[2],b=t[3],E=t[8],A=t[9],M=t[10],P=t[11];return t!==r&&(r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[0]=d*h-E*l,r[1]=g*h-A*l,r[2]=y*h-M*l,r[3]=b*h-P*l,r[8]=d*l+E*h,r[9]=g*l+A*h,r[10]=y*l+M*h,r[11]=b*l+P*h,r},Ur.rotateZ=function(r,t,i){var l=Math.sin(i),h=Math.cos(i),d=t[0],g=t[1],y=t[2],b=t[3],E=t[4],A=t[5],M=t[6],P=t[7];return t!==r&&(r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[0]=d*h+E*l,r[1]=g*h+A*l,r[2]=y*h+M*l,r[3]=b*h+P*l,r[4]=E*h-d*l,r[5]=A*h-g*l,r[6]=M*h-y*l,r[7]=P*h-b*l,r},Ur.fromTranslation=function(r,t){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=t[0],r[13]=t[1],r[14]=t[2],r[15]=1,r},Ur.fromScaling=function(r,t){return r[0]=t[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=t[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=t[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},Ur.fromRotation=function(r,t,i){var l,h,d,g=i[0],y=i[1],b=i[2],E=Math.hypot(g,y,b);return E<di.EPSILON?null:(g*=E=1/E,y*=E,b*=E,l=Math.sin(t),h=Math.cos(t),r[0]=g*g*(d=1-h)+h,r[1]=y*g*d+b*l,r[2]=b*g*d-y*l,r[3]=0,r[4]=g*y*d-b*l,r[5]=y*y*d+h,r[6]=b*y*d+g*l,r[7]=0,r[8]=g*b*d+y*l,r[9]=y*b*d-g*l,r[10]=b*b*d+h,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r)},Ur.fromXRotation=function(r,t){var i=Math.sin(t),l=Math.cos(t);return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=l,r[6]=i,r[7]=0,r[8]=0,r[9]=-i,r[10]=l,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},Ur.fromYRotation=function(r,t){var i=Math.sin(t),l=Math.cos(t);return r[0]=l,r[1]=0,r[2]=-i,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=i,r[9]=0,r[10]=l,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},Ur.fromZRotation=function(r,t){var i=Math.sin(t),l=Math.cos(t);return r[0]=l,r[1]=i,r[2]=0,r[3]=0,r[4]=-i,r[5]=l,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},Ur.fromRotationTranslation=NA,Ur.fromQuat2=function(r,t){var i=new di.ARRAY_TYPE(3),l=-t[0],h=-t[1],d=-t[2],g=t[3],y=t[4],b=t[5],E=t[6],A=t[7],M=l*l+h*h+d*d+g*g;return M>0?(i[0]=2*(y*g+A*l+b*d-E*h)/M,i[1]=2*(b*g+A*h+E*l-y*d)/M,i[2]=2*(E*g+A*d+y*h-b*l)/M):(i[0]=2*(y*g+A*l+b*d-E*h),i[1]=2*(b*g+A*h+E*l-y*d),i[2]=2*(E*g+A*d+y*h-b*l)),NA(r,t,i),r},Ur.getTranslation=function(r,t){return r[0]=t[12],r[1]=t[13],r[2]=t[14],r},Ur.getScaling=zA,Ur.getRotation=function(r,t){var i=new di.ARRAY_TYPE(3);zA(i,t);var l=1/i[0],h=1/i[1],d=1/i[2],g=t[0]*l,y=t[1]*h,b=t[2]*d,E=t[4]*l,A=t[5]*h,M=t[6]*d,P=t[8]*l,O=t[9]*h,z=t[10]*d,j=g+A+z,q=0;return j>0?(q=2*Math.sqrt(j+1),r[3]=.25*q,r[0]=(M-O)/q,r[1]=(P-b)/q,r[2]=(y-E)/q):g>A&&g>z?(q=2*Math.sqrt(1+g-A-z),r[3]=(M-O)/q,r[0]=.25*q,r[1]=(y+E)/q,r[2]=(P+b)/q):A>z?(q=2*Math.sqrt(1+A-g-z),r[3]=(P-b)/q,r[0]=(y+E)/q,r[1]=.25*q,r[2]=(M+O)/q):(q=2*Math.sqrt(1+z-g-A),r[3]=(y-E)/q,r[0]=(P+b)/q,r[1]=(M+O)/q,r[2]=.25*q),r},Ur.fromRotationTranslationScale=function(r,t,i,l){var h=t[0],d=t[1],g=t[2],y=t[3],b=h+h,E=d+d,A=g+g,M=h*b,P=h*E,O=h*A,z=d*E,j=d*A,q=g*A,Q=y*b,oe=y*E,pe=y*A,de=l[0],Ce=l[1],Ee=l[2];return r[0]=(1-(z+q))*de,r[1]=(P+pe)*de,r[2]=(O-oe)*de,r[3]=0,r[4]=(P-pe)*Ce,r[5]=(1-(M+q))*Ce,r[6]=(j+Q)*Ce,r[7]=0,r[8]=(O+oe)*Ee,r[9]=(j-Q)*Ee,r[10]=(1-(M+z))*Ee,r[11]=0,r[12]=i[0],r[13]=i[1],r[14]=i[2],r[15]=1,r},Ur.fromRotationTranslationScaleOrigin=function(r,t,i,l,h){var d=t[0],g=t[1],y=t[2],b=t[3],E=d+d,A=g+g,M=y+y,P=d*E,O=d*A,z=d*M,j=g*A,q=g*M,Q=y*M,oe=b*E,pe=b*A,de=b*M,Ce=l[0],Ee=l[1],Le=l[2],je=h[0],Ze=h[1],it=h[2],Ye=(1-(j+Q))*Ce,mt=(O+de)*Ce,bt=(z-pe)*Ce,ht=(O-de)*Ee,wt=(1-(P+Q))*Ee,lt=(q+oe)*Ee,vt=(z+pe)*Le,Gt=(q-oe)*Le,Tt=(1-(P+j))*Le;return r[0]=Ye,r[1]=mt,r[2]=bt,r[3]=0,r[4]=ht,r[5]=wt,r[6]=lt,r[7]=0,r[8]=vt,r[9]=Gt,r[10]=Tt,r[11]=0,r[12]=i[0]+je-(Ye*je+ht*Ze+vt*it),r[13]=i[1]+Ze-(mt*je+wt*Ze+Gt*it),r[14]=i[2]+it-(bt*je+lt*Ze+Tt*it),r[15]=1,r},Ur.fromQuat=function(r,t){var i=t[0],l=t[1],h=t[2],d=t[3],g=i+i,y=l+l,b=h+h,E=i*g,A=l*g,M=l*y,P=h*g,O=h*y,z=h*b,j=d*g,q=d*y,Q=d*b;return r[0]=1-M-z,r[1]=A+Q,r[2]=P-q,r[3]=0,r[4]=A-Q,r[5]=1-E-z,r[6]=O+j,r[7]=0,r[8]=P+q,r[9]=O-j,r[10]=1-E-M,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},Ur.frustum=function(r,t,i,l,h,d,g){var y=1/(i-t),b=1/(h-l),E=1/(d-g);return r[0]=2*d*y,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=2*d*b,r[6]=0,r[7]=0,r[8]=(i+t)*y,r[9]=(h+l)*b,r[10]=(g+d)*E,r[11]=-1,r[12]=0,r[13]=0,r[14]=g*d*2*E,r[15]=0,r},Ur.perspectiveNO=BA,Ur.perspectiveZO=function(r,t,i,l,h){var d,g=1/Math.tan(t/2);return r[0]=g/i,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=g,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,h!=null&&h!==1/0?(r[10]=h*(d=1/(l-h)),r[14]=h*l*d):(r[10]=-1,r[14]=-l),r},Ur.perspectiveFromFieldOfView=function(r,t,i,l){var h=Math.tan(t.upDegrees*Math.PI/180),d=Math.tan(t.downDegrees*Math.PI/180),g=Math.tan(t.leftDegrees*Math.PI/180),y=Math.tan(t.rightDegrees*Math.PI/180),b=2/(g+y),E=2/(h+d);return r[0]=b,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=E,r[6]=0,r[7]=0,r[8]=-(g-y)*b*.5,r[9]=(h-d)*E*.5,r[10]=l/(i-l),r[11]=-1,r[12]=0,r[13]=0,r[14]=l*i/(i-l),r[15]=0,r},Ur.orthoNO=UA,Ur.orthoZO=function(r,t,i,l,h,d,g){var y=1/(t-i),b=1/(l-h),E=1/(d-g);return r[0]=-2*y,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*b,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=E,r[11]=0,r[12]=(t+i)*y,r[13]=(h+l)*b,r[14]=d*E,r[15]=1,r},Ur.lookAt=function(r,t,i,l){var h,d,g,y,b,E,A,M,P,O,z=t[0],j=t[1],q=t[2],Q=l[0],oe=l[1],pe=l[2],de=i[0],Ce=i[1],Ee=i[2];return Math.abs(z-de)<di.EPSILON&&Math.abs(j-Ce)<di.EPSILON&&Math.abs(q-Ee)<di.EPSILON?LA(r):(A=z-de,M=j-Ce,P=q-Ee,h=oe*(P*=O=1/Math.hypot(A,M,P))-pe*(M*=O),d=pe*(A*=O)-Q*P,g=Q*M-oe*A,(O=Math.hypot(h,d,g))?(h*=O=1/O,d*=O,g*=O):(h=0,d=0,g=0),y=M*g-P*d,b=P*h-A*g,E=A*d-M*h,(O=Math.hypot(y,b,E))?(y*=O=1/O,b*=O,E*=O):(y=0,b=0,E=0),r[0]=h,r[1]=y,r[2]=A,r[3]=0,r[4]=d,r[5]=b,r[6]=M,r[7]=0,r[8]=g,r[9]=E,r[10]=P,r[11]=0,r[12]=-(h*z+d*j+g*q),r[13]=-(y*z+b*j+E*q),r[14]=-(A*z+M*j+P*q),r[15]=1,r)},Ur.targetTo=function(r,t,i,l){var h=t[0],d=t[1],g=t[2],y=l[0],b=l[1],E=l[2],A=h-i[0],M=d-i[1],P=g-i[2],O=A*A+M*M+P*P;O>0&&(A*=O=1/Math.sqrt(O),M*=O,P*=O);var z=b*P-E*M,j=E*A-y*P,q=y*M-b*A;return(O=z*z+j*j+q*q)>0&&(z*=O=1/Math.sqrt(O),j*=O,q*=O),r[0]=z,r[1]=j,r[2]=q,r[3]=0,r[4]=M*q-P*j,r[5]=P*z-A*q,r[6]=A*j-M*z,r[7]=0,r[8]=A,r[9]=M,r[10]=P,r[11]=0,r[12]=h,r[13]=d,r[14]=g,r[15]=1,r},Ur.str=function(r){return"mat4("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+", "+r[4]+", "+r[5]+", "+r[6]+", "+r[7]+", "+r[8]+", "+r[9]+", "+r[10]+", "+r[11]+", "+r[12]+", "+r[13]+", "+r[14]+", "+r[15]+")"},Ur.frob=function(r){return Math.hypot(r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8],r[9],r[10],r[11],r[12],r[13],r[14],r[15])},Ur.add=function(r,t,i){return r[0]=t[0]+i[0],r[1]=t[1]+i[1],r[2]=t[2]+i[2],r[3]=t[3]+i[3],r[4]=t[4]+i[4],r[5]=t[5]+i[5],r[6]=t[6]+i[6],r[7]=t[7]+i[7],r[8]=t[8]+i[8],r[9]=t[9]+i[9],r[10]=t[10]+i[10],r[11]=t[11]+i[11],r[12]=t[12]+i[12],r[13]=t[13]+i[13],r[14]=t[14]+i[14],r[15]=t[15]+i[15],r},Ur.subtract=VA,Ur.multiplyScalar=function(r,t,i){return r[0]=t[0]*i,r[1]=t[1]*i,r[2]=t[2]*i,r[3]=t[3]*i,r[4]=t[4]*i,r[5]=t[5]*i,r[6]=t[6]*i,r[7]=t[7]*i,r[8]=t[8]*i,r[9]=t[9]*i,r[10]=t[10]*i,r[11]=t[11]*i,r[12]=t[12]*i,r[13]=t[13]*i,r[14]=t[14]*i,r[15]=t[15]*i,r},Ur.multiplyScalarAndAdd=function(r,t,i,l){return r[0]=t[0]+i[0]*l,r[1]=t[1]+i[1]*l,r[2]=t[2]+i[2]*l,r[3]=t[3]+i[3]*l,r[4]=t[4]+i[4]*l,r[5]=t[5]+i[5]*l,r[6]=t[6]+i[6]*l,r[7]=t[7]+i[7]*l,r[8]=t[8]+i[8]*l,r[9]=t[9]+i[9]*l,r[10]=t[10]+i[10]*l,r[11]=t[11]+i[11]*l,r[12]=t[12]+i[12]*l,r[13]=t[13]+i[13]*l,r[14]=t[14]+i[14]*l,r[15]=t[15]+i[15]*l,r},Ur.exactEquals=function(r,t){return r[0]===t[0]&&r[1]===t[1]&&r[2]===t[2]&&r[3]===t[3]&&r[4]===t[4]&&r[5]===t[5]&&r[6]===t[6]&&r[7]===t[7]&&r[8]===t[8]&&r[9]===t[9]&&r[10]===t[10]&&r[11]===t[11]&&r[12]===t[12]&&r[13]===t[13]&&r[14]===t[14]&&r[15]===t[15]},Ur.equals=function(r,t){var i=r[0],l=r[1],h=r[2],d=r[3],g=r[4],y=r[5],b=r[6],E=r[7],A=r[8],M=r[9],P=r[10],O=r[11],z=r[12],j=r[13],q=r[14],Q=r[15],oe=t[0],pe=t[1],de=t[2],Ce=t[3],Ee=t[4],Le=t[5],je=t[6],Ze=t[7],it=t[8],Ye=t[9],mt=t[10],bt=t[11],ht=t[12],wt=t[13],lt=t[14],vt=t[15];return Math.abs(i-oe)<=di.EPSILON*Math.max(1,Math.abs(i),Math.abs(oe))&&Math.abs(l-pe)<=di.EPSILON*Math.max(1,Math.abs(l),Math.abs(pe))&&Math.abs(h-de)<=di.EPSILON*Math.max(1,Math.abs(h),Math.abs(de))&&Math.abs(d-Ce)<=di.EPSILON*Math.max(1,Math.abs(d),Math.abs(Ce))&&Math.abs(g-Ee)<=di.EPSILON*Math.max(1,Math.abs(g),Math.abs(Ee))&&Math.abs(y-Le)<=di.EPSILON*Math.max(1,Math.abs(y),Math.abs(Le))&&Math.abs(b-je)<=di.EPSILON*Math.max(1,Math.abs(b),Math.abs(je))&&Math.abs(E-Ze)<=di.EPSILON*Math.max(1,Math.abs(E),Math.abs(Ze))&&Math.abs(A-it)<=di.EPSILON*Math.max(1,Math.abs(A),Math.abs(it))&&Math.abs(M-Ye)<=di.EPSILON*Math.max(1,Math.abs(M),Math.abs(Ye))&&Math.abs(P-mt)<=di.EPSILON*Math.max(1,Math.abs(P),Math.abs(mt))&&Math.abs(O-bt)<=di.EPSILON*Math.max(1,Math.abs(O),Math.abs(bt))&&Math.abs(z-ht)<=di.EPSILON*Math.max(1,Math.abs(z),Math.abs(ht))&&Math.abs(j-wt)<=di.EPSILON*Math.max(1,Math.abs(j),Math.abs(wt))&&Math.abs(q-lt)<=di.EPSILON*Math.max(1,Math.abs(q),Math.abs(lt))&&Math.abs(Q-vt)<=di.EPSILON*Math.max(1,Math.abs(Q),Math.abs(vt))},Ur.sub=Ur.mul=Ur.ortho=Ur.perspective=void 0;var di=function(r,t){if(r&&r.__esModule)return r;if(r===null||qv(r)!=="object"&&typeof r!="function")return{default:r};var i=FA(void 0);if(i&&i.has(r))return i.get(r);var l={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in r)if(d!=="default"&&Object.prototype.hasOwnProperty.call(r,d)){var g=h?Object.getOwnPropertyDescriptor(r,d):null;g&&(g.get||g.set)?Object.defineProperty(l,d,g):l[d]=r[d]}return l.default=r,i&&i.set(r,l),l}(ji);function FA(r){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(FA=function(l){return l?i:t})(r)}function LA(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function OA(r,t,i){var l=t[0],h=t[1],d=t[2],g=t[3],y=t[4],b=t[5],E=t[6],A=t[7],M=t[8],P=t[9],O=t[10],z=t[11],j=t[12],q=t[13],Q=t[14],oe=t[15],pe=i[0],de=i[1],Ce=i[2],Ee=i[3];return r[0]=pe*l+de*y+Ce*M+Ee*j,r[1]=pe*h+de*b+Ce*P+Ee*q,r[2]=pe*d+de*E+Ce*O+Ee*Q,r[3]=pe*g+de*A+Ce*z+Ee*oe,r[4]=(pe=i[4])*l+(de=i[5])*y+(Ce=i[6])*M+(Ee=i[7])*j,r[5]=pe*h+de*b+Ce*P+Ee*q,r[6]=pe*d+de*E+Ce*O+Ee*Q,r[7]=pe*g+de*A+Ce*z+Ee*oe,r[8]=(pe=i[8])*l+(de=i[9])*y+(Ce=i[10])*M+(Ee=i[11])*j,r[9]=pe*h+de*b+Ce*P+Ee*q,r[10]=pe*d+de*E+Ce*O+Ee*Q,r[11]=pe*g+de*A+Ce*z+Ee*oe,r[12]=(pe=i[12])*l+(de=i[13])*y+(Ce=i[14])*M+(Ee=i[15])*j,r[13]=pe*h+de*b+Ce*P+Ee*q,r[14]=pe*d+de*E+Ce*O+Ee*Q,r[15]=pe*g+de*A+Ce*z+Ee*oe,r}function NA(r,t,i){var l=t[0],h=t[1],d=t[2],g=t[3],y=l+l,b=h+h,E=d+d,A=l*y,M=l*b,P=l*E,O=h*b,z=h*E,j=d*E,q=g*y,Q=g*b,oe=g*E;return r[0]=1-(O+j),r[1]=M+oe,r[2]=P-Q,r[3]=0,r[4]=M-oe,r[5]=1-(A+j),r[6]=z+q,r[7]=0,r[8]=P+Q,r[9]=z-q,r[10]=1-(A+O),r[11]=0,r[12]=i[0],r[13]=i[1],r[14]=i[2],r[15]=1,r}function zA(r,t){var i=t[4],l=t[5],h=t[6],d=t[8],g=t[9],y=t[10];return r[0]=Math.hypot(t[0],t[1],t[2]),r[1]=Math.hypot(i,l,h),r[2]=Math.hypot(d,g,y),r}function BA(r,t,i,l,h){var d,g=1/Math.tan(t/2);return r[0]=g/i,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=g,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,h!=null&&h!==1/0?(r[10]=(h+l)*(d=1/(l-h)),r[14]=2*h*l*d):(r[10]=-1,r[14]=-2*l),r}function UA(r,t,i,l,h,d,g){var y=1/(t-i),b=1/(l-h),E=1/(d-g);return r[0]=-2*y,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*b,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*E,r[11]=0,r[12]=(t+i)*y,r[13]=(h+l)*b,r[14]=(g+d)*E,r[15]=1,r}function VA(r,t,i){return r[0]=t[0]-i[0],r[1]=t[1]-i[1],r[2]=t[2]-i[2],r[3]=t[3]-i[3],r[4]=t[4]-i[4],r[5]=t[5]-i[5],r[6]=t[6]-i[6],r[7]=t[7]-i[7],r[8]=t[8]-i[8],r[9]=t[9]-i[9],r[10]=t[10]-i[10],r[11]=t[11]-i[11],r[12]=t[12]-i[12],r[13]=t[13]-i[13],r[14]=t[14]-i[14],r[15]=t[15]-i[15],r}Ur.perspective=BA,Ur.ortho=UA,Ur.mul=OA,Ur.sub=VA;var Dr={},Br={};function Zv(r){return Zv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Zv(r)}Object.defineProperty(Br,"__esModule",{value:!0}),Br.create=jA,Br.clone=function(r){var t=new Ql.ARRAY_TYPE(3);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t},Br.length=GA,Br.fromValues=function(r,t,i){var l=new Ql.ARRAY_TYPE(3);return l[0]=r,l[1]=t,l[2]=i,l},Br.copy=function(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r},Br.set=function(r,t,i,l){return r[0]=t,r[1]=i,r[2]=l,r},Br.add=function(r,t,i){return r[0]=t[0]+i[0],r[1]=t[1]+i[1],r[2]=t[2]+i[2],r},Br.subtract=HA,Br.multiply=WA,Br.divide=qA,Br.ceil=function(r,t){return r[0]=Math.ceil(t[0]),r[1]=Math.ceil(t[1]),r[2]=Math.ceil(t[2]),r},Br.floor=function(r,t){return r[0]=Math.floor(t[0]),r[1]=Math.floor(t[1]),r[2]=Math.floor(t[2]),r},Br.min=function(r,t,i){return r[0]=Math.min(t[0],i[0]),r[1]=Math.min(t[1],i[1]),r[2]=Math.min(t[2],i[2]),r},Br.max=function(r,t,i){return r[0]=Math.max(t[0],i[0]),r[1]=Math.max(t[1],i[1]),r[2]=Math.max(t[2],i[2]),r},Br.round=function(r,t){return r[0]=Math.round(t[0]),r[1]=Math.round(t[1]),r[2]=Math.round(t[2]),r},Br.scale=function(r,t,i){return r[0]=t[0]*i,r[1]=t[1]*i,r[2]=t[2]*i,r},Br.scaleAndAdd=function(r,t,i,l){return r[0]=t[0]+i[0]*l,r[1]=t[1]+i[1]*l,r[2]=t[2]+i[2]*l,r},Br.distance=ZA,Br.squaredDistance=XA,Br.squaredLength=YA,Br.negate=function(r,t){return r[0]=-t[0],r[1]=-t[1],r[2]=-t[2],r},Br.inverse=function(r,t){return r[0]=1/t[0],r[1]=1/t[1],r[2]=1/t[2],r},Br.normalize=function(r,t){var i=t[0],l=t[1],h=t[2],d=i*i+l*l+h*h;return d>0&&(d=1/Math.sqrt(d)),r[0]=t[0]*d,r[1]=t[1]*d,r[2]=t[2]*d,r},Br.dot=KA,Br.cross=function(r,t,i){var l=t[0],h=t[1],d=t[2],g=i[0],y=i[1],b=i[2];return r[0]=h*b-d*y,r[1]=d*g-l*b,r[2]=l*y-h*g,r},Br.lerp=function(r,t,i,l){var h=t[0],d=t[1],g=t[2];return r[0]=h+l*(i[0]-h),r[1]=d+l*(i[1]-d),r[2]=g+l*(i[2]-g),r},Br.hermite=function(r,t,i,l,h,d){var g=d*d,y=g*(2*d-3)+1,b=g*(d-2)+d,E=g*(d-1),A=g*(3-2*d);return r[0]=t[0]*y+i[0]*b+l[0]*E+h[0]*A,r[1]=t[1]*y+i[1]*b+l[1]*E+h[1]*A,r[2]=t[2]*y+i[2]*b+l[2]*E+h[2]*A,r},Br.bezier=function(r,t,i,l,h,d){var g=1-d,y=g*g,b=d*d,E=y*g,A=3*d*y,M=3*b*g,P=b*d;return r[0]=t[0]*E+i[0]*A+l[0]*M+h[0]*P,r[1]=t[1]*E+i[1]*A+l[1]*M+h[1]*P,r[2]=t[2]*E+i[2]*A+l[2]*M+h[2]*P,r},Br.random=function(r,t){t=t||1;var i=2*Ql.RANDOM()*Math.PI,l=2*Ql.RANDOM()-1,h=Math.sqrt(1-l*l)*t;return r[0]=Math.cos(i)*h,r[1]=Math.sin(i)*h,r[2]=l*t,r},Br.transformMat4=function(r,t,i){var l=t[0],h=t[1],d=t[2],g=i[3]*l+i[7]*h+i[11]*d+i[15];return r[0]=(i[0]*l+i[4]*h+i[8]*d+i[12])/(g=g||1),r[1]=(i[1]*l+i[5]*h+i[9]*d+i[13])/g,r[2]=(i[2]*l+i[6]*h+i[10]*d+i[14])/g,r},Br.transformMat3=function(r,t,i){var l=t[0],h=t[1],d=t[2];return r[0]=l*i[0]+h*i[3]+d*i[6],r[1]=l*i[1]+h*i[4]+d*i[7],r[2]=l*i[2]+h*i[5]+d*i[8],r},Br.transformQuat=function(r,t,i){var l=i[0],h=i[1],d=i[2],g=t[0],y=t[1],b=t[2],E=h*b-d*y,A=d*g-l*b,M=l*y-h*g,P=h*M-d*A,O=d*E-l*M,z=l*A-h*E,j=2*i[3];return A*=j,M*=j,O*=2,z*=2,r[0]=g+(E*=j)+(P*=2),r[1]=y+A+O,r[2]=b+M+z,r},Br.rotateX=function(r,t,i,l){var h=[],d=[];return h[0]=t[0]-i[0],h[1]=t[1]-i[1],h[2]=t[2]-i[2],d[0]=h[0],d[1]=h[1]*Math.cos(l)-h[2]*Math.sin(l),d[2]=h[1]*Math.sin(l)+h[2]*Math.cos(l),r[0]=d[0]+i[0],r[1]=d[1]+i[1],r[2]=d[2]+i[2],r},Br.rotateY=function(r,t,i,l){var h=[],d=[];return h[0]=t[0]-i[0],h[1]=t[1]-i[1],h[2]=t[2]-i[2],d[0]=h[2]*Math.sin(l)+h[0]*Math.cos(l),d[1]=h[1],d[2]=h[2]*Math.cos(l)-h[0]*Math.sin(l),r[0]=d[0]+i[0],r[1]=d[1]+i[1],r[2]=d[2]+i[2],r},Br.rotateZ=function(r,t,i,l){var h=[],d=[];return h[0]=t[0]-i[0],h[1]=t[1]-i[1],h[2]=t[2]-i[2],d[0]=h[0]*Math.cos(l)-h[1]*Math.sin(l),d[1]=h[0]*Math.sin(l)+h[1]*Math.cos(l),d[2]=h[2],r[0]=d[0]+i[0],r[1]=d[1]+i[1],r[2]=d[2]+i[2],r},Br.angle=function(r,t){var i=r[0],l=r[1],h=r[2],d=t[0],g=t[1],y=t[2],b=Math.sqrt(i*i+l*l+h*h)*Math.sqrt(d*d+g*g+y*y),E=b&&KA(r,t)/b;return Math.acos(Math.min(Math.max(E,-1),1))},Br.zero=function(r){return r[0]=0,r[1]=0,r[2]=0,r},Br.str=function(r){return"vec3("+r[0]+", "+r[1]+", "+r[2]+")"},Br.exactEquals=function(r,t){return r[0]===t[0]&&r[1]===t[1]&&r[2]===t[2]},Br.equals=function(r,t){var i=r[0],l=r[1],h=r[2],d=t[0],g=t[1],y=t[2];return Math.abs(i-d)<=Ql.EPSILON*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(l-g)<=Ql.EPSILON*Math.max(1,Math.abs(l),Math.abs(g))&&Math.abs(h-y)<=Ql.EPSILON*Math.max(1,Math.abs(h),Math.abs(y))},Br.forEach=Br.sqrLen=Br.len=Br.sqrDist=Br.dist=Br.div=Br.mul=Br.sub=void 0;var Ql=function(r,t){if(r&&r.__esModule)return r;if(r===null||Zv(r)!=="object"&&typeof r!="function")return{default:r};var i=$A(void 0);if(i&&i.has(r))return i.get(r);var l={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in r)if(d!=="default"&&Object.prototype.hasOwnProperty.call(r,d)){var g=h?Object.getOwnPropertyDescriptor(r,d):null;g&&(g.get||g.set)?Object.defineProperty(l,d,g):l[d]=r[d]}return l.default=r,i&&i.set(r,l),l}(ji);function $A(r){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return($A=function(l){return l?i:t})(r)}function jA(){var r=new Ql.ARRAY_TYPE(3);return Ql.ARRAY_TYPE!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function GA(r){return Math.hypot(r[0],r[1],r[2])}function HA(r,t,i){return r[0]=t[0]-i[0],r[1]=t[1]-i[1],r[2]=t[2]-i[2],r}function WA(r,t,i){return r[0]=t[0]*i[0],r[1]=t[1]*i[1],r[2]=t[2]*i[2],r}function qA(r,t,i){return r[0]=t[0]/i[0],r[1]=t[1]/i[1],r[2]=t[2]/i[2],r}function ZA(r,t){return Math.hypot(t[0]-r[0],t[1]-r[1],t[2]-r[2])}function XA(r,t){var i=t[0]-r[0],l=t[1]-r[1],h=t[2]-r[2];return i*i+l*l+h*h}function YA(r){var t=r[0],i=r[1],l=r[2];return t*t+i*i+l*l}function KA(r,t){return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]}Br.sub=HA,Br.mul=WA,Br.div=qA,Br.dist=ZA,Br.sqrDist=XA,Br.len=GA,Br.sqrLen=YA;var ec,x5=(ec=jA(),function(r,t,i,l,h,d){var g,y;for(t||(t=3),i||(i=0),y=l?Math.min(l*t+i,r.length):r.length,g=i;g<y;g+=t)ec[0]=r[g],ec[1]=r[g+1],ec[2]=r[g+2],h(ec,ec,d),r[g]=ec[0],r[g+1]=ec[1],r[g+2]=ec[2];return r});Br.forEach=x5;var Yr={};function Xv(r){return Xv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Xv(r)}Object.defineProperty(Yr,"__esModule",{value:!0}),Yr.create=QA,Yr.clone=function(r){var t=new to.ARRAY_TYPE(4);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t},Yr.fromValues=function(r,t,i,l){var h=new to.ARRAY_TYPE(4);return h[0]=r,h[1]=t,h[2]=i,h[3]=l,h},Yr.copy=function(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r},Yr.set=function(r,t,i,l,h){return r[0]=t,r[1]=i,r[2]=l,r[3]=h,r},Yr.add=function(r,t,i){return r[0]=t[0]+i[0],r[1]=t[1]+i[1],r[2]=t[2]+i[2],r[3]=t[3]+i[3],r},Yr.subtract=eC,Yr.multiply=tC,Yr.divide=rC,Yr.ceil=function(r,t){return r[0]=Math.ceil(t[0]),r[1]=Math.ceil(t[1]),r[2]=Math.ceil(t[2]),r[3]=Math.ceil(t[3]),r},Yr.floor=function(r,t){return r[0]=Math.floor(t[0]),r[1]=Math.floor(t[1]),r[2]=Math.floor(t[2]),r[3]=Math.floor(t[3]),r},Yr.min=function(r,t,i){return r[0]=Math.min(t[0],i[0]),r[1]=Math.min(t[1],i[1]),r[2]=Math.min(t[2],i[2]),r[3]=Math.min(t[3],i[3]),r},Yr.max=function(r,t,i){return r[0]=Math.max(t[0],i[0]),r[1]=Math.max(t[1],i[1]),r[2]=Math.max(t[2],i[2]),r[3]=Math.max(t[3],i[3]),r},Yr.round=function(r,t){return r[0]=Math.round(t[0]),r[1]=Math.round(t[1]),r[2]=Math.round(t[2]),r[3]=Math.round(t[3]),r},Yr.scale=function(r,t,i){return r[0]=t[0]*i,r[1]=t[1]*i,r[2]=t[2]*i,r[3]=t[3]*i,r},Yr.scaleAndAdd=function(r,t,i,l){return r[0]=t[0]+i[0]*l,r[1]=t[1]+i[1]*l,r[2]=t[2]+i[2]*l,r[3]=t[3]+i[3]*l,r},Yr.distance=nC,Yr.squaredDistance=iC,Yr.length=aC,Yr.squaredLength=sC,Yr.negate=function(r,t){return r[0]=-t[0],r[1]=-t[1],r[2]=-t[2],r[3]=-t[3],r},Yr.inverse=function(r,t){return r[0]=1/t[0],r[1]=1/t[1],r[2]=1/t[2],r[3]=1/t[3],r},Yr.normalize=function(r,t){var i=t[0],l=t[1],h=t[2],d=t[3],g=i*i+l*l+h*h+d*d;return g>0&&(g=1/Math.sqrt(g)),r[0]=i*g,r[1]=l*g,r[2]=h*g,r[3]=d*g,r},Yr.dot=function(r,t){return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]+r[3]*t[3]},Yr.cross=function(r,t,i,l){var h=i[0]*l[1]-i[1]*l[0],d=i[0]*l[2]-i[2]*l[0],g=i[0]*l[3]-i[3]*l[0],y=i[1]*l[2]-i[2]*l[1],b=i[1]*l[3]-i[3]*l[1],E=i[2]*l[3]-i[3]*l[2],A=t[0],M=t[1],P=t[2],O=t[3];return r[0]=M*E-P*b+O*y,r[1]=-A*E+P*g-O*d,r[2]=A*b-M*g+O*h,r[3]=-A*y+M*d-P*h,r},Yr.lerp=function(r,t,i,l){var h=t[0],d=t[1],g=t[2],y=t[3];return r[0]=h+l*(i[0]-h),r[1]=d+l*(i[1]-d),r[2]=g+l*(i[2]-g),r[3]=y+l*(i[3]-y),r},Yr.random=function(r,t){var i,l,h,d,g,y;t=t||1;do g=(i=2*to.RANDOM()-1)*i+(l=2*to.RANDOM()-1)*l;while(g>=1);do y=(h=2*to.RANDOM()-1)*h+(d=2*to.RANDOM()-1)*d;while(y>=1);var b=Math.sqrt((1-g)/y);return r[0]=t*i,r[1]=t*l,r[2]=t*h*b,r[3]=t*d*b,r},Yr.transformMat4=function(r,t,i){var l=t[0],h=t[1],d=t[2],g=t[3];return r[0]=i[0]*l+i[4]*h+i[8]*d+i[12]*g,r[1]=i[1]*l+i[5]*h+i[9]*d+i[13]*g,r[2]=i[2]*l+i[6]*h+i[10]*d+i[14]*g,r[3]=i[3]*l+i[7]*h+i[11]*d+i[15]*g,r},Yr.transformQuat=function(r,t,i){var l=t[0],h=t[1],d=t[2],g=i[0],y=i[1],b=i[2],E=i[3],A=E*l+y*d-b*h,M=E*h+b*l-g*d,P=E*d+g*h-y*l,O=-g*l-y*h-b*d;return r[0]=A*E+O*-g+M*-b-P*-y,r[1]=M*E+O*-y+P*-g-A*-b,r[2]=P*E+O*-b+A*-y-M*-g,r[3]=t[3],r},Yr.zero=function(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=0,r},Yr.str=function(r){return"vec4("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+")"},Yr.exactEquals=function(r,t){return r[0]===t[0]&&r[1]===t[1]&&r[2]===t[2]&&r[3]===t[3]},Yr.equals=function(r,t){var i=r[0],l=r[1],h=r[2],d=r[3],g=t[0],y=t[1],b=t[2],E=t[3];return Math.abs(i-g)<=to.EPSILON*Math.max(1,Math.abs(i),Math.abs(g))&&Math.abs(l-y)<=to.EPSILON*Math.max(1,Math.abs(l),Math.abs(y))&&Math.abs(h-b)<=to.EPSILON*Math.max(1,Math.abs(h),Math.abs(b))&&Math.abs(d-E)<=to.EPSILON*Math.max(1,Math.abs(d),Math.abs(E))},Yr.forEach=Yr.sqrLen=Yr.len=Yr.sqrDist=Yr.dist=Yr.div=Yr.mul=Yr.sub=void 0;var to=function(r,t){if(r&&r.__esModule)return r;if(r===null||Xv(r)!=="object"&&typeof r!="function")return{default:r};var i=JA(void 0);if(i&&i.has(r))return i.get(r);var l={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in r)if(d!=="default"&&Object.prototype.hasOwnProperty.call(r,d)){var g=h?Object.getOwnPropertyDescriptor(r,d):null;g&&(g.get||g.set)?Object.defineProperty(l,d,g):l[d]=r[d]}return l.default=r,i&&i.set(r,l),l}(ji);function JA(r){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(JA=function(l){return l?i:t})(r)}function QA(){var r=new to.ARRAY_TYPE(4);return to.ARRAY_TYPE!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r}function eC(r,t,i){return r[0]=t[0]-i[0],r[1]=t[1]-i[1],r[2]=t[2]-i[2],r[3]=t[3]-i[3],r}function tC(r,t,i){return r[0]=t[0]*i[0],r[1]=t[1]*i[1],r[2]=t[2]*i[2],r[3]=t[3]*i[3],r}function rC(r,t,i){return r[0]=t[0]/i[0],r[1]=t[1]/i[1],r[2]=t[2]/i[2],r[3]=t[3]/i[3],r}function nC(r,t){return Math.hypot(t[0]-r[0],t[1]-r[1],t[2]-r[2],t[3]-r[3])}function iC(r,t){var i=t[0]-r[0],l=t[1]-r[1],h=t[2]-r[2],d=t[3]-r[3];return i*i+l*l+h*h+d*d}function aC(r){return Math.hypot(r[0],r[1],r[2],r[3])}function sC(r){var t=r[0],i=r[1],l=r[2],h=r[3];return t*t+i*i+l*l+h*h}Yr.sub=eC,Yr.mul=tC,Yr.div=rC,Yr.dist=nC,Yr.sqrDist=iC,Yr.len=aC,Yr.sqrLen=sC;var y5=function(){var r=QA();return function(t,i,l,h,d,g){var y,b;for(i||(i=4),l||(l=0),b=h?Math.min(h*i+l,t.length):t.length,y=l;y<b;y+=i)r[0]=t[y],r[1]=t[y+1],r[2]=t[y+2],r[3]=t[y+3],d(r,r,g),t[y]=r[0],t[y+1]=r[1],t[y+2]=r[2],t[y+3]=r[3];return t}}();function Yv(r){return Yv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Yv(r)}Yr.forEach=y5,Object.defineProperty(Dr,"__esModule",{value:!0}),Dr.create=Kv,Dr.identity=function(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r},Dr.setAxisAngle=lC,Dr.getAxisAngle=function(r,t){var i=2*Math.acos(t[3]),l=Math.sin(i/2);return l>Dh.EPSILON?(r[0]=t[0]/l,r[1]=t[1]/l,r[2]=t[2]/l):(r[0]=1,r[1]=0,r[2]=0),i},Dr.getAngle=function(r,t){var i=pC(r,t);return Math.acos(2*i*i-1)},Dr.multiply=cC,Dr.rotateX=function(r,t,i){i*=.5;var l=t[0],h=t[1],d=t[2],g=t[3],y=Math.sin(i),b=Math.cos(i);return r[0]=l*b+g*y,r[1]=h*b+d*y,r[2]=d*b-h*y,r[3]=g*b-l*y,r},Dr.rotateY=function(r,t,i){i*=.5;var l=t[0],h=t[1],d=t[2],g=t[3],y=Math.sin(i),b=Math.cos(i);return r[0]=l*b-d*y,r[1]=h*b+g*y,r[2]=d*b+l*y,r[3]=g*b-h*y,r},Dr.rotateZ=function(r,t,i){i*=.5;var l=t[0],h=t[1],d=t[2],g=t[3],y=Math.sin(i),b=Math.cos(i);return r[0]=l*b+h*y,r[1]=h*b-l*y,r[2]=d*b+g*y,r[3]=g*b-d*y,r},Dr.calculateW=function(r,t){var i=t[0],l=t[1],h=t[2];return r[0]=i,r[1]=l,r[2]=h,r[3]=Math.sqrt(Math.abs(1-i*i-l*l-h*h)),r},Dr.exp=uC,Dr.ln=hC,Dr.pow=function(r,t,i){return hC(r,t),dC(r,r,i),uC(r,r),r},Dr.slerp=ix,Dr.random=function(r){var t=Dh.RANDOM(),i=Dh.RANDOM(),l=Dh.RANDOM(),h=Math.sqrt(1-t),d=Math.sqrt(t);return r[0]=h*Math.sin(2*Math.PI*i),r[1]=h*Math.cos(2*Math.PI*i),r[2]=d*Math.sin(2*Math.PI*l),r[3]=d*Math.cos(2*Math.PI*l),r},Dr.invert=function(r,t){var i=t[0],l=t[1],h=t[2],d=t[3],g=i*i+l*l+h*h+d*d,y=g?1/g:0;return r[0]=-i*y,r[1]=-l*y,r[2]=-h*y,r[3]=d*y,r},Dr.conjugate=function(r,t){return r[0]=-t[0],r[1]=-t[1],r[2]=-t[2],r[3]=t[3],r},Dr.fromMat3=fC,Dr.fromEuler=function(r,t,i,l){var h=.5*Math.PI/180;t*=h,i*=h,l*=h;var d=Math.sin(t),g=Math.cos(t),y=Math.sin(i),b=Math.cos(i),E=Math.sin(l),A=Math.cos(l);return r[0]=d*b*A-g*y*E,r[1]=g*y*A+d*b*E,r[2]=g*b*E-d*y*A,r[3]=g*b*A+d*y*E,r},Dr.str=function(r){return"quat("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+")"},Dr.setAxes=Dr.sqlerp=Dr.rotationTo=Dr.equals=Dr.exactEquals=Dr.normalize=Dr.sqrLen=Dr.squaredLength=Dr.len=Dr.length=Dr.lerp=Dr.dot=Dr.scale=Dr.mul=Dr.add=Dr.set=Dr.copy=Dr.fromValues=Dr.clone=void 0;var Dh=nx(ji),v5=nx(Pn),tc=nx(Br),Rs=nx(Yr);function oC(r){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(oC=function(l){return l?i:t})(r)}function nx(r,t){if(!t&&r&&r.__esModule)return r;if(r===null||Yv(r)!=="object"&&typeof r!="function")return{default:r};var i=oC(t);if(i&&i.has(r))return i.get(r);var l={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in r)if(d!=="default"&&Object.prototype.hasOwnProperty.call(r,d)){var g=h?Object.getOwnPropertyDescriptor(r,d):null;g&&(g.get||g.set)?Object.defineProperty(l,d,g):l[d]=r[d]}return l.default=r,i&&i.set(r,l),l}function Kv(){var r=new Dh.ARRAY_TYPE(4);return Dh.ARRAY_TYPE!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function lC(r,t,i){i*=.5;var l=Math.sin(i);return r[0]=l*t[0],r[1]=l*t[1],r[2]=l*t[2],r[3]=Math.cos(i),r}function cC(r,t,i){var l=t[0],h=t[1],d=t[2],g=t[3],y=i[0],b=i[1],E=i[2],A=i[3];return r[0]=l*A+g*y+h*E-d*b,r[1]=h*A+g*b+d*y-l*E,r[2]=d*A+g*E+l*b-h*y,r[3]=g*A-l*y-h*b-d*E,r}function uC(r,t){var i=t[0],l=t[1],h=t[2],d=t[3],g=Math.sqrt(i*i+l*l+h*h),y=Math.exp(d),b=g>0?y*Math.sin(g)/g:0;return r[0]=i*b,r[1]=l*b,r[2]=h*b,r[3]=y*Math.cos(g),r}function hC(r,t){var i=t[0],l=t[1],h=t[2],d=t[3],g=Math.sqrt(i*i+l*l+h*h),y=g>0?Math.atan2(g,d)/g:0;return r[0]=i*y,r[1]=l*y,r[2]=h*y,r[3]=.5*Math.log(i*i+l*l+h*h+d*d),r}function ix(r,t,i,l){var h,d,g,y,b,E=t[0],A=t[1],M=t[2],P=t[3],O=i[0],z=i[1],j=i[2],q=i[3];return(d=E*O+A*z+M*j+P*q)<0&&(d=-d,O=-O,z=-z,j=-j,q=-q),1-d>Dh.EPSILON?(h=Math.acos(d),g=Math.sin(h),y=Math.sin((1-l)*h)/g,b=Math.sin(l*h)/g):(y=1-l,b=l),r[0]=y*E+b*O,r[1]=y*A+b*z,r[2]=y*M+b*j,r[3]=y*P+b*q,r}function fC(r,t){var i,l=t[0]+t[4]+t[8];if(l>0)i=Math.sqrt(l+1),r[3]=.5*i,r[0]=(t[5]-t[7])*(i=.5/i),r[1]=(t[6]-t[2])*i,r[2]=(t[1]-t[3])*i;else{var h=0;t[4]>t[0]&&(h=1),t[8]>t[3*h+h]&&(h=2);var d=(h+1)%3,g=(h+2)%3;i=Math.sqrt(t[3*h+h]-t[3*d+d]-t[3*g+g]+1),r[h]=.5*i,r[3]=(t[3*d+g]-t[3*g+d])*(i=.5/i),r[d]=(t[3*d+h]+t[3*h+d])*i,r[g]=(t[3*g+h]+t[3*h+g])*i}return r}Dr.clone=Rs.clone,Dr.fromValues=Rs.fromValues,Dr.copy=Rs.copy,Dr.set=Rs.set,Dr.add=Rs.add,Dr.mul=cC;var dC=Rs.scale;Dr.scale=dC;var pC=Rs.dot;Dr.dot=pC,Dr.lerp=Rs.lerp;var mC=Rs.length;Dr.length=mC,Dr.len=mC;var gC=Rs.squaredLength;Dr.squaredLength=gC,Dr.sqrLen=gC;var Jv=Rs.normalize;Dr.normalize=Jv,Dr.exactEquals=Rs.exactEquals,Dr.equals=Rs.equals;var Mo,_C,xC,w5=(Mo=tc.create(),_C=tc.fromValues(1,0,0),xC=tc.fromValues(0,1,0),function(r,t,i){var l=tc.dot(t,i);return l<-.999999?(tc.cross(Mo,_C,t),tc.len(Mo)<1e-6&&tc.cross(Mo,xC,t),tc.normalize(Mo,Mo),lC(r,Mo,Math.PI),r):l>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(tc.cross(Mo,t,i),r[0]=Mo[0],r[1]=Mo[1],r[2]=Mo[2],r[3]=1+l,Jv(r,r))});Dr.rotationTo=w5;var Qv,ew,b5=(Qv=Kv(),ew=Kv(),function(r,t,i,l,h,d){return ix(Qv,t,h,d),ix(ew,i,l,d),ix(r,Qv,ew,2*d*(1-d)),r});Dr.sqlerp=b5;var Io,T5=(Io=v5.create(),function(r,t,i,l){return Io[0]=i[0],Io[3]=i[1],Io[6]=i[2],Io[1]=l[0],Io[4]=l[1],Io[7]=l[2],Io[2]=-t[0],Io[5]=-t[1],Io[8]=-t[2],Jv(r,fC(r,Io))});Dr.setAxes=T5;var rn={};function tw(r){return tw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tw(r)}Object.defineProperty(rn,"__esModule",{value:!0}),rn.create=function(){var r=new Ja.ARRAY_TYPE(8);return Ja.ARRAY_TYPE!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[4]=0,r[5]=0,r[6]=0,r[7]=0),r[3]=1,r},rn.clone=function(r){var t=new Ja.ARRAY_TYPE(8);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t},rn.fromValues=function(r,t,i,l,h,d,g,y){var b=new Ja.ARRAY_TYPE(8);return b[0]=r,b[1]=t,b[2]=i,b[3]=l,b[4]=h,b[5]=d,b[6]=g,b[7]=y,b},rn.fromRotationTranslationValues=function(r,t,i,l,h,d,g){var y=new Ja.ARRAY_TYPE(8);y[0]=r,y[1]=t,y[2]=i,y[3]=l;var b=.5*h,E=.5*d,A=.5*g;return y[4]=b*l+E*i-A*t,y[5]=E*l+A*r-b*i,y[6]=A*l+b*t-E*r,y[7]=-b*r-E*t-A*i,y},rn.fromRotationTranslation=wC,rn.fromTranslation=function(r,t){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r[4]=.5*t[0],r[5]=.5*t[1],r[6]=.5*t[2],r[7]=0,r},rn.fromRotation=function(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=0,r[5]=0,r[6]=0,r[7]=0,r},rn.fromMat4=function(r,t){var i=rc.create();yC.getRotation(i,t);var l=new Ja.ARRAY_TYPE(3);return yC.getTranslation(l,t),wC(r,i,l),r},rn.copy=bC,rn.identity=function(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r[4]=0,r[5]=0,r[6]=0,r[7]=0,r},rn.set=function(r,t,i,l,h,d,g,y,b){return r[0]=t,r[1]=i,r[2]=l,r[3]=h,r[4]=d,r[5]=g,r[6]=y,r[7]=b,r},rn.getDual=function(r,t){return r[0]=t[4],r[1]=t[5],r[2]=t[6],r[3]=t[7],r},rn.setDual=function(r,t){return r[4]=t[0],r[5]=t[1],r[6]=t[2],r[7]=t[3],r},rn.getTranslation=function(r,t){var i=t[4],l=t[5],h=t[6],d=t[7],g=-t[0],y=-t[1],b=-t[2],E=t[3];return r[0]=2*(i*E+d*g+l*b-h*y),r[1]=2*(l*E+d*y+h*g-i*b),r[2]=2*(h*E+d*b+i*y-l*g),r},rn.translate=function(r,t,i){var l=t[0],h=t[1],d=t[2],g=t[3],y=.5*i[0],b=.5*i[1],E=.5*i[2],A=t[4],M=t[5],P=t[6],O=t[7];return r[0]=l,r[1]=h,r[2]=d,r[3]=g,r[4]=g*y+h*E-d*b+A,r[5]=g*b+d*y-l*E+M,r[6]=g*E+l*b-h*y+P,r[7]=-l*y-h*b-d*E+O,r},rn.rotateX=function(r,t,i){var l=-t[0],h=-t[1],d=-t[2],g=t[3],y=t[4],b=t[5],E=t[6],A=t[7],M=y*g+A*l+b*d-E*h,P=b*g+A*h+E*l-y*d,O=E*g+A*d+y*h-b*l,z=A*g-y*l-b*h-E*d;return rc.rotateX(r,t,i),r[4]=M*(g=r[3])+z*(l=r[0])+P*(d=r[2])-O*(h=r[1]),r[5]=P*g+z*h+O*l-M*d,r[6]=O*g+z*d+M*h-P*l,r[7]=z*g-M*l-P*h-O*d,r},rn.rotateY=function(r,t,i){var l=-t[0],h=-t[1],d=-t[2],g=t[3],y=t[4],b=t[5],E=t[6],A=t[7],M=y*g+A*l+b*d-E*h,P=b*g+A*h+E*l-y*d,O=E*g+A*d+y*h-b*l,z=A*g-y*l-b*h-E*d;return rc.rotateY(r,t,i),r[4]=M*(g=r[3])+z*(l=r[0])+P*(d=r[2])-O*(h=r[1]),r[5]=P*g+z*h+O*l-M*d,r[6]=O*g+z*d+M*h-P*l,r[7]=z*g-M*l-P*h-O*d,r},rn.rotateZ=function(r,t,i){var l=-t[0],h=-t[1],d=-t[2],g=t[3],y=t[4],b=t[5],E=t[6],A=t[7],M=y*g+A*l+b*d-E*h,P=b*g+A*h+E*l-y*d,O=E*g+A*d+y*h-b*l,z=A*g-y*l-b*h-E*d;return rc.rotateZ(r,t,i),r[4]=M*(g=r[3])+z*(l=r[0])+P*(d=r[2])-O*(h=r[1]),r[5]=P*g+z*h+O*l-M*d,r[6]=O*g+z*d+M*h-P*l,r[7]=z*g-M*l-P*h-O*d,r},rn.rotateByQuatAppend=function(r,t,i){var l=i[0],h=i[1],d=i[2],g=i[3],y=t[0],b=t[1],E=t[2],A=t[3];return r[0]=y*g+A*l+b*d-E*h,r[1]=b*g+A*h+E*l-y*d,r[2]=E*g+A*d+y*h-b*l,r[3]=A*g-y*l-b*h-E*d,r[4]=(y=t[4])*g+(A=t[7])*l+(b=t[5])*d-(E=t[6])*h,r[5]=b*g+A*h+E*l-y*d,r[6]=E*g+A*d+y*h-b*l,r[7]=A*g-y*l-b*h-E*d,r},rn.rotateByQuatPrepend=function(r,t,i){var l=t[0],h=t[1],d=t[2],g=t[3],y=i[0],b=i[1],E=i[2],A=i[3];return r[0]=l*A+g*y+h*E-d*b,r[1]=h*A+g*b+d*y-l*E,r[2]=d*A+g*E+l*b-h*y,r[3]=g*A-l*y-h*b-d*E,r[4]=l*(A=i[7])+g*(y=i[4])+h*(E=i[6])-d*(b=i[5]),r[5]=h*A+g*b+d*y-l*E,r[6]=d*A+g*E+l*b-h*y,r[7]=g*A-l*y-h*b-d*E,r},rn.rotateAroundAxis=function(r,t,i,l){if(Math.abs(l)<Ja.EPSILON)return bC(r,t);var h=Math.hypot(i[0],i[1],i[2]);l*=.5;var d=Math.sin(l),g=d*i[0]/h,y=d*i[1]/h,b=d*i[2]/h,E=Math.cos(l),A=t[0],M=t[1],P=t[2],O=t[3];r[0]=A*E+O*g+M*b-P*y,r[1]=M*E+O*y+P*g-A*b,r[2]=P*E+O*b+A*y-M*g,r[3]=O*E-A*g-M*y-P*b;var z=t[4],j=t[5],q=t[6],Q=t[7];return r[4]=z*E+Q*g+j*b-q*y,r[5]=j*E+Q*y+q*g-z*b,r[6]=q*E+Q*b+z*y-j*g,r[7]=Q*E-z*g-j*y-q*b,r},rn.add=function(r,t,i){return r[0]=t[0]+i[0],r[1]=t[1]+i[1],r[2]=t[2]+i[2],r[3]=t[3]+i[3],r[4]=t[4]+i[4],r[5]=t[5]+i[5],r[6]=t[6]+i[6],r[7]=t[7]+i[7],r},rn.multiply=TC,rn.scale=function(r,t,i){return r[0]=t[0]*i,r[1]=t[1]*i,r[2]=t[2]*i,r[3]=t[3]*i,r[4]=t[4]*i,r[5]=t[5]*i,r[6]=t[6]*i,r[7]=t[7]*i,r},rn.lerp=function(r,t,i,l){var h=1-l;return EC(t,i)<0&&(l=-l),r[0]=t[0]*h+i[0]*l,r[1]=t[1]*h+i[1]*l,r[2]=t[2]*h+i[2]*l,r[3]=t[3]*h+i[3]*l,r[4]=t[4]*h+i[4]*l,r[5]=t[5]*h+i[5]*l,r[6]=t[6]*h+i[6]*l,r[7]=t[7]*h+i[7]*l,r},rn.invert=function(r,t){var i=ax(t);return r[0]=-t[0]/i,r[1]=-t[1]/i,r[2]=-t[2]/i,r[3]=t[3]/i,r[4]=-t[4]/i,r[5]=-t[5]/i,r[6]=-t[6]/i,r[7]=t[7]/i,r},rn.conjugate=function(r,t){return r[0]=-t[0],r[1]=-t[1],r[2]=-t[2],r[3]=t[3],r[4]=-t[4],r[5]=-t[5],r[6]=-t[6],r[7]=t[7],r},rn.normalize=function(r,t){var i=ax(t);if(i>0){i=Math.sqrt(i);var l=t[0]/i,h=t[1]/i,d=t[2]/i,g=t[3]/i,y=t[4],b=t[5],E=t[6],A=t[7],M=l*y+h*b+d*E+g*A;r[0]=l,r[1]=h,r[2]=d,r[3]=g,r[4]=(y-l*M)/i,r[5]=(b-h*M)/i,r[6]=(E-d*M)/i,r[7]=(A-g*M)/i}return r},rn.str=function(r){return"quat2("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+", "+r[4]+", "+r[5]+", "+r[6]+", "+r[7]+")"},rn.exactEquals=function(r,t){return r[0]===t[0]&&r[1]===t[1]&&r[2]===t[2]&&r[3]===t[3]&&r[4]===t[4]&&r[5]===t[5]&&r[6]===t[6]&&r[7]===t[7]},rn.equals=function(r,t){var i=r[0],l=r[1],h=r[2],d=r[3],g=r[4],y=r[5],b=r[6],E=r[7],A=t[0],M=t[1],P=t[2],O=t[3],z=t[4],j=t[5],q=t[6],Q=t[7];return Math.abs(i-A)<=Ja.EPSILON*Math.max(1,Math.abs(i),Math.abs(A))&&Math.abs(l-M)<=Ja.EPSILON*Math.max(1,Math.abs(l),Math.abs(M))&&Math.abs(h-P)<=Ja.EPSILON*Math.max(1,Math.abs(h),Math.abs(P))&&Math.abs(d-O)<=Ja.EPSILON*Math.max(1,Math.abs(d),Math.abs(O))&&Math.abs(g-z)<=Ja.EPSILON*Math.max(1,Math.abs(g),Math.abs(z))&&Math.abs(y-j)<=Ja.EPSILON*Math.max(1,Math.abs(y),Math.abs(j))&&Math.abs(b-q)<=Ja.EPSILON*Math.max(1,Math.abs(b),Math.abs(q))&&Math.abs(E-Q)<=Ja.EPSILON*Math.max(1,Math.abs(E),Math.abs(Q))},rn.sqrLen=rn.squaredLength=rn.len=rn.length=rn.dot=rn.mul=rn.setReal=rn.getReal=void 0;var Ja=rw(ji),rc=rw(Dr),yC=rw(Ur);function vC(r){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(vC=function(l){return l?i:t})(r)}function rw(r,t){if(!t&&r&&r.__esModule)return r;if(r===null||tw(r)!=="object"&&typeof r!="function")return{default:r};var i=vC(t);if(i&&i.has(r))return i.get(r);var l={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in r)if(d!=="default"&&Object.prototype.hasOwnProperty.call(r,d)){var g=h?Object.getOwnPropertyDescriptor(r,d):null;g&&(g.get||g.set)?Object.defineProperty(l,d,g):l[d]=r[d]}return l.default=r,i&&i.set(r,l),l}function wC(r,t,i){var l=.5*i[0],h=.5*i[1],d=.5*i[2],g=t[0],y=t[1],b=t[2],E=t[3];return r[0]=g,r[1]=y,r[2]=b,r[3]=E,r[4]=l*E+h*b-d*y,r[5]=h*E+d*g-l*b,r[6]=d*E+l*y-h*g,r[7]=-l*g-h*y-d*b,r}function bC(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r}function TC(r,t,i){var l=t[0],h=t[1],d=t[2],g=t[3],y=i[4],b=i[5],E=i[6],A=i[7],M=t[4],P=t[5],O=t[6],z=t[7],j=i[0],q=i[1],Q=i[2],oe=i[3];return r[0]=l*oe+g*j+h*Q-d*q,r[1]=h*oe+g*q+d*j-l*Q,r[2]=d*oe+g*Q+l*q-h*j,r[3]=g*oe-l*j-h*q-d*Q,r[4]=l*A+g*y+h*E-d*b+M*oe+z*j+P*Q-O*q,r[5]=h*A+g*b+d*y-l*E+P*oe+z*q+O*j-M*Q,r[6]=d*A+g*E+l*b-h*y+O*oe+z*Q+M*q-P*j,r[7]=g*A-l*y-h*b-d*E+z*oe-M*j-P*q-O*Q,r}rn.getReal=rc.copy,rn.setReal=rc.copy,rn.mul=TC;var EC=rc.dot;rn.dot=EC;var SC=rc.length;rn.length=SC,rn.len=SC;var ax=rc.squaredLength;rn.squaredLength=ax,rn.sqrLen=ax;var Gr={};function nw(r){return nw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},nw(r)}Object.defineProperty(Gr,"__esModule",{value:!0}),Gr.create=CC,Gr.clone=function(r){var t=new Fh.ARRAY_TYPE(2);return t[0]=r[0],t[1]=r[1],t},Gr.fromValues=function(r,t){var i=new Fh.ARRAY_TYPE(2);return i[0]=r,i[1]=t,i},Gr.copy=function(r,t){return r[0]=t[0],r[1]=t[1],r},Gr.set=function(r,t,i){return r[0]=t,r[1]=i,r},Gr.add=function(r,t,i){return r[0]=t[0]+i[0],r[1]=t[1]+i[1],r},Gr.subtract=kC,Gr.multiply=MC,Gr.divide=IC,Gr.ceil=function(r,t){return r[0]=Math.ceil(t[0]),r[1]=Math.ceil(t[1]),r},Gr.floor=function(r,t){return r[0]=Math.floor(t[0]),r[1]=Math.floor(t[1]),r},Gr.min=function(r,t,i){return r[0]=Math.min(t[0],i[0]),r[1]=Math.min(t[1],i[1]),r},Gr.max=function(r,t,i){return r[0]=Math.max(t[0],i[0]),r[1]=Math.max(t[1],i[1]),r},Gr.round=function(r,t){return r[0]=Math.round(t[0]),r[1]=Math.round(t[1]),r},Gr.scale=function(r,t,i){return r[0]=t[0]*i,r[1]=t[1]*i,r},Gr.scaleAndAdd=function(r,t,i,l){return r[0]=t[0]+i[0]*l,r[1]=t[1]+i[1]*l,r},Gr.distance=PC,Gr.squaredDistance=RC,Gr.length=DC,Gr.squaredLength=FC,Gr.negate=function(r,t){return r[0]=-t[0],r[1]=-t[1],r},Gr.inverse=function(r,t){return r[0]=1/t[0],r[1]=1/t[1],r},Gr.normalize=function(r,t){var i=t[0],l=t[1],h=i*i+l*l;return h>0&&(h=1/Math.sqrt(h)),r[0]=t[0]*h,r[1]=t[1]*h,r},Gr.dot=function(r,t){return r[0]*t[0]+r[1]*t[1]},Gr.cross=function(r,t,i){var l=t[0]*i[1]-t[1]*i[0];return r[0]=r[1]=0,r[2]=l,r},Gr.lerp=function(r,t,i,l){var h=t[0],d=t[1];return r[0]=h+l*(i[0]-h),r[1]=d+l*(i[1]-d),r},Gr.random=function(r,t){t=t||1;var i=2*Fh.RANDOM()*Math.PI;return r[0]=Math.cos(i)*t,r[1]=Math.sin(i)*t,r},Gr.transformMat2=function(r,t,i){var l=t[0],h=t[1];return r[0]=i[0]*l+i[2]*h,r[1]=i[1]*l+i[3]*h,r},Gr.transformMat2d=function(r,t,i){var l=t[0],h=t[1];return r[0]=i[0]*l+i[2]*h+i[4],r[1]=i[1]*l+i[3]*h+i[5],r},Gr.transformMat3=function(r,t,i){var l=t[0],h=t[1];return r[0]=i[0]*l+i[3]*h+i[6],r[1]=i[1]*l+i[4]*h+i[7],r},Gr.transformMat4=function(r,t,i){var l=t[0],h=t[1];return r[0]=i[0]*l+i[4]*h+i[12],r[1]=i[1]*l+i[5]*h+i[13],r},Gr.rotate=function(r,t,i,l){var h=t[0]-i[0],d=t[1]-i[1],g=Math.sin(l),y=Math.cos(l);return r[0]=h*y-d*g+i[0],r[1]=h*g+d*y+i[1],r},Gr.angle=function(r,t){var i=r[0],l=r[1],h=t[0],d=t[1],g=Math.sqrt(i*i+l*l)*Math.sqrt(h*h+d*d);return Math.acos(Math.min(Math.max(g&&(i*h+l*d)/g,-1),1))},Gr.zero=function(r){return r[0]=0,r[1]=0,r},Gr.str=function(r){return"vec2("+r[0]+", "+r[1]+")"},Gr.exactEquals=function(r,t){return r[0]===t[0]&&r[1]===t[1]},Gr.equals=function(r,t){var i=r[0],l=r[1],h=t[0],d=t[1];return Math.abs(i-h)<=Fh.EPSILON*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(l-d)<=Fh.EPSILON*Math.max(1,Math.abs(l),Math.abs(d))},Gr.forEach=Gr.sqrLen=Gr.sqrDist=Gr.dist=Gr.div=Gr.mul=Gr.sub=Gr.len=void 0;var Fh=function(r,t){if(r&&r.__esModule)return r;if(r===null||nw(r)!=="object"&&typeof r!="function")return{default:r};var i=AC(void 0);if(i&&i.has(r))return i.get(r);var l={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in r)if(d!=="default"&&Object.prototype.hasOwnProperty.call(r,d)){var g=h?Object.getOwnPropertyDescriptor(r,d):null;g&&(g.get||g.set)?Object.defineProperty(l,d,g):l[d]=r[d]}return l.default=r,i&&i.set(r,l),l}(ji);function AC(r){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(AC=function(l){return l?i:t})(r)}function CC(){var r=new Fh.ARRAY_TYPE(2);return Fh.ARRAY_TYPE!=Float32Array&&(r[0]=0,r[1]=0),r}function kC(r,t,i){return r[0]=t[0]-i[0],r[1]=t[1]-i[1],r}function MC(r,t,i){return r[0]=t[0]*i[0],r[1]=t[1]*i[1],r}function IC(r,t,i){return r[0]=t[0]/i[0],r[1]=t[1]/i[1],r}function PC(r,t){return Math.hypot(t[0]-r[0],t[1]-r[1])}function RC(r,t){var i=t[0]-r[0],l=t[1]-r[1];return i*i+l*l}function DC(r){return Math.hypot(r[0],r[1])}function FC(r){var t=r[0],i=r[1];return t*t+i*i}Gr.len=DC,Gr.sub=kC,Gr.mul=MC,Gr.div=IC,Gr.dist=PC,Gr.sqrDist=RC,Gr.sqrLen=FC;var E5=function(){var r=CC();return function(t,i,l,h,d,g){var y,b;for(i||(i=2),l||(l=0),b=h?Math.min(h*i+l,t.length):t.length,y=l;y<b;y+=i)r[0]=t[y],r[1]=t[y+1],d(r,r,g),t[y]=r[0],t[y+1]=r[1];return t}}();function iw(r){return iw=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},iw(r)}Gr.forEach=E5,Object.defineProperty($i,"__esModule",{value:!0}),o.a7=$i.vec4=o.N=$i.vec3=$i.vec2=$i.quat2=o.bi=$i.quat=o.a6=$i.mat4=o.co=$i.mat3=$i.mat2d=o.b4=$i.mat2=$i.glMatrix=void 0;var S5=yl(ji);$i.glMatrix=S5;var A5=yl(ai);o.b4=$i.mat2=A5;var C5=yl(oi);$i.mat2d=C5;var k5=yl(Pn);o.co=$i.mat3=k5;var M5=yl(Ur);o.a6=$i.mat4=M5;var I5=yl(Dr);o.bi=$i.quat=I5;var P5=yl(rn);$i.quat2=P5;var R5=yl(Gr);$i.vec2=R5;var D5=yl(Br);o.N=$i.vec3=D5;var F5=yl(Yr);function LC(r){if(typeof WeakMap!="function")return null;var t=new WeakMap,i=new WeakMap;return(LC=function(l){return l?i:t})(r)}function yl(r,t){if(!t&&r&&r.__esModule)return r;if(r===null||iw(r)!=="object"&&typeof r!="function")return{default:r};var i=LC(t);if(i&&i.has(r))return i.get(r);var l={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in r)if(d!=="default"&&Object.prototype.hasOwnProperty.call(r,d)){var g=h?Object.getOwnPropertyDescriptor(r,d):null;g&&(g.get||g.set)?Object.defineProperty(l,d,g):l[d]=r[d]}return l.default=r,i&&i.set(r,l),l}o.a7=$i.vec4=F5;class aw{constructor(t,i){this.pos=t,this.dir=i}intersectsPlane(t,i,l){const h=o.N.dot(i,this.dir);if(Math.abs(h)<1e-6)return!1;const d=((t[0]-this.pos[0])*i[0]+(t[1]-this.pos[1])*i[1]+(t[2]-this.pos[2])*i[2])/h;return l[0]=this.pos[0]+this.dir[0]*d,l[1]=this.pos[1]+this.dir[1]*d,l[2]=this.pos[2]+this.dir[2]*d,!0}closestPointOnSphere(t,i,l){if(o.N.equals(this.pos,t)||i===0)return l[0]=l[1]=l[2]=0,!1;const[h,d,g]=this.dir,y=this.pos[0]-t[0],b=this.pos[1]-t[1],E=this.pos[2]-t[2],A=h*h+d*d+g*g,M=2*(y*h+b*d+E*g),P=M*M-4*A*(y*y+b*b+E*E-i*i);if(P<0){const O=Math.max(-M/2,0),z=y+h*O,j=b+d*O,q=E+g*O,Q=Math.hypot(z,j,q);return l[0]=z*i/Q,l[1]=j*i/Q,l[2]=q*i/Q,!1}{const O=(-M-Math.sqrt(P))/(2*A);if(O<0){const z=Math.hypot(y,b,E);return l[0]=y*i/z,l[1]=b*i/z,l[2]=E*i/z,!1}return l[0]=y+h*O,l[1]=b+d*O,l[2]=E+g*O,!0}}}class sw{constructor(t,i,l,h,d){this.TL=t,this.TR=i,this.BR=l,this.BL=h,this.horizon=d}static fromInvProjectionMatrix(t,i,l){const h=[-1,1,1],d=[1,1,1],g=[1,-1,1],y=[-1,-1,1],b=o.N.transformMat4(h,h,t),E=o.N.transformMat4(d,d,t),A=o.N.transformMat4(g,g,t),M=o.N.transformMat4(y,y,t);return new sw(b,E,A,M,i/l)}}function X0(r,t,i){let l=1/0,h=-1/0;const d=[];for(const g of r){o.N.sub(d,g,t);const y=o.N.dot(d,i);l=Math.min(l,y),h=Math.max(h,y)}return[l,h]}function OC(r,t){let i=!0;for(let l=0;l<r.planes.length;l++){const h=r.planes[l];let d=0;for(let g=0;g<t.length;g++)d+=o.N.dot(h,t[g])+h[3]>=0;if(d===0)return 0;d!==t.length&&(i=!1)}return i?2:1}function NC(r,t){for(const i of r.projections){const l=X0(t,r.points[0],i.axis);if(i.projection[1]<l[0]||i.projection[0]>l[1])return 0}return 1}function zC(r,t){let i=0;const l=[0,0,0,0];for(let h=0;h<r.length;h++)l[0]=r[h][0],l[1]=r[h][1],l[2]=r[h][2],l[3]=1,o.a7.dot(l,t)>=0&&i++;return i}class ow{constructor(t,i){this.points=t||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=li.fromPoints(this.points),this.projections=[],this.frustumEdges=[o.N.sub([],this.points[2],this.points[3]),o.N.sub([],this.points[0],this.points[3]),o.N.sub([],this.points[4],this.points[0]),o.N.sub([],this.points[5],this.points[1]),o.N.sub([],this.points[6],this.points[2]),o.N.sub([],this.points[7],this.points[3])];for(const l of this.frustumEdges){const h=[0,-l[2],l[1]],d=[l[2],0,-l[0]];this.projections.push({axis:h,projection:X0(this.points,this.points[0],h)}),this.projections.push({axis:d,projection:X0(this.points,this.points[0],d)})}}static fromInvProjectionMatrix(t,i,l,h){const d=Math.pow(2,l),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(E=>{const A=o.a7.transformMat4([],E,t),M=1/A[3]/i*d;return o.a7.mul(A,A,[M,M,h?1/A[3]:M,M])}),y=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(E=>{const A=o.N.sub([],g[E[0]],g[E[1]]),M=o.N.sub([],g[E[2]],g[E[1]]),P=o.N.normalize([],o.N.cross([],A,M)),O=-o.N.dot(P,g[E[1]]);return P.concat(O)}),b=[];for(let E=0;E<g.length;E++)b.push([g[E][0],g[E][1],g[E][2]]);return new ow(b,y)}intersectsPrecise(t,i,l){for(let h=0;h<i.length;h++)if(!zC(t,i[h]))return 0;for(let h=0;h<this.planes.length;h++)if(!zC(t,this.planes[h]))return 0;for(const h of l)for(const d of this.frustumEdges){const g=o.N.cross([],h,d),y=o.N.length(g);if(y===0)continue;o.N.scale(g,g,1/y);const b=X0(this.points,this.points[0],g),E=X0(t,this.points[0],g);if(b[0]>E[1]||E[0]>b[1])return 0}return 1}}class li{static fromPoints(t){const i=[1/0,1/0,1/0],l=[-1/0,-1/0,-1/0];for(const h of t)o.N.min(i,i,h),o.N.max(l,l,h);return new li(i,l)}static fromTileIdAndHeight(t,i,l){const h=1<<t.canonical.z,d=t.canonical.x,g=t.canonical.y;return new li([d/h,g/h,i],[(d+1)/h,(g+1)/h,l])}static applyTransform(t,i){const l=t.getCorners();for(let h=0;h<l.length;++h)o.N.transformMat4(l[h],l[h],i);return li.fromPoints(l)}static projectAabbCorners(t,i){const l=t.getCorners();for(let h=0;h<l.length;++h)o.N.transformMat4(l[h],l[h],i);return l}constructor(t,i){this.min=t,this.max=i,this.center=o.N.scale([],o.N.add([],this.min,this.max),.5)}quadrant(t){const i=[t%2==0,t<2],l=o.N.clone(this.min),h=o.N.clone(this.max);for(let d=0;d<i.length;d++)l[d]=i[d]?this.min[d]:this.center[d],h[d]=i[d]?this.center[d]:this.max[d];return h[2]=this.max[2],new li(l,h)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}getCorners(){const t=this.min,i=this.max;return[[t[0],t[1],t[2]],[i[0],t[1],t[2]],[i[0],i[1],t[2]],[t[0],i[1],t[2]],[t[0],t[1],i[2]],[i[0],t[1],i[2]],[i[0],i[1],i[2]],[t[0],i[1],i[2]]]}intersects(t){return this.intersectsAabb(t.bounds)?OC(t,this.getCorners()):0}intersectsFlat(t){return this.intersectsAabb(t.bounds)?OC(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(t,i){return i||this.intersects(t)?NC(t,this.getCorners()):0}intersectsPreciseFlat(t,i){return i||this.intersectsFlat(t)?NC(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(t){for(let i=0;i<3;++i)if(this.min[i]>t.max[i]||t.min[i]>this.max[i])return!1;return!0}intersectsAabbXY(t){return!(this.min[0]>t.max[0]||t.min[0]>this.max[0]||this.min[1]>t.max[1]||t.min[1]>this.max[1])}encapsulate(t){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],t.min[i]),this.max[i]=Math.max(this.max[i],t.max[i])}encapsulatePoint(t){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],t[i]),this.max[i]=Math.max(this.max[i],t[i])}closestPoint(t){return[Math.max(Math.min(this.max[0],t[0]),this.min[0]),Math.max(Math.min(this.max[1],t[1]),this.min[1]),Math.max(Math.min(this.max[2],t[2]),this.min[2])]}}rr(li,"Aabb");const L5=bn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:sx}=L5,O5=bn([{name:"a_pos_3",components:3,type:"Int16"}]);var BC=bn([{name:"a_pos",type:"Int16",components:2}]);function ox(r){return r*ue/ct}const N5=[new li([$e,$e,$e],[nt,nt,nt]),new li([$e,$e,$e],[0,0,nt]),new li([0,$e,$e],[nt,0,nt]),new li([$e,0,$e],[0,nt,nt]),new li([0,0,$e],[nt,nt,nt])];function UC(r,t,i,l=!0){const h=o.N.scale([],r._camera.position,r.worldSize),d=[t,i,1,1];o.a7.transformMat4(d,d,r.pixelMatrixInverse),o.a7.scale(d,d,1/d[3]);const g=o.N.sub([],d,h),y=o.N.normalize([],g),b=r.globeMatrix,E=[b[12],b[13],b[14]],A=o.N.sub([],E,h),M=o.N.length(A),P=o.N.normalize([],A),O=r.worldSize/(2*Math.PI),z=o.N.dot(P,y),j=Math.asin(O/M);if(j<Math.acos(z)){if(!l)return null;const Ye=[],mt=[];o.N.scale(Ye,y,M/z),o.N.normalize(mt,o.N.sub(mt,Ye,A)),o.N.normalize(y,o.N.add(y,A,o.N.scale(y,mt,Math.tan(j)*M)))}const q=[];new aw(h,y).closestPointOnSphere(E,O,q);const Q=o.N.normalize([],Te(b,0)),oe=o.N.normalize([],Te(b,1)),pe=o.N.normalize([],Te(b,2)),de=o.N.dot(Q,q),Ce=o.N.dot(oe,q),Ee=o.N.dot(pe,q),Le=St(Math.asin(-Ce/O));let je=St(Math.atan2(de,Ee));je=r.center.lng+function(Ye,mt){const bt=(mt-Ye+180)%360-180;return bt<-180?bt+360:bt}(r.center.lng,je);const Ze=zr(je),it=st(Sr(Le),0,1);return new sn(Ze,it)}class z5{constructor(t,i,l){this.a=o.N.sub([],t,l),this.b=o.N.sub([],i,l),this.center=l;const h=o.N.normalize([],this.a),d=o.N.normalize([],this.b);this.angle=Math.acos(o.N.dot(h,d))}}function lw(r,t){if(r.angle===0)return null;let i;return i=r.a[t]===0?1/r.angle*.5*Math.PI:1/r.angle*Math.atan(r.b[t]/r.a[t]/Math.sin(r.angle)-1/Math.tan(r.angle)),i<0||i>1?null:function(l,h,d,g){const y=Math.sin(d);return l*(Math.sin((1-g)*d)/y)+h*(Math.sin(g*d)/y)}(r.a[t],r.b[t],r.angle,st(i,0,1))+r.center[t]}function vl(r){if(r.z<=1)return N5[r.z+2*r.y+r.x];const t=cw(lx(r));return li.fromPoints(t)}function nc(r,t,i){return o.N.scale(r,r,1-i),o.N.scaleAndAdd(r,r,t,i)}function VC(r,t,i){for(const l of r)o.N.transformMat4(l,l,t),o.N.scale(l,l,i)}function $C(r,t,i,l){const h=t/r.worldSize,d=r.globeMatrix;if(i.z<=1){const Ze=vl(i).getCorners();return VC(Ze,d,h),li.fromPoints(Ze)}const g=lx(i,l),y=cw(g,ue+ox(r._tileCoverLift));VC(y,d,h);const b=Number.MAX_VALUE,E=[-b,-b,-b],A=[b,b,b];if(g.contains(r.center)){for(const Ye of y)o.N.min(A,A,Ye),o.N.max(E,E,Ye);E[2]=0;const Ze=r.point,it=[Ze.x*h,Ze.y*h,0];return o.N.min(A,A,it),o.N.max(E,E,it),new li(A,E)}if(r._tileCoverLift>0){for(const Ze of y)o.N.min(A,A,Ze),o.N.max(E,E,Ze);return new li(A,E)}const M=[d[12]*h,d[13]*h,d[14]*h],P=g.getCenter(),O=st(r.center.lat,-Wr,Wr),z=st(P.lat,-Wr,Wr),j=zr(r.center.lng),q=Sr(O);let Q=j-zr(P.lng);const oe=q-Sr(z);Q>.5?Q-=1:Q<-.5&&(Q+=1);let pe=0;if(Math.abs(Q)>Math.abs(oe))pe=Q>=0?1:3;else{pe=oe>=0?0:2;const Ze=[d[4]*h,d[5]*h,d[6]*h],it=-Math.sin(Re(oe>=0?g.getSouth():g.getNorth()))*ue;o.N.scaleAndAdd(M,M,Ze,it)}const de=y[pe],Ce=y[(pe+1)%4],Ee=new z5(de,Ce,M),Le=[lw(Ee,0)||de[0],lw(Ee,1)||de[1],lw(Ee,2)||de[2]],je=Jc(r.zoom);if(je>0){const Ze=function({x:Ye,y:mt,z:bt},ht,wt,lt,vt){const Gt=1/(1<<bt);let Tt=Ye*Gt,ar=Tt+Gt,Qt=mt*Gt,It=Qt+Gt,vr=0;const hr=(Tt+ar)/2-lt;return hr>.5?vr=-1:hr<-.5&&(vr=1),Tt=((Tt+vr)*ht-(lt*=ht))*wt+lt,ar=((ar+vr)*ht-lt)*wt+lt,Qt=(Qt*ht-(vt*=ht))*wt+vt,It=(It*ht-vt)*wt+vt,[[Tt,It,0],[ar,It,0],[ar,Qt,0],[Tt,Qt,0]]}(i,t,r._pixelsPerMercatorPixel,j,q);for(let Ye=0;Ye<y.length;Ye++)nc(y[Ye],Ze[Ye],je);const it=o.N.add([],Ze[pe],Ze[(pe+1)%4]);o.N.scale(it,it,.5),nc(Le,it,je)}for(const Ze of y)o.N.min(A,A,Ze),o.N.max(E,E,Ze);return A[2]=Math.min(de[2],Ce[2]),o.N.min(A,A,Le),o.N.max(E,E,Le),new li(A,E)}function lx({x:r,y:t,z:i},l=!1){const h=1/(1<<i),d=new qe(Mr(r*h),t===(1<<i)-1&&l?-90:en((t+1)*h)),g=new qe(Mr((r+1)*h),t===0&&l?90:en(t*h));return new ot(d,g)}function cw(r,t=ue){const i=Re(r.getNorth()),l=Re(r.getSouth()),h=Math.cos(i),d=Math.cos(l),g=Math.sin(i),y=Math.sin(l),b=r.getWest(),E=r.getEast();return[Ge(d,y,b,t),Ge(d,y,E,t),Ge(h,g,E,t),Ge(h,g,b,t)]}function Y0(r,t,i,l){const h=1<<i.z,d=(r/Kt+i.x)/h;return ft(en((t/Kt+i.y)/h),Mr(d),l)}function cx({min:r,max:t}){return ve/Math.max(t[0]-r[0],t[1]-r[1],t[2]-r[2])}const jC=new Float64Array(16);function ux(r){const t=cx(r),i=o.a6.fromScaling(jC,[t,t,t]);return o.a6.translate(i,i,o.N.negate([],r.min))}function uw(r){const t=o.a6.fromTranslation(jC,r.min),i=1/cx(r);return o.a6.scale(t,t,[i,i,i])}function hw(r){const t=Kt/(2*Math.PI);return r/(2*Math.PI)/t}function GC(r,t){return Kt/(512*Math.pow(2,r))*cx(vl(t))}function HC(r,t,i,l,h){const d=hw(i),g=[r,t,-i/(2*Math.PI)],y=o.a6.identity(new Float64Array(16));return o.a6.translate(y,y,g),o.a6.scale(y,y,[d,d,d]),o.a6.rotateX(y,y,Re(-h)),o.a6.rotateY(y,y,Re(-l)),y}function Jc(r){return Ve(ye,ie,r)}function WC(r,t){const i=ft(t.lat,t.lng),l=function(d){const g=ft(d._center.lat,d._center.lng),y=o.N.fromValues(0,1,0);let b=o.N.cross([],y,g);const E=o.a6.fromRotation([],-d.angle,g);b=o.N.transformMat4(b,b,E),o.a6.fromRotation(E,-d._pitch,b);const A=o.N.normalize([],g);return o.N.scale(A,A,ox(d.cameraToCenterDistance/d.pixelsPerMeter)),o.N.transformMat4(A,A,E),o.N.add([],g,A)}(r),h=o.N.subtract([],l,i);return o.N.angle(h,i)}function fw(r,t){return WC(r,t)>Math.PI/2*1.01}const qC=Re(85),B5=Math.cos(qC),U5=Math.sin(qC),V5=o.a6.create(),ZC=r=>{const t=[];return r.paint.get("circle-pitch-alignment")==="map"&&t.push("PITCH_WITH_MAP"),r.paint.get("circle-pitch-scale")==="map"&&t.push("SCALE_WITH_MAP"),t};function XC(r,t,i,l,h,d,g,y,b){if(d&&r.queryGeometry.isAboveHorizon)return!1;d&&(b*=r.pixelToTileUnitsFactor);const E=r.tileID.canonical,A=i.projection.upVectorScale(E,i.center.lat,i.worldSize).metersToTile;for(const M of t)for(const P of M){const O=P.add(y),z=h&&i.elevation?i.elevation.exaggeration()*h.getElevationAt(O.x,O.y,!0):0,j=i.projection.projectTilePoint(O.x,O.y,E);if(z>0){const pe=i.projection.upVector(E,O.x,O.y);j.x+=pe[0]*A*z,j.y+=pe[1]*A*z,j.z+=pe[2]*A*z}const q=d?O:$5(j.x,j.y,j.z,l),Q=d?r.tilespaceRays.map(pe=>G5(pe,z)):r.queryGeometry.screenGeometry,oe=o.a7.transformMat4([],[j.x,j.y,j.z,1],l);if(!g&&d?b*=oe[3]/i.cameraToCenterDistance:g&&!d&&(b*=i.cameraToCenterDistance/oe[3]),d){const pe=en((P.y/Kt+E.y)/(1<<E.z));b/=i.projection.pixelsPerMeter(pe,1)/Pr(1,pe)}if(_l(Q,q,b))return!0}return!1}function $5(r,t,i,l){const h=o.a7.transformMat4([],[r,t,i,1],l);return new we(h[0]/h[3],h[1]/h[3])}const YC=o.N.fromValues(0,0,0),j5=o.N.fromValues(0,0,1);function G5(r,t){const i=o.N.create();return YC[2]=t,r.intersectsPlane(YC,j5,i),new we(i[0],i[1])}class KC extends Oa{}function JC(r,{width:t,height:i},l,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==t*i*l)throw new RangeError("mismatched image size")}else h=new Uint8Array(t*i*l);return r.width=t,r.height=i,r.data=h,r}function QC(r,t,i){const{width:l,height:h}=t;l===r.width&&h===r.height||(dw(r,t,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,l),height:Math.min(r.height,h)},i),r.width=l,r.height=h,r.data=t.data)}function dw(r,t,i,l,h,d,g){if(h.width===0||h.height===0)return t;if(h.width>r.width||h.height>r.height||i.x>r.width-h.width||i.y>r.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>t.width||h.height>t.height||l.x>t.width-h.width||l.y>t.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const y=r.data,b=t.data,E=d===4&&g;for(let A=0;A<h.height;A++){const M=((i.y+A)*r.width+i.x)*d,P=((l.y+A)*t.width+l.x)*d;if(E)for(let O=0;O<h.width;O++){const z=M+O*d+3,j=P+O*d;b[j+0]=255,b[j+1]=255,b[j+2]=255,b[j+3]=y[z]}else for(let O=0;O<h.width*d;O++)b[P+O]=y[M+O]}return t}rr(KC,"HeatmapBucket",{omit:["layers"]});class Qc{constructor(t,i){JC(this,t,1,i)}resize(t){QC(this,new Qc(t),1)}clone(){return new Qc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,i,l,h,d){dw(t,i,l,h,d,1)}}class Ds{constructor(t,i){JC(this,t,4,i)}resize(t){QC(this,new Ds(t),4)}replace(t,i){i?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Ds({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,i,l,h,d,g){dw(t,i,l,h,d,4,g)}}class ek{constructor(t,i){this.width=t.width,this.height=t.height,this.data=i instanceof Uint8Array?new Float32Array(i.buffer):i}}rr(Qc,"AlphaImage"),rr(Ds,"RGBAImage");const H5=new ni({visibility:new jt(tt.layout_heatmap.visibility)});var W5={paint:new ni({"heatmap-radius":new mr(tt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new mr(tt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new jt(tt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Yl(tt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new jt(tt.paint_heatmap["heatmap-opacity"])}),layout:H5};function K0(r){const t={},i=r.resolution||256,l=r.clips?r.clips.length:1,h=r.image||new Ds({width:i,height:l}),d=(g,y,b)=>{t[r.evaluationKey]=b;const E=r.expression.evaluate(t);E&&(h.data[g+y+0]=Math.floor(255*E.r/E.a),h.data[g+y+1]=Math.floor(255*E.g/E.a),h.data[g+y+2]=Math.floor(255*E.b/E.a),h.data[g+y+3]=Math.floor(255*E.a))};if(r.clips)for(let g=0,y=0;g<l;++g,y+=4*i)for(let b=0,E=0;b<i;b++,E+=4){const A=b/(i-1),{start:M,end:P}=r.clips[g];d(y,E,M*(1-A)+P*A)}else for(let g=0,y=0;g<i;g++,y+=4)d(0,y,g/(i-1));return h}const q5=new ni({visibility:new jt(tt.layout_hillshade.visibility)});var Z5={paint:new ni({"hillshade-illumination-direction":new jt(tt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new jt(tt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new jt(tt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new jt(tt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new jt(tt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new jt(tt.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new jt(tt.paint_hillshade["hillshade-emissive-strength"])}),layout:q5};const X5=bn([{name:"a_pos",components:2,type:"Int16"}],4),{members:Y5}=X5;var pw={exports:{}};function hx(r,t,i){i=i||2;var l,h,d,g,y,b,E,A=t&&t.length,M=A?t[0]*i:r.length,P=tk(r,0,M,i,!0),O=[];if(!P||P.next===P.prev)return O;if(A&&(P=function(j,q,Q,oe){var pe,de,Ce,Ee=[];for(pe=0,de=q.length;pe<de;pe++)(Ce=tk(j,q[pe]*oe,pe<de-1?q[pe+1]*oe:j.length,oe,!1))===Ce.next&&(Ce.steiner=!0),Ee.push(iN(Ce));for(Ee.sort(tN),pe=0;pe<Ee.length;pe++)Q=rN(Ee[pe],Q);return Q}(r,t,P,i)),r.length>80*i){l=d=r[0],h=g=r[1];for(var z=i;z<M;z+=i)(y=r[z])<l&&(l=y),(b=r[z+1])<h&&(h=b),y>d&&(d=y),b>g&&(g=b);E=(E=Math.max(d-l,g-h))!==0?32767/E:0}return J0(P,O,i,l,h,E,0),O}function tk(r,t,i,l,h){var d,g;if(h===_w(r,t,i,l)>0)for(d=t;d<i;d+=l)g=ik(d,r[d],r[d+1],g);else for(d=i-l;d>=t;d-=l)g=ik(d,r[d],r[d+1],g);return g&&fx(g,g.next)&&(em(g),g=g.next),g}function Lh(r,t){if(!r)return r;t||(t=r);var i,l=r;do if(i=!1,l.steiner||!fx(l,l.next)&&Ii(l.prev,l,l.next)!==0)l=l.next;else{if(em(l),(l=t=l.prev)===l.next)break;i=!0}while(i||l!==t);return t}function J0(r,t,i,l,h,d,g){if(r){!g&&d&&function(A,M,P,O){var z=A;do z.z===0&&(z.z=mw(z.x,z.y,M,P,O)),z.prevZ=z.prev,z.nextZ=z.next,z=z.next;while(z!==A);z.prevZ.nextZ=null,z.prevZ=null,function(j){var q,Q,oe,pe,de,Ce,Ee,Le,je=1;do{for(Q=j,j=null,de=null,Ce=0;Q;){for(Ce++,oe=Q,Ee=0,q=0;q<je&&(Ee++,oe=oe.nextZ);q++);for(Le=je;Ee>0||Le>0&&oe;)Ee!==0&&(Le===0||!oe||Q.z<=oe.z)?(pe=Q,Q=Q.nextZ,Ee--):(pe=oe,oe=oe.nextZ,Le--),de?de.nextZ=pe:j=pe,pe.prevZ=de,de=pe;Q=oe}de.nextZ=null,je*=2}while(Ce>1)}(z)}(r,l,h,d);for(var y,b,E=r;r.prev!==r.next;)if(y=r.prev,b=r.next,d?J5(r,l,h,d):K5(r))t.push(y.i/i|0),t.push(r.i/i|0),t.push(b.i/i|0),em(r),r=b.next,E=b.next;else if((r=b)===E){g?g===1?J0(r=Q5(Lh(r),t,i),t,i,l,h,d,2):g===2&&eN(r,t,i,l,h,d):J0(Lh(r),t,i,l,h,d,1);break}}}function K5(r){var t=r.prev,i=r,l=r.next;if(Ii(t,i,l)>=0)return!1;for(var h=t.x,d=i.x,g=l.x,y=t.y,b=i.y,E=l.y,A=h<d?h<g?h:g:d<g?d:g,M=y<b?y<E?y:E:b<E?b:E,P=h>d?h>g?h:g:d>g?d:g,O=y>b?y>E?y:E:b>E?b:E,z=l.next;z!==t;){if(z.x>=A&&z.x<=P&&z.y>=M&&z.y<=O&&id(h,y,d,b,g,E,z.x,z.y)&&Ii(z.prev,z,z.next)>=0)return!1;z=z.next}return!0}function J5(r,t,i,l){var h=r.prev,d=r,g=r.next;if(Ii(h,d,g)>=0)return!1;for(var y=h.x,b=d.x,E=g.x,A=h.y,M=d.y,P=g.y,O=y<b?y<E?y:E:b<E?b:E,z=A<M?A<P?A:P:M<P?M:P,j=y>b?y>E?y:E:b>E?b:E,q=A>M?A>P?A:P:M>P?M:P,Q=mw(O,z,t,i,l),oe=mw(j,q,t,i,l),pe=r.prevZ,de=r.nextZ;pe&&pe.z>=Q&&de&&de.z<=oe;){if(pe.x>=O&&pe.x<=j&&pe.y>=z&&pe.y<=q&&pe!==h&&pe!==g&&id(y,A,b,M,E,P,pe.x,pe.y)&&Ii(pe.prev,pe,pe.next)>=0||(pe=pe.prevZ,de.x>=O&&de.x<=j&&de.y>=z&&de.y<=q&&de!==h&&de!==g&&id(y,A,b,M,E,P,de.x,de.y)&&Ii(de.prev,de,de.next)>=0))return!1;de=de.nextZ}for(;pe&&pe.z>=Q;){if(pe.x>=O&&pe.x<=j&&pe.y>=z&&pe.y<=q&&pe!==h&&pe!==g&&id(y,A,b,M,E,P,pe.x,pe.y)&&Ii(pe.prev,pe,pe.next)>=0)return!1;pe=pe.prevZ}for(;de&&de.z<=oe;){if(de.x>=O&&de.x<=j&&de.y>=z&&de.y<=q&&de!==h&&de!==g&&id(y,A,b,M,E,P,de.x,de.y)&&Ii(de.prev,de,de.next)>=0)return!1;de=de.nextZ}return!0}function Q5(r,t,i){var l=r;do{var h=l.prev,d=l.next.next;!fx(h,d)&&rk(h,l,l.next,d)&&Q0(h,d)&&Q0(d,h)&&(t.push(h.i/i|0),t.push(l.i/i|0),t.push(d.i/i|0),em(l),em(l.next),l=r=d),l=l.next}while(l!==r);return Lh(l)}function eN(r,t,i,l,h,d){var g=r;do{for(var y=g.next.next;y!==g.prev;){if(g.i!==y.i&&aN(g,y)){var b=nk(g,y);return g=Lh(g,g.next),b=Lh(b,b.next),J0(g,t,i,l,h,d,0),void J0(b,t,i,l,h,d,0)}y=y.next}g=g.next}while(g!==r)}function tN(r,t){return r.x-t.x}function rN(r,t){var i=function(h,d){var g,y=d,b=h.x,E=h.y,A=-1/0;do{if(E<=y.y&&E>=y.next.y&&y.next.y!==y.y){var M=y.x+(E-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(M<=b&&M>A&&(A=M,g=y.x<y.next.x?y:y.next,M===b))return g}y=y.next}while(y!==d);if(!g)return null;var P,O=g,z=g.x,j=g.y,q=1/0;y=g;do b>=y.x&&y.x>=z&&b!==y.x&&id(E<j?b:A,E,z,j,E<j?A:b,E,y.x,y.y)&&(P=Math.abs(E-y.y)/(b-y.x),Q0(y,h)&&(P<q||P===q&&(y.x>g.x||y.x===g.x&&nN(g,y)))&&(g=y,q=P)),y=y.next;while(y!==O);return g}(r,t);if(!i)return t;var l=nk(i,r);return Lh(l,l.next),Lh(i,i.next)}function nN(r,t){return Ii(r.prev,r,t.prev)<0&&Ii(t.next,r,r.next)<0}function mw(r,t,i,l,h){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-i)*h|0)|r<<8))|r<<4))|r<<2))|r<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-l)*h|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function iN(r){var t=r,i=r;do(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next;while(t!==r);return i}function id(r,t,i,l,h,d,g,y){return(h-g)*(t-y)>=(r-g)*(d-y)&&(r-g)*(l-y)>=(i-g)*(t-y)&&(i-g)*(d-y)>=(h-g)*(l-y)}function aN(r,t){return r.next.i!==t.i&&r.prev.i!==t.i&&!function(i,l){var h=i;do{if(h.i!==i.i&&h.next.i!==i.i&&h.i!==l.i&&h.next.i!==l.i&&rk(h,h.next,i,l))return!0;h=h.next}while(h!==i);return!1}(r,t)&&(Q0(r,t)&&Q0(t,r)&&function(i,l){var h=i,d=!1,g=(i.x+l.x)/2,y=(i.y+l.y)/2;do h.y>y!=h.next.y>y&&h.next.y!==h.y&&g<(h.next.x-h.x)*(y-h.y)/(h.next.y-h.y)+h.x&&(d=!d),h=h.next;while(h!==i);return d}(r,t)&&(Ii(r.prev,r,t.prev)||Ii(r,t.prev,t))||fx(r,t)&&Ii(r.prev,r,r.next)>0&&Ii(t.prev,t,t.next)>0)}function Ii(r,t,i){return(t.y-r.y)*(i.x-t.x)-(t.x-r.x)*(i.y-t.y)}function fx(r,t){return r.x===t.x&&r.y===t.y}function rk(r,t,i,l){var h=px(Ii(r,t,i)),d=px(Ii(r,t,l)),g=px(Ii(i,l,r)),y=px(Ii(i,l,t));return h!==d&&g!==y||!(h!==0||!dx(r,i,t))||!(d!==0||!dx(r,l,t))||!(g!==0||!dx(i,r,l))||!(y!==0||!dx(i,t,l))}function dx(r,t,i){return t.x<=Math.max(r.x,i.x)&&t.x>=Math.min(r.x,i.x)&&t.y<=Math.max(r.y,i.y)&&t.y>=Math.min(r.y,i.y)}function px(r){return r>0?1:r<0?-1:0}function Q0(r,t){return Ii(r.prev,r,r.next)<0?Ii(r,t,r.next)>=0&&Ii(r,r.prev,t)>=0:Ii(r,t,r.prev)<0||Ii(r,r.next,t)<0}function nk(r,t){var i=new gw(r.i,r.x,r.y),l=new gw(t.i,t.x,t.y),h=r.next,d=t.prev;return r.next=t,t.prev=r,i.next=h,h.prev=i,l.next=i,i.prev=l,d.next=l,l.prev=d,l}function ik(r,t,i,l){var h=new gw(r,t,i);return l?(h.next=l.next,h.prev=l,l.next.prev=h,l.next=h):(h.prev=h,h.next=h),h}function em(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function gw(r,t,i){this.i=r,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function _w(r,t,i,l){for(var h=0,d=t,g=i-l;d<i;d+=l)h+=(r[g]-r[d])*(r[d+1]+r[g+1]),g=d;return h}pw.exports=hx,pw.exports.default=hx,hx.deviation=function(r,t,i,l){var h=t&&t.length,d=Math.abs(_w(r,0,h?t[0]*i:r.length,i));if(h)for(var g=0,y=t.length;g<y;g++)d-=Math.abs(_w(r,t[g]*i,g<y-1?t[g+1]*i:r.length,i));var b=0;for(g=0;g<l.length;g+=3){var E=l[g]*i,A=l[g+1]*i,M=l[g+2]*i;b+=Math.abs((r[E]-r[M])*(r[A+1]-r[E+1])-(r[E]-r[A])*(r[M+1]-r[E+1]))}return d===0&&b===0?0:Math.abs((b-d)/d)},hx.flatten=function(r){for(var t=r[0][0].length,i={vertices:[],holes:[],dimensions:t},l=0,h=0;h<r.length;h++){for(var d=0;d<r[h].length;d++)for(var g=0;g<t;g++)i.vertices.push(r[h][d][g]);h>0&&i.holes.push(l+=r[h-1].length)}return i};var mx=Z(pw.exports);function xw(r,t){const i=r.length;if(i<=1)return[r];const l=[];let h,d;for(let g=0;g<i;g++){const y=Ir(r[g]);y!==0&&(r[g].area=Math.abs(y),d===void 0&&(d=y<0),d===y<0?(h&&l.push(h),h=[r[g]]):h.push(r[g]))}if(h&&l.push(h),t>1)for(let g=0;g<l.length;g++)l[g].length<=t||(vv(l[g],t,1,l[g].length-1,sN),l[g]=l[g].slice(0,t));return l}function sN(r,t){return t.area-r.area}function yw(r,t,i){const l=i.patternDependencies;let h=!1;for(const d of t){const g=d.paint.get(`${r}-pattern`);g.isConstant()||(h=!0);const y=g.constantOr(null);y&&(h=!0,l[y]=!0)}return h}function vw(r,t,i,l,h){const d=h.patternDependencies;for(const g of t){const y=g.paint.get(`${r}-pattern`).value;if(y.kind!=="constant"){let b=y.evaluate({zoom:l},i,{},h.availableImages);b=b&&b.name?b.name:b,d[b]=!0,i.patterns[g.id]=b}}return i}class ww{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Is,this.indexArray=new Oi,this.indexArray2=new Js,this.programConfigurations=new te(t.layers,t.zoom),this.segments=new ui,this.segments2=new ui,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=t.projection}populate(t,i,l,h){this.hasPattern=yw("fill",this.layers,i);const d=this.layers[0].layout.get("fill-sort-key"),g=[];for(const{feature:y,id:b,index:E,sourceLayerIndex:A}of t){const M=this.layers[0]._featureFilter.needGeometry,P=Ai(y,M);if(!this.layers[0]._featureFilter.filter(new ri(this.zoom),P,l))continue;const O=d?d.evaluate(P,{},l,i.availableImages):void 0,z={id:b,properties:y.properties,type:y.type,sourceLayerIndex:A,index:E,geometry:M?P.geometry:zi(y,l,h),patterns:{},sortKey:O};g.push(z)}d&&g.sort((y,b)=>y.sortKey-b.sortKey);for(const y of g){const{geometry:b,index:E,sourceLayerIndex:A}=y;if(this.hasPattern){const M=vw("fill",this.layers,y,this.zoom,i);this.patternFeatures.push(M)}else this.addFeature(y,b,E,l,{},i.availableImages,i.brightness);i.featureIndex.insert(t[E].feature,b,E,A,this.index)}}update(t,i,l,h,d){const g=Object.keys(t).length!==0;g&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,i,g?this.stateDependentLayers:this.layers,l,h,d)}addFeatures(t,i,l,h,d,g){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,i,l,h,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Y5),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,i,l,h,d,g=[],y){for(const b of xw(i,500)){let E=0;for(const j of b)E+=j.length;const A=this.segments.prepareSegment(E,this.layoutVertexArray,this.indexArray),M=A.vertexLength,P=[],O=[];for(const j of b){if(j.length===0)continue;j!==b[0]&&O.push(P.length/2);const q=this.segments2.prepareSegment(j.length,this.layoutVertexArray,this.indexArray2),Q=q.vertexLength;this.layoutVertexArray.emplaceBack(j[0].x,j[0].y),this.indexArray2.emplaceBack(Q+j.length-1,Q),P.push(j[0].x),P.push(j[0].y);for(let oe=1;oe<j.length;oe++)this.layoutVertexArray.emplaceBack(j[oe].x,j[oe].y),this.indexArray2.emplaceBack(Q+oe-1,Q+oe),P.push(j[oe].x),P.push(j[oe].y);q.vertexLength+=j.length,q.primitiveLength+=j.length}const z=mx(P,O);for(let j=0;j<z.length;j+=3)this.indexArray.emplaceBack(M+z[j],M+z[j+1],M+z[j+2]);A.vertexLength+=E,A.primitiveLength+=z.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,d,g,h,y)}}rr(ww,"FillBucket",{omit:["layers","patternFeatures"]});const oN=new ni({"fill-sort-key":new mr(tt.layout_fill["fill-sort-key"]),visibility:new jt(tt.layout_fill.visibility)});var lN={paint:new ni({"fill-antialias":new jt(tt.paint_fill["fill-antialias"]),"fill-opacity":new mr(tt.paint_fill["fill-opacity"]),"fill-color":new mr(tt.paint_fill["fill-color"]),"fill-outline-color":new mr(tt.paint_fill["fill-outline-color"]),"fill-translate":new jt(tt.paint_fill["fill-translate"]),"fill-translate-anchor":new jt(tt.paint_fill["fill-translate-anchor"]),"fill-pattern":new mr(tt.paint_fill["fill-pattern"]),"fill-emissive-strength":new jt(tt.paint_fill["fill-emissive-strength"])}),layout:oN};const cN=bn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),uN=bn([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),hN=bn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),fN=bn([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),dN=bn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:pN}=cN;var gx={},mN=me,ak=ad;function ad(r,t,i,l,h){this.properties={},this.extent=i,this.type=0,this._pbf=r,this._geometry=-1,this._keys=l,this._values=h,r.readFields(gN,this,t)}function gN(r,t,i){r==1?t.id=i.readVarint():r==2?function(l,h){for(var d=l.readVarint()+l.pos;l.pos<d;){var g=h._keys[l.readVarint()],y=h._values[l.readVarint()];h.properties[g]=y}}(i,t):r==3?t.type=i.readVarint():r==4&&(t._geometry=i.pos)}function _N(r){for(var t,i,l=0,h=0,d=r.length,g=d-1;h<d;g=h++)l+=((i=r[g]).x-(t=r[h]).x)*(t.y+i.y);return l}ad.types=["Unknown","Point","LineString","Polygon"],ad.prototype.loadGeometry=function(){var r=this._pbf;r.pos=this._geometry;for(var t,i=r.readVarint()+r.pos,l=1,h=0,d=0,g=0,y=[];r.pos<i;){if(h<=0){var b=r.readVarint();l=7&b,h=b>>3}if(h--,l===1||l===2)d+=r.readSVarint(),g+=r.readSVarint(),l===1&&(t&&y.push(t),t=[]),t.push(new mN(d,g));else{if(l!==7)throw new Error("unknown command "+l);t&&t.push(t[0].clone())}}return t&&y.push(t),y},ad.prototype.bbox=function(){var r=this._pbf;r.pos=this._geometry;for(var t=r.readVarint()+r.pos,i=1,l=0,h=0,d=0,g=1/0,y=-1/0,b=1/0,E=-1/0;r.pos<t;){if(l<=0){var A=r.readVarint();i=7&A,l=A>>3}if(l--,i===1||i===2)(h+=r.readSVarint())<g&&(g=h),h>y&&(y=h),(d+=r.readSVarint())<b&&(b=d),d>E&&(E=d);else if(i!==7)throw new Error("unknown command "+i)}return[g,b,y,E]},ad.prototype.toGeoJSON=function(r,t,i){var l,h,d=this.extent*Math.pow(2,i),g=this.extent*r,y=this.extent*t,b=this.loadGeometry(),E=ad.types[this.type];function A(O){for(var z=0;z<O.length;z++){var j=O[z];O[z]=[360*(j.x+g)/d-180,360/Math.PI*Math.atan(Math.exp((180-360*(j.y+y)/d)*Math.PI/180))-90]}}switch(this.type){case 1:var M=[];for(l=0;l<b.length;l++)M[l]=b[l][0];A(b=M);break;case 2:for(l=0;l<b.length;l++)A(b[l]);break;case 3:for(b=function(O){var z=O.length;if(z<=1)return[O];for(var j,q,Q=[],oe=0;oe<z;oe++){var pe=_N(O[oe]);pe!==0&&(q===void 0&&(q=pe<0),q===pe<0?(j&&Q.push(j),j=[O[oe]]):j.push(O[oe]))}return j&&Q.push(j),Q}(b),l=0;l<b.length;l++)for(h=0;h<b[l].length;h++)A(b[l][h])}b.length===1?b=b[0]:E="Multi"+E;var P={type:"Feature",geometry:{type:E,coordinates:b},properties:this.properties};return"id"in this&&(P.id=this.id),P};var xN=ak,sk=ok;function ok(r,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],r.readFields(yN,this,t),this.length=this._features.length}function yN(r,t,i){r===15?t.version=i.readVarint():r===1?t.name=i.readString():r===5?t.extent=i.readVarint():r===2?t._features.push(i.pos):r===3?t._keys.push(i.readString()):r===4&&t._values.push(function(l){for(var h=null,d=l.readVarint()+l.pos;l.pos<d;){var g=l.readVarint()>>3;h=g===1?l.readString():g===2?l.readFloat():g===3?l.readDouble():g===4?l.readVarint64():g===5?l.readVarint():g===6?l.readSVarint():g===7?l.readBoolean():null}return h}(i))}ok.prototype.feature=function(r){if(r<0||r>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[r];var t=this._pbf.readVarint()+this._pbf.pos;return new xN(this._pbf,t,this.extent,this._keys,this._values)};var vN=sk;function wN(r,t,i){if(r===3){var l=new vN(i,i.readVarint()+i.pos);l.length&&(t[l.name]=l)}}var bw=gx.VectorTile=function(r,t){this.layers=r.readFields(wN,{},t)},_x=gx.VectorTileFeature=ak;function xx(r,t,i,l){const h=[],d=l===0?(g,y,b,E,A,M)=>{g.push(new we(M,b+(M-y)/(E-y)*(A-b)))}:(g,y,b,E,A,M)=>{g.push(new we(y+(M-b)/(A-b)*(E-y),M))};for(const g of r){const y=[];for(const b of g){if(b.length<=2)continue;const E=[];for(let P=0;P<b.length-1;P++){const O=b[P].x,z=b[P].y,j=b[P+1].x,q=b[P+1].y,Q=l===0?O:z,oe=l===0?j:q;Q<t?oe>t&&d(E,O,z,j,q,t):Q>i?oe<i&&d(E,O,z,j,q,i):E.push(b[P]),oe<t&&Q>=t&&d(E,O,z,j,q,t),oe>i&&Q<=i&&d(E,O,z,j,q,i)}let A=b[b.length-1];const M=l===0?A.x:A.y;M>=t&&M<=i&&E.push(A),E.length&&(A=E[E.length-1],E[0].x===A.x&&E[0].y===A.y||E.push(E[0]),y.push(E))}y.length&&h.push(y)}return h}function yx(r,t){return r.x-t.x||r.y-t.y}function lk(r,t){return yx(r.min,t.min)===0&&yx(r.max,t.max)===0}function ck(r,t){return!(r.min.x>t.max.x||r.max.x<t.min.x||r.min.y>t.max.y||r.max.y<t.min.y)}function uk(r,t,i){const l=1/Kt,h=1/(1<<i.canonical.z),d=(t.x*l+i.canonical.x)*h+i.wrap,g=(t.y*l+i.canonical.y)*h;return{min:new we((r.x*l+i.canonical.x)*h+i.wrap,(r.y*l+i.canonical.y)*h),max:new we(d,g)}}function bN(r,t,i){const l=1<<i.canonical.z,h=((t.x-i.wrap)*l-i.canonical.x)*Kt,d=(t.y*l-i.canonical.y)*Kt;return{min:new we(((r.x-i.wrap)*l-i.canonical.x)*Kt,(r.y*l-i.canonical.y)*Kt),max:new we(h,d)}}function hk(r,t,i,l,h,d,g){const y=r.indices,b=r.vertices,E=[];for(let A=l;A<l+h;A+=3){const M=t[i[A+0]+d],P=t[i[A+1]+d],O=t[i[A+2]+d],z=Math.min(M.x,P.x,O.x),j=Math.max(M.x,P.x,O.x),q=Math.min(M.y,P.y,O.y),Q=Math.max(M.y,P.y,O.y);E.length=0,r.grid.query(new we(z,q),new we(j,Q),E);for(let oe=0;oe<E.length;oe++){const pe=E[oe];if(jv(b[y[3*pe+0]],b[y[3*pe+1]],b[y[3*pe+2]],M,P,O,g))return!0}}return!1}function fk(r,t,i,l){if(!r||!i)return!1;let h=r.vertices;if(!t.canonical.equals(l.canonical)||t.wrap!==l.wrap){if(i.vertices.length<r.vertices.length)return fk(i,l,r,t);const d=t.canonical,g=l.canonical,y=Math.pow(2,g.z-d.z);h=r.vertices.map(b=>new we(b.x*d.x*Kt*y-g.x*Kt,b.y*d.y*Kt*y-g.y*Kt))}return hk(i,h,r.indices,0,r.indices.length,0,0)}gx.VectorTileLayer=sk;class dk{constructor(t){this.size=t,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(t,i){const l=this.toIdx(t,i);return{min:this.minimums[l],max:this.maximums[l]}}isLeaf(t,i){return this.leaves[this.toIdx(t,i)]}toIdx(t,i){return i*this.size+t}}function pk(r,t,i,l){let h=0,d=Number.MAX_VALUE;for(let g=0;g<3;g++)if(Math.abs(l[g])<1e-15){if(i[g]<r[g]||i[g]>t[g])return null}else{const y=1/l[g];let b=(r[g]-i[g])*y,E=(t[g]-i[g])*y;if(b>E){const A=b;b=E,E=A}if(b>h&&(h=b),E<d&&(d=E),h>d)return null}return h}function mk(r,t,i,l,h,d,g,y,b,E,A){const M=l-r,P=h-t,O=d-i,z=g-r,j=y-t,q=b-i,Q=A[1]*q-A[2]*j,oe=A[2]*z-A[0]*q,pe=A[0]*j-A[1]*z,de=M*Q+P*oe+O*pe;if(Math.abs(de)<1e-15)return null;const Ce=1/de,Ee=E[0]-r,Le=E[1]-t,je=E[2]-i,Ze=(Ee*Q+Le*oe+je*pe)*Ce;if(Ze<0||Ze>1)return null;const it=Le*O-je*P,Ye=je*M-Ee*O,mt=Ee*P-Le*M,bt=(A[0]*it+A[1]*Ye+A[2]*mt)*Ce;return bt<0||Ze+bt>1?null:(z*it+j*Ye+q*mt)*Ce}function gk(r,t,i){return(r-t)/(i-t)}function _k(r,t,i,l,h,d,g,y,b){const E=1<<i,A=d-l,M=g-h,P=(r+1)/E*A+l,O=(t+0)/E*M+h,z=(t+1)/E*M+h;y[0]=(r+0)/E*A+l,y[1]=O,b[0]=P,b[1]=z}class xk{constructor(t){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(d){const g=Math.ceil(Math.log2(d.dim/8)),y=[];let b=Math.ceil(Math.pow(2,g));const E=1/b,A=(O,z,j,q,Q)=>{const oe=q?1:0,pe=(O+1)*j-oe,de=z*j,Ce=(z+1)*j-oe;Q[0]=O*j,Q[1]=de,Q[2]=pe,Q[3]=Ce};let M=new dk(b);const P=[];for(let O=0;O<b*b;O++){A(O%b,Math.floor(O/b),E,!1,P);const z=eu(P[0],P[1],d),j=eu(P[2],P[1],d),q=eu(P[2],P[3],d),Q=eu(P[0],P[3],d);M.minimums.push(Math.min(z,j,q,Q)),M.maximums.push(Math.max(z,j,q,Q)),M.leaves.push(1)}for(y.push(M),b/=2;b>=1;b/=2){const O=y[y.length-1];M=new dk(b);for(let z=0;z<b*b;z++){A(z%b,Math.floor(z/b),2,!0,P);const j=O.getElevation(P[0],P[1]),q=O.getElevation(P[2],P[1]),Q=O.getElevation(P[2],P[3]),oe=O.getElevation(P[0],P[3]),pe=O.isLeaf(P[0],P[1]),de=O.isLeaf(P[2],P[1]),Ce=O.isLeaf(P[2],P[3]),Ee=O.isLeaf(P[0],P[3]),Le=Math.min(j.min,q.min,Q.min,oe.min),je=Math.max(j.max,q.max,Q.max,oe.max),Ze=pe&&de&&Ce&&Ee;M.maximums.push(je),M.minimums.push(Le),M.leaves.push(je-Le<=5&&Ze?1:0)}y.push(M)}return y}(this.dem),l=i.length-1,h=i[l];this._addNode(h.minimums[0],h.maximums[0],h.leaves[0]),this._construct(i,0,0,l,0)}raycastRoot(t,i,l,h,d,g,y=1){return pk([t,i,-100],[l,h,this.maximums[0]*y],d,g)}raycast(t,i,l,h,d,g,y=1){if(!this.nodeCount)return null;const b=this.raycastRoot(t,i,l,h,d,g,y);if(b==null)return null;const E=[],A=[],M=[],P=[],O=[{idx:0,t:b,nodex:0,nodey:0,depth:0}];for(;O.length>0;){const{idx:z,t:j,nodex:q,nodey:Q,depth:oe}=O.pop();if(this.leaves[z]){_k(q,Q,oe,t,i,l,h,M,P);const de=1<<oe,Ce=(q+0)/de,Ee=(q+1)/de,Le=(Q+0)/de,je=(Q+1)/de,Ze=eu(Ce,Le,this.dem)*y,it=eu(Ee,Le,this.dem)*y,Ye=eu(Ee,je,this.dem)*y,mt=eu(Ce,je,this.dem)*y,bt=mk(M[0],M[1],Ze,P[0],M[1],it,P[0],P[1],Ye,d,g),ht=mk(P[0],P[1],Ye,M[0],P[1],mt,M[0],M[1],Ze,d,g),wt=Math.min(bt!==null?bt:Number.MAX_VALUE,ht!==null?ht:Number.MAX_VALUE);if(wt!==Number.MAX_VALUE)return wt;{const lt=o.N.scaleAndAdd([],d,g,j);if(yk(Ze,it,mt,Ye,gk(lt[0],M[0],P[0]),gk(lt[1],M[1],P[1]))>=lt[2])return j}continue}let pe=0;for(let de=0;de<this._siblingOffset.length;de++){_k((q<<1)+this._siblingOffset[de][0],(Q<<1)+this._siblingOffset[de][1],oe+1,t,i,l,h,M,P),M[2]=-100,P[2]=this.maximums[this.childOffsets[z]+de]*y;const Ce=pk(M,P,d,g);if(Ce!=null){const Ee=Ce;E[de]=Ee;let Le=!1;for(let je=0;je<pe&&!Le;je++)Ee>=E[A[je]]&&(A.splice(je,0,de),Le=!0);Le||(A[pe]=de),pe++}}for(let de=0;de<pe;de++){const Ce=A[de];O.push({idx:this.childOffsets[z]+Ce,t:E[Ce],nodex:(q<<1)+this._siblingOffset[Ce][0],nodey:(Q<<1)+this._siblingOffset[Ce][1],depth:oe+1})}}return null}_addNode(t,i,l){return this.minimums.push(t),this.maximums.push(i),this.leaves.push(l),this.childOffsets.push(0),this.nodeCount++}_construct(t,i,l,h,d){if(t[h].isLeaf(i,l)===1)return;this.childOffsets[d]||(this.childOffsets[d]=this.nodeCount);const g=h-1,y=t[g];let b=0,E=0;for(let A=0;A<this._siblingOffset.length;A++){const M=2*i+this._siblingOffset[A][0],P=2*l+this._siblingOffset[A][1],O=y.getElevation(M,P),z=y.isLeaf(M,P),j=this._addNode(O.min,O.max,z);z&&(b|=1<<A),E||(E=j)}for(let A=0;A<this._siblingOffset.length;A++)b&1<<A||this._construct(t,2*i+this._siblingOffset[A][0],2*l+this._siblingOffset[A][1],g,E+A)}}function yk(r,t,i,l,h,d){return Kr(Kr(r,i,d),Kr(t,l,d),h)}function eu(r,t,i){const l=i.dim,h=st(r*l-.5,0,l-1),d=st(t*l-.5,0,l-1),g=Math.floor(h),y=Math.floor(d),b=Math.min(g+1,l-1),E=Math.min(y+1,l-1);return yk(i.get(g,y),i.get(b,y),i.get(g,E),i.get(b,E),h-g,d-y)}const TN={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function EN(r,t,i){return(256*r*256+256*t+i)/10-1e4}function SN(r,t,i){return 256*r+t+i/256-32768}class vx{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(t,i,l,h=!1){if(this.uid=t,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(l&&l!=="mapbox"&&l!=="terrarium")return Tr(`"${l}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const d=this.dim=i.height-2,g=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.floatView=new Float32Array(i.data.buffer),this.borderReady=h,this._modifiedForSources={},!h){for(let b=0;b<d;b++)g[this._idx(-1,b)]=g[this._idx(0,b)],g[this._idx(d,b)]=g[this._idx(d-1,b)],g[this._idx(b,-1)]=g[this._idx(b,0)],g[this._idx(b,d)]=g[this._idx(b,d-1)];g[this._idx(-1,-1)]=g[this._idx(0,0)],g[this._idx(d,-1)]=g[this._idx(d-1,0)],g[this._idx(-1,d)]=g[this._idx(0,d-1)],g[this._idx(d,d)]=g[this._idx(d-1,d-1)]}const y=l==="terrarium"?SN:EN;for(let b=0;b<g.length;++b){const E=4*b;this.floatView[b]=y(this.pixels[E],this.pixels[E+1],this.pixels[E+2])}this._timestamp=_t.now()}_buildQuadTree(){this._tree=new xk(this)}get(t,i,l=!1){l&&(t=st(t,-1,this.dim),i=st(i,-1,this.dim));const h=this._idx(t,i);return this.floatView[h]}set(t,i,l){const h=this._idx(t,i),d=this.floatView[h];return this.floatView[h]=l,l-d}static getUnpackVector(t){return TN[t]}_idx(t,i){if(t<-1||t>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(t+1)}static pack(t,i){const l=[0,0,0,0],h=vx.getUnpackVector(i);let d=Math.floor((t+h[3])/h[2]);return l[2]=d%256,d=Math.floor(d/256),l[1]=d%256,d=Math.floor(d/256),l[0]=d,l}getPixels(){return new ek({width:this.stride,height:this.stride},this.pixels)}backfillBorder(t,i,l){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let h=i*this.dim,d=i*this.dim+this.dim,g=l*this.dim,y=l*this.dim+this.dim;switch(i){case-1:h=d-1;break;case 1:d=h+1}switch(l){case-1:g=y-1;break;case 1:y=g+1}const b=-i*this.dim,E=-l*this.dim;for(let A=g;A<y;A++)for(let M=h;M<d;M++){const P=4*this._idx(M,A),O=4*this._idx(M+b,A+E);this.pixels[P+0]=t.pixels[O+0],this.pixels[P+1]=t.pixels[O+1],this.pixels[P+2]=t.pixels[O+2],this.pixels[P+3]=t.pixels[O+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}rr(vx,"DEMData"),rr(xk,"DemMinMaxQuadTree",{omit:["dem"]});class sd{constructor(t,i,l){this._demTile=t,this._dem=this._demTile.dem,this._scale=i,this._offset=l}static create(t,i,l){const h=l||t.findDEMTileFor(i);if(!h||!h.dem)return;const d=h.dem,g=h.tileID,y=1<<i.canonical.z-g.canonical.z;return new sd(h,d.dim/Kt/y,[(i.canonical.x/y-g.canonical.x)*d.dim,(i.canonical.y/y-g.canonical.y)*d.dim])}tileCoordToPixel(t,i){const l=i*this._scale+this._offset[1],h=Math.floor(t*this._scale+this._offset[0]),d=Math.floor(l);return new we(h,d)}getElevationAt(t,i,l,h){const d=t*this._scale+this._offset[0],g=i*this._scale+this._offset[1],y=Math.floor(d),b=Math.floor(g),E=this._dem;return h=!!h,l?Kr(Kr(E.get(y,b,h),E.get(y,b+1,h),g-b),Kr(E.get(y+1,b,h),E.get(y+1,b+1,h),g-b),d-y):E.get(y,b,h)}getElevationAtPixel(t,i,l){return this._dem.get(t,i,!!l)}getMeterToDEM(t){return(1<<this._demTile.tileID.canonical.z)*Pr(1,t)*this._dem.stride}}const AN=_x.types,CN=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],kN=["fill-extrusion-flood-light-ground-radius"],MN=Math.pow(2,13),IN=Math.pow(2,15)-1,vk=new we(0,1),tu=2147483648;function tm(r,t,i,l,h,d,g,y){r.emplaceBack((t<<1)+g,(i<<1)+d,(Math.floor(l*MN)<<1)+h,Math.round(y))}function wx(r,t,i,l,h,d){r.emplaceBack(t.x,t.y,(i.x<<1)+l,(i.y<<1)+h,d)}function rm(r,t,i){r.emplaceBack(t.x,t.y,t.z,i[0]*16384,i[1]*16384,i[2]*16384)}class wk{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class bk{constructor(){this.centroidXY=new we(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new we(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new we(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new we(this.max.x-this.min.x,this.max.y-this.min.y)}}class Tk{constructor(){this.acc=new we(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(t,i){t.min.x===Number.MAX_VALUE&&(t.min.x=t.max.x=i.x,t.min.y=t.max.y=i.y)}appendEdge(t,i,l){this.accCount++,this.acc._add(i);let h=!!this.borders;i.x<t.min.x?(t.min.x=i.x,h=!0):i.x>t.max.x&&(t.max.x=i.x,h=!0),i.y<t.min.y?(t.min.y=i.y,h=!0):i.y>t.max.y&&(t.max.y=i.y,h=!0),((i.x===0||i.x===Kt)&&i.x===l.x)!=((i.y===0||i.y===Kt)&&i.y===l.y)&&this.processBorderOverlap(i,l),h&&this.checkBorderIntersection(i,l)}checkBorderIntersection(t,i){i.x<0!=t.x<0&&this.addBorderIntersection(0,Kr(i.y,t.y,(0-i.x)/(t.x-i.x))),i.x>Kt!=t.x>Kt&&this.addBorderIntersection(1,Kr(i.y,t.y,(Kt-i.x)/(t.x-i.x))),i.y<0!=t.y<0&&this.addBorderIntersection(2,Kr(i.x,t.x,(0-i.y)/(t.y-i.y))),i.y>Kt!=t.y>Kt&&this.addBorderIntersection(3,Kr(i.x,t.x,(Kt-i.y)/(t.y-i.y)))}addBorderIntersection(t,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const l=this.borders[t];i<l[0]&&(l[0]=i),i>l[1]&&(l[1]=i)}processBorderOverlap(t,i){if(t.x===i.x){if(t.y===i.y)return;const l=t.x===0?0:1;this.addBorderIntersection(l,i.y),this.addBorderIntersection(l,t.y)}else{const l=t.y===0?2:3;this.addBorderIntersection(l,i.x),this.addBorderIntersection(l,t.x)}}centroid(){return this.accCount===0?new we(0,0):new we(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((t,i)=>t+ +(i[0]!==Number.MAX_VALUE),0):0}}function Ek(r,t){const i=r.add(t)._unit(),l=st(r.x*i.x+r.y*i.y,-1,1);var h,d,g;return h=Math.acos(l),Math.min(4,Math.max(-4,Math.tan(h)))/4*IN*((d=r).x*(g=t).y-d.y*g.x<0?-1:1)}const PN=[r=>r.x<0,r=>r.x>Kt,r=>r.y<0,r=>r.y>Kt];function RN(r,t,i,l){const h=[4];if(l===0)return h;i._mult(l);const d=r.sub(i),g=t.sub(i),y=[r,t,d,g];for(let b=0;b<4;b++)for(const E of y)if(PN[b](E)){h.push(b);break}return h}class Sk{constructor(t){this.vertexArray=new F0,this.indexArray=new Oi,this.programConfigurations=new te(t.layers,t.zoom,i=>kN.includes(i)),this._segments=new ui,this.hiddenByLandmarkVertexArray=new j0,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new ui}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(t,i,l,h=!1){const d=t.length;if(d>2){let g=Math.max(0,this._segments.get().length-1);const y=this._segments._prepareSegment(4*d,this.vertexArray.length,2*this._segmentToGroundQuads[g].length);let b;g!==this._segments.get().length-1&&(g++,this._segmentToGroundQuads[g]=[],this._segmentToRegionTriCounts[g]=[0,0,0,0,0]);{const E=t[0],A=t[1];b=Ek(E.sub(t[d-1])._perp()._unit(),A.sub(E)._perp()._unit())}for(let E=0;E<d;E++){const A=E===d-1?0:E+1,M=t[E],P=t[A],O=t[A===d-1?0:A+1],z=P.sub(M)._perp()._unit(),j=Ek(z,O.sub(P)._perp()._unit()),q=b,Q=j;if(Tw(M,P,i)||h&&kk(M,i)&&kk(P,i)){b=j;continue}const oe=y.vertexLength;wx(this.vertexArray,M,P,1,1,q),wx(this.vertexArray,M,P,1,0,q),wx(this.vertexArray,M,P,0,1,Q),wx(this.vertexArray,M,P,0,0,Q),y.vertexLength+=4;const pe=RN(M,P,z,l);for(const de of pe)this._segmentToGroundQuads[g].push({id:oe,region:de}),this._segmentToRegionTriCounts[g][de]+=2,y.primitiveLength+=2;b=j}}}prepareBorderSegments(){if(!this.hasData())return;const t=this._segments.get(),i=t.length;for(let l=0;l<i;l++)this._segmentToGroundQuads[l].sort((h,d)=>h.region-d.region);for(let l=0;l<i;l++){const h=this._segmentToGroundQuads[l],d=t[l],g=this._segmentToRegionTriCounts[l];g.reduce((b,E)=>b+E,0);let y=0;for(let b=0;b<=4;b++){const E=g[b];if(E!==0){let A=this.regionSegments[b];A||(A=this.regionSegments[b]=new ui);const M={vertexOffset:d.vertexOffset,primitiveOffset:d.primitiveOffset+y,vertexLength:d.vertexLength,primitiveLength:E};A.get().push(M)}y+=E}for(let b=0;b<h.length;b++){const E=h[b].id;this.indexArray.emplaceBack(E,E+1,E+3),this.indexArray.emplaceBack(E,E+3,E+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(t,i,l,h,d,g){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,t,i,l,h,d,g)}upload(t){this.hasData()&&(this.vertexBuffer=t.createVertexBuffer(this.vertexArray,uN.members),this.indexBuffer=t.createIndexBuffer(this.indexArray))}uploadPaintProperties(t){this.hasData()&&this.programConfigurations.upload(t)}update(t,i,l,h,d,g){this.hasData()&&this.programConfigurations.updatePaintArrays(t,i,l,h,d,g)}updateHiddenByLandmark(t){if(!this.hasData())return;const i=t.groundVertexCount+t.groundVertexArrayOffset;if(t.groundVertexCount===0)return;const l=t.flags&tu?1:0;for(let h=t.groundVertexArrayOffset;h<i;++h)this.hiddenByLandmarkVertexArray.emplace(h,l);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(t){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=t.createVertexBuffer(this.hiddenByLandmarkVertexArray,fN.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let t=0;t<=4;t++){const i=this.regionSegments[t];i&&i.destroy()}}}}class bx{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=t.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=t.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Oi,this.footprintVertices=new Is,this.footprintSegments=[],this.layoutVertexArray=new Ao,this.centroidVertexArray=new Ch,this.indexArray=new Oi,this.programConfigurations=new te(t.layers,t.zoom,i=>CN.includes(i)),this.segments=new ui,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.groundEffect=new Sk(t),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}populate(t,i,l,h){this.features=[],this.hasPattern=yw("fill-extrusion",this.layers,i),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=Zr(l),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:d,id:g,index:y,sourceLayerIndex:b}of t){const E=this.layers[0]._featureFilter.needGeometry,A=Ai(d,E);if(!this.layers[0]._featureFilter.filter(new ri(this.zoom),A,l))continue;const M={id:g,sourceLayerIndex:b,index:y,geometry:E?A.geometry:zi(d,l,h),properties:d.properties,type:d.type,patterns:{}},P=this.layoutVertexArray.length;this.hasPattern?this.features.push(vw("fill-extrusion",this.layers,M,this.zoom,i)):this.addFeature(M,M.geometry,y,l,{},i.availableImages,h,i.brightness),i.featureIndex.insert(d,M.geometry,y,b,this.index,P)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(t,i,l,h,d,g){for(const y of this.features){const{geometry:b}=y;this.addFeature(y,b,y.index,i,l,h,d,g)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(t,i,l,h,d){const g=Object.keys(t).length!==0;if(g&&!this.stateDependentLayers.length)return;const y=g?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(t,i,y,l,h,d),this.groundEffect.update(t,i,y,l,h,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,pN),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=t.createVertexBuffer(this.layoutVertexExtArray,dN.members,!0)),this.groundEffect.upload(t)),this.groundEffect.uploadPaintProperties(t),this.programConfigurations.upload(t),this.uploaded=!0}uploadCentroid(t){this.groundEffect.uploadHiddenByLandmark(t),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,hN.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,i,l,h,d,g,y,b){const E=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(t,{})/this.tileToMeter,A=[new we(0,0),new we(Kt,Kt)],M=y.projection,P=M.name==="globe",O=AN[t.type]==="Polygon",z=new Tk;z.centroidDataIndex=this.centroidData.length;const j=new bk,q=this.layers[0].paint.get("fill-extrusion-base").evaluate(t,{},h)<=0,Q=this.layers[0].paint.get("fill-extrusion-height").evaluate(t,{},h);j.height=Q,j.vertexArrayOffset=this.layoutVertexArray.length,j.groundVertexArrayOffset=this.groundEffect.vertexArray.length,P&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Xf);const oe=xw(i,500);for(let je=oe.length-1;je>=0;je--){const Ze=oe[je];(Ze.length===0||(pe=Ze[0]).every(it=>it.x<=0)||pe.every(it=>it.x>=Kt)||pe.every(it=>it.y<=0)||pe.every(it=>it.y>=Kt))&&oe.splice(je,1)}var pe;let de;if(P)de=Rk(oe,A,h);else{de=[];for(const je of oe)de.push({polygon:je,bounds:A})}const Ce=O?this.edgeRadius:0,Ee=Ce>0&&this.zoom<17,Le=(je,Ze)=>{if(je.length===0)return!1;const it=je[je.length-1];return Ze.x===it.x&&Ze.y===it.y};for(const{polygon:je,bounds:Ze}of de){let it=0,Ye=0;for(const wt of je)O&&!wt[0].equals(wt[wt.length-1])&&wt.push(wt[0]),Ye+=O?wt.length-1:wt.length;const mt=this.segments.prepareSegment((O?5:4)*Ye,this.layoutVertexArray,this.indexArray);j.footprintSegIdx<0&&(j.footprintSegIdx=this.footprintSegments.length),j.polygonSegIdx<0&&(j.polygonSegIdx=this.polygonSegments.length);const bt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},ht=new wk;if(ht.vertexOffset=this.footprintVertices.length,ht.indexOffset=3*this.footprintIndices.length,ht.ringIndices=[],O){const wt=[],lt=[];it=mt.vertexLength;for(let Gt=0;Gt<je.length;Gt++){const Tt=je[Gt];Tt.length&&Gt!==0&&lt.push(wt.length/2);const ar=[];let Qt,It;Qt=Tt[1].sub(Tt[0])._perp()._unit(),ht.ringIndices.push(Tt.length-1);for(let vr=1;vr<Tt.length;vr++){const hr=Tt[vr],ir=Tt[vr===Tt.length-1?1:vr+1],Pt=hr.clone();if(Ce){It=ir.sub(hr)._perp()._unit();const gr=Qt.add(It)._unit(),Vr=Ce*Math.min(4,1/(Qt.x*gr.x+Qt.y*gr.y));Pt.x+=Vr*gr.x,Pt.y+=Vr*gr.y,Pt.x=Math.round(Pt.x),Pt.y=Math.round(Pt.y),Qt=It}!q||Ce!==0&&!Ee||Le(ar,Pt)||ar.push(Pt),tm(this.layoutVertexArray,Pt.x,Pt.y,0,0,1,1,0),mt.vertexLength++,this.footprintVertices.emplaceBack(hr.x,hr.y),wt.push(hr.x,hr.y),P&&rm(this.layoutVertexExtArray,M.projectTilePoint(Pt.x,Pt.y,h),M.upVector(h,Pt.x,Pt.y))}q&&(Ce===0||Ee)&&(ar.length!==0&&Le(ar,ar[0])&&ar.pop(),this.groundEffect.addData(ar,Ze,E))}const vt=mx(wt,lt);for(let Gt=0;Gt<vt.length;Gt+=3)this.footprintIndices.emplaceBack(ht.vertexOffset+vt[Gt+0],ht.vertexOffset+vt[Gt+1],ht.vertexOffset+vt[Gt+2]),this.indexArray.emplaceBack(it+vt[Gt],it+vt[Gt+2],it+vt[Gt+1]),mt.primitiveLength++;ht.indexCount+=vt.length,ht.vertexCount+=this.footprintVertices.length-ht.vertexOffset}for(let wt=0;wt<je.length;wt++){const lt=je[wt];z.startRing(j,lt[0]);let vt=lt.length>4&&Mk(lt[lt.length-2],lt[0],lt[1]),Gt=Ce?DN(lt[lt.length-2],lt[0],lt[1],Ce):0;const Tt=[];let ar,Qt,It;Qt=lt[1].sub(lt[0])._perp()._unit();let vr=!0;for(let hr=1,ir=0;hr<lt.length;hr++){let Pt=lt[hr-1],gr=lt[hr];const Vr=lt[hr===lt.length-1?1:hr+1];if(z.appendEdge(j,gr,Pt),Tw(gr,Pt,Ze)){Ce&&(Qt=Vr.sub(gr)._perp()._unit(),vr=!vr);continue}const wr=gr.sub(Pt)._perp(),$r=wr.x/(Math.abs(wr.x)+Math.abs(wr.y)),kr=wr.y>0?1:0,Jr=Pt.dist(gr);if(ir+Jr>32768&&(ir=0),Ce){It=Vr.sub(gr)._perp()._unit();let pn=Ck(Pt,gr,Vr,Ak(Qt,It),Ce);isNaN(pn)&&(pn=0);const xn=gr.sub(Pt)._unit();Pt=Pt.add(xn.mult(Gt))._round(),gr=gr.add(xn.mult(-pn))._round(),Gt=pn,Qt=It,q&&this.zoom>=17&&(Le(Tt,Pt)||Tt.push(Pt),Le(Tt,gr)||Tt.push(gr))}const Rr=mt.vertexLength,Rn=lt.length>4&&Mk(Pt,gr,Vr);let hn=Ik(ir,vt,vr);if(tm(this.layoutVertexArray,Pt.x,Pt.y,$r,kr,0,0,hn),tm(this.layoutVertexArray,Pt.x,Pt.y,$r,kr,0,1,hn),ir+=Jr,hn=Ik(ir,Rn,!vr),vt=Rn,tm(this.layoutVertexArray,gr.x,gr.y,$r,kr,0,0,hn),tm(this.layoutVertexArray,gr.x,gr.y,$r,kr,0,1,hn),mt.vertexLength+=4,this.indexArray.emplaceBack(Rr+0,Rr+1,Rr+2),this.indexArray.emplaceBack(Rr+1,Rr+3,Rr+2),mt.primitiveLength+=2,Ce){const pn=it+(hr===1?lt.length-2:hr-2),xn=hr===1?it:pn+1;if(this.indexArray.emplaceBack(Rr+1,pn,Rr+3),this.indexArray.emplaceBack(pn,xn,Rr+3),mt.primitiveLength+=2,ar===void 0&&(ar=Rr),!Tw(Vr,lt[hr],Ze)){const fn=hr===lt.length-1?ar:mt.vertexLength;this.indexArray.emplaceBack(Rr+2,Rr+3,fn),this.indexArray.emplaceBack(Rr+3,fn+1,fn),this.indexArray.emplaceBack(Rr+3,xn,fn+1),mt.primitiveLength+=3}vr=!vr}if(P){const pn=this.layoutVertexExtArray,xn=M.projectTilePoint(Pt.x,Pt.y,h),fn=M.projectTilePoint(gr.x,gr.y,h),Qn=M.upVector(h,Pt.x,Pt.y),Cn=M.upVector(h,gr.x,gr.y);rm(pn,xn,Qn),rm(pn,xn,Qn),rm(pn,fn,Cn),rm(pn,fn,Cn)}}O&&(it+=lt.length-1),q&&Ce&&this.zoom>=17&&(Tt.length!==0&&Le(Tt,Tt[0])&&Tt.pop(),this.groundEffect.addData(Tt,Ze,E,Ce>0))}this.footprintSegments.push(ht),bt.triangleCount=this.indexArray.length-bt.triangleArrayOffset,this.polygonSegments.push(bt),++j.footprintSegLen,++j.polygonSegLen}if(j.vertexCount=this.layoutVertexArray.length-j.vertexArrayOffset,j.groundVertexCount=this.groundEffect.vertexArray.length-j.groundVertexArrayOffset,j.vertexCount!==0){if(j.centroidXY=z.borders?vk:this.encodeCentroid(z,j),this.centroidData.push(j),z.borders){this.featuresOnBorder.push(z);const je=this.featuresOnBorder.length-1;for(let Ze=0;Ze<z.borders.length;Ze++)z.borders[Ze][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Ze].push(je)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,d,g,h,b),this.groundEffect.addPaintPropertiesData(t,l,d,g,h,b),this.maxHeight=Math.max(this.maxHeight,Q)}}sortBorders(){for(let t=0;t<this.borderFeatureIndices.length;t++)this.borderFeatureIndices[t].sort((i,l)=>this.featuresOnBorder[i].borders[t][0]-this.featuresOnBorder[l].borders[t][0])}splitToSubtiles(){const t=[];for(let y=0;y<this.centroidData.length;y++){const b=this.centroidData[y],E=+(b.min.y+b.max.y>Kt),A=2*E+(+(b.min.x+b.max.x>Kt)^E);for(let M=0;M<b.polygonSegLen;M++){const P=b.polygonSegIdx+M;t.push({centroidIdx:y,subtile:A,polygonSegmentIdx:P,triangleSegmentIdx:this.polygonSegments[P].triangleSegIdx})}}const i=new Oi;t.sort((y,b)=>y.triangleSegmentIdx===b.triangleSegmentIdx?y.subtile-b.subtile:y.triangleSegmentIdx-b.triangleSegmentIdx);let l=0,h=0,d=0;for(const y of t){if(y.triangleSegmentIdx!==l)break;d++}const g=t.length;for(;h!==t.length;){l=t[h].triangleSegmentIdx;let y=0,b=h,E=h;for(let A=b;A<d&&t[A].subtile===y;A++)E++;for(;b!==d;){const A=t[b];y=A.subtile;const M=this.centroidData[A.centroidIdx].min.clone(),P=this.centroidData[A.centroidIdx].max.clone(),O={vertexOffset:this.segments.segments[l].vertexOffset,primitiveOffset:i.length,vertexLength:this.segments.segments[l].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let z=b;z<E;z++){const j=t[z],q=this.polygonSegments[j.polygonSegmentIdx],Q=this.centroidData[j.centroidIdx].min,oe=this.centroidData[j.centroidIdx].max,pe=this.indexArray.uint16;for(let de=q.triangleArrayOffset;de<q.triangleArrayOffset+q.triangleCount;de++)i.emplaceBack(pe[3*de],pe[3*de+1],pe[3*de+2]);O.primitiveLength+=q.triangleCount,M.x=Math.min(M.x,Q.x),M.y=Math.min(M.y,Q.y),P.x=Math.max(P.x,oe.x),P.y=Math.max(P.y,oe.y)}O.primitiveLength>0&&this.triangleSubSegments.push({segment:O,min:M,max:P}),b=E;for(let z=b;z<d&&t[z].subtile===t[b].subtile;z++)E++}h=d;for(let A=h;A<g&&t[A].triangleSegmentIdx===t[h].triangleSegmentIdx;A++)d++}i._trim(),this.indexArray=i}getVisibleSegments(t,i,l){let h=0,d=0;const g=1<<t.canonical.z;if(i){const j=i.getMinMaxForTile(t);j&&(h=j.min,d=j.max)}d+=this.maxHeight;const y=t.toUnwrapped();let b;const E=[y.canonical.x/g+y.wrap,y.canonical.y/g],A=[(y.canonical.x+1)/g+y.wrap,(y.canonical.y+1)/g],M=new ui,P=(j,q,Q)=>[j[0]*(1-Q[0])+q[0]*Q[0],j[1]*(1-Q[1])+q[1]*Q[1]],O=[],z=[];for(const j of this.triangleSubSegments){O[0]=j.min.x/Kt,O[1]=j.min.y/Kt,z[0]=j.max.x/Kt,z[1]=j.max.y/Kt;const q=P(E,A,O),Q=P(E,A,z);if(new li([q[0],q[1],h],[Q[0],Q[1],d]).intersectsPrecise(l)===0){b&&(M.segments.push(b),b=void 0);continue}const oe=j.segment;b&&b.vertexOffset!==oe.vertexOffset&&(M.segments.push(b),b=void 0),b?(b.vertexLength+=oe.vertexLength,b.primitiveLength+=oe.primitiveLength):b={vertexOffset:oe.vertexOffset,primitiveLength:oe.primitiveLength,vertexLength:oe.vertexLength,primitiveOffset:oe.primitiveOffset,sortKey:void 0,vaos:{}}}return b&&M.segments.push(b),M}encodeCentroid(t,i){const l=t.centroid(),h=i.span(),d=Math.min(7,Math.round(h.x*this.tileToMeter/10)),g=Math.min(7,Math.round(h.y*this.tileToMeter/10));return new we(st(l.x,1,Kt-1)<<3|d,st(l.y,1,Kt-1)<<3|g)}encodeBorderCentroid(t){if(!t.borders)return new we(0,0);const i=t.borders,l=Number.MAX_VALUE;if(i[0][0]!==l||i[1][0]!==l){const h=i[0][0]!==l?0:1;return new we(6|(i[0][0]!==l?0:65528),(i[h][0]+i[h][1])/2<<3|6)}{const h=i[2][0]!==l?2:3;return new we((i[h][0]+i[h][1])/2<<3|6,6|(i[2][0]!==l?0:65528))}}showCentroid(t){const i=this.centroidData[t.centroidDataIndex];i.flags&=tu,i.centroidXY.x=0,i.centroidXY.y=0,this.writeCentroidToBuffer(i)}writeCentroidToBuffer(t){this.groundEffect.updateHiddenByLandmark(t);const i=t.vertexArrayOffset,l=t.vertexCount+t.vertexArrayOffset,h=t.flags&tu?vk:t.centroidXY,d=this.centroidVertexArray.geta_centroid_pos0(i);if(this.centroidVertexArray.geta_centroid_pos1(i)!==h.y||d!==h.x){for(let g=i;g<l;++g)this.centroidVertexArray.emplace(g,h.x,h.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const t of this.centroidData)this.writeCentroidToBuffer(t)}updateReplacement(t,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const l=i.getReplacementRegionsForTile(t.toUnwrapped());if(function(d,g){if(d.length!==g.length)return!1;for(let y=0;y<d.length;y++)if(d[y].sourceId!==g[y].sourceId||!lk(d[y],g[y]))return!1;return!0}(this.activeReplacements,l))return;if(this.activeReplacements=l,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const d of this.centroidData)d.flags&=2147483647;const h=[];for(const d of this.activeReplacements){const g=Math.pow(2,d.footprintTileId.canonical.z-t.canonical.z);for(const y of this.centroidData)if(!(y.flags&tu||d.min.x>y.max.x||y.min.x>d.max.x||d.min.y>y.max.y||y.min.y>d.max.y))for(let b=0;b<y.footprintSegLen;b++){const E=this.footprintSegments[y.footprintSegIdx+b];if(h.length=0,FN(this.footprintVertices,E.vertexOffset,E.vertexCount,d.footprintTileId.canonical,t.canonical,h),hk(d.footprint,h,this.footprintIndices.uint16,E.indexOffset,E.indexCount,-E.vertexOffset,-g)){y.flags|=tu;break}}}for(const d of this.centroidData)this.writeCentroidToBuffer(d);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(t,i,l){let h=!1;for(let d=0;d<l.footprintSegLen;d++){const g=this.footprintSegments[l.footprintSegIdx+d];let y=0;for(const b of g.ringIndices){for(let E=y,A=b+y-1;E<b+y;A=E++){const M=this.footprintVertices.int16[2*(E+g.vertexOffset)+0],P=this.footprintVertices.int16[2*(E+g.vertexOffset)+1],O=this.footprintVertices.int16[2*(A+g.vertexOffset)+1];P>i!=O>i&&t<(this.footprintVertices.int16[2*(A+g.vertexOffset)+0]-M)*(i-P)/(O-P)+M&&(h=!h)}y=b}}return h}getHeightAtTileCoord(t,i){let l=Number.NEGATIVE_INFINITY,h=!0;const d=4*(t+Kt)*Kt+(i+Kt);if(this.partLookup.hasOwnProperty(d)){const g=this.partLookup[d];return g?{height:g.height,hidden:!!(g.flags&tu)}:void 0}for(const g of this.centroidData)t>g.max.x||g.min.x>t||i>g.max.y||g.min.y>i||this.footprintContainsPoint(t,i,g)&&g&&g.height>l&&(l=g.height,this.partLookup[d]=g,h=!!(g.flags&tu));if(l!==Number.NEGATIVE_INFINITY)return{height:l,hidden:h};this.partLookup[d]=void 0}}function Ak(r,t){const i=r.add(t)._unit();return r.x*i.x+r.y*i.y}function DN(r,t,i,l){const h=t.sub(r)._perp()._unit(),d=i.sub(t)._perp()._unit();return Ck(r,t,i,Ak(h,d),l)}function Ck(r,t,i,l,h){const d=Math.sqrt(1-l*l);return Math.min(r.dist(t)/3,t.dist(i)/3,h*d/l)}function Tw(r,t,i){return r.x<i[0].x&&t.x<i[0].x||r.x>i[1].x&&t.x>i[1].x||r.y<i[0].y&&t.y<i[0].y||r.y>i[1].y&&t.y>i[1].y}function kk(r,t){return r.x<t[0].x||r.x>t[1].x||r.y<t[0].y||r.y>t[1].y}function Mk(r,t,i){if(r.x<0||r.x>=Kt||t.x<0||t.x>=Kt||i.x<0||i.x>=Kt)return!1;const l=i.sub(t),h=l.perp(),d=r.sub(t);return(l.x*d.x+l.y*d.y)/Math.sqrt((l.x*l.x+l.y*l.y)*(d.x*d.x+d.y*d.y))>-.866&&h.x*d.x+h.y*d.y<0}function Ik(r,t,i){const l=t?2|r:-3&r;return i?1|l:-2&l}function Pk(){const r=Math.PI/32,t=Math.tan(r),i=ct;return i*Math.sqrt(1+2*t*t)-i}function Rk(r,t,i){const l=1<<i.z,h=Mr(i.x/l),d=Mr((i.x+1)/l),g=en(i.y/l),y=en((i.y+1)/l);return function(b,E,A,M,P=0,O){const z=[];if(!b.length||!A||!M)return z;const j=(Ee,Le)=>{for(const je of Ee)z.push({polygon:je,bounds:Le})},q=Math.ceil(Math.log2(A)),Q=Math.ceil(Math.log2(M)),oe=q-Q,pe=[];for(let Ee=0;Ee<Math.abs(oe);Ee++)pe.push(oe>0?0:1);for(let Ee=0;Ee<Math.min(q,Q);Ee++)pe.push(0),pe.push(1);let de=b;if(de=xx(de,E[0].y-P,E[1].y+P,1),de=xx(de,E[0].x-P,E[1].x+P,0),!de.length)return z;const Ce=[];for(pe.length?Ce.push({polygons:de,bounds:E,depth:0}):j(de,E);Ce.length;){const Ee=Ce.pop(),Le=Ee.depth,je=pe[Le],Ze=Ee.bounds[0],it=Ee.bounds[1],Ye=je===0?Ze.x:Ze.y,mt=je===0?it.x:it.y,bt=O?O(je,Ye,mt):.5*(Ye+mt),ht=xx(Ee.polygons,Ye-P,bt+P,je),wt=xx(Ee.polygons,bt-P,mt+P,je);if(ht.length){const lt=[Ze,new we(je===0?bt:it.x,je===1?bt:it.y)];pe.length>Le+1?Ce.push({polygons:ht,bounds:lt,depth:Le+1}):j(ht,lt)}if(wt.length){const lt=[new we(je===0?bt:Ze.x,je===1?bt:Ze.y),it];pe.length>Le+1?Ce.push({polygons:wt,bounds:lt,depth:Le+1}):j(wt,lt)}}return z}(r,t,Math.ceil((d-h)/11.25),Math.ceil((g-y)/11.25),1,(b,E,A)=>{if(b===0)return .5*(E+A);{const M=en((i.y+E/Kt)/l);return(Sr(.5*(en((i.y+A/Kt)/l)+M))*l-i.y)*Kt}})}function FN(r,t,i,l,h,d){const g=Math.pow(2,l.z-h.z);for(let y=0;y<i;y++){let b=r.int16[2*(y+t)+0],E=r.int16[2*(y+t)+1];b=(b+h.x*Kt)*g-l.x*Kt,E=(E+h.y*Kt)*g-l.y*Kt,d.push(new we(b,E))}}rr(bx,"FillExtrusionBucket",{omit:["layers","features"]}),rr(bk,"PartData"),rr(wk,"FootprintSegment"),rr(Tk,"BorderCentroidData"),rr(Sk,"GroundEffect");const LN=new ni({visibility:new jt(tt["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new jt(tt["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var ON={paint:new ni({"fill-extrusion-opacity":new jt(tt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new mr(tt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new jt(tt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new jt(tt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new mr(tt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new mr(tt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new mr(tt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new jt(tt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new jt(tt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new jt(tt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new jt(tt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new jt(tt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new jt(tt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new jt(tt["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new jt(tt["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new mr(tt["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new mr(tt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new jt(tt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new jt(tt["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new jt(tt["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new jt(tt["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new jt(tt["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:LN};class od extends we{constructor(t,i,l){super(t,i),this.z=l}}function nm(r,t){return r.x*t.x+r.y*t.y}function Dk(r,t){if(r.length===1){let i=0;const l=t[i++];let h;for(;!h||l.equals(h);)if(h=t[i++],!h)return 1/0;for(;i<t.length;i++){const d=t[i],g=r[0],y=h.sub(l),b=d.sub(l),E=g.sub(l),A=nm(y,y),M=nm(y,b),P=nm(b,b),O=nm(E,y),z=nm(E,b),j=A*P-M*M,q=(P*O-M*z)/j,Q=(A*z-M*O)/j,oe=l.z*(1-q-Q)+h.z*q+d.z*Q;if(isFinite(oe))return oe}return 1/0}{let i=1/0;for(const l of t)i=Math.min(i,l.z);return i}}function Fk(r,t,i,l,h,d,g,y){const b=g*h.getElevationAt(r,t,!0,!0),E=d[0]!==0,A=E?d[1]===0?g*(d[0]/7-450):g*function(M,P,O){const z=Math.floor(P[0]/8),j=Math.floor(P[1]/8),q=10*(P[0]-8*z),Q=10*(P[1]-8*j),oe=M.getElevationAt(z,j,!0,!0),pe=M.getMeterToDEM(O),de=Math.floor(.5*(q*pe-1)),Ce=Math.floor(.5*(Q*pe-1)),Ee=M.tileCoordToPixel(z,j),Le=2*de+1,je=2*Ce+1,Ze=function(wt,lt,vt,Gt,Tt){return[wt.getElevationAtPixel(lt,vt,!0),wt.getElevationAtPixel(lt+Tt,vt,!0),wt.getElevationAtPixel(lt,vt+Tt,!0),wt.getElevationAtPixel(lt+Gt,vt+Tt,!0)]}(M,Ee.x-de,Ee.y-Ce,Le,je),it=Math.abs(Ze[0]-Ze[1]),Ye=Math.abs(Ze[2]-Ze[3]),mt=Math.abs(Ze[0]-Ze[2])+Math.abs(Ze[1]-Ze[3]),bt=Math.min(.25,.5*pe*(it+Ye)/Le),ht=Math.min(.25,.5*pe*mt/je);return oe+Math.max(bt*q,ht*Q)}(h,d,y):b;return{base:b+(i===0)?-1:i,top:E?Math.max(A+l,b+i+2):b+l}}const NN=bn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:zN}=NN,BN=bn([{name:"a_packed",components:4,type:"Float32"}]),{members:UN}=BN;class Lk{constructor(t,i){this.width=t,this.height=i,this.nextRow=0,this.image=new Qc({width:t,height:i}),this.positions={},this.uploaded=!1}getDash(t,i){const l=this.getKey(t,i);return this.positions[l]}trim(){const t=this.width,i=this.height=yt(this.nextRow);this.image.resize({width:t,height:i})}getKey(t,i){return t.join(",")+i}getDashRanges(t,i,l){const h=[];let d=t.length%2==1?-t[t.length-1]*l:0,g=t[0]*l,y=!0;h.push({left:d,right:g,isDash:y,zeroLength:t[0]===0});let b=t[0];for(let E=1;E<t.length;E++){y=!y;const A=t[E];d=b*l,b+=A,g=b*l,h.push({left:d,right:g,isDash:y,zeroLength:A===0})}return h}addRoundDash(t,i,l){const h=i/2;for(let d=-l;d<=l;d++){const g=this.width*(this.nextRow+l+d);let y=0,b=t[y];for(let E=0;E<this.width;E++){E/b.right>1&&(b=t[++y]);const A=Math.abs(E-b.left),M=Math.abs(E-b.right),P=Math.min(A,M);let O;const z=d/l*(h+1);if(b.isDash){const j=h-Math.abs(z);O=Math.sqrt(P*P+j*j)}else O=h-Math.sqrt(P*P+z*z);this.image.data[g+E]=Math.max(0,Math.min(255,O+128))}}}addRegularDash(t,i){for(let b=t.length-1;b>=0;--b){const E=t[b],A=t[b+1];E.zeroLength?t.splice(b,1):A&&A.isDash===E.isDash&&(A.left=E.left,t.splice(b,1))}const l=t[0],h=t[t.length-1];l.isDash===h.isDash&&(l.left=h.left-this.width,h.right=l.right+this.width);const d=this.width*this.nextRow;let g=0,y=t[g];for(let b=0;b<this.width;b++){b/y.right>1&&(y=t[++g]);const E=Math.abs(b-y.left),A=Math.abs(b-y.right),M=Math.min(E,A);this.image.data[d+b]=Math.max(0,Math.min(255,(y.isDash?M:-M)+i+128))}}addDash(t,i){const l=this.getKey(t,i);if(this.positions[l])return this.positions[l];const h=i==="round",d=h?7:0,g=2*d+1;if(this.nextRow+g>this.height)return Tr("LineAtlas out of space"),null;t.length===0&&t.push(1);let y=0;for(let A=0;A<t.length;A++)t[A]<0&&(Tr("Negative value is found in line dasharray, replacing values with 0"),t[A]=0),y+=t[A];if(y!==0){const A=this.width/y,M=this.getDashRanges(t,this.width,A);h?this.addRoundDash(M,A,d):this.addRegularDash(M,i==="square"?.5*A:0)}const b=this.nextRow+d;this.nextRow+=g;const E={tl:[b,d],br:[y,0]};return this.positions[l]=E,E}}rr(Lk,"LineAtlas");const VN=_x.types,$N=Math.cos(Math.PI/180*37.5);class Ew{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=t.index,this.projection=t.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new L0,this.layoutVertexArray2=new dl,this.indexArray=new Oi,this.programConfigurations=new te(t.layers,t.zoom),this.segments=new ui,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(t,i,l,h){this.hasPattern=yw("line",this.layers,i);const d=this.layers[0].layout.get("line-sort-key"),g=[];for(const{feature:A,id:M,index:P,sourceLayerIndex:O}of t){const z=this.layers[0]._featureFilter.needGeometry,j=Ai(A,z);if(!this.layers[0]._featureFilter.filter(new ri(this.zoom),j,l))continue;const q=d?d.evaluate(j,{},l):void 0,Q={id:M,properties:A.properties,type:A.type,sourceLayerIndex:O,index:P,geometry:z?j.geometry:zi(A,l,h),patterns:{},sortKey:q};g.push(Q)}d&&g.sort((A,M)=>A.sortKey-M.sortKey);const{lineAtlas:y,featureIndex:b}=i,E=this.addConstantDashes(y);for(const A of g){const{geometry:M,index:P,sourceLayerIndex:O}=A;if(E&&this.addFeatureDashes(A,y),this.hasPattern){const z=vw("line",this.layers,A,this.zoom,i);this.patternFeatures.push(z)}else this.addFeature(A,M,P,l,y.positions,i.availableImages,i.brightness);b.insert(t[P].feature,M,P,O,this.index)}}addConstantDashes(t){let i=!1;for(const l of this.layers){const h=l.paint.get("line-dasharray").value,d=l.layout.get("line-cap").value;if(h.kind!=="constant"||d.kind!=="constant")i=!0;else{const g=d.value,y=h.value;if(!y)continue;t.addDash(y,g)}}return i}addFeatureDashes(t,i){const l=this.zoom;for(const h of this.layers){const d=h.paint.get("line-dasharray").value,g=h.layout.get("line-cap").value;if(d.kind==="constant"&&g.kind==="constant")continue;let y,b;if(d.kind==="constant"){if(y=d.value,!y)continue}else y=d.evaluate({zoom:l},t);b=g.kind==="constant"?g.value:g.evaluate({zoom:l},t),i.addDash(y,b),t.patterns[h.id]=i.getKey(y,b)}}update(t,i,l,h,d){const g=Object.keys(t).length!==0;g&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(t,i,g?this.stateDependentLayers:this.layers,l,h,d)}addFeatures(t,i,l,h,d,g){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,i,l,h,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,UN)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,zN),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,i,l,h,d,g,y){const b=this.layers[0].layout,E=b.get("line-join").evaluate(t,{}),A=b.get("line-cap").evaluate(t,{}),M=b.get("line-miter-limit"),P=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const O of i)this.addLine(O,t,E,A,M,P);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,d,g,h,y)}addLine(t,i,l,h,d,g){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Q=0;Q<t.length-1;Q++)this.totalDistance+=t[Q].dist(t[Q+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const y=VN[i.type]==="Polygon";let b=t.length;for(;b>=2&&t[b-1].equals(t[b-2]);)b--;let E=0;for(;E<b-1&&t[E].equals(t[E+1]);)E++;if(b<(y?3:2))return;l==="bevel"&&(d=1.05);const A=this.overscaling<=16?15*Kt/(512*this.overscaling):0,M=this.segments.prepareSegment(10*b,this.layoutVertexArray,this.indexArray);let P,O,z,j,q;this.e1=this.e2=-1,y&&(P=t[b-2],q=t[E].sub(P)._unit()._perp());for(let Q=E;Q<b;Q++){if(z=Q===b-1?y?t[E+1]:void 0:t[Q+1],z&&t[Q].equals(z))continue;q&&(j=q),P&&(O=P),P=t[Q],q=z?z.sub(P)._unit()._perp():j,j=j||q;let oe=j.add(q);oe.x===0&&oe.y===0||oe._unit();const pe=j.x*q.x+j.y*q.y,de=oe.x*q.x+oe.y*q.y,Ce=de!==0?1/de:1/0,Ee=2*Math.sqrt(2-2*de),Le=de<$N&&O&&z,je=j.x*q.y-j.y*q.x>0;if(Le&&Q>E){const Ye=P.dist(O);if(Ye>2*A){const mt=P.sub(P.sub(O)._mult(A/Ye)._round());this.updateDistance(O,mt),this.addCurrentVertex(mt,j,0,0,M),O=mt}}const Ze=O&&z;let it=Ze?l:y?"butt":h;if(Ze&&it==="round"&&(Ce<g?it="miter":Ce<=2&&(it="fakeround")),it==="miter"&&Ce>d&&(it="bevel"),it==="bevel"&&(Ce>2&&(it="flipbevel"),Ce<d&&(it="miter")),O&&this.updateDistance(O,P),it==="miter")oe._mult(Ce),this.addCurrentVertex(P,oe,0,0,M);else if(it==="flipbevel"){if(Ce>100)oe=q.mult(-1);else{const Ye=Ce*j.add(q).mag()/j.sub(q).mag();oe._perp()._mult(Ye*(je?-1:1))}this.addCurrentVertex(P,oe,0,0,M),this.addCurrentVertex(P,oe.mult(-1),0,0,M)}else if(it==="bevel"||it==="fakeround"){const Ye=-Math.sqrt(Ce*Ce-1),mt=je?Ye:0,bt=je?0:Ye;if(O&&this.addCurrentVertex(P,j,mt,bt,M),it==="fakeround"){const ht=Math.round(180*Ee/Math.PI/20);for(let wt=1;wt<ht;wt++){let lt=wt/ht;if(lt!==.5){const Gt=lt-.5;lt+=lt*Gt*(lt-1)*((1.0904+pe*(pe*(3.55645-1.43519*pe)-3.2452))*Gt*Gt+(.848013+pe*(.215638*pe-1.06021)))}const vt=q.sub(j)._mult(lt)._add(j)._unit()._mult(je?-1:1);this.addHalfVertex(P,vt.x,vt.y,!1,je,0,M)}}z&&this.addCurrentVertex(P,q,-mt,-bt,M)}else if(it==="butt")this.addCurrentVertex(P,oe,0,0,M);else if(it==="square"){const Ye=O?1:-1;O||this.addCurrentVertex(P,oe,Ye,Ye,M),this.addCurrentVertex(P,oe,0,0,M),O&&this.addCurrentVertex(P,oe,Ye,Ye,M)}else it==="round"&&(O&&(this.addCurrentVertex(P,j,0,0,M),this.addCurrentVertex(P,j,1,1,M,!0)),z&&(this.addCurrentVertex(P,q,-1,-1,M,!0),this.addCurrentVertex(P,q,0,0,M)));if(Le&&Q<b-1){const Ye=P.dist(z);if(Ye>2*A){const mt=P.add(z.sub(P)._mult(A/Ye)._round());this.updateDistance(P,mt),this.addCurrentVertex(mt,q,0,0,M),P=mt}}}}addCurrentVertex(t,i,l,h,d,g=!1){const y=i.y*h-i.x,b=-i.y-i.x*h;this.addHalfVertex(t,i.x+i.y*l,i.y-i.x*l,g,!1,l,d),this.addHalfVertex(t,y,b,g,!0,-h,d)}addHalfVertex({x:t,y:i},l,h,d,g,y,b){this.layoutVertexArray.emplaceBack((t<<1)+(d?1:0),(i<<1)+(g?1:0),Math.round(63*l)+128,Math.round(63*h)+128,1+(y===0?0:y<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const E=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,E),b.primitiveLength++),g?this.e2=E:this.e1=E}updateScaledDistance(){if(this.lineClips){const t=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=t*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(t,i){this.distance+=t.dist(i),this.updateScaledDistance()}}rr(Ew,"LineBucket",{omit:["layers","patternFeatures"]});const jN=new ni({"line-cap":new mr(tt.layout_line["line-cap"]),"line-join":new mr(tt.layout_line["line-join"]),"line-miter-limit":new jt(tt.layout_line["line-miter-limit"]),"line-round-limit":new jt(tt.layout_line["line-round-limit"]),"line-sort-key":new mr(tt.layout_line["line-sort-key"]),visibility:new jt(tt.layout_line.visibility)});var Ok={paint:new ni({"line-opacity":new mr(tt.paint_line["line-opacity"]),"line-color":new mr(tt.paint_line["line-color"]),"line-translate":new jt(tt.paint_line["line-translate"]),"line-translate-anchor":new jt(tt.paint_line["line-translate-anchor"]),"line-width":new mr(tt.paint_line["line-width"]),"line-gap-width":new mr(tt.paint_line["line-gap-width"]),"line-offset":new mr(tt.paint_line["line-offset"]),"line-blur":new mr(tt.paint_line["line-blur"]),"line-dasharray":new mr(tt.paint_line["line-dasharray"]),"line-pattern":new mr(tt.paint_line["line-pattern"]),"line-gradient":new Yl(tt.paint_line["line-gradient"]),"line-trim-offset":new jt(tt.paint_line["line-trim-offset"]),"line-emissive-strength":new jt(tt.paint_line["line-emissive-strength"]),"line-border-width":new mr(tt.paint_line["line-border-width"]),"line-border-color":new mr(tt.paint_line["line-border-color"])}),layout:jN};function Nk(r,t,i){return t*(Kt/(r.tileSize*Math.pow(2,i-r.tileID.overscaledZ)))}function zk(r,t){return 1/Nk(r,1,t.tileZoom)}function Bk(r,t,i,l){return r.translatePosMatrix(l||t.tileID.projMatrix,t,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const Uk=r=>{const t=[];Vk(r)&&t.push("RENDER_LINE_DASH"),r.paint.get("line-gradient")&&t.push("RENDER_LINE_GRADIENT");const i=r.paint.get("line-trim-offset");return i[0]===0&&i[1]===0||t.push("RENDER_LINE_TRIM_OFFSET"),r.paint.get("line-border-width").constantOr(1)!==0&&t.push("RENDER_LINE_BORDER"),t};function Vk(r){const t=r.paint.get("line-dasharray").value;return t.value||t.kind!=="constant"}const $k=new class extends mr{possiblyEvaluate(r,t){return t=new ri(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,transition:t.transition}),super.possiblyEvaluate(r,t)}evaluate(r,t,i,l){return t=Se({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(r,t,i,l)}}(Ok.paint.properties["line-width"].specification);function jk(r,t){return t>0?t+2*r:r}$k.useIntegerZoom=!0;const GN=bn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),HN=bn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),WN=bn([{name:"a_projected_pos",components:4,type:"Float32"}],4);bn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const qN=bn([{name:"a_z_offset",components:1,type:"Float32"}],4),ZN=bn([{name:"a_texb",components:2,type:"Uint16"}]),XN=bn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),YN=bn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);bn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Gk=bn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),KN=bn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);bn([{name:"triangle",components:3,type:"Uint16"}]),bn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),bn([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),bn([{type:"Float32",name:"offsetX"}]),bn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var aa=24;const Po=128;function Sw(r,t){const{expression:i}=t;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new ri(r+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:l,interpolationType:h}=i;let d=0;for(;d<l.length&&l[d]<=r;)d++;d=Math.max(0,d-1);let g=d;for(;g<l.length&&l[g]<r+1;)g++;g=Math.min(l.length-1,g);const y=l[d],b=l[g];return i.kind==="composite"?{kind:"composite",minZoom:y,maxZoom:b,interpolationType:h}:{kind:"camera",minZoom:y,maxZoom:b,minSize:i.evaluate(new ri(y)),maxSize:i.evaluate(new ri(b)),interpolationType:h}}}function Tx(r,{uSize:t,uSizeT:i},{lowerSize:l,upperSize:h}){return r.kind==="source"?l/Po:r.kind==="composite"?Kr(l/Po,h/Po,i):t}function ld(r,t){let i=0,l=0;if(r.kind==="constant")l=r.layoutSize;else if(r.kind!=="source"){const{interpolationType:h,minZoom:d,maxZoom:g}=r,y=h?st(Xa.interpolationFactor(h,t,d,g),0,1):0;r.kind==="camera"?l=Kr(r.minSize,r.maxSize,y):i=y}return{uSizeT:i,uSize:l}}var JN=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Po,evaluateSizeForFeature:Tx,evaluateSizeForZoom:ld,getSizeData:Sw});function QN(r,t,i){return r.sections.forEach(l=>{l.text=function(h,d,g){const y=d.layout.get("text-transform").evaluate(g,{});return y==="uppercase"?h=h.toLocaleUpperCase():y==="lowercase"&&(h=h.toLocaleLowerCase()),Ya.applyArabicShaping&&(h=Ya.applyArabicShaping(h)),h}(l.text,t,i)}),r}const im={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function e6(r){return r==="︶"||r==="﹈"||r==="︸"||r==="﹄"||r==="﹂"||r==="︾"||r==="︼"||r==="︺"||r==="︘"||r==="﹀"||r==="︐"||r==="︓"||r==="︔"||r==="｀"||r==="￣"||r==="︑"||r==="︒"}function t6(r){return r==="︵"||r==="﹇"||r==="︷"||r==="﹃"||r==="﹁"||r==="︽"||r==="︻"||r==="︹"||r==="︗"||r==="︿"}var r6={read:function(r,t,i,l,h){var d,g,y=8*h-l-1,b=(1<<y)-1,E=b>>1,A=-7,M=i?h-1:0,P=i?-1:1,O=r[t+M];for(M+=P,d=O&(1<<-A)-1,O>>=-A,A+=y;A>0;d=256*d+r[t+M],M+=P,A-=8);for(g=d&(1<<-A)-1,d>>=-A,A+=l;A>0;g=256*g+r[t+M],M+=P,A-=8);if(d===0)d=1-E;else{if(d===b)return g?NaN:1/0*(O?-1:1);g+=Math.pow(2,l),d-=E}return(O?-1:1)*g*Math.pow(2,d-l)},write:function(r,t,i,l,h,d){var g,y,b,E=8*d-h-1,A=(1<<E)-1,M=A>>1,P=h===23?Math.pow(2,-24)-Math.pow(2,-77):0,O=l?0:d-1,z=l?1:-1,j=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(y=isNaN(t)?1:0,g=A):(g=Math.floor(Math.log(t)/Math.LN2),t*(b=Math.pow(2,-g))<1&&(g--,b*=2),(t+=g+M>=1?P/b:P*Math.pow(2,1-M))*b>=2&&(g++,b/=2),g+M>=A?(y=0,g=A):g+M>=1?(y=(t*b-1)*Math.pow(2,h),g+=M):(y=t*Math.pow(2,M-1)*Math.pow(2,h),g=0));h>=8;r[i+O]=255&y,O+=z,y/=256,h-=8);for(g=g<<h|y,E+=h;E>0;r[i+O]=255&g,O+=z,g/=256,E-=8);r[i+O-z]|=128*j}},Hk=Jn,Ex=r6;function Jn(r){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(r)?r:new Uint8Array(r||0),this.pos=0,this.type=0,this.length=this.buf.length}Jn.Varint=0,Jn.Fixed64=1,Jn.Bytes=2,Jn.Fixed32=5;var Aw=4294967296,Wk=1/Aw,qk=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function ic(r){return r.type===Jn.Bytes?r.readVarint()+r.pos:r.pos+1}function cd(r,t,i){return i?4294967296*t+(r>>>0):4294967296*(t>>>0)+(r>>>0)}function Zk(r,t,i){var l=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));i.realloc(l);for(var h=i.pos-1;h>=r;h--)i.buf[h+l]=i.buf[h]}function n6(r,t){for(var i=0;i<r.length;i++)t.writeVarint(r[i])}function i6(r,t){for(var i=0;i<r.length;i++)t.writeSVarint(r[i])}function a6(r,t){for(var i=0;i<r.length;i++)t.writeFloat(r[i])}function s6(r,t){for(var i=0;i<r.length;i++)t.writeDouble(r[i])}function o6(r,t){for(var i=0;i<r.length;i++)t.writeBoolean(r[i])}function l6(r,t){for(var i=0;i<r.length;i++)t.writeFixed32(r[i])}function c6(r,t){for(var i=0;i<r.length;i++)t.writeSFixed32(r[i])}function u6(r,t){for(var i=0;i<r.length;i++)t.writeFixed64(r[i])}function h6(r,t){for(var i=0;i<r.length;i++)t.writeSFixed64(r[i])}function Sx(r,t){return(r[t]|r[t+1]<<8|r[t+2]<<16)+16777216*r[t+3]}function ud(r,t,i){r[i]=t,r[i+1]=t>>>8,r[i+2]=t>>>16,r[i+3]=t>>>24}function Xk(r,t){return(r[t]|r[t+1]<<8|r[t+2]<<16)+(r[t+3]<<24)}Jn.prototype={destroy:function(){this.buf=null},readFields:function(r,t,i){for(i=i||this.length;this.pos<i;){var l=this.readVarint(),h=l>>3,d=this.pos;this.type=7&l,r(h,t,this),this.pos===d&&this.skip(l)}return t},readMessage:function(r,t){return this.readFields(r,t,this.readVarint()+this.pos)},readFixed32:function(){var r=Sx(this.buf,this.pos);return this.pos+=4,r},readSFixed32:function(){var r=Xk(this.buf,this.pos);return this.pos+=4,r},readFixed64:function(){var r=Sx(this.buf,this.pos)+Sx(this.buf,this.pos+4)*Aw;return this.pos+=8,r},readSFixed64:function(){var r=Sx(this.buf,this.pos)+Xk(this.buf,this.pos+4)*Aw;return this.pos+=8,r},readFloat:function(){var r=Ex.read(this.buf,this.pos,!0,23,4);return this.pos+=4,r},readDouble:function(){var r=Ex.read(this.buf,this.pos,!0,52,8);return this.pos+=8,r},readVarint:function(r){var t,i,l=this.buf;return t=127&(i=l[this.pos++]),i<128?t:(t|=(127&(i=l[this.pos++]))<<7,i<128?t:(t|=(127&(i=l[this.pos++]))<<14,i<128?t:(t|=(127&(i=l[this.pos++]))<<21,i<128?t:function(h,d,g){var y,b,E=g.buf;if(y=(112&(b=E[g.pos++]))>>4,b<128||(y|=(127&(b=E[g.pos++]))<<3,b<128)||(y|=(127&(b=E[g.pos++]))<<10,b<128)||(y|=(127&(b=E[g.pos++]))<<17,b<128)||(y|=(127&(b=E[g.pos++]))<<24,b<128)||(y|=(1&(b=E[g.pos++]))<<31,b<128))return cd(h,y,d);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(i=l[this.pos]))<<28,r,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var r=this.readVarint();return r%2==1?(r+1)/-2:r/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var r=this.readVarint()+this.pos,t=this.pos;return this.pos=r,r-t>=12&&qk?function(i,l,h){return qk.decode(i.subarray(l,h))}(this.buf,t,r):function(i,l,h){for(var d="",g=l;g<h;){var y,b,E,A=i[g],M=null,P=A>239?4:A>223?3:A>191?2:1;if(g+P>h)break;P===1?A<128&&(M=A):P===2?(192&(y=i[g+1]))==128&&(M=(31&A)<<6|63&y)<=127&&(M=null):P===3?(b=i[g+2],(192&(y=i[g+1]))==128&&(192&b)==128&&((M=(15&A)<<12|(63&y)<<6|63&b)<=2047||M>=55296&&M<=57343)&&(M=null)):P===4&&(b=i[g+2],E=i[g+3],(192&(y=i[g+1]))==128&&(192&b)==128&&(192&E)==128&&((M=(15&A)<<18|(63&y)<<12|(63&b)<<6|63&E)<=65535||M>=1114112)&&(M=null)),M===null?(M=65533,P=1):M>65535&&(M-=65536,d+=String.fromCharCode(M>>>10&1023|55296),M=56320|1023&M),d+=String.fromCharCode(M),g+=P}return d}(this.buf,t,r)},readBytes:function(){var r=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,r);return this.pos=r,t},readPackedVarint:function(r,t){if(this.type!==Jn.Bytes)return r.push(this.readVarint(t));var i=ic(this);for(r=r||[];this.pos<i;)r.push(this.readVarint(t));return r},readPackedSVarint:function(r){if(this.type!==Jn.Bytes)return r.push(this.readSVarint());var t=ic(this);for(r=r||[];this.pos<t;)r.push(this.readSVarint());return r},readPackedBoolean:function(r){if(this.type!==Jn.Bytes)return r.push(this.readBoolean());var t=ic(this);for(r=r||[];this.pos<t;)r.push(this.readBoolean());return r},readPackedFloat:function(r){if(this.type!==Jn.Bytes)return r.push(this.readFloat());var t=ic(this);for(r=r||[];this.pos<t;)r.push(this.readFloat());return r},readPackedDouble:function(r){if(this.type!==Jn.Bytes)return r.push(this.readDouble());var t=ic(this);for(r=r||[];this.pos<t;)r.push(this.readDouble());return r},readPackedFixed32:function(r){if(this.type!==Jn.Bytes)return r.push(this.readFixed32());var t=ic(this);for(r=r||[];this.pos<t;)r.push(this.readFixed32());return r},readPackedSFixed32:function(r){if(this.type!==Jn.Bytes)return r.push(this.readSFixed32());var t=ic(this);for(r=r||[];this.pos<t;)r.push(this.readSFixed32());return r},readPackedFixed64:function(r){if(this.type!==Jn.Bytes)return r.push(this.readFixed64());var t=ic(this);for(r=r||[];this.pos<t;)r.push(this.readFixed64());return r},readPackedSFixed64:function(r){if(this.type!==Jn.Bytes)return r.push(this.readSFixed64());var t=ic(this);for(r=r||[];this.pos<t;)r.push(this.readSFixed64());return r},skip:function(r){var t=7&r;if(t===Jn.Varint)for(;this.buf[this.pos++]>127;);else if(t===Jn.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Jn.Fixed32)this.pos+=4;else{if(t!==Jn.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(r,t){this.writeVarint(r<<3|t)},realloc:function(r){for(var t=this.length||16;t<this.pos+r;)t*=2;if(t!==this.length){var i=new Uint8Array(t);i.set(this.buf),this.buf=i,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(r){this.realloc(4),ud(this.buf,r,this.pos),this.pos+=4},writeSFixed32:function(r){this.realloc(4),ud(this.buf,r,this.pos),this.pos+=4},writeFixed64:function(r){this.realloc(8),ud(this.buf,-1&r,this.pos),ud(this.buf,Math.floor(r*Wk),this.pos+4),this.pos+=8},writeSFixed64:function(r){this.realloc(8),ud(this.buf,-1&r,this.pos),ud(this.buf,Math.floor(r*Wk),this.pos+4),this.pos+=8},writeVarint:function(r){(r=+r||0)>268435455||r<0?function(t,i){var l,h;if(t>=0?(l=t%4294967296|0,h=t/4294967296|0):(h=~(-t/4294967296),4294967295^(l=~(-t%4294967296))?l=l+1|0:(l=0,h=h+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),function(d,g,y){y.buf[y.pos++]=127&d|128,d>>>=7,y.buf[y.pos++]=127&d|128,d>>>=7,y.buf[y.pos++]=127&d|128,d>>>=7,y.buf[y.pos++]=127&d|128,y.buf[y.pos]=127&(d>>>=7)}(l,0,i),function(d,g){var y=(7&d)<<4;g.buf[g.pos++]|=y|((d>>>=3)?128:0),d&&(g.buf[g.pos++]=127&d|((d>>>=7)?128:0),d&&(g.buf[g.pos++]=127&d|((d>>>=7)?128:0),d&&(g.buf[g.pos++]=127&d|((d>>>=7)?128:0),d&&(g.buf[g.pos++]=127&d|((d>>>=7)?128:0),d&&(g.buf[g.pos++]=127&d)))))}(h,i)}(r,this):(this.realloc(4),this.buf[this.pos++]=127&r|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))},writeSVarint:function(r){this.writeVarint(r<0?2*-r-1:2*r)},writeBoolean:function(r){this.writeVarint(!!r)},writeString:function(r){r=String(r),this.realloc(4*r.length),this.pos++;var t=this.pos;this.pos=function(l,h,d){for(var g,y,b=0;b<h.length;b++){if((g=h.charCodeAt(b))>55295&&g<57344){if(!y){g>56319||b+1===h.length?(l[d++]=239,l[d++]=191,l[d++]=189):y=g;continue}if(g<56320){l[d++]=239,l[d++]=191,l[d++]=189,y=g;continue}g=y-55296<<10|g-56320|65536,y=null}else y&&(l[d++]=239,l[d++]=191,l[d++]=189,y=null);g<128?l[d++]=g:(g<2048?l[d++]=g>>6|192:(g<65536?l[d++]=g>>12|224:(l[d++]=g>>18|240,l[d++]=g>>12&63|128),l[d++]=g>>6&63|128),l[d++]=63&g|128)}return d}(this.buf,r,this.pos);var i=this.pos-t;i>=128&&Zk(t,i,this),this.pos=t-1,this.writeVarint(i),this.pos+=i},writeFloat:function(r){this.realloc(4),Ex.write(this.buf,r,this.pos,!0,23,4),this.pos+=4},writeDouble:function(r){this.realloc(8),Ex.write(this.buf,r,this.pos,!0,52,8),this.pos+=8},writeBytes:function(r){var t=r.length;this.writeVarint(t),this.realloc(t);for(var i=0;i<t;i++)this.buf[this.pos++]=r[i]},writeRawMessage:function(r,t){this.pos++;var i=this.pos;r(t,this);var l=this.pos-i;l>=128&&Zk(i,l,this),this.pos=i-1,this.writeVarint(l),this.pos+=l},writeMessage:function(r,t,i){this.writeTag(r,Jn.Bytes),this.writeRawMessage(t,i)},writePackedVarint:function(r,t){t.length&&this.writeMessage(r,n6,t)},writePackedSVarint:function(r,t){t.length&&this.writeMessage(r,i6,t)},writePackedBoolean:function(r,t){t.length&&this.writeMessage(r,o6,t)},writePackedFloat:function(r,t){t.length&&this.writeMessage(r,a6,t)},writePackedDouble:function(r,t){t.length&&this.writeMessage(r,s6,t)},writePackedFixed32:function(r,t){t.length&&this.writeMessage(r,l6,t)},writePackedSFixed32:function(r,t){t.length&&this.writeMessage(r,c6,t)},writePackedFixed64:function(r,t){t.length&&this.writeMessage(r,u6,t)},writePackedSFixed64:function(r,t){t.length&&this.writeMessage(r,h6,t)},writeBytesField:function(r,t){this.writeTag(r,Jn.Bytes),this.writeBytes(t)},writeFixed32Field:function(r,t){this.writeTag(r,Jn.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(r,t){this.writeTag(r,Jn.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(r,t){this.writeTag(r,Jn.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(r,t){this.writeTag(r,Jn.Fixed64),this.writeSFixed64(t)},writeVarintField:function(r,t){this.writeTag(r,Jn.Varint),this.writeVarint(t)},writeSVarintField:function(r,t){this.writeTag(r,Jn.Varint),this.writeSVarint(t)},writeStringField:function(r,t){this.writeTag(r,Jn.Bytes),this.writeString(t)},writeFloatField:function(r,t){this.writeTag(r,Jn.Fixed32),this.writeFloat(t)},writeDoubleField:function(r,t){this.writeTag(r,Jn.Fixed64),this.writeDouble(t)},writeBooleanField:function(r,t){this.writeVarintField(r,!!t)}};var hd=Z(Hk);const Cw=3;function f6(r,t,i){t.glyphs=[],r===1&&i.readMessage(d6,t)}function d6(r,t,i){if(r===3){const{id:l,bitmap:h,width:d,height:g,left:y,top:b,advance:E}=i.readMessage(p6,{});t.glyphs.push({id:l,bitmap:new Qc({width:d+2*Cw,height:g+2*Cw},h),metrics:{width:d,height:g,left:y,top:b,advance:E}})}else r===4?t.ascender=i.readSVarint():r===5&&(t.descender=i.readSVarint())}function p6(r,t,i){r===1?t.id=i.readVarint():r===2?t.bitmap=i.readBytes():r===3?t.width=i.readVarint():r===4?t.height=i.readVarint():r===5?t.left=i.readSVarint():r===6?t.top=i.readSVarint():r===7&&(t.advance=i.readVarint())}const Yk=Cw,Fs={horizontal:1,vertical:2,horizontalOnly:3};class am{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,i){const l=new am;return l.scale=t||1,l.fontStack=i,l}static forImage(t){const i=new am;return i.imageName=t,i}}class fd{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,i){const l=new fd;for(let h=0;h<t.sections.length;h++){const d=t.sections[h];d.image?l.addImageSection(d):l.addTextSection(d,i)}return l}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSections(){return this.sections}getSectionIndex(t){return this.sectionIndex[t]}getCodePoint(t){return this.text.codePointAt(t)}verticalizePunctuation(t){this.text=function(i,l){let h="";for(let d=0;d<i.length;d++){const g=i.charCodeAt(d+1)||null,y=i.charCodeAt(d-1)||null;h+=!l&&(g&&R_(g)&&!im[i[d+1]]||y&&R_(y)&&!im[i[d-1]])||!im[i[d]]?i[d]:im[i[d]]}return h}(this.text,t)}trim(){let t=0;for(let l=0;l<this.text.length&&Ax[this.text.charCodeAt(l)];l++)t++;let i=this.text.length;for(let l=this.text.length-1;l>=0&&l>=t&&Ax[this.text.charCodeAt(l)];l--)i--;this.text=this.text.substring(t,i),this.sectionIndex=this.sectionIndex.slice(t,i)}substring(t,i){const l=new fd;return l.text=this.text.substring(t,i),l.sectionIndex=this.sectionIndex.slice(t,i),l.sections=this.sections,l}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,i)=>Math.max(t,this.sections[i].scale),0)}addTextSection(t,i){this.text+=t.text,this.sections.push(am.forText(t.scale,t.fontStack||i));const l=this.sections.length-1;for(let h=0;h<t.text.length;++h)this.sectionIndex.push(l)}addImageSection(t){const i=t.image?t.image.namePrimary:"";if(i.length===0)return void Tr("Can't add FormattedSection with an empty image.");const l=this.getNextImageSectionCharCode();l?(this.text+=String.fromCodePoint(l),this.sections.push(am.forImage(i)),this.sectionIndex.push(this.sections.length-1)):Tr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function kw(r,t,i,l,h,d,g,y,b,E,A,M,P,O,z){const j=fd.fromFeature(r,h);M===Fs.vertical&&j.verticalizePunctuation(P);let q=[];const Q=function(Ee,Le,je,Ze,it,Ye){if(!Ee)return[];const mt=[],bt=function(vt,Gt,Tt,ar,Qt,It){let vr=0;for(let hr=0;hr<vt.length();hr++){const ir=vt.getSection(hr);vr+=Kk(vt.getCodePoint(hr),ir,ar,Qt,Gt,It)}return vr/Math.max(1,Math.ceil(vr/Tt))}(Ee,Le,je,Ze,it,Ye),ht=Ee.text.indexOf("​")>=0;let wt=0;for(let vt=0;vt<Ee.length();vt++){const Gt=Ee.getSection(vt),Tt=Ee.getCodePoint(vt);if(Ax[Tt]||(wt+=Kk(Tt,Gt,Ze,it,Le,Ye)),vt<Ee.length()-1){const ar=!((lt=Tt)<11904||!(cr["Bopomofo Extended"](lt)||cr.Bopomofo(lt)||cr["CJK Compatibility Forms"](lt)||cr["CJK Compatibility Ideographs"](lt)||cr["CJK Compatibility"](lt)||cr["CJK Radicals Supplement"](lt)||cr["CJK Strokes"](lt)||cr["CJK Symbols and Punctuation"](lt)||cr["CJK Unified Ideographs Extension A"](lt)||cr["CJK Unified Ideographs"](lt)||cr["Enclosed CJK Letters and Months"](lt)||cr["Halfwidth and Fullwidth Forms"](lt)||cr.Hiragana(lt)||cr["Ideographic Description Characters"](lt)||cr["Kangxi Radicals"](lt)||cr["Katakana Phonetic Extensions"](lt)||cr.Katakana(lt)||cr["Vertical Forms"](lt)||cr["Yi Radicals"](lt)||cr["Yi Syllables"](lt)));(m6[Tt]||ar||Gt.imageName)&&mt.push(Qk(vt+1,wt,bt,mt,g6(Tt,Ee.getCodePoint(vt+1),ar&&ht),!1))}}var lt;return e3(Qk(Ee.length(),wt,bt,mt,0,!0))}(j,E,d,t,l,O),{processBidirectionalText:oe,processStyledBidirectionalText:pe}=Ya;if(oe&&j.sections.length===1){const Ee=oe(j.toString(),Q);for(const Le of Ee){const je=new fd;je.text=Le,je.sections=j.sections;for(let Ze=0;Ze<Le.length;Ze++)je.sectionIndex.push(0);q.push(je)}}else if(pe){const Ee=pe(j.text,j.sectionIndex,Q);for(const Le of Ee){const je=new fd;je.text=Le[0],je.sectionIndex=Le[1],je.sections=j.sections,q.push(je)}}else q=function(Ee,Le){const je=[],Ze=Ee.text;let it=0;for(const Ye of Le)je.push(Ee.substring(it,Ye)),it=Ye;return it<Ze.length&&je.push(Ee.substring(it,Ze.length)),je}(j,Q);const de=[],Ce={positionedLines:de,text:j.toString(),top:A[1],bottom:A[1],left:A[0],right:A[0],writingMode:M,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Ee,Le,je,Ze,it,Ye,mt,bt,ht,wt,lt,vt){let Gt=0,Tt=0,ar=0;const Qt=bt==="right"?1:bt==="left"?0:.5;let It=!1;for(const Vr of it){const wr=Vr.getSections();for(const $r of wr){if($r.imageName)continue;const kr=Le[$r.fontStack];if(kr&&(It=kr.ascender!==void 0&&kr.descender!==void 0,!It))break}if(!It)break}let vr=0;for(const Vr of it){Vr.trim();const wr=Vr.getMaxScale(),$r=(wr-1)*aa,kr={positionedGlyphs:[],lineOffset:0};Ee.positionedLines[vr]=kr;const Jr=kr.positionedGlyphs;let Rr=0;if(!Vr.length()){Tt+=Ye,++vr;continue}let Rn=0,hn=0;for(let xn=0;xn<Vr.length();xn++){const fn=Vr.getSection(xn),Qn=Vr.getSectionIndex(xn),Cn=Vr.getCodePoint(xn);let hi=fn.scale,Pi=null,Qi=null,Kn=null,si=aa,Gi=0;const Hi=!(ht===Fs.horizontal||!lt&&!y0(Cn)||lt&&(Ax[Cn]||(hr=Cn,cr.Arabic(hr)||cr["Arabic Supplement"](hr)||cr["Arabic Extended-A"](hr)||cr["Arabic Presentation Forms-A"](hr)||cr["Arabic Presentation Forms-B"](hr))));if(fn.imageName){const Wi=Ze[fn.imageName];if(!Wi)continue;Kn=fn.imageName,Ee.iconsInText=Ee.iconsInText||!0,Qi=Wi.paddedRect;const Un=Wi.displaySize;hi=hi*aa/vt,Pi={width:Un[0],height:Un[1],left:0,top:-Yk,advance:Hi?Un[1]:Un[0],localGlyph:!1},Gi=It?-Pi.height*hi:wr*aa-17-Un[1]*hi,si=Pi.advance;const ms=(Hi?Un[0]:Un[1])*hi-aa*wr;ms>0&&ms>Rr&&(Rr=ms)}else{const Wi=je[fn.fontStack];if(!Wi)continue;Wi[Cn]&&(Qi=Wi[Cn]);const Un=Le[fn.fontStack];if(!Un)continue;const ms=Un.glyphs[Cn];if(!ms)continue;if(Pi=ms.metrics,si=Cn!==8203?aa:0,It){const lu=Un.ascender!==void 0?Math.abs(Un.ascender):0,Na=Un.descender!==void 0?Math.abs(Un.descender):0,ba=(lu+Na)*hi;Rn<ba&&(Rn=ba,hn=(lu-Na)/2*hi),Gi=-lu*hi}else Gi=(wr-hi)*aa-17}Hi?(Ee.verticalizable=!0,Jr.push({glyph:Cn,imageName:Kn,x:Gt,y:Tt+Gi,vertical:Hi,scale:hi,localGlyph:Pi.localGlyph,fontStack:fn.fontStack,sectionIndex:Qn,metrics:Pi,rect:Qi}),Gt+=si*hi+wt):(Jr.push({glyph:Cn,imageName:Kn,x:Gt,y:Tt+Gi,vertical:Hi,scale:hi,localGlyph:Pi.localGlyph,fontStack:fn.fontStack,sectionIndex:Qn,metrics:Pi,rect:Qi}),Gt+=Pi.advance*hi+wt)}Jr.length!==0&&(ar=Math.max(Gt-wt,ar),It?t3(Jr,Qt,Rr,hn,Ye*wr/2):t3(Jr,Qt,Rr,0,Ye/2)),Gt=0;const pn=Ye*wr+Rr;kr.lineOffset=Math.max(Rr,$r),Tt+=pn,++vr}var hr;const ir=Tt,{horizontalAlign:Pt,verticalAlign:gr}=Mw(mt);(function(Vr,wr,$r,kr,Jr,Rr){const Rn=(wr-$r)*Jr,hn=-Rr*kr;for(const pn of Vr)for(const xn of pn.positionedGlyphs)xn.x+=Rn,xn.y+=hn})(Ee.positionedLines,Qt,Pt,gr,ar,ir),Ee.top+=-gr*ir,Ee.bottom=Ee.top+ir,Ee.left+=-Pt*ar,Ee.right=Ee.left+ar,Ee.hasBaseline=It}(Ce,t,i,l,q,g,y,b,M,E,P,z),!function(Ee){for(const Le of Ee)if(Le.positionedGlyphs.length!==0)return!1;return!0}(de)&&Ce}const Ax={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},m6={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Kk(r,t,i,l,h,d){if(t.imageName){const g=l[t.imageName];return g?g.displaySize[0]*t.scale*aa/d+h:0}{const g=i[t.fontStack],y=g&&g.glyphs[r];return y?y.metrics.advance*t.scale+h:0}}function Jk(r,t,i,l){const h=Math.pow(r-t,2);return l?r<t?h/2:2*h:h+Math.abs(i)*i}function g6(r,t,i){let l=0;return r===10&&(l-=1e4),i&&(l+=150),r!==40&&r!==65288||(l+=50),t!==41&&t!==65289||(l+=50),l}function Qk(r,t,i,l,h,d){let g=null,y=Jk(t,i,h,d);for(const b of l){const E=Jk(t-b.x,i,h,d)+b.badness;E<=y&&(g=b,y=E)}return{index:r,x:t,priorBreak:g,badness:y}}function e3(r){return r?e3(r.priorBreak).concat(r.index):[]}function Mw(r){let t=.5,i=.5;switch(r){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:t,verticalAlign:i}}function t3(r,t,i,l,h){if(!(t||i||l||h))return;const d=r.length-1,g=r[d],y=(g.x+g.metrics.advance*g.scale)*t;for(let b=0;b<=d;b++)r[b].x-=y,r[b].y+=i+l+h}function _6(r,t,i,l){const{horizontalAlign:h,verticalAlign:d}=Mw(l),g=i[0]-r.displaySize[0]*h,y=i[1]-r.displaySize[1]*d;return{imagePrimary:r,imageSecondary:t,top:y,bottom:y+r.displaySize[1],left:g,right:g+r.displaySize[0]}}function r3(r,t,i,l,h,d){const g=r.imagePrimary;let y;if(g.content){const q=g.content,Q=g.pixelRatio||1;y=[q[0]/Q,q[1]/Q,g.displaySize[0]-q[2]/Q,g.displaySize[1]-q[3]/Q]}const b=t.left*d,E=t.right*d;let A,M,P,O;i==="width"||i==="both"?(O=h[0]+b-l[3],M=h[0]+E+l[1]):(O=h[0]+(b+E-g.displaySize[0])/2,M=O+g.displaySize[0]);const z=t.top*d,j=t.bottom*d;return i==="height"||i==="both"?(A=h[1]+z-l[0],P=h[1]+j+l[2]):(A=h[1]+(z+j-g.displaySize[1])/2,P=A+g.displaySize[1]),{imagePrimary:g,imageSecondary:void 0,top:A,right:M,bottom:P,left:O,collisionPadding:y}}class ac extends we{constructor(t,i,l,h,d){super(t,i),this.angle=h,this.z=l,d!==void 0&&(this.segment=d)}clone(){return new ac(this.x,this.y,this.z,this.angle,this.segment)}}function n3(r,t,i,l,h){if(t.segment===void 0)return!0;let d=t,g=t.segment+1,y=0;for(;y>-i/2;){if(g--,g<0)return!1;y-=r[g].dist(d),d=r[g]}y+=r[g].dist(r[g+1]),g++;const b=[];let E=0;for(;y<i/2;){const A=r[g],M=r[g+1];if(!M)return!1;let P=r[g-1].angleTo(A)-A.angleTo(M);for(P=Math.abs((P+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:y,angleDelta:P}),E+=P;y-b[0].distance>l;)E-=b.shift().angleDelta;if(E>h)return!1;g++,y+=A.dist(M)}return!0}function i3(r){let t=0;for(let i=0;i<r.length-1;i++)t+=r[i].dist(r[i+1]);return t}function a3(r,t,i){return r?.6*t*i:0}function s3(r,t){return Math.max(r?r.right-r.left:0,t?t.right-t.left:0)}function x6(r,t,i,l,h,d){const g=a3(i,h,d),y=s3(i,l)*d;let b=0;const E=i3(r)/2;for(let A=0;A<r.length-1;A++){const M=r[A],P=r[A+1],O=M.dist(P);if(b+O>E){const z=(E-b)/O,j=Kr(M.x,P.x,z),q=Kr(M.y,P.y,z),Q=new ac(j,q,0,P.angleTo(M),A);return!g||n3(r,Q,y,g,t)?Q:void 0}b+=O}}function y6(r,t,i,l,h,d,g,y,b){const E=a3(l,d,g),A=s3(l,h),M=A*g,P=r[0].x===0||r[0].x===b||r[0].y===0||r[0].y===b;return t-M<t/4&&(t=M+t/4),o3(r,P?t/2*y%t:(A/2+2*d)*g*y%t,t,E,i,M,P,!1,b)}function o3(r,t,i,l,h,d,g,y,b){const E=d/2,A=i3(r);let M=0,P=t-i,O=[];for(let z=0;z<r.length-1;z++){const j=r[z],q=r[z+1],Q=j.dist(q),oe=q.angleTo(j);for(;P+i<M+Q;){P+=i;const pe=(P-M)/Q,de=Kr(j.x,q.x,pe),Ce=Kr(j.y,q.y,pe);if(de>=0&&de<b&&Ce>=0&&Ce<b&&P-E>=0&&P+E<=A){const Ee=new ac(de,Ce,0,oe,z);l&&!n3(r,Ee,d,l,h)||O.push(Ee)}}M+=Q}return y||O.length||g||(O=o3(r,M/2,i,l,h,d,g,!0,b)),O}function l3(r,t,i,l,h){const d=[];for(let g=0;g<r.length;g++){const y=r[g];let b;for(let E=0;E<y.length-1;E++){let A=y[E],M=y[E+1];A.x<t&&M.x<t||(A.x<t?A=new we(t,A.y+(t-A.x)/(M.x-A.x)*(M.y-A.y))._round():M.x<t&&(M=new we(t,A.y+(t-A.x)/(M.x-A.x)*(M.y-A.y))._round()),A.y<i&&M.y<i||(A.y<i?A=new we(A.x+(i-A.y)/(M.y-A.y)*(M.x-A.x),i)._round():M.y<i&&(M=new we(A.x+(i-A.y)/(M.y-A.y)*(M.x-A.x),i)._round()),A.x>=l&&M.x>=l||(A.x>=l?A=new we(l,A.y+(l-A.x)/(M.x-A.x)*(M.y-A.y))._round():M.x>=l&&(M=new we(l,A.y+(l-A.x)/(M.x-A.x)*(M.y-A.y))._round()),A.y>=h&&M.y>=h||(A.y>=h?A=new we(A.x+(h-A.y)/(M.y-A.y)*(M.x-A.x),h)._round():M.y>=h&&(M=new we(A.x+(h-A.y)/(M.y-A.y)*(M.x-A.x),h)._round()),b&&A.equals(b[b.length-1])||(b=[A],d.push(b)),b.push(M)))))}}return d}function c3(r){let t=0,i=0;for(const g of r)t+=g.w*g.h,i=Math.max(i,g.w);r.sort((g,y)=>y.h-g.h);const l=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),i),h:1/0}];let h=0,d=0;for(const g of r)for(let y=l.length-1;y>=0;y--){const b=l[y];if(!(g.w>b.w||g.h>b.h)){if(g.x=b.x,g.y=b.y,d=Math.max(d,g.y+g.h),h=Math.max(h,g.x+g.w),g.w===b.w&&g.h===b.h){const E=l.pop();y<l.length&&(l[y]=E)}else g.h===b.h?(b.x+=g.w,b.w-=g.w):g.w===b.w?(b.y+=g.h,b.h-=g.h):(l.push({x:b.x+g.w,y:b.y,w:b.w-g.w,h:g.h}),b.y+=g.h,b.h-=g.h);break}}return{w:h,h:d,fill:t/(h*d)||0}}rr(ac,"Anchor");const ps=1;class Iw{constructor(t,{pixelRatio:i,version:l,stretchX:h,stretchY:d,content:g}){this.paddedRect=t,this.pixelRatio=i,this.stretchX=h,this.stretchY=d,this.content=g,this.version=l}get tl(){return[this.paddedRect.x+ps,this.paddedRect.y+ps]}get br(){return[this.paddedRect.x+this.paddedRect.w-ps,this.paddedRect.y+this.paddedRect.h-ps]}get displaySize(){return[(this.paddedRect.w-2*ps)/this.pixelRatio,(this.paddedRect.h-2*ps)/this.pixelRatio]}}class u3{constructor(t,i){const l={},h={};this.haveRenderCallbacks=[];const d=[];this.addImages(t,l,d),this.addImages(i,h,d);const{w:g,h:y}=c3(d),b=new Ds({width:g||1,height:y||1});for(const E in t){const A=t[E],M=l[E].paddedRect;Ds.copy(A.data,b,{x:0,y:0},{x:M.x+ps,y:M.y+ps},A.data,A.sdf)}for(const E in i){const A=i[E],M=h[E].paddedRect,P=M.x+ps,O=M.y+ps,z=A.data.width,j=A.data.height;Ds.copy(A.data,b,{x:0,y:0},{x:P,y:O},A.data),Ds.copy(A.data,b,{x:0,y:j-1},{x:P,y:O-1},{width:z,height:1}),Ds.copy(A.data,b,{x:0,y:0},{x:P,y:O+j},{width:z,height:1}),Ds.copy(A.data,b,{x:z-1,y:0},{x:P-1,y:O},{width:1,height:j}),Ds.copy(A.data,b,{x:0,y:0},{x:P+z,y:O},{width:1,height:j})}this.image=b,this.iconPositions=l,this.patternPositions=h}addImages(t,i,l){for(const h in t){const d=t[h],g={x:0,y:0,w:d.data.width+2*ps,h:d.data.height+2*ps};l.push(g),i[h]=new Iw(g,d),d.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(t,i,l){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(h=>t.hasImage(h,l)),t.dispatchRenderCallbacks(this.haveRenderCallbacks,l);for(const h in t.getUpdatedImages(l))this.patchUpdatedImage(this.iconPositions[h],t.getImage(h,l),i),this.patchUpdatedImage(this.patternPositions[h],t.getImage(h,l),i)}patchUpdatedImage(t,i,l){if(!t||!i||t.version===i.version)return;t.version=i.version;const[h,d]=t.tl,g=!!Object.keys(this.patternPositions).length;l.update(i.data,{useMipmap:g},{x:h,y:d})}}rr(Iw,"ImagePosition"),rr(u3,"ImageAtlas");const sm=1e20;function h3(r,t,i,l,h,d,g,y,b){for(let E=t;E<t+l;E++)f3(r,i*d+E,d,h,g,y,b);for(let E=i;E<i+h;E++)f3(r,E*d+t,1,l,g,y,b)}function f3(r,t,i,l,h,d,g){d[0]=0,g[0]=-sm,g[1]=sm,h[0]=r[t];for(let y=1,b=0,E=0;y<l;y++){h[y]=r[t+y*i];const A=y*y;do{const M=d[b];E=(h[y]-h[M]+A-M*M)/(y-M)/2}while(E<=g[b]&&--b>-1);b++,d[b]=y,g[b]=E,g[b+1]=sm}for(let y=0,b=0;y<l;y++){for(;g[b+1]<y;)b++;const E=d[b],A=y-E;r[t+y*i]=h[E]+A*A}}const Ro=2,Pw={none:0,ideographs:1,all:2};class dd{constructor(t,i,l){this.requestManager=t,this.localGlyphMode=i,this.localFontFamily=l,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(t,i){this.urls[i]=t}getGlyphs(t,i,l){const h=[],d=this.urls[i]||F.GLYPHS_URL;for(const g in t)for(const y of t[g])h.push({stack:g,id:y});Dt(h,({stack:g,id:y},b)=>{let E=this.entries[g];E||(E=this.entries[g]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let A=E.glyphs[y];if(A!==void 0)return void b(null,{stack:g,id:y,glyph:A});if(A=this._tinySDF(E,g,y),A)return E.glyphs[y]=A,void b(null,{stack:g,id:y,glyph:A});const M=Math.floor(y/256);if(256*M>65535)return void b(new Error("glyphs > 65535 not supported"));if(E.ranges[M])return void b(null,{stack:g,id:y,glyph:A});let P=E.requests[M];P||(P=E.requests[M]=[],dd.loadGlyphRange(g,M,d,this.requestManager,(O,z)=>{if(z){E.ascender=z.ascender,E.descender=z.descender;for(const j in z.glyphs)this._doesCharSupportLocalGlyph(+j)||(E.glyphs[+j]=z.glyphs[+j]);E.ranges[M]=!0}for(const j of P)j(O,z);delete E.requests[M]})),P.push((O,z)=>{O?b(O):z&&b(null,{stack:g,id:y,glyph:z.glyphs[y]||null})})},(g,y)=>{if(g)l(g);else if(y){const b={};for(const{stack:E,id:A,glyph:M}of y)b[E]===void 0&&(b[E]={}),b[E].glyphs===void 0&&(b[E].glyphs={}),b[E].glyphs[A]=M&&{id:M.id,bitmap:M.bitmap.clone(),metrics:M.metrics},b[E].ascender=this.entries[E].ascender,b[E].descender=this.entries[E].descender;l(null,b)}})}_doesCharSupportLocalGlyph(t){return this.localGlyphMode!==Pw.none&&(this.localGlyphMode===Pw.all?!!this.localFontFamily:!!this.localFontFamily&&(cr["CJK Unified Ideographs"](t)||cr["Hangul Syllables"](t)||cr.Hiragana(t)||cr.Katakana(t)||cr["CJK Symbols and Punctuation"](t)||cr["CJK Unified Ideographs Extension A"](t)||cr["CJK Unified Ideographs Extension B"](t)))}_tinySDF(t,i,l){const h=this.localFontFamily;if(!h||!this._doesCharSupportLocalGlyph(l))return;let d=t.tinySDF;if(!d){let j="400";/bold/i.test(i)?j="900":/medium/i.test(i)?j="500":/light/i.test(i)&&(j="200"),d=t.tinySDF=new dd.TinySDF({fontFamily:h,fontWeight:j,fontSize:24*Ro,buffer:3*Ro,radius:8*Ro}),d.fontWeight=j}if(this.localGlyphs[d.fontWeight][l])return this.localGlyphs[d.fontWeight][l];const g=String.fromCodePoint(l),{data:y,width:b,height:E,glyphWidth:A,glyphHeight:M,glyphLeft:P,glyphTop:O,glyphAdvance:z}=d.draw(g);return this.localGlyphs[d.fontWeight][l]={id:l,bitmap:new Qc({width:b,height:E},y),metrics:{width:A/Ro,height:M/Ro,left:P/Ro,top:O/Ro-27,advance:z/Ro,localGlyph:!0}}}}dd.loadGlyphRange=function(r,t,i,l,h){const d=256*t,g=d+255,y=l.transformRequest(l.normalizeGlyphsURL(i).replace("{fontstack}",r).replace("{range}",`${d}-${g}`),Xi.Glyphs);xt(y,(b,E)=>{if(b)h(b);else if(E){const A={},M=function(P){return new hd(P).readFields(f6,{})}(E);for(const P of M.glyphs)A[P.id]=P;h(null,{glyphs:A,ascender:M.ascender,descender:M.descender})}})},dd.TinySDF=class{constructor({fontSize:r=24,buffer:t=3,radius:i=8,cutoff:l=.25,fontFamily:h="sans-serif",fontWeight:d="normal",fontStyle:g="normal"}={}){this.buffer=t,this.cutoff=l,this.radius=i;const y=this.size=r+4*t,b=this._createCanvas(y),E=this.ctx=b.getContext("2d",{willReadFrequently:!0});E.font=`${g} ${d} ${r}px ${h}`,E.textBaseline="alphabetic",E.textAlign="left",E.fillStyle="black",this.gridOuter=new Float64Array(y*y),this.gridInner=new Float64Array(y*y),this.f=new Float64Array(y),this.z=new Float64Array(y+1),this.v=new Uint16Array(y)}_createCanvas(r){const t=document.createElement("canvas");return t.width=t.height=r,t}draw(r){const{width:t,actualBoundingBoxAscent:i,actualBoundingBoxDescent:l,actualBoundingBoxLeft:h,actualBoundingBoxRight:d}=this.ctx.measureText(r),g=Math.ceil(i),y=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(d-h))),b=Math.min(this.size-this.buffer,g+Math.ceil(l)),E=y+2*this.buffer,A=b+2*this.buffer,M=Math.max(E*A,0),P=new Uint8ClampedArray(M),O={data:P,width:E,height:A,glyphWidth:y,glyphHeight:b,glyphTop:g,glyphLeft:0,glyphAdvance:t};if(y===0||b===0)return O;const{ctx:z,buffer:j,gridInner:q,gridOuter:Q}=this;z.clearRect(j,j,y,b),z.fillText(r,j,j+g);const oe=z.getImageData(j,j,y,b);Q.fill(sm,0,M),q.fill(0,0,M);for(let pe=0;pe<b;pe++)for(let de=0;de<y;de++){const Ce=oe.data[4*(pe*y+de)+3]/255;if(Ce===0)continue;const Ee=(pe+j)*E+de+j;if(Ce===1)Q[Ee]=0,q[Ee]=sm;else{const Le=.5-Ce;Q[Ee]=Le>0?Le*Le:0,q[Ee]=Le<0?Le*Le:0}}h3(Q,0,0,E,A,E,this.f,this.v,this.z),h3(q,j,j,y,b,E,this.f,this.v,this.z);for(let pe=0;pe<M;pe++){const de=Math.sqrt(Q[pe])-Math.sqrt(q[pe]);P[pe]=Math.round(255-255*(de/this.radius+this.cutoff))}return O}};const ru=ps;function d3(r,t,i,l){const h=[],d=r.imagePrimary,g=d.pixelRatio,y=d.paddedRect.w-2*ru,b=d.paddedRect.h-2*ru,E=r.right-r.left,A=r.bottom-r.top,M=d.stretchX||[[0,y]],P=d.stretchY||[[0,b]],O=(Ye,mt)=>Ye+mt[1]-mt[0],z=M.reduce(O,0),j=P.reduce(O,0),q=y-z,Q=b-j;let oe=0,pe=z,de=0,Ce=j,Ee=0,Le=q,je=0,Ze=Q;if(d.content&&l){const Ye=d.content;oe=Cx(M,0,Ye[0]),de=Cx(P,0,Ye[1]),pe=Cx(M,Ye[0],Ye[2]),Ce=Cx(P,Ye[1],Ye[3]),Ee=Ye[0]-oe,je=Ye[1]-de,Le=Ye[2]-Ye[0]-pe,Ze=Ye[3]-Ye[1]-Ce}const it=(Ye,mt,bt,ht)=>{const wt=kx(Ye.stretch-oe,pe,E,r.left),lt=Mx(Ye.fixed-Ee,Le,Ye.stretch,z),vt=kx(mt.stretch-de,Ce,A,r.top),Gt=Mx(mt.fixed-je,Ze,mt.stretch,j),Tt=kx(bt.stretch-oe,pe,E,r.left),ar=Mx(bt.fixed-Ee,Le,bt.stretch,z),Qt=kx(ht.stretch-de,Ce,A,r.top),It=Mx(ht.fixed-je,Ze,ht.stretch,j),vr=new we(wt,vt),hr=new we(Tt,vt),ir=new we(Tt,Qt),Pt=new we(wt,Qt),gr=new we(lt/g,Gt/g),Vr=new we(ar/g,It/g),wr=t*Math.PI/180;if(wr){const hn=Math.sin(wr),pn=Math.cos(wr),xn=[pn,-hn,hn,pn];vr._matMult(xn),hr._matMult(xn),Pt._matMult(xn),ir._matMult(xn)}const $r=Ye.stretch+Ye.fixed,kr=bt.stretch+bt.fixed,Jr=mt.stretch+mt.fixed,Rr=ht.stretch+ht.fixed,Rn=r.imageSecondary;return{tl:vr,tr:hr,bl:Pt,br:ir,texPrimary:{x:d.paddedRect.x+ru+$r,y:d.paddedRect.y+ru+Jr,w:kr-$r,h:Rr-Jr},texSecondary:Rn?{x:Rn.paddedRect.x+ru+$r,y:Rn.paddedRect.y+ru+Jr,w:kr-$r,h:Rr-Jr}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:gr,pixelOffsetBR:Vr,minFontScaleX:Le/g/E,minFontScaleY:Ze/g/A,isSDF:i}};if(l&&(d.stretchX||d.stretchY)){const Ye=p3(M,q,z),mt=p3(P,Q,j);for(let bt=0;bt<Ye.length-1;bt++){const ht=Ye[bt],wt=Ye[bt+1];for(let lt=0;lt<mt.length-1;lt++)h.push(it(ht,mt[lt],wt,mt[lt+1]))}}else h.push(it({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:y+1},{fixed:0,stretch:b+1}));return h}function Cx(r,t,i){let l=0;for(const h of r)l+=Math.max(t,Math.min(i,h[1]))-Math.max(t,Math.min(i,h[0]));return l}function p3(r,t,i){const l=[{fixed:-ru,stretch:0}];for(const[h,d]of r){const g=l[l.length-1];l.push({fixed:h-g.stretch,stretch:g.stretch}),l.push({fixed:h-g.stretch,stretch:g.stretch+(d-h)})}return l.push({fixed:t+ru,stretch:i}),l}function kx(r,t,i,l){return r/t*i+l}function Mx(r,t,i,l){return r-t*i/l}function v6(r,t,i,l){const h=t+r.positionedLines[l].lineOffset;return l===0?i+h/2:i+(h+(t+r.positionedLines[l-1].lineOffset))/2}function w6(r,t=1,i=!1){let l=1/0,h=1/0,d=-1/0,g=-1/0;const y=r[0];for(let O=0;O<y.length;O++){const z=y[O];(!O||z.x<l)&&(l=z.x),(!O||z.y<h)&&(h=z.y),(!O||z.x>d)&&(d=z.x),(!O||z.y>g)&&(g=z.y)}const b=Math.min(d-l,g-h);let E=b/2;const A=new ds([],b6);if(b===0)return new we(l,h);for(let O=l;O<d;O+=b)for(let z=h;z<g;z+=b)A.push(new pd(O+E,z+E,E,r));let M=function(O){let z=0,j=0,q=0;const Q=O[0];for(let oe=0,pe=Q.length,de=pe-1;oe<pe;de=oe++){const Ce=Q[oe],Ee=Q[de],Le=Ce.x*Ee.y-Ee.x*Ce.y;j+=(Ce.x+Ee.x)*Le,q+=(Ce.y+Ee.y)*Le,z+=3*Le}return new pd(j/z,q/z,0,O)}(r),P=A.length;for(;A.length;){const O=A.pop();(O.d>M.d||!M.d)&&(M=O,i&&console.log("found best %d after %d probes",Math.round(1e4*O.d)/1e4,P)),O.max-M.d<=t||(E=O.h/2,A.push(new pd(O.p.x-E,O.p.y-E,E,r)),A.push(new pd(O.p.x+E,O.p.y-E,E,r)),A.push(new pd(O.p.x-E,O.p.y+E,E,r)),A.push(new pd(O.p.x+E,O.p.y+E,E,r)),P+=4)}return i&&(console.log(`num probes: ${P}`),console.log(`best distance: ${M.d}`)),M.p}function b6(r,t){return t.max-r.max}class pd{constructor(t,i,l,h){this.p=new we(t,i),this.h=l,this.d=function(d,g){let y=!1,b=1/0;for(let E=0;E<g.length;E++){const A=g[E];for(let M=0,P=A.length,O=P-1;M<P;O=M++){const z=A[M],j=A[O];z.y>d.y!=j.y>d.y&&d.x<(j.x-z.x)*(d.y-z.y)/(j.y-z.y)+z.x&&(y=!y),b=Math.min(b,Yc(d,z,j))}}return(y?1:-1)*Math.sqrt(b)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}}const Rw=Number.POSITIVE_INFINITY,T6=Math.sqrt(2);function m3(r,[t,i]){let l=0,h=0;if(i===Rw){t<0&&(t=0);const d=t/T6;switch(r){case"top-right":case"top-left":h=d-7;break;case"bottom-right":case"bottom-left":h=7-d;break;case"bottom":h=7-t;break;case"top":h=t-7}switch(r){case"top-right":case"bottom-right":l=-d;break;case"top-left":case"bottom-left":l=d;break;case"left":l=t;break;case"right":l=-t}}else{switch(t=Math.abs(t),i=Math.abs(i),r){case"top-right":case"top-left":case"top":h=i-7;break;case"bottom-right":case"bottom-left":case"bottom":h=7-i}switch(r){case"top-right":case"bottom-right":case"right":l=-t;break;case"top-left":case"bottom-left":case"left":l=t}}return[l,h]}function Dw(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function E6(r,t,i,l,h,d,g,y,b,E,A,M,P,O,z){let j=d.textMaxSize.evaluate(t,{},M);j===void 0&&(j=g);const q=r.layers[0].layout,Q=q.get("icon-offset").evaluate(t,{},M),oe=_3(i.horizontal)||i.vertical,pe=P.name==="globe",de=aa,Ce=g/de,Ee=r.tilePixelRatio*j/de,Le=(wt=r.overscaling,r.zoom>18&&wt>2&&(wt>>=1),Math.max(Kt/(512*wt),1)*q.get("symbol-spacing")),je=q.get("text-padding")*r.tilePixelRatio,Ze=q.get("icon-padding")*r.tilePixelRatio,it=Re(q.get("text-max-angle")),Ye=q.get("text-rotation-alignment")==="map"&&q.get("symbol-placement")!=="point",mt=q.get("icon-rotation-alignment")==="map"&&q.get("symbol-placement")!=="point",bt=q.get("symbol-placement"),ht=Le/2;var wt;const lt=q.get("icon-text-fit").evaluate(t,{},M),vt=q.get("icon-text-fit-padding").evaluate(t,{},M),Gt=lt!=="none";let Tt;r.hasAnyIconTextFit===!1&&Gt&&(r.hasAnyIconTextFit=!0),l&&Gt&&(r.allowVerticalPlacement&&i.vertical&&(Tt=r3(l,i.vertical,lt,vt,Q,Ce)),oe&&(l=r3(l,oe,lt,vt,Q,Ce)));const ar=(Qt,It,vr)=>{if(It.x<0||It.x>=Kt||It.y<0||It.y>=Kt)return;let hr=null;if(pe){const{x:ir,y:Pt,z:gr}=P.projectTilePoint(It.x,It.y,vr);hr={anchor:new ac(ir,Pt,gr,0,void 0),up:P.upVector(vr,It.x,It.y)}}(function(ir,Pt,gr,Vr,wr,$r,kr,Jr,Rr,Rn,hn,pn,xn,fn,Qn,Cn,hi,Pi,Qi,Kn,si,Gi,Hi,Wi,Un,ms,lu){const Na=ir.addToLineVertexArray(Pt,Vr);let ba,Os,bm,Yx,_M,xM,yM,vM=0,wM=0,bM=0,TM=0,nb=-1,ib=-1;const wl={};let EM=W0("");const Bh=gr?gr.anchor:Pt,ab=Rr.layout.get("icon-text-fit").evaluate(si,{},Un)!=="none";let sb=0,ob=0;if(Rr._unevaluatedLayout.getValue("text-radial-offset")===void 0?[sb,ob]=Rr.layout.get("text-offset").evaluate(si,{},Un).map(gs=>gs*aa):(sb=Rr.layout.get("text-radial-offset").evaluate(si,{},Un)*aa,ob=Rw),ir.allowVerticalPlacement&&wr.vertical){const gs=wr.vertical;if(Qn)xM=Fw(gs),Jr&&(yM=Fw(Jr));else{const _s=Rr.layout.get("text-rotate").evaluate(si,{},Un)+90;bm=Ix(Rn,Bh,Pt,hn,pn,xn,gs,fn,_s,Cn),Jr&&(Yx=Ix(Rn,Bh,Pt,hn,pn,xn,Jr,Pi,_s))}}if($r){const gs=Rr.layout.get("icon-rotate").evaluate(si,{},Un),_s=d3($r,gs,Hi,ab),bd=Jr?d3(Jr,gs,Hi,ab):void 0;Os=Ix(Rn,Bh,Pt,hn,pn,xn,$r,Pi,gs),vM=4*_s.length;const SM=ir.iconSizeData;let Uh=null;SM.kind==="source"?(Uh=[Po*Rr.layout.get("icon-size").evaluate(si,{},Un)],Uh[0]>nu&&Tr(`${ir.layerIds[0]}: Value for "icon-size" is >= ${om}. Reduce your "icon-size".`)):SM.kind==="composite"&&(Uh=[Po*Gi.compositeIconSizes[0].evaluate(si,{},Un),Po*Gi.compositeIconSizes[1].evaluate(si,{},Un)],(Uh[0]>nu||Uh[1]>nu)&&Tr(`${ir.layerIds[0]}: Value for "icon-size" is >= ${om}. Reduce your "icon-size".`)),ir.addSymbols(ir.icon,_s,Uh,Kn,Qi,si,!1,gr,Pt,Na.lineStartIndex,Na.lineLength,-1,Wi,Un,ms,lu),nb=ir.icon.placedSymbolArray.length-1,bd&&(wM=4*bd.length,ir.addSymbols(ir.icon,bd,Uh,Kn,Qi,si,Fs.vertical,gr,Pt,Na.lineStartIndex,Na.lineLength,-1,Wi,Un,ms,lu),ib=ir.icon.placedSymbolArray.length-1)}for(const gs in wr.horizontal){const _s=wr.horizontal[gs];ba||(EM=W0(_s.text),Qn?_M=Fw(_s):ba=Ix(Rn,Bh,Pt,hn,pn,xn,_s,fn,Rr.layout.get("text-rotate").evaluate(si,{},Un),Cn));const bd=_s.positionedLines.length===1;if(bM+=g3(ir,gr,Pt,_s,kr,Rr,Qn,si,Cn,Na,wr.vertical?Fs.horizontal:Fs.horizontalOnly,bd?Object.keys(wr.horizontal):[gs],wl,nb,Gi,Wi,Un,ms),bd)break}wr.vertical&&(TM+=g3(ir,gr,Pt,wr.vertical,kr,Rr,Qn,si,Cn,Na,Fs.vertical,["vertical"],wl,ib,Gi,Wi,Un,ms));let cu=-1;const lb=(gs,_s)=>gs?Math.max(gs,_s):_s;cu=lb(_M,cu),cu=lb(xM,cu),cu=lb(yM,cu);const $z=cu>-1?1:0;ir.glyphOffsetArray.length>=65535&&Tr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),si.sortKey!==void 0&&ir.addToSortKeyRanges(ir.symbolInstances.length,si.sortKey),ir.symbolInstances.emplaceBack(Pt.x,Pt.y,Bh.x,Bh.y,Bh.z,wl.right>=0?wl.right:-1,wl.center>=0?wl.center:-1,wl.left>=0?wl.left:-1,wl.vertical>=0?wl.vertical:-1,nb,ib,EM,ba!==void 0?ba:ir.collisionBoxArray.length,ba!==void 0?ba+1:ir.collisionBoxArray.length,bm!==void 0?bm:ir.collisionBoxArray.length,bm!==void 0?bm+1:ir.collisionBoxArray.length,Os!==void 0?Os:ir.collisionBoxArray.length,Os!==void 0?Os+1:ir.collisionBoxArray.length,Yx||ir.collisionBoxArray.length,Yx?Yx+1:ir.collisionBoxArray.length,hn,bM,TM,vM,wM,$z,0,sb,ob,cu,0,ab?1:0)})(r,It,hr,Qt,i,l,h,Tt,r.layers[0],r.collisionBoxArray,t.index,t.sourceLayerIndex,r.index,je,Ye,b,0,Ze,mt,Q,t,d,E,A,M,O,z)};if(bt==="line")for(const Qt of l3(t.geometry,0,0,Kt,Kt)){const It=y6(Qt,Le,it,i.vertical||oe,l,de,Ee,r.overscaling,Kt);for(const vr of It)oe&&S6(r,oe.text,ht,vr)||ar(Qt,vr,M)}else if(bt==="line-center"){for(const Qt of t.geometry)if(Qt.length>1){const It=x6(Qt,it,i.vertical||oe,l,de,Ee);It&&ar(Qt,It,M)}}else if(t.type==="Polygon")for(const Qt of xw(t.geometry,0)){const It=w6(Qt,16);ar(Qt[0],new ac(It.x,It.y,0,0,void 0),M)}else if(t.type==="LineString")for(const Qt of t.geometry)ar(Qt,new ac(Qt[0].x,Qt[0].y,0,0,void 0),M);else if(t.type==="Point")for(const Qt of t.geometry)for(const It of Qt)ar([It],new ac(It.x,It.y,0,0,void 0),M)}const om=255,nu=om*Po;function g3(r,t,i,l,h,d,g,y,b,E,A,M,P,O,z,j,q,Q){const oe=function(Ce,Ee,Le,je,Ze,it,Ye,mt){const bt=[];if(Ee.positionedLines.length===0)return bt;const ht=je.layout.get("text-rotate").evaluate(it,{})*Math.PI/180,wt=function(ar){const Qt=ar[0],It=ar[1],vr=Qt*It;return vr>0?[Qt,-It]:vr<0?[-Qt,It]:Qt===0?[It,Qt]:[It,-Qt]}(Le);let lt=Math.abs(Ee.top-Ee.bottom);for(const ar of Ee.positionedLines)lt-=ar.lineOffset;const vt=Ee.positionedLines.length,Gt=lt/vt;let Tt=Ee.top-Le[1];for(let ar=0;ar<vt;++ar){const Qt=Ee.positionedLines[ar];Tt=v6(Ee,Gt,Tt,ar);for(const It of Qt.positionedGlyphs){if(!It.rect)continue;const vr=It.rect||{};let hr=Yk+1,ir=!0,Pt=1,gr=0;if(It.imageName){const Kn=Ye[It.imageName];if(!Kn)continue;if(Kn.sdf){Tr("SDF images are not supported in formatted text and will be ignored.");continue}ir=!1,Pt=Kn.pixelRatio,hr=ps/Pt}const Vr=(Ze||mt)&&It.vertical,wr=It.metrics.advance*It.scale/2,$r=It.metrics,kr=It.rect;if(kr===null)continue;mt&&Ee.verticalizable&&(gr=It.imageName?wr-It.metrics.width*It.scale/2:0);const Jr=Ze?[It.x+wr,It.y]:[0,0];let Rr=[0,0],Rn=[0,0],hn=!1;Ze||(Vr?(Rn=[It.x+wr+wt[0],It.y+wt[1]-gr],hn=!0):Rr=[It.x+wr+Le[0],It.y+Le[1]-gr]);const pn=kr.w*It.scale/(Pt*(It.localGlyph?Ro:1)),xn=kr.h*It.scale/(Pt*(It.localGlyph?Ro:1));let fn,Qn,Cn,hi;if(Vr){const Kn=It.y-Tt,si=new we(-wr,wr-Kn),Gi=-Math.PI/2,Hi=new we(...Rn);fn=new we(-wr+Rr[0],Rr[1]),fn._rotateAround(Gi,si)._add(Hi),fn.x+=-Kn+wr,fn.y-=($r.left-hr)*It.scale;const Wi=It.imageName?$r.advance*It.scale:aa*It.scale,Un=String.fromCodePoint(It.glyph);e6(Un)?fn.x+=(1-hr)*It.scale:t6(Un)?fn.x+=Wi-$r.height*It.scale+(-hr-1)*It.scale:fn.x+=It.imageName||$r.width+2*hr===kr.w&&$r.height+2*hr===kr.h?(Wi-xn)/2:(Wi-($r.height+2*hr)*It.scale)/2,Qn=new we(fn.x,fn.y-pn),Cn=new we(fn.x+xn,fn.y),hi=new we(fn.x+xn,fn.y-pn)}else{const Kn=($r.left-hr)*It.scale-wr+Rr[0],si=(-$r.top-hr)*It.scale+Rr[1],Gi=Kn+pn,Hi=si+xn;fn=new we(Kn,si),Qn=new we(Gi,si),Cn=new we(Kn,Hi),hi=new we(Gi,Hi)}if(ht){let Kn;Kn=Ze?new we(0,0):hn?new we(wt[0],wt[1]):new we(Le[0],Le[1]),fn._rotateAround(ht,Kn),Qn._rotateAround(ht,Kn),Cn._rotateAround(ht,Kn),hi._rotateAround(ht,Kn)}const Pi=new we(0,0),Qi=new we(0,0);bt.push({tl:fn,tr:Qn,bl:Cn,br:hi,texPrimary:vr,texSecondary:void 0,writingMode:Ee.writingMode,glyphOffset:Jr,sectionIndex:It.sectionIndex,isSDF:ir,pixelOffsetTL:Pi,pixelOffsetBR:Qi,minFontScaleX:0,minFontScaleY:0})}}return bt}(0,l,b,d,g,y,h,r.allowVerticalPlacement),pe=r.textSizeData;let de=null;pe.kind==="source"?(de=[Po*d.layout.get("text-size").evaluate(y,{},q)],de[0]>nu&&Tr(`${r.layerIds[0]}: Value for "text-size" is >= ${om}. Reduce your "text-size".`)):pe.kind==="composite"&&(de=[Po*z.compositeTextSizes[0].evaluate(y,{},q),Po*z.compositeTextSizes[1].evaluate(y,{},q)],(de[0]>nu||de[1]>nu)&&Tr(`${r.layerIds[0]}: Value for "text-size" is >= ${om}. Reduce your "text-size".`)),r.addSymbols(r.text,oe,de,b,g,y,A,t,i,E.lineStartIndex,E.lineLength,O,j,q,Q,!1);for(const Ce of M)P[Ce]=r.text.placedSymbolArray.length-1;return 4*oe.length}function _3(r){for(const t in r)return r[t];return null}function Ix(r,t,i,l,h,d,g,y,b,E){let A=g.top,M=g.bottom,P=g.left,O=g.right;const z=g.collisionPadding;if(z&&(P-=z[0],A-=z[1],O+=z[2],M+=z[3]),b){const j=new we(P,A),q=new we(O,A),Q=new we(P,M),oe=new we(O,M),pe=Re(b);let de=new we(0,0);E&&(de=new we(E[0],E[1])),j._rotateAround(pe,de),q._rotateAround(pe,de),Q._rotateAround(pe,de),oe._rotateAround(pe,de),P=Math.min(j.x,q.x,Q.x,oe.x),O=Math.max(j.x,q.x,Q.x,oe.x),A=Math.min(j.y,q.y,Q.y,oe.y),M=Math.max(j.y,q.y,Q.y,oe.y)}return r.emplaceBack(t.x,t.y,t.z,i.x,i.y,P,A,O,M,y,l,h,d),r.length-1}function Fw(r){r.collisionPadding&&(r.top-=r.collisionPadding[1],r.bottom+=r.collisionPadding[3]);const t=r.bottom-r.top;return t>0?Math.max(10,t):null}function S6(r,t,i,l){const h=r.compareText;if(t in h){const d=h[t];for(let g=d.length-1;g>=0;g--)if(l.dist(d[g])<i)return!0}else h[t]=[];return h[t].push(l),!1}function x3(r,t){const i=r.fovAboveCenter,l=r.elevation?r.elevation.getMinElevationBelowMSL()*t:0,h=(r._camera.position[2]*r.worldSize-l)/Math.cos(r._pitch),d=Math.sin(i)*h/Math.sin(Math.max(Math.PI/2-r._pitch-i,.01)),g=Math.sin(r._pitch)*d+h;return Math.min(1.01*g,h*(1/r._horizonShift))}function lm(r,t){if(!t.isReprojectedInTileSpace)return{scale:1<<r.z,x:r.x,y:r.y,x2:r.x+1,y2:r.y+1,projection:t};const i=Math.pow(2,-r.z),l=r.x*i,h=(r.x+1)*i,d=r.y*i,g=(r.y+1)*i,y=Mr(l),b=Mr(h),E=en(d),A=en(g),M=t.project(y,E),P=t.project(b,E),O=t.project(b,A),z=t.project(y,A);let j=Math.min(M.x,P.x,O.x,z.x),q=Math.min(M.y,P.y,O.y,z.y),Q=Math.max(M.x,P.x,O.x,z.x),oe=Math.max(M.y,P.y,O.y,z.y);const pe=i/16;function de(Ee,Le,je,Ze,it,Ye){const mt=(je+it)/2,bt=(Ze+Ye)/2,ht=t.project(Mr(mt),en(bt)),wt=Math.max(0,j-ht.x,q-ht.y,ht.x-Q,ht.y-oe);j=Math.min(j,ht.x),Q=Math.max(Q,ht.x),q=Math.min(q,ht.y),oe=Math.max(oe,ht.y),wt>pe&&(de(Ee,ht,je,Ze,mt,bt),de(ht,Le,mt,bt,it,Ye))}de(M,P,l,d,h,d),de(P,O,h,d,h,g),de(O,z,h,g,l,g),de(z,M,l,g,l,d),j-=pe,q-=pe,Q+=pe,oe+=pe;const Ce=1/Math.max(Q-j,oe-q);return{scale:Ce,x:j*Ce,y:q*Ce,x2:Q*Ce,y2:oe*Ce,projection:t}}function y3(r,{x:t,y:i},l=0){return new we(((t-l)*r.scale-r.x)*Kt,(i*r.scale-r.y)*Kt)}const A6=o.a6.identity(new Float32Array(16));class iu{constructor(t){this.spec=t,this.name=t.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(t,i){return{x:0,y:0,z:0}}unproject(t,i){return new qe(0,0)}projectTilePoint(t,i,l){return{x:t,y:i,z:0}}locationPoint(t,i,l=!0){return t._coordinatePoint(t.locationCoordinate(i),l)}pixelsPerMeter(t,i){return Pr(1,t)*i}pixelSpaceConversion(t,i,l){return 1}farthestPixelDistance(t){return x3(t,t.pixelsPerMeter)}pointCoordinate(t,i,l,h){const d=t.horizonLineFromTop(!1),g=new we(i,Math.max(d,l));return t.rayIntersectionCoordinate(t.pointRayIntersection(g,h))}pointCoordinate3D(t,i,l){const h=new we(i,l);if(t.elevation)return t.elevation.pointCoordinate(h);{const d=this.pointCoordinate(t,h.x,h.y,0);return[d.x,d.y,d.z]}}isPointAboveHorizon(t,i){if(t.elevation)return!this.pointCoordinate3D(t,i.x,i.y);const l=t.horizonLineFromTop();return i.y<l}createInversionMatrix(t,i){return A6}createTileMatrix(t,i,l){let h,d,g;const y=l.canonical,b=o.a6.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const E=lm(y,this);h=1,d=E.x+l.wrap*E.scale,g=E.y,o.a6.scale(b,b,[h/E.scale,h/E.scale,t.pixelsPerMeter/i])}else h=i/t.zoomScale(y.z),d=(y.x+Math.pow(2,y.z)*l.wrap)*h,g=y.y*h;return o.a6.translate(b,b,[d,g,0]),o.a6.scale(b,b,[h/Kt,h/Kt,1]),b}upVector(t,i,l){return[0,0,1]}upVectorScale(t,i,l){return{metersToTile:1}}}class C6 extends iu{constructor(t){super(t),this.range=[4,7],this.center=t.center||[-96,37.5];const[i,l]=this.parallels=t.parallels||[29.5,45.5],h=Math.sin(Re(i));this.n=(h+Math.sin(Re(l)))/2,this.c=1+h*(2*this.n-h),this.r0=Math.sqrt(this.c)/this.n}project(t,i){const{n:l,c:h,r0:d}=this,g=Re(t-this.center[0]),y=Re(i),b=Math.sqrt(h-2*l*Math.sin(y))/l;return{x:b*Math.sin(g*l),y:b*Math.cos(g*l)-d,z:0}}unproject(t,i){const{n:l,c:h,r0:d}=this,g=d+i;let y=Math.atan2(t,Math.abs(g))*Math.sign(g);g*l<0&&(y-=Math.PI*Math.sign(t)*Math.sign(g));const b=Re(this.center[0])*l;y=Et(y,-Math.PI-b,Math.PI-b);const E=st(St(y/l)+this.center[0],-180,180),A=Math.asin(st((h-(t*t+g*g)*l*l)/(2*l),-1,1)),M=st(St(A),-Wr,Wr);return new qe(E,M)}}const cm=1.340264,um=-.081106,hm=893e-6,fm=.003796,Px=Math.sqrt(3)/2;class k6 extends iu{project(t,i){i=i/180*Math.PI,t=t/180*Math.PI;const l=Math.asin(Px*Math.sin(i)),h=l*l,d=h*h*h;return{x:.5*(t*Math.cos(l)/(Px*(cm+3*um*h+d*(7*hm+9*fm*h)))/Math.PI+.5),y:1-.5*(l*(cm+um*h+d*(hm+fm*h))/Math.PI+1),z:0}}unproject(t,i){t=(2*t-.5)*Math.PI;let l=i=(2*(1-i)-1)*Math.PI,h=l*l,d=h*h*h;for(let A,M,P,O=0;O<12&&(M=l*(cm+um*h+d*(hm+fm*h))-i,P=cm+3*um*h+d*(7*hm+9*fm*h),A=M/P,l=st(l-A,-Math.PI/3,Math.PI/3),h=l*l,d=h*h*h,!(Math.abs(A)<1e-12));++O);const g=Px*t*(cm+3*um*h+d*(7*hm+9*fm*h))/Math.cos(l),y=Math.asin(Math.sin(l)/Px),b=st(180*g/Math.PI,-180,180),E=st(180*y/Math.PI,-Wr,Wr);return new qe(b,E)}}class M6 extends iu{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0}project(t,i){return{x:.5+t/360,y:.5-i/360,z:0}}unproject(t,i){const l=360*(t-.5),h=st(360*(.5-i),-Wr,Wr);return new qe(l,h)}}const md=Math.PI/2;function Rx(r){return Math.tan((md+r)/2)}class I6 extends iu{constructor(t){super(t),this.center=t.center||[0,30];const[i,l]=this.parallels=t.parallels||[30,30];let h=Re(i),d=Re(l);this.southernCenter=h+d<0,this.southernCenter&&(h=-h,d=-d);const g=Math.cos(h),y=Rx(h);this.n=h===d?Math.sin(h):Math.log(g/Math.cos(d))/Math.log(Rx(d)/y),this.f=g*Math.pow(Rx(h),this.n)/this.n}project(t,i){i=Re(i),this.southernCenter&&(i=-i),t=Re(t-this.center[0]);const l=1e-6,{n:h,f:d}=this;d>0?i<-md+l&&(i=-md+l):i>md-l&&(i=md-l);const g=d/Math.pow(Rx(i),h);let y=g*Math.sin(h*t),b=d-g*Math.cos(h*t);return y=.5*(y/Math.PI+.5),b=.5*(b/Math.PI+.5),{x:y,y:this.southernCenter?b:1-b,z:0}}unproject(t,i){t=(2*t-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:l,f:h}=this,d=h-i,g=Math.sign(d),y=Math.sign(l)*Math.sqrt(t*t+d*d);let b=Math.atan2(t,Math.abs(d))*g;d*l<0&&(b-=Math.PI*Math.sign(t)*g);const E=st(St(b/l)+this.center[0],-180,180),A=st(St(2*Math.atan(Math.pow(h/y,1/l))-md),-Wr,Wr);return new qe(E,this.southernCenter?-A:A)}}class v3 extends iu{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(t,i){return{x:zr(t),y:Sr(i),z:0}}unproject(t,i){const l=Mr(t),h=en(i);return new qe(l,h)}}const w3=Re(Wr);class P6 extends iu{project(t,i){const l=(i=Re(i))*i,h=l*l;return{x:.5*((t=Re(t))*(.8707-.131979*l+h*(h*(.003971*l-.001529*h)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+l*(.015085+h*(.028874*l-.044475-.005916*h)))/Math.PI+1),z:0}}unproject(t,i){t=(2*t-.5)*Math.PI;let l=i=(2*(1-i)-1)*Math.PI,h=25,d=0,g=l*l;do{g=l*l;const E=g*g;d=(l*(1.007226+g*(.015085+E*(.028874*g-.044475-.005916*E)))-i)/(1.007226+g*(.045255+E*(.259866*g-.311325-.005916*11*E))),l=st(l-d,-w3,w3)}while(Math.abs(d)>1e-6&&--h>0);g=l*l;const y=st(St(t/(.8707+g*(g*(g*g*g*(.003971-.001529*g)-.013791)-.131979))),-180,180),b=St(l);return new qe(y,b)}}const b3=Re(Wr);class R6 extends iu{project(t,i){i=Re(i),t=Re(t);const l=Math.cos(i),h=2/Math.PI,d=Math.acos(l*Math.cos(t/2)),g=Math.sin(d)/d,y=.5*(t*h+2*l*Math.sin(t/2)/g)||0,b=.5*(i+Math.sin(i)/g)||0;return{x:.5*(y/Math.PI+.5),y:1-.5*(b/Math.PI+1),z:0}}unproject(t,i){let l=t=(2*t-.5)*Math.PI,h=i=(2*(1-i)-1)*Math.PI,d=25;const g=1e-6;let y=0,b=0;do{const E=Math.cos(h),A=Math.sin(h),M=2*A*E,P=A*A,O=E*E,z=Math.cos(l/2),j=Math.sin(l/2),q=2*z*j,Q=j*j,oe=1-O*z*z,pe=oe?1/oe:0,de=oe?Math.acos(E*z)*Math.sqrt(1/oe):0,Ce=.5*(2*de*E*j+2*l/Math.PI)-t,Ee=.5*(de*A+h)-i,Le=.5*pe*(O*Q+de*E*z*P)+1/Math.PI,je=pe*(q*M/4-de*A*j),Ze=.125*pe*(M*j-de*A*O*q),it=.5*pe*(P*z+de*Q*E)+.5,Ye=je*Ze-it*Le;y=(Ee*je-Ce*it)/Ye,b=(Ce*Ze-Ee*Le)/Ye,l=st(l-y,-Math.PI,Math.PI),h=st(h-b,-b3,b3)}while((Math.abs(y)>g||Math.abs(b)>g)&&--d>0);return new qe(St(l),St(h))}}class T3 extends iu{constructor(t){super(t),this.center=t.center||[0,0],this.parallels=t.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Re(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(t,i){const{scale:l,cosPhi:h}=this;return{x:Re(t)*h*l+.5,y:-Math.sin(Re(i))/h*l+.5,z:0}}unproject(t,i){const{scale:l,cosPhi:h}=this,d=-(i-.5)/l,g=st(St((t-.5)/l)/h,-180,180),y=Math.asin(st(d*h,-1,1)),b=st(St(y),-Wr,Wr);return new qe(g,b)}}class D6 extends v3{constructor(t){super(t),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(t,i,l){const h=Y0(t,i,l),d=ux(vl(l));return o.N.transformMat4(h,h,d),{x:h[0],y:h[1],z:h[2]}}locationPoint(t,i){const l=ft(i.lat,i.lng),h=o.N.normalize([],l),d=t.elevation?t.elevation.getAtPointOrZero(t.locationCoordinate(i),t._centerAltitude):t._centerAltitude,g=Pr(1,0)*Kt*d;o.N.scaleAndAdd(l,l,h,g);const y=o.a6.identity(new Float64Array(16));return o.a6.multiply(y,t.pixelMatrix,t.globeMatrix),o.N.transformMat4(l,l,y),new we(l[0],l[1])}pixelsPerMeter(t,i){return Pr(1,0)*i}pixelSpaceConversion(t,i,l){const h=Pr(1,t)*i,d=Kr(Pr(1,45)*i,h,l);return this.pixelsPerMeter(t,i)/d}createTileMatrix(t,i,l){const h=uw(vl(l.canonical));return o.a6.multiply(new Float64Array(16),t.globeMatrix,h)}createInversionMatrix(t,i){const{center:l}=t,h=ux(vl(i));return o.a6.rotateY(h,h,Re(l.lng)),o.a6.rotateX(h,h,Re(l.lat)),o.a6.scale(h,h,[t._pixelsPerMercatorPixel,t._pixelsPerMercatorPixel,1]),Float32Array.from(h)}pointCoordinate(t,i,l,h){return UC(t,i,l,!0)||new sn(0,0)}pointCoordinate3D(t,i,l){const h=this.pointCoordinate(t,i,l,0);return[h.x,h.y,h.z]}isPointAboveHorizon(t,i){return!UC(t,i.x,i.y,!1)}farthestPixelDistance(t){const i=function(h,d){const g=h.cameraToCenterDistance,y=h._centerAltitude*d,b=h._camera,E=h._camera.forward(),A=o.N.add([],o.N.scale([],E,-g),[0,0,y]),M=h.worldSize/(2*Math.PI),P=[0,0,-M],O=h.width/h.height,z=Math.tan(h.fovAboveCenter),j=o.N.scale([],b.up(),z),q=o.N.scale([],b.right(),z*O),Q=o.N.normalize([],o.N.add([],o.N.add([],E,j),q)),oe=[];let pe;if(new aw(A,Q).closestPointOnSphere(P,M,oe)){const de=o.N.add([],oe,P),Ce=o.N.sub([],de,A);pe=Math.cos(h.fovAboveCenter)*o.N.length(Ce)}else{const de=o.N.sub([],A,P),Ce=o.N.sub([],P,A);o.N.normalize(Ce,Ce);const Ee=o.N.length(de)-M;pe=Math.sqrt(Ee*(Ee+2*M));const Le=Math.acos(pe/(M+Ee))-Math.acos(o.N.dot(E,Ce));pe*=Math.cos(Le)}return 1.01*pe}(t,this.pixelsPerMeter(t.center.lat,t.worldSize)),l=Jc(t.zoom);if(l>0){const h=x3(t,Pr(1,t.center.lat)*t.worldSize),d=t.worldSize/(2*Math.PI),g=Math.max(t.width,t.height)/t.worldSize*Math.PI;return Kr(i,h+d*(1-Math.cos(g)),Math.pow(l,10))}return i}upVector(t,i,l){return Y0(i,l,t,1)}upVectorScale(t){return{metersToTile:ox(cx(vl(t)))}}}function E3(r){const t=r.parallels,i=!!t&&Math.abs(t[0]+t[1])<.01;switch(r.name){case"mercator":return new v3(r);case"equirectangular":return new M6(r);case"naturalEarth":return new P6(r);case"equalEarth":return new k6(r);case"winkelTripel":return new R6(r);case"albers":return i?new T3(r):new C6(r);case"lambertConformalConic":return i?new T3(r):new I6(r);case"globe":return new D6(r)}throw new Error(`Invalid projection name: ${r.name}`)}const F6=_x.types,L6=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Dx(r,t,i,l,h,d,g,y,b,E,A,M,P){const O=y?Math.min(nu,Math.round(y[0])):0,z=y?Math.min(nu,Math.round(y[1])):0;r.emplaceBack(t,i,Math.round(32*l),Math.round(32*h),d,g,(O<<1)+(b?1:0),z,16*E,16*A,256*M,256*P)}function Fx(r,t,i){r.emplaceBack(t,i)}function Lx(r,t,i,l,h,d,g){r.emplaceBack(t,i,l,h,d,g)}function Ox(r,t,i,l,h){r.emplaceBack(t,i,l,h),r.emplaceBack(t,i,l,h),r.emplaceBack(t,i,l,h),r.emplaceBack(t,i,l,h)}function O6(r){for(const t of r.sections)if(v0(t.text))return!0;return!1}class Lw{constructor(t){this.layoutVertexArray=new vh,this.indexArray=new Oi,this.programConfigurations=t,this.segments=new ui,this.dynamicLayoutVertexArray=new dl,this.opacityVertexArray=new N0,this.placedSymbolArray=new $_,this.iconTransitioningVertexArray=new Js,this.globeExtVertexArray=new O0,this.zOffsetVertexArray=new bh}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(t,i,l,h,d){this.isEmpty()||(l&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,GN.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,WN.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,L6,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=t.createVertexBuffer(this.iconTransitioningVertexArray,ZN.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,HN.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||d)&&(this.zOffsetVertexBuffer=t.createVertexBuffer(this.zOffsetVertexArray,qN.members,!0)),this.opacityVertexBuffer.itemSize=1),(l||h)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}rr(Lw,"SymbolBuffers");class Ow{constructor(t,i,l){this.layoutVertexArray=new t,this.layoutAttributes=i,this.indexArray=new l,this.segments=new ui,this.collisionVertexArray=new B0,this.collisionVertexArrayExt=new dl}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,XN.members,!0),this.collisionVertexBufferExt=t.createVertexBuffer(this.collisionVertexArrayExt,YN.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}rr(Ow,"CollisionBuffers");class Nx{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(g=>g.fqid),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=o.a6.identity([]),this.placementViewportMatrix=o.a6.identity([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Sw(this.zoom,i["text-size"]),this.iconSizeData=Sw(this.zoom,i["icon-size"]);const l=this.layers[0].layout,h=l.get("symbol-sort-key"),d=l.get("symbol-z-order");this.canOverlap=l.get("text-allow-overlap")||l.get("icon-allow-overlap")||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey=d!=="viewport-y"&&h.constantOr(1)!==void 0,this.sortFeaturesByY=(d==="viewport-y"||d==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=l.get("text-writing-mode").map(g=>Fs[g]),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.sourceID=t.sourceID,this.projection=t.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=l.get("symbol-z-elevate")}createArrays(){this.text=new Lw(new te(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new Lw(new te(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new H_,this.lineVertexArray=new Ah,this.symbolInstances=new G_}calculateGlyphDependencies(t,i,l,h,d){for(let g=0;g<t.length;g++){const y=t.codePointAt(g);if(y===void 0)break;if(i[y]=!0,h&&d&&y<=65535){const b=im[t.charAt(g)];b&&(i[b.charCodeAt(0)]=!0)}}}populate(t,i,l,h){const d=this.layers[0],g=d.layout,y=this.projection.name==="globe",b=g.get("text-font"),E=g.get("text-field"),A=g.get("icon-image"),M=(E.value.kind!=="constant"||E.value.value instanceof Yi&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),P=A.value.kind!=="constant"||!!A.value.value||Object.keys(A.parameters).length>0,O=g.get("symbol-sort-key");if(this.features=[],!M&&!P)return;const z=i.iconDependencies,j=i.glyphDependencies,q=i.availableImages,Q=new ri(this.zoom);for(const{feature:oe,id:pe,index:de,sourceLayerIndex:Ce}of t){const Ee=d._featureFilter.needGeometry,Le=Ai(oe,Ee);if(!d._featureFilter.filter(Q,Le,l))continue;if(Ee||(Le.geometry=zi(oe,l,h)),y&&oe.type!==1&&l.z<=5){const Ye=Le.geometry,mt=.98078528056,bt=(ht,wt)=>{const lt=Y0(ht.x,ht.y,l,1),vt=Y0(wt.x,wt.y,l,1);return o.N.dot(lt,vt)<mt};for(let ht=0;ht<Ye.length;ht++)Ye[ht]=Ji(Ye[ht],bt)}let je,Ze;if(M){const Ye=d.getValueAndResolveTokens("text-field",Le,l,q),mt=Yi.factory(Ye);O6(mt)&&(this.hasRTLText=!0),(!this.hasRTLText||fl()==="unavailable"||this.hasRTLText&&Ya.isParsed())&&(je=QN(mt,d,Le))}if(P){const Ye=d.getValueAndResolveTokens("icon-image",Le,l,q);Ze=Ye instanceof xr?Ye:xr.fromString(Ye)}if(!je&&!Ze)continue;const it=this.sortFeaturesByKey?O.evaluate(Le,{},l):void 0;if(this.features.push({id:pe,text:je,icon:Ze,index:de,sourceLayerIndex:Ce,geometry:Le.geometry,properties:oe.properties,type:F6[oe.type],sortKey:it}),Ze&&(z[Ze.namePrimary]=!0,Ze.nameSecondary&&(z[Ze.nameSecondary]=!0)),je){const Ye=b.evaluate(Le,{},l).join(","),mt=g.get("text-rotation-alignment")==="map"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Fs.vertical)>=0;for(const bt of je.sections)if(bt.image)z[bt.image.namePrimary]=!0;else{const ht=ul(je.toString()),wt=bt.fontStack||Ye,lt=j[wt]=j[wt]||{};this.calculateGlyphDependencies(bt.text,lt,mt,this.allowVerticalPlacement,ht)}}}g.get("symbol-placement")==="line"&&(this.features=function(oe){const pe={},de={},Ce=[];let Ee=0;function Le(Ye){Ce.push(oe[Ye]),Ee++}function je(Ye,mt,bt){const ht=de[Ye];return delete de[Ye],de[mt]=ht,Ce[ht].geometry[0].pop(),Ce[ht].geometry[0]=Ce[ht].geometry[0].concat(bt[0]),ht}function Ze(Ye,mt,bt){const ht=pe[mt];return delete pe[mt],pe[Ye]=ht,Ce[ht].geometry[0].shift(),Ce[ht].geometry[0]=bt[0].concat(Ce[ht].geometry[0]),ht}function it(Ye,mt,bt){const ht=bt?mt[0][mt[0].length-1]:mt[0][0];return`${Ye}:${ht.x}:${ht.y}`}for(let Ye=0;Ye<oe.length;Ye++){const mt=oe[Ye],bt=mt.geometry,ht=mt.text?mt.text.toString():null;if(!ht){Le(Ye);continue}const wt=it(ht,bt),lt=it(ht,bt,!0);if(wt in de&&lt in pe&&de[wt]!==pe[lt]){const vt=Ze(wt,lt,bt),Gt=je(wt,lt,Ce[vt].geometry);delete pe[wt],delete de[lt],de[it(ht,Ce[Gt].geometry,!0)]=Gt,Ce[vt].geometry=null}else wt in de?je(wt,lt,bt):lt in pe?Ze(wt,lt,bt):(Le(Ye),pe[wt]=Ee-1,de[lt]=Ee-1)}return Ce.filter(Ye=>Ye.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((oe,pe)=>oe.sortKey-pe.sortKey)}update(t,i,l,h,d){const g=Object.keys(t).length!==0;if(g&&!this.stateDependentLayers.length)return;const y=g?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(t,i,y,l,h,d),this.icon.programConfigurations.updatePaintArrays(t,i,y,l,h,d)}updateZOffset(){const t=(d,g,y)=>{l+=g,l>d.length&&d.resize(l);for(let b=-g;b<0;b++)d.emplace(b+l,y)},i=(d,g,y)=>{h+=g,h>d.length&&d.resize(h);for(let b=-g;b<0;b++)d.emplace(b+h,y)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let l=0,h=0;for(let d=0;d<this.symbolInstances.length;d++){const g=this.symbolInstances.get(d),{numHorizontalGlyphVertices:y,numVerticalGlyphVertices:b,numIconVertices:E}=g,A=g.zOffset,M=E>0;if((y>0||b>0)&&(t(this.text.zOffsetVertexArray,y,A),t(this.text.zOffsetVertexArray,b,A)),M){const{placedIconSymbolIndex:P,verticalPlacedIconSymbolIndex:O}=g;P>=0&&i(this.icon.zOffsetVertexArray,E,A),O>=0&&i(this.icon.zOffsetVertexArray,g.numVerticalIconVertices,A)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=E3(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,i){const l=this.lineVertexArray.length;if(t.segment!==void 0)for(const{x:h,y:d}of i)this.lineVertexArray.emplaceBack(h,d);return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}}addSymbols(t,i,l,h,d,g,y,b,E,A,M,P,O,z,j,q){const Q=t.indexArray,oe=t.layoutVertexArray,pe=t.globeExtVertexArray,de=t.segments.prepareSegment(4*i.length,oe,Q,this.canOverlap?g.sortKey:void 0),Ce=this.glyphOffsetArray.length,Ee=de.vertexLength,Le=this.allowVerticalPlacement&&y===Fs.vertical?Math.PI/2:0,je=g.text&&g.text.sections;for(let it=0;it<i.length;it++){const{tl:Ye,tr:mt,bl:bt,br:ht,texPrimary:wt,texSecondary:lt,pixelOffsetTL:vt,pixelOffsetBR:Gt,minFontScaleX:Tt,minFontScaleY:ar,glyphOffset:Qt,isSDF:It,sectionIndex:vr}=i[it],hr=de.vertexLength,ir=Qt[1];if(Dx(oe,E.x,E.y,Ye.x,ir+Ye.y,wt.x,wt.y,l,It,vt.x,vt.y,Tt,ar),Dx(oe,E.x,E.y,mt.x,ir+mt.y,wt.x+wt.w,wt.y,l,It,Gt.x,vt.y,Tt,ar),Dx(oe,E.x,E.y,bt.x,ir+bt.y,wt.x,wt.y+wt.h,l,It,vt.x,Gt.y,Tt,ar),Dx(oe,E.x,E.y,ht.x,ir+ht.y,wt.x+wt.w,wt.y+wt.h,l,It,Gt.x,Gt.y,Tt,ar),b){const{x:Pt,y:gr,z:Vr}=b.anchor,[wr,$r,kr]=b.up;Lx(pe,Pt,gr,Vr,wr,$r,kr),Lx(pe,Pt,gr,Vr,wr,$r,kr),Lx(pe,Pt,gr,Vr,wr,$r,kr),Lx(pe,Pt,gr,Vr,wr,$r,kr),Ox(t.dynamicLayoutVertexArray,Pt,gr,Vr,Le)}else Ox(t.dynamicLayoutVertexArray,E.x,E.y,E.z,Le);if(q){const Pt=lt||wt;Fx(t.iconTransitioningVertexArray,Pt.x,Pt.y),Fx(t.iconTransitioningVertexArray,Pt.x+Pt.w,Pt.y),Fx(t.iconTransitioningVertexArray,Pt.x,Pt.y+Pt.h),Fx(t.iconTransitioningVertexArray,Pt.x+Pt.w,Pt.y+Pt.h)}Q.emplaceBack(hr,hr+1,hr+2),Q.emplaceBack(hr+1,hr+2,hr+3),de.vertexLength+=4,de.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Qt[0]),it!==i.length-1&&vr===i[it+1].sectionIndex||t.programConfigurations.populatePaintArrays(oe.length,g,g.index,{},O,z,j,je&&je[vr])}const Ze=b?b.anchor:E;t.placedSymbolArray.emplaceBack(Ze.x,Ze.y,Ze.z,E.x,E.y,Ce,this.glyphOffsetArray.length-Ce,Ee,A,M,E.segment,l?l[0]:0,l?l[1]:0,h[0],h[1],y,0,!1,0,P,0)}_commitLayoutVertex(t,i,l,h,d,g,y){t.emplaceBack(i,l,h,d,g,Math.round(y.x),Math.round(y.y))}_addCollisionDebugVertices(t,i,l,h,d,g,y){const b=l.segments.prepareSegment(4,l.layoutVertexArray,l.indexArray),E=b.vertexLength,A=y.tileAnchorX,M=y.tileAnchorY;for(let O=0;O<4;O++)l.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(l.collisionVertexArrayExt,i,t.padding,y.zOffset),this._commitLayoutVertex(l.layoutVertexArray,h,d,g,A,M,new we(t.x1,t.y1)),this._commitLayoutVertex(l.layoutVertexArray,h,d,g,A,M,new we(t.x2,t.y1)),this._commitLayoutVertex(l.layoutVertexArray,h,d,g,A,M,new we(t.x2,t.y2)),this._commitLayoutVertex(l.layoutVertexArray,h,d,g,A,M,new we(t.x1,t.y2)),b.vertexLength+=4;const P=l.indexArray;P.emplaceBack(E,E+1),P.emplaceBack(E+1,E+2),P.emplaceBack(E+2,E+3),P.emplaceBack(E+3,E),b.primitiveLength+=4}_addTextDebugCollisionBoxes(t,i,l,h,d,g){for(let y=h;y<d;y++){const b=l.get(y),E=this.getSymbolInstanceTextSize(t,g,i,y);this._addCollisionDebugVertices(b,E,this.textCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,g)}}_addIconDebugCollisionBoxes(t,i,l,h,d,g){for(let y=h;y<d;y++){const b=l.get(y),E=this.getSymbolInstanceIconSize(t,i,g.placedIconSymbolIndex);this._addCollisionDebugVertices(b,E,this.iconCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,g)}}generateCollisionDebugBuffers(t,i){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Ow(wh,Gk.members,Js),this.iconCollisionBox=new Ow(wh,Gk.members,Js);const l=ld(this.iconSizeData,t),h=ld(this.textSizeData,t);for(let d=0;d<this.symbolInstances.length;d++){const g=this.symbolInstances.get(d);this._addTextDebugCollisionBoxes(h,t,i,g.textBoxStartIndex,g.textBoxEndIndex,g),this._addTextDebugCollisionBoxes(h,t,i,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g),this._addIconDebugCollisionBoxes(l,t,i,g.iconBoxStartIndex,g.iconBoxEndIndex,g),this._addIconDebugCollisionBoxes(l,t,i,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex,g)}}getSymbolInstanceTextSize(t,i,l,h){const d=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:h),g=Tx(this.textSizeData,t,d)/aa;return this.tilePixelRatio*g}getSymbolInstanceIconSize(t,i,l){const h=this.icon.placedSymbolArray.get(l),d=Tx(this.iconSizeData,t,h);return this.tilePixelRatio*d}_commitDebugCollisionVertexUpdate(t,i,l,h){t.emplaceBack(i,-l,-l,h),t.emplaceBack(i,l,-l,h),t.emplaceBack(i,l,l,h),t.emplaceBack(i,-l,l,h)}_updateTextDebugCollisionBoxes(t,i,l,h,d,g){for(let y=h;y<d;y++){const b=l.get(y),E=this.getSymbolInstanceTextSize(t,g,i,y);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,E,b.padding,g.zOffset)}}_updateIconDebugCollisionBoxes(t,i,l,h,d,g){for(let y=h;y<d;y++){const b=l.get(y),E=this.getSymbolInstanceIconSize(t,i,g.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,E,b.padding,g.zOffset)}}updateCollisionDebugBuffers(t,i){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const l=ld(this.iconSizeData,t),h=ld(this.textSizeData,t);for(let d=0;d<this.symbolInstances.length;d++){const g=this.symbolInstances.get(d);this._updateTextDebugCollisionBoxes(h,t,i,g.textBoxStartIndex,g.textBoxEndIndex,g),this._updateTextDebugCollisionBoxes(h,t,i,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g),this._updateIconDebugCollisionBoxes(l,t,i,g.iconBoxStartIndex,g.iconBoxEndIndex,g),this._updateIconDebugCollisionBoxes(l,t,i,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex,g)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(t,i,l,h,d,g,y,b,E){const A={};if(i<l){const{x1:M,y1:P,x2:O,y2:z,padding:j,projectedAnchorX:q,projectedAnchorY:Q,projectedAnchorZ:oe,tileAnchorX:pe,tileAnchorY:de,featureIndex:Ce}=t.get(i);A.textBox={x1:M,y1:P,x2:O,y2:z,padding:j,projectedAnchorX:q,projectedAnchorY:Q,projectedAnchorZ:oe,tileAnchorX:pe,tileAnchorY:de},A.textFeatureIndex=Ce}if(h<d){const{x1:M,y1:P,x2:O,y2:z,padding:j,projectedAnchorX:q,projectedAnchorY:Q,projectedAnchorZ:oe,tileAnchorX:pe,tileAnchorY:de,featureIndex:Ce}=t.get(h);A.verticalTextBox={x1:M,y1:P,x2:O,y2:z,padding:j,projectedAnchorX:q,projectedAnchorY:Q,projectedAnchorZ:oe,tileAnchorX:pe,tileAnchorY:de},A.verticalTextFeatureIndex=Ce}if(g<y){const{x1:M,y1:P,x2:O,y2:z,padding:j,projectedAnchorX:q,projectedAnchorY:Q,projectedAnchorZ:oe,tileAnchorX:pe,tileAnchorY:de,featureIndex:Ce}=t.get(g);A.iconBox={x1:M,y1:P,x2:O,y2:z,padding:j,projectedAnchorX:q,projectedAnchorY:Q,projectedAnchorZ:oe,tileAnchorX:pe,tileAnchorY:de},A.iconFeatureIndex=Ce}if(b<E){const{x1:M,y1:P,x2:O,y2:z,padding:j,projectedAnchorX:q,projectedAnchorY:Q,projectedAnchorZ:oe,tileAnchorX:pe,tileAnchorY:de,featureIndex:Ce}=t.get(b);A.verticalIconBox={x1:M,y1:P,x2:O,y2:z,padding:j,projectedAnchorX:q,projectedAnchorY:Q,projectedAnchorZ:oe,tileAnchorX:pe,tileAnchorY:de},A.verticalIconFeatureIndex=Ce}return A}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const l=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(t,i){const l=t.placedSymbolArray.get(i),h=l.vertexStartIndex+4*l.numGlyphs;for(let d=l.vertexStartIndex;d<h;d+=4)t.indexArray.emplaceBack(d,d+1,d+2),t.indexArray.emplaceBack(d+1,d+2,d+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(t),l=Math.cos(t),h=[],d=[],g=[];for(let y=0;y<this.symbolInstances.length;++y){g.push(y);const b=this.symbolInstances.get(y);h.push(0|Math.round(i*b.tileAnchorX+l*b.tileAnchorY)),d.push(b.featureIndex)}return g.sort((y,b)=>h[y]-h[b]||d[b]-d[y]),g}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let t=0;t<this.symbolInstances.length;++t)this.symbolInstanceIndexesSortedZOffset.push(t)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((t,i)=>this.symbolInstances.get(i).zOffset-this.symbolInstances.get(t).zOffset)}addToSortKeyRanges(t,i){const l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===i?l.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const l=this.symbolInstances.get(i);this.featureSortOrder.push(l.featureIndex);const{rightJustifiedTextSymbolIndex:h,centerJustifiedTextSymbolIndex:d,leftJustifiedTextSymbolIndex:g,verticalPlacedTextSymbolIndex:y,placedIconSymbolIndex:b,verticalPlacedIconSymbolIndex:E}=l;h>=0&&this.addIndicesForPlacedSymbol(this.text,h),d>=0&&d!==h&&this.addIndicesForPlacedSymbol(this.text,d),g>=0&&g!==d&&g!==h&&this.addIndicesForPlacedSymbol(this.text,g),y>=0&&this.addIndicesForPlacedSymbol(this.text,y),b>=0&&this.addIndicesForPlacedSymbol(this.icon,b),E>=0&&this.addIndicesForPlacedSymbol(this.icon,E)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}rr(Nx,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Nx.addDynamicAttributes=Ox;const N6=new ni({"symbol-placement":new jt(tt.layout_symbol["symbol-placement"]),"symbol-spacing":new jt(tt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new jt(tt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new mr(tt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new jt(tt.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new jt(tt.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new jt(tt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new jt(tt.layout_symbol["icon-ignore-placement"]),"icon-optional":new jt(tt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new jt(tt.layout_symbol["icon-rotation-alignment"]),"icon-size":new mr(tt.layout_symbol["icon-size"]),"icon-text-fit":new mr(tt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new mr(tt.layout_symbol["icon-text-fit-padding"]),"icon-image":new mr(tt.layout_symbol["icon-image"]),"icon-rotate":new mr(tt.layout_symbol["icon-rotate"]),"icon-padding":new jt(tt.layout_symbol["icon-padding"]),"icon-keep-upright":new jt(tt.layout_symbol["icon-keep-upright"]),"icon-offset":new mr(tt.layout_symbol["icon-offset"]),"icon-anchor":new mr(tt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new jt(tt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new jt(tt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new jt(tt.layout_symbol["text-rotation-alignment"]),"text-field":new mr(tt.layout_symbol["text-field"]),"text-font":new mr(tt.layout_symbol["text-font"]),"text-size":new mr(tt.layout_symbol["text-size"]),"text-max-width":new mr(tt.layout_symbol["text-max-width"]),"text-line-height":new mr(tt.layout_symbol["text-line-height"]),"text-letter-spacing":new mr(tt.layout_symbol["text-letter-spacing"]),"text-justify":new mr(tt.layout_symbol["text-justify"]),"text-radial-offset":new mr(tt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new jt(tt.layout_symbol["text-variable-anchor"]),"text-anchor":new mr(tt.layout_symbol["text-anchor"]),"text-max-angle":new jt(tt.layout_symbol["text-max-angle"]),"text-writing-mode":new jt(tt.layout_symbol["text-writing-mode"]),"text-rotate":new mr(tt.layout_symbol["text-rotate"]),"text-padding":new jt(tt.layout_symbol["text-padding"]),"text-keep-upright":new jt(tt.layout_symbol["text-keep-upright"]),"text-transform":new mr(tt.layout_symbol["text-transform"]),"text-offset":new mr(tt.layout_symbol["text-offset"]),"text-allow-overlap":new jt(tt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new jt(tt.layout_symbol["text-ignore-placement"]),"text-optional":new jt(tt.layout_symbol["text-optional"]),visibility:new jt(tt.layout_symbol.visibility)});var Nw={paint:new ni({"icon-opacity":new mr(tt.paint_symbol["icon-opacity"]),"icon-emissive-strength":new mr(tt.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new mr(tt.paint_symbol["text-emissive-strength"]),"icon-color":new mr(tt.paint_symbol["icon-color"]),"icon-halo-color":new mr(tt.paint_symbol["icon-halo-color"]),"icon-halo-width":new mr(tt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new mr(tt.paint_symbol["icon-halo-blur"]),"icon-translate":new jt(tt.paint_symbol["icon-translate"]),"icon-translate-anchor":new jt(tt.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new mr(tt.paint_symbol["icon-image-cross-fade"]),"text-opacity":new mr(tt.paint_symbol["text-opacity"]),"text-color":new mr(tt.paint_symbol["text-color"],{runtimeType:us,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new mr(tt.paint_symbol["text-halo-color"]),"text-halo-width":new mr(tt.paint_symbol["text-halo-width"]),"text-halo-blur":new mr(tt.paint_symbol["text-halo-blur"]),"text-translate":new jt(tt.paint_symbol["text-translate"]),"text-translate-anchor":new jt(tt.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new jt(tt.paint_symbol["icon-color-saturation"])}),layout:N6};class S3{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:Cc,this.defaultValue=t}evaluate(t){if(t.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(t.formattedSection))return i.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}rr(S3,"FormatSectionOverride",{omit:["defaultValue"]});class zx extends Da{constructor(t,i,l){super(t,Nw,i,l)}recalculate(t,i){super.recalculate(t,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const l=this.layout.get("text-writing-mode");if(l){const h=[];for(const d of l)h.indexOf(d)<0&&h.push(d);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(t,i,l,h){const d=this.layout.get(t).evaluate(i,{},l,h),g=this._unevaluatedLayout._values[t];return g.isDataDriven()||oh(g.value)||!d?d:function(y,b){return b.replace(/{([^{}]+)}/g,(E,A)=>A in y?String(y[A]):"")}(i.properties,d)}createBucket(t){return new Nx(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const t of Nw.paint.overridableProperties){if(!zx.hasPaintOverride(this.layout,t))continue;const i=this.paint.get(t),l=new S3(i),h=new $f(l,i.property.specification,this.scope,this.options);let d=null;d=i.value.kind==="constant"||i.value.kind==="source"?new x0("source",h):new lh("composite",h,i.value.zoomStops,i.value._interpolationType),this.paint._values[t]=new Wc(i.property,d,i.parameters)}}_handleOverridablePaintPropertyUpdate(t,i,l){return!(!this.layout||i.isDataDriven()||l.isDataDriven())&&zx.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,i){const l=t.get("text-field"),h=Nw.paint.properties[i];let d=!1;const g=y=>{for(const b of y)if(h.overrides&&h.overrides.hasOverride(b))return void(d=!0)};if(l.value.kind==="constant"&&l.value.value instanceof Yi)g(l.value.value.sections);else if(l.value.kind==="source"){const y=E=>{d||(E instanceof vo&&Ei(E.value)===Mc?g(E.value.sections):E instanceof Pc?g(E.sections):E.eachChild(y))},b=l.value;b._styleExpression&&y(b._styleExpression.expression)}return d}getProgramIds(){const t=this.paint.get("icon-opacity").constantOr(1)!==0,i=this.paint.get("text-opacity").constantOr(1)!==0,l=[];return t&&l.push("symbolIcon"),i&&l.push("symbolSDF"),l}getDefaultProgramParams(t,i){return{config:new W(this,i),overrideFog:!1}}}const z6=new ni({visibility:new jt(tt.layout_background.visibility)});var B6={paint:new ni({"background-color":new jt(tt.paint_background["background-color"]),"background-pattern":new jt(tt.paint_background["background-pattern"]),"background-opacity":new jt(tt.paint_background["background-opacity"]),"background-emissive-strength":new jt(tt.paint_background["background-emissive-strength"])}),layout:z6};const U6=new ni({visibility:new jt(tt.layout_raster.visibility)});var V6={paint:new ni({"raster-opacity":new jt(tt.paint_raster["raster-opacity"]),"raster-color":new Yl(tt.paint_raster["raster-color"]),"raster-color-mix":new jt(tt.paint_raster["raster-color-mix"]),"raster-color-range":new jt(tt.paint_raster["raster-color-range"]),"raster-hue-rotate":new jt(tt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new jt(tt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new jt(tt.paint_raster["raster-brightness-max"]),"raster-saturation":new jt(tt.paint_raster["raster-saturation"]),"raster-contrast":new jt(tt.paint_raster["raster-contrast"]),"raster-resampling":new jt(tt.paint_raster["raster-resampling"]),"raster-fade-duration":new jt(tt.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new jt(tt.paint_raster["raster-emissive-strength"]),"raster-array-band":new jt(tt.paint_raster["raster-array-band"]),"raster-elevation":new jt(tt.paint_raster["raster-elevation"])}),layout:U6},zw=bn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Bw{constructor(t,i,l,h){this.context=t,this.format=l,this.texture=t.gl.createTexture(),this.update(i,h)}update(t,i,l){const{width:h,height:d}=t,{context:g}=this,{gl:y}=g;if(y.bindTexture(y.TEXTURE_2D,this.texture),g.pixelStoreUnpackFlipY.set(!1),g.pixelStoreUnpack.set(1),g.pixelStoreUnpackPremultiplyAlpha.set(this.format===y.RGBA&&(!i||i.premultiply!==!1)),l||this.size&&this.size[0]===h&&this.size[1]===d){const{x:b,y:E}=l||{x:0,y:0};if(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||ImageBitmap&&t instanceof ImageBitmap)y.texSubImage2D(y.TEXTURE_2D,0,b,E,y.RGBA,y.UNSIGNED_BYTE,t);else{let A=this.format,M=y.UNSIGNED_BYTE;this.format===y.R32F&&(A=y.RED,M=y.FLOAT),y.texSubImage2D(y.TEXTURE_2D,0,b,E,h,d,A,M,t.data)}}else if(this.size=[h,d],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||ImageBitmap&&t instanceof ImageBitmap){let b=this.format;this.format===y.R8&&(b=y.RED),y.texImage2D(y.TEXTURE_2D,0,this.format,b,y.UNSIGNED_BYTE,t)}else{let b=this.format,E=this.format,A=y.UNSIGNED_BYTE;this.format===y.DEPTH_COMPONENT&&(b=y.DEPTH_COMPONENT16,A=y.UNSIGNED_SHORT),this.format===y.R8&&(E=y.RED),this.format===y.R32F&&(A=y.FLOAT,E=y.RED),y.texImage2D(y.TEXTURE_2D,0,b,h,d,0,E,A,t.data)}this.useMipmap=!!(i&&i.useMipmap),this.useMipmap&&y.generateMipmap(y.TEXTURE_2D)}bind(t,i,l=!1){const{context:h}=this,{gl:d}=h;d.bindTexture(d.TEXTURE_2D,this.texture),t!==this.minFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,t),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,this.useMipmap&&!l?t===d.NEAREST?d.NEAREST_MIPMAP_NEAREST:d.LINEAR_MIPMAP_LINEAR:t),this.minFilter=t),i!==this.wrapS&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,i),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,i),this.wrapS=i)}bindExtraParam(t,i,l,h){const{context:d}=this,{gl:g}=d;g.bindTexture(g.TEXTURE_2D,this.texture),i!==this.magFilter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,i),this.magFilter=i),t!==this.minFilter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,this.useMipmap?t===g.NEAREST?g.NEAREST_MIPMAP_NEAREST:g.LINEAR_MIPMAP_LINEAR:t),this.minFilter=t),l!==this.wrapS&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,l),this.wrapS=l),h!==this.wrapT&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,h),this.wrapT=h)}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class Bx{constructor(t,i){this.context=t,this.texture=i}bind(t,i){const{context:l}=this,{gl:h}=l;h.bindTexture(h.TEXTURE_2D,this.texture),t!==this.minFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,t),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,t),this.minFilter=t),i!==this.wrapS&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,i),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,i),this.wrapS=i)}}function Ux(r,t,i,l,h,d,g,y){const b=[r,t,1,i,l,1,h,d,1],E=[g,y,1],A=o.co.adjoint([],b),[M,P,O]=o.N.transformMat3(E,E,A);return o.co.multiply(b,b,[M,0,0,0,P,0,0,0,O])}function A3(r,t,i,l,h,d,g,y){const b=function(E,A,M,P,O,z,j,q){const Q=Ux(0,0,1,0,1,1,0,1),oe=Ux(E,A,M,P,O,z,j,q),pe=o.co.adjoint([],Q);return o.co.multiply(oe,oe,pe)}(r,t,i,l,h,d,g,y);return[b[2]/b[8]/Kt,b[5]/b[8]/Kt]}function Vx(r){return[r[0],Math.min(Math.max(r[1],-Wr),Wr)]}class C3 extends ha{constructor(t,i,l,h){super(),this.id=t,this.dispatcher=l,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(h),this.options=i,this._dirty=!1}load(t,i){if(this._loaded=i||!1,this.fire(new xa("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return t&&(this.coordinates=t),this._loaded=!0,void this._finishLoading();this._imageRequest=he(this.map._requestManager.transformRequest(this.url,Xi.Image),(l,h)=>{this._imageRequest=null,this._loaded=!0,l?this.fire(new Nl(l)):h&&(this.image=h instanceof HTMLImageElement?_t.getImageData(h):h,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,t&&(this.coordinates=t),this._finishLoading())})}loaded(){return this._loaded}updateImage(t){return t.url?(this._imageRequest&&t.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=t.url,this.load(t.coordinates,this._loaded),this):this}setTexture(t){if(!(t.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Bx(this.map.painter.context,t.handle),this.width=t.dimensions[0],this.height=t.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new xa("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Bx||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(t){if(this.coordinates=t,this._boundsArray=void 0,this._unsupportedCoords=!1,!t.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let i=t[0][1],l=t[0][1];for(const d of t)d[1]>l&&(l=d[1]),d[1]<i&&(i=d[1]);const h=(l+i)/2;if(h>Wr?this.onNorthPole=!0:h<-Wr&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const d=t.map(sn.fromLngLat);this.tileID=function(g){let y=1/0,b=1/0,E=-1/0,A=-1/0;for(const j of g)y=Math.min(y,j.x),b=Math.min(b,j.y),E=Math.max(E,j.x),A=Math.max(A,j.y);const M=Math.max(E-y,A-b),P=Math.max(0,Math.floor(-Math.log(M)/Math.LN2)),O=Math.pow(2,P);let z=Math.floor((y+E)/2*O);return z>1&&(z-=1),new Mt(P,z,Math.floor((b+A)/2*O))}(d),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new xa("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(t){for(const Q in this.tiles){const oe=this.tiles[Q];oe.state!=="loaded"&&(oe.state="loaded",oe.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const i=lm(new Mt(0,0,0),this.map.transform.projection),l=[i.projection.project(this.coordinates[0][0],this.coordinates[0][1]),i.projection.project(this.coordinates[1][0],this.coordinates[1][1]),i.projection.project(this.coordinates[2][0],this.coordinates[2][1]),i.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(Q){const oe=Q[1].x-Q[0].x,pe=Q[1].y-Q[0].y,de=Q[2].x-Q[1].x,Ce=Q[2].y-Q[1].y,Ee=Q[3].x-Q[2].x,Le=Q[3].y-Q[2].y,je=Q[0].x-Q[3].x,Ze=Q[0].y-Q[3].y,it=oe*Ce-de*pe,Ye=de*Le-Ee*Ce,mt=Ee*Ze-je*Le,bt=je*pe-oe*Ze;return it>0&&Ye>0&&mt>0&&bt>0||it<0&&Ye<0&&mt<0&&bt<0}(l))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const h=lm(this.tileID,this.map.transform.projection),[d,g,y,b]=this.coordinates.map(Q=>{const oe=h.projection.project(Q[0],Q[1]);return y3(h,oe)._round()});this.perspectiveTransform=A3(d.x,d.y,g.x,g.y,y.x,y.y,b.x,b.y);const E=this._boundsArray=new Ao;E.emplaceBack(d.x,d.y,0,0),E.emplaceBack(g.x,g.y,Kt,0),E.emplaceBack(b.x,b.y,0,Kt),E.emplaceBack(y.x,y.y,Kt,Kt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=t.createVertexBuffer(E,zw.members),this.boundsSegments=ui.simpleSegment(0,0,4,2);const A=[],M=[Vx((P=this.coordinates)[0]),Vx(P[1]),Vx(P[2]),Vx(P[3])];var P;const[O,z,j,q]=function(Q){let oe=Q[0][0],pe=oe,de=Q[0][1],Ce=de;for(let Ee=1;Ee<Q.length;Ee++)Q[Ee][0]<oe?oe=Q[Ee][0]:Q[Ee][0]>pe&&(pe=Q[Ee][0]),Q[Ee][1]<de?de=Q[Ee][1]:Q[Ee][1]>Ce&&(Ce=Q[Ee][1]);return[oe,de,pe-oe,Ce-de]}(M);{const Q=new Ao,[oe,pe,de,Ce]=function(vt){let Gt=vt[0].x,Tt=Gt,ar=vt[0].y,Qt=ar;for(let It=1;It<vt.length;It++)vt[It].x<Gt?Gt=vt[It].x:vt[It].x>Tt&&(Tt=vt[It].x),vt[It].y<ar?ar=vt[It].y:vt[It].y>Qt&&(Qt=vt[It].y);return[Gt,ar,Tt-Gt,Qt-ar]}(l),Ee=vt=>[(vt.x-oe)/de,(vt.y-pe)/Ce],[Le,je,Ze,it]=l.map(Ee),Ye=function(vt,Gt,Tt,ar,Qt,It,vr,hr){const ir=Ux(0,0,1,0,1,1,0,1),Pt=Ux(vt,Gt,Tt,ar,Qt,It,vr,hr),gr=o.co.adjoint([],Pt);return o.co.multiply(ir,ir,gr)}(Le[0],Le[1],je[0],je[1],Ze[0],Ze[1],it[0],it[1]);this.elevatedGlobePerspectiveTransform=A3(Le[0],Le[1],je[0],je[1],Ze[0],Ze[1],it[0],it[1]);const mt=(vt,Gt)=>{A.push(vt.lng);const Tt=Math.round((vt.lng-O)/j*Kt),ar=Math.round((vt.lat-z)/q*Kt),Qt=Ee(Gt),It=o.N.transformMat3([],[Qt[0],Qt[1],1],Ye),vr=Math.round(It[0]/It[2]*Kt),hr=Math.round(It[1]/It[2]*Kt);Q.emplaceBack(Tt,ar,vr,hr)},bt=l[3].x-l[0].x,ht=l[3].y-l[0].y,wt=l[2].x-l[1].x,lt=l[2].y-l[1].y;for(let vt=0;vt<65;vt++){const Gt=vt/64,Tt=[l[0].x+Gt*bt,l[0].y+Gt*ht],ar=[l[1].x+Gt*wt,l[1].y+Gt*lt],Qt=ar[0]-Tt[0],It=ar[1]-Tt[1];for(let vr=0;vr<65;vr++){const hr=vr/64,ir={x:Tt[0]+Qt*hr,y:Tt[1]+It*hr,z:0};mt(i.projection.unproject(ir.x,ir.y),ir)}}this.elevatedGlobeVertexBuffer=t.createVertexBuffer(Q,zw.members)}{this.maxLongitudeTriangleSize=0;let Q=[],oe=new Oi;const pe=(de,Ce,Ee)=>{oe.emplaceBack(de,Ce,Ee);const Le=A[de],je=A[Ce],Ze=A[Ee],it=Math.min(Math.min(Le,je),Ze),Ye=Math.max(Math.max(Le,je),Ze)-it;Ye>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Ye),Q.push(it+Ye/2)};for(let de=0;de<64;de++)for(let Ce=0;Ce<64;Ce++){const Ee=65*de+Ce,Le=Ee+1,je=Ee+65,Ze=je+1;pe(Ee,je,Le),pe(Le,je,Ze)}[Q,oe]=function(de,Ce){const Ee=Array.from({length:de.length},(Ze,it)=>it);Ee.sort((Ze,it)=>de[Ze]-de[it]);const Le=[],je=new Oi;for(let Ze=0;Ze<Ee.length;Ze++){const it=Ee[Ze];Le.push(de[it]);const Ye=3*it,mt=Ye+1;je.emplaceBack(Ce.uint16[Ye],Ce.uint16[mt],Ce.uint16[mt+1])}return[Le,je]}(Q,oe),this.elevatedGlobeTrianglesCenterLongitudes=Q,this.elevatedGlobeIndexBuffer=t.createIndexBuffer(oe)}this.elevatedGlobeSegments=ui.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,j/Kt,0,q/Kt,0,0,z,O,0])}prepare(){const t=Object.keys(this.tiles).length!==0;if(this.tileID&&!t)return;const i=this.map.painter.context,l=i.gl;!this._dirty||this.texture instanceof Bx||(this.texture?this.texture.update(this.image):(this.texture=new Bw(i,this.image,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE)),this._dirty=!1),t&&this._prepareData(i)}loadTile(t,i){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},i(null)):(t.state="errored",i(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(t){const i=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!i)return null;const l=this.elevatedGlobeTrianglesCenterLongitudes;let h=((A,M)=>A+360*Math.round((M-A)/360))(t+180,l[0]);const d=new ui,g=(A,M)=>{d.segments.push({vertexOffset:0,primitiveOffset:A,vertexLength:i.segments[0].vertexLength,primitiveLength:M,sortKey:void 0,vaos:{}})},y=.51*this.maxLongitudeTriangleSize;if(Math.abs(l[0]-h)<=y){const A=et(l,0,l.length,h+y);return A===l.length||g(A,Ne(l,A+1,l.length,h+360-y)-A),d}h<l[0]&&(h+=360);const b=Ne(l,0,l.length,h-y);if(b===l.length)return g(0,l.length),d;g(0,b-0);const E=et(l,b+1,l.length,h+y);return E!==l.length&&g(E,l.length-E),d}}const $6=(Math.pow(256,2)-1)/16907520;class k3 extends Da{constructor(t,i,l){super(t,V6,i,l),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isLayerDraped(t){return!(t&&t._source instanceof C3&&(t._source.onNorthPole||t._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(t){t!=="raster-color"&&t!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(t){if(!this.hasColorMap()||!this._curRampRange)return;const i=this._transitionablePaint._values["raster-color"].value.expression,[l,h]=t||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(l)&&isNaN(h)||l===this._curRampRange[0]&&h===this._curRampRange[1]||(this.colorRamp=K0({expression:i,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:l,end:h}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[l,h])}}const j6=new ni({visibility:new jt(tt["layout_raster-particle"].visibility)});var G6={paint:new ni({"raster-particle-array-band":new jt(tt["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new jt(tt["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Yl(tt["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new jt(tt["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new jt(tt["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new jt(tt["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new jt(tt["paint_raster-particle"]["raster-particle-reset-rate-factor"])}),layout:j6};class M3 extends Da{constructor(t,i,l){super(t,G6,i,l),this._updateColorRamp(),this.onRemove=h=>{this.colorRampTexture&&this.colorRampTexture.destroy(),this.transformFeedbackObject&&h.painter.context.gl.deleteTransformFeedback(this.transformFeedbackObject),this.tileFramebuffer&&this.tileFramebuffer.destroy()},this.lastInvalidatedAt=_t.now()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isLayerDraped(t){return!1}_handleSpecialPaintPropertyUpdate(t){t!=="raster-particle-color"&&t!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),t==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const t=this._transitionablePaint._values["raster-particle-color"].value.expression,i=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=K0({expression:t,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:i}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=_t.now()}}class H6 extends Da{constructor(t,i){super(t,{},i),this.implementation=t,t.slot&&(this.slot=t.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(t){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)}onRemove(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)}}const W6=new ni({visibility:new jt(tt.layout_sky.visibility)});var q6={paint:new ni({"sky-type":new jt(tt.paint_sky["sky-type"]),"sky-atmosphere-sun":new jt(tt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new jt(tt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new jt(tt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new jt(tt.paint_sky["sky-gradient-radius"]),"sky-gradient":new Yl(tt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new jt(tt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new jt(tt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new jt(tt.paint_sky["sky-opacity"])}),layout:W6};function Uw(r,t,i){const l=[0,0,1],h=o.bi.identity([]);return o.bi.rotateY(h,h,i?-Re(r)+Math.PI:Re(r)),o.bi.rotateX(h,h,-Re(t)),o.N.transformQuat(l,l,h),o.N.normalize(l,l)}var Z6={paint:new ni({})};function I3(r,t){const i=$x(r.projection,r.zoom,r.width,r.height),l=function(d,g,y,b,E){const A=new qe(y.lng-180*au,y.lat),M=new qe(y.lng+180*au,y.lat),P=d.project(A.lng,A.lat),O=d.project(M.lng,M.lat),z=-Math.atan2(O.y-P.y,O.x-P.x),j=sn.fromLngLat(y);j.y=st(j.y,-1+au,1-au);const q=j.toLngLat(),Q=d.project(q.lng,q.lat),oe=sn.fromLngLat(q);oe.x+=au;const pe=oe.toLngLat(),de=d.project(pe.lng,pe.lat),Ce=D3(de.x-Q.x,de.y-Q.y,z),Ee=sn.fromLngLat(q);Ee.y+=au;const Le=Ee.toLngLat(),je=d.project(Le.lng,Le.lat),Ze=D3(je.x-Q.x,je.y-Q.y,z),it=Math.abs(Ce.x)/Math.abs(Ze.y),Ye=o.a6.identity([]);o.a6.rotateZ(Ye,Ye,-z*(1-(E?0:b)));const mt=o.a6.identity([]);return o.a6.scale(mt,mt,[1,1-(1-it)*b,1]),mt[4]=-Ze.x/Ze.y*b,o.a6.rotateZ(mt,mt,z),o.a6.multiply(mt,Ye,mt),mt}(r.projection,0,r.center,i,t),h=P3(r);return o.a6.scale(l,l,[h,h,1]),l}function P3(r){const t=r.projection,i=$x(r.projection,r.zoom,r.width,r.height),l=R3(t,r.center),h=R3(t,qe.convert(t.center));return Math.pow(2,l*i+(1-i)*h)}function $x(r,t,i,l,h=1/0){const d=r.range;if(!d)return 0;const g=Math.min(h,Math.max(i,l)),y=Math.log(g/1024)/Math.LN2;return Ve(d[0]+y,d[1]+y,t)}const au=1/4e4;function R3(r,t){const i=st(t.lat,-Wr,Wr),l=new qe(t.lng-180*au,i),h=new qe(t.lng+180*au,i),d=r.project(l.lng,i),g=r.project(h.lng,i),y=sn.fromLngLat(l),b=sn.fromLngLat(h),E=g.x-d.x,A=g.y-d.y,M=b.x-y.x,P=b.y-y.y,O=Math.sqrt((M*M+P*P)/(E*E+A*A));return Math.log(O)/Math.LN2}function D3(r,t,i){const l=Math.cos(i),h=Math.sin(i);return{x:r*l-t*h,y:r*h+t*l}}function F3(r,t,i){o.a6.identity(r),o.a6.rotateZ(r,r,Re(t[2])),o.a6.rotateX(r,r,Re(t[0])),o.a6.rotateY(r,r,Re(t[1])),o.a6.scale(r,r,i),o.a6.multiply(r,r,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function jx(r,t,i,l,h,d,g,y){const b=[i[0]-t[0],i[1]-t[1],0],E=[l[0]-t[0],l[1]-t[1],0];if(o.N.length(b)<1e-12||o.N.length(E)<1e-12)return o.bi.identity(r);const A=o.N.cross([],b,E);o.N.normalize(A,A),o.N.subtract(E,l,t),b[2]=(d-h)*y,E[2]=(g-h)*y;const M=b;return o.N.cross(M,b,E),o.N.normalize(M,M),o.bi.rotationTo(r,A,M)}function Vw(r,t,i=!1){const l=Jc(t.zoom),h=function(d,g,y){const b=g.worldSize,E=[d[12],d[13],d[14]],A=en(E[1]/b),M=Mr(E[0]/b),P=o.a6.identity([]),O=Pr(1,A)*b,z=Pr(1,0)*b*qr(A,g.zoom),j=1/hw(b);let q=z*j;if(y){const de=$x(g.projection,g.zoom,g.width,g.height,1024);q=j*g.projection.pixelSpaceConversion(g.center.lat,b,de)}const Q=ft(A,M);o.N.add(Q,Q,o.N.scale([],o.N.normalize([],Q),O*q*E[2]));const oe=function(de){const Ce=[de[0],de[1],de[2]];let Ee=[0,1,0];const Le=o.N.cross([],Ee,Ce);return o.N.cross(Ee,Ce,Le),o.N.squaredLength(Ee)===0&&(Ee=[0,1,0],o.N.cross(Le,Ce,Ee)),o.N.normalize(Le,Le),o.N.normalize(Ee,Ee),o.N.normalize(Ce,Ce),[Le[0],Le[1],Le[2],0,Ee[0],Ee[1],Ee[2],0,Ce[0],Ce[1],Ce[2],0,de[0],de[1],de[2],1]}(Q);o.a6.scale(P,P,[q,q,q*O]),o.a6.translate(P,P,[-E[0],-E[1],-E[2]]);const pe=o.a6.multiply([],g.globeMatrix,oe);return o.a6.multiply(pe,pe,P),o.a6.multiply(pe,pe,d),pe}(r,t,i);if(l>0){const d=function(g,y){const b=y.worldSize,E=Pr(1,0)*b*qr(y.center.lat,y.zoom)/hw(b),A=Pr(1,y.center.lat)*b,M=o.a6.identity([]);return o.a6.rotateY(M,M,Re(y.center.lng)),o.a6.rotateX(M,M,Re(y.center.lat)),o.a6.translate(M,M,[0,0,ue]),o.a6.scale(M,M,[E,E,E*A]),o.a6.translate(M,M,[y.point.x-.5*b,y.point.y-.5*b,0]),o.a6.multiply(M,M,g),o.a6.multiply(M,y.globeMatrix,M)}(r,t);return function(g,y,b){const E=(z,j,q)=>{const Q=o.N.length(z),oe=o.N.length(j),pe=nc(z,j,q);return o.N.scale(pe,pe,1/o.N.length(pe)*Kr(Q,oe,q))},A=E([g[0],g[1],g[2]],[y[0],y[1],y[2]],b),M=E([g[4],g[5],g[6]],[y[4],y[5],y[6]],b),P=E([g[8],g[9],g[10]],[y[8],y[9],y[10]],b),O=nc([g[12],g[13],g[14]],[y[12],y[13],y[14]],b);return[A[0],A[1],A[2],0,M[0],M[1],M[2],0,P[0],P[1],P[2],0,O[0],O[1],O[2],1]}(h,d,l)}return h}function L3(r,t,i,l){const h=li.projectAabbCorners(l,i);let d=Number.MAX_VALUE,g=-1;for(let E=0;E<h.length;++E){const A=h[E];A[0]=(.5*A[0]+.5)*t.width,A[1]=(.5-.5*A[1])*t.height,A[2]<d&&(g=E,d=A[2])}const y=E=>new we(h[E][0],h[E][1]);let b;switch(g){case 0:case 6:b=[y(1),y(5),y(4),y(7),y(3),y(2),y(1)];break;case 1:case 7:b=[y(0),y(4),y(5),y(6),y(2),y(3),y(0)];break;case 3:case 5:b=[y(1),y(0),y(4),y(7),y(6),y(2),y(1)];break;default:b=[y(1),y(5),y(6),y(7),y(3),y(0),y(1)]}if(eo(r,b))return d}const X6=bn([{name:"a_pos_3f",components:3,type:"Float32"}]),Y6=bn([{name:"a_color_3f",components:3,type:"Float32"}]),K6=bn([{name:"a_color_4f",components:4,type:"Float32"}]),J6=bn([{name:"a_uv_2f",components:2,type:"Float32"}]),Q6=bn([{name:"a_normal_3f",components:3,type:"Float32"}]),ez=bn([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),tz=bn([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class O3{constructor(t,i){this.feature=t,this.instancedDataOffset=i,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class N3{constructor(){this.instancedDataArray=new $0,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class $w{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.fqid),this.projection=t.projection,this.index=t.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0}}populate(t,i,l,h){this.tileToMeter=Zr(l);const d=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:g,id:y,index:b,sourceLayerIndex:E}of t){const A=Ai(g,d);if(!this.layers[0]._featureFilter.filter(new ri(this.zoom),A,l))continue;const M={id:y,sourceLayerIndex:E,index:b,geometry:d?A.geometry:zi(g,l,h),properties:g.properties,type:g.type,patterns:{}},P=this.addFeature(M,M.geometry,A);P&&i.featureIndex.insert(g,M.geometry,b,E,this.index,this.instancesPerModel[P].instancedDataArray.length,Kt/32)}this.lookup=null}update(t,i,l,h){for(const d in this.instancesPerModel){const g=this.instancesPerModel[d];for(const y in t)g.idToFeaturesIndex.hasOwnProperty(y)&&this.evaluate(g.features[g.idToFeaturesIndex[y]],t[y],g,!0)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let t=!1;for(const i in this.instancesPerModel){const l=this.instancesPerModel[i];for(const h of l.features){const d=this.layers[0],g=h.feature,y=this.canonical,b=d.paint.get("model-rotation").evaluate(g,{},y),E=d.paint.get("model-scale").evaluate(g,{},y),A=d.paint.get("model-translation").evaluate(g,{},y);o.N.exactEquals(h.rotation,b)&&o.N.exactEquals(h.scale,E)&&o.N.exactEquals(h.translation,A)||(this.evaluate(h,h.featureStates,l,!0),t=!0)}}return t}isEmpty(){for(const t in this.instancesPerModel)if(this.instancesPerModel[t].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(t){if(!this.uploaded)for(const i in this.instancesPerModel){const l=this.instancesPerModel[i];l.instancedDataArray.length<0||l.instancedDataArray.length===0||(l.instancedDataBuffer?l.instancedDataBuffer.updateData(l.instancedDataArray):l.instancedDataBuffer=t.createVertexBuffer(l.instancedDataArray,ez.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const t in this.instancesPerModel){const i=this.instancesPerModel[t];i.instancedDataArray.length!==0&&i.instancedDataBuffer&&i.instancedDataBuffer.destroy()}}addFeature(t,i,l){const h=this.layers[0],d=h.layout.get("model-id").evaluate(l,{},this.canonical);if(!d)return Tr(`modelId is not evaluated for layer ${h.id} and it is not going to get rendered.`),d;this.instancesPerModel[d]||(this.instancesPerModel[d]=new N3);const g=this.instancesPerModel[d],y=g.instancedDataArray,b=new O3(l,y.length);for(const E of i)for(const A of E){if(A.x<0||A.x>=Kt||A.y<0||A.y>=Kt)continue;const M=(this.lookupDim-1)/Kt,P=this.lookupDim*(A.y*M|0)+A.x*M|0;if(this.lookup){if(this.lookup[P]!==0)continue;this.lookup[P]=1}this.instanceCount++;const O=y.length;y.resize(O+1),g.instancesEvaluatedElevation.push(0),y.float32[16*O]=A.x,y.float32[16*O+1]=A.y}return b.instancedDataCount=g.instancedDataArray.length-b.instancedDataOffset,b.instancedDataCount>0&&(t.id&&(g.idToFeaturesIndex[t.id]=g.features.length),g.features.push(b),this.evaluate(b,{},g,!1)),d}evaluate(t,i,l,h){const d=this.layers[0],g=t.feature,y=this.canonical,b=t.rotation=d.paint.get("model-rotation").evaluate(g,i,y),E=t.scale=d.paint.get("model-scale").evaluate(g,i,y),A=t.translation=d.paint.get("model-translation").evaluate(g,i,y),M=d.paint.get("model-color").evaluate(g,i,y);M.a=d.paint.get("model-color-mix-intensity").evaluate(g,i,y);const P=[];this.maxVerticalOffset<A[2]&&(this.maxVerticalOffset=A[2]),this.maxScale=Math.max(Math.max(this.maxScale,E[0]),Math.max(E[1],E[2])),F3(P,b,E);const O=Math.round(100*M.a)+M.b/1.05;for(let z=0;z<t.instancedDataCount;++z){const j=t.instancedDataOffset+z,q=16*j,Q=l.instancedDataArray.float32;let oe=0;h&&(oe=Q[q+6]-l.instancesEvaluatedElevation[j]);const pe=0|Q[q+1];Q[q]=(0|Q[q])+M.r/1.05,Q[q+1]=pe+M.g/1.05,Q[q+2]=O,Q[q+3]=1/(y.z>10?this.tileToMeter:Zr(y,pe)),Q[q+4]=A[0],Q[q+5]=A[1],Q[q+6]=A[2]+oe,Q[q+7]=P[0],Q[q+8]=P[1],Q[q+9]=P[2],Q[q+10]=P[4],Q[q+11]=P[5],Q[q+12]=P[6],Q[q+13]=P[8],Q[q+14]=P[9],Q[q+15]=P[10],l.instancesEvaluatedElevation[j]=A[2]}}}rr($w,"ModelBucket",{omit:["layers"]}),rr(N3,"PerModelAttributes"),rr(O3,"ModelFeature");const rz=new ni({visibility:new jt(tt.layout_model.visibility),"model-id":new mr(tt.layout_model["model-id"])});var nz={paint:new ni({"model-opacity":new jt(tt.paint_model["model-opacity"]),"model-rotation":new mr(tt.paint_model["model-rotation"]),"model-scale":new mr(tt.paint_model["model-scale"]),"model-translation":new mr(tt.paint_model["model-translation"]),"model-color":new mr(tt.paint_model["model-color"]),"model-color-mix-intensity":new mr(tt.paint_model["model-color-mix-intensity"]),"model-type":new jt(tt.paint_model["model-type"]),"model-cast-shadows":new jt(tt.paint_model["model-cast-shadows"]),"model-receive-shadows":new jt(tt.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new jt(tt.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new mr(tt.paint_model["model-emissive-strength"]),"model-roughness":new mr(tt.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new mr(tt.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new jt(tt.paint_model["model-cutoff-fade-range"])}),layout:rz};const Oh=64,gd={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function z3(r,t,i,l,h,d,g,y,b,E=!1){const A=i.zoom,M=i.project(l),P=qr(l.lat,A),O=1/P;o.a6.identity(r),o.a6.translate(r,r,[M.x+g[0]*O,M.y+g[1]*O,g[2]]);let z=1,j=1;const q=i.worldSize;if(E){if(i.projection.name==="mercator"){let de=0;i.elevation&&(de=i.elevation.getAtPointOrZero(new sn(M.x/q,M.y/q),0));const Ce=o.a7.transformMat4([],[M.x,M.y,de,1],i.projMatrix)[3]/i.cameraToCenterDistance;z=Ce,j=Ce*qr(i.center.lat,A)}else if(i.projection.name==="globe"){const de=Vw(r,i),Ce=o.a6.multiply([],i.projMatrix,de),Ee=[0,0,0,1];o.a7.transformMat4(Ee,Ee,Ce);const Le=Ee[3]/i.cameraToCenterDistance,je=Jc(A),Ze=i.projection.pixelsPerMeter(l.lat,q)*qr(l.lat,A),it=i.projection.pixelsPerMeter(i.center.lat,q)*qr(i.center.lat,A);z=Le/Kr(Ze,ii(i.center.lat),je),j=Le*P/Ze,z*=it,j*=it}}else z=O;o.a6.scale(r,r,[z,z,j]);const Q=[...r],oe=t.orientation,pe=[];if(F3(pe,[oe[0]+h[0],oe[1]+h[1],oe[2]+h[2]],d),o.a6.multiply(r,Q,pe),y&&i.elevation){let de=0;const Ce=[];if(b&&i.elevation){de=function(je,Ze,it,Ye,mt){const bt=Ze.elevation;if(!bt)return 0;const ht=li.projectAabbCorners(it,Ye),wt=Pr(1,mt.lat)*Ze.worldSize,lt=function(gr,Vr){const wr=[0,0,1],$r=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const kr of $r){const Jr=gr[kr.corners[0]],Rr=gr[kr.corners[1]],Rn=gr[kr.corners[2]],hn=[Rr[0]-Jr[0],Rr[1]-Jr[1],Vr*(Rr[2]-Jr[2])],pn=o.N.cross(hn,hn,[Rn[0]-Jr[0],Rn[1]-Jr[1],Vr*(Rn[2]-Jr[2])]);o.N.normalize(pn,pn),kr.dotProductWithUp=o.N.dot(pn,wr)}return $r.sort((kr,Jr)=>kr.dotProductWithUp-Jr.dotProductWithUp),$r[0].corners}(ht,wt),vt=ht[lt[0]],Gt=ht[lt[1]],Tt=ht[lt[2]],ar=ht[lt[3]],Qt=bt.getAtPointOrZero(new sn(vt[0]/Ze.worldSize,vt[1]/Ze.worldSize),0),It=bt.getAtPointOrZero(new sn(Gt[0]/Ze.worldSize,Gt[1]/Ze.worldSize),0),vr=bt.getAtPointOrZero(new sn(Tt[0]/Ze.worldSize,Tt[1]/Ze.worldSize),0),hr=bt.getAtPointOrZero(new sn(ar[0]/Ze.worldSize,ar[1]/Ze.worldSize),0),ir=(Qt+hr)/2,Pt=(It+vr)/2;return ir>Pt?It<vr?jx(je,Gt,ar,vt,It,hr,Qt,wt):jx(je,Tt,vt,ar,vr,Qt,hr,wt):Qt<hr?jx(je,vt,Gt,Tt,Qt,It,vr,wt):jx(je,ar,Tt,Gt,hr,vr,It,wt),Math.max(ir,Pt)}(Ce,i,t.aabb,r,l);const Ee=o.a6.fromQuat([],Ce),Le=o.a6.multiply([],Ee,pe);o.a6.multiply(r,Q,Le)}else de=i.elevation.getAtPointOrZero(new sn(M.x/q,M.y/q),0);de!==0&&(r[14]+=de)}}function dm(r,t,i=!1){r.uploaded||(r.gfxTexture=new Bw(t,r.image,i?t.gl.R8:t.gl.RGBA,{useMipmap:r.sampler.minFilter>=t.gl.NEAREST_MIPMAP_NEAREST}),r.uploaded=!0,r.image=null)}function iz(r,t,i){r.indexBuffer=t.createIndexBuffer(r.indexArray,!1,!0),r.vertexBuffer=t.createVertexBuffer(r.vertexArray,X6.members,!1,!0),r.normalArray&&(r.normalBuffer=t.createVertexBuffer(r.normalArray,Q6.members,!1,!0)),r.texcoordArray&&(r.texcoordBuffer=t.createVertexBuffer(r.texcoordArray,J6.members,!1,!0)),r.colorArray&&(r.colorBuffer=t.createVertexBuffer(r.colorArray,(r.colorArray.bytesPerElement===12?Y6:K6).members,!1,!0)),r.featureArray&&(r.pbrBuffer=t.createVertexBuffer(r.featureArray,tz.members,!0)),r.segments=ui.simpleSegment(0,0,r.vertexArray.length,r.indexArray.length);const l=r.material;l.pbrMetallicRoughness.baseColorTexture&&dm(l.pbrMetallicRoughness.baseColorTexture,t),l.pbrMetallicRoughness.metallicRoughnessTexture&&dm(l.pbrMetallicRoughness.metallicRoughnessTexture,t),l.normalTexture&&dm(l.normalTexture,t),l.occlusionTexture&&dm(l.occlusionTexture,t,i),l.emissionTexture&&dm(l.emissionTexture,t)}function jw(r,t,i){if(r.meshes)for(const l of r.meshes)iz(l,t,i);if(r.children)for(const l of r.children)jw(l,t,i)}function Gx(r){if(r.meshes)for(const t of r.meshes)t.indexArray.destroy(),t.vertexArray.destroy(),t.colorArray&&t.colorArray.destroy(),t.normalArray&&t.normalArray.destroy(),t.texcoordArray&&t.texcoordArray.destroy(),t.featureArray&&t.featureArray.destroy();if(r.children)for(const t of r.children)Gx(t)}function Gw(r){if(r.meshes)for(const i of r.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((t=i.material).pbrMetallicRoughness.baseColorTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),t.pbrMetallicRoughness.metallicRoughnessTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),t.normalTexture&&t.normalTexture.gfxTexture&&t.normalTexture.gfxTexture.destroy(),t.emissionTexture&&t.emissionTexture.gfxTexture&&t.emissionTexture.gfxTexture.destroy(),t.occlusionTexture&&t.occlusionTexture.gfxTexture&&t.occlusionTexture.gfxTexture.destroy()));var t;if(r.children)for(const i of r.children)Gw(i)}class az{constructor(t){this._callback=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class sz{constructor(){this.tasks={},this.taskQueue=[],sr(["process"],this),this.invoker=new az(this.process),this.nextId=0}add(t,i){const l=this.nextId++,h=function({type:d,isSymbolTile:g,zoom:y}){return y=y||0,d==="message"?0:d!=="maybePrepare"||g?d!=="parseTile"||g?d==="parseTile"&&g?300-y:d==="maybePrepare"&&g?400-y:500:200-y:100-y}(i);if(h===0){En();try{t()}finally{}return null}return this.tasks[l]={fn:t,metadata:i,priority:h,id:l},this.taskQueue.push(l),this.invoker.trigger(),{cancel:()=>{delete this.tasks[l]}}}process(){En();try{if(this.taskQueue=this.taskQueue.filter(l=>!!this.tasks[l]),!this.taskQueue.length)return;const t=this.pick();if(t===null)return;const i=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let t=null,i=1/0;for(let h=0;h<this.taskQueue.length;h++){const d=this.tasks[this.taskQueue[h]];d.priority<i&&(i=d.priority,t=h)}if(t===null)return null;const l=this.taskQueue[t];return this.taskQueue.splice(t,1),l}remove(){this.invoker.remove()}}class B3{constructor(t,i,l){this.target=t,this.parent=i,this.mapId=l,this.callbacks={},this.cancelCallbacks={},sr(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new sz}send(t,i,l,h,d=!1,g){const y=Math.round(1e18*Math.random()).toString(36).substring(0,10);l&&(l.metadata=g,this.callbacks[y]=l);const b=new Set;return this.target.postMessage({id:y,type:t,hasCallback:!!l,targetMapId:h,mustQueue:d,sourceMapId:this.mapId,data:cl(i,b)},b),{cancel:()=>{l&&delete this.callbacks[y],this.target.postMessage({id:y,type:"<cancel>",targetMapId:h,sourceMapId:this.mapId})}}}receive(t){const i=t.data,l=i.id;if(l&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){const h=this.cancelCallbacks[l];delete this.cancelCallbacks[l],h&&h.cancel()}else if(i.mustQueue||En()){const h=this.callbacks[l],d=this.scheduler.add(()=>this.processTask(l,i),h&&h.metadata||{type:"message"});d&&(this.cancelCallbacks[l]=d)}else this.processTask(l,i)}processTask(t,i){if(delete this.cancelCallbacks[t],i.type==="<response>"){const l=this.callbacks[t];delete this.callbacks[t],l&&(i.error?l(Zl(i.error)):l(null,Zl(i.data)))}else{const l=new Set,h=i.hasCallback?(g,y)=>{this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:g?cl(g):null,data:cl(y,l)},l)}:g=>{},d=Zl(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,d,h);else if(this.parent.getWorkerSource){const g=i.type.split(".");this.parent.getWorkerSource(i.sourceMapId,g[0],d.source,d.scope)[g[1]](d,h)}else h(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}class _d{constructor(t,i){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=He();const l=this.workerPool.acquire(this.id);for(let h=0;h<l.length;h++){const d=new _d.Actor(l[h],i,this.id);d.name=`Worker ${h}`,this.actors.push(d)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(t,i,l){Dt(this.actors,(h,d)=>{h.send(t,i,d)},l=l||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(t=>{t.remove()}),this.actors=[],this.workerPool.release(this.id)}}_d.Actor=B3;var pm={workerUrl:"",workerClass:null,workerParams:void 0};function oz(){return pm.workerClass!=null?new pm.workerClass:new self.Worker(pm.workerUrl,pm.workerParams)}const Hw="mapboxgl_preloaded_worker_pool";class mm{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<mm.workerCount;)this.workers.push(new oz);return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.workers&&this.numActive()===0&&(this.workers.forEach(i=>{i.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Hw]}numActive(){return Object.keys(this.active).length}}let gm;function Hx(){return gm||(gm=new mm),gm}mm.workerCount=2;let Wx,Ww,Do,xd,qw,yd=null;function U3(){return En()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:Ww||F.DRACO_URL}function V3(){if(En()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(xd)return xd;const r=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return xd=WebAssembly.validate(r)?F.MESHOPT_SIMD_URL:F.MESHOPT_URL,xd}const qx={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},lz={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},_m={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function $3(r,t,i){const l=i.json.bufferViews.length,h=i.buffers.length;t.bufferView=l,i.json.bufferViews[l]={buffer:h,byteLength:r.byteLength},i.buffers[h]=r}const Zw="KHR_draco_mesh_compression";function cz(r,t){const i=r.extensions&&r.extensions[Zw];if(!i)return;const l=new Do.Decoder,h=W3(t,i.bufferView),d=new Do.Mesh;if(!l.DecodeArrayToMesh(h,h.byteLength,d))throw new Error("Failed to decode Draco mesh");const g=t.json.accessors[r.indices],y=qx[g.componentType],b=g.count*y.BYTES_PER_ELEMENT,E=Do._malloc(b);y===Uint16Array?l.GetTrianglesUInt16Array(d,b,E):l.GetTrianglesUInt32Array(d,b,E),$3(Do.memory.buffer.slice(E,E+b),g,t),Do._free(E);for(const A of Object.keys(i.attributes)){const M=l.GetAttributeByUniqueId(d,i.attributes[A]),P=t.json.accessors[r.attributes[A]],O=lz[P.componentType],z=P.count*_m[P.type]*qx[P.componentType].BYTES_PER_ELEMENT,j=Do._malloc(z);l.GetAttributeDataArrayForAllPoints(d,M,Do[O],z,j),$3(Do.memory.buffer.slice(j,j+z),P,t),Do._free(j)}l.destroy(),d.destroy(),delete r.extensions[Zw]}const Zx="EXT_meshopt_compression";function uz(r,t){if(!r.extensions||!r.extensions[Zx])return;const i=r.extensions[Zx],l=new Uint8Array(t.buffers[i.buffer],i.byteOffset||0,i.byteLength||0),h=new Uint8Array(i.count*i.byteStride);qw.decodeGltfBuffer(h,i.count,i.byteStride,l,i.mode,i.filter),r.buffer=t.buffers.length,r.byteOffset=0,t.buffers[r.buffer]=h.buffer,delete r.extensions[Zx]}const j3=1179937895,G3=new TextDecoder("utf8");function H3(r,t){return new URL(r,t).href}function hz(r,t,i,l){return fetch(H3(r.uri,l)).then(h=>h.arrayBuffer()).then(h=>{t.buffers[i]=h})}function W3(r,t){const i=r.json.bufferViews[t];return new Uint8Array(r.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function fz(r,t,i,l){if(r.uri){const h=H3(r.uri,l);return fetch(h).then(d=>d.blob()).then(d=>createImageBitmap(d)).then(d=>{t.images[i]=d})}if(r.bufferView!==void 0){const h=W3(t,r.bufferView),d=new Blob([h],{type:r.mimeType});return createImageBitmap(d).then(g=>{t.images[i]=g})}}function q3(r,t=0,i){const l={json:null,images:[],buffers:[]};if(new Uint32Array(r,t,1)[0]===j3){const A=new Uint32Array(r,t);let M=2;const P=(A[M++]>>2)-3,O=A[M++]>>2;if(M++,l.json=JSON.parse(G3.decode(A.subarray(M,M+O))),M+=O,M<P){const z=A[M++];M++;const j=t+(M<<2);l.buffers[0]=r.slice(j,j+z)}}else l.json=JSON.parse(G3.decode(new Uint8Array(r,t)));const{buffers:h,images:d,meshes:g,extensionsUsed:y,bufferViews:b}=l.json;let E=Promise.resolve();if(h){const A=[];for(let M=0;M<h.length;M++){const P=h[M];P.uri?A.push(hz(P,l,M,i)):l.buffers[M]||(l.buffers[M]=null)}E=Promise.all(A)}return E.then(()=>{const A=[],M=y&&y.includes(Zw),P=y&&y.includes(Zx);if(M&&A.push(function(){if(!Do)return Wx||(Wx=function(O){let z,j=null;function q(){z=new Uint8Array(j.buffer)}function Q(){throw new Error("Unexpected Draco error.")}const oe={a:{a:Q,d:function(pe,de,Ce){return z.copyWithin(pe,de,de+Ce)},c:function(pe){const de=z.length,Ce=Math.max(pe>>>0,Math.ceil(1.2*de)),Ee=Math.ceil((Ce-de)/65536);try{return j.grow(Ee),q(),!0}catch{return!1}},b:Q}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(O,oe):O.then(pe=>pe.arrayBuffer()).then(pe=>WebAssembly.instantiate(pe,oe))).then(pe=>{const{Rb:de,Qb:Ce,P:Ee,T:Le,X:je,Ja:Ze,La:it,Qa:Ye,Va:mt,Wa:bt,eb:ht,jb:wt,f:lt,e:vt,yb:Gt,zb:Tt,Ab:ar,Bb:Qt,Db:It,Gb:vr}=pe.instance.exports;j=vt;const hr=(()=>{let ir=0,Pt=0,gr=0,Vr=0;return wr=>{gr&&(de(Vr),de(ir),Pt+=gr,gr=ir=0),ir||(Pt+=128,ir=Ce(Pt));const $r=wr.length+7&-8;let kr=ir;$r>=Pt&&(gr=$r,kr=Vr=Ce($r));for(let Jr=0;Jr<wr.length;Jr++)z[kr+Jr]=wr[Jr];return kr}})();return q(),lt(),{memory:vt,_free:de,_malloc:Ce,Mesh:class{constructor(){this.ptr=Ee()}destroy(){Le(this.ptr)}},Decoder:class{constructor(){this.ptr=Ze()}destroy(){wt(this.ptr)}DecodeArrayToMesh(ir,Pt,gr){const Vr=hr(ir),wr=it(this.ptr,Vr,Pt,gr.ptr);return!!je(wr)}GetAttributeByUniqueId(ir,Pt){return{ptr:Ye(this.ptr,ir.ptr,Pt)}}GetTrianglesUInt16Array(ir,Pt,gr){mt(this.ptr,ir.ptr,Pt,gr)}GetTrianglesUInt32Array(ir,Pt,gr){bt(this.ptr,ir.ptr,Pt,gr)}GetAttributeDataArrayForAllPoints(ir,Pt,gr,Vr,wr){ht(this.ptr,ir.ptr,Pt.ptr,gr,Vr,wr)}},DT_INT8:Gt(),DT_UINT8:Tt(),DT_INT16:ar(),DT_UINT16:Qt(),DT_UINT32:It(),DT_FLOAT32:vr()}})}(fetch(U3())),Wx.then(O=>{Do=O,Wx=void 0}))}()),P&&A.push(function(){if(qw)return;const O=function(z){let j;const q=WebAssembly.instantiateStreaming(z,{}).then(pe=>{j=pe.instance,j.exports.__wasm_call_ctors()}),Q={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},oe={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:q,supported:!0,decodeGltfBuffer(pe,de,Ce,Ee,Le,je){(function(Ze,it,Ye,mt,bt,ht,wt){const lt=Ze.exports.sbrk,vt=mt+3&-4,Gt=lt(vt*bt),Tt=lt(ht.length),ar=new Uint8Array(Ze.exports.memory.buffer);ar.set(ht,Tt);const Qt=it(Gt,mt,bt,Tt,ht.length);if(Qt===0&&wt&&wt(Gt,vt,bt),Ye.set(ar.subarray(Gt,Gt+mt*bt)),lt(Gt-lt(0)),Qt!==0)throw new Error(`Malformed buffer data: ${Qt}`)})(j,j.exports[oe[Le]],pe,de,Ce,Ee,j.exports[Q[je]])}}}(fetch(V3()));return O.ready.then(()=>{qw=O})}()),d)for(let O=0;O<d.length;O++)A.push(fz(d[O],l,O,i));return(A.length?Promise.all(A):Promise.resolve()).then(()=>{if(M&&g)for(const{primitives:O}of g)for(const z of O)cz(z,l);if(P&&g&&b)for(const O of b)uz(O,l);return l})})}class Z3{constructor(t,i,l){if(this.triangleCount=i.length/3,this.min=new we(0,0),this.max=new we(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||t.length===0||l===0)return;const h=t.map(A=>A.x),d=t.map(A=>A.y);this.min=new we(Math.min(...h),Math.min(...d)),this.max=new we(Math.max(...h),Math.max(...d));const g=this.max.sub(this.min);g.x=Math.max(g.x,1),g.y=Math.max(g.y,1);const y=Math.max(g.x,g.y)/l;this.cellsX=Math.max(1,Math.ceil(g.x/y)),this.cellsY=Math.max(1,Math.ceil(g.y/y)),this.xScale=1/y,this.yScale=1/y;const b=[];for(let A=0;A<this.triangleCount;A++){const M=t[i[3*A+0]].sub(this.min),P=t[i[3*A+1]].sub(this.min),O=t[i[3*A+2]].sub(this.min),z=su(Math.floor(Math.min(M.x,P.x,O.x)),this.xScale,this.cellsX),j=su(Math.floor(Math.max(M.x,P.x,O.x)),this.xScale,this.cellsX),q=su(Math.floor(Math.min(M.y,P.y,O.y)),this.yScale,this.cellsY),Q=su(Math.floor(Math.max(M.y,P.y,O.y)),this.yScale,this.cellsY),oe=new we(0,0),pe=new we(0,0),de=new we(0,0),Ce=new we(0,0);for(let Ee=q;Ee<=Q;++Ee){oe.y=pe.y=Ee*y,de.y=Ce.y=(Ee+1)*y;for(let Le=z;Le<=j;++Le)oe.x=de.x=Le*y,pe.x=Ce.x=(Le+1)*y,(jv(M,P,O,oe,pe,Ce)||jv(M,P,O,oe,Ce,de))&&b.push({cellIdx:Ee*this.cellsX+Le,triIdx:A})}}if(b.length===0)return;b.sort((A,M)=>A.cellIdx-M.cellIdx||A.triIdx-M.triIdx);let E=0;for(;E<b.length;){const A=b[E].cellIdx,M={start:this.payload.length,len:0};for(;E<b.length&&b[E].cellIdx===A;)++M.len,this.payload.push(b[E++].triIdx);this.cells[A]=M}}query(t,i,l){if(this.triangleCount===0||this.cells.length===0||t.x>this.max.x||this.min.x>i.x||t.y>this.max.y||this.min.y>i.y)return;this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8)));for(let b=0;b<this.lookup.length;b++)this.lookup[b]=0;const h=su(t.x-this.min.x,this.xScale,this.cellsX),d=su(i.x-this.min.x,this.xScale,this.cellsX),g=su(t.y-this.min.y,this.yScale,this.cellsY),y=su(i.y-this.min.y,this.yScale,this.cellsY);for(let b=g;b<=y;b++)for(let E=h;E<=d;E++){const A=this.cells[b*this.cellsX+E];if(A)for(let M=0;M<A.len;M++){const P=this.payload[A.start+M],O=Math.floor(P/8),z=1<<P%8;if(!(this.lookup[O]&z)&&(this.lookup[O]|=z,l.push(P),l.length===this.triangleCount))return}}}}function su(r,t,i){return Math.max(0,Math.min(i-1,Math.floor(r*t)))}function Nh(r,t){const i=r.json.bufferViews[t.bufferView],l=qx[t.componentType];return new l(r.buffers[i.buffer],(t.byteOffset||0)+(i.byteOffset||0),t.count*(i.byteStride&&i.byteStride!==_m[t.type]*l.BYTES_PER_ELEMENT?i.byteStride/l.BYTES_PER_ELEMENT:_m[t.type]))}function Xw(r,t,i,l){const h=qx[t.componentType],d=function(A){switch(A){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(h),g=r.json.bufferViews[t.bufferView],y=g.byteStride?g.byteStride/h.BYTES_PER_ELEMENT:_m[t.type],b=i.float32,E=b.length/i.capacity;for(let A=0,M=0;A<t.count*y;A+=y,M+=E)for(let P=0;P<E;P++)b[M+P]=l[A+P]*d;i._trim()}function dz(r,t,i){const l=r.indices,h=r.attributes,d={};d.indexArray=new Oi;const g=t.json.accessors[l],y=g.count/3;d.indexArray.reserve(y);const b=Nh(t,g);for(let P=0;P<y;P++)d.indexArray.emplaceBack(b[3*P],b[3*P+1],b[3*P+2]);d.indexArray._trim(),d.vertexArray=new Kl;const E=t.json.accessors[h.POSITION];d.vertexArray.reserve(E.count);const A=Nh(t,E);for(let P=0;P<E.count;P++)d.vertexArray.emplaceBack(A[3*P],A[3*P+1],A[3*P+2]);if(d.vertexArray._trim(),d.aabb=new li(E.min,E.max),d.centroid=function(P,O){const z=[0,0,0],j=P.length;if(j>0){for(let q=0;q<j;q++){const Q=3*P[q];z[0]+=O[Q],z[1]+=O[Q+1],z[2]+=O[Q+2]}z[0]/=j,z[1]/=j,z[2]/=j}return z}(b,A),h.COLOR_0!==void 0){const P=t.json.accessors[h.COLOR_0],O=_m[P.type],z=Nh(t,P);d.colorArray=O===3?new Kl:new dl,d.colorArray.resize(P.count),Xw(t,P,d.colorArray,z)}if(h.NORMAL!==void 0){d.normalArray=new Kl;const P=t.json.accessors[h.NORMAL];d.normalArray.resize(P.count);const O=Nh(t,P);Xw(t,P,d.normalArray,O)}if(h.TEXCOORD_0!==void 0&&i.length>0){d.texcoordArray=new Eh;const P=t.json.accessors[h.TEXCOORD_0];d.texcoordArray.resize(P.count);const O=Nh(t,P);Xw(t,P,d.texcoordArray,O)}if(h._FEATURE_ID_RGBA4444!==void 0){const P=t.json.accessors[h._FEATURE_ID_RGBA4444];t.json.extensionsUsed&&t.json.extensionsUsed.includes("EXT_meshopt_compression")&&(d.featureData=Nh(t,P))}h._FEATURE_RGBA4444!==void 0&&(d.featureData=new Uint32Array(Nh(t,t.json.accessors[h._FEATURE_RGBA4444]).buffer));const M=r.material;return d.material=function(P,O){const{emissiveFactor:z=[0,0,0],alphaMode:j="OPAQUE",alphaCutoff:q=.5,normalTexture:Q,occlusionTexture:oe,emissiveTexture:pe,doubleSided:de}=P,{baseColorFactor:Ce=[1,1,1,1],metallicFactor:Ee=1,roughnessFactor:Le=1,baseColorTexture:je,metallicRoughnessTexture:Ze}=P.pbrMetallicRoughness||{},it=oe?O[oe.index]:void 0;if(oe&&oe.extensions&&oe.extensions.KHR_texture_transform&&it){const Ye=oe.extensions.KHR_texture_transform;it.offsetScale=[Ye.offset[0],Ye.offset[1],Ye.scale[0],Ye.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new _i(...Ce),metallicFactor:Ee,roughnessFactor:Le,baseColorTexture:je?O[je.index]:void 0,metallicRoughnessTexture:Ze?O[Ze.index]:void 0},doubleSided:de,emissiveFactor:z,alphaMode:j,alphaCutoff:q,normalTexture:Q?O[Q.index]:void 0,occlusionTexture:it,emissionTexture:pe?O[pe.index]:void 0,defined:P.defined===void 0}}(M!==void 0?t.json.materials[M]:{defined:!1},i),d}function X3(r,t,i){const{matrix:l,rotation:h,translation:d,scale:g,mesh:y,extras:b,children:E}=r,A={};if(A.matrix=l||o.a6.fromRotationTranslationScale([],h||[0,0,0,1],d||[0,0,0],g||[1,1,1]),y!==void 0){A.meshes=i[y];const M=A.anchor=[0,0];for(const P of A.meshes){const{min:O,max:z}=P.aabb;M[0]+=O[0]+z[0],M[1]+=O[1]+z[1]}M[0]=Math.floor(M[0]/A.meshes.length/2),M[1]=Math.floor(M[1]/A.meshes.length/2)}if(b&&(b.id&&(A.id=b.id),b.lights&&(A.lights=function(M){if(!M.length)return[];const P=function(Q){const oe=atob(Q),pe=new Uint8Array(oe.length);for(let de=0;de<oe.length;de++)pe[de]=oe.codePointAt(de);return pe}(M),O=[],z=P.length/24,j=new Uint16Array(P.buffer),q=new Float32Array(P.buffer);for(let Q=0;Q<z;Q++){const oe=j[2*Q*6]/30,pe=j[2*Q*6+1]/30,de=j[2*Q*6+10]/100,Ce=q[6*Q+1],Ee=q[6*Q+2],Le=q[6*Q+3],je=q[6*Q+4],Ze=Le-Ce,it=je-Ee,Ye=Math.hypot(Ze,it);O.push({pos:[Ce+.5*Ze,Ee+.5*it,pe],normal:[it/Ye,-Ze/Ye,0],width:Ye,height:oe,depth:de,points:[Ce,Ee,Le,je]})}return O}(b.lights))),E){const M=[];for(const P of E)M.push(X3(t.json.nodes[P],t,i));A.children=M}return A}function pz(r){if(r.vertices.length===0||r.indices.length===0)return null;const[t,i]=[r.vertices[0].clone(),r.vertices[0].clone()];for(let g=1;g<r.vertices.length;++g){const y=r.vertices[g];t.x=Math.min(t.x,y.x),t.y=Math.min(t.y,y.y),i.x=Math.max(i.x,y.x),i.y=Math.max(i.y,y.y)}const l=Math.ceil(Math.max(i.x-t.x,i.y-t.y)/256),h=Math.max(8,l),d=new Z3(r.vertices,r.indices,h);return{vertices:r.vertices,indices:r.indices,grid:d,min:t,max:i}}function mz(r){if(!r.extras||!r.extras.ground)return null;const t=r.extras.ground;if(!t||!Array.isArray(t)||t.length===0)return null;const i=t[0];if(!i||!Array.isArray(i)||i.length===0)return null;const l=[];for(const g of i){if(!Array.isArray(g)||g.length!==2)continue;const y=g[0],b=g[1];typeof y=="number"&&typeof b=="number"&&l.push(new we(y,b))}if(l.length<3)return null;l.length>1&&l[l.length-1].equals(l[0])&&l.pop();let h=0;for(let g=0;g<l.length;g++){const y=l[g],b=l[(g+1)%l.length],E=l[(g+2)%l.length];h+=(y.x-b.x)*(E.y-b.y)-(E.x-b.x)*(y.y-b.y)}h>0&&l.reverse();const d=mx(l.flatMap(g=>[g.x,g.y]),[]);return d.length===0?null:{vertices:l,indices:d}}function gz(r){const t=[],i=[];let l=0;for(const h of r){l=t.length;const d=h.vertexArray.float32,g=h.indexArray.uint16;for(let y=0;y<h.vertexArray.length;y++)t.push(new we(d[3*y+0],d[3*y+1]));for(let y=0;y<3*h.indexArray.length;y++)i.push(g[y]+l)}if(i.length%3!=0)return null;for(let h=0;h<i.length;h+=3){const d=t[i[h+0]],g=t[i[h+1]],y=t[i[h+2]];(d.x-g.x)*(y.y-g.y)-(y.x-g.x)*(d.y-g.y)>0&&([i[h+1],i[h+2]]=[i[h+2],i[h+1]])}return{vertices:t,indices:i}}function Y3(r){const t=function(b,E){const A=[],M=WebGL2RenderingContext;if(b.json.textures)for(const P of b.json.textures){const O={magFilter:M.LINEAR,minFilter:M.NEAREST,wrapS:M.REPEAT,wrapT:M.REPEAT};P.sampler!==void 0&&Object.assign(O,b.json.samplers[P.sampler]),A.push({image:E[P.source],sampler:O,uploaded:!1})}return A}(r,r.images),i=function(b,E){const A=[];for(const M of b.json.meshes){const P=[];for(const O of M.primitives)P.push(dz(O,b,E));A.push(P)}return A}(r,t),{scenes:l,scene:h,nodes:d}=r.json,g=l?l[h||0].nodes:d,y=[];for(const b of g)y.push(X3(d[b],r,i));return function(b,E,A){const M={},P=new Set;for(let O=0;O<b.length;O++){const z=A[E[O]];if(!z.extras)continue;const j=z.extras["mapbox:footprint:version"],q=z.extras["mapbox:footprint:id"];(j||q)&&P.add(O),j==="1.0.0"&&q&&(M[q]=O)}for(let O=0;O<b.length;O++){if(P.has(O))continue;const z=b[O],j=A[E[O]];if(!j.extras)continue;let q=null;z.id in M&&(q=gz(b[M[z.id]].meshes)),q||(q=mz(j)),q&&(z.footprint=pz(q))}if(P.size>0){const O=Array.from(P.values()).sort((z,j)=>z-j);for(let z=O.length-1;z>=0;z--)b.splice(O[z],1)}}(y,g,r.json.nodes),y}function _z(r){r.heightmap=new Float32Array(4096),r.heightmap.fill(-1);const t=r.vertexArray.float32,i=r.aabb.min[0]-1,l=r.aabb.min[1]-1,h=Oh/(r.aabb.max[0]-i+2),d=Oh/(r.aabb.max[1]-l+2);for(let g=0;g<t.length;g+=3){const y=t[g+2],b=(t[g+0]-i)*h|0,E=(t[g+1]-l)*d|0;y>r.heightmap[E*Oh+b]&&(r.heightmap[E*Oh+b]=y)}}function xz(r,t){const i={};i.indexArray=new Oi,i.indexArray.reserve(4*r.length),i.vertexArray=new Kl,i.vertexArray.reserve(10*r.length),i.colorArray=new dl,i.vertexArray.reserve(10*r.length);let l=0;for(const g of r){const y=Math.min(10,Math.max(4,1.3*g.height))*t,b=[-g.normal[1],g.normal[0],0],E=Math.min(.29,.1*g.width/g.depth),A=g.width-2*g.depth*t*(E+.01),M=o.N.scaleAndAdd([],g.pos,b,A/2),P=o.N.scaleAndAdd([],g.pos,b,-A/2),O=[M[0],M[1],M[2]+g.height],z=[P[0],P[1],P[2]+g.height],j=o.N.scaleAndAdd([],g.normal,b,E);o.N.scale(j,j,y);const q=o.N.scaleAndAdd([],g.normal,b,-E);o.N.scale(q,q,y),o.N.add(j,M,j),o.N.add(q,P,q),M[2]+=.1,P[2]+=.1,i.vertexArray.emplaceBack(j[0],j[1],j[2]),i.vertexArray.emplaceBack(q[0],q[1],q[2]),i.vertexArray.emplaceBack(M[0],M[1],M[2]),i.vertexArray.emplaceBack(P[0],P[1],P[2]),i.vertexArray.emplaceBack(O[0],O[1],O[2]),i.vertexArray.emplaceBack(z[0],z[1],z[2]),i.vertexArray.emplaceBack(M[0],M[1],M[2]),i.vertexArray.emplaceBack(P[0],P[1],P[2]),i.vertexArray.emplaceBack(j[0],j[1],j[2]),i.vertexArray.emplaceBack(q[0],q[1],q[2]);const Q=A/y/2;i.colorArray.emplaceBack(-Q-E,-1,Q,.8),i.colorArray.emplaceBack(Q+E,-1,Q,.8),i.colorArray.emplaceBack(-Q,0,Q,1.3),i.colorArray.emplaceBack(Q,0,Q,1.3),i.colorArray.emplaceBack(Q+E,-.8,Q,.7),i.colorArray.emplaceBack(Q+E,-.8,Q,.7),i.colorArray.emplaceBack(0,0,Q,1.3),i.colorArray.emplaceBack(0,0,Q,1.3),i.colorArray.emplaceBack(Q+E,-1.2,Q,.8),i.colorArray.emplaceBack(Q+E,-1.2,Q,.8),i.indexArray.emplaceBack(6+l,4+l,8+l),i.indexArray.emplaceBack(7+l,9+l,5+l),i.indexArray.emplaceBack(0+l,1+l,2+l),i.indexArray.emplaceBack(1+l,3+l,2+l),l+=10}const h={defined:!0,emissiveFactor:[0,0,0]},d={};return d.baseColorFactor=_i.white,h.pbrMetallicRoughness=d,i.material=h,i.aabb=new li([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}rr(Z3,"TriangleGridIndex");class K3{constructor(t){this._stringToNumber={},this._numberToString=[];for(let i=0;i<t.length;i++){const l=t[i];this._stringToNumber[l]=i,this._numberToString[i]=l}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}const yz=["tile","layer","source","sourceLayer","state"];class J3{constructor(t,i,l,h,d){this.type="Feature",this._vectorTileFeature=t,this._z=i,this._x=l,this._y=h,this.properties=t.properties,this.id=d}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(t.id=this.id);for(const i of yz)this[i]!==void 0&&(t[i]=this[i]);return t}}class Q3{constructor(t,i){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Eo(Kt,16,0),this.featureIndexArray=new q_,this.promoteId=i,this.is3DTile=!1}insert(t,i,l,h,d,g=0,y=0){const b=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,h,d,g);const E=this.grid;for(let A=0;A<i.length;A++){const M=i[A],P=[1/0,1/0,-1/0,-1/0];for(let O=0;O<M.length;O++){const z=M[O];P[0]=Math.min(P[0],z.x),P[1]=Math.min(P[1],z.y),P[2]=Math.max(P[2],z.x),P[3]=Math.max(P[3],z.y)}y!==0&&(P[0]-=y,P[1]-=y,P[2]+=y,P[3]+=y),P[0]<Kt&&P[1]<Kt&&P[2]>=0&&P[3]>=0&&E.insert(b,P[0],P[1],P[2],P[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new bw(new hd(this.rawTileData)).layers,this.sourceLayerCoder=new K3(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const t in this.vtLayers)this.vtFeatures[t]=[]}return this.vtLayers}query(t,i,l,h){this.loadVTLayers();const d=t.params||{},g=Ka(d.filter),y=t.tileResult,b=t.transform,E=y.bufferedTilespaceBounds,A=this.grid.query(E.min.x,E.min.y,E.max.x,E.max.y,(z,j,q,Q)=>vA(y.bufferedTilespaceGeometry,z,j,q,Q));A.sort(vz);let M=null;b.elevation&&A.length>0&&(M=sd.create(b.elevation,this.tileID));const P={};let O;for(let z=0;z<A.length;z++){const j=A[z];if(j===O)continue;O=j;const q=this.featureIndexArray.get(j);let Q=null;if(this.is3DTile){const oe=this.bucketLayerIDs[0][0],pe=i[oe];if(pe.type!=="model")continue;const{queryFeature:de,intersectionZ:Ce}=pe.queryIntersectsMatchingFeature(y,q.featureIndex,g,b);de&&this.appendToResult(P,oe,q.featureIndex,de,Ce)}else this.loadMatchingFeature(P,q,g,d.layers,d.availableImages,i,l,h,(oe,pe,de,Ce=0)=>(Q||(Q=zi(oe,this.tileID.canonical,t.tileTransform)),pe.queryIntersectsFeature(y,oe,de,Q,this.z,t.transform,t.pixelPosMatrix,M,Ce)))}return P}loadMatchingFeature(t,i,l,h,d,g,y,b,E){const{featureIndex:A,bucketIndex:M,sourceLayerIndex:P,layoutVertexArrayOffset:O}=i,z=this.bucketLayerIDs[M];if(h&&!function(oe,pe){for(let de=0;de<oe.length;de++)if(pe.indexOf(oe[de])>=0)return!0;return!1}(h,z))return;const j=this.sourceLayerCoder.decode(P),q=this.vtLayers[j].feature(A);if(l.needGeometry){const oe=Ai(q,!0);if(!l.filter(new ri(this.tileID.overscaledZ),oe,this.tileID.canonical))return}else if(!l.filter(new ri(this.tileID.overscaledZ),q))return;const Q=this.getId(q,j);for(let oe=0;oe<z.length;oe++){const pe=z[oe];if(h&&h.indexOf(pe)<0)continue;const de=g[pe];if(!de)continue;let Ce={};Q!==void 0&&b&&(Ce=b.getState(de.sourceLayer||"_geojsonTileLayer",Q));const Ee=!E||E(q,de,Ce,O);if(!Ee)continue;const Le=new J3(q,this.z,this.x,this.y,Q),je=Se({},y[pe]);je.paint=eM(je.paint,de.paint,q,Ce,d),je.layout=eM(je.layout,de.layout,q,Ce,d),Le.layer=je,this.appendToResult(t,pe,A,Le,Ee)}}appendToResult(t,i,l,h,d){let g=t[i];g===void 0&&(g=t[i]=[]),g.push({featureIndex:l,feature:h,intersectionZ:d})}lookupSymbolFeatures(t,i,l,h,d,g,y,b){const E={};this.loadVTLayers();const A=Ka(d);for(const M of t)this.loadMatchingFeature(E,{bucketIndex:l,sourceLayerIndex:h,featureIndex:M,layoutVertexArrayOffset:0},A,g,y,b,i);return E}loadFeature(t){const{featureIndex:i,sourceLayerIndex:l}=t;this.loadVTLayers();const h=this.sourceLayerCoder.decode(l),d=this.vtFeatures[h];if(d[i])return d[i];const g=this.vtLayers[h].feature(i);return d[i]=g,g}hasLayer(t){for(const i of this.bucketLayerIDs)for(const l of i)if(t===l)return!0;return!1}getId(t,i){let l=t.id;if(this.promoteId){const h=typeof this.promoteId=="string"?this.promoteId:this.promoteId[i];h!=null&&(l=t.properties[h]),typeof l=="boolean"&&(l=Number(l))}return l}}function eM(r,t,i,l,h){return zt(r,(d,g)=>{const y=t instanceof fh?t.get(g):null;return y&&y.evaluate?y.evaluate(i,l,h):y})}function vz(r,t){return t-r}rr(Q3,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const Yw=new Float32Array(262144),zh=new Uint8Array(262144);function tM(r){let t=0;if(r.meshes)for(const i of r.meshes)t=Math.max(t,i.aabb.max[2]);if(r.children)for(const i of r.children)t=Math.max(t,tM(i));return t}function rM(r,t,i){if(r.meshes)for(const l of r.meshes)l.aabb.min[0]!==1/0&&i.insert(t,l.aabb.min[0],l.aabb.min[1],l.aabb.max[0],l.aabb.max[1]);if(r.children)for(const l of r.children)rM(l,t,i)}const nM=["","wall","door","roof","window","lamp","logo"];class iM{constructor(t){this.node=t,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:t.id,geometry:[],properties:{height:tM(t)}}}getLocalBounds(){if(!this.node.meshes)return new li([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let t=0;const i=new li([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const l of this.node.meshes)this.node.lightMeshIndex!==t&&i.encapsulate(l.aabb),t++;this.aabb=i}return this.aabb}}class Xx{constructor(t,i,l,h,d,g){this.id=i,this.modelTraits|=gd.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,l&&(this.modelTraits|=gd.HasMapboxMeshFeatures),h&&(this.modelTraits|=gd.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=d,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(const y of t)this.nodesInfo.push(new iM(y)),rM(y,g.featureIndexArray.length,g.grid),g.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,g.bucketLayerIDs.length-1,0)}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(t){if(!this.needsUpload)return;const i=this.getNodesInfo();for(const l of i){const h=l.node;this.uploaded?this.updatePbrBuffer(h):jw(h,t,!0)}for(const l of i)Gx(l.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(t){let i=!1;if(!t.meshes)return i;for(const l of t.meshes)l.pbrBuffer&&(l.pbrBuffer.updateData(l.featureArray),i=!0);return i}needsReEvaluation(t,i,l){const h=t.transform.projectionOptions,d=t.style.getBrightness(),g=this.brightness!==d;return!!(!this.uploaded||this.dirty||h.name!==this.projection.name||xm(l.paint.get("model-color").value,g)||xm(l.paint.get("model-color-mix-intensity").value,g)||xm(l.paint.get("model-roughness").value,g)||xm(l.paint.get("model-emissive-strength").value,g)||xm(l.paint.get("model-height-based-emissive-strength-multiplier").value,g))&&(this.projection=h,this.brightness=d,!0)}evaluateScale(t,i){if(t.transform.zoom===this.zoom)return;this.zoom=t.transform.zoom;const l=this.getNodesInfo(),h=this.id.canonical;for(const d of l){const g=d.feature;d.evaluatedScale=i.paint.get("model-scale").evaluate(g,{},h)}}evaluate(t){const i=this.getNodesInfo();for(const l of i){if(!l.node.meshes)continue;const h=l.feature,d=l.node.meshes&&l.node.meshes[0].featureData,g=l.evaluatedColor[2],y=l.evaluatedRMEA[2],b=this.id.canonical;if(l.hasTranslucentParts=!1,d){for(let E=0;E<nM.length;E++){const A=nM[E];A.length&&(h.properties.part=A);const M=t.paint.get("model-color").evaluate(h,{},b),P=t.paint.get("model-color-mix-intensity").evaluate(h,{},b);l.evaluatedColor[E]=[M.r,M.g,M.b,P],l.evaluatedRMEA[E][0]=t.paint.get("model-roughness").evaluate(h,{},b),l.evaluatedRMEA[E][2]=t.paint.get("model-emissive-strength").evaluate(h,{},b),l.evaluatedRMEA[E][3]=M.a,l.emissionHeightBasedParams[E]=t.paint.get("model-height-based-emissive-strength-multiplier").evaluate(h,{},b),!l.hasTranslucentParts&&M.a<1&&(l.hasTranslucentParts=!0)}delete h.properties.part,bz(l,g!==l.evaluatedColor[2]||y!==l.evaluatedRMEA[2],this.modelTraits)}else l.evaluatedRMEA[0][2]=t.paint.get("model-emissive-strength").evaluate(h,{},b);l.evaluatedScale=t.paint.get("model-scale").evaluate(h,{},b),this.updatePbrBuffer(l.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(t,i,l,h){const d=t.findDEMTileFor(l);if(d&&(d.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(d.dem&&d.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=d.tileID.overscaledZ;const g=sd.create(t,l,d);if(!g)return;this.modelTraits&gd.HasMapboxMeshFeatures&&this.updateDEM(t,g,l,h);for(const y of this.getNodesInfo()){const b=y.node;if(!b.footprint||!b.footprint.vertices||!b.footprint.vertices.length)continue;const E=b.footprint.vertices;let A=g.getElevationAt(E[0].x,E[0].y,!0,!0);for(let M=1;M<E.length;M++)A=Math.min(A,g.getElevationAt(E[M].x,E[M].y,!0,!0));b.elevation=A}}this.terrainTile=d.tileID.canonical,this.terrainExaggeration=i}}updateDEM(t,i,l,h){let d=i._dem._modifiedForSources[h];if(d===void 0&&(i._dem._modifiedForSources[h]=[],d=i._dem._modifiedForSources[h]),d.includes(l.canonical))return;const g=i._dem.dim;d.push(l.canonical);let y=!1;for(const b of this.getNodesInfo()){const E=b.node;if(!E.footprint||!E.footprint.grid)continue;const A=E.footprint.grid,M=i.tileCoordToPixel(A.min.x,A.min.y),P=i.tileCoordToPixel(A.max.x,A.max.y),O=Math.min(Math.min(g-P.y,M.x),Math.min(M.y,g-P.x));if(O<0)continue;const z=st(O,2,5);let j=Math.max(0,M.x-z),q=Math.max(0,M.y-z),Q=Math.min(P.x+z,g-1),oe=Math.min(P.y+z,g-1);for(let Ee=q;Ee<=oe;++Ee)for(let Le=j;Le<=Q;++Le)zh[Ee*g+Le]=255;let pe=0,de=0;for(let Ee=0;Ee<A.cellsY;++Ee)for(let Le=0;Le<A.cellsX;++Le){if(!A.cells[Ee*A.cellsX+Le])continue;const je=i.tileCoordToPixel(A.min.x+Le/A.xScale,A.min.y+Ee/A.yScale),Ze=i.tileCoordToPixel(A.min.x+(Le+1)/A.xScale,A.min.y+(Ee+1)/A.yScale);for(let it=je.y;it<=Math.min(Ze.y+1,g-1);++it)for(let Ye=je.x;Ye<=Math.min(Ze.x+1,g-1);++Ye)zh[it*g+Ye]===255&&(zh[it*g+Ye]=0,pe+=i.getElevationAtPixel(Ye,it),de++)}const Ce=pe/de;j=Math.max(1,M.x-z),q=Math.max(1,M.y-z),Q=Math.min(P.x+z,g-2),oe=Math.min(P.y+z,g-2),y=!0;for(let Ee=q;Ee<=oe;++Ee)for(let Le=j;Le<=Q;++Le)zh[Ee*g+Le]===0&&(Yw[Ee*g+Le]=i._dem.set(Le,Ee,Ce));for(let Ee=1;Ee<z;++Ee){j=Math.max(1,M.x-Ee),q=Math.max(1,M.y-Ee),Q=Math.min(P.x+Ee,g-2),oe=Math.min(P.y+Ee,g-2);for(let Le=q;Le<=oe;++Le)for(let je=j;je<=Q;++je){const Ze=Le*g+je;if(zh[Ze]===255){let it=0,Ye=0,mt=-1,bt=-1;for(let ht=-1;ht<=1;++ht)for(let wt=-1;wt<=1;++wt){const lt=(Le+ht)*g+je+wt;if(zh[lt]>=Ee)continue;const vt=Yw[lt],Gt=Math.abs(vt);Gt>Ye&&(it=vt,Ye=Gt,mt=wt,bt=ht)}if(Ye>.1){const ht=1-(Ee+.5*Math.abs(mt*bt))/z;let wt=i._dem.get(je,Le)+it*ht;const lt=i._dem.get(je+mt,Le+bt),vt=i._dem.get(je-mt,Le-bt,!0);(wt-lt)*(wt-vt)>0&&(wt=(lt+vt)/2),Yw[Ze]=i._dem.set(je,Le,wt),zh[Ze]=Ee}}}}}y&&(i._demTile.needsDEMTextureUpload=!0,i._dem._timestamp=_t.now())}getNodesInfo(){return this.nodesInfo}destroy(){const t=this.getNodesInfo();for(const i of t)Gx(i.node),Gw(i.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(t,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const l=i.getReplacementRegionsForTile(t.toUnwrapped()),h=this.getNodesInfo();for(let d=0;d<this.nodesInfo.length;d++){const g=h[d].node;h[d].hiddenByReplacement=!!g.footprint&&!l.find(y=>y.footprint===g.footprint)}}getHeightAtTileCoord(t,i){const l=this.getNodesInfo(),h=[];for(let d=0;d<this.nodesInfo.length;d++){const g=l[d],y=g.node.meshes[0];if(t<y.aabb.min[0]||i<y.aabb.min[1]||t>y.aabb.max[0]||i>y.aabb.max[1])continue;const b=(t-y.aabb.min[0])/(y.aabb.max[0]-y.aabb.min[0])*Oh|0,E=Math.min(63,(i-y.aabb.min[1])/(y.aabb.max[1]-y.aabb.min[1])*Oh|0)*Oh+Math.min(63,b);if(!(y.heightmap[E]<0&&g.node.footprint))return g.hiddenByReplacement?void 0:{height:y.heightmap[E],maxHeight:g.feature.properties.height,hidden:!1,verticalScale:g.evaluatedScale[2]};if(g.node.footprint.grid.query(new we(t,i),new we(t,i),h),h.length>0)return{height:void 0,maxHeight:g.feature.properties.height,hidden:g.hiddenByReplacement,verticalScale:g.evaluatedScale[2]}}}}function xm(r,t){return!r.isLightConstant&&t}function wz(r,t,i,l,h,d,g,y){let b=(61440&t|(61440&t)>>4)>>8,E=(3840&t|(3840&t)>>4)>>4,A=240&t|(240&t)>>4;i[3]>0&&(b=Kr(b,255*i[0],i[3]),E=Kr(E,255*i[1],i[3]),A=Kr(A,255*i[2],i[3]));const M=b<<8|E,P=A<<8|Math.floor(255*l[3]),O=function(Ee){const Le=st(Ee,0,2);return Math.min(Math.round(.5*Le*255),255)}(l[2])<<8|15*l[0]<<4|15*l[1],z=st(h[0],0,1),j=st(h[1],0,1),q=st(h[2],0,1),Q=st(h[3],0,1);let oe,pe,de,Ce;if(z!==j&&g!==d&&j!==z){const Ee=g-d;pe=1/(Ee*(j-z)),de=-(d+Ee*z)/(Ee*(j-z));const Le=st(h[4],-1,1);Ce=Math.pow(10,Le),oe=255*q<<8|255*Q}else oe=65535,pe=0,de=1,Ce=1;if(r.emplaceBack(M,P,O,oe,pe,de,Ce),y){const Ee=y.length;y.clear();for(let Le=0;Le<Ee;Le++)y.emplaceBack(M,P,O,oe,pe,de,Ce)}}function bz(r,t,i){const l=r.node;let h=0;const d=i&gd.HasMeshoptCompression;for(const g of l.meshes){if(l.lights&&l.lightMeshIndex===h||!g.featureData)continue;g.featureArray=new Sh,g.featureArray.reserve(g.featureData.length);let y=t;for(const b of g.featureData){const E=d?65535&b:b>>16&65535,A=d?b>>16&65535:65535&b,M=(15&A)<8?15&A:0,P=r.evaluatedRMEA[M],O=r.evaluatedColor[M],z=r.emissionHeightBasedParams[M];let j;if(y&&M===2&&l.lights&&(j=new Sh,j.resize(10*l.lights.length)),wz(g.featureArray,E,O,P,z,g.aabb.min[2],g.aabb.max[2],j),j&&y){y=!1;const q=l.meshes[l.lightMeshIndex];q.featureArray=j,q.featureArray._trim()}}g.featureArray._trim(),h++}}function aM(r,t,i,l){const h=1<<r.z;t.lat=en((l/Kt+r.y)/h),t.lng=Mr((i/Kt+r.x)/h)}rr(Xx,"Tiled3dModelBucket",{omit:["layers"]}),rr(iM,"Tiled3dModelFeature");const Tz={circle:class extends Da{constructor(r,t,i){super(r,m5,t,i)}createBucket(r){return new Oa(r)}queryRadius(r){const t=r;return nd("circle-radius",this,t)+nd("circle-stroke-width",this,t)+rx(this.paint.get("circle-translate"))}queryIntersectsFeature(r,t,i,l,h,d,g,y){const b=bA(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),d.angle,r.pixelToTileUnitsFactor),E=this.paint.get("circle-radius").evaluate(t,i)+this.paint.get("circle-stroke-width").evaluate(t,i);return XC(r,l,d,g,y,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",b,E)}getProgramIds(){return["circle"]}getDefaultProgramParams(r,t){const i=ZC(this);return{config:new W(this,t),defines:i,overrideFog:!1}}},heatmap:class extends Da{createBucket(r){return new KC(r)}constructor(r,t,i){super(r,W5,t,i),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(r){r==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=K0({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(r){return nd("heatmap-radius",this,r)}queryIntersectsFeature(r,t,i,l,h,d,g,y){const b=this.paint.get("heatmap-radius").evaluate(t,i);return XC(r,l,d,g,y,!0,!0,new we(0,0),b)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(r,t){return r==="heatmap"?{config:new W(this,t),overrideFog:!1}:{}}},hillshade:class extends Da{constructor(r,t,i){super(r,Z5,t,i)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(r,t){return{overrideFog:!1}}},fill:class extends Da{constructor(r,t,i){super(r,lN,t,i)}getProgramIds(){const r=this.paint.get("fill-pattern"),t=r&&r.constantOr(1),i=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(r,t){return{config:new W(this,t),overrideFog:!1}}recalculate(r,t){super.recalculate(r,t);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(r){return new ww(r)}queryRadius(){return rx(this.paint.get("fill-translate"))}queryIntersectsFeature(r,t,i,l,h,d){return!r.queryGeometry.isAboveHorizon&&Jl(wA(r.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),d.angle,r.pixelToTileUnitsFactor),l)}isTileClipped(){return!0}},"fill-extrusion":class extends Da{constructor(r,t,i){super(r,ON,t,i),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(r){return new bx(r)}queryRadius(){return rx(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(r,t,i,l,h,d,g,y,b){const E=bA(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),d.angle,r.pixelToTileUnitsFactor),A=this.paint.get("fill-extrusion-height").evaluate(t,i),M=this.paint.get("fill-extrusion-base").evaluate(t,i),P=[0,0],O=y&&d.elevation,z=d.elevation?d.elevation.exaggeration():1,j=r.tile.getBucket(this);if(O&&j instanceof bx){const de=j.centroidVertexArray,Ce=b+1;Ce<de.length&&(P[0]=de.geta_centroid_pos0(Ce),P[1]=de.geta_centroid_pos1(Ce))}if(P[0]===0&&P[1]===1)return!1;d.projection.name==="globe"&&(l=Rk([l],[new we(0,0),new we(Kt,Kt)],r.tileID.canonical).map(de=>de.polygon).flat());const q=O?y:null,[Q,oe]=function(de,Ce,Ee,Le,je,Ze,it,Ye,mt,bt,ht){return de.projection.name==="globe"?function(wt,lt,vt,Gt,Tt,ar,Qt,It,vr,hr,ir){const Pt=[],gr=[],Vr=wt.projection.upVectorScale(ir,wt.center.lat,wt.worldSize).metersToTile,wr=[0,0,0,1],$r=[0,0,0,1],kr=(Rr,Rn,hn,pn)=>{Rr[0]=Rn,Rr[1]=hn,Rr[2]=pn,Rr[3]=1},Jr=Pk();vt>0&&(vt+=Jr),Gt+=Jr;for(const Rr of lt){const Rn=[],hn=[];for(const pn of Rr){const xn=pn.x+Tt.x,fn=pn.y+Tt.y,Qn=wt.projection.projectTilePoint(xn,fn,ir),Cn=wt.projection.upVector(ir,pn.x,pn.y);let hi=vt,Pi=Gt;if(Qt){const Qi=Fk(xn,fn,vt,Gt,Qt,It,vr,hr);hi+=Qi.base,Pi+=Qi.top}vt!==0?kr(wr,Qn.x+Cn[0]*Vr*hi,Qn.y+Cn[1]*Vr*hi,Qn.z+Cn[2]*Vr*hi):kr(wr,Qn.x,Qn.y,Qn.z),kr($r,Qn.x+Cn[0]*Vr*Pi,Qn.y+Cn[1]*Vr*Pi,Qn.z+Cn[2]*Vr*Pi),o.N.transformMat4(wr,wr,ar),o.N.transformMat4($r,$r,ar),Rn.push(new od(wr[0],wr[1],wr[2])),hn.push(new od($r[0],$r[1],$r[2]))}Pt.push(Rn),gr.push(hn)}return[Pt,gr]}(de,Ce,Ee,Le,je,Ze,it,Ye,mt,bt,ht):it?function(wt,lt,vt,Gt,Tt,ar,Qt,It,vr){const hr=[],ir=[],Pt=[0,0,0,1];for(const gr of wt){const Vr=[],wr=[];for(const $r of gr){const kr=$r.x+Gt.x,Jr=$r.y+Gt.y,Rr=Fk(kr,Jr,lt,vt,ar,Qt,It,vr);Pt[0]=kr,Pt[1]=Jr,Pt[2]=Rr.base,Pt[3]=1,o.a7.transformMat4(Pt,Pt,Tt),Pt[3]=Math.max(Pt[3],1e-5);const Rn=new od(Pt[0]/Pt[3],Pt[1]/Pt[3],Pt[2]/Pt[3]);Pt[0]=kr,Pt[1]=Jr,Pt[2]=Rr.top,Pt[3]=1,o.a7.transformMat4(Pt,Pt,Tt),Pt[3]=Math.max(Pt[3],1e-5);const hn=new od(Pt[0]/Pt[3],Pt[1]/Pt[3],Pt[2]/Pt[3]);Vr.push(Rn),wr.push(hn)}hr.push(Vr),ir.push(wr)}return[hr,ir]}(Ce,Ee,Le,je,Ze,it,Ye,mt,bt):function(wt,lt,vt,Gt,Tt){const ar=[],Qt=[],It=Tt[8]*lt,vr=Tt[9]*lt,hr=Tt[10]*lt,ir=Tt[11]*lt,Pt=Tt[8]*vt,gr=Tt[9]*vt,Vr=Tt[10]*vt,wr=Tt[11]*vt;for(const $r of wt){const kr=[],Jr=[];for(const Rr of $r){const Rn=Rr.x+Gt.x,hn=Rr.y+Gt.y,pn=Tt[0]*Rn+Tt[4]*hn+Tt[12],xn=Tt[1]*Rn+Tt[5]*hn+Tt[13],fn=Tt[2]*Rn+Tt[6]*hn+Tt[14],Qn=Tt[3]*Rn+Tt[7]*hn+Tt[15],Cn=pn+It,hi=xn+vr,Pi=fn+hr,Qi=Math.max(Qn+ir,1e-5),Kn=pn+Pt,si=xn+gr,Gi=fn+Vr,Hi=Math.max(Qn+wr,1e-5);kr.push(new od(Cn/Qi,hi/Qi,Pi/Qi)),Jr.push(new od(Kn/Hi,si/Hi,Gi/Hi))}ar.push(kr),Qt.push(Jr)}return[ar,Qt]}(Ce,Ee,Le,je,Ze)}(d,l,M,A,E,g,q,P,z,d.center.lat,r.tileID.canonical),pe=r.queryGeometry;return function(de,Ce,Ee){let Le=1/0;Jl(Ee,Ce)&&(Le=Dk(Ee,Ce[0]));for(let je=0;je<Ce.length;je++){const Ze=Ce[je],it=de[je];for(let Ye=0;Ye<Ze.length-1;Ye++){const mt=Ze[Ye],bt=[mt,Ze[Ye+1],it[Ye+1],it[Ye],mt];eo(Ee,bt)&&(Le=Math.min(Le,Dk(Ee,bt)))}}return Le!==1/0&&Le}(Q,oe,pe.isPointQuery()?pe.screenBounds:pe.screenGeometry)}},line:class extends Da{constructor(r,t,i){super(r,Ok,t,i),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(r){if(r==="line-gradient"){const t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof nh,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(r,t){super.recalculate(r,t),this.paint._values["line-floorwidth"]=$k.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)}createBucket(r){return new Ew(r)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(r,t){const i=Uk(this);return{config:new W(this,t),defines:i,overrideFog:!1}}queryRadius(r){const t=r,i=jk(nd("line-width",this,t),nd("line-gap-width",this,t)),l=nd("line-offset",this,t);return i/2+Math.abs(l)+rx(this.paint.get("line-translate"))}queryIntersectsFeature(r,t,i,l,h,d){if(r.queryGeometry.isAboveHorizon)return!1;const g=wA(r.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),d.angle,r.pixelToTileUnitsFactor),y=r.pixelToTileUnitsFactor/2*jk(this.paint.get("line-width").evaluate(t,i),this.paint.get("line-gap-width").evaluate(t,i)),b=this.paint.get("line-offset").evaluate(t,i);return b&&(l=function(E,A){const M=[],P=new we(0,0);for(let O=0;O<E.length;O++){const z=E[O],j=[];for(let q=0;q<z.length;q++){const Q=z[q],oe=z[q+1],pe=q===0?P:Q.sub(z[q-1])._unit()._perp(),de=q===z.length-1?P:oe.sub(Q)._unit()._perp(),Ce=pe._add(de)._unit();Ce._mult(1/(Ce.x*de.x+Ce.y*de.y)),j.push(Ce._mult(A)._add(Q))}M.push(j)}return M}(l,b*r.pixelToTileUnitsFactor)),function(E,A,M){for(let P=0;P<A.length;P++){const O=A[P];if(E.length>=3){for(let z=0;z<O.length;z++)if(ko(E,O[z]))return!0}if(Ih(E,O,M))return!0}return!1}(g,l,y)}isTileClipped(){return!0}},symbol:zx,background:class extends Da{constructor(r,t,i){super(r,B6,t,i)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(r,t){return{overrideFog:!1}}},raster:k3,"raster-particle":M3,sky:class extends Da{constructor(r,t,i){super(r,q6,t,i),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(r){r==="sky-gradient"?this._updateColorRamp():r!=="sky-atmosphere-sun"&&r!=="sky-atmosphere-halo-color"&&r!=="sky-atmosphere-color"&&r!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=K0({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(r){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=r.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(r,t){if(this.paint.get("sky-type")==="atmosphere"){const l=this.paint.get("sky-atmosphere-sun"),h=!l,d=r.style.light,g=d.properties.get("position");return h&&d.properties.get("anchor")==="viewport"&&Tr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),h?Uw(g.azimuthal,90-g.polar,t):Uw(l[0],90-l[1],t)}const i=this.paint.get("sky-gradient-center");return Uw(i[0],90-i[1],t)}isSky(){return!0}markSkyboxValid(r){this._skyboxInvalidated=!1,this._lightPosition=r.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const r=this.paint.get("sky-type");return r==="atmosphere"?["skyboxCapture","skybox"]:r==="gradient"?["skyboxGradient"]:null}},slot:class extends Da{constructor(r,t,i){super(r,Z6,t)}},model:class extends Da{constructor(r,t,i){super(r,nz,t,i),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(r){return new $w(r)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(r){return r instanceof Xx?Kt-1:0}queryIntersectsFeature(r,t,i,l,h,d){if(!this.modelManager)return!1;const g=this.modelManager,y=r.tile.getBucket(this);if(!(y&&y instanceof $w))return!1;const b=y;for(const E in b.instancesPerModel){const A=b.instancesPerModel[E];if(A.idToFeaturesIndex.hasOwnProperty(t.id)){const M=A.features[A.idToFeaturesIndex[t.id]],P=g.getModel(E,this.scope);if(!P)return!1;let O=o.a6.create();const z=new qe(0,0),j=b.canonical;let q=Number.MAX_VALUE;for(let Q=0;Q<M.instancedDataCount;++Q){const oe=16*(M.instancedDataOffset+Q),pe=A.instancedDataArray.float32,de=[pe[oe+4],pe[oe+5],pe[oe+6]];aM(j,z,pe[oe],0|pe[oe+1]),z3(O,P,d,z,M.rotation,M.scale,de,!1,!1,!1),d.projection.name==="globe"&&(O=Vw(O,d));const Ce=o.a6.multiply([],d.projMatrix,O),Ee=r.queryGeometry,Le=L3(Ee.isPointQuery()?Ee.screenBounds:Ee.screenGeometry,d,Ce,P.aabb);Le!=null&&(q=Math.min(Le,q))}return q!==Number.MAX_VALUE&&q}}return!1}_handleOverridablePaintPropertyUpdate(r,t,i){return!(!this.layout||t.isDataDriven()||i.isDataDriven()||r!=="model-color"&&r!=="model-color-mix-intensity"&&r!=="model-rotation"&&r!=="model-scale"&&r!=="model-translation"&&r!=="model-emissive-strength")}_isPropertyZoomDependent(r){const t=this._transitionablePaint._values[r];return t!=null&&t.value!=null&&t.value.expression!=null&&t.value.expression instanceof lh}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(r,t,i,l){const h=r.tile,d=h.getBucket(this);let g=null,y=Number.MAX_VALUE;if(!(d&&d instanceof Xx))return{queryFeature:g,intersectionZ:y};const b=d.getNodesInfo()[t];if(b.hiddenByReplacement||!b.node.meshes||!i.filter(new ri(h.tileID.overscaledZ),b.feature,h.tileID.canonical))return{queryFeature:g,intersectionZ:y};const E=b.node,A=l.calculatePosMatrix(h.tileID.toUnwrapped(),l.worldSize),M=b.evaluatedScale;let P=0;l.elevation&&E.elevation&&(P=E.elevation*l.elevation.exaggeration()),o.a6.translate(A,A,[(E.anchor?E.anchor[0]:0)*(M[0]-1),(E.anchor?E.anchor[1]:0)*(M[1]-1),P]),o.a6.scale(A,A,M),o.a6.multiply(A,A,E.matrix);const O=r.queryGeometry,z=O.isPointQuery()?O.screenBounds:O.screenGeometry,j=function(Q){const oe=o.a6.multiply([],A,Q.matrix),pe=o.a6.multiply(oe,l.expandedFarZProjMatrix,oe);for(let de=0;de<Q.meshes.length;++de){const Ce=Q.meshes[de];if(de===Q.lightMeshIndex)continue;const Ee=L3(z,l,pe,Ce.aabb);Ee!=null&&(y=Math.min(Ee,y))}if(Q.children)for(const de of Q.children)j(de)};if(j(E),y===Number.MAX_VALUE)return{queryFeature:g,intersectionZ:y};const q=new qe(0,0);return aM(h.tileID.canonical,q,b.node.anchor[0],b.node.anchor[1]),g={type:"Feature",geometry:{type:"Point",coordinates:[q.lng,q.lat]},properties:b.feature.properties,id:b.feature.id,state:{},layer:this.serialize()},{queryFeature:g,intersectionZ:y}}}},Fr={read:function(r,t){return r.readFields(Fr._readField,{header_length:0,x:0,y:0,z:0,layers:[]},t)},_readField:function(r,t,i){r===1?t.header_length=i.readFixed32():r===2?t.x=i.readVarint():r===3?t.y=i.readVarint():r===4?t.z=i.readVarint():r===5&&t.layers.push(Fr.Layer.read(i,i.readVarint()+i.pos))},PixelFormat:{PIXEL_FORMAT_UNKNOWN:{value:0,options:{}},PIXEL_FORMAT_UINT32:{value:1,options:{}},PIXEL_FORMAT_UINT16:{value:2,options:{}},PIXEL_FORMAT_UINT8:{value:3,options:{}}},Filter:{}};Fr.Filter.read=function(r,t){return r.readFields(Fr.Filter._readField,{delta_filter:null,filter:null,zigzag_filter:null,bitshuffle_filter:null,byteshuffle_filter:null},t)},Fr.Filter._readField=function(r,t,i){r===1?(t.delta_filter=Fr.Filter.Delta.read(i,i.readVarint()+i.pos),t.filter="delta_filter"):r===2?(t.zigzag_filter=Fr.Filter.Zigzag.read(i,i.readVarint()+i.pos),t.filter="zigzag_filter"):r===3?(t.bitshuffle_filter=Fr.Filter.BitShuffle.read(i,i.readVarint()+i.pos),t.filter="bitshuffle_filter"):r===4&&(t.byteshuffle_filter=Fr.Filter.ByteShuffle.read(i,i.readVarint()+i.pos),t.filter="byteshuffle_filter")},Fr.Filter.Delta={},Fr.Filter.Delta.read=function(r,t){return r.readFields(Fr.Filter.Delta._readField,{block_size:0},t)},Fr.Filter.Delta._readField=function(r,t,i){r===1&&(t.block_size=i.readVarint())},Fr.Filter.Zigzag={},Fr.Filter.Zigzag.read=function(r,t){return r.readFields(Fr.Filter.Zigzag._readField,{},t)},Fr.Filter.Zigzag._readField=function(r,t,i){},Fr.Filter.BitShuffle={},Fr.Filter.BitShuffle.read=function(r,t){return r.readFields(Fr.Filter.BitShuffle._readField,{},t)},Fr.Filter.BitShuffle._readField=function(r,t,i){},Fr.Filter.ByteShuffle={},Fr.Filter.ByteShuffle.read=function(r,t){return r.readFields(Fr.Filter.ByteShuffle._readField,{},t)},Fr.Filter.ByteShuffle._readField=function(r,t,i){},Fr.Codec={},Fr.Codec.read=function(r,t){return r.readFields(Fr.Codec._readField,{gzip_data:null,codec:null,jpeg_image:null,webp_image:null,png_image:null},t)},Fr.Codec._readField=function(r,t,i){r===1?(t.gzip_data=Fr.Codec.GzipData.read(i,i.readVarint()+i.pos),t.codec="gzip_data"):r===2?(t.jpeg_image=Fr.Codec.JpegImage.read(i,i.readVarint()+i.pos),t.codec="jpeg_image"):r===3?(t.webp_image=Fr.Codec.WebpImage.read(i,i.readVarint()+i.pos),t.codec="webp_image"):r===4&&(t.png_image=Fr.Codec.PngImage.read(i,i.readVarint()+i.pos),t.codec="png_image")},Fr.Codec.GzipData={},Fr.Codec.GzipData.read=function(r,t){return r.readFields(Fr.Codec.GzipData._readField,{},t)},Fr.Codec.GzipData._readField=function(r,t,i){},Fr.Codec.JpegImage={},Fr.Codec.JpegImage.read=function(r,t){return r.readFields(Fr.Codec.JpegImage._readField,{},t)},Fr.Codec.JpegImage._readField=function(r,t,i){},Fr.Codec.WebpImage={},Fr.Codec.WebpImage.read=function(r,t){return r.readFields(Fr.Codec.WebpImage._readField,{},t)},Fr.Codec.WebpImage._readField=function(r,t,i){},Fr.Codec.PngImage={},Fr.Codec.PngImage.read=function(r,t){return r.readFields(Fr.Codec.PngImage._readField,{},t)},Fr.Codec.PngImage._readField=function(r,t,i){},Fr.DataIndexEntry={},Fr.DataIndexEntry.read=function(r,t){return r.readFields(Fr.DataIndexEntry._readField,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},t)},Fr.DataIndexEntry._readField=function(r,t,i){r===1?t.first_byte=i.readFixed64():r===2?t.last_byte=i.readFixed64():r===3?t.filters.push(Fr.Filter.read(i,i.readVarint()+i.pos)):r===4?t.codec=Fr.Codec.read(i,i.readVarint()+i.pos):r===5?t.offset=i.readFloat():r===6?t.scale=i.readFloat():r===7&&t.bands.push(i.readString())},Fr.Layer={},Fr.Layer.read=function(r,t){return r.readFields(Fr.Layer._readField,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},t)},Fr.Layer._readField=function(r,t,i){r===1?t.version=i.readVarint():r===2?t.name=i.readString():r===3?t.units=i.readString():r===4?t.tilesize=i.readVarint():r===5?t.buffer=i.readVarint():r===6?t.pixel_format=i.readVarint():r===7&&t.data_index.push(Fr.DataIndexEntry.read(i,i.readVarint()+i.pos))};const Fo={read:function(r,t){return r.readFields(Fo._readField,{uint32_values:null,values:null,fixed32_values:null},t)},_readField:function(r,t,i){r===2?(t.uint32_values=Fo.Uint32Values.read(i,i.readVarint()+i.pos),t.values="uint32_values"):r===3&&(t.fixed32_values=Fo.Fixed32Values.read(i,i.readVarint()+i.pos),t.values="fixed32_values")},Uint32Values:{}};Fo.Uint32Values.read=function(r,t){return r.readFields(Fo.Uint32Values._readField,{values:[]},t)},Fo.Uint32Values._readField=function(r,t,i){r===1&&(t.readValuesInto=function(l){if(l.type!==2)throw new Error(`Unsupported pbf type "${l.type}"`);const h=function(g){return g.type===2?g.readVarint()+g.pos:g.pos+1}(l),d=l.pos;return l.pos=h,function(g){l.pos=d;let y=0;for(;l.pos<h;){const b=l.readVarint();g[y++]=b}return g}}(i))},Fo.Fixed32Values={},Fo.Fixed32Values.read=function(r,t){return r.readFields(Fo.Fixed32Values._readField,{values:[]},t)},Fo.Fixed32Values._readField=function(r,t,i){throw new Error("Not implemented")};/**
 * tiny-lru
 *
 * @copyright 2023 Jason Mulligan <jason.mulligan@avoidwork.com>
 * @license BSD-3-Clause
 * @version 11.2.5
 */class Ez{constructor(t=0,i=0,l=!1){this.first=null,this.items=Object.create(null),this.last=null,this.max=t,this.resetTtl=l,this.size=0,this.ttl=i}clear(){return this.first=null,this.items=Object.create(null),this.last=null,this.size=0,this}delete(t){if(this.has(t)){const i=this.items[t];delete this.items[t],this.size--,i.prev!==null&&(i.prev.next=i.next),i.next!==null&&(i.next.prev=i.prev),this.first===i&&(this.first=i.next),this.last===i&&(this.last=i.prev)}return this}entries(t=this.keys()){return t.map(i=>[i,this.get(i)])}evict(t=!1){if(t||this.size>0){const i=this.first;delete this.items[i.key],--this.size==0?(this.first=null,this.last=null):(this.first=i.next,this.first.prev=null)}return this}expiresAt(t){let i;return this.has(t)&&(i=this.items[t].expiry),i}get(t){let i;if(this.has(t)){const l=this.items[t];this.ttl>0&&l.expiry<=Date.now()?this.delete(t):(i=l.value,this.set(t,i,!0))}return i}has(t){return t in this.items}keys(){const t=[];let i=this.first;for(;i!==null;)t.push(i.key),i=i.next;return t}set(t,i,l=!1,h=this.resetTtl){let d;if(l||this.has(t)){if(d=this.items[t],d.value=i,l===!1&&h&&(d.expiry=this.ttl>0?Date.now()+this.ttl:this.ttl),this.last!==d){const g=this.last,y=d.next,b=d.prev;this.first===d&&(this.first=d.next),d.next=null,d.prev=this.last,g.next=d,b!==null&&(b.next=y),y!==null&&(y.prev=b)}}else this.max>0&&this.size===this.max&&this.evict(!0),d=this.items[t]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:t,prev:this.last,next:null,value:i},++this.size==1?this.first=d:this.last.next=d;return this.last=d,this}values(t=this.keys()){return t.map(i=>this.get(i))}}function Sz(r,t){if(t.length!==4)throw new Error(`Expected data of dimension 4 but got ${t.length}.`);let i=t[3];for(let l=2;l>=1;l--){const h=l===1?1:0,d=l===2?1:0;for(let g=0;g<t[0];g++){const y=t[1]*g;for(let b=h;b<t[1];b++){const E=t[2]*(b+y);for(let A=d;A<t[2];A++){const M=t[3]*(A+E);for(let P=0;P<t[3];P++){const O=M+P;r[O]+=r[O-i]}}}}i*=t[l]}return r}function Az(r){for(let t=0,i=r.length;t<i;t++)r[t]=r[t]>>>1^-(1&r[t]);return r}function Cz(r,t){switch(t){case"uint32":return r;case"uint16":for(let i=0;i<r.length;i+=2){const l=r[i],h=r[i+1];r[i]=(240&l)>>4|(61440&l)>>8|(240&h)<<4|61440&h,r[i+1]=15&l|(3840&l)>>4|(15&h)<<8|(3840&h)<<4}return r;case"uint8":for(let i=0;i<r.length;i+=4){const l=r[i],h=r[i+1],d=r[i+2],g=r[i+3];r[i+0]=(192&l)>>6|(192&h)>>4|(192&d)>>2|192&g,r[i+1]=(48&l)>>4|(48&h)>>2|48&d|(48&g)<<2,r[i+2]=(12&l)>>2|12&h|(12&d)<<2|(12&g)<<4,r[i+3]=3&l|(3&h)<<2|(3&d)<<4|(3&g)<<6}return r;default:throw new Error(`Invalid pixel format, "${t}"`)}}class ou extends Error{constructor(t){super(t),this.name="MRTError"}}var Ls=Uint8Array,vd=Uint16Array,kz=Int32Array,sM=new Ls([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),oM=new Ls([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Mz=new Ls([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),lM=function(r,t){for(var i=new vd(31),l=0;l<31;++l)i[l]=t+=1<<r[l-1];var h=new kz(i[30]);for(l=1;l<30;++l)for(var d=i[l];d<i[l+1];++d)h[d]=d-i[l]<<5|l;return{b:i,r:h}},cM=lM(sM,2),uM=cM.b,Iz=cM.r;uM[28]=258,Iz[258]=28;for(var Pz=lM(oM,0).b,Kw=new vd(32768),xi=0;xi<32768;++xi){var wd=(43690&xi)>>1|(21845&xi)<<1;Kw[xi]=((65280&(wd=(61680&(wd=(52428&wd)>>2|(13107&wd)<<2))>>4|(3855&wd)<<4))>>8|(255&wd)<<8)>>1}var ym=function(r,t,i){for(var l=r.length,h=0,d=new vd(t);h<l;++h)r[h]&&++d[r[h]-1];var g,y=new vd(t);for(h=1;h<t;++h)y[h]=y[h-1]+d[h-1]<<1;if(i){g=new vd(1<<t);var b=15-t;for(h=0;h<l;++h)if(r[h])for(var E=h<<4|r[h],A=t-r[h],M=y[r[h]-1]++<<A,P=M|(1<<A)-1;M<=P;++M)g[Kw[M]>>b]=E}else for(g=new vd(l),h=0;h<l;++h)r[h]&&(g[h]=Kw[y[r[h]-1]++]>>15-r[h]);return g},vm=new Ls(288);for(xi=0;xi<144;++xi)vm[xi]=8;for(xi=144;xi<256;++xi)vm[xi]=9;for(xi=256;xi<280;++xi)vm[xi]=7;for(xi=280;xi<288;++xi)vm[xi]=8;var hM=new Ls(32);for(xi=0;xi<32;++xi)hM[xi]=5;var Rz=ym(vm,9,1),Dz=ym(hM,5,1),Jw=function(r){for(var t=r[0],i=1;i<r.length;++i)r[i]>t&&(t=r[i]);return t},Lo=function(r,t,i){var l=t/8|0;return(r[l]|r[l+1]<<8)>>(7&t)&i},Qw=function(r,t){var i=t/8|0;return(r[i]|r[i+1]<<8|r[i+2]<<16)>>(7&t)},Fz=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Oo=function(r,t,i){var l=new Error(t||Fz[r]);if(l.code=r,Error.captureStackTrace&&Error.captureStackTrace(l,Oo),!i)throw l;return l},Lz=new Ls(0),Oz=typeof TextDecoder<"u"&&new TextDecoder;try{Oz.decode(Lz,{stream:!0})}catch{}const Nz={gzip_data:"gzip"},zz={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},Bz={uint32:1,uint16:2,uint8:4},Uz={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};class fM{constructor(t=1){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=t}getLayer(t){return this.layers[t]}getHeaderLength(t){const i=new Uint8Array(t),l=new DataView(t);if(i[0]!==13)throw new ou("File is not a valid MRT.");return l.getUint32(1,!0)}parseHeader(t){const i=new Uint8Array(t),l=this.getHeaderLength(t);if(i.length<l)throw new ou(`Expected header with length >= ${l} but got buffer of length ${i.length}`);const h=new hd(i.subarray(0,l)),d=Fr.read(h);if(!isNaN(this.x)&&(this.x!==d.x||this.y!==d.y||this.z!==d.z))throw new ou(`Invalid attempt to parse header ${d.z}/${d.x}/${d.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=d.x,this.y=d.y,this.z=d.z;for(const g of d.layers)this.layers[g.name]=new Vz(g,{cacheSize:this._cacheSize});return this}createDecodingTask(t){const i=[],l=this.getLayer(t.layerName);for(let h=0;h<l.dataIndex.length;h++){const d=l.dataIndex[h],g=d.first_byte-t.firstByte,y=d.last_byte+1-t.firstByte;if(h<t.firstBlock||h>t.lastBlock||l._blocksInProgress.has(h))continue;const b={layerName:l.name,firstByte:g,lastByte:y,pixelFormat:l.pixelFormat,blockIndex:h,blockShape:[d.bands.length].concat(l.bandShape),buffer:l.buffer,codec:d.codec.codec,filters:d.filters.map(E=>E.filter)};l._blocksInProgress.add(h),i.push(b)}return new dM(i,()=>{i.forEach(h=>l._blocksInProgress.delete(h.blockIndex))},(h,d)=>{if(i.forEach(g=>l._blocksInProgress.delete(g.blockIndex)),h)throw h;d.forEach(g=>{this.getLayer(g.layerName).processDecodedData(g)})})}}class Vz{constructor({version:t,name:i,units:l,tilesize:h,pixel_format:d,buffer:g,data_index:y},b){if(this.version=t,this.version!==1)throw new ou(`Cannot parse raster layer encoded with MRT version ${t}`);this.name=i,this.units=l,this.tileSize=h,this.buffer=g,this.pixelFormat=zz[d],this.dataIndex=y,this.bandShape=[h+2*g,h+2*g,Bz[this.pixelFormat]],this._decodedBlocks=function(E=1e3,A=0,M=!1){if(isNaN(E)||E<0)throw new TypeError("Invalid max value");if(isNaN(A)||A<0)throw new TypeError("Invalid ttl value");if(typeof M!="boolean")throw new TypeError("Invalid resetTtl value");return new Ez(E,A,M)}(b?b.cacheSize:5),this._blocksInProgress=new Set}processDecodedData(t){const i=t.blockIndex.toString();this._decodedBlocks.get(i)||this._decodedBlocks.set(i,t.data)}getBlockForBand(t){let i=0;switch(typeof t){case"string":for(const[l,h]of this.dataIndex.entries()){for(const[d,g]of h.bands.entries())if(g===t)return{bandIndex:i+d,blockIndex:l,blockBandIndex:d};i+=h.bands.length}break;case"number":for(const[l,h]of this.dataIndex.entries()){if(t>=i&&t<i+h.bands.length)return{bandIndex:t,blockIndex:l,blockBandIndex:t-i};i+=h.bands.length}break;default:throw new ou(`Invalid band \`${JSON.stringify(t)}\`. Expected string or integer.`)}throw new ou(`Band not found: ${JSON.stringify(t)}`)}getDataRange(t){let i=1/0,l=-1/0,h=1/0,d=-1/0;for(const g of t){const{blockIndex:y}=this.getBlockForBand(g);if(y<0)throw new ou(`Invalid band: ${JSON.stringify(g)}`);const b=this.dataIndex[y];h=Math.min(h,y),d=Math.max(d,y),i=Math.min(i,b.first_byte),l=Math.max(l,b.last_byte)}return{layerName:this.name,firstByte:i,lastByte:l,firstBlock:h,lastBlock:d}}hasBand(t){const{blockIndex:i}=this.getBlockForBand(t);return i>=0}hasDataForBand(t){const{blockIndex:i}=this.getBlockForBand(t);return i>=0&&!!this._decodedBlocks.get(i.toString())}getBandView(t){const{blockIndex:i,blockBandIndex:l}=this.getBlockForBand(t),h=this._decodedBlocks.get(i.toString());if(!h)throw new ou(`Data for band ${JSON.stringify(t)} of layer "${this.name}" not decoded.`);const d=this.dataIndex[i],g=this.bandShape.reduce((E,A)=>E*A,1),y=l*g,b=h.subarray(y,y+g);return{data:b,bytes:new Uint8Array(b.buffer).subarray(b.byteOffset,b.byteOffset+b.byteLength),tileSize:this.tileSize,buffer:this.buffer,offset:d.offset,scale:d.scale}}}class dM{constructor(t,i,l){this.tasks=t,this._onCancel=i,this._onComplete=l,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(t,i){this._finalized||(this._onComplete(t,i),this._finalized=!0)}}fM.performDecoding=function(r,t){return Promise.all(t.tasks.map(i=>{const{layerName:l,firstByte:h,lastByte:d,pixelFormat:g,blockShape:y,blockIndex:b,filters:E,codec:A}=i,M=new Uint8Array(r).subarray(h,d+1),P=new Uint32Array(y[0]*y[1]*y[2]);let O;if(A!=="gzip_data")throw new Error(`Unhandled codec: ${A}`);return O=function(z,j){if(!globalThis.DecompressionStream&&j==="gzip_data")return Promise.resolve(((pe=function(Ee){Ee[0]==31&&Ee[1]==139&&Ee[2]==8||Oo(6,"invalid gzip data");var Le=Ee[3],je=10;4&Le&&(je+=2+(Ee[10]|Ee[11]<<8));for(var Ze=(Le>>3&1)+(Le>>4&1);Ze>0;Ze-=!Ee[je++]);return je+(2&Le)}(oe=z))+8>oe.length&&Oo(6,"invalid gzip data"),function(Ee,Le,je,Ze){var it=Ee.length;if(!it||Le.f&&!Le.l)return je||new Ls(0);var Ye=!je,mt=Ye||Le.i!=2,bt=Le.i;Ye&&(je=new Ls(3*it));var ht=function(Na){var ba=je.length;if(Na>ba){var Os=new Ls(Math.max(2*ba,Na));Os.set(je),je=Os}},wt=Le.f||0,lt=Le.p||0,vt=Le.b||0,Gt=Le.l,Tt=Le.d,ar=Le.m,Qt=Le.n,It=8*it;do{if(!Gt){wt=Lo(Ee,lt,1);var vr=Lo(Ee,lt+1,3);if(lt+=3,!vr){var hr=Ee[(hn=4+((lt+7)/8|0))-4]|Ee[hn-3]<<8,ir=hn+hr;if(ir>it){bt&&Oo(0);break}mt&&ht(vt+hr),je.set(Ee.subarray(hn,ir),vt),Le.b=vt+=hr,Le.p=lt=8*ir,Le.f=wt;continue}if(vr==1)Gt=Rz,Tt=Dz,ar=9,Qt=5;else if(vr==2){var Pt=Lo(Ee,lt,31)+257,gr=Lo(Ee,lt+10,15)+4,Vr=Pt+Lo(Ee,lt+5,31)+1;lt+=14;for(var wr=new Ls(Vr),$r=new Ls(19),kr=0;kr<gr;++kr)$r[Mz[kr]]=Lo(Ee,lt+3*kr,7);lt+=3*gr;var Jr=Jw($r),Rr=(1<<Jr)-1,Rn=ym($r,Jr,1);for(kr=0;kr<Vr;){var hn,pn=Rn[Lo(Ee,lt,Rr)];if(lt+=15&pn,(hn=pn>>4)<16)wr[kr++]=hn;else{var xn=0,fn=0;for(hn==16?(fn=3+Lo(Ee,lt,3),lt+=2,xn=wr[kr-1]):hn==17?(fn=3+Lo(Ee,lt,7),lt+=3):hn==18&&(fn=11+Lo(Ee,lt,127),lt+=7);fn--;)wr[kr++]=xn}}var Qn=wr.subarray(0,Pt),Cn=wr.subarray(Pt);ar=Jw(Qn),Qt=Jw(Cn),Gt=ym(Qn,ar,1),Tt=ym(Cn,Qt,1)}else Oo(1);if(lt>It){bt&&Oo(0);break}}mt&&ht(vt+131072);for(var hi=(1<<ar)-1,Pi=(1<<Qt)-1,Qi=lt;;Qi=lt){var Kn=(xn=Gt[Qw(Ee,lt)&hi])>>4;if((lt+=15&xn)>It){bt&&Oo(0);break}if(xn||Oo(2),Kn<256)je[vt++]=Kn;else{if(Kn==256){Qi=lt,Gt=null;break}var si=Kn-254;Kn>264&&(si=Lo(Ee,lt,(1<<(Wi=sM[kr=Kn-257]))-1)+uM[kr],lt+=Wi);var Gi=Tt[Qw(Ee,lt)&Pi],Hi=Gi>>4;if(Gi||Oo(3),lt+=15&Gi,Cn=Pz[Hi],Hi>3){var Wi=oM[Hi];Cn+=Qw(Ee,lt)&(1<<Wi)-1,lt+=Wi}if(lt>It){bt&&Oo(0);break}mt&&ht(vt+131072);var Un=vt+si;if(vt<Cn){var ms=0-Cn,lu=Math.min(Cn,Un);for(ms+vt<0&&Oo(3);vt<lu;++vt)je[vt]=Ze[ms+vt]}for(;vt<Un;++vt)je[vt]=je[vt-Cn]}}Le.l=Gt,Le.p=Qi,Le.b=vt,Le.f=wt,Gt&&(wt=1,Le.m=ar,Le.d=Tt,Le.n=Qt)}while(!wt);return vt!=je.length&&Ye?function(Na,ba,Os){return(ba==null||ba<0)&&(ba=0),(Os==null||Os>Na.length)&&(Os=Na.length),new Ls(Na.subarray(ba,Os))}(je,0,vt):je.subarray(0,vt)}(oe.subarray(pe,-8),{i:2},new Ls(((q=oe)[(Q=q.length)-4]|q[Q-3]<<8|q[Q-2]<<16|q[Q-1]<<24)>>>0),void 0)));var q,Q,oe,pe;const de=Nz[j];if(!de)throw new Error(`Unhandled codec: ${j}`);const Ce=new globalThis.DecompressionStream(de);return new Response(new Blob([z]).stream().pipeThrough(Ce)).arrayBuffer().then(Ee=>new Uint8Array(Ee))}(M,A).then(z=>{const j=Fo.read(new hd(z));if(j.values==="uint32_values")return j.uint32_values.readValuesInto(P),new Uz[g](P.buffer);throw new Error(`Unhandled numeric data "${j.values}"`)}),O.then(z=>{for(let j=E.length-1;j>=0;j--)switch(E[j]){case"delta_filter":Sz(z,y);break;case"zigzag_filter":Az(z);break;case"bitshuffle_filter":Cz(z,g);break;default:throw new Error(`Unhandled filter "${E[j]}"`)}return{layerName:l,blockIndex:b,data:z}}).catch(z=>{throw z})}))},rr(dM,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});const pM=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class eb{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,l]=new Uint8Array(t,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const h=l>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);const d=pM[15&l];if(!d)throw new Error("Unrecognized array type.");const[g]=new Uint16Array(t,2,1),[y]=new Uint32Array(t,4,1);return new eb(y,g,d,t)}constructor(t,i=64,l=Float64Array,h){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=l,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const d=pM.indexOf(this.ArrayType),g=2*t*this.ArrayType.BYTES_PER_ELEMENT,y=t*this.IndexArrayType.BYTES_PER_ELEMENT,b=(8-y%8)%8;if(d<0)throw new Error(`Unexpected typed array class: ${l}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+y+b,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+g+y+b),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+y+b,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+d]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=t)}add(t,i){const l=this._pos>>1;return this.ids[l]=l,this.coords[this._pos++]=t,this.coords[this._pos++]=i,l}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return tb(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,i,l,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:g,nodeSize:y}=this,b=[0,d.length-1,0],E=[];for(;b.length;){const A=b.pop()||0,M=b.pop()||0,P=b.pop()||0;if(M-P<=y){for(let q=P;q<=M;q++){const Q=g[2*q],oe=g[2*q+1];Q>=t&&Q<=l&&oe>=i&&oe<=h&&E.push(d[q])}continue}const O=P+M>>1,z=g[2*O],j=g[2*O+1];z>=t&&z<=l&&j>=i&&j<=h&&E.push(d[O]),(A===0?t<=z:i<=j)&&(b.push(P),b.push(O-1),b.push(1-A)),(A===0?l>=z:h>=j)&&(b.push(O+1),b.push(M),b.push(1-A))}return E}within(t,i,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:d,nodeSize:g}=this,y=[0,h.length-1,0],b=[],E=l*l;for(;y.length;){const A=y.pop()||0,M=y.pop()||0,P=y.pop()||0;if(M-P<=g){for(let q=P;q<=M;q++)gM(d[2*q],d[2*q+1],t,i)<=E&&b.push(h[q]);continue}const O=P+M>>1,z=d[2*O],j=d[2*O+1];gM(z,j,t,i)<=E&&b.push(h[O]),(A===0?t-l<=z:i-l<=j)&&(y.push(P),y.push(O-1),y.push(1-A)),(A===0?t+l>=z:i+l>=j)&&(y.push(O+1),y.push(M),y.push(1-A))}return b}}function tb(r,t,i,l,h,d){if(h-l<=i)return;const g=l+h>>1;mM(r,t,g,l,h,d),tb(r,t,i,l,g-1,1-d),tb(r,t,i,g+1,h,1-d)}function mM(r,t,i,l,h,d){for(;h>l;){if(h-l>600){const E=h-l+1,A=i-l+1,M=Math.log(E),P=.5*Math.exp(2*M/3),O=.5*Math.sqrt(M*P*(E-P)/E)*(A-E/2<0?-1:1);mM(r,t,i,Math.max(l,Math.floor(i-A*P/E+O)),Math.min(h,Math.floor(i+(E-A)*P/E+O)),d)}const g=t[2*i+d];let y=l,b=h;for(wm(r,t,l,i),t[2*h+d]>g&&wm(r,t,l,h);y<b;){for(wm(r,t,y,b),y++,b--;t[2*y+d]<g;)y++;for(;t[2*b+d]>g;)b--}t[2*l+d]===g?wm(r,t,l,b):(b++,wm(r,t,b,h)),b<=i&&(l=b+1),i<=b&&(h=b-1)}}function wm(r,t,i,l){rb(r,i,l),rb(t,2*i,2*l),rb(t,2*i+1,2*l+1)}function rb(r,t,i){const l=r[t];r[t]=r[i],r[i]=l}function gM(r,t,i,l){const h=r-i,d=t-l;return h*h+d*d}o.$=y3,o.A=Vf,o.B=m0,o.C=Qr,o.D=tt,o.E=ha,o.F=ni,o.G=jt,o.H=class{constructor(r){this.specification=r}possiblyEvaluate(r,t){return nr(r.expression.evaluate(t))}interpolate(r,t,i){return{x:Kr(r.x,t.x,i),y:Kr(r.y,t.y,i),z:Kr(r.z,t.z,i),azimuthal:Kr(r.azimuthal,t.azimuthal,i),polar:Kr(r.polar,t.polar,i)}}},o.I=Iw,o.J=So,o.K=ri,o.L=sn,o.M=class{constructor(r,t,i,l){this.id=r,this.position=t!=null?new qe(t[0],t[1]):new qe(0,0),this.orientation=i??[0,0,0],this.nodes=l,this.uploaded=!1,this.aabb=new li([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(r,t){if(o.a6.multiply(r.matrix,t,r.matrix),r.meshes)for(const i of r.meshes){const l=li.applyTransform(i.aabb,r.matrix);this.aabb.encapsulate(l)}if(r.children)for(const i of r.children)this._applyTransformations(i,r.matrix)}computeBoundsAndApplyParent(){const r=o.a6.identity([]);for(const t of this.nodes)this._applyTransformations(t,r)}computeModelMatrix(r,t,i,l,h,d,g=!1){z3(this.matrix,this,r.transform,this.position,t,i,l,h,d,g)}upload(r){if(!this.uploaded){for(const t of this.nodes)jw(t,r);for(const t of this.nodes)Gx(t);this.uploaded=!0}}destroy(){for(const r of this.nodes)Gw(r)}},o.O=Ve,o.P=we,o.Q=fh,o.R=Xi,o.S=Jc,o.T=Bw,o.U=Kr,o.V=Kt,o.W=s_,o.X=class{constructor(r){this.specification=r}possiblyEvaluate(r,t){return function([i,l]){const h=nr([1,i,l]);return{x:h.x,y:h.y,z:h.z}}(r.expression.evaluate(t))}interpolate(r,t,i){return{x:Kr(r.x,t.x,i),y:Kr(r.y,t.y,i),z:Kr(r.z,t.z,i)}}},o.Y=function(r,t,i=0,l=!0){const h=new we(i,i),d=r.sub(h),g=t.add(h),y=[d,new we(g.x,d.y),g,new we(d.x,g.y)];return l&&y.push(d.clone()),y},o.Z=lh,o._=function(r,t){const i=[];for(let l=0;l<r.length;l++){const h=Et(l-1,-1,r.length-1),d=Et(l+1,-1,r.length-1),g=r[l],y=r[d],b=r[h].sub(g).unit(),E=y.sub(g).unit(),A=E.angleWithSep(b.x,b.y),M=b.add(E).unit().mult(-1*t/Math.sin(A/2));i.push(g.add(M))}return i},o.a=Nl,o.a$=function(r){const t=[];for(const i in r)t.push(r[i]);return t},o.a0=vA,o.a1=function(r,t,i=0){return o.N.fromValues(((t.x-i)*r.scale-r.x)*Kt,(t.y*r.scale-r.y)*Kt,Ln(t.z,t.y))},o.a2=aw,o.a3=Nk,o.a4=function(r){let t=1/0,i=1/0,l=-1/0,h=-1/0;for(const d of r)t=Math.min(t,d.x),i=Math.min(i,d.y),l=Math.max(l,d.x),h=Math.max(h,d.y);return{min:new we(t,i),max:new we(l,h)}},o.a5=zr,o.a8=ko,o.a9=mn,o.aA=E_,o.aB=ui,o.aC=He,o.aD=U_,o.aE=Nx,o.aF=function(){Ya.isLoading()||Ya.isLoaded()||fl()!=="deferred"||C0()},o.aG=Ka,o.aH=Ai,o.aI=J3,o.aJ=Xn,o.aK=Ew,o.aL=ww,o.aM=zi,o.aN=Is,o.aO=V0,o.aP=BC,o.aQ=mx,o.aR=zw,o.aS=function(r,t){const i=Jc(t.zoom);if(i===0)return vl(r);const l=lx(r),h=cw(l),d=zr(l.getWest())*t.worldSize,g=zr(l.getEast())*t.worldSize,y=Sr(l.getNorth())*t.worldSize,b=Sr(l.getSouth())*t.worldSize,E=[d,y,0],A=[g,y,0],M=[d,b,0],P=[g,b,0],O=o.a6.invert([],t.globeMatrix);return o.N.transformMat4(E,E,O),o.N.transformMat4(A,A,O),o.N.transformMat4(M,M,O),o.N.transformMat4(P,P,O),h[0]=nc(h[0],M,i),h[1]=nc(h[1],P,i),h[2]=nc(h[2],A,i),h[3]=nc(h[3],E,i),li.fromPoints(h)},o.aT=ux,o.aU=Y0,o.aV=nc,o.aW=va,o.aX=O5,o.aY=sr,o.aZ=fM,o.a_=xt,o.aa=st,o.ab=ue,o.ac=function(r,t){const i={};for(let l=0;l<t.length;l++){const h=t[l];h in r&&(i[h]=r[h])}return i},o.ad=ot,o.ae=Sr,o.af=class{constructor(r){this.entries={},this.scheduler=r}request(r,t,i,l){const h=this.entries[r]=this.entries[r]||{callbacks:[]};if(h.result){const[d,g]=h.result;return this.scheduler?this.scheduler.add(()=>{l(d,g)},t):l(d,g),()=>{}}return h.callbacks.push(l),h.cancel||(h.cancel=i((d,g)=>{h.result=[d,g];for(const y of h.callbacks)this.scheduler?this.scheduler.add(()=>{y(d,g)},t):y(d,g);setTimeout(()=>delete this.entries[r],3e3)})),()=>{h.result||(h.callbacks=h.callbacks.filter(d=>d!==l),h.callbacks.length||(h.cancel(),delete this.entries[r]))}}},o.ag=D0,o.ah=function(r,t,i){const l=JSON.stringify(r.request);return r.data&&(this.deduped.entries[l]={result:[null,r.data]}),this.deduped.request(l,{type:"parseTile",isSymbolTile:r.isSymbolTile,zoom:r.tileZoom},h=>{const d=xt(r.request,(g,y,b,E)=>{g?h(g):y&&h(null,{vectorTile:i?void 0:new bw(new hd(y)),rawData:y,cacheControl:b,expires:E})});return()=>{d.cancel(),h()}},t)},o.ai=function(r){ln++,ln>kt&&(r.getActor().send("enforceCacheSizeLimit",dt),ln=0)},o.aj=er,o.ak=ut,o.al=function(r){return r<=1?1:Math.pow(2,Math.floor(Math.log(r)/Math.LN2))},o.am=Bt,o.an=k3,o.ao=M3,o.ap=C3,o.aq=function(r,t){const i=document.createElement("video");i.muted=!0,i.onloadstart=function(){t(null,i)};for(let l=0;l<r.length;l++){const h=document.createElement("source");Ft(r[l])||(i.crossOrigin="Anonymous"),h.src=r[l],i.appendChild(h)}return{cancel:()=>{}}},o.ar=Bx,o.as=lm,o.at=Mr,o.au=en,o.av=Ao,o.aw=Oi,o.ax=_i,o.ay=bn,o.az=Kl,o.b=xa,o.b$=L_,o.b0=function(r,t){const i=[];for(const l in r)l in t||i.push(l);return i},o.b1=Dt,o.b2=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.b3=function(r,t){const{x:i,y:l}=r.point,h=HC(i,l,r.worldSize/r._pixelsPerMercatorPixel,0,0);return o.a6.multiply(h,h,uw(vl(t)))},o.b5=ld,o.b6=Fs,o.b7=Tx,o.b8=function(r,t,i,l,h){const d=5*t+2;r.float32[d+0]=i,r.float32[d+1]=l,r.float32[d+2]=h},o.b9=Ox,o.bA=$x,o.bB=I3,o.bC=function(r){const t=I3(r,!0);return o.b4.invert([],[t[0],t[1],t[4],t[5]])},o.bD=sw,o.bE=function(r){const{x:t,y:i}=r.point,{lng:l,lat:h}=r._center;return HC(t,i,r.worldSize,l,h)},o.bF=St,o.bG=ye,o.bH=function(r){const t=Math.round((r+45+360)%360/90)%4;return Lt[t]},o.bI=45,o.bJ=fr,o.bK=m,o.bL=gl,o.bM=tx,o.bN=fa,o.bO=ed,o.bP=p,o.bQ=function(r,t,i){const l=Math.sqrt(r*r+t*t+i*i),h=l>0?Math.acos(i/l)*rt:0;let d=r!==0||t!==0?Math.atan2(-t,-r)*rt+90:0;return d<0&&(d+=360),[l,d,h]},o.bR=Zr,o.bS=li,o.bT=nr,o.bU=function(r){return[Math.pow(r[0],1/2.2),Math.pow(r[1],1/2.2),Math.pow(r[2],1/2.2)]},o.bV=function(r){return r({pluginStatus:Ra,pluginURL:hl}),A0.on("pluginStateChange",r),r},o.bW=_d,o.bX=Hx,o.bY=dd,o.bZ=Pw,o.b_=Wn,o.ba=l3,o.bb=eo,o.bc=aa,o.bd=m3,o.be=Dw,o.bf=Mw,o.bg=eb,o.bh=Et,o.bj=Re,o.bk=Te,o.bl=Pr,o.bm=function(r,t,i){r[4*t+0]=i[0],r[4*t+1]=i[1],r[4*t+2]=i[2],r[4*t+3]=i[3]},o.bn=qe,o.bo=E3,o.bp=Ut,o.bq=ow,o.br=P3,o.bs=Mt,o.bt=$C,o.bu=function(r,t,i,l,h,d,g,y,b){if(b.name==="globe")return $C(r,t,new Mt(i,l,h),!1);const E=lm({z:i,x:l,y:h},b);return new li([(d+E.x/E.scale)*t,t*(E.y/E.scale),g],[(d+E.x2/E.scale)*t,t*(E.y2/E.scale),y])},o.bv=function(r,t,i){let l=0;for(let h=0;h<2;++h){const d=i?i[h]:0;r[h]>d&&(l+=(r[h]-d)*(r[h]-d)),t[h]<d&&(l+=(d-t[h])*(d-t[h]))}return l},o.bw=Wr,o.bx=ie,o.by=function(r){const t=o.a6.identity(new Float64Array(16));o.a6.multiply(t,r.pixelMatrix,r.globeMatrix);const i=[0,$e,0],l=[0,nt,0];return o.N.transformMat4(i,i,t),o.N.transformMat4(l,l,t),[i[0]>0&&i[0]<=r.width&&i[1]>0&&i[1]<=r.height&&!fw(r,new qe(r.center.lat,90)),l[0]>0&&l[0]<=r.width&&l[1]>0&&l[1]<=r.height&&!fw(r,new qe(r.center.lat,-90))]},o.bz=function(r,t){const{scale:i}=r.tileTransform,l=i*Kt/(r.tileSize*Math.pow(2,t.zoom-r.tileID.overscaledZ+r.tileID.canonical.z));return o.b4.scale(new Float32Array(4),t.inverseAdjustmentMatrix,[l,l])},o.c=Y3,o.c$=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},o.c0=V,o.c1=Be,o.c2=function(r,t,i){return r.type==="custom"?new H6(r,t):new Tz[r.type](r,t,i)},o.c3=function(r){const t=r.indexOf(qf);return t>=0?r.slice(0,t):r},o.c4=function(r){return r.indexOf(qf)>=0},o.c5=function(r){const t=r.indexOf(qf);return t>=0?r.slice(t+1):""},o.c6=function(r){const t=[],i=r.id;return i===void 0&&t.push({message:`layers.${i}: missing required property "id"`}),r.render===void 0&&t.push({message:`layers.${i}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&t.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),t},o.c7=Or,o.c8=A0,o.c9=pt,o.cA=Uk,o.cB=(r,t,i,l,h,d)=>{const g=r.transform;return{u_matrix:Bk(r,t,i,l),u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:g.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:h,u_image:0,u_tile_units_to_pixels:zk(t,g),u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:d}},o.cC=(r,t,i,l,h,d,g)=>{const y=r.transform,b=y.calculatePixelsToTileUnitsMatrix(t);return{u_matrix:Bk(r,t,i,l),u_pixels_to_tile_units:b,u_device_pixel_ratio:d,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:h,u_texsize:Vk(i)&&t.lineAtlasTexture?t.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:zk(t,r.transform),u_alpha_discard_threshold:0,u_trim_offset:g,u_emissive_strength:i.paint.get("line-emissive-strength")}},o.cD=yt,o.cE=K0,o.cF=Pk,o.cG=or,o.cH=bx,o.cI=tu,o.cJ=450,o.cK=7,o.cL=$6,o.cM=256,o.cN=uw,o.cO=ml,o.cP=U0,o.cQ=function(r,t,i,l,h){return st((r-t)/(i-t)*(h-l)+l,l,h)},o.cR=qr,o.cS=Vw,o.cT=[1,1,1],o.cU=sd,o.cV=gd,o.cW=Js,o.cX=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[]}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(r){const t=uk(new we(0,0),new we(Kt,Kt),r),i=[];for(const l of this._activeRegions){if(l.hiddenByOverlap||!ck(t,l))continue;const h=bN(l.min,l.max,r);i.push({min:h.min,max:h.max,sourceId:this._sourceIds[l.priority],footprint:l.footprint,footprintTileId:l.tileId})}return i}setSources(r){this._setSources(r.map(t=>({getSourceId:()=>t.cache.id,getFootprints:()=>{const i=[];for(const l of t.cache.getVisibleCoordinates()){const h=t.cache.getTile(l).buckets[t.layer];if(h)for(const d of h.getNodesInfo()){const g=d.node;g.footprint&&i.push({footprint:g.footprint,id:l.toUnwrapped()})}}return i}})))}_addSource(r){const t=r.getFootprints();if(t.length!==0){for(const i of t){if(!i.footprint)continue;const l=uk(i.footprint.min,i.footprint.max,i.id);this._activeRegions.push({min:l.min,max:l.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:i.id,footprint:i.footprint})}this._sourceIds.push(r.getSourceId())}}_computeReplacement(){this._activeRegions.sort((t,i)=>t.priority-i.priority||yx(t.min,i.min)||yx(t.max,i.max));let r=this._activeRegions.length!==this._prevRegions.length;if(!r){let t=0,i=0;for(;!r&&t!==this._activeRegions.length;){const l=this._activeRegions[t],h=this._prevRegions[i];r=l.priority!==h.priority||!lk(l,h),++t,++i}}if(r){++this._updateTime;const t=i=>{const l=this._activeRegions;if(i>=l.length)return i;const h=l[i].priority;for(;i<l.length&&l[i].priority===h;)++i;return i};if(this._sourceIds.length>1){let i=0,l=t(i);for(;i!==l;){let h=i;const d=i;for(;h!==l;){const g=this._activeRegions[h];g.hiddenByOverlap=!1;for(let y=0;y<d;y++){const b=this._activeRegions[y];if(!b.hiddenByOverlap&&ck(g,b)&&(g.hiddenByOverlap=fk(g.footprint,g.tileId,b.footprint,b.tileId),g.hiddenByOverlap))break}++h}i=l,l=t(i)}}}}_setSources(r){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let t=r.length-1;t>=0;t--)this._addSource(r[t]);this._computeReplacement()}},o.cY=class{constructor(r){this._createGrid(r),this._createPoles(r)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const r of this._poleSegments)r.destroy();for(const r of this._gridSegments)r.withSkirts.destroy(),r.withoutSkirts.destroy()}_fillGridMeshWithLods(r,t){const i=new Is,l=new Oi,h=[],d=r+1+2,g=t[0]+1,y=t[0]+1+(1+t.length),b=(E,A,M)=>{let P=E===d-1?E-2:E===0?E:E-1;return P+=M?24575:0,[P,A]};for(let E=0;E<d;++E)i.emplaceBack(...b(E,0,!0));for(let E=0;E<g;++E)for(let A=0;A<d;++A)i.emplaceBack(...b(A,E,(A===0||A===d-1)&&!0));for(let E=0;E<t.length;++E){const A=t[E];for(let M=0;M<d;++M)i.emplaceBack(...b(M,A,!0))}for(let E=0;E<t.length;++E){const A=l.length,M=t[E]+1+2,P=new Oi;for(let j=0;j<M-1;j++){const q=j===M-2,Q=q?d*(y-t.length+E-j):d;for(let oe=0;oe<d-1;oe++){const pe=j*d+oe;j===0||q||oe===0||oe===d-2?(P.emplaceBack(pe+1,pe,pe+Q),P.emplaceBack(pe+Q,pe+Q+1,pe+1)):(l.emplaceBack(pe+1,pe,pe+Q),l.emplaceBack(pe+Q,pe+Q+1,pe+1))}}const O=ui.simpleSegment(0,A,i.length,l.length-A);for(let j=0;j<P.uint16.length;j+=3)l.emplaceBack(P.uint16[j],P.uint16[j+1],P.uint16[j+2]);const z=ui.simpleSegment(0,A,i.length,l.length-A);h.push({withoutSkirts:O,withSkirts:z})}return{vertices:i,indices:l,segments:h}}_createGrid(r){const t=this._fillGridMeshWithLods(Pe,Fe);this._gridSegments=t.segments,this._gridBuffer=r.createVertexBuffer(t.vertices,BC.members),this._gridIndexBuffer=r.createIndexBuffer(t.indices,!0)}_createPoles(r){const t=new Oi;for(let g=0;g<=Pe;g++)t.emplaceBack(0,g+1,g+2);this._poleIndexBuffer=r.createIndexBuffer(t,!0);const i=new ml,l=new ml,h=new ml,d=new ml;this._poleSegments=[];for(let g=0,y=0;g<ye;g++){const b=360/(1<<g);i.emplaceBack(0,-ue,0,.5,0),l.emplaceBack(0,-ue,0,.5,1),h.emplaceBack(0,-ue,0,.5,.5),d.emplaceBack(0,-ue,0,.5,.5);for(let E=0;E<=Pe;E++){let A=E/Pe,M=0;const P=Kr(0,b,A),[O,z,j]=Ge(B5,U5,P,ue);i.emplaceBack(O,z,j,A,M),l.emplaceBack(O,z,j,A,1-M);const q=Re(P);A=.5+.5*Math.sin(q),M=.5+.5*Math.cos(q),h.emplaceBack(O,z,j,A,M),d.emplaceBack(O,z,j,A,1-M)}this._poleSegments.push(ui.simpleSegment(y,0,66,64)),y+=66}this._poleNorthVertexBuffer=r.createVertexBuffer(i,sx,!1),this._poleSouthVertexBuffer=r.createVertexBuffer(l,sx,!1),this._texturedPoleNorthVertexBuffer=r.createVertexBuffer(h,sx,!1),this._texturedPoleSouthVertexBuffer=r.createVertexBuffer(d,sx,!1)}getGridBuffers(r,t){return[this._gridBuffer,this._gridIndexBuffer,t?this._gridSegments[r].withSkirts:this._gridSegments[r].withoutSkirts]}getPoleBuffers(r,t){return[t?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,t?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[r]]}},o.cZ=function(r){return Ma.has(r)},o.c_=qt,o.ca=s,o.cb=class extends Co{constructor(r){super(r),this.current=x}set(r,t,i){if(this.fetchUniformLocation(r,t)){for(let l=0;l<9;l++)if(i[l]!==this.current[l]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},o.cc=We,o.cd=function(r,t,i){const l=Jc(i.zoom),h=r.style.map._antialias,d=t.options.extStandardDerivativesForceOff||r.terrain&&r.terrain.exaggeration()>0;return l===0&&!h&&!d},o.ce=function(r){const t=r.pixelsPerMeter,i=t/Pr(1,r.center.lat),l=o.a6.identity(new Float64Array(16));return o.a6.translate(l,l,[r.point.x,r.point.y,0]),o.a6.scale(l,l,[i,i,t]),Float32Array.from(l)},o.cf=lx,o.cg=function(r){const t=Wr-5;r=st(r,-t,t)/t*90;const i=Math.pow(Math.abs(Math.sin(Re(r))),3);return Math.round(i*(Fe.length-1))},o.ch=function(r,t,i,l){const h=t.getNorth(),d=t.getSouth(),g=t.getWest(),y=t.getEast(),b=1<<r.z,E=y-g,A=h-d,M=E/Pe,P=-A/Fe[i],O=[0,M,0,P,0,0,h,g,0];if(r.z>0){const z=180/l;o.co.multiply(O,O,[z/E+1,0,0,0,z/A+1,0,-.5*z/M,.5*z/P,1])}return O[2]=b,O[5]=r.x,O[8]=r.y,O},o.ci=vl,o.cj=function(r,t,i){const l=o.a6.identity(new Float64Array(16)),h=(t/(1<<r)-.5)*Math.PI*2;return o.a6.rotateY(l,i.globeMatrix,h),Float32Array.from(l)},o.ck=class{isDataAvailableAtPoint(r){const t=this._source();if(this.isUsingMockSource()||!t||r.y<0||r.y>1)return!1;const i=t.getSource().maxzoom,l=1<<i,h=Math.floor(r.x),d=Math.floor((r.x-h)*l),g=Math.floor(r.y*l),y=this.findDEMTileFor(new Bt(i,h,i,d,g));return!(!y||!y.dem)}getAtPointOrZero(r,t=0){return this.getAtPoint(r,t)||0}getAtPoint(r,t,i=!0){if(this.isUsingMockSource())return null;t==null&&(t=null);const l=this._source();if(!l||r.y<0||r.y>1)return t;const h=l.getSource().maxzoom,d=1<<h,g=Math.floor(r.x),y=r.x-g,b=new Bt(h,g,h,Math.floor(y*d),Math.floor(r.y*d)),E=this.findDEMTileFor(b);if(!E||!E.dem)return t;const A=E.dem,M=1<<E.tileID.canonical.z,P=(y*M-E.tileID.canonical.x)*A.dim,O=(r.y*M-E.tileID.canonical.y)*A.dim,z=Math.floor(P),j=Math.floor(O);return(i?this.exaggeration():1)*Kr(Kr(A.get(z,j),A.get(z,j+1),O-j),Kr(A.get(z+1,j),A.get(z+1,j+1),O-j),P-z)}getAtTileOffset(r,t,i){const l=1<<r.canonical.z;return this.getAtPointOrZero(new sn(r.wrap+(r.canonical.x+t/Kt)/l,(r.canonical.y+i/Kt)/l))}getAtTileOffsetFunc(r,t,i,l){return h=>{const d=this.getAtTileOffset(r,h.x,h.y),g=l.upVector(r.canonical,h.x,h.y),y=l.upVectorScale(r.canonical,t,i).metersToTile;return o.N.scale(g,g,d*y),g}}getForTilePoints(r,t,i,l){if(this.isUsingMockSource())return!1;const h=sd.create(this,r,l);return!!h&&(t.forEach(d=>{d[2]=this.exaggeration()*h.getElevationAt(d[0],d[1],i)}),!0)}getMinMaxForTile(r){if(this.isUsingMockSource())return null;const t=this.findDEMTileFor(r);if(!t||!t.dem)return null;const i=t.dem.tree,l=t.tileID,h=1<<r.canonical.z-l.canonical.z;let d=r.canonical.x/h-l.canonical.x,g=r.canonical.y/h-l.canonical.y,y=0;for(let b=0;b<r.canonical.z-l.canonical.z&&!i.leaves[y];b++){d*=2,g*=2;const E=2*Math.floor(g)+Math.floor(d);y=i.childOffsets[y]+E,d%=1,g%=1}return{min:this.exaggeration()*i.minimums[y],max:this.exaggeration()*i.maximums[y]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(r,t,i){throw new Error("Pure virtual method called.")}pointCoordinate(r){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(r){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const r=this.visibleDemTiles;if(r.length===0)return null;let t=!1,i=Number.MAX_VALUE,l=Number.MIN_VALUE;for(const h of r){const d=this.getMinMaxForTile(h.tileID);d&&(i=Math.min(i,d.min),l=Math.max(l,d.max),t=!0)}return t?{min:i,max:l}:null}},o.cl=ox,o.cm=ek,o.cn=function(r,t){return[Math.pow(r[0],2.2)*t,Math.pow(r[1],2.2)*t,Math.pow(r[2],2.2)*t]},o.cp=GC,o.cq=256,o.cr=function(r,t){const i=[0,0,0],l=ux(vl(t.canonical));return o.N.transformMat4(i,i,l),o.N.transformMat4(i,i,r),i},o.cs=r=>({u_camera_to_center_distance:new fa(r),u_extrude_scale:new S(r),u_device_pixel_ratio:new fa(r),u_matrix:new m(r),u_inv_rot_matrix:new m(r),u_merc_center:new gl(r),u_tile_id:new tx(r),u_zoom_transition:new fa(r),u_up_dir:new tx(r),u_emissive_strength:new fa(r)}),o.ct=r=>({u_matrix:new m(r),u_pixels_to_tile_units:new S(r),u_device_pixel_ratio:new fa(r),u_units_to_pixels:new gl(r),u_dash_image:new ed(r),u_gradient_image:new ed(r),u_image_height:new fa(r),u_texsize:new gl(r),u_tile_units_to_pixels:new fa(r),u_alpha_discard_threshold:new fa(r),u_trim_offset:new gl(r),u_emissive_strength:new fa(r)}),o.cu=r=>({u_matrix:new m(r),u_texsize:new gl(r),u_pixels_to_tile_units:new S(r),u_device_pixel_ratio:new fa(r),u_image:new ed(r),u_units_to_pixels:new gl(r),u_tile_units_to_pixels:new fa(r),u_alpha_discard_threshold:new fa(r),u_trim_offset:new gl(r)}),o.cv=Yf,o.cw=KN,o.cx=JN,o.cy=ZC,o.cz=(r,t,i,l,h,d)=>{const g=r.transform,y=g.projection.name==="globe";let b;if(d.paint.get("circle-pitch-alignment")==="map")if(y){const A=GC(g.zoom,t.canonical)*g._pixelsPerMercatorPixel;b=Float32Array.from([A,0,0,A])}else b=g.calculatePixelsToTileUnitsMatrix(i);else b=new Float32Array([g.pixelsToGLUnits[0],0,0,g.pixelsToGLUnits[1]]);const E={u_camera_to_center_distance:r.transform.getCameraToCenterDistance(g.projection),u_matrix:r.translatePosMatrix(t.projMatrix,i,d.paint.get("circle-translate"),d.paint.get("circle-translate-anchor")),u_device_pixel_ratio:_t.devicePixelRatio,u_extrude_scale:b,u_inv_rot_matrix:V5,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:d.paint.get("circle-emissive-strength")};if(y){E.u_inv_rot_matrix=l,E.u_merc_center=h,E.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],E.u_zoom_transition=Jc(g.zoom);const A=h[0]*Kt,M=h[1]*Kt;E.u_up_dir=g.projection.upVector(new Mt(0,0,0),A,M)}return E},o.d=he,o.d0=Ot,o.d1=un,o.d2=ft,o.d3=function([r,t,i]){const l=Math.hypot(r,t,i),h=Math.atan2(r,i),d=.5*Math.PI-Math.acos(-t/l);return new qe(St(h),St(d))},o.d4=ct,o.d5=F,o.d6=fw,o.d7=WC,o.d8=function(r){const t=[0,0,0],i=o.a6.identity(new Float64Array(16));return o.a6.multiply(i,r.pixelMatrix,r.globeMatrix),o.N.transformMat4(t,t,i),new we(t[0],t[1])},o.d9=function(r){const t=r.navigator?r.navigator.userAgent:null;return!!function(i){if(gt==null){const l=i.navigator?i.navigator.userAgent:null;gt=!!i.safari||!(!l||!(/\b(iPad|iPhone|iPod)\b/.test(l)||l.match("Safari")&&!l.match("Chrome")))}return gt}(r)&&t&&(t.match("Version/15.4")||t.match("Version/15.5")||t.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},o.dA=Ro,o.dB=K3,o.dC=Q3,o.dD=Lk,o.dE=zt,o.dF=u3,o.dG=function(r,t,i,l,h,d,g,y,b,E,A){r.createArrays(),r.tilePixelRatio=Kt/(512*r.overscaling),r.compareText={},r.iconsNeedLinear=!1;const M=r.layers[0].layout,P=r.layers[0]._unevaluatedLayout._values,O={};if(r.textSizeData.kind==="composite"){const{minZoom:Q,maxZoom:oe}=r.textSizeData;O.compositeTextSizes=[P["text-size"].possiblyEvaluate(new ri(Q),y),P["text-size"].possiblyEvaluate(new ri(oe),y)]}if(r.iconSizeData.kind==="composite"){const{minZoom:Q,maxZoom:oe}=r.iconSizeData;O.compositeIconSizes=[P["icon-size"].possiblyEvaluate(new ri(Q),y),P["icon-size"].possiblyEvaluate(new ri(oe),y)]}O.layoutTextSize=P["text-size"].possiblyEvaluate(new ri(b+1),y),O.layoutIconSize=P["icon-size"].possiblyEvaluate(new ri(b+1),y),O.textMaxSize=P["text-size"].possiblyEvaluate(new ri(18),y);const z=M.get("text-rotation-alignment")==="map"&&M.get("symbol-placement")!=="point",j=M.get("text-size");let q=!1;for(const Q of r.features)if(Q.icon&&Q.icon.nameSecondary){q=!0;break}for(const Q of r.features){const oe=M.get("text-font").evaluate(Q,{},y).join(","),pe=j.evaluate(Q,{},y),de=O.layoutTextSize.evaluate(Q,{},y),Ce=(O.layoutIconSize.evaluate(Q,{},y),{horizontal:{},vertical:void 0}),Ee=Q.text;let Le,je=[0,0];if(Ee){const Ye=Ee.toString(),mt=M.get("text-letter-spacing").evaluate(Q,{},y)*aa,bt=M.get("text-line-height").evaluate(Q,{},y)*aa,ht=Ov(Ye)?mt:0,wt=M.get("text-anchor").evaluate(Q,{},y),lt=M.get("text-variable-anchor");if(!lt){const Qt=M.get("text-radial-offset").evaluate(Q,{},y);je=Qt?m3(wt,[Qt*aa,Rw]):M.get("text-offset").evaluate(Q,{},y).map(It=>It*aa)}let vt=z?"center":M.get("text-justify").evaluate(Q,{},y);const Gt=M.get("symbol-placement")==="point",Tt=Gt?M.get("text-max-width").evaluate(Q,{},y)*aa:1/0,ar=Qt=>{r.allowVerticalPlacement&&ul(Ye)&&(Ce.vertical=kw(Ee,t,i,h,oe,Tt,bt,wt,Qt,ht,je,Fs.vertical,!0,de,pe))};if(!z&&lt){const Qt=vt==="auto"?lt.map(vr=>Dw(vr)):[vt];let It=!1;for(let vr=0;vr<Qt.length;vr++){const hr=Qt[vr];if(!Ce.horizontal[hr])if(It)Ce.horizontal[hr]=Ce.horizontal[0];else{const ir=kw(Ee,t,i,h,oe,Tt,bt,"center",hr,ht,je,Fs.horizontal,!1,de,pe);ir&&(Ce.horizontal[hr]=ir,It=ir.positionedLines.length===1)}}ar("left")}else{if(vt==="auto"&&(vt=Dw(wt)),Gt||M.get("text-writing-mode").indexOf("horizontal")>=0||!ul(Ye)){const Qt=kw(Ee,t,i,h,oe,Tt,bt,wt,vt,ht,je,Fs.horizontal,!1,de,pe);Qt&&(Ce.horizontal[vt]=Qt)}ar(Gt?"left":vt)}}let Ze=!1;if(Q.icon&&Q.icon.namePrimary){const Ye=l[Q.icon.namePrimary];Ye&&(Le=_6(h[Q.icon.namePrimary],Q.icon.nameSecondary?h[Q.icon.nameSecondary]:void 0,M.get("icon-offset").evaluate(Q,{},y),M.get("icon-anchor").evaluate(Q,{},y)),Ze=Ye.sdf,r.sdfIcons===void 0?r.sdfIcons=Ye.sdf:r.sdfIcons!==Ye.sdf&&Tr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ye.pixelRatio!==r.pixelRatio||M.get("icon-rotate").constantOr(1)!==0)&&(r.iconsNeedLinear=!0))}const it=_3(Ce.horizontal)||Ce.vertical;r.iconsInText||(r.iconsInText=!!it&&it.iconsInText),(it||Le)&&E6(r,Q,Ce,Le,l,O,de,0,je,Ze,g,y,E,A,q)}d&&r.generateCollisionDebugBuffers(b,r.collisionBoxArray)},o.dH=bw,o.dI=hd,o.dJ=vx,o.dK=Z,o.dL=_x,o.dM=gx,o.dN=me,o.dO=Hk,o.dP=function(r){let t=0;if(new Uint32Array(r,0,1)[0]!==j3){const i=new Uint32Array(r,0,7),[,,l,h,d,g]=i;t=i.byteLength+h+d+g+d,(l!==r.byteLength||t>=r.byteLength)&&Tr("Invalid b3dm header information.")}return q3(r,t)},o.dQ=function(r,t){const i=Y3(r);for(const l of i){for(const h of l.meshes)_z(h);l.lights&&(l.lightMeshIndex=l.meshes.length,l.meshes.push(xz(l.lights,t)))}return i},o.dR=Xx,o.dS=B3,o.dT=Ya,o.dU=function(r){Hr(),Vt&&Vt.then(t=>{t.keys().then(i=>{for(let l=0;l<i.length-r;l++)t.delete(i[l])})})},o.da=class{constructor(r,t,i){this._transformRequestFn=r,this._customAccessToken=t,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){const r=function(){let t="";for(let i=0;i<10;i++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ge,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=r.token,this._skuTokenExpiresAt=r.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(r,t){return this._transformRequestFn&&this._transformRequestFn(r,t)||{url:r}}normalizeStyleURL(r,t){if(!V(r))return r;const i=ce(r);return i.params.push(`sdk=js-${k}`),i.path=`/styles/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||t)}normalizeGlyphsURL(r,t){if(!V(r))return r;const i=ce(r);return i.path=`/fonts/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||t)}normalizeModelURL(r,t){if(!V(r))return r;const i=ce(r);return i.path=`/models/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||t)}normalizeSourceURL(r,t,i,l){if(!V(r))return r;const h=ce(r);return h.path=`/v4/${h.authority}.json`,h.params.push("secure"),i&&h.params.push(`language=${i}`),l&&h.params.push(`worldview=${l}`),this._makeAPIURL(h,this._customAccessToken||t)}normalizeSpriteURL(r,t,i,l){const h=ce(r);return V(r)?(h.path=`/styles/v1${h.path}/sprite${t}${i}`,this._makeAPIURL(h,this._customAccessToken||l)):(h.path+=`${t}${i}`,Oe(h))}normalizeTileURL(r,t,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),r&&!V(r))return r;const l=ce(r);l.path=l.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${t||i&&l.authority!=="raster"&&i===512?"@2x":""}${Xr.supported?".webp":"$1"}`),l.authority==="raster"?l.path=`/${F.RASTER_URL_PREFIX}${l.path}`:l.authority==="rasterarrays"?l.path=`/${F.RASTERARRAYS_URL_PREFIX}${l.path}`:(l.path=l.path.replace(/^.+\/v4\//,"/"),l.path=`/${F.TILE_URL_VERSION}${l.path}`);const h=this._customAccessToken||function(d){for(const g of d){const y=g.match(/^access_token=(.*)$/);if(y)return y[1]}return null}(l.params)||F.ACCESS_TOKEN;return F.REQUIRE_ACCESS_TOKEN&&h&&this._skuToken&&l.params.push(`sku=${this._skuToken}`),this._makeAPIURL(l,h)}canonicalizeTileURL(r,t){const i=ce(r);if(!i.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!i.path.match(/\.[\w]+$/))return r;let l="mapbox://";i.path.match(/^\/raster\/v1\//)?l+=`raster/${i.path.replace(`/${F.RASTER_URL_PREFIX}/`,"")}`:i.path.match(/^\/rasterarrays\/v1\//)?l+=`rasterarrays/${i.path.replace(`/${F.RASTERARRAYS_URL_PREFIX}/`,"")}`:l+=`tiles/${i.path.replace(`/${F.TILE_URL_VERSION}/`,"")}`;let h=i.params;return t&&(h=h.filter(d=>!d.match(/^access_token=/))),h.length&&(l+=`?${h.join("&")}`),l}canonicalizeTileset(r,t){const i=!!t&&V(t),l=[];for(const h of r.tiles||[])B(h)?l.push(this.canonicalizeTileURL(h,i)):l.push(h);return l}_makeAPIURL(r,t){const i="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",l=ce(F.API_URL);if(r.protocol=l.protocol,r.authority=l.authority,r.protocol==="http"){const h=r.params.indexOf("secure");h>=0&&r.params.splice(h,1)}if(l.path!=="/"&&(r.path=`${l.path}${r.path}`),!F.REQUIRE_ACCESS_TOKEN)return Oe(r);if(t=t||F.ACCESS_TOKEN,!this._silenceAuthErrors){if(!t)throw new Error(`An API access token is required to use Mapbox GL. ${i}`);if(t[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${i}`)}return r.params=r.params.filter(h=>h.indexOf("access_token")===-1),r.params.push(`access_token=${t||""}`),Oe(r)}},o.db=function(r,t){t?Ma.add(r):Ma.delete(r)},o.dc=Xr,o.dd=An,o.de=Ti,o.df=be,o.dg=Nt,o.dh=function(r){Ma.delete(r)},o.di=cn,o.dj=Ht,o.dk=k,o.dl=function(r,t){dt=r,kt=t},o.dm=function(r,t,i=!1){if(Ra===w0||Ra===b0||Ra===T0)throw new Error("setRTLTextPlugin cannot be called multiple times.");hl=_t.resolveURL(r),Ra=w0,E0=t,S0(),i||C0()},o.dn=fl,o.dp=function(){Hx().acquire(Hw)},o.dq=function(){const r=gm;r&&(r.isPreloaded()&&r.numActive()===1?(r.release(Hw),gm=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},o.dr=mm,o.ds=function(r){const t=br();if(!t)return;const i=t.delete($t);r&&i.catch(r).then(()=>r())},o.dt=pm,o.du=U3,o.dv=function(r){Ww=_t.resolveURL(r),yd||(yd=new _d(Hx(),new ha)),yd.broadcast("setDracoUrl",Ww)},o.dw=V3,o.dx=function(r){xd=_t.resolveURL(r),yd||(yd=new _d(Hx(),new ha)),yd.broadcast("setMeshoptUrl",xd)},o.dy=rr,o.dz=Qc,o.e=Se,o.f=_t,o.g=function(r,t){return pt(Se(r,{type:"json"}),t)},o.h=Ds,o.i=Rc,o.j=Sp,o.k=Uf,o.l=function(r){return fetch(r).then(t=>t.arrayBuffer()).then(t=>q3(t,0,r))},o.m=C_,o.n=oh,o.o=ph,o.p=c3,o.q=Gf,o.r=jf,o.s=g0,o.t=th,o.u=dh,o.v=Ki,o.w=Tr,o.x=Nc,o.z=I0}),w(["./shared"],function(o){function k(gt){const le=gt?gt.url.toString():void 0;return le?performance.getEntriesByName(le):[]}function R(gt){if(typeof gt=="number"||typeof gt=="boolean"||typeof gt=="string"||gt==null)return JSON.stringify(gt);if(Array.isArray(gt)){let Te="[";for(const Ne of gt)Te+=`${R(Ne)},`;return`${Te}]`}let le="{";for(const Te of Object.keys(gt).sort())le+=`${Te}:${R(gt[Te])},`;return`${le}}`}function F(gt){let le="";for(const Te of o.b2)le+=`/${R(gt[Te])}`;return le}class B{constructor(le){this.keyCache={},this._layers={},this._layerConfigs={},le&&this.replace(le)}replace(le,Te){this._layerConfigs={},this._layers={},this.update(le,[],Te)}update(le,Te,Ne){this._options=Ne;for(const ut of le)this._layerConfigs[ut.id]=ut,(this._layers[ut.id]=o.c2(ut,this.scope,this._options)).compileFilter(),this.keyCache[ut.id]&&delete this.keyCache[ut.id];for(const ut of Te)delete this.keyCache[ut],delete this._layerConfigs[ut],delete this._layers[ut];this.familiesBySource={};const et=function(ut,_t){const $t={};for(let kt=0;kt<ut.length;kt++){const Vt=_t&&_t[ut[kt].id]||F(ut[kt]);_t&&(_t[ut[kt].id]=Vt);let Wt=$t[Vt];Wt||(Wt=$t[Vt]=[]),Wt.push(ut[kt])}const dt=[];for(const kt in $t)dt.push($t[kt]);return dt}(o.a$(this._layerConfigs),this.keyCache);for(const ut of et){const _t=ut.map(br=>this._layers[br.id]),$t=_t[0];if($t.visibility==="none")continue;const dt=$t.source||"";let kt=this.familiesBySource[dt];kt||(kt=this.familiesBySource[dt]={});const Vt=$t.sourceLayer||"_geojsonTileLayer";let Wt=kt[Vt];Wt||(Wt=kt[Vt]=[]),Wt.push(_t)}}}const V=1*o.dA;class G{constructor(le){const Te={},Ne=[];for(const $t in le){const dt=le[$t],kt=Te[$t]={};for(const Vt in dt.glyphs){const Wt=dt.glyphs[+Vt];if(!Wt||Wt.bitmap.width===0||Wt.bitmap.height===0)continue;const br=Wt.metrics.localGlyph?V:1,Hr={x:0,y:0,w:Wt.bitmap.width+2*br,h:Wt.bitmap.height+2*br};Ne.push(Hr),kt[Vt]=Hr}}const{w:et,h:ut}=o.p(Ne),_t=new o.dz({width:et||1,height:ut||1});for(const $t in le){const dt=le[$t];for(const kt in dt.glyphs){const Vt=dt.glyphs[+kt];if(!Vt||Vt.bitmap.width===0||Vt.bitmap.height===0)continue;const Wt=Te[$t][kt],br=Vt.metrics.localGlyph?V:1;o.dz.copy(Vt.bitmap,_t,{x:0,y:0},{x:Wt.x+br,y:Wt.y+br},Vt.bitmap)}}this.image=_t,this.positions=Te}}o.dy(G,"GlyphAtlas");class U{constructor(le){this.tileID=new o.am(le.tileID.overscaledZ,le.tileID.wrap,le.tileID.canonical.z,le.tileID.canonical.x,le.tileID.canonical.y),this.tileZoom=le.tileZoom,this.uid=le.uid,this.zoom=le.zoom,this.canonical=le.tileID.canonical,this.pixelRatio=le.pixelRatio,this.tileSize=le.tileSize,this.source=le.source,this.scope=le.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=le.showCollisionBoxes,this.collectResourceTiming=!!le.collectResourceTiming,this.promoteId=le.promoteId,this.isSymbolTile=le.isSymbolTile,this.tileTransform=o.as(le.tileID.canonical,le.projection),this.projection=le.projection,this.brightness=le.brightness,this.extraShadowCaster=!!le.extraShadowCaster}parse(le,Te,Ne,et,ut){this.status="parsing",this.data=le,this.collisionBoxArray=new o.aD;const _t=new o.dB(Object.keys(le.layers).sort()),$t=new o.dC(this.tileID,this.promoteId);$t.bucketLayerIDs=[];const dt={},kt=new o.dD(256,256),Vt={featureIndex:$t,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:kt,availableImages:Ne,brightness:this.brightness},Wt=Te.familiesBySource[this.source];for(const dn in Wt){const kn=le.layers[dn];if(!kn)continue;let fi=!1,In=!1,Li=!1;for(const Hn of Wt[dn])Hn[0].type==="symbol"?fi=!0:In=!0,Hn[0].is3D()&&Hn[0].type!=="model"&&(Li=!0);if(this.extraShadowCaster&&!Li||this.isSymbolTile===!0&&!fi||this.isSymbolTile===!1&&!In)continue;kn.version===1&&o.w(`Vector tile source "${this.source}" layer "${dn}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Mi=_t.encode(dn),Xi=[];for(let Hn=0;Hn<kn.length;Hn++){const Wn=kn.feature(Hn),pt=$t.getId(Wn,dn);Xi.push({feature:Wn,id:pt,index:Hn,sourceLayerIndex:Mi})}for(const Hn of Wt[dn]){const Wn=Hn[0];(!this.extraShadowCaster||Wn.is3D()&&Wn.type!=="model")&&(this.isSymbolTile!==void 0&&Wn.type==="symbol"!==this.isSymbolTile||Wn.minzoom&&this.zoom<Math.floor(Wn.minzoom)||Wn.maxzoom&&this.zoom>=Wn.maxzoom||Wn.visibility!=="none"&&(J(Hn,this.zoom,Vt.brightness,Ne),(dt[Wn.id]=Wn.createBucket({index:$t.bucketLayerIDs.length,layers:Hn,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Mi,sourceID:this.source,projection:this.projection.spec})).populate(Xi,Vt,this.tileID.canonical,this.tileTransform),$t.bucketLayerIDs.push(Hn.map(pt=>pt.id))))}}let br,Hr,Nr,tn;kt.trim();const ln={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Xr=()=>{if(br)return this.status="done",ut(br);if(this.extraShadowCaster)this.status="done",ut(null,{buckets:o.a$(dt).filter(dn=>!dn.isEmpty()),featureIndex:$t,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Vt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Hr&&Nr&&tn){const dn=new G(Hr),kn=new o.dF(Nr,tn);for(const fi in dt){const In=dt[fi];In instanceof o.aE?(J(In.layers,this.zoom,Vt.brightness,Ne),o.dG(In,Hr,dn.positions,Nr,kn.iconPositions,this.showCollisionBoxes,Ne,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):In.hasPattern&&(In instanceof o.aK||In instanceof o.aL||In instanceof o.cH)&&(J(In.layers,this.zoom,Vt.brightness,Ne),In.addFeatures(Vt,this.tileID.canonical,kn.patternPositions,Ne,this.tileTransform,this.brightness))}this.status="done",ut(null,{buckets:o.a$(dt).filter(fi=>!fi.isEmpty()),featureIndex:$t,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:dn.image,lineAtlas:kt,imageAtlas:kn,brightness:Vt.brightness})}};if(!this.extraShadowCaster){const dn=o.dE(Vt.glyphDependencies,In=>Object.keys(In).map(Number));Object.keys(dn).length?et.send("getGlyphs",{uid:this.uid,stacks:dn,scope:this.scope},(In,Li)=>{br||(br=In,Hr=Li,Xr())},void 0,!1,ln):Hr={};const kn=Object.keys(Vt.iconDependencies);kn.length?et.send("getImages",{icons:kn,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(In,Li)=>{br||(br=In,Nr=Li,Xr())},void 0,!1,ln):Nr={};const fi=Object.keys(Vt.patternDependencies);fi.length?et.send("getImages",{icons:fi,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(In,Li)=>{br||(br=In,tn=Li,Xr())},void 0,!1,ln):tn={}}Xr()}}function J(gt,le,Te,Ne){const et=new o.K(le,{brightness:Te});for(const ut of gt)ut.recalculate(et,Ne)}class X extends o.E{constructor(le,Te,Ne,et,ut,_t){super(),this.actor=le,this.layerIndex=Te,this.availableImages=Ne,this.loadVectorData=ut||o.ah,this.loading={},this.loaded={},this.deduped=new o.af(le.scheduler),this.isSpriteLoaded=et,this.scheduler=le.scheduler,this.brightness=_t}loadTile(le,Te){const Ne=le.uid,et=le&&le.request,ut=et&&et.collectResourceTiming,_t=this.loading[Ne]=new U(le);_t.abort=this.loadVectorData(le,($t,dt)=>{const kt=!this.loading[Ne];if(delete this.loading[Ne],kt||$t||!dt)return _t.status="done",kt||(this.loaded[Ne]=_t),Te($t);const Vt=dt.rawData,Wt={};dt.expires&&(Wt.expires=dt.expires),dt.cacheControl&&(Wt.cacheControl=dt.cacheControl),_t.vectorTile=dt.vectorTile||new o.dH(new o.dI(Vt));const br=()=>{_t.parse(_t.vectorTile,this.layerIndex,this.availableImages,this.actor,(Hr,Nr)=>{if(Hr||!Nr)return Te(Hr);const tn={};if(ut){const ln=k(et);ln.length>0&&(tn.resourceTiming=JSON.parse(JSON.stringify(ln)))}Te(null,o.e({rawTileData:Vt.slice(0)},Nr,Wt,tn))})};this.isSpriteLoaded?br():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(br,{type:"parseTile",isSymbolTile:le.isSymbolTile,zoom:le.tileZoom}):br()}),this.loaded=this.loaded||{},this.loaded[Ne]=_t})}reloadTile(le,Te){const Ne=this.loaded,et=le.uid,ut=this;if(Ne&&Ne[et]){const _t=Ne[et];_t.showCollisionBoxes=le.showCollisionBoxes,_t.projection=le.projection,_t.brightness=le.brightness,_t.tileTransform=o.as(le.tileID.canonical,le.projection),_t.extraShadowCaster=le.extraShadowCaster;const $t=(dt,kt)=>{const Vt=_t.reloadCallback;Vt&&(delete _t.reloadCallback,_t.parse(_t.vectorTile,ut.layerIndex,this.availableImages,ut.actor,Vt)),Te(dt,kt)};_t.status==="parsing"?_t.reloadCallback=$t:_t.status==="done"&&(_t.vectorTile?_t.parse(_t.vectorTile,this.layerIndex,this.availableImages,this.actor,$t):$t())}else Te(null,void 0)}abortTile(le,Te){const Ne=le.uid,et=this.loading[Ne];et&&(et.abort&&et.abort(),delete this.loading[Ne]),Te()}removeTile(le,Te){const Ne=this.loaded,et=le.uid;Ne&&Ne[et]&&delete Ne[et],Te()}}class Y{loadTile(le,Te){const{uid:Ne,encoding:et,rawImageData:ut,padding:_t}=le,$t=ImageBitmap&&ut instanceof ImageBitmap?this.getImageData(ut,_t):ut;Te(null,new o.dJ(Ne,$t,et,_t<1))}getImageData(le,Te){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(le.width,le.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=le.width,this.offscreenCanvas.height=le.height,this.offscreenCanvasContext.drawImage(le,0,0,le.width,le.height);const Ne=this.offscreenCanvasContext.getImageData(-Te,-Te,le.width+2*Te,le.height+2*Te);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Ne}}class Z{decodeRasterArray({task:le,buffer:Te},Ne){o.aZ.performDecoding(Te,le).then(et=>{Ne(null,et)},et=>{Ne(et)})}}function _e(gt,le){if(gt.length!==0){ke(gt[0],le);for(var Te=1;Te<gt.length;Te++)ke(gt[Te],!le)}}function ke(gt,le){for(var Te=0,Ne=0,et=0,ut=gt.length,_t=ut-1;et<ut;_t=et++){var $t=(gt[et][0]-gt[_t][0])*(gt[_t][1]+gt[et][1]),dt=Te+$t;Ne+=Math.abs(Te)>=Math.abs($t)?Te-dt+$t:$t-dt+Te,Te=dt}Te+Ne>=0!=!!le&&gt.reverse()}var Ae=o.dK(function gt(le,Te){var Ne,et=le&&le.type;if(et==="FeatureCollection")for(Ne=0;Ne<le.features.length;Ne++)gt(le.features[Ne],Te);else if(et==="GeometryCollection")for(Ne=0;Ne<le.geometries.length;Ne++)gt(le.geometries[Ne],Te);else if(et==="Feature")gt(le.geometry,Te);else if(et==="Polygon")_e(le.coordinates,Te);else if(et==="MultiPolygon")for(Ne=0;Ne<le.coordinates.length;Ne++)_e(le.coordinates[Ne],Te);return le});const me=o.dL.prototype.toGeoJSON;let De=class{constructor(gt){this._feature=gt,this.extent=o.V,this.type=gt.type,this.properties=gt.tags,"id"in gt&&!isNaN(gt.id)&&(this.id=parseInt(gt.id,10))}loadGeometry(){if(this._feature.type===1){const gt=[];for(const le of this._feature.geometry)gt.push([new o.P(le[0],le[1])]);return gt}{const gt=[];for(const le of this._feature.geometry){const Te=[];for(const Ne of le)Te.push(new o.P(Ne[0],Ne[1]));gt.push(Te)}return gt}}toGeoJSON(gt,le,Te){return me.call(this,gt,le,Te)}},we=class{constructor(gt){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.V,this.length=gt.length,this._features=gt}feature(gt){return new De(this._features[gt])}};var Je={exports:{}},rt=o.dN,Re=o.dM.VectorTileFeature,St=Lt;function Lt(gt,le){this.options=le||{},this.features=gt,this.length=gt.length}function We(gt,le){this.id=typeof gt.id=="number"?gt.id:void 0,this.type=gt.type,this.rawGeometry=gt.type===1?[gt.geometry]:gt.geometry,this.properties=gt.tags,this.extent=le||4096}Lt.prototype.feature=function(gt){return new We(this.features[gt],this.options.extent)},We.prototype.loadGeometry=function(){var gt=this.rawGeometry;this.geometry=[];for(var le=0;le<gt.length;le++){for(var Te=gt[le],Ne=[],et=0;et<Te.length;et++)Ne.push(new rt(Te[et][0],Te[et][1]));this.geometry.push(Ne)}return this.geometry},We.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var gt=this.geometry,le=1/0,Te=-1/0,Ne=1/0,et=-1/0,ut=0;ut<gt.length;ut++)for(var _t=gt[ut],$t=0;$t<_t.length;$t++){var dt=_t[$t];le=Math.min(le,dt.x),Te=Math.max(Te,dt.x),Ne=Math.min(Ne,dt.y),et=Math.max(et,dt.y)}return[le,Ne,Te,et]},We.prototype.toGeoJSON=Re.prototype.toGeoJSON;var qt=o.dO,Ot=St;function st(gt){var le=new qt;return function(Te,Ne){for(var et in Te.layers)Ne.writeMessage(3,Ve,Te.layers[et])}(gt,le),le.finish()}function Ve(gt,le){var Te;le.writeVarintField(15,gt.version||1),le.writeStringField(1,gt.name||""),le.writeVarintField(5,gt.extent||4096);var Ne={keys:[],values:[],keycache:{},valuecache:{}};for(Te=0;Te<gt.length;Te++)Ne.feature=gt.feature(Te),le.writeMessage(2,Et,Ne);var et=Ne.keys;for(Te=0;Te<et.length;Te++)le.writeStringField(3,et[Te]);var ut=Ne.values;for(Te=0;Te<ut.length;Te++)le.writeMessage(4,Xe,ut[Te])}function Et(gt,le){var Te=gt.feature;Te.id!==void 0&&le.writeVarintField(1,Te.id),le.writeMessage(2,Dt,gt),le.writeVarintField(3,Te.type),le.writeMessage(4,He,Te)}function Dt(gt,le){var Te=gt.feature,Ne=gt.keys,et=gt.values,ut=gt.keycache,_t=gt.valuecache;for(var $t in Te.properties){var dt=Te.properties[$t],kt=ut[$t];if(dt!==null){kt===void 0&&(Ne.push($t),ut[$t]=kt=Ne.length-1),le.writeVarint(kt);var Vt=typeof dt;Vt!=="string"&&Vt!=="boolean"&&Vt!=="number"&&(dt=JSON.stringify(dt));var Wt=Vt+":"+dt,br=_t[Wt];br===void 0&&(et.push(dt),_t[Wt]=br=et.length-1),le.writeVarint(br)}}}function Se(gt,le){return(le<<3)+(7&gt)}function at(gt){return gt<<1^gt>>31}function He(gt,le){for(var Te=gt.loadGeometry(),Ne=gt.type,et=0,ut=0,_t=Te.length,$t=0;$t<_t;$t++){var dt=Te[$t],kt=1;Ne===1&&(kt=dt.length),le.writeVarint(Se(1,kt));for(var Vt=Ne===3?dt.length-1:dt.length,Wt=0;Wt<Vt;Wt++){Wt===1&&Ne!==1&&le.writeVarint(Se(2,Vt-1));var br=dt[Wt].x-et,Hr=dt[Wt].y-ut;le.writeVarint(at(br)),le.writeVarint(at(Hr)),et+=br,ut+=Hr}Ne===3&&le.writeVarint(Se(7,1))}}function Xe(gt,le){var Te=typeof gt;Te==="string"?le.writeStringField(1,gt):Te==="boolean"?le.writeBooleanField(7,gt):Te==="number"&&(gt%1!=0?le.writeDoubleField(3,gt):gt<0?le.writeSVarintField(6,gt):le.writeVarintField(5,gt))}Je.exports=st,Je.exports.fromVectorTileJs=st,Je.exports.fromGeojsonVt=function(gt,le){le=le||{};var Te={};for(var Ne in gt)Te[Ne]=new Ot(gt[Ne].features,le),Te[Ne].name=Ne,Te[Ne].version=le.version,Te[Ne].extent=le.extent;return st({layers:Te})},Je.exports.GeoJSONWrapper=Ot;var yt=o.dK(Je.exports);const Jt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:gt=>gt},sr=Math.fround||(Xt=new Float32Array(1),gt=>(Xt[0]=+gt,Xt[0]));var Xt;const zt=3,Or=5,Be=6;class Fn{constructor(le){this.options=Object.assign(Object.create(Jt),le),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(le){const{log:Te,minZoom:Ne,maxZoom:et}=this.options;Te&&console.time("total time");const ut=`prepare ${le.length} points`;Te&&console.time(ut),this.points=le;const _t=[];for(let dt=0;dt<le.length;dt++){const kt=le[dt];if(!kt.geometry)continue;const[Vt,Wt]=kt.geometry.coordinates,br=sr(Ir(Vt)),Hr=sr(nr(Wt));_t.push(br,Hr,1/0,dt,-1,1),this.options.reduce&&_t.push(0)}let $t=this.trees[et+1]=this._createTree(_t);Te&&console.timeEnd(ut);for(let dt=et;dt>=Ne;dt--){const kt=+Date.now();$t=this.trees[dt]=this._createTree(this._cluster($t,dt)),Te&&console.log("z%d: %d clusters in %dms",dt,$t.numItems,+Date.now()-kt)}return Te&&console.timeEnd("total time"),this}getClusters(le,Te){let Ne=((le[0]+180)%360+360)%360-180;const et=Math.max(-90,Math.min(90,le[1]));let ut=le[2]===180?180:((le[2]+180)%360+360)%360-180;const _t=Math.max(-90,Math.min(90,le[3]));if(le[2]-le[0]>=360)Ne=-180,ut=180;else if(Ne>ut){const Wt=this.getClusters([Ne,et,180,_t],Te),br=this.getClusters([-180,et,ut,_t],Te);return Wt.concat(br)}const $t=this.trees[this._limitZoom(Te)],dt=$t.range(Ir(Ne),nr(_t),Ir(ut),nr(et)),kt=$t.data,Vt=[];for(const Wt of dt){const br=this.stride*Wt;Vt.push(kt[br+Or]>1?Tr(kt,br,this.clusterProps):this.points[kt[br+zt]])}return Vt}getChildren(le){const Te=this._getOriginId(le),Ne=this._getOriginZoom(le),et="No cluster with the specified id.",ut=this.trees[Ne];if(!ut)throw new Error(et);const _t=ut.data;if(Te*this.stride>=_t.length)throw new Error(et);const $t=this.options.radius/(this.options.extent*Math.pow(2,Ne-1)),dt=ut.within(_t[Te*this.stride],_t[Te*this.stride+1],$t),kt=[];for(const Vt of dt){const Wt=Vt*this.stride;_t[Wt+4]===le&&kt.push(_t[Wt+Or]>1?Tr(_t,Wt,this.clusterProps):this.points[_t[Wt+zt]])}if(kt.length===0)throw new Error(et);return kt}getLeaves(le,Te,Ne){const et=[];return this._appendLeaves(et,le,Te=Te||10,Ne=Ne||0,0),et}getTile(le,Te,Ne){const et=this.trees[this._limitZoom(le)],ut=Math.pow(2,le),{extent:_t,radius:$t}=this.options,dt=$t/_t,kt=(Ne-dt)/ut,Vt=(Ne+1+dt)/ut,Wt={features:[]};return this._addTileFeatures(et.range((Te-dt)/ut,kt,(Te+1+dt)/ut,Vt),et.data,Te,Ne,ut,Wt),Te===0&&this._addTileFeatures(et.range(1-dt/ut,kt,1,Vt),et.data,ut,Ne,ut,Wt),Te===ut-1&&this._addTileFeatures(et.range(0,kt,dt/ut,Vt),et.data,-1,Ne,ut,Wt),Wt.features.length?Wt:null}getClusterExpansionZoom(le){let Te=this._getOriginZoom(le)-1;for(;Te<=this.options.maxZoom;){const Ne=this.getChildren(le);if(Te++,Ne.length!==1)break;le=Ne[0].properties.cluster_id}return Te}_appendLeaves(le,Te,Ne,et,ut){const _t=this.getChildren(Te);for(const $t of _t){const dt=$t.properties;if(dt&&dt.cluster?ut+dt.point_count<=et?ut+=dt.point_count:ut=this._appendLeaves(le,dt.cluster_id,Ne,et,ut):ut<et?ut++:le.push($t),le.length===Ne)break}return ut}_createTree(le){const Te=new o.bg(le.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Ne=0;Ne<le.length;Ne+=this.stride)Te.add(le[Ne],le[Ne+1]);return Te.finish(),Te.data=le,Te}_addTileFeatures(le,Te,Ne,et,ut,_t){for(const $t of le){const dt=$t*this.stride,kt=Te[dt+Or]>1;let Vt,Wt,br;if(kt)Vt=Er(Te,dt,this.clusterProps),Wt=Te[dt],br=Te[dt+1];else{const tn=this.points[Te[dt+zt]];Vt=tn.properties;const[ln,Xr]=tn.geometry.coordinates;Wt=Ir(ln),br=nr(Xr)}const Hr={type:1,geometry:[[Math.round(this.options.extent*(Wt*ut-Ne)),Math.round(this.options.extent*(br*ut-et))]],tags:Vt};let Nr;Nr=kt||this.options.generateId?Te[dt+zt]:this.points[Te[dt+zt]].id,Nr!==void 0&&(Hr.id=Nr),_t.features.push(Hr)}}_limitZoom(le){return Math.max(this.options.minZoom,Math.min(Math.floor(+le),this.options.maxZoom+1))}_cluster(le,Te){const{radius:Ne,extent:et,reduce:ut,minPoints:_t}=this.options,$t=Ne/(et*Math.pow(2,Te)),dt=le.data,kt=[],Vt=this.stride;for(let Wt=0;Wt<dt.length;Wt+=Vt){if(dt[Wt+2]<=Te)continue;dt[Wt+2]=Te;const br=dt[Wt],Hr=dt[Wt+1],Nr=le.within(dt[Wt],dt[Wt+1],$t),tn=dt[Wt+Or];let ln=tn;for(const Xr of Nr){const dn=Xr*Vt;dt[dn+2]>Te&&(ln+=dt[dn+Or])}if(ln>tn&&ln>=_t){let Xr,dn=br*tn,kn=Hr*tn,fi=-1;const In=(Wt/Vt<<5)+(Te+1)+this.points.length;for(const Li of Nr){const Mi=Li*Vt;if(dt[Mi+2]<=Te)continue;dt[Mi+2]=Te;const Xi=dt[Mi+Or];dn+=dt[Mi]*Xi,kn+=dt[Mi+1]*Xi,dt[Mi+4]=In,ut&&(Xr||(Xr=this._map(dt,Wt,!0),fi=this.clusterProps.length,this.clusterProps.push(Xr)),ut(Xr,this._map(dt,Mi)))}dt[Wt+4]=In,kt.push(dn/ln,kn/ln,1/0,In,-1,ln),ut&&kt.push(fi)}else{for(let Xr=0;Xr<Vt;Xr++)kt.push(dt[Wt+Xr]);if(ln>1)for(const Xr of Nr){const dn=Xr*Vt;if(!(dt[dn+2]<=Te)){dt[dn+2]=Te;for(let kn=0;kn<Vt;kn++)kt.push(dt[dn+kn])}}}}return kt}_getOriginId(le){return le-this.points.length>>5}_getOriginZoom(le){return(le-this.points.length)%32}_map(le,Te,Ne){if(le[Te+Or]>1){const _t=this.clusterProps[le[Te+Be]];return Ne?Object.assign({},_t):_t}const et=this.points[le[Te+zt]].properties,ut=this.options.map(et);return Ne&&ut===et?Object.assign({},ut):ut}}function Tr(gt,le,Te){return{type:"Feature",id:gt[le+zt],properties:Er(gt,le,Te),geometry:{type:"Point",coordinates:[(Ne=gt[le],360*(Ne-.5)),En(gt[le+1])]}};var Ne}function Er(gt,le,Te){const Ne=gt[le+Or],et=Ne>=1e4?`${Math.round(Ne/1e3)}k`:Ne>=1e3?Math.round(Ne/100)/10+"k":Ne,ut=gt[le+Be],_t=ut===-1?{}:Object.assign({},Te[ut]);return Object.assign(_t,{cluster:!0,cluster_id:gt[le+zt],point_count:Ne,point_count_abbreviated:et})}function Ir(gt){return gt/360+.5}function nr(gt){const le=Math.sin(gt*Math.PI/180),Te=.5-.25*Math.log((1+le)/(1-le))/Math.PI;return Te<0?0:Te>1?1:Te}function En(gt){const le=(180-360*gt)*Math.PI/180;return 360*Math.atan(Math.exp(le))/Math.PI-90}var Xn={exports:{}};Xn.exports=function(){function gt(pt,xt,Ft,re){for(var fe,se=re,he=Ft-xt>>1,ge=Ft-xt,be=pt[xt],ze=pt[xt+1],ce=pt[Ft],Oe=pt[Ft+1],Me=xt+3;Me<Ft;Me+=3){var Ke=le(pt[Me],pt[Me+1],be,ze,ce,Oe);if(Ke>se)fe=Me,se=Ke;else if(Ke===se){var At=Math.abs(Me-he);At<ge&&(fe=Me,ge=At)}}se>re&&(fe-xt>3&&gt(pt,xt,fe,re),pt[fe+2]=se,Ft-fe>3&&gt(pt,fe,Ft,re))}function le(pt,xt,Ft,re,fe,se){var he=fe-Ft,ge=se-re;if(he!==0||ge!==0){var be=((pt-Ft)*he+(xt-re)*ge)/(he*he+ge*ge);be>1?(Ft=fe,re=se):be>0&&(Ft+=he*be,re+=ge*be)}return(he=pt-Ft)*he+(ge=xt-re)*ge}function Te(pt,xt,Ft,re){var fe={id:pt===void 0?null:pt,type:xt,geometry:Ft,tags:re,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(se){var he=se.geometry,ge=se.type;if(ge==="Point"||ge==="MultiPoint"||ge==="LineString")Ne(se,he);else if(ge==="Polygon"||ge==="MultiLineString")for(var be=0;be<he.length;be++)Ne(se,he[be]);else if(ge==="MultiPolygon")for(be=0;be<he.length;be++)for(var ze=0;ze<he[be].length;ze++)Ne(se,he[be][ze])}(fe),fe}function Ne(pt,xt){for(var Ft=0;Ft<xt.length;Ft+=3)pt.minX=Math.min(pt.minX,xt[Ft]),pt.minY=Math.min(pt.minY,xt[Ft+1]),pt.maxX=Math.max(pt.maxX,xt[Ft]),pt.maxY=Math.max(pt.maxY,xt[Ft+1])}function et(pt,xt,Ft,re){if(xt.geometry){var fe=xt.geometry.coordinates,se=xt.geometry.type,he=Math.pow(Ft.tolerance/((1<<Ft.maxZoom)*Ft.extent),2),ge=[],be=xt.id;if(Ft.promoteId?be=xt.properties[Ft.promoteId]:Ft.generateId&&(be=re||0),se==="Point")ut(fe,ge);else if(se==="MultiPoint")for(var ze=0;ze<fe.length;ze++)ut(fe[ze],ge);else if(se==="LineString")_t(fe,ge,he,!1);else if(se==="MultiLineString"){if(Ft.lineMetrics){for(ze=0;ze<fe.length;ze++)_t(fe[ze],ge=[],he,!1),pt.push(Te(be,"LineString",ge,xt.properties));return}$t(fe,ge,he,!1)}else if(se==="Polygon")$t(fe,ge,he,!0);else{if(se!=="MultiPolygon"){if(se==="GeometryCollection"){for(ze=0;ze<xt.geometry.geometries.length;ze++)et(pt,{id:be,geometry:xt.geometry.geometries[ze],properties:xt.properties},Ft,re);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ze=0;ze<fe.length;ze++){var ce=[];$t(fe[ze],ce,he,!0),ge.push(ce)}}pt.push(Te(be,se,ge,xt.properties))}}function ut(pt,xt){xt.push(dt(pt[0])),xt.push(kt(pt[1])),xt.push(0)}function _t(pt,xt,Ft,re){for(var fe,se,he=0,ge=0;ge<pt.length;ge++){var be=dt(pt[ge][0]),ze=kt(pt[ge][1]);xt.push(be),xt.push(ze),xt.push(0),ge>0&&(he+=re?(fe*ze-be*se)/2:Math.sqrt(Math.pow(be-fe,2)+Math.pow(ze-se,2))),fe=be,se=ze}var ce=xt.length-3;xt[2]=1,gt(xt,0,ce,Ft),xt[ce+2]=1,xt.size=Math.abs(he),xt.start=0,xt.end=xt.size}function $t(pt,xt,Ft,re){for(var fe=0;fe<pt.length;fe++){var se=[];_t(pt[fe],se,Ft,re),xt.push(se)}}function dt(pt){return pt/360+.5}function kt(pt){var xt=Math.sin(pt*Math.PI/180),Ft=.5-.25*Math.log((1+xt)/(1-xt))/Math.PI;return Ft<0?0:Ft>1?1:Ft}function Vt(pt,xt,Ft,re,fe,se,he,ge){if(re/=xt,se>=(Ft/=xt)&&he<re)return pt;if(he<Ft||se>=re)return null;for(var be=[],ze=0;ze<pt.length;ze++){var ce=pt[ze],Oe=ce.geometry,Me=ce.type,Ke=fe===0?ce.minX:ce.minY,At=fe===0?ce.maxX:ce.maxY;if(Ke>=Ft&&At<re)be.push(ce);else if(!(At<Ft||Ke>=re)){var Rt=[];if(Me==="Point"||Me==="MultiPoint")Wt(Oe,Rt,Ft,re,fe);else if(Me==="LineString")br(Oe,Rt,Ft,re,fe,!1,ge.lineMetrics);else if(Me==="MultiLineString")Nr(Oe,Rt,Ft,re,fe,!1);else if(Me==="Polygon")Nr(Oe,Rt,Ft,re,fe,!0);else if(Me==="MultiPolygon")for(var er=0;er<Oe.length;er++){var Ht=[];Nr(Oe[er],Ht,Ft,re,fe,!0),Ht.length&&Rt.push(Ht)}if(Rt.length){if(ge.lineMetrics&&Me==="LineString"){for(er=0;er<Rt.length;er++)be.push(Te(ce.id,Me,Rt[er],ce.tags));continue}Me!=="LineString"&&Me!=="MultiLineString"||(Rt.length===1?(Me="LineString",Rt=Rt[0]):Me="MultiLineString"),Me!=="Point"&&Me!=="MultiPoint"||(Me=Rt.length===3?"Point":"MultiPoint"),be.push(Te(ce.id,Me,Rt,ce.tags))}}}return be.length?be:null}function Wt(pt,xt,Ft,re,fe){for(var se=0;se<pt.length;se+=3){var he=pt[se+fe];he>=Ft&&he<=re&&(xt.push(pt[se]),xt.push(pt[se+1]),xt.push(pt[se+2]))}}function br(pt,xt,Ft,re,fe,se,he){for(var ge,be,ze=Hr(pt),ce=fe===0?ln:Xr,Oe=pt.start,Me=0;Me<pt.length-3;Me+=3){var Ke=pt[Me],At=pt[Me+1],Rt=pt[Me+2],er=pt[Me+3],Ht=pt[Me+4],Nt=fe===0?Ke:At,yr=fe===0?er:Ht,An=!1;he&&(ge=Math.sqrt(Math.pow(Ke-er,2)+Math.pow(At-Ht,2))),Nt<Ft?yr>Ft&&(be=ce(ze,Ke,At,er,Ht,Ft),he&&(ze.start=Oe+ge*be)):Nt>re?yr<re&&(be=ce(ze,Ke,At,er,Ht,re),he&&(ze.start=Oe+ge*be)):tn(ze,Ke,At,Rt),yr<Ft&&Nt>=Ft&&(be=ce(ze,Ke,At,er,Ht,Ft),An=!0),yr>re&&Nt<=re&&(be=ce(ze,Ke,At,er,Ht,re),An=!0),!se&&An&&(he&&(ze.end=Oe+ge*be),xt.push(ze),ze=Hr(pt)),he&&(Oe+=ge)}var cn=pt.length-3;Ke=pt[cn],At=pt[cn+1],Rt=pt[cn+2],(Nt=fe===0?Ke:At)>=Ft&&Nt<=re&&tn(ze,Ke,At,Rt),cn=ze.length-3,se&&cn>=3&&(ze[cn]!==ze[0]||ze[cn+1]!==ze[1])&&tn(ze,ze[0],ze[1],ze[2]),ze.length&&xt.push(ze)}function Hr(pt){var xt=[];return xt.size=pt.size,xt.start=pt.start,xt.end=pt.end,xt}function Nr(pt,xt,Ft,re,fe,se){for(var he=0;he<pt.length;he++)br(pt[he],xt,Ft,re,fe,se,!1)}function tn(pt,xt,Ft,re){pt.push(xt),pt.push(Ft),pt.push(re)}function ln(pt,xt,Ft,re,fe,se){var he=(se-xt)/(re-xt);return pt.push(se),pt.push(Ft+(fe-Ft)*he),pt.push(1),he}function Xr(pt,xt,Ft,re,fe,se){var he=(se-Ft)/(fe-Ft);return pt.push(xt+(re-xt)*he),pt.push(se),pt.push(1),he}function dn(pt,xt){for(var Ft=[],re=0;re<pt.length;re++){var fe,se=pt[re],he=se.type;if(he==="Point"||he==="MultiPoint"||he==="LineString")fe=kn(se.geometry,xt);else if(he==="MultiLineString"||he==="Polygon"){fe=[];for(var ge=0;ge<se.geometry.length;ge++)fe.push(kn(se.geometry[ge],xt))}else if(he==="MultiPolygon")for(fe=[],ge=0;ge<se.geometry.length;ge++){for(var be=[],ze=0;ze<se.geometry[ge].length;ze++)be.push(kn(se.geometry[ge][ze],xt));fe.push(be)}Ft.push(Te(se.id,he,fe,se.tags))}return Ft}function kn(pt,xt){var Ft=[];Ft.size=pt.size,pt.start!==void 0&&(Ft.start=pt.start,Ft.end=pt.end);for(var re=0;re<pt.length;re+=3)Ft.push(pt[re]+xt,pt[re+1],pt[re+2]);return Ft}function fi(pt,xt){if(pt.transformed)return pt;var Ft,re,fe,se=1<<pt.z,he=pt.x,ge=pt.y;for(Ft=0;Ft<pt.features.length;Ft++){var be=pt.features[Ft],ze=be.geometry,ce=be.type;if(be.geometry=[],ce===1)for(re=0;re<ze.length;re+=2)be.geometry.push(In(ze[re],ze[re+1],xt,se,he,ge));else for(re=0;re<ze.length;re++){var Oe=[];for(fe=0;fe<ze[re].length;fe+=2)Oe.push(In(ze[re][fe],ze[re][fe+1],xt,se,he,ge));be.geometry.push(Oe)}}return pt.transformed=!0,pt}function In(pt,xt,Ft,re,fe,se){return[Math.round(Ft*(pt*re-fe)),Math.round(Ft*(xt*re-se))]}function Li(pt,xt,Ft,re,fe){for(var se=xt===fe.maxZoom?0:fe.tolerance/((1<<xt)*fe.extent),he={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Ft,y:re,z:xt,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ge=0;ge<pt.length;ge++){he.numFeatures++,Mi(he,pt[ge],se,fe);var be=pt[ge].minX,ze=pt[ge].minY,ce=pt[ge].maxX,Oe=pt[ge].maxY;be<he.minX&&(he.minX=be),ze<he.minY&&(he.minY=ze),ce>he.maxX&&(he.maxX=ce),Oe>he.maxY&&(he.maxY=Oe)}return he}function Mi(pt,xt,Ft,re){var fe=xt.geometry,se=xt.type,he=[];if(se==="Point"||se==="MultiPoint")for(var ge=0;ge<fe.length;ge+=3)he.push(fe[ge]),he.push(fe[ge+1]),pt.numPoints++,pt.numSimplified++;else if(se==="LineString")Xi(he,fe,pt,Ft,!1,!1);else if(se==="MultiLineString"||se==="Polygon")for(ge=0;ge<fe.length;ge++)Xi(he,fe[ge],pt,Ft,se==="Polygon",ge===0);else if(se==="MultiPolygon")for(var be=0;be<fe.length;be++){var ze=fe[be];for(ge=0;ge<ze.length;ge++)Xi(he,ze[ge],pt,Ft,!0,ge===0)}if(he.length){var ce=xt.tags||null;if(se==="LineString"&&re.lineMetrics){for(var Oe in ce={},xt.tags)ce[Oe]=xt.tags[Oe];ce.mapbox_clip_start=fe.start/fe.size,ce.mapbox_clip_end=fe.end/fe.size}var Me={geometry:he,type:se==="Polygon"||se==="MultiPolygon"?3:se==="LineString"||se==="MultiLineString"?2:1,tags:ce};xt.id!==null&&(Me.id=xt.id),pt.features.push(Me)}}function Xi(pt,xt,Ft,re,fe,se){var he=re*re;if(re>0&&xt.size<(fe?he:re))Ft.numPoints+=xt.length/3;else{for(var ge=[],be=0;be<xt.length;be+=3)(re===0||xt[be+2]>he)&&(Ft.numSimplified++,ge.push(xt[be]),ge.push(xt[be+1])),Ft.numPoints++;fe&&function(ze,ce){for(var Oe=0,Me=0,Ke=ze.length,At=Ke-2;Me<Ke;At=Me,Me+=2)Oe+=(ze[Me]-ze[At])*(ze[Me+1]+ze[At+1]);if(Oe>0===ce)for(Me=0,Ke=ze.length;Me<Ke/2;Me+=2){var Rt=ze[Me],er=ze[Me+1];ze[Me]=ze[Ke-2-Me],ze[Me+1]=ze[Ke-1-Me],ze[Ke-2-Me]=Rt,ze[Ke-1-Me]=er}}(ge,se),pt.push(ge)}}function Hn(pt,xt){var Ft=(xt=this.options=function(fe,se){for(var he in se)fe[he]=se[he];return fe}(Object.create(this.options),xt)).debug;if(Ft&&console.time("preprocess data"),xt.maxZoom<0||xt.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(xt.promoteId&&xt.generateId)throw new Error("promoteId and generateId cannot be used together.");var re=function(fe,se){var he=[];if(fe.type==="FeatureCollection")for(var ge=0;ge<fe.features.length;ge++)et(he,fe.features[ge],se,ge);else et(he,fe.type==="Feature"?fe:{geometry:fe},se);return he}(pt,xt);this.tiles={},this.tileCoords=[],Ft&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",xt.indexMaxZoom,xt.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(re=function(fe,se){var he=se.buffer/se.extent,ge=fe,be=Vt(fe,1,-1-he,he,0,-1,2,se),ze=Vt(fe,1,1-he,2+he,0,-1,2,se);return(be||ze)&&(ge=Vt(fe,1,-he,1+he,0,-1,2,se)||[],be&&(ge=dn(be,1).concat(ge)),ze&&(ge=ge.concat(dn(ze,-1)))),ge}(re,xt)).length&&this.splitTile(re,0,0,0),Ft&&(re.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Wn(pt,xt,Ft){return 32*((1<<pt)*Ft+xt)+pt}return Hn.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Hn.prototype.splitTile=function(pt,xt,Ft,re,fe,se,he){for(var ge=[pt,xt,Ft,re],be=this.options,ze=be.debug;ge.length;){re=ge.pop(),Ft=ge.pop(),xt=ge.pop(),pt=ge.pop();var ce=1<<xt,Oe=Wn(xt,Ft,re),Me=this.tiles[Oe];if(!Me&&(ze>1&&console.time("creation"),Me=this.tiles[Oe]=Li(pt,xt,Ft,re,be),this.tileCoords.push({z:xt,x:Ft,y:re}),ze)){ze>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",xt,Ft,re,Me.numFeatures,Me.numPoints,Me.numSimplified),console.timeEnd("creation"));var Ke="z"+xt;this.stats[Ke]=(this.stats[Ke]||0)+1,this.total++}if(Me.source=pt,fe){if(xt===be.maxZoom||xt===fe)continue;var At=1<<fe-xt;if(Ft!==Math.floor(se/At)||re!==Math.floor(he/At))continue}else if(xt===be.indexMaxZoom||Me.numPoints<=be.indexMaxPoints)continue;if(Me.source=null,pt.length!==0){ze>1&&console.time("clipping");var Rt,er,Ht,Nt,yr,An,cn=.5*be.buffer/be.extent,Ti=.5-cn,Ma=.5+cn,cs=1+cn;Rt=er=Ht=Nt=null,yr=Vt(pt,ce,Ft-cn,Ft+Ma,0,Me.minX,Me.maxX,be),An=Vt(pt,ce,Ft+Ti,Ft+cs,0,Me.minX,Me.maxX,be),pt=null,yr&&(Rt=Vt(yr,ce,re-cn,re+Ma,1,Me.minY,Me.maxY,be),er=Vt(yr,ce,re+Ti,re+cs,1,Me.minY,Me.maxY,be),yr=null),An&&(Ht=Vt(An,ce,re-cn,re+Ma,1,Me.minY,Me.maxY,be),Nt=Vt(An,ce,re+Ti,re+cs,1,Me.minY,Me.maxY,be),An=null),ze>1&&console.timeEnd("clipping"),ge.push(Rt||[],xt+1,2*Ft,2*re),ge.push(er||[],xt+1,2*Ft,2*re+1),ge.push(Ht||[],xt+1,2*Ft+1,2*re),ge.push(Nt||[],xt+1,2*Ft+1,2*re+1)}}},Hn.prototype.getTile=function(pt,xt,Ft){var re=this.options,fe=re.extent,se=re.debug;if(pt<0||pt>24)return null;var he=1<<pt,ge=Wn(pt,xt=(xt%he+he)%he,Ft);if(this.tiles[ge])return fi(this.tiles[ge],fe);se>1&&console.log("drilling down to z%d-%d-%d",pt,xt,Ft);for(var be,ze=pt,ce=xt,Oe=Ft;!be&&ze>0;)ze--,ce=Math.floor(ce/2),Oe=Math.floor(Oe/2),be=this.tiles[Wn(ze,ce,Oe)];return be&&be.source?(se>1&&console.log("found parent tile z%d-%d-%d",ze,ce,Oe),se>1&&console.time("drilling down"),this.splitTile(be.source,ze,ce,Oe,pt,xt,Ft),se>1&&console.timeEnd("drilling down"),this.tiles[ge]?fi(this.tiles[ge],fe):null):null},function(pt,xt){return new Hn(pt,xt)}}();var wn=o.dK(Xn.exports);function ei(gt,le){const Te=gt.tileID.canonical;if(!this._geoJSONIndex)return le(null,null);const Ne=this._geoJSONIndex.getTile(Te.z,Te.x,Te.y);if(!Ne)return le(null,null);const et=new we(Ne.features);let ut=yt(et);ut.byteOffset===0&&ut.byteLength===ut.buffer.byteLength||(ut=new Uint8Array(ut)),le(null,{vectorTile:et,rawData:ut.buffer})}class bi extends X{constructor(le,Te,Ne,et,ut,_t){super(le,Te,Ne,et,ei,_t),ut&&(this.loadGeoJSON=ut)}loadData(le,Te){const Ne=le&&le.request,et=Ne&&Ne.collectResourceTiming;this.loadGeoJSON(le,(ut,_t)=>{if(ut||!_t)return Te(ut);if(typeof _t!="object")return Te(new Error(`Input data given to '${le.source}' is not a valid GeoJSON object.`));{Ae(_t,!0);try{if(le.filter){const dt=o.r(le.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(dt.result==="error")throw new Error(dt.value.map(Vt=>`${Vt.key}: ${Vt.message}`).join(", "));_t={type:"FeatureCollection",features:_t.features.filter(Vt=>dt.value.evaluate({zoom:0},Vt))}}this._geoJSONIndex=le.cluster?new Fn(function({superclusterOptions:dt,clusterProperties:kt}){if(!kt||!dt)return dt;const Vt={},Wt={},br={accumulated:null,zoom:0},Hr={properties:null},Nr=Object.keys(kt);for(const tn of Nr){const[ln,Xr]=kt[tn],dn=o.r(Xr),kn=o.r(typeof ln=="string"?[ln,["accumulated"],["get",tn]]:ln);Vt[tn]=dn.value,Wt[tn]=kn.value}return dt.map=tn=>{Hr.properties=tn;const ln={};for(const Xr of Nr)ln[Xr]=Vt[Xr].evaluate(br,Hr);return ln},dt.reduce=(tn,ln)=>{Hr.properties=ln;for(const Xr of Nr)br.accumulated=tn[Xr],tn[Xr]=Wt[Xr].evaluate(br,Hr)},dt}(le)).load(_t.features):wn(_t,le.geojsonVtOptions)}catch(dt){return Te(dt)}this.loaded={};const $t={};if(et){const dt=k(Ne);dt&&($t.resourceTiming={},$t.resourceTiming[le.source]=JSON.parse(JSON.stringify(dt)))}Te(null,$t)}})}reloadTile(le,Te){const Ne=this.loaded;return Ne&&Ne[le.uid]?super.reloadTile(le,Te):this.loadTile(le,Te)}loadGeoJSON(le,Te){if(le.request)o.g(le.request,Te);else{if(typeof le.data!="string")return Te(new Error(`Input data given to '${le.source}' is not a valid GeoJSON object.`));try{return Te(null,JSON.parse(le.data))}catch{return Te(new Error(`Input data given to '${le.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(le,Te){try{Te(null,this._geoJSONIndex.getClusterExpansionZoom(le.clusterId))}catch(Ne){Te(Ne)}}getClusterChildren(le,Te){try{Te(null,this._geoJSONIndex.getChildren(le.clusterId))}catch(Ne){Te(Ne)}}getClusterLeaves(le,Te){try{Te(null,this._geoJSONIndex.getLeaves(le.clusterId,le.limit,le.offset))}catch(Ne){Te(Ne)}}}class Mn{constructor(le,Te){this.tileID=new o.am(le.tileID.overscaledZ,le.tileID.wrap,le.tileID.canonical.z,le.tileID.canonical.x,le.tileID.canonical.y),this.tileZoom=le.tileZoom,this.uid=le.uid,this.zoom=le.zoom,this.canonical=le.tileID.canonical,this.pixelRatio=le.pixelRatio,this.tileSize=le.tileSize,this.source=le.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=le.projection,this.brightness=Te}parse(le,Te,Ne,et){this.status="parsing";const ut=new o.am(Ne.tileID.overscaledZ,Ne.tileID.wrap,Ne.tileID.canonical.z,Ne.tileID.canonical.x,Ne.tileID.canonical.y),_t={},$t=Te.familiesBySource[Ne.source],dt=new o.dC(ut,Ne.promoteId);return dt.bucketLayerIDs=[],dt.is3DTile=!0,o.dP(le).then(kt=>{if(!kt)return et(new Error("Could not parse tile"));const Vt=o.dQ(kt,1/o.bR(Ne.tileID.canonical)),Wt=kt.json.extensionsUsed&&kt.json.extensionsUsed.includes("MAPBOX_mesh_features")||kt.json.asset.extras&&kt.json.asset.extras.MAPBOX_mesh_features,br=kt.json.extensionsUsed&&kt.json.extensionsUsed.includes("EXT_meshopt_compression"),Hr=new o.K(this.zoom,{brightness:this.brightness});for(const Nr in $t)for(const tn of $t[Nr]){const ln=tn[0];dt.bucketLayerIDs.push(tn.map(dn=>dn.id)),ln.recalculate(Hr,[]);const Xr=new o.dR(Vt,ut,Wt,br,this.brightness,dt);Wt||(Xr.needsUpload=!0),_t[ln.fqid]=Xr,Xr.evaluate(ln)}this.status="done",et(null,{buckets:_t,featureIndex:dt})}).catch(kt=>et(new Error(kt.message)))}}class Nn{constructor(le,Te,Ne,et,ut,_t){this.actor=le,this.layerIndex=Te,this.brightness=_t,this.loading={},this.loaded={}}loadTile(le,Te){const Ne=le.uid,et=this.loading[Ne]=new Mn(le,this.brightness);o.a_(le.request,(ut,_t)=>{const $t=!this.loading[Ne];return delete this.loading[Ne],$t||ut?(et.status="done",$t||(this.loaded[Ne]=et),Te(ut)):_t&&_t.byteLength!==0?void et.parse(_t,this.layerIndex,le,(dt,kt)=>{et.status="done",this.loaded=this.loaded||{},this.loaded[Ne]=et,dt||!kt?Te(dt):Te(null,kt)}):(et.status="done",this.loaded[Ne]=et,Te())})}reloadTile(le,Te){const Ne=this.loaded,et=le.uid;if(Ne&&Ne[et]){const ut=Ne[et];ut.projection=le.projection,ut.brightness=le.brightness;const _t=($t,dt)=>{ut.reloadCallback&&(delete ut.reloadCallback,this.loadTile(le,Te)),Te($t,dt)};ut.status==="parsing"?ut.reloadCallback=_t:ut.status==="done"&&this.loadTile(le,Te)}}abortTile(le,Te){const Ne=le.uid;this.loading[Ne]&&delete this.loading[Ne],Te()}removeTile(le,Te){const Ne=this.loaded,et=le.uid;Ne&&Ne[et]&&delete Ne[et],Te()}}class ti{constructor(le){this.self=le,this.actor=new o.dS(le,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=o.bo({name:"mercator"}),this.workerSourceTypes={vector:X,geojson:bi,"batched-model":Nn},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(Te,Ne)=>{if(this.workerSourceTypes[Te])throw new Error(`Worker source with name "${Te}" already registered.`);this.workerSourceTypes[Te]=Ne},this.self.registerRTLTextPlugin=Te=>{if(o.dT.isParsed())throw new Error("RTL text plugin already registered.");o.dT.applyArabicShaping=Te.applyArabicShaping,o.dT.processBidirectionalText=Te.processBidirectionalText,o.dT.processStyledBidirectionalText=Te.processStyledBidirectionalText}}clearCaches(le,Te,Ne){delete this.layerIndexes[le],delete this.availableImages[le],delete this.workerSources[le],delete this.demWorkerSources[le],delete this.rasterArrayWorkerSource,Ne()}checkIfReady(le,Te,Ne){Ne()}setReferrer(le,Te){this.referrer=Te}spriteLoaded(le,{scope:Te,isLoaded:Ne}){if(this.isSpriteLoaded[le]||(this.isSpriteLoaded[le]={}),this.isSpriteLoaded[le][Te]=Ne,this.workerSources[le]&&this.workerSources[le][Te])for(const et in this.workerSources[le][Te]){const ut=this.workerSources[le][Te][et];for(const _t in ut)ut[_t]instanceof X&&(ut[_t].isSpriteLoaded=Ne,ut[_t].fire(new o.b("isSpriteLoaded")))}}setImages(le,{scope:Te,images:Ne},et){if(this.availableImages[le]||(this.availableImages[le]={}),this.availableImages[le][Te]=Ne,this.workerSources[le]&&this.workerSources[le][Te]){for(const ut in this.workerSources[le][Te]){const _t=this.workerSources[le][Te][ut];for(const $t in _t)_t[$t].availableImages=Ne}et()}else et()}setProjection(le,Te){this.projections[le]=o.bo(Te)}setBrightness(le,Te,Ne){this.brightness=Te,Ne()}setLayers(le,Te,Ne){this.getLayerIndex(le,Te.scope).replace(Te.layers,Te.options),Ne()}updateLayers(le,Te,Ne){this.getLayerIndex(le,Te.scope).update(Te.layers,Te.removedIds,Te.options),Ne()}loadTile(le,Te,Ne){Te.projection=this.projections[le]||this.defaultProjection,this.getWorkerSource(le,Te.type,Te.source,Te.scope).loadTile(Te,Ne)}loadDEMTile(le,Te,Ne){this.getDEMWorkerSource(le,Te.source,Te.scope).loadTile(Te,Ne)}decodeRasterArray(le,Te,Ne){this.getRasterArrayWorkerSource().decodeRasterArray(Te,Ne)}reloadTile(le,Te,Ne){Te.projection=this.projections[le]||this.defaultProjection,this.getWorkerSource(le,Te.type,Te.source,Te.scope).reloadTile(Te,Ne)}abortTile(le,Te,Ne){this.getWorkerSource(le,Te.type,Te.source,Te.scope).abortTile(Te,Ne)}removeTile(le,Te,Ne){this.getWorkerSource(le,Te.type,Te.source,Te.scope).removeTile(Te,Ne)}removeSource(le,Te,Ne){if(!(this.workerSources[le]&&this.workerSources[le][Te.scope]&&this.workerSources[le][Te.scope][Te.type]&&this.workerSources[le][Te.scope][Te.type][Te.source]))return;const et=this.workerSources[le][Te.scope][Te.type][Te.source];delete this.workerSources[le][Te.scope][Te.type][Te.source],et.removeSource!==void 0?et.removeSource(Te,Ne):Ne()}loadWorkerSource(le,Te,Ne){try{this.self.importScripts(Te.url),Ne()}catch(et){Ne(et.toString())}}syncRTLPluginState(le,Te,Ne){try{o.dT.setState(Te);const et=o.dT.getPluginURL();if(o.dT.isLoaded()&&!o.dT.isParsed()&&et!=null){this.self.importScripts(et);const ut=o.dT.isParsed();Ne(ut?void 0:new Error(`RTL Text Plugin failed to import scripts from ${et}`),ut)}}catch(et){Ne(et.toString())}}setDracoUrl(le,Te){this.dracoUrl=Te}getAvailableImages(le,Te){this.availableImages[le]||(this.availableImages[le]={});let Ne=this.availableImages[le][Te];return Ne||(Ne=[]),Ne}getLayerIndex(le,Te){this.layerIndexes[le]||(this.layerIndexes[le]={});let Ne=this.layerIndexes[le][Te];return Ne||(Ne=this.layerIndexes[le][Te]=new B,Ne.scope=Te),Ne}getWorkerSource(le,Te,Ne,et){if(this.workerSources[le]||(this.workerSources[le]={}),this.workerSources[le][et]||(this.workerSources[le][et]={}),this.workerSources[le][et][Te]||(this.workerSources[le][et][Te]={}),this.isSpriteLoaded[le]||(this.isSpriteLoaded[le]={}),!this.workerSources[le][et][Te][Ne]){const ut={send:(_t,$t,dt,kt,Vt,Wt)=>{this.actor.send(_t,$t,dt,le,Vt,Wt)},scheduler:this.actor.scheduler};this.workerSources[le][et][Te][Ne]=new this.workerSourceTypes[Te](ut,this.getLayerIndex(le,et),this.getAvailableImages(le,et),this.isSpriteLoaded[le][et],void 0,this.brightness)}return this.workerSources[le][et][Te][Ne]}getDEMWorkerSource(le,Te,Ne){return this.demWorkerSources[le]||(this.demWorkerSources[le]={}),this.demWorkerSources[le][Ne]||(this.demWorkerSources[le][Ne]={}),this.demWorkerSources[le][Ne][Te]||(this.demWorkerSources[le][Ne][Te]=new Y),this.demWorkerSources[le][Ne][Te]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new Z),this.rasterArrayWorkerSource}enforceCacheSizeLimit(le,Te){o.dU(Te)}getWorkerPerformanceMetrics(le,Te,Ne){Ne(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new ti(self)),ti}),w(["./shared"],function(o){function k(p,s){if(Array.isArray(p)){if(!Array.isArray(s)||p.length!==s.length)return!1;for(let c=0;c<p.length;c++)if(!k(p[c],s[c]))return!1;return!0}if(typeof p=="object"&&p!==null&&s!==null){if(typeof s!="object"||Object.keys(p).length!==Object.keys(s).length)return!1;for(const c in p)if(!k(p[c],s[c]))return!1;return!0}return p===s}var R=F;function F(p){return!function(s){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var m,x,v=new Blob([""],{type:"text/javascript"}),S=URL.createObjectURL(v);try{x=new Worker(S),m=!0}catch{m=!1}return x&&x.terminate(),URL.revokeObjectURL(S),m}()?function(){var m=document.createElement("canvas");m.width=m.height=1;var x=m.getContext("2d");if(!x)return!1;var v=x.getImageData(0,0,1,1);return v&&v.width===m.width}()?(B[c=s&&s.failIfMajorPerformanceCaveat]===void 0&&(B[c]=function(m){var x,v=function(S){var C=document.createElement("canvas"),I=Object.create(F.webGLContextAttributes);return I.failIfMajorPerformanceCaveat=S,C.getContext("webgl2",I)}(m);if(!v)return!1;try{x=v.createShader(v.VERTEX_SHADER)}catch{return!1}return!(!x||v.isContextLost())&&(v.shaderSource(x,"void main() {}"),v.compileShader(x),v.getShaderParameter(x,v.COMPILE_STATUS)===!0)}(c)),B[c]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var c}(p)}var B={};function V(p,s,c){const m=document.createElement(p);return s!=null&&(m.className=s),c&&c.appendChild(m),m}function G(p,s,c){const m=document.createElementNS("http://www.w3.org/2000/svg",p);for(const x of Object.keys(s))m.setAttributeNS(null,x,String(s[x]));return c&&c.appendChild(m),m}F.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const U=typeof document<"u"?document.documentElement&&document.documentElement.style:null,J=U&&U.userSelect!==void 0?"userSelect":"WebkitUserSelect";let X;function Y(){U&&J&&(X=U[J],U[J]="none")}function Z(){U&&J&&(U[J]=X)}function _e(p){p.preventDefault(),p.stopPropagation(),window.removeEventListener("click",_e,!0)}function ke(){window.addEventListener("click",_e,!0),window.setTimeout(()=>{window.removeEventListener("click",_e,!0)},0)}function Ae(p,s){const c=p.getBoundingClientRect();return we(p,c,s)}function me(p,s){const c=p.getBoundingClientRect(),m=[];for(let x=0;x<s.length;x++)m.push(we(p,c,s[x]));return m}function De(p){return window.InstallTrigger!==void 0&&p.button===2&&p.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:p.button}function we(p,s,c){const m=p.offsetWidth===s.width?1:p.offsetWidth/s.width;return new o.P((c.clientX-s.left)*m,(c.clientY-s.top)*m)}class Je{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(s,c){this._updatedSourceCaches[s]=c,this.setDirty()}discardSourceCacheUpdate(s){delete this._updatedSourceCaches[s]}updateLayer(s){const c=s.scope;this._updatedLayers[c]=this._updatedLayers[c]||new Set,this._updatedLayers[c].add(s.id),this.setDirty()}removeLayer(s){const c=s.scope;this._removedLayers[c]=this._removedLayers[c]||{},this._updatedLayers[c]=this._updatedLayers[c]||new Set,this._removedLayers[c][s.id]=s,this._updatedLayers[c].delete(s.id),this._updatedPaintProps.delete(s.fqid),this.setDirty()}getRemovedLayer(s){return this._removedLayers[s.scope]?this._removedLayers[s.scope][s.id]:null}discardLayerRemoval(s){this._removedLayers[s.scope]&&delete this._removedLayers[s.scope][s.id]}getLayerUpdatesByScope(){const s={};for(const c in this._updatedLayers)s[c]=s[c]||{},s[c].updatedIds=Array.from(this._updatedLayers[c].values());for(const c in this._removedLayers)s[c]=s[c]||{},s[c].removedIds=Object.keys(this._removedLayers[c]);return s}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(s){this._updatedPaintProps.add(s.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(s){this._updatedImages.add(s),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}class rt extends o.E{constructor(s){super(),this.requestManager=s,this.models={"":{}},this.numModelsLoading={}}loadModel(s,c){return o.l(this.requestManager.transformRequest(c,o.R.Model).url).then(m=>{if(!m)return;const x=o.c(m),v=new o.M(s,void 0,void 0,x);return v.computeBoundsAndApplyParent(),v}).catch(m=>{this.fire(new o.a(new Error(`Could not load model ${s} from ${c}: ${m.message}`)))})}load(s,c){this.models[c]||(this.models[c]={});const m=Object.keys(s);this.numModelsLoading[c]=(this.numModelsLoading[c]||0)+m.length;const x=[];for(const v of m)x.push(this.loadModel(v,s[v]));Promise.allSettled(x).then(v=>{for(let S=0;S<v.length;S++){const{status:C,value:I}=v[S];C==="fulfilled"&&I&&(this.models[c][m[S]]=I)}this.numModelsLoading[c]-=m.length,this.fire(new o.b("data",{dataType:"style"}))}).catch(v=>{this.fire(new o.a(new Error(`Could not load models: ${v.message}`)))})}isLoaded(){for(const s in this.numModelsLoading)if(this.numModelsLoading[s]>0)return!1;return!0}hasModel(s,c){return!!this.getModel(s,c)}getModel(s,c){return this.models[c]||(this.models[c]={}),this.models[c][s]}addModel(s,c,m){this.models[m]||(this.models[m]={}),this.hasModel(s,m)&&this.removeModel(s,m),this.load({[s]:this.requestManager.normalizeModelURL(c)},m)}addModels(s,c){const m={};for(const x in s)m[x]=this.requestManager.normalizeModelURL(s[x]);this.load(m,c)}removeModel(s,c){this.models[c]||(this.models[c]={});const m=this.models[c][s];delete this.models[c][s],m.destroy()}listModels(s){return this.models[s]||(this.models[s]={}),Object.keys(this.models[s])}upload(s,c){this.models[c]||(this.models[c]={});for(const m in this.models[c])this.models[c][m].upload(s.context)}}class Re{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(s,c,m){const x=String(c);if(this.stateChanges[s]=this.stateChanges[s]||{},this.stateChanges[s][x]=this.stateChanges[s][x]||{},o.e(this.stateChanges[s][x],m),this.deletedStates[s]===null){this.deletedStates[s]={};for(const v in this.state[s])v!==x&&(this.deletedStates[s][v]=null)}else if(this.deletedStates[s]&&this.deletedStates[s][x]===null){this.deletedStates[s][x]={};for(const v in this.state[s][x])m[v]||(this.deletedStates[s][x][v]=null)}else for(const v in m)this.deletedStates[s]&&this.deletedStates[s][x]&&this.deletedStates[s][x][v]===null&&delete this.deletedStates[s][x][v]}removeFeatureState(s,c,m){if(this.deletedStates[s]===null)return;const x=String(c);if(this.deletedStates[s]=this.deletedStates[s]||{},m&&c!==void 0)this.deletedStates[s][x]!==null&&(this.deletedStates[s][x]=this.deletedStates[s][x]||{},this.deletedStates[s][x][m]=null);else if(c!==void 0)if(this.stateChanges[s]&&this.stateChanges[s][x])for(m in this.deletedStates[s][x]={},this.stateChanges[s][x])this.deletedStates[s][x][m]=null;else this.deletedStates[s][x]=null;else this.deletedStates[s]=null}getState(s,c){const m=String(c),x=o.e({},(this.state[s]||{})[m],(this.stateChanges[s]||{})[m]);if(this.deletedStates[s]===null)return{};if(this.deletedStates[s]){const v=this.deletedStates[s][c];if(v===null)return{};for(const S in v)delete x[S]}return x}initializeTileState(s,c){s.setFeatureState(this.state,c)}coalesceChanges(s,c){const m={};for(const x in this.stateChanges){this.state[x]=this.state[x]||{};const v={};for(const S in this.stateChanges[x])this.state[x][S]||(this.state[x][S]={}),o.e(this.state[x][S],this.stateChanges[x][S]),v[S]=this.state[x][S];m[x]=v}for(const x in this.deletedStates){this.state[x]=this.state[x]||{};const v={};if(this.deletedStates[x]===null)for(const S in this.state[x])v[S]={},this.state[x][S]={};else for(const S in this.deletedStates[x]){if(this.deletedStates[x][S]===null)this.state[x][S]={};else if(this.state[x][S])for(const C of Object.keys(this.deletedStates[x][S]))delete this.state[x][S][C];v[S]=this.state[x][S]}m[x]=m[x]||{},o.e(m[x],v)}if(this.stateChanges={},this.deletedStates={},Object.keys(m).length!==0)for(const x in s)s[x].setFeatureState(m,c)}}function St(p){const{userImage:s}=p;return!!(s&&s.render&&s.render())&&(p.data.replace(new Uint8Array(s.data.buffer)),!0)}class Lt extends o.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(s){this.images[s]={},this.loaded[s]=!1,this.updatedImages[s]={},this.patterns[s]={},this.callbackDispatchedThisFrame[s]={},this.atlasImage[s]=new o.h({width:1,height:1})}isLoaded(){for(const s in this.loaded)if(!this.loaded[s])return!1;return!0}setLoaded(s,c){if(this.loaded[c]!==s&&(this.loaded[c]=s,s)){for(const{ids:m,callback:x}of this.requestors)this._notify(m,c,x);this.requestors=[]}}hasImage(s,c){return!!this.getImage(s,c)}getImage(s,c){return this.images[c][s]}addImage(s,c,m){this._validate(s,m)&&(this.images[c][s]=m)}_validate(s,c){let m=!0;return this._validateStretch(c.stretchX,c.data&&c.data.width)||(this.fire(new o.a(new Error(`Image "${s}" has invalid "stretchX" value`))),m=!1),this._validateStretch(c.stretchY,c.data&&c.data.height)||(this.fire(new o.a(new Error(`Image "${s}" has invalid "stretchY" value`))),m=!1),this._validateContent(c.content,c)||(this.fire(new o.a(new Error(`Image "${s}" has invalid "content" value`))),m=!1),m}_validateStretch(s,c){if(!s)return!0;let m=0;for(const x of s){if(x[0]<m||x[1]<x[0]||c<x[1])return!1;m=x[1]}return!0}_validateContent(s,c){return!(s&&(s.length!==4||s[0]<0||c.data.width<s[0]||s[1]<0||c.data.height<s[1]||s[2]<0||c.data.width<s[2]||s[3]<0||c.data.height<s[3]||s[2]<s[0]||s[3]<s[1]))}updateImage(s,c,m){m.version=this.images[c][s].version+1,this.images[c][s]=m,this.updatedImages[c][s]=!0}removeImage(s,c){const m=this.images[c][s];delete this.images[c][s],delete this.patterns[c][s],m.userImage&&m.userImage.onRemove&&m.userImage.onRemove()}listImages(s){return Object.keys(this.images[s])}getImages(s,c,m){let x=!0;const v=!!this.loaded[c];if(!v)for(const S of s)this.images[c][S]||(x=!1);v||x?this._notify(s,c,m):this.requestors.push({ids:s,scope:c,callback:m})}getUpdatedImages(s){return this.updatedImages[s]}_notify(s,c,m){const x={};for(const v of s){this.images[c][v]||this.fire(new o.b("styleimagemissing",{id:v}));const S=this.images[c][v];S?x[v]={data:S.data.clone(),pixelRatio:S.pixelRatio,sdf:S.sdf,version:S.version,stretchX:S.stretchX,stretchY:S.stretchY,content:S.content,hasRenderCallback:!!(S.userImage&&S.userImage.render)}:o.w(`Image "${v}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}m(null,x)}getPixelSize(s){const{width:c,height:m}=this.atlasImage[s];return{width:c,height:m}}getPattern(s,c){const m=this.patterns[c][s],x=this.getImage(s,c);if(!x)return null;if(m&&m.position.version===x.version)return m.position;if(m)m.position.version=x.version;else{const v={w:x.data.width+2,h:x.data.height+2,x:0,y:0},S=new o.I(v,x);this.patterns[c][s]={bin:v,position:S}}return this._updatePatternAtlas(c),this.patterns[c][s].position}bind(s,c){const m=s.gl;let x=this.atlasTexture[c];x?this.dirty&&(x.update(this.atlasImage[c]),this.dirty=!1):(x=new o.T(s,this.atlasImage[c],m.RGBA),this.atlasTexture[c]=x),x.bind(m.LINEAR,m.CLAMP_TO_EDGE)}_updatePatternAtlas(s){const c=[];for(const S in this.patterns[s])c.push(this.patterns[s][S].bin);const{w:m,h:x}=o.p(c),v=this.atlasImage[s];v.resize({width:m||1,height:x||1});for(const S in this.patterns[s]){const{bin:C}=this.patterns[s][S],I=C.x+1,D=C.y+1,L=this.images[s][S].data,N=L.width,H=L.height;o.h.copy(L,v,{x:0,y:0},{x:I,y:D},{width:N,height:H}),o.h.copy(L,v,{x:0,y:H-1},{x:I,y:D-1},{width:N,height:1}),o.h.copy(L,v,{x:0,y:0},{x:I,y:D+H},{width:N,height:1}),o.h.copy(L,v,{x:N-1,y:0},{x:I-1,y:D},{width:1,height:H}),o.h.copy(L,v,{x:0,y:0},{x:I+N,y:D},{width:1,height:H})}this.dirty=!0}beginFrame(){for(const s in this.images)this.callbackDispatchedThisFrame[s]={}}dispatchRenderCallbacks(s,c){for(const m of s){if(this.callbackDispatchedThisFrame[c][m])continue;this.callbackDispatchedThisFrame[c][m]=!0;const x=this.images[c][m];St(x)&&this.updateImage(m,c,x)}}}class We{constructor(s,c,m,x){this.message=(s?`${s}: `:"")+m,x&&(this.identifier=x),c!=null&&c.__line__&&(this.line=c.__line__)}}class qt extends We{}function Ot(p){const s=p.key,c=p.value,m=p.valueSpec||{},x=p.objectElementValidators||{},v=p.style,S=p.styleSpec;let C=[];const I=o.i(c);if(I!=="object")return[new We(s,c,`object expected, ${I} found`)];for(const D in c){const L=D.split(".")[0];let N;x[L]?N=x[L]:m[L]?N=wn:x["*"]?N=x["*"]:m["*"]&&(N=wn),N?C=C.concat(N({key:(s&&`${s}.`)+D,value:c[D],valueSpec:m[L]||m["*"],style:v,styleSpec:S,object:c,objectKey:D},c)):C.push(new qt(s,c[D],`unknown property "${D}"`))}for(const D in m)x[D]||m[D].required&&m[D].default===void 0&&c[D]===void 0&&C.push(new We(s,c,`missing required property "${D}"`));return C}function st(p){const s=p.value,c=p.valueSpec,m=p.style,x=p.styleSpec,v=p.key,S=p.arrayElementValidator||wn;if(o.i(s)!=="array")return[new We(v,s,`array expected, ${o.i(s)} found`)];if(c.length&&s.length!==c.length)return[new We(v,s,`array length ${c.length} expected, length ${s.length} found`)];if(c["min-length"]&&s.length<c["min-length"])return[new We(v,s,`array length at least ${c["min-length"]} expected, length ${s.length} found`)];let C={type:c.value,values:c.values,minimum:c.minimum,maximum:c.maximum,function:void 0};x.$version<7&&(C.function=c.function),o.i(c.value)==="object"&&(C=c.value);let I=[];for(let D=0;D<s.length;D++)I=I.concat(S({array:s,arrayIndex:D,value:s[D],valueSpec:C,style:m,styleSpec:x,key:`${v}[${D}]`},!0));return I}function Ve(p){const s=p.key,c=p.value,m=p.valueSpec;let x=o.i(c);if(x==="number"&&c!=c&&(x="NaN"),x!=="number")return[new We(s,c,`number expected, ${x} found`)];if("minimum"in m){let v=m.minimum;if(o.i(m.minimum)==="array"&&(v=m.minimum[p.arrayIndex]),c<v)return[new We(s,c,`${c} is less than the minimum value ${v}`)]}if("maximum"in m){let v=m.maximum;if(o.i(m.maximum)==="array"&&(v=m.maximum[p.arrayIndex]),c>v)return[new We(s,c,`${c} is greater than the maximum value ${v}`)]}return[]}function Et(p){const s=p.valueSpec,c=o.u(p.value.type);let m,x,v,S={};const C=c!=="categorical"&&p.value.property===void 0,I=!C,D=o.i(p.value.stops)==="array"&&o.i(p.value.stops[0])==="array"&&o.i(p.value.stops[0][0])==="object",L=Ot({key:p.key,value:p.value,valueSpec:p.styleSpec.function,style:p.style,styleSpec:p.styleSpec,objectElementValidators:{stops:function(W){if(c==="identity")return[new We(W.key,W.value,'identity function may not have a "stops" property')];let te=[];const ee=W.value;return te=te.concat(st({key:W.key,value:ee,valueSpec:W.valueSpec,style:W.style,styleSpec:W.styleSpec,arrayElementValidator:N})),o.i(ee)==="array"&&ee.length===0&&te.push(new We(W.key,ee,"array must have at least one stop")),te},default:function(W){return wn({key:W.key,value:W.value,valueSpec:s,style:W.style,styleSpec:W.styleSpec})}}});return c==="identity"&&C&&L.push(new We(p.key,p.value,'missing required property "property"')),c==="identity"||p.value.stops||L.push(new We(p.key,p.value,'missing required property "stops"')),c==="exponential"&&p.valueSpec.expression&&!o.s(p.valueSpec)&&L.push(new We(p.key,p.value,"exponential functions not supported")),p.styleSpec.$version>=8&&(I&&!o.k(p.valueSpec)?L.push(new We(p.key,p.value,"property functions not supported")):C&&!o.m(p.valueSpec)&&L.push(new We(p.key,p.value,"zoom functions not supported"))),c!=="categorical"&&!D||p.value.property!==void 0||L.push(new We(p.key,p.value,'"property" property is required')),L;function N(W){let te=[];const ee=W.value,ne=W.key;if(o.i(ee)!=="array")return[new We(ne,ee,`array expected, ${o.i(ee)} found`)];if(ee.length!==2)return[new We(ne,ee,`array length 2 expected, length ${ee.length} found`)];if(D){if(o.i(ee[0])!=="object")return[new We(ne,ee,`object expected, ${o.i(ee[0])} found`)];if(ee[0].zoom===void 0)return[new We(ne,ee,"object stop key must have zoom")];if(ee[0].value===void 0)return[new We(ne,ee,"object stop key must have value")];const K=o.u(ee[0].zoom);if(typeof K!="number")return[new We(ne,ee[0].zoom,"stop zoom values must be numbers")];if(v&&v>K)return[new We(ne,ee[0].zoom,"stop zoom values must appear in ascending order")];K!==v&&(v=K,x=void 0,S={}),te=te.concat(Ot({key:`${ne}[0]`,value:ee[0],valueSpec:{zoom:{}},style:W.style,styleSpec:W.styleSpec,objectElementValidators:{zoom:Ve,value:H}}))}else te=te.concat(H({key:`${ne}[0]`,value:ee[0],valueSpec:{},style:W.style,styleSpec:W.styleSpec},ee));return o.n(o.o(ee[1]))?te.concat([new We(`${ne}[1]`,ee[1],"expressions are not allowed in function stops.")]):te.concat(wn({key:`${ne}[1]`,value:ee[1],valueSpec:s,style:W.style,styleSpec:W.styleSpec}))}function H(W,te){const ee=o.i(W.value),ne=o.u(W.value),K=W.value!==null?W.value:te;if(m){if(ee!==m)return[new We(W.key,K,`${ee} stop domain type must match previous stop domain type ${m}`)]}else m=ee;if(ee!=="number"&&ee!=="string"&&ee!=="boolean"&&typeof ne!="number"&&typeof ne!="string"&&typeof ne!="boolean")return[new We(W.key,K,"stop domain value must be a number, string, or boolean")];if(ee!=="number"&&c!=="categorical"){let ae=`number expected, ${ee} found`;return o.k(s)&&c===void 0&&(ae+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new We(W.key,K,ae)]}return c!=="categorical"||ee!=="number"||typeof ne=="number"&&isFinite(ne)&&Math.floor(ne)===ne?c!=="categorical"&&ee==="number"&&typeof ne=="number"&&typeof x=="number"&&x!==void 0&&ne<x?[new We(W.key,K,"stop domain values must appear in ascending order")]:(x=ne,c==="categorical"&&ne in S?[new We(W.key,K,"stop domain values must be unique")]:(S[ne]=!0,[])):[new We(W.key,K,`integer expected, found ${String(ne)}`)]}}function Dt(p){const s=(p.expressionContext==="property"?o.q:o.r)(o.o(p.value),p.valueSpec);if(s.result==="error")return s.value.map(m=>new We(`${p.key}${m.key}`,p.value,m.message));const c=s.value.expression||s.value._styleExpression.expression;if(p.expressionContext==="property"&&p.propertyKey==="text-font"&&!c.outputDefined())return[new We(p.key,p.value,`Invalid data expression for "${p.propertyKey}". Output values must be contained as literals within the expression.`)];if(p.expressionContext==="property"&&p.propertyType==="layout"&&!o.t(c))return[new We(p.key,p.value,'"feature-state" data expressions are not supported with layout properties.')];if(p.expressionContext==="filter")return Se(c,p);if(p.expressionContext&&p.expressionContext.indexOf("cluster")===0){if(!o.v(c,["zoom","feature-state"]))return[new We(p.key,p.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(p.expressionContext==="cluster-initial"&&!o.x(c))return[new We(p.key,p.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Se(p,s){const c=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(s.valueSpec&&s.valueSpec.expression)for(const x of s.valueSpec.expression.parameters)c.delete(x);if(c.size===0)return[];const m=[];return p instanceof o.C&&c.has(p.name)?[new We(s.key,s.value,`["${p.name}"] expression is not supported in a filter for a ${s.object.type} layer with id: ${s.object.id}`)]:(p.eachChild(x=>{m.push(...Se(x,s))}),m)}function at(p){const s=p.key,c=p.value,m=p.valueSpec,x=[];return Array.isArray(m.values)?m.values.indexOf(o.u(c))===-1&&x.push(new We(s,c,`expected one of [${m.values.join(", ")}], ${JSON.stringify(c)} found`)):Object.keys(m.values).indexOf(o.u(c))===-1&&x.push(new We(s,c,`expected one of [${Object.keys(m.values).join(", ")}], ${JSON.stringify(c)} found`)),x}function He(p){return o.z(o.o(p.value))?Dt(o.j({},p,{expressionContext:"filter",valueSpec:p.styleSpec[`filter_${p.layerType||"fill"}`]})):Xe(p)}function Xe(p){const s=p.value,c=p.key;if(o.i(s)!=="array")return[new We(c,s,`array expected, ${o.i(s)} found`)];const m=p.styleSpec;let x,v=[];if(s.length<1)return[new We(c,s,"filter array must have at least 1 element")];switch(v=v.concat(at({key:`${c}[0]`,value:s[0],valueSpec:m.filter_operator,style:p.style,styleSpec:p.styleSpec})),o.u(s[0])){case"<":case"<=":case">":case">=":s.length>=2&&o.u(s[1])==="$type"&&v.push(new We(c,s,`"$type" cannot be use with operator "${s[0]}"`));case"==":case"!=":s.length!==3&&v.push(new We(c,s,`filter array for operator "${s[0]}" must have 3 elements`));case"in":case"!in":s.length>=2&&(x=o.i(s[1]),x!=="string"&&v.push(new We(`${c}[1]`,s[1],`string expected, ${x} found`)));for(let S=2;S<s.length;S++)x=o.i(s[S]),o.u(s[1])==="$type"?v=v.concat(at({key:`${c}[${S}]`,value:s[S],valueSpec:m.geometry_type,style:p.style,styleSpec:p.styleSpec})):x!=="string"&&x!=="number"&&x!=="boolean"&&v.push(new We(`${c}[${S}]`,s[S],`string, number, or boolean expected, ${x} found`));break;case"any":case"all":case"none":for(let S=1;S<s.length;S++)v=v.concat(Xe({key:`${c}[${S}]`,value:s[S],style:p.style,styleSpec:p.styleSpec}));break;case"has":case"!has":x=o.i(s[1]),s.length!==2?v.push(new We(c,s,`filter array for "${s[0]}" operator must have 2 elements`)):x!=="string"&&v.push(new We(`${c}[1]`,s[1],`string expected, ${x} found`))}return v}function yt(p,s){const c=p.key,m=p.style,x=p.layer,v=p.styleSpec,S=p.value,C=p.objectKey,I=v[`${s}_${p.layerType}`];if(!I)return[];const D=C.match(/^(.*)-transition$/);if(s==="paint"&&D&&I[D[1]]&&I[D[1]].transition)return wn({key:c,value:S,valueSpec:v.transition,style:m,styleSpec:v});const L=p.valueSpec||I[C];if(!L)return[new qt(c,S,`unknown property "${C}"`)];let N;if(o.i(S)==="string"&&o.k(L)&&!L.tokens&&(N=/^{([^}]+)}$/.exec(S))){const W=`\`{ "type": "identity", "property": ${N?JSON.stringify(N[1]):'"_"'} }\``;return[new We(c,S,`"${C}" does not support interpolation syntax
Use an identity property function instead: ${W}.`)]}const H=[];if(p.layerType==="symbol")C!=="text-field"||!m||m.glyphs||m.imports||H.push(new We(c,S,'use of "text-field" requires a style "glyphs" property')),C==="text-font"&&o.A(o.o(S))&&o.u(S.type)==="identity"&&H.push(new We(c,S,'"text-font" does not support identity functions'));else if(p.layerType==="model"&&s==="paint"&&x&&x.layout&&x.layout.hasOwnProperty("model-id")&&o.k(L)&&(o.B(L)||o.m(L))){const W=o.q(o.o(S),L),te=W.value.expression||W.value._styleExpression.expression;te&&!o.v(te,["measure-light"])&&(C==="model-emissive-strength"&&o.x(te)&&o.t(te)||H.push(new We(c,S,`${C} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return H.concat(wn({key:p.key,value:S,valueSpec:L,style:m,styleSpec:v,expressionContext:"property",propertyType:s,propertyKey:C}))}function Jt(p){return yt(p,"paint")}function sr(p){return yt(p,"layout")}function Xt(p){let s=[];const c=p.value,m=p.key,x=p.style,v=p.styleSpec;c.type||c.ref||s.push(new We(m,c,'either "type" or "ref" is required'));let S=o.u(c.type);const C=o.u(c.ref);if(c.id){const I=o.u(c.id);for(let D=0;D<p.arrayIndex;D++){const L=x.layers[D];o.u(L.id)===I&&s.push(new We(m,c.id,`duplicate layer id "${c.id}", previously used at line ${L.id.__line__}`))}}if("ref"in c){let I;["type","source","source-layer","filter","layout"].forEach(D=>{D in c&&s.push(new We(m,c[D],`"${D}" is prohibited for ref layers`))}),x.layers.forEach(D=>{o.u(D.id)===C&&(I=D)}),I?I.ref?s.push(new We(m,c.ref,"ref cannot reference another ref layer")):S=o.u(I.type):typeof C=="string"&&s.push(new We(m,c.ref,`ref layer "${C}" not found`))}else if(S!=="background"&&S!=="sky"&&S!=="slot")if(c.source){const I=x.sources&&x.sources[c.source],D=I&&o.u(I.type);I?D==="vector"&&S==="raster"?s.push(new We(m,c.source,`layer "${c.id}" requires a raster source`)):D==="raster"&&S!=="raster"?s.push(new We(m,c.source,`layer "${c.id}" requires a vector source`)):D!=="vector"||c["source-layer"]?D==="raster-dem"&&S!=="hillshade"?s.push(new We(m,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):D!=="raster-array"||["raster","raster-particle"].includes(S)?S!=="line"||!c.paint||!c.paint["line-gradient"]&&!c.paint["line-trim-offset"]||D==="geojson"&&I.lineMetrics?S==="raster-particle"&&D!=="raster-array"&&s.push(new We(m,c.source,`layer "${c.id}" requires a 'raster-array' source.`)):s.push(new We(m,c,`layer "${c.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):s.push(new We(m,c.source,"raster-array source can only be used with layer type 'raster'.")):s.push(new We(m,c,`layer "${c.id}" must specify a "source-layer"`)):s.push(new We(m,c.source,`source "${c.source}" not found`))}else s.push(new We(m,c,'missing required property "source"'));return s=s.concat(Ot({key:m,value:c,valueSpec:v.layer,style:p.style,styleSpec:p.styleSpec,objectElementValidators:{"*":()=>[],type:()=>wn({key:`${m}.type`,value:c.type,valueSpec:v.layer.type,style:p.style,styleSpec:p.styleSpec,object:c,objectKey:"type"}),filter:I=>He(o.j({layerType:S},I)),layout:I=>Ot({layer:c,key:I.key,value:I.value,valueSpec:{},style:I.style,styleSpec:I.styleSpec,objectElementValidators:{"*":D=>sr(o.j({layerType:S},D))}}),paint:I=>Ot({layer:c,key:I.key,value:I.value,valueSpec:{},style:I.style,styleSpec:I.styleSpec,objectElementValidators:{"*":D=>Jt(o.j({layerType:S,layer:c},D))}})}})),s}function zt(p){const s=p.value,c=p.key,m=o.i(s);return m!=="string"?[new We(c,s,`string expected, ${m} found`)]:[]}const Or={promoteId:function({key:p,value:s}){if(o.i(s)==="string")return zt({key:p,value:s});{const c=[];for(const m in s)c.push(...zt({key:`${p}.${m}`,value:s[m]}));return c}}};function Be(p){const s=p.value,c=p.key,m=p.styleSpec,x=p.style;if(!s.type)return[new We(c,s,'"type" is required')];const v=o.u(s.type);let S=[];switch(["vector","raster","raster-dem","raster-array"].includes(v)&&(s.url||s.tiles||S.push(new qt(c,s,'Either "url" or "tiles" is required.'))),v){case"vector":case"raster":case"raster-dem":case"raster-array":return S=S.concat(Ot({key:c,value:s,valueSpec:m[`source_${v.replace("-","_")}`],style:p.style,styleSpec:m,objectElementValidators:Or})),S;case"geojson":if(S=Ot({key:c,value:s,valueSpec:m.source_geojson,style:x,styleSpec:m,objectElementValidators:Or}),s.cluster)for(const C in s.clusterProperties){const[I,D]=s.clusterProperties[C],L=typeof I=="string"?[I,["accumulated"],["get",C]]:I;S.push(...Dt({key:`${c}.${C}.map`,value:D,expressionContext:"cluster-map"})),S.push(...Dt({key:`${c}.${C}.reduce`,value:L,expressionContext:"cluster-reduce"}))}return S;case"video":return Ot({key:c,value:s,valueSpec:m.source_video,style:x,styleSpec:m});case"image":return Ot({key:c,value:s,valueSpec:m.source_image,style:x,styleSpec:m});case"canvas":return[new We(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return at({key:`${c}.type`,value:s.type,valueSpec:{values:Fn(m)},style:x,styleSpec:m})}}function Fn(p){return p.source.reduce((s,c)=>{const m=p[c];return m.type.type==="enum"&&(s=s.concat(Object.keys(m.type.values))),s},[])}function Tr(p){const s=p.value;let c=[];if(!s)return c;const m=o.i(s);return m!=="string"?(c=c.concat([new We(p.key,s,`string expected, "${m}" found`)]),c):(function(x){const v=x.indexOf("://")===-1;try{return new URL(x,v?"http://example.com":void 0),!0}catch{return!1}}(s)||(c=c.concat([new We(p.key,s,`invalid url "${s}"`)])),c)}function Er(p){const s=p.value,c=p.styleSpec,m=c.light,x=p.style;let v=[];const S=o.i(s);if(s===void 0)return v;if(S!=="object")return v=v.concat([new We("light",s,`object expected, ${S} found`)]),v;for(const C in s){const I=C.match(/^(.*)-transition$/);v=v.concat(I&&m[I[1]]&&m[I[1]].transition?wn({key:C,value:s[C],valueSpec:c.transition,style:x,styleSpec:c}):m[C]?wn({key:C,value:s[C],valueSpec:m[C],style:x,styleSpec:c}):[new We(C,s[C],`unknown property "${C}"`)])}return v}function Ir(p){const s=p.value;let c=[];if(!s)return c;const m=o.i(s);if(m!=="object")return c=c.concat([new We("light-3d",s,`object expected, ${m} found`)]),c;const x=p.styleSpec,v=x["light-3d"],S=p.key,C=p.style,I=p.style.lights;for(const N of["type","id"])if(!(N in s))return c=c.concat([new We("light-3d",s,`missing property ${N} on light`)]),c;if(s.type&&I)for(let N=0;N<p.arrayIndex;N++){const H=o.u(s.type),W=I[N];o.u(W.type)===H&&c.push(new We(S,s.id,`duplicate light type "${s.type}", previously defined at line ${W.id.__line__}`))}const D=`properties_light_${s.type}`;if(!(D in x))return c=c.concat([new We("light-3d",s,`Invalid light type ${s.type}`)]),c;const L=x[D];for(const N in s)if(N==="properties"){const H=s[N],W=o.i(H);if(W!=="object")return c=c.concat([new We("properties",H,`object expected, ${W} found`)]),c;for(const te in H)c=c.concat(L[te]?wn({key:te,value:H[te],valueSpec:L[te],style:C,styleSpec:x}):[new qt(p.key,H[te],`unknown property "${te}"`)])}else{const H=N.match(/^(.*)-transition$/);c=c.concat(H&&v[H[1]]&&v[H[1]].transition?wn({key:N,value:s[N],valueSpec:x.transition,style:C,styleSpec:x}):v[N]?wn({key:N,value:s[N],valueSpec:v[N],style:C,styleSpec:x}):[new qt(N,s[N],`unknown property "${N}"`)])}return c}function nr(p){const s=p.value,c=p.key,m=p.style,x=p.styleSpec,v=x.terrain;let S=[];const C=o.i(s);if(s===void 0||C==="null")return S;if(C!=="object")return S=S.concat([new We("terrain",s,`object expected, ${C} found`)]),S;for(const I in s){const D=I.match(/^(.*)-transition$/);S=S.concat(D&&v[D[1]]&&v[D[1]].transition?wn({key:I,value:s[I],valueSpec:x.transition,style:m,styleSpec:x}):v[I]?wn({key:I,value:s[I],valueSpec:v[I],style:m,styleSpec:x}):[new qt(I,s[I],`unknown property "${I}"`)])}if(s.source){const I=m.sources&&m.sources[s.source],D=I&&o.u(I.type);I?D!=="raster-dem"&&S.push(new We(c,s.source,`terrain cannot be used with a source of type ${String(D)}, it only be used with a "raster-dem" source type`)):S.push(new We(c,s.source,`source "${s.source}" not found`))}else S.push(new We(c,s,'terrain is missing required property "source"'));return S}function En(p){const s=p.value,c=p.style,m=p.styleSpec,x=m.fog;let v=[];const S=o.i(s);if(s===void 0)return v;if(S!=="object")return v=v.concat([new We("fog",s,`object expected, ${S} found`)]),v;for(const C in s){const I=C.match(/^(.*)-transition$/);v=v.concat(I&&x[I[1]]&&x[I[1]].transition?wn({key:C,value:s[C],valueSpec:m.transition,style:c,styleSpec:m}):x[C]?wn({key:C,value:s[C],valueSpec:x[C],style:c,styleSpec:m}):[new qt(C,s[C],`unknown property "${C}"`)])}return v}const Xn={"*":()=>[],array:st,boolean:function(p){const s=p.value,c=p.key,m=o.i(s);return m!=="boolean"?[new We(c,s,`boolean expected, ${m} found`)]:[]},number:Ve,color:function(p){const s=p.key,c=p.value,m=o.i(c);return m!=="string"?[new We(s,c,`color expected, ${m} found`)]:o.y(c)===null?[new We(s,c,`color expected, "${c}" found`)]:[]},enum:at,filter:He,function:Et,layer:Xt,object:Ot,source:Be,model:Tr,light:Er,"light-3d":Ir,terrain:nr,fog:En,string:zt,formatted:function(p){return zt(p).length===0?[]:Dt(p)},resolvedImage:function(p){return zt(p).length===0?[]:Dt(p)},projection:function(p){const s=p.value,c=p.styleSpec,m=c.projection,x=p.style;let v=[];const S=o.i(s);if(S==="object")for(const C in s)v=v.concat(wn({key:C,value:s[C],valueSpec:m[C],style:x,styleSpec:c}));else S!=="string"&&(v=v.concat([new We("projection",s,`object or string expected, ${S} found`)]));return v},import:function(p){const{value:s,styleSpec:c}=p,{data:m,...x}=s;Object.defineProperty(x,"__line__",{value:s.__line__,enumerable:!1});let v=Ot(o.j({},p,{value:x,valueSpec:c.import}));return o.u(x.id)===""&&v.push(new We(`${p.key}.id`,x,"import id can't be an empty string")),m&&(v=v.concat(bi(m,c,{key:`${p.key}.data`}))),v}};function wn(p,s=!1){const c=p.value,m=p.valueSpec,x=p.styleSpec;if(m.expression&&o.A(o.u(c)))return Et(p);if(m.expression&&o.n(o.o(c)))return Dt(p);if(m.type&&Xn[m.type]){const v=Xn[m.type](p);return s===!0&&v.length>0&&o.i(p.value)==="array"?Dt(p):v}return Ot(o.j({},p,{valueSpec:m.type?x[m.type]:m}))}function ei(p){const s=p.value,c=p.key,m=zt(p);return m.length||(s.indexOf("{fontstack}")===-1&&m.push(new We(c,s,'"glyphs" url must include a "{fontstack}" token')),s.indexOf("{range}")===-1&&m.push(new We(c,s,'"glyphs" url must include a "{range}" token'))),m}function bi(p,s=o.D,c={}){return wn({key:c.key||"",value:p,valueSpec:s.$root,styleSpec:s,style:p,objectElementValidators:{glyphs:ei,"*":()=>[]}})}function Mn(p,s=o.D){return dt(bi(p,s))}const Nn=p=>dt(Be(p)),ti=p=>dt(Er(p)),gt=p=>dt(Ir(p)),le=p=>dt(nr(p)),Te=p=>dt(En(p)),Ne=p=>dt(Xt(p)),et=p=>dt(He(p)),ut=p=>dt(Jt(p)),_t=p=>dt(sr(p)),$t=p=>dt(Tr(p));function dt(p){return p.slice().sort((s,c)=>s.line&&c.line?s.line-c.line:0)}function kt(p,s){let c=!1;if(s&&s.length)for(const m of s)m instanceof qt?o.w(m.message):(p.fire(new o.a(new Error(m.message))),c=!0);return c}const Vt=new o.F({anchor:new o.G(o.D.light.anchor),position:new o.H(o.D.light.position),color:new o.G(o.D.light.color),intensity:new o.G(o.D.light.intensity)});class Wt extends o.E{constructor(s,c="flat"){super(),this._transitionable=new o.J(Vt),this.setLight(s,c),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(s,c,m={}){this._validate(ti,s,m)||(this._transitionable.setTransitionOrValue(s),this.id=c)}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,c,m){return(!m||m.validate!==!1)&&kt(this,s.call(Mn,o.e({value:c,style:{glyphs:!0,sprite:!0},styleSpec:o.D})))}}const br=new o.F({source:new o.G(o.D.terrain.source),exaggeration:new o.G(o.D.terrain.exaggeration)});let Hr=class extends o.E{constructor(p,s,c,m){super(),this.scope=c,this._transitionable=new o.J(br,c,m),this._transitionable.setTransitionOrValue(p,m),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=s}get(){return this._transitionable.serialize()}set(p,s){this._transitionable.setTransitionOrValue(p,s)}updateTransitions(p){this._transitioning=this._transitionable.transitioned(p,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(p){this.properties=this._transitioning.possiblyEvaluate(p)}getExaggeration(p){return this._transitioning.possiblyEvaluate(new o.K(p)).get("exaggeration")}isZoomDependent(){const p=this._transitionable._values.exaggeration;return p!=null&&p.value!=null&&p.value.expression!=null&&p.value.expression instanceof o.Z}};const Nr=45,tn=65,ln=.05;function Xr(p,s,c,m){const x=o.O(Nr,tn,c),[v,S]=dn(p,m);let C=1-Math.min(1,Math.exp((s-v)/(S-v)*-6));return C*=C*C,C=Math.min(1,1.00747*C),C*x*p.alpha}function dn(p,s){const c=.5/Math.tan(.5*s);return[p.range[0]+c,p.range[1]+c]}function kn(p,s,c,m,x){const v=o.N.transformMat4([],[s,c,m],x.mercatorFogMatrix);return Xr(p,o.N.length(v),x.pitch,x._fov)}function fi(p,s,c,m,x,v,S){const C=[[c,m,0],[x,m,0],[x,v,0],[c,v,0]];let I=Number.MAX_VALUE,D=-Number.MAX_VALUE;for(const L of C){const N=o.N.transformMat4([],L,s),H=o.N.length(N);I=Math.min(I,H),D=Math.max(D,H)}return[Xr(p,I,S.pitch,S._fov),Xr(p,D,S.pitch,S._fov)]}const In=new o.F({range:new o.G(o.D.fog.range),color:new o.G(o.D.fog.color),"high-color":new o.G(o.D.fog["high-color"]),"space-color":new o.G(o.D.fog["space-color"]),"horizon-blend":new o.G(o.D.fog["horizon-blend"]),"star-intensity":new o.G(o.D.fog["star-intensity"]),"vertical-range":new o.G(o.D.fog["vertical-range"])});class Li extends o.E{constructor(s,c,m,x){super(),this._transitionable=new o.J(In,m,new Map(x)),this.set(s,x),this._transitioning=this._transitionable.untransitioned(),this._transform=c,this.properties=new o.Q(In)}get state(){const s=this._transform,c=s.projection.name==="globe",m=o.S(s.zoom),x=this.properties.get("range"),v=[.5,3];return{range:c?[o.U(v[0],x[0],m),o.U(v[1],x[1],m)]:x,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(s,c,m={}){if(this._validate(Te,s,m))return;const x=o.e({},s);for(const v of Object.keys(o.D.fog))x[v]===void 0&&(x[v]=o.D.fog[v].default);this._options=x,this._transitionable.setTransitionOrValue(this._options,c)}getOpacity(s){if(!this._transform.projection.supportsFog)return 0;const c=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:o.O(Nr,tn,s))*c.a}getOpacityAtLatLng(s,c){return this._transform.projection.supportsFog?function(m,x,v){const S=o.L.fromLngLat(x),C=v.elevation?v.elevation.getAtPointOrZero(S):0;return kn(m,S.x,S.y,C,v)}(this.state,s,c):0}getOpacityForTile(s){if(!this._transform.projection.supportsFog)return[1,1];const c=this._transform.calculateFogTileMatrix(s.toUnwrapped());return fi(this.state,c,0,0,o.V,o.V,this._transform)}getOpacityForBounds(s,c,m,x,v){return this._transform.projection.supportsFog?fi(this.state,s,c,m,x,v,this._transform):[1,1]}getFovAdjustedRange(s){return this._transform.projection.supportsFog?dn(this.state,s):[0,1]}isVisibleOnFrustum(s){if(!this._transform.projection.supportsFog)return!1;const c=[4,5,6,7];for(const m of c){const x=s.points[m];let v;if(x[2]>=0)v=x;else{const S=s.points[m-4];v=o.W(S,x,S[2]/(S[2]-x[2]))}if(kn(this.state,v[0],v[1],0,this._transform)>=ln)return!0}return!1}updateConfig(s){this._transitionable.setTransitionOrValue(this._options,new Map(s))}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,c,m){return(!m||m.validate!==!1)&&kt(this,s.call(Mn,o.e({value:c,style:{glyphs:!0,sprite:!0},styleSpec:o.D})))}}class Mi extends o.E{constructor(s,c,m,x){super(),this.scope=m,this._options=s,this.properties=new o.Q(c),this._transitionable=new o.J(c,m,new Map(x)),this._transitionable.setTransitionOrValue(s.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(s){this._transitionable.setTransitionOrValue(this._options.properties,new Map(s))}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(s,c){this._options=s,this._transitionable.setTransitionOrValue(s.properties,c)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}const Xi=new o.F({color:new o.G(o.D.properties_light_ambient.color),intensity:new o.G(o.D.properties_light_ambient.intensity)}),Hn=new o.F({direction:new o.X(o.D.properties_light_directional.direction),color:new o.G(o.D.properties_light_directional.color),intensity:new o.G(o.D.properties_light_directional.intensity),"cast-shadows":new o.G(o.D.properties_light_directional["cast-shadows"]),"shadow-intensity":new o.G(o.D.properties_light_directional["shadow-intensity"])});class Wn{constructor(s,c,m,x){this.screenBounds=s,this.cameraPoint=c,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=m,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,x)}static createFromScreenPoints(s,c){let m,x;if(s instanceof o.P||typeof s[0]=="number"){const v=o.P.convert(s);m=[v],x=c.isPointAboveHorizon(v)}else{const v=o.P.convert(s[0]),S=o.P.convert(s[1]);m=[v,S],x=o.Y(v,S).every(C=>c.isPointAboveHorizon(C))}return new Wn(m,c.getCameraPoint(),x,c)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(s){return o.Y(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],s)}bufferedCameraGeometry(s){const c=this.screenBounds[0],m=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],x=o.Y(c,m,0,!1);return this.cameraPoint.y>m.y&&(this.cameraPoint.x>c.x&&this.cameraPoint.x<m.x?x.splice(3,0,this.cameraPoint):this.cameraPoint.x>=m.x?x[2]=this.cameraPoint:this.cameraPoint.x<=c.x&&(x[3]=this.cameraPoint)),o._(x,s)}bufferedCameraGeometryGlobe(s){const c=this.screenBounds[0],m=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],x=o.Y(c,m,s),v=this.cameraPoint.clone();switch(3*((v.y>c.y)+(v.y>m.y))+((v.x>c.x)+(v.x>m.x))){case 0:x[0]=v,x[4]=v.clone();break;case 1:x.splice(1,0,v);break;case 2:x[1]=v;break;case 3:x.splice(4,0,v);break;case 5:x.splice(2,0,v);break;case 6:x[3]=v;break;case 7:x.splice(3,0,v);break;case 8:x[2]=v}return x}containsTile(s,c,m,x=0){const v=s.queryPadding/c._pixelsPerMercatorPixel+1,S=m?this._bufferedCameraMercator(v,c):this._bufferedScreenMercator(v,c);let C=s.tileID.wrap+(S.unwrapped?x:0);const I=S.polygon.map(ne=>o.$(s.tileTransform,ne,C));if(!o.a0(I,0,0,o.V,o.V))return;C=s.tileID.wrap+(this.screenGeometryMercator.unwrapped?x:0);const D=this.screenGeometryMercator.polygon.map(ne=>o.a1(s.tileTransform,ne,C)),L=D.map(ne=>new o.P(ne[0],ne[1])),N=c.getFreeCameraOptions().position||new o.L(0,0,0),H=o.a1(s.tileTransform,N,C),W=D.map(ne=>{const K=o.N.sub(ne,ne,H);return o.N.normalize(K,K),new o.a2(H,K)}),te=o.a3(s,1,c.zoom)*c._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:L,tilespaceRays:W,bufferedTilespaceGeometry:I,bufferedTilespaceBounds:(ee=o.a4(I),ee.min.x=o.aa(ee.min.x,0,o.V),ee.min.y=o.aa(ee.min.y,0,o.V),ee.max.x=o.aa(ee.max.x,0,o.V),ee.max.y=o.aa(ee.max.y,0,o.V),ee),tile:s,tileID:s.tileID,pixelToTileUnitsFactor:te};var ee}_bufferedScreenMercator(s,c){const m=Ft(s);if(this._screenRaycastCache[m])return this._screenRaycastCache[m];{let x;return x=c.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(s),c):{polygon:this.bufferedScreenGeometry(s).map(v=>c.pointCoordinate3D(v)),unwrapped:!0},this._screenRaycastCache[m]=x,x}}_bufferedCameraMercator(s,c){const m=Ft(s);if(this._cameraRaycastCache[m])return this._cameraRaycastCache[m];{let x;return x=c.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(s),c):{polygon:this.bufferedCameraGeometry(s).map(v=>c.pointCoordinate3D(v)),unwrapped:!0},this._cameraRaycastCache[m]=x,x}}_projectAndResample(s,c){const m=function(v,S){const C=o.a6.multiply([],S.pixelMatrix,S.globeMatrix),I=[0,-o.ab,0,1],D=[0,o.ab,0,1],L=[0,0,0,1];o.a7.transformMat4(I,I,C),o.a7.transformMat4(D,D,C),o.a7.transformMat4(L,L,C);const N=new o.P(I[0]/I[3],I[1]/I[3]),H=new o.P(D[0]/D[3],D[1]/D[3]),W=o.a8(v,N)&&I[3]<L[3],te=o.a8(v,H)&&D[3]<L[3];if(!W&&!te)return null;const ee=function(ve,Pe,Fe){for(let $e=1;$e<ve.length;$e++){const nt=xt(Pe.pointCoordinate3D(ve[$e-1]).x),Ge=xt(Pe.pointCoordinate3D(ve[$e]).x);if(Fe<0){if(nt<Ge)return{idx:$e,t:-nt/(Ge-1-nt)}}else if(Ge<nt)return{idx:$e,t:(1-nt)/(Ge+1-nt)}}return null}(v,S,W?-1:1);if(!ee)return null;const{idx:ne,t:K}=ee;let ae=ne>1?pt(v.slice(0,ne),S):[],xe=ne<v.length?pt(v.slice(ne),S):[];ae=ae.map(ve=>new o.P(xt(ve.x),ve.y)),xe=xe.map(ve=>new o.P(xt(ve.x),ve.y));const ue=[...ae];ue.length===0&&ue.push(xe[xe.length-1]);const ye=o.U(ue[ue.length-1].y,(xe.length===0?ae[0]:xe[0]).y,K);let ie;return ie=W?[new o.P(0,ye),new o.P(0,0),new o.P(1,0),new o.P(1,ye)]:[new o.P(1,ye),new o.P(1,1),new o.P(0,1),new o.P(0,ye)],ue.push(...ie),xe.length===0?ue.push(ae[0]):ue.push(...xe),{polygon:ue.map(ve=>new o.L(ve.x,ve.y)),unwrapped:!1}}(s,c);if(m)return m;const x=function(v,S){let C=!1,I=-1/0,D=0;for(let N=0;N<v.length-1;N++)v[N].x>I&&(I=v[N].x,D=N);for(let N=0;N<v.length-1;N++){const H=(D+N)%(v.length-1),W=v[H],te=v[H+1];Math.abs(W.x-te.x)>.5&&(W.x<te.x?(W.x+=1,H===0&&(v[v.length-1].x+=1)):(te.x+=1,H+1===v.length-1&&(v[0].x+=1)),C=!0)}const L=o.a5(S.center.lng);return C&&L<Math.abs(L-1)&&v.forEach(N=>{N.x-=1}),{polygon:v,unwrapped:C}}(pt(s,c).map(v=>new o.P(xt(v.x),v.y)),c);return{polygon:x.polygon.map(v=>new o.L(v.x,v.y)),unwrapped:x.unwrapped}}}function pt(p,s){return o.a9(p,c=>{const m=s.pointCoordinate3D(c);c.x=m.x,c.y=m.y},1/256)}function xt(p){return p<0?1+p%1:p%1}function Ft(p){return 100*p|0}function re(p,s,c,m,x){const v=function(S,C){if(S)return x(S);if(C){p.url&&C.tiles&&p.tiles&&delete p.tiles;const I=o.ac(o.e(C,p),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);C.vector_layers&&(I.vectorLayers=C.vector_layers,I.vectorLayerIds=I.vectorLayers.map(D=>D.id)),C.raster_layers&&(I.rasterLayers=C.raster_layers,I.rasterLayerIds=I.rasterLayers.map(D=>D.id)),I.tiles=s.canonicalizeTileset(I,p.url),x(null,I)}};return p.url?o.g(s.transformRequest(s.normalizeSourceURL(p.url,null,c,m),o.R.Source),v):o.f.frame(()=>v(null,p))}class fe{constructor(s,c,m){this.bounds=o.ad.convert(this.validateBounds(s)),this.minzoom=c||0,this.maxzoom=m||24}validateBounds(s){return Array.isArray(s)&&s.length===4?[Math.max(-180,s[0]),Math.max(-90,s[1]),Math.min(180,s[2]),Math.min(90,s[3])]:[-180,-90,180,90]}contains(s){const c=Math.pow(2,s.z),m=Math.floor(o.a5(this.bounds.getWest())*c),x=Math.floor(o.ae(this.bounds.getNorth())*c),v=Math.ceil(o.a5(this.bounds.getEast())*c),S=Math.ceil(o.ae(this.bounds.getSouth())*c);return s.x>=m&&s.x<v&&s.y>=x&&s.y<S}}class se extends o.E{constructor(s,c,m,x){if(super(),this.id=s,this.dispatcher=m,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.e(this,o.ac(c,["url","scheme","tileSize","promoteId"])),this._options=o.e({type:"vector"},c),this._collectResourceTiming=!!c.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(x),this._tileWorkers={},this._deduped=new o.af}load(s){this._loaded=!1,this.fire(new o.b("dataloading",{dataType:"source"}));const c=Array.isArray(this.map._language)?this.map._language.join():this.map._language,m=this.map._worldview;this._tileJSONRequest=re(this._options,this.map._requestManager,c,m,(x,v)=>{this._tileJSONRequest=null,this._loaded=!0,x?(c&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${c}`),m&&m.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${m}`),this.fire(new o.a(x))):v&&(o.e(this,v),v.bounds&&(this.tileBounds=new fe(v.bounds,this.minzoom,this.maxzoom)),o.aj(v.tiles,this.map._requestManager._customAccessToken),this.fire(new o.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.b("data",{dataType:"source",sourceDataType:"content"}))),s&&s(x)})}loaded(){return this._loaded}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}onAdd(s){this.map=s,this.load()}reload(){this.cancelTileJSONRequest();const s=o.ag(this.id,this.scope);this.load(()=>this.map.style.clearSource(s))}setTiles(s){return this._options.tiles=s,this.reload(),this}setUrl(s){return this.url=s,this._options.url=s,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return o.e({},this._options)}loadTile(s,c){const m=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme)),x={request:this.map._requestManager.transformRequest(m,o.R.Tile),data:void 0,uid:s.uid,tileID:s.tileID,tileZoom:s.tileZoom,zoom:s.tileID.overscaledZ,tileSize:this.tileSize*s.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:o.f.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:s.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:s.isExtraShadowCaster};if(x.request.collectResourceTiming=this._collectResourceTiming,s.actor&&s.state!=="expired")s.state==="loading"?s.reloadCallback=c:s.request=s.actor.send("reloadTile",x,v.bind(this));else if(s.actor=this._tileWorkers[m]=this._tileWorkers[m]||this.dispatcher.getActor(),this.dispatcher.ready)s.request=s.actor.send("loadTile",x,v.bind(this),void 0,!0);else{const S=o.ah.call({deduped:this._deduped},x,(C,I)=>{C||!I?v.call(this,C):(x.data={cacheControl:I.cacheControl,expires:I.expires,rawData:I.rawData.slice(0)},s.actor&&s.actor.send("loadTile",x,v.bind(this),void 0,!0))},!0);s.request={cancel:S}}function v(S,C){return delete s.request,s.aborted?c(null):S&&S.status!==404?c(S):(C&&C.resourceTiming&&(s.resourceTiming=C.resourceTiming),this.map._refreshExpiredTiles&&C&&s.setExpiryData(C),s.loadVectorData(C,this.map.painter),o.ai(this.dispatcher),c(null),void(s.reloadCallback&&(this.loadTile(s,s.reloadCallback),s.reloadCallback=null)))}}abortTile(s){s.request&&(s.request.cancel(),delete s.request),s.actor&&s.actor.send("abortTile",{uid:s.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(s){s.actor&&s.actor.send("removeTile",{uid:s.uid,type:this.type,source:this.id,scope:this.scope}),s.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class he extends o.E{constructor(s,c,m,x){super(),this.id=s,this.dispatcher=m,this.setEventedParent(x),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.e({type:"raster"},c),o.e(this,o.ac(c,["url","scheme","tileSize"]))}load(s){this._loaded=!1,this.fire(new o.b("dataloading",{dataType:"source"})),this._tileJSONRequest=re(this._options,this.map._requestManager,null,null,(c,m)=>{this._tileJSONRequest=null,this._loaded=!0,c?this.fire(new o.a(c)):m&&(o.e(this,m),m.bounds&&(this.tileBounds=new fe(m.bounds,this.minzoom,this.maxzoom)),o.aj(m.tiles),this.fire(new o.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.b("data",{dataType:"source",sourceDataType:"content"}))),s&&s(c)})}loaded(){return this._loaded}onAdd(s){this.map=s,this.load()}reload(){this.cancelTileJSONRequest();const s=o.ag(this.id,this.scope);this.load(()=>this.map.style.clearSource(s))}setTiles(s){return this._options.tiles=s,this.reload(),this}setUrl(s){return this.url=s,this._options.url=s,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return o.e({},this._options)}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}loadTile(s,c){const m=o.f.devicePixelRatio>=2,x=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme),m,this.tileSize);s.request=o.d(this.map._requestManager.transformRequest(x,o.R.Tile),(v,S,C,I)=>(delete s.request,s.aborted?(s.state="unloaded",c(null)):v?(s.state="errored",c(v)):S?(this.map._refreshExpiredTiles&&s.setExpiryData({cacheControl:C,expires:I}),s.setTexture(S,this.map.painter),s.state="loaded",o.ai(this.dispatcher),void c(null)):c(null)))}abortTile(s,c){s.request&&(s.request.cancel(),delete s.request),c()}unloadTile(s,c){s.texture&&s.texture instanceof o.T?(s.destroy(!0),s.texture&&s.texture instanceof o.T&&this.map.painter.saveTileTexture(s.texture)):s.destroy(),c()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class ge extends he{constructor(s,c,m,x){super(s,c,m,x),this.type="raster-array",this.maxzoom=22,this._options=o.e({type:"raster-array"},c)}triggerRepaint(s){const c=this.map.painter._terrain,m=this.map.style.getSourceCache(this.id);c&&c.enabled&&m&&c._clearRenderCacheForTile(m.id,s.tileID),this.map.triggerRepaint()}loadTile(s,c){const m=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),x=this.map._requestManager.transformRequest(m,o.R.Tile);s.requestParams=x,s.actor||(s.actor=this.dispatcher.getActor()),s.request=s.fetchHeader(void 0,(v,S,C,I)=>{if(delete s.request,s.aborted)return s.state="unloaded",c(null);if(v)return v.code===20?void 0:(s.state="errored",c(v));this.map._refreshExpiredTiles&&s.setExpiryData({cacheControl:C,expires:I}),s.state="empty",c(null)})}unloadTile(s){const c=s.texture;c&&c instanceof o.T?(s.destroy(!0),this.map.painter.saveTileTexture(c)):(s.destroy(),s.flushQueues(),s._isHeaderLoaded=!1,delete s._mrt,delete s.textureDescriptor),s.fbo&&(s.fbo.destroy(),delete s.fbo),delete s.request,delete s.requestParams,delete s.neighboringTiles,s.state="unloaded"}prepareTile(s,c,m){s._isHeaderLoaded&&(s.state!=="empty"&&(s.state="reloading"),s.fetchBand(c,m,(x,v)=>{if(x)return s.state="errored",this.fire(new o.a(x)),void this.triggerRepaint(s);v&&(s.setTexture(v,this.map.painter),s.state="loaded",this.triggerRepaint(s))}))}getInitialBand(s){if(!this.rasterLayers)return 0;const c=this.rasterLayers.find(({id:v})=>v===s),m=c&&c.fields,x=m&&m.bands&&m.bands;return x?x[0]:0}getTextureDescriptor(s,c,m){if(!s)return;const x=c.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!x)return;let v=null;c instanceof o.an?v=c.paint.get("raster-array-band"):c instanceof o.ao&&(v=c.paint.get("raster-particle-array-band"));const S=v||this.getInitialBand(x);if(S!=null)if(s.textureDescriptor){if(!s.updateNeeded(x,S)||m)return Object.assign({},s.textureDescriptor,{texture:s.texture})}else this.prepareTile(s,x,S)}}const be=32,ze=33,ce=new Uint16Array(8184);for(let p=0;p<2046;p++){let s=p+2,c=0,m=0,x=0,v=0,S=0,C=0;for(1&s?x=v=S=be:c=m=C=be;(s>>=1)>1;){const D=c+x>>1,L=m+v>>1;1&s?(x=c,v=m,c=S,m=C):(c=x,m=v,x=S,v=C),S=D,C=L}const I=4*p;ce[I+0]=c,ce[I+1]=m,ce[I+2]=x,ce[I+3]=v}const Oe=new Uint16Array(2178),Me=new Uint8Array(1089),Ke=new Uint16Array(1089);function At(p){return p===0?-.03125:p===32?.03125:0}class Rt{constructor(s,c,m,x){this.id=Rt.uniqueIdxCounter,Rt.uniqueIdxCounter++,this.context=s;const v=s.gl;this.buffer=v.createBuffer(),this.dynamicDraw=!!m,this.context.unbindVAO(),s.bindElementBuffer.set(this.buffer),v.bufferData(v.ELEMENT_ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||x||c.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(s){this.id=Rt.uniqueIdxCounter,Rt.uniqueIdxCounter++;const c=this.context.gl;this.context.unbindVAO(),this.bind(),c.bufferSubData(c.ELEMENT_ARRAY_BUFFER,0,s.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Rt.uniqueIdxCounter=0;const er={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ht{constructor(s,c,m,x,v,S){this.length=c.length,this.attributes=m,this.itemSize=c.bytesPerElement,this.dynamicDraw=x,this.instanceCount=S,this.context=s;const C=s.gl;this.buffer=C.createBuffer(),s.bindVertexBuffer.set(this.buffer),C.bufferData(C.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?C.DYNAMIC_DRAW:C.STATIC_DRAW),this.dynamicDraw||v||c.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(s){const c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,s.arrayBuffer)}enableAttributes(s,c){for(let m=0;m<this.attributes.length;m++){const x=c.attributes[this.attributes[m].name];x!==void 0&&s.enableVertexAttribArray(x)}}setVertexAttribPointers(s,c,m){for(let x=0;x<this.attributes.length;x++){const v=this.attributes[x],S=c.attributes[v.name];S!==void 0&&s.vertexAttribPointer(S,v.components,s[er[v.type]],!1,this.itemSize,v.offset+this.itemSize*(m||0))}}setVertexAttribDivisor(s,c,m){for(let x=0;x<this.attributes.length;x++){const v=c.attributes[this.attributes[x].name];v!==void 0&&this.instanceCount&&this.instanceCount>0&&s.vertexAttribDivisor(v,m)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Nt{constructor(s){this.gl=s.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(s){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class yr extends Nt{getDefault(){return o.ax.transparent}set(s){const c=this.current;(s.r!==c.r||s.g!==c.g||s.b!==c.b||s.a!==c.a||this.dirty)&&(this.gl.clearColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class An extends Nt{getDefault(){return 1}set(s){(s!==this.current||this.dirty)&&(this.gl.clearDepth(s),this.current=s,this.dirty=!1)}}class cn extends Nt{getDefault(){return 0}set(s){(s!==this.current||this.dirty)&&(this.gl.clearStencil(s),this.current=s,this.dirty=!1)}}class Ti extends Nt{getDefault(){return[!0,!0,!0,!0]}set(s){const c=this.current;(s[0]!==c[0]||s[1]!==c[1]||s[2]!==c[2]||s[3]!==c[3]||this.dirty)&&(this.gl.colorMask(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class Ma extends Nt{getDefault(){return!0}set(s){(s!==this.current||this.dirty)&&(this.gl.depthMask(s),this.current=s,this.dirty=!1)}}class cs extends Nt{getDefault(){return 255}set(s){(s!==this.current||this.dirty)&&(this.gl.stencilMask(s),this.current=s,this.dirty=!1)}}class yo extends Nt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(s){const c=this.current;(s.func!==c.func||s.ref!==c.ref||s.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(s.func,s.ref,s.mask),this.current=s,this.dirty=!1)}}class xa extends Nt{getDefault(){const s=this.gl;return[s.KEEP,s.KEEP,s.KEEP]}set(s){const c=this.current;(s[0]!==c[0]||s[1]!==c[1]||s[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(s[0],s[1],s[2]),this.current=s,this.dirty=!1)}}class Nl extends Nt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;s?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=s,this.dirty=!1}}class ha extends Nt{getDefault(){return[0,1]}set(s){const c=this.current;(s[0]!==c[0]||s[1]!==c[1]||this.dirty)&&(this.gl.depthRange(s[0],s[1]),this.current=s,this.dirty=!1)}}class a_ extends Nt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;s?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=s,this.dirty=!1}}class vf extends Nt{getDefault(){return this.gl.LESS}set(s){(s!==this.current||this.dirty)&&(this.gl.depthFunc(s),this.current=s,this.dirty=!1)}}class Tp extends Nt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;s?c.enable(c.BLEND):c.disable(c.BLEND),this.current=s,this.dirty=!1}}class wf extends Nt{getDefault(){const s=this.gl;return[s.ONE,s.ZERO,s.ONE,s.ZERO]}set(s){const c=this.current;(s[0]!==c[0]||s[1]!==c[1]||s[2]!==c[2]||s[3]!==c[3]||this.dirty)&&(this.gl.blendFuncSeparate(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class Ep extends Nt{getDefault(){return o.ax.transparent}set(s){const c=this.current;(s.r!==c.r||s.g!==c.g||s.b!==c.b||s.a!==c.a||this.dirty)&&(this.gl.blendColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class Ia extends Nt{getDefault(){return this.gl.FUNC_ADD}set(s){(s!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(s,s),this.current=s,this.dirty=!1)}}class _i extends Nt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;s?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=s,this.dirty=!1}}class Kr extends Nt{getDefault(){return this.gl.BACK}set(s){(s!==this.current||this.dirty)&&(this.gl.cullFace(s),this.current=s,this.dirty=!1)}}class s_ extends Nt{getDefault(){return this.gl.CCW}set(s){(s!==this.current||this.dirty)&&(this.gl.frontFace(s),this.current=s,this.dirty=!1)}}let bf=class extends Nt{getDefault(){return null}set(p){(p!==this.current||this.dirty)&&(this.gl.useProgram(p),this.current=p,this.dirty=!1)}};class Sp extends Nt{getDefault(){return this.gl.TEXTURE0}set(s){(s!==this.current||this.dirty)&&(this.gl.activeTexture(s),this.current=s,this.dirty=!1)}}class xv extends Nt{getDefault(){const s=this.gl;return[0,0,s.drawingBufferWidth,s.drawingBufferHeight]}set(s){const c=this.current;(s[0]!==c[0]||s[1]!==c[1]||s[2]!==c[2]||s[3]!==c[3]||this.dirty)&&(this.gl.viewport(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class Ks extends Nt{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,s),this.current=s,this.dirty=!1}}class Ap extends Nt{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class yv extends Nt{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.bindTexture(c.TEXTURE_2D,s),this.current=s,this.dirty=!1}}class Cc extends Nt{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class tr extends Nt{getDefault(){return null}set(s){const c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class gn extends Nt{getDefault(){return null}set(s){this.gl&&(s!==this.current||this.dirty)&&(this.gl.bindVertexArray(s),this.current=s,this.dirty=!1)}}class _n extends Nt{getDefault(){return 4}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,s),this.current=s,this.dirty=!1}}class us extends Nt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),this.current=s,this.dirty=!1}}class kc extends Nt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,s),this.current=s,this.dirty=!1}}class nn extends Nt{constructor(s,c){super(s),this.context=s,this.parent=c}getDefault(){return null}}class Tf extends nn{setDirty(){this.dirty=!0}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class Mc extends nn{attachment(){return this.gl.DEPTH_ATTACHMENT}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,this.attachment(),c.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class Wu extends nn{attachment(){return this.gl.DEPTH_ATTACHMENT}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,this.attachment(),c.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class Pa extends Mc{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class pi{constructor(s,c,m,x,v){this.context=s,this.width=c,this.height=m;const S=this.framebuffer=s.gl.createFramebuffer();x&&(this.colorAttachment=new Tf(s,S)),v&&(this.depthAttachmentType=v,this.depthAttachment=v==="renderbuffer"?new Mc(s,S):new Wu(s,S))}destroy(){const s=this.context.gl;if(this.colorAttachment){const c=this.colorAttachment.get();c&&s.deleteTexture(c)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const c=this.depthAttachment.get();c&&s.deleteRenderbuffer(c)}else{const c=this.depthAttachment.get();c&&s.deleteTexture(c)}s.deleteFramebuffer(this.framebuffer)}}class _r{constructor(s,c,m){this.func=s,this.mask=c,this.range=m}}_r.ReadOnly=!1,_r.ReadWrite=!0,_r.disabled=new _r(519,_r.ReadOnly,[0,1]);const zl=7680;class Cr{constructor(s,c,m,x,v,S){this.test=s,this.ref=c,this.mask=m,this.fail=x,this.depthFail=v,this.pass=S}}Cr.disabled=new Cr({func:519,mask:0},0,0,zl,zl,zl);const Qo=771;class jr{constructor(s,c,m,x){this.blendFunction=s,this.blendColor=c,this.mask=m,this.blendEquation=x}}jr.Replace=[1,0,1,0],jr.disabled=new jr(jr.Replace,o.ax.transparent,[!1,!1,!1,!1]),jr.unblended=new jr(jr.Replace,o.ax.transparent,[!0,!0,!0,!0]),jr.alphaBlended=new jr([1,Qo,1,Qo],o.ax.transparent,[!0,!0,!0,!0]),jr.multiply=new jr([774,0,774,0],o.ax.transparent,[!0,!0,!0,!0]);const Ic=1029,Yi=2305;class xr{constructor(s,c,m){this.enable=s,this.mode=c,this.frontFace=m}}xr.disabled=new xr(!1,Ic,Yi),xr.backCCW=new xr(!0,Ic,Yi),xr.backCW=new xr(!0,Ic,2304),xr.frontCW=new xr(!0,1028,2304),xr.frontCCW=new xr(!0,1028,Yi);class o_{constructor(s,c){this.gl=s,this.clearColor=new yr(this),this.clearDepth=new An(this),this.clearStencil=new cn(this),this.colorMask=new Ti(this),this.depthMask=new Ma(this),this.stencilMask=new cs(this),this.stencilFunc=new yo(this),this.stencilOp=new xa(this),this.stencilTest=new Nl(this),this.depthRange=new ha(this),this.depthTest=new a_(this),this.depthFunc=new vf(this),this.blend=new Tp(this),this.blendFunc=new wf(this),this.blendColor=new Ep(this),this.blendEquation=new Ia(this),this.cullFace=new _i(this),this.cullFaceSide=new Kr(this),this.frontFace=new s_(this),this.program=new bf(this),this.activeTexture=new Sp(this),this.viewport=new xv(this),this.bindFramebuffer=new Ks(this),this.bindRenderbuffer=new Ap(this),this.bindTexture=new yv(this),this.bindVertexBuffer=new Cc(this),this.bindElementBuffer=new tr(this),this.bindVertexArrayOES=new gn(this),this.pixelStoreUnpack=new _n(this),this.pixelStoreUnpackPremultiplyAlpha=new us(this),this.pixelStoreUnpackFlipY=new kc(this),this.options=c?{...c}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=s.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=s.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=s.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=s.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=s.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=s.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=s.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE),this.maxPointSize=s.getParameter(s.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(s,c,m){return new Rt(this,s,c,m)}createVertexBuffer(s,c,m,x,v){return new Ht(this,s,c,m,x,v)}createRenderbuffer(s,c,m){const x=this.gl,v=x.createRenderbuffer();return this.bindRenderbuffer.set(v),x.renderbufferStorage(x.RENDERBUFFER,s,c,m),this.bindRenderbuffer.set(null),v}createFramebuffer(s,c,m,x){return new pi(this,s,c,m,x)}clear({color:s,depth:c,stencil:m,colorMask:x}){const v=this.gl;let S=0;s&&(S|=v.COLOR_BUFFER_BIT,this.clearColor.set(s),this.colorMask.set(x||[!0,!0,!0,!0])),c!==void 0&&(S|=v.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),m!==void 0&&(S|=v.STENCIL_BUFFER_BIT,this.clearStencil.set(m),this.stencilMask.set(255)),v.clear(S)}setCullFace(s){s.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(s.mode),this.frontFace.set(s.frontFace))}setDepthMode(s){s.func!==this.gl.ALWAYS||s.mask?(this.depthTest.set(!0),this.depthFunc.set(s.func),this.depthMask.set(s.mask),this.depthRange.set(s.range)):this.depthTest.set(!1)}setStencilMode(s){s.test.func!==this.gl.ALWAYS||s.mask?(this.stencilTest.set(!0),this.stencilMask.set(s.mask),this.stencilOp.set([s.fail,s.depthFail,s.pass]),this.stencilFunc.set({func:s.test.func,ref:s.ref,mask:s.test.mask})):this.stencilTest.set(!1)}setColorMode(s){k(s.blendFunction,jr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(s.blendFunction),this.blendColor.set(s.blendColor),s.blendEquation?this.blendEquation.set(s.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(s.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}var Bl=o.ay([{name:"a_pos",type:"Float32",components:3}]);class Ei{constructor(s,c,m,x){const v={width:m[0],height:m[1],data:null},S=s.gl;this.targetColorTexture=new o.T(s,v,S.RGBA,{useMipmap:!1}),this.backgroundColorTexture=new o.T(s,v,S.RGBA,{useMipmap:!1}),this.context=s,this.setNumParticles(c,x),this.lastInvalidatedAt=0}setNumParticles(s,c){if(this.numParticles===c)return;(this.particleVertices0||this.particleVertices1||this.particleSegment)&&(this.particleVertices0.destroy(),this.particleVertices1.destroy(),this.particleSegment.destroy());const m=new o.az;m.reserve(Math.round(c));const x=o.aA(s.key);for(let v=0;v<c;v++)m.emplaceBack(x(),x(),x());this.particleVertices0=this.context.createVertexBuffer(m,Bl.members,!0),this.particleVertices1=this.context.createVertexBuffer(m,Bl.members,!0),this.particleSegment=o.aB.simpleSegment(0,0,this.particleVertices0.length,0),this.numParticles=c}update(s){return!(this.lastInvalidatedAt<s&&(this.lastInvalidatedAt=o.f.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleVertices0.destroy(),this.particleVertices1.destroy(),this.particleSegment.destroy()}}const hs={type:2,extent:o.V,loadGeometry:()=>[[new o.P(0,0),new o.P(o.V+1,0),new o.P(o.V+1,o.V+1),new o.P(0,o.V+1),new o.P(0,0)]]};class el{constructor(s,c,m,x,v){this.tileID=s,this.uid=o.aC(),this.uses=0,this.tileSize=c,this.tileZoom=m,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=v,x&&x.style&&(this._lastUpdatedBrightness=x.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",x&&x.transform&&(this.projection=x.transform.projection)}registerFadeDuration(s){const c=s+this.timeAdded;c<o.f.now()||this.fadeEndTime&&c<this.fadeEndTime||(this.fadeEndTime=c)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=o.as(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(s,c,m){if(this.unloadVectorData(),this.state="loaded",s){s.featureIndex&&(this.latestFeatureIndex=s.featureIndex,s.rawTileData?(this.latestRawTileData=s.rawTileData,this.latestFeatureIndex.rawTileData=s.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=s.collisionBoxArray,this.buckets=function(x,v){const S={};if(!v)return S;for(const C of x){const I=C.layerIds.map(D=>v.getLayer(D)).filter(Boolean);if(I.length!==0){C.layers=I,C.stateDependentLayerIds&&(C.stateDependentLayers=C.stateDependentLayerIds.map(D=>I.filter(L=>L.id===D)[0]));for(const D of I)S[D.fqid]=C}}return S}(s.buckets,c.style),this.hasSymbolBuckets=!1;for(const x in this.buckets){const v=this.buckets[x];if(v instanceof o.aE){if(this.hasSymbolBuckets=!0,!m)break;v.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const x in this.buckets){const v=this.buckets[x];if(v instanceof o.aE&&v.hasRTLText){this.hasRTLText=!0,o.aF();break}}this.queryPadding=0;for(const x in this.buckets){const v=this.buckets[x],S=c.style.getOwnLayer(x);if(!S)continue;const C=S.queryRadius(v);this.queryPadding=Math.max(this.queryPadding,C)}s.imageAtlas&&(this.imageAtlas=s.imageAtlas),s.glyphAtlasImage&&(this.glyphAtlasImage=s.glyphAtlasImage),s.lineAtlas&&(this.lineAtlas=s.lineAtlas),this._lastUpdatedBrightness=s.brightness}else this.collisionBoxArray=new o.aD}unloadVectorData(){if(this.hasData()){for(const s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(s){return this.buckets[s.fqid]}upload(s){for(const x in this.buckets){const v=this.buckets[x];v.uploadPending()&&v.upload(s)}const c=s.gl,m=this.imageAtlas;if(m&&!m.uploaded){const x=!!Object.keys(m.patternPositions).length;this.imageAtlasTexture=new o.T(s,m.image,c.RGBA,{useMipmap:x}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new o.T(s,this.glyphAtlasImage,c.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new o.T(s,this.lineAtlas.image,c.R8),this.lineAtlas.uploaded=!0)}prepare(s,c,m){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(s,this.imageAtlasTexture,m),!c||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const x=c.style.getBrightness();(this._lastUpdatedBrightness||x)&&(this._lastUpdatedBrightness&&x&&Math.abs(this._lastUpdatedBrightness-x)<.001||(this._lastUpdatedBrightness=x,this.updateBuckets(void 0,c)))}queryRenderedFeatures(s,c,m,x,v,S,C,I){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:x,pixelPosMatrix:C,transform:S,params:v,tileTransform:this.tileTransform},s,c,m):{}}querySourceFeatures(s,c){const m=this.latestFeatureIndex;if(!m||!m.rawTileData)return;const x=m.loadVTLayers(),v=c?c.sourceLayer:"",S=x._geojsonTileLayer||x[v];if(!S)return;const C=o.aG(c&&c.filter),{z:I,x:D,y:L}=this.tileID.canonical,N={z:I,x:D,y:L};for(let H=0;H<S.length;H++){const W=S.feature(H);if(C.needGeometry){const ne=o.aH(W,!0);if(!C.filter(new o.K(this.tileID.overscaledZ),ne,this.tileID.canonical))continue}else if(!C.filter(new o.K(this.tileID.overscaledZ),W))continue;const te=m.getId(W,v),ee=new o.aI(W,I,D,L,te);ee.tile=N,s.push(ee)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}bucketsLoaded(){for(const s in this.buckets)if(this.buckets[s].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(s){const c=this.expirationTime;if(s.cacheControl){const m=o.aJ(s.cacheControl);m["max-age"]&&(this.expirationTime=Date.now()+1e3*m["max-age"])}else s.expires&&(this.expirationTime=new Date(s.expires).getTime());if(this.expirationTime){const m=Date.now();let x=!1;if(this.expirationTime>m)x=!1;else if(c)if(this.expirationTime<c)x=!0;else{const v=this.expirationTime-c;v?this.expirationTime=m+Math.max(v,3e4):x=!0}else x=!0;x?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(s,c){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(s).length!==0&&c&&this.updateBuckets(s,c)}updateBuckets(s,c){if(!this.latestFeatureIndex)return;const m=this.latestFeatureIndex.loadVTLayers(),x=c.style.listImages(),v=c.style.getBrightness();for(const S in this.buckets){if(!c.style.hasLayer(S))continue;const C=this.buckets[S],I=C.layers[0].sourceLayer||"_geojsonTileLayer",D=m[I];let L={};if(s&&(L=s[I],!D||!L||Object.keys(L).length===0))continue;if(C.update(L,D,x,this.imageAtlas&&this.imageAtlas.patternPositions||{},v),C instanceof o.aK||C instanceof o.aL){const H=c.style.getOwnSourceCache(C.layers[0].source);c._terrain&&c._terrain.enabled&&H&&C.programConfigurations.needsUpload&&c._terrain._clearRenderCacheForTile(H.id,this.tileID)}const N=c&&c.style&&c.style.getOwnLayer(S);N&&(this.queryPadding=Math.max(this.queryPadding,N.queryRadius(C)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<o.f.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(s){this.symbolFadeHoldUntil=o.f.now()+s}setTexture(s,c){const m=c.context,x=m.gl;this.texture=this.texture||c.getTileTexture(s.width),this.texture&&this.texture instanceof o.T?this.texture.update(s,{useMipmap:!0}):(this.texture=new o.T(m,s,x.RGBA,{useMipmap:!0}),this.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE))}setDependencies(s,c){const m={};for(const x of c)m[x]=!0;this.dependencies[s]=m}hasDependency(s,c){for(const m of s){const x=this.dependencies[m];if(x){for(const v of c)if(x[v])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(s,c){if(!c||c.name==="mercator"||this._tileDebugBuffer)return;const m=o.aM(hs,this.tileID.canonical,this.tileTransform)[0],x=new o.aN,v=new o.aO;for(let S=0;S<m.length;S++){const{x:C,y:I}=m[S];x.emplaceBack(C,I),v.emplaceBack(S)}v.emplaceBack(0),this._tileDebugIndexBuffer=s.createIndexBuffer(v),this._tileDebugBuffer=s.createVertexBuffer(x,o.aP.members),this._tileDebugSegments=o.aB.simpleSegment(0,0,x.length,v.length)}_makeTileBoundsBuffers(s,c){if(this._tileBoundsBuffer||!c||c.name==="mercator")return;const m=o.aM(hs,this.tileID.canonical,this.tileTransform)[0];let x,v;if(this.isRaster){const S=function(C,I){const D=o.as(C,I),L=Math.pow(2,C.z);for(let ne=0;ne<ze;ne++)for(let K=0;K<ze;K++){const ae=o.at((C.x+(K+At(K))/be)/L),xe=o.au((C.y+(ne+At(ne))/be)/L),ue=I.project(ae,xe),ye=ne*ze+K;Oe[2*ye+0]=Math.round((ue.x*D.scale-D.x)*o.V),Oe[2*ye+1]=Math.round((ue.y*D.scale-D.y)*o.V)}Me.fill(0),Ke.fill(0);for(let ne=2045;ne>=0;ne--){const K=4*ne,ae=ce[K+0],xe=ce[K+1],ue=ce[K+2],ye=ce[K+3],ie=ae+ue>>1,ve=xe+ye>>1,Pe=ie+ve-xe,Fe=ve+ae-ie,$e=xe*ze+ae,nt=ye*ze+ue,Ge=ve*ze+ie,ft=Math.hypot((Oe[2*$e+0]+Oe[2*nt+0])/2-Oe[2*Ge+0],(Oe[2*$e+1]+Oe[2*nt+1])/2-Oe[2*Ge+1])>=16;Me[Ge]=Me[Ge]||(ft?1:0),ne<1022&&(Me[Ge]=Me[Ge]||Me[(xe+Fe>>1)*ze+(ae+Pe>>1)]||Me[(ye+Fe>>1)*ze+(ue+Pe>>1)])}const N=new o.av,H=new o.aw;let W=0;function te(ne,K){const ae=K*ze+ne;return Ke[ae]===0&&(N.emplaceBack(Oe[2*ae+0],Oe[2*ae+1],ne*o.V/be,K*o.V/be),Ke[ae]=++W),Ke[ae]-1}function ee(ne,K,ae,xe,ue,ye){const ie=ne+ae>>1,ve=K+xe>>1;if(Math.abs(ne-ue)+Math.abs(K-ye)>1&&Me[ve*ze+ie])ee(ue,ye,ne,K,ie,ve),ee(ae,xe,ue,ye,ie,ve);else{const Pe=te(ne,K),Fe=te(ae,xe),$e=te(ue,ye);H.emplaceBack(Pe,Fe,$e)}}return ee(0,0,be,be,be,0),ee(be,be,0,0,0,be),{vertices:N,indices:H}}(this.tileID.canonical,c);x=S.vertices,v=S.indices}else{x=new o.av,v=new o.aw;for(const{x:C,y:I}of m)x.emplaceBack(C,I,0,0);const S=o.aQ(x.int16,void 0,4);for(let C=0;C<S.length;C+=3)v.emplaceBack(S[C],S[C+1],S[C+2])}this._tileBoundsBuffer=s.createVertexBuffer(x,o.aR.members),this._tileBoundsIndexBuffer=s.createIndexBuffer(v),this._tileBoundsSegments=o.aB.simpleSegment(0,0,x.length,v.length)}_makeGlobeTileDebugBuffers(s,c){const m=c.projection;if(!m||m.name!=="globe"||c.freezeTileCoverage)return;const x=this.tileID.canonical,v=o.aS(x,c),S=o.aT(v),C=o.S(c.zoom);let I;C>0&&(I=o.a6.invert(new Float64Array(16),c.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(s,x,c,S,I,C),this._makeGlobeTileDebugTextBuffer(s,x,c,S,I,C)}_globePoint(s,c,m,x,v,S,C){let I=o.aU(s,c,m);if(S){const D=1<<m.z,L=o.a5(x.center.lng),N=o.ae(x.center.lat),H=(m.x+.5)/D-L;let W=0;H>.5?W=-1:H<-.5&&(W=1);let te=(s/o.V+m.x)/D+W,ee=(c/o.V+m.y)/D;te=(te-L)*x._pixelsPerMercatorPixel+L,ee=(ee-N)*x._pixelsPerMercatorPixel+N;const ne=[te*x.worldSize,ee*x.worldSize,0];o.N.transformMat4(ne,ne,S),I=o.aV(I,ne,C)}return o.N.transformMat4(I,I,v)}_makeGlobeTileDebugBorderBuffer(s,c,m,x,v,S){const C=new o.aN,I=new o.aO,D=new o.aW,L=(H,W,te,ee,ne)=>{const K=(te-H)/(ne-1),ae=(ee-W)/(ne-1),xe=C.length;for(let ue=0;ue<ne;ue++){const ye=H+ue*K,ie=W+ue*ae;C.emplaceBack(ye,ie);const ve=this._globePoint(ye,ie,c,m,x,v,S);D.emplaceBack(ve[0],ve[1],ve[2]),I.emplaceBack(xe+ue)}},N=o.V;L(0,0,N,0,16),L(N,0,N,N,16),L(N,N,0,N,16),L(0,N,0,0,16),this._tileDebugIndexBuffer=s.createIndexBuffer(I),this._tileDebugBuffer=s.createVertexBuffer(C,o.aP.members),this._globeTileDebugBorderBuffer=s.createVertexBuffer(D,o.aX.members),this._tileDebugSegments=o.aB.simpleSegment(0,0,C.length,I.length)}_makeGlobeTileDebugTextBuffer(s,c,m,x,v,S){const C=o.V/4,I=new o.aN,D=new o.aw,L=new o.aW,N=25;D.reserve(32),I.reserve(N),L.reserve(N);const H=(W,te)=>N*W+te;for(let W=0;W<N;W++){const te=W*C;for(let ee=0;ee<N;ee++){const ne=ee*C;I.emplaceBack(ne,te);const K=this._globePoint(ne,te,c,m,x,v,S);L.emplaceBack(K[0],K[1],K[2])}}for(let W=0;W<4;W++)for(let te=0;te<4;te++){const ee=H(W,te),ne=H(W,te+1),K=H(W+1,te),ae=H(W+1,te+1);D.emplaceBack(ee,ne,K),D.emplaceBack(K,ne,ae)}this._tileDebugTextIndexBuffer=s.createIndexBuffer(D),this._tileDebugTextBuffer=s.createVertexBuffer(I,o.aP.members),this._globeTileDebugTextBuffer=s.createVertexBuffer(L,o.aX.members),this._tileDebugTextSegments=o.aB.simpleSegment(0,0,N,32)}destroy(s=!1){for(const c in this.buckets)this.buckets[c].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!s&&this.texture&&this.texture instanceof o.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}const vo={vector:se,raster:he,"raster-dem":class extends he{constructor(p,s,c,m){super(p,s,c,m),this.type="raster-dem",this.maxzoom=22,this._options=o.e({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox"}loadTile(p,s){const c=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function m(x,v){x&&(p.state="errored",s(x)),v&&(p.dem=v,p.dem.onDeserialize(),p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0,p.state="loaded",s(null))}p.request=o.d(this.map._requestManager.transformRequest(c,o.R.Tile),(function(x,v,S,C){if(delete p.request,p.aborted)p.state="unloaded",s(null);else if(x)p.state="errored",s(x);else if(v){this.map._refreshExpiredTiles&&p.setExpiryData({cacheControl:S,expires:C});const I=ImageBitmap&&v instanceof ImageBitmap&&o.ak(),D=1-(v.width-o.al(v.width))/2;D<1||p.neighboringTiles||(p.neighboringTiles=this._getNeighboringTiles(p.tileID));const L=I?v:o.f.getImageData(v,D),N={uid:p.uid,coord:p.tileID,source:this.id,scope:this.scope,rawImageData:L,encoding:this.encoding,padding:D};p.actor&&p.state!=="expired"||(p.actor=this.dispatcher.getActor(),p.actor.send("loadDEMTile",N,m.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(p){const s=p.canonical,c=Math.pow(2,s.z),m=(s.x-1+c)%c,x=s.x===0?p.wrap-1:p.wrap,v=(s.x+1+c)%c,S=s.x+1===c?p.wrap+1:p.wrap,C={};return C[new o.am(p.overscaledZ,x,s.z,m,s.y).key]={backfilled:!1},C[new o.am(p.overscaledZ,S,s.z,v,s.y).key]={backfilled:!1},s.y>0&&(C[new o.am(p.overscaledZ,x,s.z,m,s.y-1).key]={backfilled:!1},C[new o.am(p.overscaledZ,p.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},C[new o.am(p.overscaledZ,S,s.z,v,s.y-1).key]={backfilled:!1}),s.y+1<c&&(C[new o.am(p.overscaledZ,x,s.z,m,s.y+1).key]={backfilled:!1},C[new o.am(p.overscaledZ,p.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},C[new o.am(p.overscaledZ,S,s.z,v,s.y+1).key]={backfilled:!1}),C}},"raster-array":ge,geojson:class extends o.E{constructor(p,s,c,m){super(),this.id=p,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=c.getActor(),this.setEventedParent(m),this._data=s.data,this._options=o.e({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;const x=o.V/this.tileSize;this.workerOptions=o.e({source:this.id,scope:this.scope,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(s.buffer!==void 0?s.buffer:128)*x,tolerance:(s.tolerance!==void 0?s.tolerance:.375)*x,extent:o.V,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:s.clusterMaxZoom!==void 0?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:o.V,radius:(s.clusterRadius!==void 0?s.clusterRadius:50)*x,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter},s.workerOptions)}onAdd(p){this.map=p,this.setData(this._data)}setData(p){return this._data=p,this._updateWorkerData(),this}getClusterExpansionZoom(p,s){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:p,source:this.id,scope:this.scope},s),this}getClusterChildren(p,s){return this.actor.send("geojson.getClusterChildren",{clusterId:p,source:this.id,scope:this.scope},s),this}getClusterLeaves(p,s,c,m){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:p,limit:s,offset:c},m),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.b("dataloading",{dataType:"source"})),this._loaded=!1;const p=o.e({},this.workerOptions);p.scope=this.scope;const s=this._data;typeof s=="string"?(p.request=this.map._requestManager.transformRequest(o.f.resolveURL(s),o.R.Source),p.request.collectResourceTiming=this._collectResourceTiming):p.data=JSON.stringify(s),this._pendingLoad=this.actor.send(`${this.type}.loadData`,p,(c,m)=>{if(this._loaded=!0,this._pendingLoad=null,c)this.fire(new o.a(c));else{const x={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&m&&m.resourceTiming&&m.resourceTiming[this.id]&&(x.resourceTiming=m.resourceTiming[this.id]),this.fire(new o.b("data",x)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(p,s){const c=p.actor?"reloadTile":"loadTile";p.actor=this.actor;const m={type:this.type,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,scope:this.scope,pixelRatio:o.f.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0};p.request=this.actor.send(c,m,(x,v)=>(delete p.request,p.destroy(),p.aborted?s(null):x?s(x):(p.loadVectorData(v,this.map.painter,c==="reloadTile"),s(null))),void 0,c==="loadTile")}abortTile(p){p.request&&(p.request.cancel(),delete p.request),p.aborted=!0}unloadTile(p){this.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id,scope:this.scope}),p.destroy()}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return o.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends o.ap{constructor(p,s,c,m){super(p,s,c,m),this.roundZoom=!0,this.type="video",this.options=s}load(){this._loaded=!1;const p=this.options;this.urls=[];for(const s of p.urls)this.urls.push(this.map._requestManager.transformRequest(s,o.R.Source).url);o.aq(this.urls,(s,c)=>{this._loaded=!0,s?this.fire(new o.a(s)):c&&(this.video=c,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(p){if(this.video){const s=this.video.seekable;p<s.start(0)||p>s.end(0)?this.fire(new o.a(new We(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=p}}getVideo(){return this.video}onAdd(p){this.map||(this.map=p,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const p=this.map.painter.context,s=p.gl;this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new o.T(p,this.video,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(p)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:o.ap,model:class extends o.E{constructor(p,s,c,m){super(),this.id=p,this.type="model",this.models=[],this._loaded=!1,this._options=s}load(){const p=[];for(const s in this._options.models){const c=this._options.models[s],m=o.l(this.map._requestManager.transformRequest(c.uri,o.R.Model).url).then(x=>{if(!x)return;const v=o.c(x),S=new o.M(s,c.position,c.orientation,v);S.computeBoundsAndApplyParent(),this.models.push(S)}).catch(x=>{this.fire(new o.a(new Error(`Could not load model ${s} from ${c.uri}: ${x.message}`)))});p.push(m)}return Promise.allSettled(p).then(()=>{this._loaded=!0,this.fire(new o.b("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(s=>{this.fire(new o.a(new Error(`Could not load models: ${s.message}`)))})}onAdd(p){this.map=p,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(p,s){}serialize(){return{type:"model"}}},"batched-model":class extends o.E{constructor(p,s,c,m){super(),this.type="batched-model",this.id=p,this.tileSize=512,this._options=s,this.tiles=this._options.tiles,this.maxzoom=s.maxzoom||19,this.minzoom=s.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=c,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(m)}onAdd(p){this.map=p,this.load()}load(p){this._loaded=!1,this.fire(new o.b("dataloading",{dataType:"source"}));const s=Array.isArray(this.map._language)?this.map._language.join():this.map._language,c=this.map._worldview;this._tileJSONRequest=re(this._options,this.map._requestManager,s,c,(m,x)=>{this._tileJSONRequest=null,this._loaded=!0,m?(s&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${s}`),c&&c.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${c}`),this.fire(new o.a(m))):x&&(o.e(this,x),x.bounds&&(this.tileBounds=new fe(x.bounds,this.minzoom,this.maxzoom)),o.aj(x.tiles,this.map._requestManager._customAccessToken),this.fire(new o.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.b("data",{dataType:"source",sourceDataType:"content"}))),p&&p(m)})}hasTransition(){return!1}hasTile(p){return!this.tileBounds||this.tileBounds.contains(p.canonical)}loaded(){return this._loaded}loadTile(p,s){const c=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme)),m={request:this.map._requestManager.transformRequest(c,o.R.Tile),data:void 0,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,tileSize:this.tileSize*p.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:p.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(p.actor&&p.state!=="expired")if(p.state==="loading")p.reloadCallback=s;else{if(p.buckets){const v=Object.values(p.buckets);for(const S of v)S.dirty=!0;return void(p.state="loaded")}p.request=p.actor.send("reloadTile",m,x.bind(this))}else p.actor=this.dispatcher.getActor(),p.request=p.actor.send("loadTile",m,x.bind(this),void 0,!0);function x(v,S){return p.aborted?s(null):v&&v.status!==404?s(v):(S&&(S.resourceTiming&&(p.resourceTiming=S.resourceTiming),this.map._refreshExpiredTiles&&p.setExpiryData(S),p.buckets={...p.buckets,...S.buckets},S.featureIndex&&(p.latestFeatureIndex=S.featureIndex)),p.state="loaded",void s(null))}}serialize(){return o.e({},this._options)}},canvas:class extends o.ap{constructor(p,s,c,m){super(p,s,c,m),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some(x=>!Array.isArray(x)||x.length!==2||x.some(v=>typeof v!="number"))||this.fire(new o.a(new We(`sources.${p}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.a(new We(`sources.${p}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new o.a(new We(`sources.${p}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof HTMLCanvasElement||this.fire(new o.a(new We(`sources.${p}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.a(new We(`sources.${p}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.a(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(p){this.map=p,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let p=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,p=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,p=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const s=this.map.painter.context;this.texture?!p&&!this._playing||this.texture instanceof o.ar||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.T(s,this.canvas,s.gl.RGBA,{premultiply:!0}),this._prepareData(s)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const p of[this.canvas.width,this.canvas.height])if(isNaN(p)||p<=0)return!0;return!1}},custom:class extends o.E{constructor(p,s,c,m){super(),this.id=p,this.type="custom",this._dataType="raster",this._dispatcher=c,this._implementation=s,this.setEventedParent(m),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new o.a(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new o.a(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new fe(this._implementation.bounds,this.minzoom,this.maxzoom)),s.update=this._update.bind(this),s.clearTiles=this._clearTiles.bind(this),s.coveringTiles=this._coveringTiles.bind(this),o.e(this,o.ac(s,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return o.ac(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new o.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.b("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(p){this._map=p,this._loaded=!1,this.fire(new o.b("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(p),this.load()}onRemove(p){this._implementation.onRemove&&this._implementation.onRemove(p)}hasTile(p){if(this._implementation.hasTile){const{x:s,y:c,z:m}=p.canonical;return this._implementation.hasTile({x:s,y:c,z:m})}return!this.tileBounds||this.tileBounds.contains(p.canonical)}loadTile(p,s){const{x:c,y:m,z:x}=p.tileID.canonical,v=new AbortController;p.request=Promise.resolve(this._implementation.loadTile({x:c,y:m,z:x},{signal:v.signal})).then((function(S){return delete p.request,p.aborted?(p.state="unloaded",s(null)):S===void 0?(p.state="errored",s(null)):S===null?(this.loadTileData(p,{width:this.tileSize,height:this.tileSize,data:null}),p.state="loaded",s(null)):function(C){return C instanceof ImageData||C instanceof HTMLCanvasElement||C instanceof ImageBitmap||C instanceof HTMLImageElement}(S)?(this.loadTileData(p,S),p.state="loaded",void s(null)):(p.state="errored",s(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(S=>{S.code!==20&&(p.state="errored",s(S))}),p.request.cancel=()=>v.abort()}loadTileData(p,s){p.setTexture(s,this._map.painter)}unloadTile(p,s){if(p.texture&&p.texture instanceof o.T?(p.destroy(!0),p.texture&&p.texture instanceof o.T&&this._map.painter.saveTileTexture(p.texture)):p.destroy(),this._implementation.unloadTile){const{x:c,y:m,z:x}=p.tileID.canonical;this._implementation.unloadTile({x:c,y:m,z:x})}s()}abortTile(p,s){p.request&&p.request.cancel&&(p.request.cancel(),delete p.request),s()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(p=>({x:p.canonical.x,y:p.canonical.y,z:p.canonical.z}))}_clearTiles(){const p=o.ag(this.id,this.scope);this._map.style.clearSource(p)}_update(){this.fire(new o.b("data",{dataType:"source",sourceDataType:"content"}))}}},Si=function(p,s,c,m){const x=new vo[s.type](p,s,c,m);if(x.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${x.id}`);return o.aY(["load","abort","unload","serialize","prepare"],x),x};function Cp(p,s){const c=o.a6.identity([]);return o.a6.scale(c,c,[.5*p.width,.5*-p.height,1]),o.a6.translate(c,c,[1,-1,0]),o.a6.multiply(c,c,p.calculateProjMatrix(s.toUnwrapped())),Float32Array.from(c)}function kp(p,s,c,m,x,v,S,C=!1){const I=p.tilesIn(m,S,C);I.sort(Pc);const D=[];for(const N of I)D.push({wrappedTileID:N.tile.tileID.wrapped().key,queryResults:N.tile.queryRenderedFeatures(s,c,p._state,N,x,v,Cp(p.transform,N.tile.tileID),C)});const L=function(N){const H={},W={};for(const te of N){const ee=te.queryResults,ne=te.wrappedTileID,K=W[ne]=W[ne]||{};for(const ae in ee){const xe=ee[ae],ue=K[ae]=K[ae]||{},ye=H[ae]=H[ae]||[];for(const ie of xe)ue[ie.featureIndex]||(ue[ie.featureIndex]=!0,ye.push(ie))}}return H}(D);for(const N in L)L[N].forEach(H=>{const W=H.feature,te=W.layer;te&&te.type!=="background"&&te.type!=="sky"&&te.type!=="slot"&&(W.source=te.source,te["source-layer"]&&(W.sourceLayer=te["source-layer"]),W.state=W.id!==void 0?p.getFeatureState(te["source-layer"],W.id):{})});return L}function wo(p,s){const c=p.getRenderableIds().map(v=>p.getTileByID(v)),m=[],x={};for(let v=0;v<c.length;v++){const S=c[v],C=S.tileID.canonical.key;x[C]||(x[C]=!0,S.querySourceFeatures(m,s))}return m}function Pc(p,s){const c=p.tileID,m=s.tileID;return c.overscaledZ-m.overscaledZ||c.canonical.y-m.canonical.y||c.wrap-m.wrap||c.canonical.x-m.canonical.x}class Ul extends el{constructor(s,c,m,x,v){super(s,c,m,x,v),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(s,c){const m=c.context,x=m.gl;this.texture=this.texture||c.getTileTexture(s.width),this.texture&&this.texture instanceof o.T?this.texture.update(s,{useMipmap:!1,premultiply:!1}):this.texture=new o.T(m,s,x.RGBA,{useMipmap:!1,premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(s=16384,c){const m=this._mrt=new o.aZ(30),x=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(s-1)}});return this.entireBuffer=null,this.request=o.a_(x,(v,S,C,I)=>{if(v)c(v);else try{const D=m.getHeaderLength(S);if(D>s)return void(this.request=this.fetchHeader(D,c));m.parseHeader(S),this._isHeaderLoaded=!0;let L=0;for(const N of Object.values(m.layers))L=Math.max(L,N.dataIndex[N.dataIndex.length-1].last_byte);S.byteLength>=L&&(this.entireBuffer=S),c(null,this.entireBuffer||S,C,I)}catch(D){c(D)}}),this.request}fetchBand(s,c,m){const x=this._mrt;if(!this._isHeaderLoaded||!x)return void m(new Error("Tile header is not ready"));const v=this.actor;if(!v)return void m(new Error("Can't fetch tile band without an actor"));let S;const C=(N,H)=>{S.complete(N,H),N?m(N):(this.updateTextureDescriptor(s,c),m(null,this.textureDescriptor&&this.textureDescriptor.img))},I=(N,H)=>{if(N)return m(N);const W=v.send("decodeRasterArray",{buffer:H,task:S},C,void 0,!0);this._workQueue.push(()=>{W&&W.cancel(),S.cancel()})},D=x.getLayer(s);if(!D)return void m(new Error(`Unknown sourceLayer "${s}"`));if(D.hasDataForBand(c))return this.updateTextureDescriptor(s,c),void m(null,this.textureDescriptor?this.textureDescriptor.img:null);const L=D.getDataRange([c]);if(S=x.createDecodingTask(L),!S||S.tasks.length)if(this.flushQueues(),this.entireBuffer)I(null,this.entireBuffer.slice(L.firstByte,L.lastByte+1));else{const N=Object.assign({},this.requestParams,{headers:{Range:`bytes=${L.firstByte}-${L.lastByte}`}}),H=o.a_(N,I);this._fetchQueue.push(()=>{H.cancel(),S.cancel()})}else m(null)}updateNeeded(s,c){return(!this.textureDescriptor||this.textureDescriptor.band!==c||this.textureDescriptor.layer!==s)&&this.state!=="errored"}updateTextureDescriptor(s,c){if(!this._mrt)return;const m=this._mrt.getLayer(s);if(!m||!m.hasBand(c)||!m.hasDataForBand(c))return;const{bytes:x,tileSize:v,buffer:S,offset:C,scale:I}=m.getBandView(c),D=v+2*S,L={data:x,width:D,height:D},N=this.texture;N&&N instanceof o.T&&N.update(L,{useMipmap:!1,premultiply:!1}),this.textureDescriptor={layer:s,band:c,img:L,buffer:S,offset:C,tileSize:v,format:m.pixelFormat,mix:[I,256*I,65536*I,16777216*I]}}}class Rc{constructor(s,c){this.max=s,this.onRemove=c,this.reset()}reset(){for(const s in this.data)for(const c of this.data[s])c.timeout&&clearTimeout(c.timeout),this.onRemove(c.value);return this.data={},this.order=[],this}add(s,c,m){const x=s.wrapped().key;this.data[x]===void 0&&(this.data[x]=[]);const v={value:c,timeout:void 0};if(m!==void 0&&(v.timeout=setTimeout(()=>{this.remove(s,v)},m)),this.data[x].push(v),this.order.push(x),this.order.length>this.max){const S=this._getAndRemoveByKey(this.order[0]);S&&this.onRemove(S)}return this}has(s){return s.wrapped().key in this.data}getAndRemove(s){return this.has(s)?this._getAndRemoveByKey(s.wrapped().key):null}_getAndRemoveByKey(s){const c=this.data[s].shift();return c.timeout&&clearTimeout(c.timeout),this.data[s].length===0&&delete this.data[s],this.order.splice(this.order.indexOf(s),1),c.value}getByKey(s){const c=this.data[s];return c?c[0].value:null}get(s){return this.has(s)?this.data[s.wrapped().key][0].value:null}remove(s,c){if(!this.has(s))return this;const m=s.wrapped().key,x=c===void 0?0:this.data[m].indexOf(c),v=this.data[m][x];return this.data[m].splice(x,1),v.timeout&&clearTimeout(v.timeout),this.data[m].length===0&&delete this.data[m],this.onRemove(v.value),this.order.splice(this.order.indexOf(m),1),this}setMaxSize(s){for(this.max=s;this.order.length>this.max;){const c=this._getAndRemoveByKey(this.order[0]);c&&this.onRemove(c)}return this}filter(s){const c=[];for(const m in this.data)for(const x of this.data[m])s(x.value)||c.push(x);for(const m of c)this.remove(m.value.tileID,m)}}class Ss extends o.E{constructor(s,c,m){super(),this.id=s,this._onlySymbols=m,c.on("data",x=>{x.dataType==="source"&&x.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&x.dataType==="source"&&x.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),c.on("error",()=>{this._sourceErrored=!0}),this._source=c,this._tiles={},this._cache=new Rc(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=c.minTileCacheSize,this._maxTileCacheSize=c.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Re,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(s){this.map=s,this._minTileCacheSize=this._minTileCacheSize===void 0&&s?s._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&s?s._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const s in this._tiles){const c=this._tiles[s];if(c.state!=="errored"&&(c.state!=="loaded"||!c.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const s=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,s&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(s,c){return s.isSymbolTile=this._onlySymbols,s.isExtraShadowCaster=this._shadowCasterTiles[s.tileID.key],this._source.loadTile(s,c)}_unloadTile(s){if(this._source.unloadTile)return this._source.unloadTile(s,()=>{})}_abortTile(s){if(this._source.abortTile)return this._source.abortTile(s,()=>{})}serialize(){return this._source.serialize()}prepare(s){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const c in this._tiles){const m=this._tiles[c];m.upload(s),m.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return o.a$(this._tiles).map(s=>s.tileID).sort(Ef).map(s=>s.key)}getRenderableIds(s,c){const m=[];for(const x in this._tiles)this._isIdRenderable(+x,s,c)&&m.push(this._tiles[x]);return s?m.sort((x,v)=>{const S=x.tileID,C=v.tileID,I=new o.P(S.canonical.x,S.canonical.y)._rotate(this.transform.angle),D=new o.P(C.canonical.x,C.canonical.y)._rotate(this.transform.angle);return S.overscaledZ-C.overscaledZ||D.y-I.y||D.x-I.x}).map(x=>x.tileID.key):m.map(x=>x.tileID).sort(Ef).map(x=>x.key)}hasRenderableParent(s){const c=this.findLoadedParent(s,0);return!!c&&this._isIdRenderable(c.tileID.key)}_isIdRenderable(s,c,m){return this._tiles[s]&&this._tiles[s].hasData()&&!this._coveredTiles[s]&&(c||!this._tiles[s].holdingForFade())&&(m||!this._shadowCasterTiles[s])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const s in this._tiles)this._tiles[s].state!=="errored"&&this._reloadTile(+s,"reloading")}}_reloadTile(s,c){const m=this._tiles[s];m&&(m.state!=="loading"&&(m.state=c),this._loadTile(m,this._tileLoaded.bind(this,m,s,c)))}_tileLoaded(s,c,m,x){if(x)if(s.state="errored",x.status!==404)this._source.fire(new o.a(x,{tile:s}));else{if(!(s.tileID.key in this._loadedParentTiles))return void this._source.fire(new o.b("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const v=this.map.painter.terrain;this.update(this.transform,v.getScaledDemTileSize(),!0),v.resetTileLookupCache(this.id)}else this.update(this.transform)}else s.timeAdded=o.f.now(),m==="expired"&&(s.refreshedUponExpiration=!0),this._setTileReloadTimer(c,s),this._source.type==="raster-dem"&&s.dem&&this._backfillDEM(s),this._state.initializeTileState(s,this.map?this.map.painter:null),this._source.fire(new o.b("data",{dataType:"source",tile:s,coord:s.tileID,sourceCacheId:this.id}))}_backfillDEM(s){const c=this.getRenderableIds();for(let x=0;x<c.length;x++){const v=c[x];if(s.neighboringTiles&&s.neighboringTiles[v]){const S=this.getTileByID(v);m(s,S),m(S,s)}}function m(x,v){if(!x.dem||x.dem.borderReady)return;x.needsHillshadePrepare=!0,x.needsDEMTextureUpload=!0;let S=v.tileID.canonical.x-x.tileID.canonical.x;const C=v.tileID.canonical.y-x.tileID.canonical.y,I=Math.pow(2,x.tileID.canonical.z),D=v.tileID.key;S===0&&C===0||Math.abs(C)>1||(Math.abs(S)>1&&(Math.abs(S+I)===1?S+=I:Math.abs(S-I)===1&&(S-=I)),v.dem&&x.dem&&(x.dem.backfillBorder(v.dem,S,C),x.neighboringTiles&&x.neighboringTiles[D]&&(x.neighboringTiles[D].backfilled=!0)))}}getTile(s){return this.getTileByID(s.key)}getTileByID(s){return this._tiles[s]}_retainLoadedChildren(s,c,m,x){for(const v in this._tiles){let S=this._tiles[v];if(x[v]||!S.hasData()||S.tileID.overscaledZ<=c||S.tileID.overscaledZ>m)continue;let C=S.tileID;for(;S&&S.tileID.overscaledZ>c+1;){const D=S.tileID.scaledTo(S.tileID.overscaledZ-1);S=this._tiles[D.key],S&&S.hasData()&&(C=D)}let I=C;for(;I.overscaledZ>c;)if(I=I.scaledTo(I.overscaledZ-1),s[I.key]){x[C.key]=C;break}}}findLoadedParent(s,c){if(s.key in this._loadedParentTiles){const m=this._loadedParentTiles[s.key];return m&&m.tileID.overscaledZ>=c?m:null}for(let m=s.overscaledZ-1;m>=c;m--){const x=s.scaledTo(m),v=this._getLoadedTile(x);if(v)return v}}_getLoadedTile(s){const c=this._tiles[s.key];return c&&c.hasData()?c:this._cache.getByKey(this._source.reparseOverscaled?s.wrapped().key:s.canonical.key)}updateCacheSize(s,c){c=c||this._source.tileSize;const m=Math.ceil(s.width/c)+1,x=Math.ceil(s.height/c)+1,v=Math.floor(m*x*5),S=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,v):v,C=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,S):S;this._cache.setMaxSize(C)}handleWrapJump(s){const c=Math.round((s-(this._prevLng===void 0?s:this._prevLng))/360);if(this._prevLng=s,c){const m={};for(const x in this._tiles){const v=this._tiles[x];v.tileID=v.tileID.unwrapTo(v.tileID.wrap+c),m[v.tileID.key]=v}this._tiles=m;for(const x in this._timers)clearTimeout(this._timers[x]),delete this._timers[x];for(const x in this._tiles)this._setTileReloadTimer(+x,this._tiles[x])}}update(s,c,m,x){if(this.transform=s,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!m)return;let v;if(this.updateCacheSize(s,c),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain)if(this._source.tileID)v=s.getVisibleUnwrappedCoordinates(this._source.tileID).map(I=>new o.am(I.canonical.z,I.wrap,I.canonical.z,I.canonical.x,I.canonical.y));else if(this.tileCoverLift!==0){const I=s.clone();I.tileCoverLift=this.tileCoverLift,v=I.coveringTiles({tileSize:c||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!m,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.minzoom<=1&&s.projection.name==="globe"&&(v.push(new o.am(1,0,1,0,0)),v.push(new o.am(1,0,1,1,0)),v.push(new o.am(1,0,1,0,1)),v.push(new o.am(1,0,1,1,1)))}else v=s.coveringTiles({tileSize:c||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!m,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(v=v.filter(I=>this._source.hasTile(I)));else v=[];if(v.length>0&&this.castsShadows&&x&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!bo(this._source.type)){const I=s.coveringZoomLevel({tileSize:c||this._source.tileSize,roundZoom:this._source.roundZoom&&!m}),D=Math.min(I,this._source.maxzoom),L=s.extendTileCoverForShadows(v,x,D);for(const N of L)this._shadowCasterTiles[N.key]=!0,v.push(N)}const S=this._updateRetainedTiles(v);if(bo(this._source.type)&&v.length!==0){const I={},D={},L=Object.keys(S);for(const H of L){const W=S[H],te=this._tiles[H];if(!te||te.fadeEndTime&&te.fadeEndTime<=o.f.now())continue;const ee=this.findLoadedParent(W,Math.max(W.overscaledZ-Ss.maxOverzooming,this._source.minzoom));ee&&(this._addTile(ee.tileID),I[ee.tileID.key]=ee.tileID),D[H]=W}const N=v[v.length-1].overscaledZ;for(const H in this._tiles){const W=this._tiles[H];if(S[H]||!W.hasData())continue;let te=W.tileID;for(;te.overscaledZ>N;){te=te.scaledTo(te.overscaledZ-1);const ee=this._tiles[te.key];if(ee&&ee.hasData()&&D[te.key]){S[H]=W.tileID;break}}}for(const H in I)S[H]||(this._coveredTiles[H]=!0,S[H]=I[H])}for(const I in S)this._tiles[I].clearFadeHold();const C=o.b0(this._tiles,S);for(const I of C){const D=this._tiles[I];D.hasSymbolBuckets&&!D.holdingForFade()?D.setHoldDuration(this.map._fadeDuration):D.hasSymbolBuckets&&!D.symbolFadeFinished()||this._removeTile(+I)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const s in this._tiles)this._tiles[s].holdingForFade()&&this._removeTile(+s)}_updateRetainedTiles(s){const c={};if(s.length===0)return c;const m={},x=s.reduce((D,L)=>Math.min(D,L.overscaledZ),1/0),v=s[0].overscaledZ,S=Math.max(v-Ss.maxOverzooming,this._source.minzoom),C=Math.max(v+Ss.maxUnderzooming,this._source.minzoom),I={};for(const D of s){const L=this._addTile(D);c[D.key]=D,L.hasData()||x<this._source.maxzoom&&(I[D.key]=D)}this._retainLoadedChildren(I,x,C,c);for(const D of s){let L=this._tiles[D.key];if(L.hasData())continue;if(D.canonical.z>=this._source.maxzoom){const H=D.children(this._source.maxzoom)[0],W=this.getTile(H);if(W&&W.hasData()){c[H.key]=H;continue}}else{const H=D.children(this._source.maxzoom);if(c[H[0].key]&&c[H[1].key]&&c[H[2].key]&&c[H[3].key])continue}let N=L.wasRequested();for(let H=D.overscaledZ-1;H>=S;--H){const W=D.scaledTo(H);if(m[W.key]||(m[W.key]=!0,L=this.getTile(W),!L&&N&&(L=this._addTile(W)),L&&(c[W.key]=W,N=L.wasRequested(),L.hasData())))break}}return c}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const s in this._tiles){const c=[];let m,x=this._tiles[s].tileID;for(;x.overscaledZ>0;){if(x.key in this._loadedParentTiles){m=this._loadedParentTiles[x.key];break}c.push(x.key);const v=x.scaledTo(x.overscaledZ-1);if(m=this._getLoadedTile(v),m)break;x=v}for(const v of c)this._loadedParentTiles[v]=m}}_addTile(s){let c=this._tiles[s.key];if(c)return c.isExtraShadowCaster!==!0||this._shadowCasterTiles[s.key]||this._reloadTile(s.key,"reloading"),c;c=this._cache.getAndRemove(s),c&&(this._setTileReloadTimer(s.key,c),c.tileID=s,this._state.initializeTileState(c,this.map?this.map.painter:null),this._cacheTimers[s.key]&&(clearTimeout(this._cacheTimers[s.key]),delete this._cacheTimers[s.key],this._setTileReloadTimer(s.key,c)));const m=!!c;if(!m){const x=this.map?this.map.painter:null,v=this._source.tileSize*s.overscaleFactor();c=this._source.type==="raster-array"?new Ul(s,v,this.transform.tileZoom,x,this._isRaster):new el(s,v,this.transform.tileZoom,x,this._isRaster),this._loadTile(c,this._tileLoaded.bind(this,c,s.key,c.state))}return c?(c.uses++,this._tiles[s.key]=c,m||this._source.fire(new o.b("dataloading",{tile:c,coord:c.tileID,dataType:"source"})),c):null}_setTileReloadTimer(s,c){s in this._timers&&(clearTimeout(this._timers[s]),delete this._timers[s]);const m=c.getExpiryTimeout();m&&(this._timers[s]=setTimeout(()=>{this._reloadTile(s,"expired"),delete this._timers[s]},m))}_removeTile(s){const c=this._tiles[s];c&&(c.uses--,delete this._tiles[s],this._timers[s]&&(clearTimeout(this._timers[s]),delete this._timers[s]),c.uses>0||(c.hasData()&&c.state!=="reloading"||c.state==="empty"?this._cache.add(c.tileID,c,c.getExpiryTimeout()):(c.aborted=!0,this._abortTile(c),this._unloadTile(c))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const s in this._tiles)this._removeTile(+s);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(s,c,m){const x=[],v=this.transform;if(!v)return x;const S=v.projection.name==="globe",C=o.a5(v.center.lng);for(const I in this._tiles){const D=this._tiles[I];if(m&&D.clearQueryDebugViz(),D.holdingForFade())continue;let L;if(S){const N=D.tileID.canonical;if(N.z===0){const H=[Math.abs(o.aa(C,...qu(N,-1))-C),Math.abs(o.aa(C,...qu(N,1))-C)];L=[0,2*H.indexOf(Math.min(...H))-1]}else{const H=[Math.abs(o.aa(C,...qu(N,-1))-C),Math.abs(o.aa(C,...qu(N,0))-C),Math.abs(o.aa(C,...qu(N,1))-C)];L=[H.indexOf(Math.min(...H))-1]}}else L=[0];for(const N of L){const H=s.containsTile(D,v,c,N);H&&x.push(H)}}return x}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(s){return this._getRenderableCoordinates(s)}_getRenderableCoordinates(s,c){const m=this.getRenderableIds(s,c).map(v=>this._tiles[v].tileID),x=this.transform.projection.name==="globe";for(const v of m)v.projMatrix=this.transform.calculateProjMatrix(v.toUnwrapped()),v.expandedProjMatrix=x?this.transform.calculateProjMatrix(v.toUnwrapped(),!1,!0):v.projMatrix;return m}sortCoordinatesByDistance(s){const c=s.slice(),m=this.transform._camera.position,x=this.transform._camera.forward(),v={};for(const S of c){const C=1/(1<<S.canonical.z);v[S.key]=((S.canonical.x+.5)*C+S.wrap-m[0])*x[0]+((S.canonical.y+.5)*C-m[1])*x[1]-m[2]*x[2]}return c.sort((S,C)=>v[S.key]-v[C.key]),c}hasTransition(){if(this._source.hasTransition())return!0;if(bo(this._source.type))for(const s in this._tiles){const c=this._tiles[s];if(c.fadeEndTime!==void 0&&c.fadeEndTime>=o.f.now())return!0}return!1}setFeatureState(s,c,m){this._state.updateState(s=s||"_geojsonTileLayer",c,m)}removeFeatureState(s,c,m){this._state.removeFeatureState(s=s||"_geojsonTileLayer",c,m)}getFeatureState(s,c){return this._state.getState(s=s||"_geojsonTileLayer",c)}setDependencies(s,c,m){const x=this._tiles[s];x&&x.setDependencies(c,m)}reloadTilesForDependencies(s,c){for(const m in this._tiles)this._tiles[m].hasDependency(s,c)&&this._reloadTile(+m,"reloading");this._cache.filter(m=>!m.hasDependency(s,c))}_preloadTiles(s,c){if(!this._sourceLoaded){const I=()=>{this._sourceLoaded&&(this._source.off("data",I),this._preloadTiles(s,c))};return void this._source.on("data",I)}const m=new Map,x=Array.isArray(s)?s:[s],v=this.map.painter.terrain,S=this.usedForTerrain&&v?v.getScaledDemTileSize():this._source.tileSize;for(const I of x){const D=I.coveringTiles({tileSize:S,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const L of D)m.set(L.key,L);this.usedForTerrain&&I.updateElevation(!1)}const C=Array.from(m.values());o.b1(C,(I,D)=>{const L=new el(I,this._source.tileSize*I.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(L,N=>{this._source.type==="raster-dem"&&L.dem&&this._backfillDEM(L),D(N,L)})},c)}}function Ef(p,s){const c=Math.abs(2*p.wrap)-+(p.wrap<0),m=Math.abs(2*s.wrap)-+(s.wrap<0);return p.overscaledZ-s.overscaledZ||m-c||s.canonical.y-p.canonical.y||s.canonical.x-p.canonical.x}function bo(p){return p==="raster"||p==="image"||p==="video"||p==="custom"}function qu(p,s){const c=1<<p.z;return[p.x/c+s,(p.x+1)/c+s]}Ss.maxOverzooming=10,Ss.maxUnderzooming=3;class l_{constructor(s){this.style=s,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const s=!1,c=!1;for(const m in this.style._mergedLayers){const x=this.style._mergedLayers[m];if(x.type==="fill-extrusion")this.layers.push({layer:x,visible:s,visibilityChanged:c});else if(x.type==="model"){const v=this.style.getLayerSource(x);v&&v.type==="batched-model"&&this.layers.push({layer:x,visible:s,visibilityChanged:c})}}}onNewFrame(s){this.layersGotHidden=!1;for(const c of this.layers){const m=c.layer;let x=!1;m.type==="fill-extrusion"?x=!m.isHidden(s)&&m.paint.get("fill-extrusion-opacity")>0:m.type==="model"&&(x=!m.isHidden(s)&&m.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!x&&c.visible,c.visible=x}}updateZOffset(s,c){this.currentBuildingBuckets=[];for(const x of this.layers){const v=x.layer,S=this.style.getLayerSourceCache(v);let C=1;v.type==="fill-extrusion"&&(C=x.visible?v.paint.get("fill-extrusion-vertical-scale"):0);let I=S?S.getTile(c):null;if(!I&&S&&c.canonical.z>S.getSource().minzoom){let D=c.scaledTo(Math.min(S.getSource().maxzoom,c.overscaledZ-1));for(;D.overscaledZ>=S.getSource().minzoom&&(I=S.getTile(D),!I&&D.overscaledZ!==0);)D=D.scaledTo(D.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:I?I.getBucket(v):null,tileID:I?I.tileID:c,verticalScale:C})}s.hasAnyZOffset=!1;let m=!1;for(let x=0;x<s.symbolInstances.length;x++){const v=s.symbolInstances.get(x),S=v.zOffset,C=this._getHeightAtTileOffset(c,v.tileAnchorX,v.tileAnchorY);v.zOffset=C!==Number.NEGATIVE_INFINITY?C:S,m||S===v.zOffset||(m=!0),s.hasAnyZOffset||v.zOffset===0||(s.hasAnyZOffset=!0)}m&&(s.zOffsetBuffersNeedUpload=!0,s.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(s,c,m,x){let v=c,S=m;if(s.canonical.z!==x.canonical.z){const C=x.canonical,I=1/(1<<s.canonical.z-C.z);v=(c+s.canonical.x*o.V)*I-C.x*o.V|0,S=(m+s.canonical.y*o.V)*I-C.y*o.V|0}return{tileX:v,tileY:S}}_getHeightAtTileOffset(s,c,m){let x,v;for(let S=0;S<this.layers.length;++S){if(this.layers[S].layer.type!=="fill-extrusion")continue;const{bucket:C,tileID:I,verticalScale:D}=this.currentBuildingBuckets[S];if(!C)continue;const{tileX:L,tileY:N}=this._mapCoordToOverlappingTile(s,c,m,I),H=C.getHeightAtTileCoord(L,N);H&&H.height!==void 0&&(H.hidden?x=H.height:v=Math.max(H.height*D,v||0))}if(v!==void 0)return v;for(let S=0;S<this.layers.length;++S){const C=this.layers[S];if(C.layer.type!=="model"||!C.visible)continue;const{bucket:I,tileID:D}=this.currentBuildingBuckets[S];if(!I)continue;const{tileX:L,tileY:N}=this._mapCoordToOverlappingTile(s,c,m,D),H=I.getHeightAtTileCoord(L,N);if(H&&!H.hidden)return H.height===void 0&&x!==void 0?Math.min(H.maxHeight,x)*H.verticalScale:(H.height||0)*H.verticalScale}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Vl(p,s){const c={};for(const m in p)m!=="ref"&&(c[m]=p[m]);return o.b2.forEach(m=>{m in s&&(c[m]=s[m])}),c}function c_(p){p=p.slice();const s=Object.create(null);for(let c=0;c<p.length;c++)s[p[c].id]=p[c];for(let c=0;c<p.length;c++)"ref"in p[c]&&(p[c]=Vl(p[c],s[p[c].ref]));return p}const Qr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function Zu(p,s,c){c.push({command:Qr.addSource,args:[p,s[p]]})}function Mp(p,s,c){s.push({command:Qr.removeSource,args:[p]}),c[p]=!0}function vv(p,s,c,m){Mp(p,c,m),Zu(p,s,c)}function wv(p,s,c){let m;for(m in p[c])if(p[c].hasOwnProperty(m)&&m!=="data"&&!k(p[c][m],s[c][m]))return!1;for(m in s[c])if(s[c].hasOwnProperty(m)&&m!=="data"&&!k(p[c][m],s[c][m]))return!1;return!0}function tl(p,s,c,m,x,v){let S;for(S in s=s||{},p=p||{})p.hasOwnProperty(S)&&(k(p[S],s[S])||c.push({command:v,args:[m,S,s[S],x]}));for(S in s)s.hasOwnProperty(S)&&!p.hasOwnProperty(S)&&(k(p[S],s[S])||c.push({command:v,args:[m,S,s[S],x]}))}function rl(p){return p.id}function Sf(p,s){return p[s.id]=s,p}class Dc{constructor(s,c){this.reset(s,c)}reset(s,c){this.points=s||[],this._distances=[0];for(let m=1;m<this.points.length;m++)this._distances[m]=this._distances[m-1]+this.points[m].dist(this.points[m-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(s){if(this.points.length===1)return this.points[0];s=o.aa(s,0,1);let c=1,m=this._distances[c];const x=s*this.paddedLength+this.padding;for(;m<x&&c<this._distances.length;)m=this._distances[++c];const v=c-1,S=this._distances[v],C=m-S,I=C>0?(x-S)/C:0;return this.points[v].mult(1-I).add(this.points[c].mult(I))}}class Ip{constructor(s,c,m){const x=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(s/m),this.yCellCount=Math.ceil(c/m);for(let S=0;S<this.xCellCount*this.yCellCount;S++)x.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=s,this.height=c,this.xScale=this.xCellCount/s,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(s,c,m,x,v){this._forEachCell(c,m,x,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(s),this.bboxes.push(c),this.bboxes.push(m),this.bboxes.push(x),this.bboxes.push(v)}insertCircle(s,c,m,x){this._forEachCell(c-x,m-x,c+x,m+x,this._insertCircleCell,this.circleUid++),this.circleKeys.push(s),this.circles.push(c),this.circles.push(m),this.circles.push(x)}_insertBoxCell(s,c,m,x,v,S){this.boxCells[v].push(S)}_insertCircleCell(s,c,m,x,v,S){this.circleCells[v].push(S)}_query(s,c,m,x,v,S){if(m<0||s>this.width||x<0||c>this.height)return!v&&[];const C=[];if(s<=0&&c<=0&&this.width<=m&&this.height<=x){if(v)return!0;for(let I=0;I<this.boxKeys.length;I++)C.push({key:this.boxKeys[I],x1:this.bboxes[4*I],y1:this.bboxes[4*I+1],x2:this.bboxes[4*I+2],y2:this.bboxes[4*I+3]});for(let I=0;I<this.circleKeys.length;I++){const D=this.circles[3*I],L=this.circles[3*I+1],N=this.circles[3*I+2];C.push({key:this.circleKeys[I],x1:D-N,y1:L-N,x2:D+N,y2:L+N})}return S?C.filter(S):C}return this._forEachCell(s,c,m,x,this._queryCell,C,{hitTest:v,seenUids:{box:{},circle:{}}},S),v?C.length>0:C}_queryCircle(s,c,m,x,v){const S=s-m,C=s+m,I=c-m,D=c+m;if(C<0||S>this.width||D<0||I>this.height)return!x&&[];const L=[];return this._forEachCell(S,I,C,D,this._queryCellCircle,L,{hitTest:x,circle:{x:s,y:c,radius:m},seenUids:{box:{},circle:{}}},v),x?L.length>0:L}query(s,c,m,x,v){return this._query(s,c,m,x,!1,v)}hitTest(s,c,m,x,v){return this._query(s,c,m,x,!0,v)}hitTestCircle(s,c,m,x){return this._queryCircle(s,c,m,!0,x)}_queryCell(s,c,m,x,v,S,C,I){const D=C.seenUids,L=this.boxCells[v];if(L!==null){const H=this.bboxes;for(const W of L)if(!D.box[W]){D.box[W]=!0;const te=4*W;if(s<=H[te+2]&&c<=H[te+3]&&m>=H[te+0]&&x>=H[te+1]&&(!I||I(this.boxKeys[W]))){if(C.hitTest)return S.push(!0),!0;S.push({key:this.boxKeys[W],x1:H[te],y1:H[te+1],x2:H[te+2],y2:H[te+3]})}}}const N=this.circleCells[v];if(N!==null){const H=this.circles;for(const W of N)if(!D.circle[W]){D.circle[W]=!0;const te=3*W;if(this._circleAndRectCollide(H[te],H[te+1],H[te+2],s,c,m,x)&&(!I||I(this.circleKeys[W]))){if(C.hitTest)return S.push(!0),!0;{const ee=H[te],ne=H[te+1],K=H[te+2];S.push({key:this.circleKeys[W],x1:ee-K,y1:ne-K,x2:ee+K,y2:ne+K})}}}}}_queryCellCircle(s,c,m,x,v,S,C,I){const D=C.circle,L=C.seenUids,N=this.boxCells[v];if(N!==null){const W=this.bboxes;for(const te of N)if(!L.box[te]){L.box[te]=!0;const ee=4*te;if(this._circleAndRectCollide(D.x,D.y,D.radius,W[ee+0],W[ee+1],W[ee+2],W[ee+3])&&(!I||I(this.boxKeys[te])))return S.push(!0),!0}}const H=this.circleCells[v];if(H!==null){const W=this.circles;for(const te of H)if(!L.circle[te]){L.circle[te]=!0;const ee=3*te;if(this._circlesCollide(W[ee],W[ee+1],W[ee+2],D.x,D.y,D.radius)&&(!I||I(this.circleKeys[te])))return S.push(!0),!0}}}_forEachCell(s,c,m,x,v,S,C,I){const D=this._convertToXCellCoord(s),L=this._convertToYCellCoord(c),N=this._convertToXCellCoord(m),H=this._convertToYCellCoord(x);for(let W=D;W<=N;W++)for(let te=L;te<=H;te++)if(v.call(this,s,c,m,x,this.xCellCount*te+W,S,C,I))return}_convertToXCellCoord(s){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(s*this.xScale)))}_convertToYCellCoord(s){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(s*this.yScale)))}_circlesCollide(s,c,m,x,v,S){const C=x-s,I=v-c,D=m+S;return D*D>C*C+I*I}_circleAndRectCollide(s,c,m,x,v,S,C){const I=(S-x)/2,D=Math.abs(s-(x+I));if(D>I+m)return!1;const L=(C-v)/2,N=Math.abs(c-(v+L));if(N>L+m)return!1;if(D<=I||N<=L)return!0;const H=D-I,W=N-L;return H*H+W*W<=m*m}}const To={unknown:0,flipRequired:1,flipNotRequired:2},nl=Math.tan(85*Math.PI/180);function Xu(p,s,c,m,x,v,S){const C=o.a6.create();if(c)if(v.name==="globe"){const I=o.b3(x,s);o.a6.multiply(C,C,I)}else{const I=o.b4.invert([],S);C[0]=I[0],C[1]=I[1],C[4]=I[2],C[5]=I[3],m||o.a6.rotateZ(C,C,x.angle)}else o.a6.multiply(C,x.labelPlaneMatrix,p);return C}function Pp(p,s,c,m,x,v,S){const C=Xu(p,s,c,m,x,v,S);return v.name==="globe"&&c||(C[2]=C[6]=C[10]=C[14]=0),C}function Rp(p,s,c,m,x,v,S){if(c){if(v.name==="globe"){const C=Xu(p,s,c,m,x,v,S);return o.a6.invert(C,C),o.a6.multiply(C,p,C),C}{const C=o.a6.clone(p),I=o.a6.identity([]);return I[0]=S[0],I[1]=S[1],I[4]=S[2],I[5]=S[3],o.a6.multiply(C,C,I),m||o.a6.rotateZ(C,C,-x.angle),C}}return x.glCoordMatrix}function fs(p,s,c,m){const x=[p,s,c,1];c?o.a7.transformMat4(x,x,m):zp(x,x,m);const v=x[3];return x[0]/=v,x[1]/=v,x[2]/=v,x}function u_(p,s){return Math.min(.5+p/s*.5,1.5)}function Dp(p,s){const c=p[0]/p[3],m=p[1]/p[3];return c>=-s[0]&&c<=s[0]&&m>=-s[1]&&m<=s[1]}function Fp(p,s,c,m,x,v,S,C,I,D){const L=c.transform,N=m?p.textSizeData:p.iconSizeData,H=o.b5(N,c.transform.zoom),W=L.projection.name==="globe",te=[256/c.width*2+1,256/c.height*2+1],ee=m?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;ee.clear();let ne=null;W&&(ne=m?p.text.globeExtVertexArray:p.icon.globeExtVertexArray);const K=p.lineVertexArray,ae=m?p.text.placedSymbolArray:p.icon.placedSymbolArray,xe=c.transform.width/c.transform.height;let ue,ye=!1;for(let ie=0;ie<ae.length;ie++){const ve=ae.get(ie),{numGlyphs:Pe,writingMode:Fe}=ve;if(Fe!==o.b6.vertical||ye||ue===o.b6.horizontal||(ye=!0),ue=Fe,(ve.hidden||Fe===o.b6.vertical)&&!ye){il(Pe,ee);continue}ye=!1;const $e=new o.P(ve.tileAnchorX,ve.tileAnchorY);let{x:nt,y:Ge,z:ft}=L.projection.projectTilePoint($e.x,$e.y,D.canonical);if(I){const[Yt,or,pr]=I($e);nt+=Yt,Ge+=or,ft+=pr}const ct=[nt,Ge,ft,1];if(o.a7.transformMat4(ct,ct,s),!Dp(ct,te)){il(Pe,ee);continue}const Ct=ct[3],qe=u_(c.transform.getCameraToCenterDistance(L.projection),Ct),ot=o.b7(N,H,ve),Ue=S?ot/qe:ot*qe,Qe=fs(nt,Ge,ft,x);if(Qe[3]<=0){il(Pe,ee);continue}let Mt={};const Ut=S?null:I,Bt=Np(ve,Ue,!1,C,s,x,v,p.glyphOffsetArray,K,ee,ne,Qe,$e,Mt,xe,Ut,L.projection,D,S);ye=Bt.useVertical,Ut&&Bt.needsFlipping&&(Mt={}),(Bt.notEnoughRoom||ye||Bt.needsFlipping&&Np(ve,Ue,!0,C,s,x,v,p.glyphOffsetArray,K,ee,ne,Qe,$e,Mt,xe,Ut,L.projection,D,S).notEnoughRoom)&&il(Pe,ee)}m?(p.text.dynamicLayoutVertexBuffer.updateData(ee),ne&&p.text.globeExtVertexBuffer&&p.text.globeExtVertexBuffer.updateData(ne)):(p.icon.dynamicLayoutVertexBuffer.updateData(ee),ne&&p.icon.globeExtVertexBuffer&&p.icon.globeExtVertexBuffer.updateData(ne))}function Lp(p,s,c,m,x,v,S,C,I,D,L,N,H,W,te,ee){const{lineStartIndex:ne,glyphStartIndex:K,segment:ae}=C,xe=K+C.numGlyphs,ue=ne+C.lineLength,ye=s.getoffsetX(K),ie=s.getoffsetX(xe-1),ve=Yu(p*ye,c,m,x,v,S,ae,ne,ue,I,D,L,N,H,!0,W,te,ee);if(!ve)return null;const Pe=Yu(p*ie,c,m,x,v,S,ae,ne,ue,I,D,L,N,H,!0,W,te,ee);return Pe?{first:ve,last:Pe}:null}function Op(p,s,c,m){return p===o.b6.horizontal&&Math.abs(m)>Math.abs(c)?{useVertical:!0}:p===o.b6.vertical?m>0?{needsFlipping:!0}:null:s!==To.unknown&&function(x,v){return x===0||Math.abs(v/x)>nl}(c,m)?s===To.flipRequired?{needsFlipping:!0}:null:c<0?{needsFlipping:!0}:null}function Np(p,s,c,m,x,v,S,C,I,D,L,N,H,W,te,ee,ne,K,ae){const xe=s/24,ue=p.lineOffsetX*xe,ye=p.lineOffsetY*xe,{lineStartIndex:ie,glyphStartIndex:ve,numGlyphs:Pe,segment:Fe,writingMode:$e,flipState:nt}=p,Ge=ie+p.lineLength,ft=ct=>{if(L){const[Ue,Qe,Mt]=ct.up,Ut=D.length;o.b8(L,Ut+0,Ue,Qe,Mt),o.b8(L,Ut+1,Ue,Qe,Mt),o.b8(L,Ut+2,Ue,Qe,Mt),o.b8(L,Ut+3,Ue,Qe,Mt)}const[Ct,qe,ot]=ct.point;o.b9(D,Ct,qe,ot,ct.angle)};if(Pe>1){const ct=Lp(xe,C,ue,ye,c,N,H,p,I,v,W,ee,!1,ne,K,ae);if(!ct)return{notEnoughRoom:!0};if(m&&!c){let[Ct,qe,ot]=ct.first.point,[Ue,Qe,Mt]=ct.last.point;[Ct,qe]=fs(Ct,qe,ot,S),[Ue,Qe]=fs(Ue,Qe,Mt,S);const Ut=Op($e,nt,(Ue-Ct)*te,Qe-qe);if(p.flipState=Ut&&Ut.needsFlipping?To.flipRequired:To.flipNotRequired,Ut)return Ut}ft(ct.first);for(let Ct=ve+1;Ct<ve+Pe-1;Ct++){const qe=Yu(xe*C.getoffsetX(Ct),ue,ye,c,N,H,Fe,ie,Ge,I,v,W,ee,!1,!1,ne,K,ae);if(!qe)return D.length-=4*(Ct-ve),{notEnoughRoom:!0};ft(qe)}ft(ct.last)}else{if(m&&!c){const Ct=fs(H.x,H.y,0,x),qe=ie+Fe+1,ot=new o.P(I.getx(qe),I.gety(qe)),Ue=fs(ot.x,ot.y,0,x),Qe=Ue[3]>0?Ue:Af(H,ot,Ct,1,x,void 0,ne,K.canonical),Mt=Op($e,nt,(Qe[0]-Ct[0])*te,Qe[1]-Ct[1]);if(p.flipState=Mt&&Mt.needsFlipping?To.flipRequired:To.flipNotRequired,Mt)return Mt}const ct=Yu(xe*C.getoffsetX(ve),ue,ye,c,N,H,Fe,ie,Ge,I,v,W,ee,!1,!1,ne,K,ae);if(!ct)return{notEnoughRoom:!0};ft(ct)}return{}}function Fc(p,s,c,m,x){const{x:v,y:S,z:C}=m.projectTilePoint(p.x,p.y,s);if(!x)return fs(v,S,C,c);const[I,D,L]=x(p);return fs(v+I,S+D,C+L,c)}function Af(p,s,c,m,x,v,S,C){const I=Fc(p.sub(s)._unit()._add(p),C,x,S,v);return o.N.sub(I,c,I),o.N.normalize(I,I),o.N.scaleAndAdd(I,c,I,m)}function Yu(p,s,c,m,x,v,S,C,I,D,L,N,H,W,te,ee,ne,K){const ae=m?p-s:p+s;let xe=ae>0?1:-1,ue=0;m&&(xe*=-1,ue=Math.PI),xe<0&&(ue+=Math.PI);let ye=C+S+(xe>0?0:1)|0,ie=x,ve=x,Pe=0,Fe=0;const $e=Math.abs(ae),nt=[],Ge=[];let ft=v,ct=ft;const Ct=()=>Af(ct,ft,ve,$e-Pe+1,L,H,ee,ne.canonical);for(;Pe+Fe<=$e;){if(ye+=xe,ye<C||ye>=I)return null;if(ve=ie,ct=ft,nt.push(ve),W&&Ge.push(ct),ft=new o.P(D.getx(ye),D.gety(ye)),ie=N[ye],!ie){const or=Fc(ft,ne.canonical,L,ee,H);ie=or[3]>0?N[ye]=or:Ct()}Pe+=Fe,Fe=o.N.distance(ve,ie)}te&&H&&(N[ye]&&(ie=Ct(),Fe=o.N.distance(ve,ie)),N[ye]=ie);const qe=($e-Pe)/Fe,ot=ft.sub(ct)._mult(qe)._add(ct),Ue=o.N.sub([],ie,ve),Qe=o.N.scaleAndAdd([],ve,Ue,qe);let Mt=[0,0,1],Ut=Ue[0],Bt=Ue[1];if(K&&(Mt=ee.upVector(ne.canonical,ot.x,ot.y),Mt[0]!==0||Mt[1]!==0||Mt[2]!==1)){const or=[Mt[2],0,-Mt[0]],pr=o.N.cross([],Mt,or);o.N.normalize(or,or),o.N.normalize(pr,pr),Ut=o.N.dot(Ue,or),Bt=o.N.dot(Ue,pr)}if(c){const or=o.N.cross([],Mt,Ue);o.N.normalize(or,or),o.N.scaleAndAdd(Qe,Qe,or,c*xe)}const Yt=ue+Math.atan2(Bt,Ut);return nt.push(Qe),W&&Ge.push(ot),{point:Qe,angle:Yt,path:nt,tilePath:Ge,up:Mt}}function il(p,s){const c=s.length,m=c+4*p;s.resize(m),s.float32.fill(-1/0,4*c,4*m)}function zp(p,s,c){const m=s[0],x=s[1];return p[0]=c[0]*m+c[4]*x+c[12],p[1]=c[1]*m+c[5]*x+c[13],p[3]=c[3]*m+c[7]*x+c[15],p}const ds=100;class Kt{constructor(s,c,m=new Ip(s.width+200,s.height+200,25),x=new Ip(s.width+200,s.height+200,25)){this.transform=s,this.grid=m,this.ignoredGrid=x,this.pitchfactor=Math.cos(s._pitch)*s.cameraToCenterDistance,this.screenRightBoundary=s.width+ds,this.screenBottomBoundary=s.height+ds,this.gridRightBoundary=s.width+200,this.gridBottomBoundary=s.height+200,this.fogState=c}placeCollisionBox(s,c,m,x,v,S,C,I){let D=m.projectedAnchorX,L=m.projectedAnchorY,N=m.projectedAnchorZ;const H=m.elevation,W=m.tileID,te=s.getProjection();if(H&&W){const[ie,ve,Pe]=te.upVector(W.canonical,m.tileAnchorX,m.tileAnchorY),Fe=te.upVectorScale(W.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;D+=ie*H*Fe,L+=ve*H*Fe,N+=Pe*H*Fe}const ee=this.projectAndGetPerspectiveRatio(C,D,L,N,m.tileID,te.name==="globe"||!!H||this.transform.pitch>0,te),ne=S*ee.perspectiveRatio,K=(m.x1*c+x.x-m.padding)*ne+ee.point.x,ae=(m.y1*c+x.y-m.padding)*ne+ee.point.y,xe=(m.x2*c+x.x+m.padding)*ne+ee.point.x,ue=(m.y2*c+x.y+m.padding)*ne+ee.point.y,ye=ee.perspectiveRatio<=.55||ee.occluded;return!this.isInsideGrid(K,ae,xe,ue)||!v&&this.grid.hitTest(K,ae,xe,ue,I)||ye?{box:[],offscreen:!1,occluded:ee.occluded}:{box:[K,ae,xe,ue],offscreen:this.isOffscreen(K,ae,xe,ue),occluded:!1}}placeCollisionCircles(s,c,m,x,v,S,C,I,D,L,N,H,W,te,ee){const ne=[],K=this.transform.elevation,ae=s.getProjection(),xe=K?K.getAtTileOffsetFunc(ee,this.transform.center.lat,this.transform.worldSize,ae):null,ue=new o.P(m.tileAnchorX,m.tileAnchorY);let{x:ye,y:ie,z:ve}=ae.projectTilePoint(ue.x,ue.y,ee.canonical);if(xe){const[ot,Ue,Qe]=xe(ue);ye+=ot,ie+=Ue,ve+=Qe}const Pe=ae.name==="globe",Fe=this.projectAndGetPerspectiveRatio(C,ye,ie,ve,ee,Pe||!!K||this.transform.pitch>0,ae),{perspectiveRatio:$e}=Fe,nt=(N?S/$e:S*$e)/o.bc,Ge=fs(ye,ie,ve,I),ft=Fe.signedDistanceFromCamera>0?Lp(nt,v,m.lineOffsetX*nt,m.lineOffsetY*nt,!1,Ge,ue,m,x,I,{},K&&!N?xe:null,N&&!!K,ae,ee,N):null;let ct=!1,Ct=!1,qe=!0;if(ft&&!Fe.occluded){const ot=.5*W*$e+te,Ue=new o.P(-100,-100),Qe=new o.P(this.screenRightBoundary,this.screenBottomBoundary),Mt=new Dc,{first:Ut,last:Bt}=ft,Yt=Ut.path.length;let or=[];for(let fr=Yt-1;fr>=1;fr--)or.push(Ut.path[fr]);for(let fr=1;fr<Bt.path.length;fr++)or.push(Bt.path[fr]);const pr=2.5*ot;D&&(or=or.map(([fr,zr,Sr],Pr)=>(xe&&!Pe&&(Sr=xe(Pr<Yt-1?Ut.tilePath[Yt-1-Pr]:Bt.tilePath[Pr-Yt+2])[2]),fs(fr,zr,Sr,D))),or.some(fr=>fr[3]<=0)&&(or=[]));let ur=[];if(or.length>0){let fr=1/0,zr=-1/0,Sr=1/0,Pr=-1/0;for(const Mr of or)fr=Math.min(fr,Mr[0]),Sr=Math.min(Sr,Mr[1]),zr=Math.max(zr,Mr[0]),Pr=Math.max(Pr,Mr[1]);zr>=Ue.x&&fr<=Qe.x&&Pr>=Ue.y&&Sr<=Qe.y&&(ur=[or.map(Mr=>new o.P(Mr[0],Mr[1]))],(fr<Ue.x||zr>Qe.x||Sr<Ue.y||Pr>Qe.y)&&(ur=o.ba(ur,Ue.x,Ue.y,Qe.x,Qe.y)))}for(const fr of ur){Mt.reset(fr,.25*ot);let zr=0;zr=Mt.length<=.5*ot?1:Math.ceil(Mt.paddedLength/pr)+1;for(let Sr=0;Sr<zr;Sr++){const Pr=Sr/Math.max(zr-1,1),Mr=Mt.lerp(Pr),en=Mr.x+ds,Ln=Mr.y+ds;ne.push(en,Ln,ot,0);const Wr=en-ot,ii=Ln-ot,qr=en+ot,un=Ln+ot;if(qe=qe&&this.isOffscreen(Wr,ii,qr,un),Ct=Ct||this.isInsideGrid(Wr,ii,qr,un),!c&&this.grid.hitTestCircle(en,Ln,ot,H)&&(ct=!0,!L))return{circles:[],offscreen:!1,collisionDetected:ct,occluded:!1}}}}return{circles:!L&&ct||!Ct?[]:ne,offscreen:qe,collisionDetected:ct,occluded:Fe.occluded}}queryRenderedSymbols(s){if(s.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const c=[];let m=1/0,x=1/0,v=-1/0,S=-1/0;for(const L of s){const N=new o.P(L.x+ds,L.y+ds);m=Math.min(m,N.x),x=Math.min(x,N.y),v=Math.max(v,N.x),S=Math.max(S,N.y),c.push(N)}const C=this.grid.query(m,x,v,S).concat(this.ignoredGrid.query(m,x,v,S)),I={},D={};for(const L of C){const N=L.key;if(I[N.bucketInstanceId]===void 0&&(I[N.bucketInstanceId]={}),I[N.bucketInstanceId][N.featureIndex])continue;const H=[new o.P(L.x1,L.y1),new o.P(L.x2,L.y1),new o.P(L.x2,L.y2),new o.P(L.x1,L.y2)];o.bb(c,H)&&(I[N.bucketInstanceId][N.featureIndex]=!0,D[N.bucketInstanceId]===void 0&&(D[N.bucketInstanceId]=[]),D[N.bucketInstanceId].push(N.featureIndex))}return D}insertCollisionBox(s,c,m,x,v){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:x,collisionGroupID:v},s[0],s[1],s[2],s[3])}insertCollisionCircles(s,c,m,x,v){const S=c?this.ignoredGrid:this.grid,C={bucketInstanceId:m,featureIndex:x,collisionGroupID:v};for(let I=0;I<s.length;I+=4)S.insertCircle(C,s[I],s[I+1],s[I+2])}projectAndGetPerspectiveRatio(s,c,m,x,v,S,C){const I=[c,m,x,1];let D=!1;x||this.transform.pitch>0?(o.a7.transformMat4(I,I,s),this.fogState&&v&&C.name!=="globe"&&(D=function(H,W,te,ee,ne,K){const ae=K.calculateFogTileMatrix(ne),xe=[W,te,ee];return o.N.transformMat4(xe,xe,ae),Xr(H,o.N.length(xe),K.pitch,K._fov)}(this.fogState,c,m,x,v.toUnwrapped(),this.transform)>.9)):zp(I,I,s);const L=I[3];return{point:new o.P((I[0]/L+1)/2*this.transform.width+ds,(-I[1]/L+1)/2*this.transform.height+ds),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(C)/L*.5,1.5),signedDistanceFromCamera:L,occluded:S&&I[2]>L||D}}isOffscreen(s,c,m,x){return m<ds||s>=this.screenRightBoundary||x<ds||c>this.screenBottomBoundary}isInsideGrid(s,c,m,x){return m>=0&&s<this.gridRightBoundary&&x>=0&&c<this.gridBottomBoundary}getViewportMatrix(){const s=o.a6.identity([]);return o.a6.translate(s,s,[-100,-100,0]),s}}function Cf(p,s,c){const m=s.createTileMatrix(p,p.worldSize,c.toUnwrapped());return o.a6.multiply(new Float32Array(16),p.projMatrix,m)}function Bp(p,s,c){if(s.projection.name===c.projection.name)return p.projMatrix;const m=c.clone();return m.setProjection(s.projection),Cf(m,s.getProjection(),p)}function Ku(p,s,c){return s.name===c.projection.name?p.projMatrix:Cf(c,s,p)}class Up{constructor(s,c,m,x){this.opacity=s?Math.max(0,Math.min(1,s.opacity+(s.placed?c:-c))):x&&m?1:0,this.placed=m}isHidden(){return this.opacity===0&&!this.placed}}class al{constructor(s,c,m,x,v,S=!1){this.text=new Up(s?s.text:null,c,m,v),this.icon=new Up(s?s.icon:null,c,x,v),this.clipped=S}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class As{constructor(s,c,m,x=!1){this.text=s,this.icon=c,this.skipFade=m,this.clipped=x}}class Vp{constructor(){this.invProjMatrix=o.a6.create(),this.viewportMatrix=o.a6.create(),this.circles=[]}}class $l{constructor(s,c,m,x,v){this.bucketInstanceId=s,this.featureIndex=c,this.sourceLayerIndex=m,this.bucketIndex=x,this.tileID=v}}class kf{constructor(s){this.crossSourceCollisions=s,this.maxGroupID=0,this.collisionGroups={}}get(s){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[s]){const c=++this.maxGroupID;this.collisionGroups[s]={ID:c,predicate:m=>m.collisionGroupID===c}}return this.collisionGroups[s]}}function jl(p,s,c,m,x){const{horizontalAlign:v,verticalAlign:S}=o.bf(p),C=-(v-.5)*s,I=-(S-.5)*c,D=o.bd(p,m);return new o.P(C+D[0]*x,I+D[1]*x)}function $p(p,s,c,m,x){const v=new o.P(p,s);return c&&v._rotate(m?x:-x),v}class bv{constructor(s,c,m,x,v,S){this.transform=s.clone(),this.projection=s.projection.name,this.collisionIndex=new Kt(this.transform,v),this.buildingIndex=S,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new kf(m),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(s,c,m,x){const v=m.getBucket(c),S=m.latestFeatureIndex;if(!v||!S||c.fqid!==v.layerIds[0])return;const C=v.layers[0].layout,I=m.collisionBoxArray,D=Math.pow(2,this.transform.zoom-m.tileID.overscaledZ),L=m.tileSize/o.V,N=m.tileID.toUnwrapped();this.transform.setProjection(v.projection);const H=(W=m.tileID,te=v.getProjection(),ee=this.transform,te.name===this.projection?ee.calculateProjMatrix(W.toUnwrapped()):Cf(ee,te,W));var W,te,ee;const ne=C.get("text-pitch-alignment")==="map",K=C.get("text-rotation-alignment")==="map";c.compileFilter();const ae=c.dynamicFilter(),xe=c.dynamicFilterNeedsFeature(),ue=this.transform.calculatePixelsToTileUnitsMatrix(m),ye=Pp(H,m.tileID.canonical,ne,K,this.transform,v.getProjection(),ue);let ie=null;if(ne){const Fe=Rp(H,m.tileID.canonical,ne,K,this.transform,v.getProjection(),ue);ie=o.a6.multiply([],this.transform.labelPlaneMatrix,Fe)}let ve=null;ae&&m.latestFeatureIndex&&(ve={unwrappedTileID:N,dynamicFilter:ae,dynamicFilterNeedsFeature:xe,featureIndex:m.latestFeatureIndex}),this.retainedQueryData[v.bucketInstanceId]=new $l(v.bucketInstanceId,S,v.sourceLayerIndex,v.index,m.tileID);const Pe={bucket:v,layout:C,posMatrix:H,textLabelPlaneMatrix:ye,labelToScreenMatrix:ie,clippingData:ve,scale:D,textPixelRatio:L,holdingForFade:m.holdingForFade(),collisionBoxArray:I,partiallyEvaluatedTextSize:o.b5(v.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:o.b5(v.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(v.sourceID)};if(x)for(const Fe of v.sortKeyRanges){const{sortKey:$e,symbolInstanceStart:nt,symbolInstanceEnd:Ge}=Fe;s.push({sortKey:$e,symbolInstanceStart:nt,symbolInstanceEnd:Ge,parameters:Pe})}else s.push({symbolInstanceStart:0,symbolInstanceEnd:v.symbolInstances.length,parameters:Pe})}attemptAnchorPlacement(s,c,m,x,v,S,C,I,D,L,N,H,W,te,ee,ne,K,ae){const{textOffset0:xe,textOffset1:ue,crossTileID:ye}=H,ie=[xe,ue],ve=jl(s,m,x,ie,v),Pe=this.collisionIndex.placeCollisionBox(te,v,c,$p(ve.x,ve.y,S,C,this.transform.angle),N,I,D,L.predicate);if(ne){const Fe=te.getSymbolInstanceIconSize(ae,this.transform.zoom,H.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(te,Fe,ne,$p(ve.x,ve.y,S,C,this.transform.angle),N,I,D,L.predicate).box.length===0)return}if(Pe.box.length>0){let Fe;return this.prevPlacement&&this.prevPlacement.variableOffsets[ye]&&this.prevPlacement.placements[ye]&&this.prevPlacement.placements[ye].text&&(Fe=this.prevPlacement.variableOffsets[ye].anchor),this.variableOffsets[ye]={textOffset:ie,width:m,height:x,anchor:s,textScale:v,prevAnchor:Fe},this.markUsedJustification(te,s,H,ee),te.allowVerticalPlacement&&(this.markUsedOrientation(te,ee,H),this.placedOrientations[ye]=ee),{shift:ve,placedGlyphBoxes:Pe}}}placeLayerBucketPart(s,c,m,x){const{bucket:v,layout:S,posMatrix:C,textLabelPlaneMatrix:I,labelToScreenMatrix:D,clippingData:L,textPixelRatio:N,holdingForFade:H,collisionBoxArray:W,partiallyEvaluatedTextSize:te,partiallyEvaluatedIconSize:ee,collisionGroup:ne}=s.parameters,K=S.get("text-optional"),ae=S.get("icon-optional"),xe=S.get("text-allow-overlap"),ue=S.get("icon-allow-overlap"),ye=S.get("text-rotation-alignment")==="map",ie=S.get("text-pitch-alignment")==="map",ve=S.get("symbol-z-order")==="viewport-y",Pe=S.get("symbol-z-elevate");this.transform.setProjection(v.projection);let Fe=xe&&(ue||!v.hasIconData()||ae),$e=ue&&(xe||!v.hasTextData()||K);!v.collisionArrays&&W&&v.deserializeCollisionBoxes(W),m&&x&&v.updateCollisionDebugBuffers(this.transform.zoom,W);const nt=(Ge,ft,ct)=>{const{crossTileID:Ct,numVerticalGlyphVertices:qe}=Ge;if(L){const qr={zoom:this.transform.zoom,pitch:this.transform.pitch};let un=null;if(L.dynamicFilterNeedsFeature){const Zr=this.retainedQueryData[v.bucketInstanceId];un=L.featureIndex.loadFeature({featureIndex:Ge.featureIndex,bucketIndex:Zr.bucketIndex,sourceLayerIndex:Zr.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,L.dynamicFilter)(qr,un,this.retainedQueryData[v.bucketInstanceId].tileID.canonical,new o.P(Ge.tileAnchorX,Ge.tileAnchorY),this.transform.calculateDistanceTileData(L.unwrappedTileID)))return this.placements[Ct]=new As(!1,!1,!1,!0),void c.add(Ct)}if(c.has(Ct))return;if(H)return void(this.placements[Ct]=new As(!1,!1,!1));let ot=!1,Ue=!1,Qe=!0,Mt=!1,Ut=!1,Bt=null,Yt={box:null,offscreen:null,occluded:null},or={box:null,offscreen:null,occluded:null},pr=null,ur=null,fr=null,zr=0,Sr=0,Pr=0;ct.textFeatureIndex?zr=ct.textFeatureIndex:Ge.useRuntimeCollisionCircles&&(zr=Ge.featureIndex),ct.verticalTextFeatureIndex&&(Sr=ct.verticalTextFeatureIndex);const Mr=qr=>{qr.tileID=this.retainedQueryData[v.bucketInstanceId].tileID;const un=this.transform.elevation;qr.elevation=Ge.zOffset+(un?un.getAtTileOffset(qr.tileID,qr.tileAnchorX,qr.tileAnchorY):0)},en=ct.textBox;if(en){Mr(en);const qr=Zr=>{let sn=o.b6.horizontal;if(v.allowVerticalPlacement&&!Zr&&this.prevPlacement){const Bn=this.prevPlacement.placedOrientations[Ct];Bn&&(this.placedOrientations[Ct]=Bn,sn=Bn,this.markUsedOrientation(v,sn,Ge))}return sn},un=(Zr,sn)=>{if(v.allowVerticalPlacement&&qe>0&&ct.verticalTextBox){for(const Bn of v.writingModes)if(Bn===o.b6.vertical?(Yt=sn(),or=Yt):Yt=Zr(),Yt&&Yt.box&&Yt.box.length)break}else Yt=Zr()};if(S.get("text-variable-anchor")){let Zr=S.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ct]){const mn=this.prevPlacement.variableOffsets[Ct];Zr.indexOf(mn.anchor)>0&&(Zr=Zr.filter(Ni=>Ni!==mn.anchor),Zr.unshift(mn.anchor))}const sn=(mn,Ni,Ji)=>{const Fa=v.getSymbolInstanceTextSize(te,Ge,this.transform.zoom,ft),Qs=(mn.x2-mn.x1)*Fa+2*mn.padding,La=(mn.y2-mn.y1)*Fa+2*mn.padding,zi=Ge.hasIconTextFit&&!ue?Ni:null;zi&&Mr(zi);let Ai={box:[],offscreen:!1,occluded:!1};const da=xe?2*Zr.length:Zr.length;for(let wa=0;wa<da;++wa){const Oa=this.attemptAnchorPlacement(Zr[wa%Zr.length],mn,Qs,La,Fa,ye,ie,N,C,ne,wa>=Zr.length,Ge,ft,v,Ji,zi,te,ee);if(Oa&&(Ai=Oa.placedGlyphBoxes,Ai&&Ai.box&&Ai.box.length)){ot=!0,Bt=Oa.shift;break}}return Ai};un(()=>sn(en,ct.iconBox,o.b6.horizontal),()=>{const mn=ct.verticalTextBox;return mn&&Mr(mn),v.allowVerticalPlacement&&!(Yt&&Yt.box&&Yt.box.length)&&qe>0&&mn?sn(mn,ct.verticalIconBox,o.b6.vertical):{box:null,offscreen:null,occluded:null}}),Yt&&(ot=Yt.box,Qe=Yt.offscreen,Mt=Yt.occluded);const Bn=qr(!(!Yt||!Yt.box));if(!ot&&this.prevPlacement){const mn=this.prevPlacement.variableOffsets[Ct];mn&&(this.variableOffsets[Ct]=mn,this.markUsedJustification(v,mn.anchor,Ge,Bn))}}else{const Zr=(sn,Bn)=>{const mn=v.getSymbolInstanceTextSize(te,Ge,this.transform.zoom,ft),Ni=this.collisionIndex.placeCollisionBox(v,mn,sn,new o.P(0,0),xe,N,C,ne.predicate);return Ni&&Ni.box&&Ni.box.length&&(this.markUsedOrientation(v,Bn,Ge),this.placedOrientations[Ct]=Bn),Ni};un(()=>Zr(en,o.b6.horizontal),()=>{const sn=ct.verticalTextBox;return v.allowVerticalPlacement&&qe>0&&sn?(Mr(sn),Zr(sn,o.b6.vertical)):{box:null,offscreen:null,occluded:null}}),qr(!!(Yt&&Yt.box&&Yt.box.length))}}if(pr=Yt,ot=pr&&pr.box&&pr.box.length>0,Qe=pr&&pr.offscreen,Mt=pr&&pr.occluded,Ge.useRuntimeCollisionCircles){const qr=v.text.placedSymbolArray.get(Ge.centerJustifiedTextSymbolIndex>=0?Ge.centerJustifiedTextSymbolIndex:Ge.verticalPlacedTextSymbolIndex),un=o.b7(v.textSizeData,te,qr),Zr=S.get("text-padding");ur=this.collisionIndex.placeCollisionCircles(v,xe,qr,v.lineVertexArray,v.glyphOffsetArray,un,C,I,D,m,ie,ne.predicate,Ge.collisionCircleDiameter*un/o.bc,Zr,this.retainedQueryData[v.bucketInstanceId].tileID),ot=xe||ur.circles.length>0&&!ur.collisionDetected,Qe=Qe&&ur.offscreen,Mt=ur.occluded}if(ct.iconFeatureIndex&&(Pr=ct.iconFeatureIndex),ct.iconBox){const qr=un=>{Mr(un);const Zr=Ge.hasIconTextFit&&Bt?$p(Bt.x,Bt.y,ye,ie,this.transform.angle):new o.P(0,0),sn=v.getSymbolInstanceIconSize(ee,this.transform.zoom,Ge.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(v,sn,un,Zr,ue,N,C,ne.predicate)};or&&or.box&&or.box.length&&ct.verticalIconBox?(fr=qr(ct.verticalIconBox),Ue=fr.box.length>0):(fr=qr(ct.iconBox),Ue=fr.box.length>0),Qe=Qe&&fr.offscreen,Ut=fr.occluded}const Ln=K||Ge.numHorizontalGlyphVertices===0&&qe===0,Wr=ae||Ge.numIconVertices===0;if(Ln||Wr?Wr?Ln||(Ue=Ue&&ot):ot=Ue&&ot:Ue=ot=Ue&&ot,ot&&pr&&pr.box&&this.collisionIndex.insertCollisionBox(pr.box,S.get("text-ignore-placement"),v.bucketInstanceId,or&&or.box&&Sr?Sr:zr,ne.ID),Ue&&fr&&this.collisionIndex.insertCollisionBox(fr.box,S.get("icon-ignore-placement"),v.bucketInstanceId,Pr,ne.ID),ur&&(ot&&this.collisionIndex.insertCollisionCircles(ur.circles,S.get("text-ignore-placement"),v.bucketInstanceId,zr,ne.ID),m)){const qr=v.bucketInstanceId;let un=this.collisionCircleArrays[qr];un===void 0&&(un=this.collisionCircleArrays[qr]=new Vp);for(let Zr=0;Zr<ur.circles.length;Zr+=4)un.circles.push(ur.circles[Zr+0]),un.circles.push(ur.circles[Zr+1]),un.circles.push(ur.circles[Zr+2]),un.circles.push(ur.collisionDetected?1:0)}const ii=v.projection.name!=="globe";Fe=Fe&&(ii||!Mt),$e=$e&&(ii||!Ut),this.placements[Ct]=new As(ot||Fe,Ue||$e,Qe||v.justReloaded),c.add(Ct)};if(Pe&&this.buildingIndex&&(this.buildingIndex.updateZOffset(v,this.retainedQueryData[v.bucketInstanceId].tileID),v.updateZOffset()),ve){const Ge=v.getSortedSymbolIndexes(this.transform.angle);for(let ft=Ge.length-1;ft>=0;--ft){const ct=Ge[ft];nt(v.symbolInstances.get(ct),ct,v.collisionArrays[ct])}v.hasAnyZOffset&&o.w(`${v.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(v.hasAnyZOffset){const Ge=v.getSortedIndexesByZOffset();for(let ft=0;ft<Ge.length;++ft){const ct=Ge[ft];nt(v.symbolInstances.get(ct),ct,v.collisionArrays[ct])}}else for(let Ge=s.symbolInstanceStart;Ge<s.symbolInstanceEnd;Ge++)nt(v.symbolInstances.get(Ge),Ge,v.collisionArrays[Ge]);if(m&&v.bucketInstanceId in this.collisionCircleArrays){const Ge=this.collisionCircleArrays[v.bucketInstanceId];o.a6.invert(Ge.invProjMatrix,C),Ge.viewportMatrix=this.collisionIndex.getViewportMatrix()}v.justReloaded=!1}markUsedJustification(s,c,m,x){const{leftJustifiedTextSymbolIndex:v,centerJustifiedTextSymbolIndex:S,rightJustifiedTextSymbolIndex:C,verticalPlacedTextSymbolIndex:I,crossTileID:D}=m,L=o.be(c),N=x===o.b6.vertical?I:L==="left"?v:L==="center"?S:L==="right"?C:-1;v>=0&&(s.text.placedSymbolArray.get(v).crossTileID=N>=0&&v!==N?0:D),S>=0&&(s.text.placedSymbolArray.get(S).crossTileID=N>=0&&S!==N?0:D),C>=0&&(s.text.placedSymbolArray.get(C).crossTileID=N>=0&&C!==N?0:D),I>=0&&(s.text.placedSymbolArray.get(I).crossTileID=N>=0&&I!==N?0:D)}markUsedOrientation(s,c,m){const x=c===o.b6.horizontal||c===o.b6.horizontalOnly?c:0,v=c===o.b6.vertical?c:0,{leftJustifiedTextSymbolIndex:S,centerJustifiedTextSymbolIndex:C,rightJustifiedTextSymbolIndex:I,verticalPlacedTextSymbolIndex:D}=m,L=s.text.placedSymbolArray;S>=0&&(L.get(S).placedOrientation=x),C>=0&&(L.get(C).placedOrientation=x),I>=0&&(L.get(I).placedOrientation=x),D>=0&&(L.get(D).placedOrientation=v)}commit(s){this.commitTime=s,this.zoomAtLastRecencyCheck=this.transform.zoom;const c=this.prevPlacement;let m=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;const x=c?c.symbolFadeChange(s):1,v=c?c.opacities:{},S=c?c.variableOffsets:{},C=c?c.placedOrientations:{};for(const I in this.placements){const D=this.placements[I],L=v[I];L?(this.opacities[I]=new al(L,x,D.text,D.icon,null,D.clipped),m=m||D.text!==L.text.placed||D.icon!==L.icon.placed):(this.opacities[I]=new al(null,x,D.text,D.icon,D.skipFade,D.clipped),m=m||D.text||D.icon)}for(const I in v){const D=v[I];if(!this.opacities[I]){const L=new al(D,x,!1,!1);L.isHidden()||(this.opacities[I]=L,m=m||D.text.placed||D.icon.placed)}}for(const I in S)this.variableOffsets[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.variableOffsets[I]=S[I]);for(const I in C)this.placedOrientations[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.placedOrientations[I]=C[I]);m?this.lastPlacementChangeTime=s:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:s)}updateLayerOpacities(s,c){const m=new Set;for(const x of c){const v=x.getBucket(s);v&&x.latestFeatureIndex&&s.fqid===v.layerIds[0]&&(this.updateBucketOpacities(v,m,x.collisionBoxArray),v.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(v,x.tileID),v.updateZOffset()))}}updateBucketOpacities(s,c,m){s.hasTextData()&&s.text.opacityVertexArray.clear(),s.hasIconData()&&s.icon.opacityVertexArray.clear(),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexArray.clear(),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexArray.clear();const x=s.layers[0].layout,v=!!s.layers[0].dynamicFilter(),S=new al(null,0,!1,!1,!0),C=x.get("text-allow-overlap"),I=x.get("icon-allow-overlap"),D=x.get("text-variable-anchor"),L=x.get("text-rotation-alignment")==="map",N=x.get("text-pitch-alignment")==="map",H=new al(null,0,C&&(I||!s.hasIconData()||x.get("icon-optional")),I&&(C||!s.hasTextData()||x.get("text-optional")),!0);!s.collisionArrays&&m&&(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData())&&s.deserializeCollisionBoxes(m);const W=(ee,ne,K)=>{for(let ae=0;ae<ne/4;ae++)ee.opacityVertexArray.emplaceBack(K)};let te=0;for(let ee=0;ee<s.symbolInstances.length;ee++){const ne=s.symbolInstances.get(ee),{numHorizontalGlyphVertices:K,numVerticalGlyphVertices:ae,crossTileID:xe,numIconVertices:ue}=ne,ye=c.has(xe);let ie=this.opacities[xe];ye?ie=S:ie||(ie=H,this.opacities[xe]=ie),c.add(xe);const ve=K>0||ae>0,Pe=ue>0,Fe=this.placedOrientations[xe],$e=Fe===o.b6.vertical,nt=Fe===o.b6.horizontal||Fe===o.b6.horizontalOnly;if(!ve&&!Pe||ie.isHidden()||te++,ve){const Ge=d_(ie.text);W(s.text,K,$e?Ju:Ge),W(s.text,ae,nt?Ju:Ge);const ft=ie.text.isHidden(),{leftJustifiedTextSymbolIndex:ct,centerJustifiedTextSymbolIndex:Ct,rightJustifiedTextSymbolIndex:qe,verticalPlacedTextSymbolIndex:ot}=ne,Ue=s.text.placedSymbolArray,Qe=ft||$e?1:0;ct>=0&&(Ue.get(ct).hidden=Qe),Ct>=0&&(Ue.get(Ct).hidden=Qe),qe>=0&&(Ue.get(qe).hidden=Qe),ot>=0&&(Ue.get(ot).hidden=ft||nt?1:0);const Mt=this.variableOffsets[xe];Mt&&this.markUsedJustification(s,Mt.anchor,ne,Fe);const Ut=this.placedOrientations[xe];Ut&&(this.markUsedJustification(s,"left",ne,Ut),this.markUsedOrientation(s,Ut,ne))}if(Pe){const Ge=d_(ie.icon),{placedIconSymbolIndex:ft,verticalPlacedIconSymbolIndex:ct}=ne,Ct=s.icon.placedSymbolArray,qe=ie.icon.isHidden()?1:0;ft>=0&&(W(s.icon,ue,$e?Ju:Ge),Ct.get(ft).hidden=qe),ct>=0&&(W(s.icon,ne.numVerticalIconVertices,nt?Ju:Ge),Ct.get(ct).hidden=qe)}if(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData()){const Ge=s.collisionArrays[ee];if(Ge){let ft=new o.P(0,0),ct=!0;if(Ge.textBox||Ge.verticalTextBox){if(D){const qe=this.variableOffsets[xe];qe?(ft=jl(qe.anchor,qe.width,qe.height,qe.textOffset,qe.textScale),L&&ft._rotate(N?this.transform.angle:-this.transform.angle)):ct=!1}v&&(ct=!ie.clipped),Ge.textBox&&Lc(s.textCollisionBox.collisionVertexArray,ie.text.placed,!ct||$e,ft.x,ft.y),Ge.verticalTextBox&&Lc(s.textCollisionBox.collisionVertexArray,ie.text.placed,!ct||nt,ft.x,ft.y)}const Ct=ct&&!!(!nt&&Ge.verticalIconBox);Ge.iconBox&&Lc(s.iconCollisionBox.collisionVertexArray,ie.icon.placed,Ct,ne.hasIconTextFit?ft.x:0,ne.hasIconTextFit?ft.y:0),Ge.verticalIconBox&&Lc(s.iconCollisionBox.collisionVertexArray,ie.icon.placed,!Ct,ne.hasIconTextFit?ft.x:0,ne.hasIconTextFit?ft.y:0)}}}if(s.fullyClipped=te===0,s.sortFeatures(this.transform.angle),this.retainedQueryData[s.bucketInstanceId]&&(this.retainedQueryData[s.bucketInstanceId].featureSortOrder=s.featureSortOrder),s.hasTextData()&&s.text.opacityVertexBuffer&&s.text.opacityVertexBuffer.updateData(s.text.opacityVertexArray),s.hasIconData()&&s.icon.opacityVertexBuffer&&s.icon.opacityVertexBuffer.updateData(s.icon.opacityVertexArray),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexBuffer&&s.iconCollisionBox.collisionVertexBuffer.updateData(s.iconCollisionBox.collisionVertexArray),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexBuffer&&s.textCollisionBox.collisionVertexBuffer.updateData(s.textCollisionBox.collisionVertexArray),s.bucketInstanceId in this.collisionCircleArrays){const ee=this.collisionCircleArrays[s.bucketInstanceId];s.placementInvProjMatrix=ee.invProjMatrix,s.placementViewportMatrix=ee.viewportMatrix,s.collisionCircleArray=ee.circles,delete this.collisionCircleArrays[s.bucketInstanceId]}}symbolFadeChange(s){return this.fadeDuration===0?1:(s-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(s){return Math.max(0,(this.transform.zoom-s)/1.5)}hasTransitions(s){return this.stale||s-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(s,c){const m=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*m>s}setStale(){this.stale=!0}}function Lc(p,s,c,m,x){p.emplaceBack(s?1:0,c?1:0,m||0,x||0),p.emplaceBack(s?1:0,c?1:0,m||0,x||0),p.emplaceBack(s?1:0,c?1:0,m||0,x||0),p.emplaceBack(s?1:0,c?1:0,m||0,x||0)}const Tv=Math.pow(2,25),h_=Math.pow(2,24),f_=Math.pow(2,17),jp=Math.pow(2,16),Ev=Math.pow(2,9),Sv=Math.pow(2,8),Av=Math.pow(2,1);function d_(p){if(p.opacity===0&&!p.placed)return 0;if(p.opacity===1&&p.placed)return 4294967295;const s=p.placed?1:0,c=Math.floor(127*p.opacity);return c*Tv+s*h_+c*f_+s*jp+c*Ev+s*Sv+c*Av+s}const Ju=0;class Cv{constructor(s){this._sortAcrossTiles=s.layout.get("symbol-z-order")!=="viewport-y"&&s.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(s,c,m,x,v){const S=this._bucketParts;for(;this._currentTileIndex<s.length;)if(c.getBucketParts(S,x,s[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,S.sort((C,I)=>C.sortKey-I.sortKey));this._currentPartIndex<S.length;){const C=S[this._currentPartIndex];if(c.placeLayerBucketPart(C,this._seenCrossTileIDs,m,C.symbolInstanceStart===0),this._currentPartIndex++,v())return!0}return!1}}class Mf{constructor(s,c,m,x,v,S,C,I,D){this.placement=new bv(s,v,S,C,I,D),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(s,c,m,x){const v=o.f.now(),S=()=>{const C=o.f.now()-v;return!this._forceFullPlacement&&C>2};for(;this._currentPlacementIndex>=0;){const C=c[s[this._currentPlacementIndex]],I=this.placement.collisionIndex.transform.zoom;if(C.type==="symbol"&&(!C.minzoom||C.minzoom<=I)&&(!C.maxzoom||C.maxzoom>I)){const D=C,L=D.layout.get("symbol-z-elevate"),N=this._inProgressLayer=this._inProgressLayer||new Cv(D),H=o.ag(C.source,C.scope);if(N.continuePlacement(L?x[H]:m[H],this.placement,this._showCollisionBoxes,C,S))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(s){return this.placement.commit(s),this.placement}}const Gp=512/o.V/2;class p_{constructor(s,c,m){this.tileID=s,this.bucketInstanceId=m,this.index=new o.bg(c.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const x=s.canonical.x*o.V,v=s.canonical.y*o.V;for(let S=0;S<c.length;S++){const{key:C,crossTileID:I,tileAnchorX:D,tileAnchorY:L}=c.get(S),N=Math.floor((x+D)*Gp),H=Math.floor((v+L)*Gp);this.index.add(N,H),this.keys.push(C),this.crossTileIDs.push(I)}this.index.finish()}findMatches(s,c,m){const x=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z),v=Gp/Math.pow(2,c.canonical.z-this.tileID.canonical.z),S=c.canonical.x*o.V,C=c.canonical.y*o.V;for(let I=0;I<s.length;I++){const D=s.get(I);if(D.crossTileID)continue;const{key:L,tileAnchorX:N,tileAnchorY:H}=D,W=Math.floor((S+N)*v),te=Math.floor((C+H)*v),ee=this.index.range(W-x,te-x,W+x,te+x);for(const ne of ee){const K=this.crossTileIDs[ne];if(this.keys[ne]===L&&!m.has(K)){m.add(K),D.crossTileID=K;break}}}}}class Hp{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class If{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(s){const c=Math.round((s-this.lng)/360);if(c!==0)for(const m in this.indexes){const x=this.indexes[m],v={};for(const S in x){const C=x[S];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+c),v[C.tileID.key]=C}this.indexes[m]=v}this.lng=s}addBucket(s,c,m){if(this.indexes[s.overscaledZ]&&this.indexes[s.overscaledZ][s.key]){if(this.indexes[s.overscaledZ][s.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(s.overscaledZ,this.indexes[s.overscaledZ][s.key])}for(let v=0;v<c.symbolInstances.length;v++)c.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[s.overscaledZ]||(this.usedCrossTileIDs[s.overscaledZ]=new Set);const x=this.usedCrossTileIDs[s.overscaledZ];for(const v in this.indexes){const S=this.indexes[v];if(Number(v)>s.overscaledZ)for(const C in S){const I=S[C];I.tileID.isChildOf(s)&&I.findMatches(c.symbolInstances,s,x)}else{const C=S[s.scaledTo(Number(v)).key];C&&C.findMatches(c.symbolInstances,s,x)}}for(let v=0;v<c.symbolInstances.length;v++){const S=c.symbolInstances.get(v);S.crossTileID||(S.crossTileID=m.generate(),x.add(S.crossTileID))}return this.indexes[s.overscaledZ]===void 0&&(this.indexes[s.overscaledZ]={}),this.indexes[s.overscaledZ][s.key]=new p_(s,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(s,c){for(const m of c.crossTileIDs)this.usedCrossTileIDs[s].delete(m)}removeStaleBuckets(s){let c=!1;for(const m in this.indexes){const x=this.indexes[m];for(const v in x)s[x[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(m,x[v]),delete x[v],c=!0)}return c}}class Wp{constructor(){this.layerIndexes={},this.crossTileIDs=new Hp,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(s,c,m,x){let v=this.layerIndexes[s.fqid];v===void 0&&(v=this.layerIndexes[s.fqid]=new If);let S=!1;const C={};x.name!=="globe"&&v.handleWrapJump(m);for(const I of c){const D=I.getBucket(s);D&&s.fqid===D.layerIds[0]&&(D.bucketInstanceId||(D.bucketInstanceId=++this.maxBucketInstanceId),v.addBucket(I.tileID,D,this.crossTileIDs)&&(S=!0),C[D.bucketInstanceId]=!0)}return v.removeStaleBuckets(C)&&(S=!0),S}pruneUnusedLayers(s){const c={};s.forEach(m=>{c[m]=!0});for(const m in this.layerIndexes)c[m]||delete this.layerIndexes[m]}}class Gl{constructor(s=0,c=0,m=0,x=0){if(isNaN(s)||s<0||isNaN(c)||c<0||isNaN(m)||m<0||isNaN(x)||x<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=s,this.bottom=c,this.left=m,this.right=x}interpolate(s,c,m){return c.top!=null&&s.top!=null&&(this.top=o.U(s.top,c.top,m)),c.bottom!=null&&s.bottom!=null&&(this.bottom=o.U(s.bottom,c.bottom,m)),c.left!=null&&s.left!=null&&(this.left=o.U(s.left,c.left,m)),c.right!=null&&s.right!=null&&(this.right=o.U(s.right,c.right,m)),this}getCenter(s,c){const m=o.aa((this.left+s-this.right)/2,0,s),x=o.aa((this.top+c-this.bottom)/2,0,c);return new o.P(m,x)}equals(s){return this.top===s.top&&this.bottom===s.bottom&&this.left===s.left&&this.right===s.right}clone(){return new Gl(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Pf(p,s){const c=o.bk(p,3);o.a6.fromQuat(p,s),o.bm(p,3,c)}function Qu(p,s){const c=o.bi.identity([]);return o.bi.rotateZ(c,c,-s),o.bi.rotateX(c,c,-p),c}function qp(p,s){const c=[p[0],p[1],0],m=[s[0],s[1],0];if(o.N.length(c)>=1e-15){const S=o.N.normalize([],c);o.N.scale(m,S,o.N.dot(m,S)),s[0]=m[0],s[1]=m[1]}const x=o.N.cross([],s,p);if(o.N.len(x)<1e-15)return null;const v=Math.atan2(-x[1],x[0]);return Qu(Math.atan2(Math.sqrt(p[0]*p[0]+p[1]*p[1]),-p[2]),v)}class eh{constructor(s,c){this.position=s,this.orientation=c}get position(){return this._position}set position(s){if(s){const c=s instanceof o.L?s:new o.L(s[0],s[1],s[2]);this._renderWorldCopies&&(c.x=o.bh(c.x,0,1)),this._position=c}else this._position=null}lookAtPoint(s,c){if(this.orientation=null,!this.position)return;const m=this.position,x=this._elevation?this._elevation.getAtPointOrZero(o.L.fromLngLat(s)):0,v=o.L.fromLngLat(s,x),S=[v.x-m.x,v.y-m.y,v.z-m.z];c||(c=[0,0,1]),c[2]=Math.abs(c[2]),this.orientation=qp(S,c)}setPitchBearing(s,c){this.orientation=Qu(o.bj(s),o.bj(-c))}}class Oc{constructor(s,c){this._transform=o.a6.identity([]),this.orientation=c,this.position=s}get mercatorPosition(){const s=this.position;return new o.L(s[0],s[1],s[2])}get position(){const s=o.bk(this._transform,3);return[s[0],s[1],s[2]]}set position(s){var c;s&&o.bm(this._transform,3,[(c=s)[0],c[1],c[2],1])}get orientation(){return this._orientation}set orientation(s){this._orientation=s||o.bi.identity([]),s&&Pf(this._transform,this._orientation)}getPitchBearing(){const s=this.forward(),c=this.right();return{bearing:Math.atan2(-c[1],c[0]),pitch:Math.atan2(Math.sqrt(s[0]*s[0]+s[1]*s[1]),-s[2])}}setPitchBearing(s,c){this._orientation=Qu(s,c),Pf(this._transform,this._orientation)}forward(){const s=o.bk(this._transform,2);return[-s[0],-s[1],-s[2]]}up(){const s=o.bk(this._transform,1);return[-s[0],-s[1],-s[2]]}right(){const s=o.bk(this._transform,0);return[s[0],s[1],s[2]]}getCameraToWorld(s,c){const m=new Float64Array(16);return o.a6.invert(m,this.getWorldToCamera(s,c)),m}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(s,c,m){const x=this.position;o.N.scale(x,x,-s);const v=new Float64Array(16);return o.a6.fromScaling(v,[m,m,m]),o.a6.translate(v,v,x),v[10]*=c,v}getWorldToCamera(s,c){const m=new Float64Array(16),x=new Float64Array(4),v=this.position;return o.bi.conjugate(x,this._orientation),o.N.scale(v,v,-s),o.a6.fromQuat(m,x),o.a6.translate(m,m,v),m[1]*=-1,m[5]*=-1,m[9]*=-1,m[13]*=-1,m[8]*=c,m[9]*=c,m[10]*=c,m[11]*=c,m}getCameraToClipPerspective(s,c,m,x){const v=new Float64Array(16);return o.a6.perspective(v,s,c,m,x),v}getCameraToClipOrthographic(s,c,m,x,v,S){const C=new Float64Array(16);return o.a6.ortho(C,s,c,m,x,v,S),C}getDistanceToElevation(s,c=!1){const m=s===0?0:o.bl(s,c?o.au(this.position[1]):this.position[1]),x=this.forward();return(m-this.position[2])/x[2]}clone(){return new Oc([...this.position],[...this.orientation])}}const Nc=(p,s,c)=>(1-c)*p+c*s,th=p=>p*p*p*p*p;class rh{constructor(s,c,m,x,v,S,C){this.tileSize=512,this._renderWorldCopies=v===void 0||v,this._minZoom=s||0,this._maxZoom=c||22,this._minPitch=m??0,this._maxPitch=x??60,this.setProjection(S),this.setMaxBounds(C),this.width=0,this.height=0,this._center=new o.bn(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Gl,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Oc,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const s=new rh(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return s._elevation=this._elevation,s._centerAltitude=this._centerAltitude,s._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,s.tileSize=this.tileSize,s.mercatorFromTransition=this.mercatorFromTransition,s.width=this.width,s.height=this.height,s.cameraElevationReference=this.cameraElevationReference,s._center=this._center,s._setZoom(this.zoom),s._seaLevelZoom=this._seaLevelZoom,s.angle=this.angle,s._fov=this._fov,s._pitch=this._pitch,s._nearZ=this._nearZ,s._farZ=this._farZ,s._averageElevation=this._averageElevation,s._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,s._unmodified=this._unmodified,s._edgeInsets=this._edgeInsets.clone(),s._camera=this._camera.clone(),s._calcMatrices(),s.freezeTileCoverage=this.freezeTileCoverage,s.frustumCorners=this.frustumCorners,s}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(s){this._elevation!==s&&(this._elevation=s,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(s,c=!1){const m=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||m)&&this._updateCameraOnTerrain(),(s||m)&&this._constrainCamera(c),this._calcMatrices()}getProjection(){return o.ac(this.projection,["name","center","parallels"])}setProjection(s){this.projectionOptions=s||{name:"mercator"};const c=this.projection?this.getProjection():void 0;this.projection=o.bo(this.projectionOptions);const m=!k(c,this.getProjection());return m&&this._calcMatrices(),this.mercatorFromTransition=!1,m}setOrthographicProjectionAtLowPitch(s){return this._orthographicProjectionAtLowPitch!==s&&(this._orthographicProjectionAtLowPitch=s,this._calcMatrices(),!0)}setMercatorFromTransition(){const s=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=o.bo({name:"mercator"});const c=s!==this.projection.name;return c&&this._calcMatrices(),c}get minZoom(){return this._minZoom}set minZoom(s){this._minZoom!==s&&(this._minZoom=s,this.zoom=Math.max(this.zoom,s))}get maxZoom(){return this._maxZoom}set maxZoom(s){this._maxZoom!==s&&(this._maxZoom=s,this.zoom=Math.min(this.zoom,s))}get minPitch(){return this._minPitch}set minPitch(s){this._minPitch!==s&&(this._minPitch=s,this.pitch=Math.max(this.pitch,s))}get maxPitch(){return this._maxPitch}set maxPitch(s){this._maxPitch!==s&&(this._maxPitch=s,this.pitch=Math.min(this.pitch,s))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(s){s===void 0?s=!0:s===null&&(s=!1),this._renderWorldCopies=s}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const s=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(s))}get cameraWorldSize(){const s=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(s))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return o.bl(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this.width,this.height)}get bearing(){return o.bh(this.rotation,-180,180)}set bearing(s){this.rotation=s}get rotation(){return-this.angle/Math.PI*180}set rotation(s){const c=-s*Math.PI/180;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=o.b4.create(),o.b4.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(s){const c=o.aa(s,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const s=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/s)}set fov(s){s=Math.max(.01,Math.min(60,s)),this._fov!==s&&(this._unmodified=!1,this._fov=o.bj(s),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(s){this._averageElevation=s,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(s){const c=Math.min(Math.max(s,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._setZoom(c),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(s){this._zoom=s,this.scale=this.zoomScale(s),this.tileZoom=Math.floor(s),this.zoomFraction=s-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(s){this._tileCoverLift!==s&&(this._tileCoverLift=s)}_updateCameraOnTerrain(){const s=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,c=this.elevation&&s===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||s===Number.NEGATIVE_INFINITY&&(!c||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const m=this._elevation;c||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&m.exaggeration()&&this._centerAltitudeValidForExaggeration!==m.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*m.exaggeration(),this._centerAltitudeValidForExaggeration=m.exaggeration()):(this._centerAltitude=s||0,this._centerAltitudeValidForExaggeration=m.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const s=this._elevation,c=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],m=this.horizonLineFromTop();let x=0,v=0;for(let S=0;S<c.length;S++){const C=new o.P(c[S][0]*this.width,m+c[S][1]*(this.height-m)),I=s.pointCoordinate(C);if(!I)continue;const D=1/Math.hypot(I[0]-this._camera.position[0],I[1]-this._camera.position[1]);x+=I[3]*D,v+=D}return v===0?NaN:x/v}get center(){return this._center}set center(s){s.lat===this._center.lat&&s.lng===this._center.lng||(this._unmodified=!1,this._center=s,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const s=this._seaLevelZoom,c=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),m=this.pixelsPerMeter/this.worldSize*c,x=this._mercatorZfromZoom(s),v=this._mercatorZfromZoom(this._maxZoom),S=Math.max(x-m,v);this._setZoom(this._zoomFromMercatorZ(S))}get padding(){return this._edgeInsets.toJSON()}set padding(s){this._edgeInsets.equals(s)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,s,1),this._calcMatrices())}computeZoomRelativeTo(s){const c=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,s.toAltitude()));let m;m=s.z<this._camera.position[2]?[c.x,c.y,c.z]:[s.x,s.y,s.z];const x=o.N.length(o.N.sub([],this._camera.position,m));return o.aa(this._zoomFromMercatorZ(x),this._minZoom,this._maxZoom)}setFreeCameraOptions(s){if(!this.height||!s.position&&!s.orientation)return;this._updateCameraState();let c=!1;if(s.orientation&&!o.bi.exactEquals(s.orientation,this._camera.orientation)&&(c=this._setCameraOrientation(s.orientation)),s.position){const m=[s.position.x,s.position.y,s.position.z];o.N.exactEquals(m,this._camera.position)||(this._setCameraPosition(m),c=!0)}c&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const s=this._camera.position,c=new eh;return c.position=new o.L(s[0],s[1],s[2]),c.orientation=this._camera.orientation,c._elevation=this.elevation,c._renderWorldCopies=this.renderWorldCopies,c}_setCameraOrientation(s){if(!o.bi.length(s))return!1;o.bi.normalize(s,s);const c=o.N.transformQuat([],[0,0,-1],s),m=o.N.transformQuat([],[0,-1,0],s);if(m[2]<0)return!1;const x=qp(c,m);return!!x&&(this._camera.orientation=x,!0)}_setCameraPosition(s){const c=this.zoomScale(this.minZoom)*this.tileSize,m=this.zoomScale(this.maxZoom)*this.tileSize,x=this.cameraToCenterDistance;s[2]=o.aa(s[2],x/m,x/c),this._camera.position=s}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(s){return this._edgeInsets.equals(s)}interpolatePadding(s,c,m){this._unmodified=!1,this._edgeInsets.interpolate(s,c,m),this._constrain(),this._calcMatrices()}coveringZoomLevel(s){const c=(s.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/s.tileSize));return Math.max(0,c)}getVisibleUnwrappedCoordinates(s){const c=[new o.bp(0,s)];if(this.renderWorldCopies){const m=this.pointCoordinate(new o.P(0,0)),x=this.pointCoordinate(new o.P(this.width,0)),v=this.pointCoordinate(new o.P(this.width,this.height)),S=this.pointCoordinate(new o.P(0,this.height)),C=Math.floor(Math.min(m.x,x.x,v.x,S.x)),I=Math.floor(Math.max(m.x,x.x,v.x,S.x)),D=1;for(let L=C-D;L<=I+D;L++)L!==0&&c.push(new o.bp(L,s))}return c}isLODDisabled(s){return(!s||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(s,c,m){let x=[];if(c[0]===0&&c[1]===0)return x;for(const S of s){const C=S.canonical,I=S.overscaledZ,D=S.wrap,L=1<<C.z,N=C.x+1<L,H=C.x>0,W=C.y+1<L,te=C.y>0,ee=S.wrap-(H?0:1),ne=S.wrap+(N?0:1),K=H?C.x-1:L-1,ae=N?C.x+1:0;c[0]<0?(x.push(new o.am(I,ne,C.z,ae,C.y)),c[1]<0&&W&&(x.push(new o.am(I,D,C.z,C.x,C.y+1)),x.push(new o.am(I,ne,C.z,ae,C.y+1))),c[1]>0&&te&&(x.push(new o.am(I,D,C.z,C.x,C.y-1)),x.push(new o.am(I,ne,C.z,ae,C.y-1)))):c[0]>0?(x.push(new o.am(I,ee,C.z,K,C.y)),c[1]<0&&W&&(x.push(new o.am(I,D,C.z,C.x,C.y+1)),x.push(new o.am(I,ee,C.z,K,C.y+1))),c[1]>0&&te&&(x.push(new o.am(I,D,C.z,C.x,C.y-1)),x.push(new o.am(I,ee,C.z,K,C.y-1)))):c[1]<0&&W?x.push(new o.am(I,D,C.z,C.x,C.y+1)):te&&x.push(new o.am(I,D,C.z,C.x,C.y-1))}if(x.length>1){x.sort((I,D)=>I.overscaledZ-D.overscaledZ||I.wrap-D.wrap||I.canonical.z-D.canonical.z||I.canonical.x-D.canonical.x||I.canonical.y-D.canonical.y);let S=0,C=0;for(;C<x.length;)x[C].equals(x[S])?++C:x[++S]=x[C++];x.length=S+1}const v=[];for(const S of x)x.some(C=>S.isChildOf(C))||v.push(S);return x=v.filter(S=>!s.some(C=>!!(S.overscaledZ<m&&C.isChildOf(S))||S.equals(C)||S.isChildOf(C))),x}coveringTiles(s){let c=this.coveringZoomLevel(s);const m=c,x=this.elevation&&this.elevation.exaggeration(),v=x&&!s.isTerrainDEM,S=this.projection.name==="mercator";if(s.minzoom!==void 0&&c<s.minzoom)return[];s.maxzoom!==void 0&&c>s.maxzoom&&(c=s.maxzoom);const C=this.locationCoordinate(this.center),I=this.center.lat,D=1<<c,L=[D*C.x,D*C.y,0],N=this.projection.name==="globe",H=!N,W=o.bq.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c,H),te=N?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),ee=D*o.bl(1,this.center.lat),ne=this._camera.position[2]/o.bl(1,this.center.lat),K=[D*te.x,D*te.y,ne*(H?1:ee)],ae=N||x,xe=this.cameraToCenterDistance/s.tileSize*(s.roundZoom?1:.502),ue=this.isLODDisabled(!0)?c:0;let ye;if(this._elevation&&s.isTerrainDEM)ye=1e4*this._elevation.exaggeration();else if(this._elevation){const Ue=this._elevation.getMinMaxForVisibleTiles();ye=Ue?Ue.max:this._centerAltitude}else ye=this._centerAltitude;const ie=s.isTerrainDEM?-ye:this._elevation?this._elevation.getMinElevationBelowMSL():0,ve=this.projection.isReprojectedInTileSpace?o.br(this):1,Pe=Ue=>{const Mt=new o.L(Ue.x+25e-6,Ue.y,Ue.z),Ut=new o.L(Ue.x,Ue.y+25e-6,Ue.z),Bt=Ue.toLngLat(),Yt=Mt.toLngLat(),or=Ut.toLngLat(),pr=this.locationCoordinate(Bt),ur=this.locationCoordinate(Yt),fr=this.locationCoordinate(or),zr=Math.hypot(ur.x-pr.x,ur.y-pr.y),Sr=Math.hypot(fr.x-pr.x,fr.y-pr.y);return Math.sqrt(zr*Sr)*ve/25e-6},Fe=Ue=>{const Qe=ye,Mt=ie;return{aabb:o.bu(this,D,0,0,0,Ue,Mt,Qe,this.projection),zoom:0,x:0,y:0,minZ:Mt,maxZ:Qe,wrap:Ue,fullyVisible:!1}},$e=[];let nt=[];const Ge=c,ft=s.reparseOverscaled?m:c,ct=Ue=>Ue*Ue,Ct=ct((ne-this._centerAltitude)*ee),qe=Ue=>{if(!this._elevation||!Ue.tileID||!S)return;const Qe=this._elevation.getMinMaxForTile(Ue.tileID),Mt=Ue.aabb;Qe?(Mt.min[2]=Qe.min,Mt.max[2]=Qe.max,Mt.center[2]=(Mt.min[2]+Mt.max[2])/2):(Ue.shouldSplit=ot(Ue),Ue.shouldSplit||(Mt.min[2]=Mt.max[2]=Mt.center[2]=this._centerAltitude))},ot=Ue=>{if(Ue.zoom<ue)return!0;if(Ue.zoom===Ge)return!1;if(Ue.shouldSplit!=null)return Ue.shouldSplit;const Qe=Ue.aabb.distanceX(K),Mt=Ue.aabb.distanceY(K);let Ut=Ct,Bt=1;if(N){Ut=ct(Ue.aabb.distanceZ(K));const pr=Math.pow(2,Ue.zoom),ur=o.au((Ue.y+1)/pr),fr=o.au(Ue.y/pr),zr=Math.min(Math.max(I,ur),fr),Sr=o.bJ(zr)/o.bJ(I);if(Bt=zr===I?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Sr/this._mercatorScaleRatio),this.zoom<=o.bG&&Ue.zoom===Ge-1&&Sr>=.9)return!0}else if(v&&(Ut=ct(Ue.aabb.distanceZ(K)*ee)),this.projection.isReprojectedInTileSpace&&m<=5){const pr=Math.pow(2,Ue.zoom),ur=Pe(new o.L((Ue.x+.5)/pr,(Ue.y+.5)/pr));Bt=ur>.85?1:ur}const Yt=Qe*Qe+Mt*Mt+Ut,or=ct((1<<Ge-Ue.zoom)*xe*Bt*((pr,ur)=>{if(ur*ct(.707)<pr)return 1;const fr=Math.sqrt(ur/pr);return fr/(1.4144271570014144+(Math.pow(1.1,fr-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Ut,Ct),Yt));return Yt<or};if(this.renderWorldCopies)for(let Ue=1;Ue<=3;Ue++)$e.push(Fe(-Ue)),$e.push(Fe(Ue));for($e.push(Fe(0));$e.length>0;){const Ue=$e.pop(),Qe=Ue.x,Mt=Ue.y;let Ut=Ue.fullyVisible;const Bt=()=>this.projection.name==="globe"&&(Ue.y===0||Ue.y===(1<<Ue.zoom)-1);if(!Ut){let Yt=ae?Ue.aabb.intersects(W):Ue.aabb.intersectsFlat(W);if(Yt===0&&Bt()){const or=new o.bs(Ue.zoom,Qe,Mt);Yt=o.bt(this,D,or,!0).intersects(W)}if(Yt===0)continue;Ut=Yt===2}if(Ue.zoom!==Ge&&ot(Ue))for(let Yt=0;Yt<4;Yt++){const or=(Qe<<1)+Yt%2,pr=(Mt<<1)+(Yt>>1),ur={aabb:S?Ue.aabb.quadrant(Yt):o.bu(this,D,Ue.zoom+1,or,pr,Ue.wrap,Ue.minZ,Ue.maxZ,this.projection),zoom:Ue.zoom+1,x:or,y:pr,wrap:Ue.wrap,fullyVisible:Ut,tileID:void 0,shouldSplit:void 0,minZ:Ue.minZ,maxZ:Ue.maxZ};v&&!N&&(ur.tileID=new o.am(Ue.zoom+1===Ge?ft:Ue.zoom+1,Ue.wrap,Ue.zoom+1,or,pr),qe(ur)),$e.push(ur)}else{const Yt=Ue.zoom===Ge?ft:Ue.zoom;if(s.minzoom&&s.minzoom>Yt)continue;if(!Ut){let fr=ae?Ue.aabb.intersectsPrecise(W):Ue.aabb.intersectsPreciseFlat(W);if(fr===0&&Bt()){const zr=new o.bs(Ue.zoom,Qe,Mt);fr=o.bt(this,D,zr,!0).intersectsPrecise(W)}if(fr===0)continue}const or=L[0]-(.5+Qe+(Ue.wrap<<Ue.zoom))*(1<<c-Ue.zoom),pr=L[1]-.5-Mt,ur=Ue.tileID?Ue.tileID:new o.am(Yt,Ue.wrap,Ue.zoom,Qe,Mt);nt.push({tileID:ur,distanceSq:or*or+pr*pr})}}if(this.fogCullDistSq){const Ue=this.fogCullDistSq,Qe=this.horizonLineFromTop();nt=nt.filter(Mt=>{const Ut=[0,0,0,1],Bt=[o.V,o.V,0,1],Yt=this.calculateFogTileMatrix(Mt.tileID.toUnwrapped());o.a7.transformMat4(Ut,Ut,Yt),o.a7.transformMat4(Bt,Bt,Yt);const or=o.a7.min([],Ut,Bt),pr=o.a7.max([],Ut,Bt),ur=o.bv(or,pr);if(ur===0)return!0;let fr=!1;const zr=this._elevation;if(zr&&ur>Ue&&Qe!==0){const Sr=this.calculateProjMatrix(Mt.tileID.toUnwrapped());let Pr;s.isTerrainDEM||(Pr=zr.getMinMaxForTile(Mt.tileID)),Pr||(Pr={min:ie,max:ye});const Mr=o.bH(this.rotation),en=[Mr[0]*o.V,Mr[1]*o.V,Pr.max];o.N.transformMat4(en,en,Sr),fr=(1-en[1])*this.height*.5<Qe}return ur<Ue||fr})}return nt.sort((Ue,Qe)=>Ue.distanceSq-Qe.distanceSq).map(Ue=>Ue.tileID)}resize(s,c){this.width=s,this.height=c,this.pixelsToGLUnits=[2/s,-2/c],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(s){return Math.pow(2,s)}scaleZoom(s){return Math.log(s)/Math.LN2}project(s){const c=o.aa(s.lat,-o.bw,o.bw),m=this.projection.project(s.lng,c);return new o.P(m.x*this.worldSize,m.y*this.worldSize)}unproject(s){return this.projection.unproject(s.x/this.worldSize,s.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/o.bl(1,this.center.lat)/this.worldSize}setLocationAtPoint(s,c){let m,x;const v=this.centerPoint;if(this.projection.name==="globe"){const C=this.worldSize;m=(c.x-v.x)/C,x=(c.y-v.y)/C}else{const C=this.pointCoordinate(c),I=this.pointCoordinate(v);m=C.x-I.x,x=C.y-I.y}const S=this.locationCoordinate(s);this.setLocation(new o.L(S.x-m,S.y-x))}setLocation(s){this.center=this.coordinateLocation(s),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(s){return this.projection.locationPoint(this,s)}locationPoint3D(s){return this.projection.locationPoint(this,s,!0)}pointLocation(s){return this.coordinateLocation(this.pointCoordinate(s))}pointLocation3D(s){return this.coordinateLocation(this.pointCoordinate3D(s))}locationCoordinate(s,c){const m=c?o.bl(c,s.lat):void 0,x=this.projection.project(s.lng,s.lat);return new o.L(x.x,x.y,m)}coordinateLocation(s){return this.projection.unproject(s.x,s.y)}pointRayIntersection(s,c){const m=c??this._centerAltitude,x=[s.x,s.y,0,1],v=[s.x,s.y,1,1];o.a7.transformMat4(x,x,this.pixelMatrixInverse),o.a7.transformMat4(v,v,this.pixelMatrixInverse);const S=v[3];o.a7.scale(x,x,1/x[3]),o.a7.scale(v,v,1/S);const C=x[2],I=v[2];return{p0:x,p1:v,t:C===I?0:(m-C)/(I-C)}}screenPointToMercatorRay(s){const c=[s.x,s.y,0,1],m=[s.x,s.y,1,1];return o.a7.transformMat4(c,c,this.pixelMatrixInverse),o.a7.transformMat4(m,m,this.pixelMatrixInverse),o.a7.scale(c,c,1/c[3]),o.a7.scale(m,m,1/m[3]),c[2]=o.bl(c[2],this._center.lat)*this.worldSize,m[2]=o.bl(m[2],this._center.lat)*this.worldSize,o.a7.scale(c,c,1/this.worldSize),o.a7.scale(m,m,1/this.worldSize),new o.a2([c[0],c[1],c[2]],o.N.normalize([],o.N.sub([],m,c)))}rayIntersectionCoordinate(s){const{p0:c,p1:m,t:x}=s,v=o.bl(c[2],this._center.lat),S=o.bl(m[2],this._center.lat);return new o.L(o.U(c[0],m[0],x)/this.worldSize,o.U(c[1],m[1],x)/this.worldSize,o.U(v,S,x))}pointCoordinate(s,c=this._centerAltitude){return this.projection.pointCoordinate(this,s.x,s.y,c)}pointCoordinate3D(s){if(!this.elevation)return this.pointCoordinate(s);let c=this.projection.pointCoordinate3D(this,s.x,s.y);if(c)return new o.L(c[0],c[1],c[2]);let m=0,x=this.horizonLineFromTop();if(s.y>x)return this.pointCoordinate(s);const v=.02*x,S=s.clone();for(let C=0;C<10&&x-m>v;C++){S.y=o.U(m,x,.66);const I=this.projection.pointCoordinate3D(this,S.x,S.y);I?(x=S.y,c=I):m=S.y}return c?new o.L(c[0],c[1],c[2]):this.pointCoordinate(s)}isPointAboveHorizon(s){return this.projection.isPointAboveHorizon(this,s)}isPointOnSurface(s){if(s.y<0||s.y>this.height||s.x<0||s.x>this.width)return!1;if(this.elevation||this.zoom>=o.bx)return!this.isPointAboveHorizon(s);const c=this.pointCoordinate(s);return c.y>=0&&c.y<=1}_coordinatePoint(s,c){const m=c&&this.elevation?this.elevation.getAtPointOrZero(s,this._centerAltitude):this._centerAltitude,x=[s.x*this.worldSize,s.y*this.worldSize,m+s.toAltitude(),1];return o.a7.transformMat4(x,x,this.pixelMatrix),x[3]>0?new o.P(x[0]/x[3],x[1]/x[3]):new o.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:s,left:c}=this._edgeInsets,m=this.height-this._edgeInsets.bottom,x=this.width-this._edgeInsets.right,v=this.pointLocation3D(new o.P(c,s)),S=this.pointLocation3D(new o.P(x,s)),C=this.pointLocation3D(new o.P(x,m)),I=this.pointLocation3D(new o.P(c,m));let D=Math.min(v.lng,S.lng,C.lng,I.lng),L=Math.max(v.lng,S.lng,C.lng,I.lng),N=Math.min(v.lat,S.lat,C.lat,I.lat),H=Math.max(v.lat,S.lat,C.lat,I.lat);const W=Math.pow(2,-this.zoom)/16*270,te=this.projection.name==="globe"?1:4,ee=(ne,K,ae,xe,ue)=>{const ye=(ne+ae)/2,ie=(K+xe)/2,ve=new o.P(ye,ie),{lng:Pe,lat:Fe}=this.pointLocation3D(ve),$e=Math.max(0,D-Pe,N-Fe,Pe-L,Fe-H);D=Math.min(D,Pe),L=Math.max(L,Pe),N=Math.min(N,Fe),H=Math.max(H,Fe),(ue<te||$e>W)&&(ee(ne,K,ye,ie,ue+1),ee(ye,ie,ae,xe,ue+1))};if(ee(c,s,x,s,1),ee(x,s,x,m,1),ee(x,m,c,m,1),ee(c,m,c,s,1),this.projection.name==="globe"){const[ne,K]=o.by(this);ne?(H=90,L=180,D=-180):K&&(N=-90,L=180,D=-180)}return new o.ad(new o.bn(D,N),new o.bn(L,H))}_getBoundsRectangular(s,c){const{top:m,left:x}=this._edgeInsets,v=this.height-this._edgeInsets.bottom,S=this.width-this._edgeInsets.right,C=new o.P(x,m),I=new o.P(S,m),D=new o.P(S,v),L=new o.P(x,v);let N=this.pointCoordinate(C,s),H=this.pointCoordinate(I,s);const W=this.pointCoordinate(D,c),te=this.pointCoordinate(L,c),ee=(ne,K)=>(K.y-ne.y)/(K.x-ne.x);return N.y>1&&H.y>=0?N=new o.L((1-te.y)/ee(te,N)+te.x,1):N.y<0&&H.y<=1&&(N=new o.L(-te.y/ee(te,N)+te.x,0)),H.y>1&&N.y>=0?H=new o.L((1-W.y)/ee(W,H)+W.x,1):H.y<0&&N.y<=1&&(H=new o.L(-W.y/ee(W,H)+W.x,0)),new o.ad().extend(this.coordinateLocation(N)).extend(this.coordinateLocation(H)).extend(this.coordinateLocation(te)).extend(this.coordinateLocation(W))}_getBoundsRectangularTerrain(){const s=this.elevation;if(!s.visibleDemTiles.length||s.isUsingMockSource())return this._getBoundsRectangular(0,0);const c=s.visibleDemTiles.reduce((m,x)=>{if(x.dem){const v=x.dem.tree;m.min=Math.min(m.min,v.minimums[0]),m.max=Math.max(m.max,v.maximums[0])}return m},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(c.min*s.exaggeration(),c.max*s.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(s=!0){const c=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,m=this.height/2-c*(1-this._horizonShift);return s?Math.max(0,m):m}getMaxBounds(){return this.maxBounds}setMaxBounds(s){this.maxBounds=s,this.minLat=-o.bw,this.maxLat=o.bw,this.minLng=-180,this.maxLng=180,s&&(this.minLat=s.getSouth(),this.maxLat=s.getNorth(),this.minLng=s.getWest(),this.maxLng=s.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.a5(this.minLng)*this.tileSize,this.worldMaxX=o.a5(this.maxLng)*this.tileSize,this.worldMinY=o.ae(this.maxLat)*this.tileSize,this.worldMaxY=o.ae(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(s,c){return this.projection.createTileMatrix(this,c,s)}calculateDistanceTileData(s){const c=s.key,m=this._distanceTileDataCache;if(m[c])return m[c];const x=s.canonical,v=1/this.height,S=this.cameraWorldSize,C=S/this.zoomScale(x.z),I=(x.x+Math.pow(2,x.z)*s.wrap)*C,D=x.y*C,L=this.point;L.x*=S/this.worldSize,L.y*=S/this.worldSize;const N=this.angle,H=Math.sin(-N),W=-Math.cos(-N);return m[c]={bearing:[H,W],center:[(L.x-I)*v,(L.y-D)*v],scale:C/o.V*v},m[c]}calculateFogTileMatrix(s){const c=s.key,m=this._fogTileMatrixCache;if(m[c])return m[c];const x=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,s);return o.a6.multiply(x,this.worldToFogMatrix,x),m[c]=new Float32Array(x),m[c]}calculateProjMatrix(s,c=!1,m=!1){const x=s.key;let v;if(v=m?this._expandedProjMatrixCache:c?this._alignedProjMatrixCache:this._projMatrixCache,v[x])return v[x];const S=this.calculatePosMatrix(s,this.worldSize);let C;return C=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:m?this.expandedFarZProjMatrix:c?this.alignedProjMatrix:this.projMatrix,o.a6.multiply(S,C,S),v[x]=new Float32Array(S),v[x]}calculatePixelsToTileUnitsMatrix(s){const c=s.tileID.key,m=this._pixelsToTileUnitsCache;if(m[c])return m[c];const x=o.bz(s,this);return m[c]=x,m[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const s=1/this.worldSize,c=o.a6.fromScaling([],[s,s,s]);return o.a6.multiply(c,c,this.globeMatrix),c}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const s=this._elevation;this._updateCameraState();const c=o.bl(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(c),x=this._camera.forward(),v=o.bl(1,this._center.lat);m[2]/=v,x[2]/=v,o.N.normalize(x,x);const S=s.raycast(m,x,s.exaggeration());if(S){const C=o.N.scaleAndAdd([],m,x,S),I=new o.L(C[0],C[1],o.bl(C[2],o.au(C[1]))),D=(I.z+o.N.length([I.x-m[0],I.y-m[1],I.z-m[2]*v]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(D),this._centerAltitude=I.toAltitude(),this._center=this.coordinateLocation(I),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(s=!1){if(!this._elevation)return;const c=this._elevation,m=o.bl(1,this._center.lat)*this.worldSize,x=this._computeCameraPosition(m),v=c.getAtPointOrZero(new o.L(...x)),S=this.pixelsPerMeter/this.worldSize*v,C=this._minimumHeightOverTerrain(),I=x[2]-S;if(I<=C)if(I<0||s){const D=this.locationCoordinate(this._center,this._centerAltitude),L=[x[0],x[1],D.z-x[2]],N=o.N.length(L);L[2]-=(C-I)/this._pixelsPerMercatorPixel;const H=o.N.length(L);if(H===0)return;o.N.scale(L,L,N/H*this._pixelsPerMercatorPixel),this._camera.position=[x[0],x[1],D.z*this._pixelsPerMercatorPixel-L[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const s=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||s){const H=this.center;return H.lat=o.aa(H.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!s)&&(H.lng=o.aa(H.lng,this.minLng,this.maxLng)),this.center=H,void(this._constraining=!1)}const c=this._unmodified,{x:m,y:x}=this.point;let v=0,S=m,C=x;const I=this.width/2,D=this.height/2,L=this.worldMinY*this.scale,N=this.worldMaxY*this.scale;if(x-D<L&&(C=L+D),x+D>N&&(C=N-D),N-L<this.height&&(v=Math.max(v,this.height/(N-L)),C=(N+L)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const H=this.worldMinX*this.scale,W=this.worldMaxX*this.scale,te=this.worldSize/2-(H+W)/2;S=(m+te+this.worldSize)%this.worldSize-te,S-I<H&&(S=H+I),S+I>W&&(S=W-I),W-H<this.width&&(v=Math.max(v,this.width/(W-H)),S=(W+H)/2)}S===m&&C===x||(this.center=this.unproject(new o.P(S,C))),v&&(this.zoom+=this.scaleZoom(v)),this._constrainCamera(),this._unmodified=c,this._constraining=!1}_minZoomForBounds(){let s=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(s=Math.max(s,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),s}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const s=this.centerOffset,c=this.projection.name==="globe",m=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=o.bl(1,this.center.lat)/o.bl(1,o.bI));const x=o.bA(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,x),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const v=this.projection.zAxisUnit==="meters"?m:1,S=this._camera.getWorldToCamera(this.worldSize,v);let C;const I=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(I[8]=2*-s.x/this.width,I[9]=2*s.y/this.height,this.isOrthographic){let Fe=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),$e=Fe*this.aspect,nt=-$e,Ge=-Fe;$e-=s.x,nt-=s.x,Fe+=s.y,Ge+=s.y,C=this._camera.getCameraToClipOrthographic(nt,$e,Ge,Fe,this._nearZ,this._farZ),((ft,ct,Ct,qe)=>{for(let ot=0;ot<16;ot++)ft[ot]=Nc(ct[ot],Ct[ot],qe)})(C,C,I,th(this.pitch>=15?1:this.pitch/15))}else C=I;const D=o.a6.mul([],I,S);let L=o.a6.mul([],C,S);if(this.projection.isReprojectedInTileSpace){const Fe=this.locationCoordinate(this.center),$e=o.a6.identity([]);o.a6.translate($e,$e,[Fe.x*this.worldSize,Fe.y*this.worldSize,0]),o.a6.multiply($e,$e,o.bB(this)),o.a6.translate($e,$e,[-Fe.x*this.worldSize,-Fe.y*this.worldSize,0]),o.a6.multiply(L,L,$e),o.a6.multiply(D,D,$e),this.inverseAdjustmentMatrix=o.bC(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=o.a6.scale([],L,[this.worldSize,this.worldSize,this.worldSize/v,1]),this.projMatrix=L,this.invProjMatrix=o.a6.invert(new Float64Array(16),this.projMatrix),c){const Fe=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Fe[8]=2*-s.x/this.width,Fe[9]=2*s.y/this.height,this.expandedFarZProjMatrix=o.a6.mul([],Fe,S)}else this.expandedFarZProjMatrix=this.projMatrix;const N=o.a6.invert([],C);this.frustumCorners=o.bD.fromInvProjectionMatrix(N,this.horizonLineFromTop(),this.height),this.cameraFrustum=o.bq.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!c);const H=new Float32Array(16);o.a6.identity(H),o.a6.scale(H,H,[1,-1,1]),o.a6.rotateX(H,H,this._pitch),o.a6.rotateZ(H,H,this.angle);const W=o.a6.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=o.a6.clone(W);const te=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;W[8]=2*-s.x/this.width,W[9]=2*(s.y+te)/this.height,this.skyboxMatrix=o.a6.multiply(H,W,H);const ee=this.point,ne=ee.x,K=ee.y,ae=this.width%2/2,xe=this.height%2/2,ue=Math.cos(this.angle),ye=Math.sin(this.angle),ie=ne-Math.round(ne)+ue*ae+ye*xe,ve=K-Math.round(K)+ue*xe+ye*ae,Pe=new Float64Array(L);if(o.a6.translate(Pe,Pe,[ie>.5?ie-1:ie,ve>.5?ve-1:ve,0]),this.alignedProjMatrix=Pe,L=o.a6.create(),o.a6.scale(L,L,[this.width/2,-this.height/2,1]),o.a6.translate(L,L,[1,-1,0]),this.labelPlaneMatrix=L,L=o.a6.create(),o.a6.scale(L,L,[1,-1,1]),o.a6.translate(L,L,[-1,-1,0]),o.a6.scale(L,L,[2/this.width,2/this.height,1]),this.glCoordMatrix=L,this.pixelMatrix=o.a6.multiply(new Float64Array(16),this.labelPlaneMatrix,D),this._calcFogMatrices(),this._distanceTileDataCache={},L=o.a6.invert(new Float64Array(16),this.pixelMatrix),!L)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=L,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=o.bE(this);const Fe=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=o.N.transformMat4(Fe,Fe,S),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=L;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const s=this.cameraWorldSizeForFog,c=this.cameraPixelsPerMeter,m=this._camera.position,x=1/this.height/this._pixelsPerMercatorPixel,v=[s,s,c];o.N.scale(v,v,x),o.N.scale(m,m,-1),o.N.multiply(m,m,v);const S=o.a6.create();o.a6.translate(S,S,m),o.a6.scale(S,S,v),this.mercatorFogMatrix=S,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(s,c,x)}_computeCameraPosition(s){const c=(s=s||this.pixelsPerMeter)/this.pixelsPerMeter,m=this._camera.forward(),x=this.point,v=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*c-s/this.worldSize*this._centerAltitude;return[x.x/this.worldSize-m[0]*v,x.y/this.worldSize-m[1]*v,s/this.worldSize*this._centerAltitude-m[2]*v]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(s){const c=this._maxCameraBoundsDistance()*Math.cos(this._pitch),m=this._camera.position[2],x=s[2];let v=1;this.projection.wrap&&(this.center=this.center.wrap()),x>0&&(v=Math.min((c-m)/x,1)),this._camera.position=o.N.scaleAndAdd([],this._camera.position,s,v),this._updateStateFromCamera()}_updateStateFromCamera(){const s=this._camera.position,c=this._camera.forward(),{pitch:m,bearing:x}=this._camera.getPitchBearing(),v=o.bl(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,S=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.bj(this._maxPitch)),C=Math.max((s[2]-v)/Math.cos(m),S),I=this._zoomFromMercatorZ(C);o.N.scaleAndAdd(s,s,c,C),this._pitch=o.aa(m,o.bj(this.minPitch),o.bj(this.maxPitch)),this.angle=o.bh(x,-Math.PI,Math.PI),this._setZoom(o.aa(I,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new o.L(s[0],s[1],s[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(s){return Math.pow(2,s)*this.tileSize}_mercatorZfromZoom(s){return this.cameraToCenterDistance/this._worldSizeFromZoom(s)}_minimumHeightOverTerrain(){const s=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(s)}_zoomFromMercatorZ(s){return this.scaleZoom(this.cameraToCenterDistance/(s*this.tileSize))}zoomFromMercatorZAdjusted(s){let c=0,m=o.bx,x=0,v=1/0;for(;m-c>1e-6&&m>c;){const S=c+.5*(m-c),C=this.tileSize*Math.pow(2,S),I=this.getCameraToCenterDistance(this.projection,S,C),D=this.scaleZoom(I/(s*this.tileSize)),L=Math.abs(S-D);L<v&&(v=L,x=S),S<D?c=S:m=S}return x}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(s,c){const m=Math.min(s.x,c.x),x=Math.max(s.x,c.x),v=Math.min(s.y,c.y),S=Math.max(s.y,c.y);if(v<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const C=[new o.P(m,v),new o.P(x,S),new o.P(m,S),new o.P(x,v)],I=this.renderWorldCopies?-3:0,D=this.renderWorldCopies?4:1;for(const L of C){const N=this.pointRayIntersection(L);if(N.t<0)return!0;const H=this.rayIntersectionCoordinate(N);if(H.x<I||H.y<0||H.x>D||H.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.bF(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.P(0,0),new o.P(this.width,this.height))}zoomDeltaToMovement(s,c){const m=o.N.length(o.N.sub([],this._camera.position,s)),x=this._zoomFromMercatorZ(m)+c;return m-this._mercatorZfromZoom(x)}getCameraPoint(){if(this.projection.name==="globe"){const s=function([c,m,x],v){const S=[c,m,x,1];o.a7.transformMat4(S,S,v);const C=S[3]=Math.max(S[3],1e-6);return S[0]/=C,S[1]/=C,S[2]/=C,S}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new o.P(s[0],s[1])}{const s=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(0,s))}}getCameraToCenterDistance(s,c=this.zoom,m=this.worldSize){const x=o.bA(s,c,this.width,this.height,1024),v=s.pixelSpaceConversion(this.center.lat,m,x);let S=.5/Math.tan(.5*this._fov)*this.height*v;return this.isOrthographic&&(S=Nc(1,S,th(this.pitch>=15?1:this.pitch/15))),S}getWorldToCameraMatrix(){const s=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&o.a6.multiply(s,s,this.globeMatrix),s}getFrustum(s){return o.bq.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,s,this.projection.zAxisUnit==="meters")}}const Ki={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,ShadowMap0:10},sl=(p,s)=>{if(s>0&&p.terrain&&o.w("Cutoff is currently disabled on terrain"),s<=0||p.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const c=p.transform,m=Math.max(Math.abs(c._zoom-(p.minCutoffZoom-1)),1),x=c.isLODDisabled(!1)?o.O(60,45,c.pitch):o.O(30,15,c.pitch),v=c._farZ-c._nearZ,S=s*c.height,C=((1-(I=x))*c.cameraToCenterDistance+I*(c._farZ+S))*m;var I;return{shouldRenderCutoff:x<1,uniformValues:{u_cutoff_params:[c._nearZ,c._farZ,(C-c._nearZ)/v,(C-S-c._nearZ)/v]}}},ya={cascadeCount:2,shadowMapResolution:2048};class Zp{constructor(s,c){this.aabb=s,this.lastCascade=c}}class m_{add(s,c){const m=this.receivers[s.key];m!==void 0?(m.aabb.min[0]=Math.min(m.aabb.min[0],c.min[0]),m.aabb.min[1]=Math.min(m.aabb.min[1],c.min[1]),m.aabb.min[2]=Math.min(m.aabb.min[2],c.min[2]),m.aabb.max[0]=Math.max(m.aabb.max[0],c.max[0]),m.aabb.max[1]=Math.max(m.aabb.max[1],c.max[1]),m.aabb.max[2]=Math.max(m.aabb.max[2],c.max[2])):this.receivers[s.key]=new Zp(c,null)}clear(){this.receivers={}}get(s){return this.receivers[s.key]}computeRequiredCascades(s,c,m){const x=o.bS.fromPoints(s.points);let v=0;for(const S in this.receivers){const C=this.receivers[S];if(!C||!x.intersectsAabb(C.aabb))continue;C.aabb.min=x.closestPoint(C.aabb.min),C.aabb.max=x.closestPoint(C.aabb.max);const I=C.aabb.getCorners();for(let D=0;D<m.length;D++){let L=!0;for(const N of I){const H=[N[0]*c,N[1]*c,N[2]];if(o.N.transformMat4(H,H,m[D].matrix),H[0]<-1||H[0]>1||H[1]<-1||H[1]>1){L=!1;break}}if(C.lastCascade=D,v=Math.max(v,D),L)break}}return v+1}}class Xp{constructor(s){this.painter=s,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new m_,this._depthMode=new _r(s.context.gl.LEQUAL,_r.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this.useNormalOffset=!1,s.tp.registerParameter(ya,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),s.tp.registerParameter(ya,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32})}destroy(){for(const s of this._cascades)s.texture.destroy(),s.framebuffer.destroy();this._cascades=[]}updateShadowParameters(s,c){const m=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!c||!c.properties)return;const x=c.properties.get("shadow-intensity");if(!c.shadowsEnabled()||x<=0||(this._shadowLayerCount=m.style.order.reduce((te,ee)=>{const ne=m.style._mergedLayers[ee];return te+(ne.hasShadowPass()&&!ne.isHidden(s.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this._enabled))return;const v=m.context,S=ya.shadowMapResolution,C=ya.shadowMapResolution;if(this._cascades.length===0||ya.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let te=0;te<ya.cascadeCount;++te){const ee=m._shadowMapDebug,ne=v.gl,K=v.createFramebuffer(S,C,ee,"texture"),ae=new o.T(v,{width:S,height:C,data:null},ne.DEPTH_COMPONENT);if(K.depthAttachment.set(ae.texture),ee){const xe=new o.T(v,{width:S,height:C,data:null},ne.RGBA);K.colorAttachment.set(xe.texture)}this._cascades.push({framebuffer:K,texture:ae,matrix:[],far:0,boundingSphereRadius:0,frustum:new o.bq,scale:0})}}this.shadowDirection=Rf(c);let I=0;if(s.elevation){const te=s.elevation,ee=[1e4,-1e4];te.visibleDemTiles.filter(ne=>ne.dem).forEach(ne=>{const K=ne.dem.tree;ee[0]=Math.min(ee[0],K.minimums[0]),ee[1]=Math.max(ee[1],K.maximums[0])}),ee[0]!==1e4&&(I=(ee[1]-ee[0])*te.exaggeration())}const D=1.5*s.cameraToCenterDistance,L=3*D,N=new Float64Array(16);for(let te=0;te<this._cascades.length;++te){const ee=this._cascades[te];let ne=s.height/50,K=1;ya.cascadeCount===1?K=L:te===0?K=D:(ne=D,K=L);const[ae,xe]=g_(s,this.shadowDirection,ne,K,ya.shadowMapResolution,I);ee.scale=s.scale,ee.matrix=ae,ee.boundingSphereRadius=xe,o.a6.invert(N,ee.matrix),ee.frustum=o.bq.fromInvProjectionMatrix(N,1,0,!0),ee.far=K}const H=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[H].far,this._cascades[H].far],this._uniformValues.u_shadow_intensity=x,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/ya.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=ya.shadowMapResolution,this._uniformValues.u_shadowmap_0=Ki.ShadowMap0,this._uniformValues.u_shadowmap_1=Ki.ShadowMap0+1,this._groundShadowTiles=m.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const W=m.transform.elevation;for(const te of this._groundShadowTiles){let ee={min:0,max:0};if(W){const ne=W.getMinMaxForTile(te);ne&&(ee=ne)}this.addShadowReceiver(te.toUnwrapped(),ee.min,ee.max)}}get enabled(){return this._enabled}set enabled(s){this._enabled=s}drawShadowPass(s,c){if(!this._enabled)return;const m=this.painter,x=m.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(m.transform.getFrustum(0),m.transform.worldSize,this._cascades),x.viewport.set([0,0,ya.shadowMapResolution,ya.shadowMapResolution]);for(let v=0;v<this._numCascadesToRender;++v){m.currentShadowCascade=v,x.bindFramebuffer.set(this._cascades[v].framebuffer.framebuffer),x.clear({color:o.ax.white,depth:1});for(const S of s.order){const C=s._mergedLayers[S];if(!C.hasShadowPass()||C.isHidden(m.transform.zoom))continue;const I=s.getLayerSourceCache(C),D=I?c[I.id]:void 0;(C.type==="model"||D&&D.length)&&m.renderLayer(m,I,C,D)}}m.currentShadowCascade=0}drawGroundShadows(){if(!this._enabled)return;const s=this.painter,c=s.style,m=s.context,x=c.directionalLight,v=c.ambientLight;if(!x||!v)return;const S=[],C=sl(s,s.longestCutoffRange);C.shouldRenderCutoff&&S.push("RENDER_CUTOFF");const I=nh(x,v),D=new _r(m.gl.LEQUAL,_r.ReadOnly,s.depthRangeFor3D);for(const L of this._groundShadowTiles){const N=L.toUnwrapped(),H=s.isTileAffectedByFog(L),W=s.getOrCreateProgram("groundShadow",{defines:S,overrideFog:H});this.setupShadows(N,W),s.uploadCommonUniforms(m,W,N,null,C);const te={u_matrix:s.transform.calculateProjMatrix(N),u_ground_shadow_factor:I};W.draw(s,m.gl.TRIANGLES,D,Cr.disabled,jr.multiply,xr.disabled,te,"ground_shadow",s.tileExtentBuffer,s.quadTriangleIndexBuffer,s.tileExtentSegments,{},s.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?jr.unblended:jr.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(s){const c=this.painter.transform,m=c.calculatePosMatrix(s,c.worldSize);return o.a6.multiply(m,this._cascades[this.painter.currentShadowCascade].matrix,m),Float32Array.from(m)}calculateShadowPassMatrixFromMatrix(s){return o.a6.multiply(s,this._cascades[this.painter.currentShadowCascade].matrix,s),Float32Array.from(s)}setupShadows(s,c,m,x=0){if(!this._enabled)return;const v=this.painter.transform,S=this.painter.context,C=S.gl,I=this._uniformValues,D=new Float64Array(16),L=v.calculatePosMatrix(s,v.worldSize);for(let N=0;N<this._cascades.length;N++)o.a6.multiply(D,this._cascades[N].matrix,L),I[N===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(D),S.activeTexture.set(C.TEXTURE0+Ki.ShadowMap0+N),this._cascades[N].texture.bind(C.NEAREST,C.CLAMP_TO_EDGE);if(this.useNormalOffset=!!m,this.useNormalOffset){const N=o.bR(s.canonical),H=2/v.tileSize*o.V/ya.shadowMapResolution,W=H*this._cascades[0].boundingSphereRadius,te=H*this._cascades[this._cascades.length-1].boundingSphereRadius,ee=(m==="vector-tile"?1:3)/Math.pow(2,x-s.canonical.z-(1-v.zoom+Math.floor(v.zoom)));I.u_shadow_normal_offset=[N,W*ee,te*ee],I.u_shadow_bias=[6e-5,.0012,.012]}else I.u_shadow_bias=[36e-5,.0012,.012];c.setShadowUniformValues(S,I)}setupShadowsFromMatrix(s,c,m=!1){if(!this._enabled)return;const x=this.painter.context,v=x.gl,S=this._uniformValues,C=new Float64Array(16);for(let I=0;I<ya.cascadeCount;I++)o.a6.multiply(C,this._cascades[I].matrix,s),S[I===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(C),x.activeTexture.set(v.TEXTURE0+Ki.ShadowMap0+I),this._cascades[I].texture.bind(v.NEAREST,v.CLAMP_TO_EDGE);this.useNormalOffset=m,m?(S.u_shadow_normal_offset=[1,5,5],S.u_shadow_bias=[6e-5,.0012,.012]):S.u_shadow_bias=[36e-5,.0012,.012],c.setShadowUniformValues(x,S)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(s,c,m,x){if(x[2]>=0)return{};const v=function(I,D,L){const N=L/(1<<I.canonical.z);return new o.bS([I.canonical.x*N+I.wrap*L,I.canonical.y*N+I.wrap*L,0],[(I.canonical.x+1)*N+I.wrap*L,(I.canonical.y+1)*N+I.wrap*L,D])}(s,c,m).getCorners(),S=c/-x[2];x[0]<0?(o.N.add(v[0],v[0],[x[0]*S,0,0]),o.N.add(v[3],v[3],[x[0]*S,0,0])):x[0]>0&&(o.N.add(v[1],v[1],[x[0]*S,0,0]),o.N.add(v[2],v[2],[x[0]*S,0,0])),x[1]<0?(o.N.add(v[0],v[0],[0,x[1]*S,0]),o.N.add(v[1],v[1],[0,x[1]*S,0])):x[1]>0&&(o.N.add(v[2],v[2],[0,x[1]*S,0]),o.N.add(v[3],v[3],[0,x[1]*S,0]));const C={};return C.vertices=v,C.planes=[Hl(v[1],v[0],v[4]),Hl(v[2],v[1],v[5]),Hl(v[3],v[2],v[6]),Hl(v[0],v[3],v[7])],C}addShadowReceiver(s,c,m){this._receivers.add(s,o.bS.fromTileIdAndHeight(s,c,m))}getMaxCascadeForTile(s){const c=this._receivers.get(s);return c&&c.lastCascade?c.lastCascade:0}}function Hl(p,s,c){const m=o.N.sub([],c,s),x=o.N.sub([],p,s),v=o.N.cross([],m,x),S=o.N.length(v);return S===0?[0,0,1,0]:(o.N.scale(v,v,1/S),[v[0],v[1],v[2],-o.N.dot(v,s)])}function Rf(p){const s=p.properties.get("direction"),c=o.bQ(s.x,s.y,s.z);c[2]=o.aa(c[2],0,75);const m=o.bT([c[0],c[1],c[2]]);return o.N.fromValues(m.x,m.y,m.z)}function nh(p,s){const c=p.properties.get("color"),m=p.properties.get("intensity"),x=p.properties.get("direction"),v=[x.x,x.y,x.z],S=s.properties.get("color"),C=s.properties.get("intensity"),I=Math.max(o.N.dot([0,0,1],v),0),D=[0,0,0];o.N.scale(D,S.toArray01Linear().slice(0,3),C);const L=[0,0,0];return o.N.scale(L,c.toArray01Linear().slice(0,3),I*m),o.bU([D[0]>0?D[0]/(D[0]+L[0]):0,D[1]>0?D[1]/(D[1]+L[1]):0,D[2]>0?D[2]/(D[2]+L[2]):0])}function g_(p,s,c,m,x,v){const S=p.zoom,C=p.scale,I=p.worldSize,D=1/I,L=p.aspect,N=Math.sqrt(1+L*L)*Math.tan(.5*p.fovX),H=N*N,W=m-c,te=m+c;let ee,ne;H>W/te?(ee=m,ne=m*N):(ee=.5*te*(1+H),ne=.5*Math.sqrt(W*W+2*(m*m+c*c)*H+te*te*H*H));const K=p.projection.pixelsPerMeter(p.center.lat,I),ae=p._camera.getCameraToWorldMercator(),xe=[0,0,-ee*D];o.N.transformMat4(xe,xe,ae);let ue=ne*D;const ye=p._edgeInsets;if(!(ye.left===0&&ye.top===0&&ye.right===0&&ye.bottom===0||ye.left===ye.right&&ye.top===ye.bottom)){const Ut=p._camera.getWorldToCamera(p.worldSize,p.projection.zAxisUnit==="meters"?K:1),Bt=p._camera.getCameraToClipPerspective(p._fov,p.width/p.height,c,m);Bt[8]=2*-p.centerOffset.x/p.width,Bt[9]=2*p.centerOffset.y/p.height;const Yt=new Float64Array(16);o.a6.mul(Yt,Bt,Ut);const or=new Float64Array(16);o.a6.invert(or,Yt);const pr=o.bq.fromInvProjectionMatrix(or,I,S,!0);for(const ur of pr.points){const fr=((ie=ur)[0]/=C,ie[1]/=C,ie[2]=o.bl(ie[2],p._center.lat),ie);ue=Math.max(ue,o.N.len(o.N.subtract([],xe,fr)))}}var ie;ue*=x/(x-1);const ve=Math.acos(s[2]),Pe=Math.atan2(-s[0],-s[1]),Fe=new Oc;Fe.position=xe,Fe.setPitchBearing(ve,Pe);const $e=Fe.getWorldToCamera(I,K),nt=ue*I,Ge=Math.min(p._mercatorZfromZoom(17)*I*-2,-2*nt),ft=Fe.getCameraToClipOrthographic(-nt,nt,-nt,nt,Ge,(nt+v*K)/s[2]),ct=new Float64Array(16);o.a6.multiply(ct,ft,$e);const Ct=o.N.fromValues(Math.floor(1e6*xe[0])/1e6*I,Math.floor(1e6*xe[1])/1e6*I,0),qe=.5*x,ot=[0,0,0];o.N.transformMat4(ot,Ct,ct),o.N.scale(ot,ot,qe);const Ue=[Math.floor(ot[0]),Math.floor(ot[1]),Math.floor(ot[2])],Qe=[0,0,0];o.N.sub(Qe,ot,Ue),o.N.scale(Qe,Qe,-1/qe);const Mt=new Float64Array(16);return o.a6.identity(Mt),o.a6.translate(Mt,Mt,Qe),o.a6.multiply(ct,Mt,ct),[ct,nt]}const ol=(p,s)=>kt(p,s&&s.filter(c=>c.identifier!=="source.canvas")),__=o.ac(Qr,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),zc=o.ac(Qr,["setCenter","setZoom","setBearing","setPitch"]),Yp={version:8,layers:[],sources:{}},x_={duration:300,delay:0},kv=new Set(["fill","line","background","hillshade","raster"]);class Cs extends o.E{constructor(s,c={}){super(),this.map=s,this.scope=c.scope||"",this.fragments=[],this.importDepth=c.importDepth||0,this.importsCache=c.importsCache||new Map,this.resolvedImports=c.resolvedImports||new Set,this.transition=o.e({},x_),this._buildingIndex=new l_(this),this.crossTileSymbolIndex=new Wp,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=c.styleChanges||new Je,this.dispatcher=c.dispatcher?c.dispatcher:new o.bW(o.bX(),this),c.imageManager?this.imageManager=c.imageManager:(this.imageManager=new Lt,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=c.glyphManager?c.glyphManager:new o.bY(s._requestManager,c.localFontFamily?o.bZ.all:c.localIdeographFontFamily?o.bZ.ideographs:o.bZ.none,c.localFontFamily||c.localIdeographFontFamily),c.modelManager?this.modelManager=c.modelManager:(this.modelManager=new rt(s._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=c.configOptions?c.configOptions:new Map,this._configDependentLayers=c.configDependentLayers?c.configDependentLayers:new Set,this._config=c.config,this.dispatcher.broadcast("setReferrer",o.b_());const m=this;this._rtlTextPluginCallback=Cs.registerForPluginStateChange(x=>{m.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:x.pluginStatus,pluginURL:x.pluginURL},(v,S)=>{if(o.b$(v),S&&S.every(C=>C))for(const C in m._sourceCaches){const I=m._sourceCaches[C],D=I.getSource().type;D!=="vector"&&D!=="geojson"||I.reload()}})}),this.on("data",x=>{if(x.dataType!=="source"||x.sourceDataType!=="metadata")return;const v=this.getOwnSource(x.sourceId);if(v&&v.vectorLayerIds)for(const S in this._layers){const C=this._layers[S];C.source===v.id&&this._validateLayer(C)}})}loadURL(s,c={}){this.fire(new o.b("dataloading",{dataType:"style"}));const m=typeof c.validate=="boolean"?c.validate:!o.c0(s);s=this.map._requestManager.normalizeStyleURL(s,c.accessToken),this.resolvedImports.add(s);const x=this.importsCache.get(s);if(x)return this._load(x,m);const v=this.map._requestManager.transformRequest(s,o.R.Style);this._request=o.g(v,(S,C)=>{if(this._request=null,S)this.fire(new o.a(S));else if(C)return this.importsCache.set(s,C),this._load(C,m)})}loadJSON(s,c={}){this.fire(new o.b("dataloading",{dataType:"style"})),this._request=o.f.frame(()=>{this._request=null,this._load(s,c.validate!==!1)})}loadEmpty(){this.fire(new o.b("dataloading",{dataType:"style"})),this._load(Yp,!1)}_loadImports(s,c,m){if(this.importDepth>=4)return o.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const x=[];for(const v of s){const S=this._createFragmentStyle(v),C=new Promise(L=>{S.once("style.import.load",L),S.once("error",L)}).then(()=>this.mergeAll());if(x.push(C),this.resolvedImports.has(v.url)){S.loadEmpty();continue}const I=v.data||this.importsCache.get(v.url);I?S.loadJSON(I,{validate:c}):v.url?S.loadURL(v.url,{validate:c}):S.loadEmpty();const D={style:S,id:v.id,config:v.config};if(m){const L=this.fragments.findIndex(({id:N})=>N===m);this.fragments=this.fragments.slice(0,L).concat(D).concat(this.fragments.slice(L))}else this.fragments.push(D)}return Promise.allSettled(x)}_createFragmentStyle(s){const c=this.scope?o.ag(s.id,this.scope):s.id,m=new Cs(this.map,{scope:c,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:s.config,configOptions:this.options,configDependentLayers:this._configDependentLayers});return m.setEventedParent(this.map,{style:m}),m}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options});const s=this.isRootStyle();this._shouldPrecompile=s,this.fire(new o.b(s?"style.load":"style.import.load"))}_load(s,c){const m=s.schema;if(this.isRootStyle()&&(s.fragment||m&&s.fragment!==!1)){const S=o.e({},Yp,{imports:[{id:"basemap",data:s,url:""}]});return void this._load(S,c)}if(this.setConfig(this._config,m),c&&ol(this,Mn(s)))return;this._loaded=!0,this.stylesheet=o.c1(s);for(const S in s.sources)this.addSource(S,s.sources[S],{validate:!1,isInitialLoad:!0});s.sprite?this._loadSprite(s.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(s.glyphs,this.scope);const x=c_(this.stylesheet.layers);if(this._order=x.map(S=>S.id),this.stylesheet.light&&o.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const S=this.stylesheet.lights[0];this.light=new Wt(S.properties,S.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Wt(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const S of x){const C=o.c2(S,this.scope,this.options);C.isConfigDependent&&this._configDependentLayers.add(C.fqid),C.setEventedParent(this,{layer:{id:C.id}}),this._layers[C.id]=C,this._serializedLayers[C.id]=C.serialize();const I=this.getOwnLayerSourceCache(C),D=!!this.directionalLight&&this.directionalLight.shadowsEnabled();I&&C.canCastShadows()&&D&&(I.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const v=this.stylesheet.terrain;v&&(this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=o.f.hasCanvasFingerprintNoise()),this.disableElevatedTerrain?o.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."):this.terrainSetForDrapingOnly()||this._createTerrain(v,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new o.b("data",{dataType:"style"})),s.imports?this._loadImports(s.imports,c).then(()=>this._reloadImports()):this._reloadImports()}isRootStyle(){return this.importDepth===0}mergeAll(){let s,c,m,x,v,S,C,I;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(D=>{if(D.stylesheet){if(D.light!=null&&(s=D.light),D.stylesheet.lights)for(const L of D.stylesheet.lights)L.type==="ambient"&&D.ambientLight!=null&&(c=D.ambientLight),L.type==="directional"&&D.directionalLight!=null&&(m=D.directionalLight);x=this._prioritizeTerrain(x,D.terrain,D.stylesheet.terrain),D.stylesheet.fog&&D.fog!=null&&(v=D.fog),D.stylesheet.camera!=null&&(I=D.stylesheet.camera),D.stylesheet.projection!=null&&(S=D.stylesheet.projection),D.stylesheet.transition!=null&&(C=D.stylesheet.transition)}}),this.light=s,this.ambientLight=c,this.directionalLight=m,this.fog=v,x===null?delete this.terrain:this.terrain=x,this.camera=I||{"camera-projection":"perspective"},this.projection=S||{name:"mercator"},this.transition=o.e({},x_,C),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(s){const c=m=>{for(const x of m.fragments)c(x.style);s(m)};c(this)}_prioritizeTerrain(s,c,m){const x=s&&s.drapeRenderMode===0;return m===null?c&&c.drapeRenderMode===0?c:x?s:null:c!=null&&(!s||x||c&&c.drapeRenderMode===1)?c:s}mergeTerrain(){let s;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(c=>{s=this._prioritizeTerrain(s,c.terrain,c.stylesheet.terrain)}),s===null?delete this.terrain:this.terrain=s}mergeProjection(){let s;this.forEachFragmentStyle(c=>{c.stylesheet.projection!=null&&(s=c.stylesheet.projection)}),this.projection=s||{name:"mercator"}}mergeSources(){const s={},c={},m={};this.forEachFragmentStyle(x=>{for(const v in x._sourceCaches){const S=o.ag(v,x.scope);s[S]=x._sourceCaches[v]}for(const v in x._otherSourceCaches){const S=o.ag(v,x.scope);c[S]=x._otherSourceCaches[v]}for(const v in x._symbolSourceCaches){const S=o.ag(v,x.scope);m[S]=x._symbolSourceCaches[v]}}),this._mergedSourceCaches=s,this._mergedOtherSourceCaches=c,this._mergedSymbolSourceCaches=m}mergeLayers(){const s={},c=[],m={};this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(v=>{for(const S of v._order){const C=v._layers[S];if(C.type==="slot"){const I=o.c3(S);if(s[I])continue;s[I]=[]}C.slot&&s[C.slot]?s[C.slot].push(C):c.push(C)}}),this._mergedOrder=[];const x=(v=[])=>{for(const S of v)if(S.type==="slot"){const C=o.c3(S.id);s[C]&&x(s[C])}else{const C=o.ag(S.id,S.scope);this._mergedOrder.push(C),m[C]=S,S.is3D()&&(this._has3DLayers=!0),S.type==="circle"&&(this._hasCircleLayers=!0),S.type==="symbol"&&(this._hasSymbolLayers=!0)}};x(c),this._mergedLayers=m,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(s){return this.stylesheet.camera=o.e({},this.stylesheet.camera,s),this.camera=this.stylesheet.camera,this}setProjection(s){s?this.stylesheet.projection=s:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(s){this._spriteRequest=function(c,m,x){let v,S,C;const I=o.f.devicePixelRatio>1?"@2x":"";let D=o.g(m.transformRequest(m.normalizeSpriteURL(c,I,".json"),o.R.SpriteJSON),(H,W)=>{D=null,C||(C=H,v=W,N())}),L=o.d(m.transformRequest(m.normalizeSpriteURL(c,I,".png"),o.R.SpriteImage),(H,W)=>{L=null,C||(C=H,S=W,N())});function N(){if(C)x(C);else if(v&&S){const H=o.f.getImageData(S),W={};for(const te in v){const{width:ee,height:ne,x:K,y:ae,sdf:xe,pixelRatio:ue,stretchX:ye,stretchY:ie,content:ve}=v[te],Pe=new o.h({width:ee,height:ne});o.h.copy(H,Pe,{x:K,y:ae},{x:0,y:0},{width:ee,height:ne}),W[te]={data:Pe,pixelRatio:ue,sdf:xe,stretchX:ye,stretchY:ie,content:ve}}x(null,W)}}return{cancel(){D&&(D.cancel(),D=null),L&&(L.cancel(),L=null)}}}(s,this.map._requestManager,(c,m)=>{if(this._spriteRequest=null,c)this.fire(new o.a(c));else if(m)for(const x in m)this.imageManager.addImage(x,this.scope,m[x]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new o.b("data",{dataType:"style"}))})}_validateLayer(s){const c=this.getOwnSource(s.source);if(!c)return;const m=s.sourceLayer;m&&(c.type==="geojson"||c.vectorLayerIds&&c.vectorLayerIds.indexOf(m)===-1)&&this.fire(new o.a(new Error(`Source layer "${m}" does not exist on source "${c.id}" as specified by style layer "${s.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const s in this._sourceCaches)if(!this._sourceCaches[s].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded())return!1;for(const{style:s}of this.fragments)if(!s.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((s,c)=>{const m=this.fragments[c];return m&&m.style&&(s.data=m.style.serialize()),s})}_serializeSources(){const s={};for(const c in this._sourceCaches){const m=this._sourceCaches[c].getSource();s[m.id]||(s[m.id]=m.serialize())}return s}_serializeLayers(s){const c=[];for(const m of s){const x=this._layers[m];x&&x.type!=="custom"&&c.push(x.serialize())}return c}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(const s in this._sourceCaches)if(this._sourceCaches[s].hasTransition())return!0;for(const s in this._layers)if(this._layers[s].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(s){return!!this.terrain&&(typeof s.isLayerDraped=="function"?s.isLayerDraped(this.getLayerSourceCache(s)):kv.has(s.type))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(s){const c=this.getOwnLayer(s);if(c)return c;this.fire(new o.a(new Error(`The layer '${s}' does not exist in the map's style.`)))}_checkSource(s){const c=this.getOwnSource(s);if(c)return c;this.fire(new o.a(new Error(`The source '${s}' does not exist in the map's style.`)))}update(s){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(s),this.directionalLight&&this.directionalLight.recalculate(s);const c=this.calculateLightsBrightness();s.brightness=c||0,c!==this._brightness&&(this._brightness=c,this.dispatcher.broadcast("setBrightness",c));const m=this._changes.isDirty();if(this._changes.isDirty()){const v=this._changes.getLayerUpdatesByScope();for(const S in v){const{updatedIds:C,removedIds:I}=v[S];(C||I)&&this._updateWorkerLayers(S,C,I)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(s),this.light&&this.light.updateTransitions(s),this.ambientLight&&this.ambientLight.updateTransitions(s),this.directionalLight&&this.directionalLight.updateTransitions(s),this.fog&&this.fog.updateTransitions(s),this._changes.reset()}const x={};for(const v in this._mergedSourceCaches){const S=this._mergedSourceCaches[v];x[v]=S.used,S.used=!1,S.tileCoverLift=0}for(const v of this._mergedOrder){const S=this._mergedLayers[v];if(S.recalculate(s,this._availableImages),!S.isHidden(s.zoom)){const C=this.getLayerSourceCache(S);C&&(C.used=!0,C.tileCoverLift=Math.max(C.tileCoverLift,S.tileCoverLift()))}if(!this._precompileDone&&this._shouldPrecompile)for(let C=S.minzoom||0;C<(S.maxzoom||25.5);C++){const I=this.map.painter;if(I){const D=S.getProgramIds();if(!D)continue;for(const L of D){const N=S.getDefaultProgramParams(L,s.zoom);N&&(I.style=this,this.fog&&(I._fogVisible=!0,N.overrideFog=!0,I.getOrCreateProgram(L,N)),I._fogVisible=!1,N.overrideFog=!1,I.getOrCreateProgram(L,N),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(N.overrideRtt=!0,I.getOrCreateProgram(L,N)))}}}}this._shouldPrecompile&&(this._precompileDone=!0);for(const v in x){const S=this._mergedSourceCaches[v];x[v]!==S.used&&S.getSource().fire(new o.b("data",{sourceDataType:"visibility",dataType:"source",sourceId:S.getSource().id}))}this.light&&this.light.recalculate(s),this.terrain&&this.terrain.recalculate(s),this.fog&&this.fog.recalculate(s),this.z=s.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),m&&this.fire(new o.b("data",{dataType:"style"}))}_updateTilesForChangedImages(){const s=this._changes.getUpdatedImages();if(s.length){for(const c in this._sourceCaches)this._sourceCaches[c].reloadTilesForDependencies(["icons","patterns"],s);this._changes.resetUpdatedImages()}}_updateWorkerLayers(s,c,m){const x=this.getFragmentStyle(s);x&&this.dispatcher.broadcast("updateLayers",{layers:c?x._serializeLayers(c):[],scope:s,removedIds:m||[],options:x.options})}setState(s){if(this._checkLoaded(),ol(this,Mn(s)))return!1;(s=o.c1(s)).layers=c_(s.layers);const c=function(x,v){if(!x)return[{command:Qr.setStyle,args:[v]}];let S=[];try{if(!k(x.version,v.version))return[{command:Qr.setStyle,args:[v]}];k(x.center,v.center)||S.push({command:Qr.setCenter,args:[v.center]}),k(x.zoom,v.zoom)||S.push({command:Qr.setZoom,args:[v.zoom]}),k(x.bearing,v.bearing)||S.push({command:Qr.setBearing,args:[v.bearing]}),k(x.pitch,v.pitch)||S.push({command:Qr.setPitch,args:[v.pitch]}),k(x.sprite,v.sprite)||S.push({command:Qr.setSprite,args:[v.sprite]}),k(x.glyphs,v.glyphs)||S.push({command:Qr.setGlyphs,args:[v.glyphs]}),k(x.imports,v.imports)||function(N=[],H=[],W){H=H||[];const te=(N=N||[]).map(rl),ee=H.map(rl),ne=N.reduce(Sf,{}),K=H.reduce(Sf,{}),ae=te.slice();let xe,ue,ye,ie;for(xe=0,ue=0;xe<te.length;xe++)ye=te[xe],K.hasOwnProperty(ye)?ue++:(W.push({command:Qr.removeImport,args:[ye]}),ae.splice(ae.indexOf(ye,ue),1));for(xe=0,ue=0;xe<ee.length;xe++)ye=ee[ee.length-1-xe],ae[ae.length-1-xe]!==ye&&(ne.hasOwnProperty(ye)?(W.push({command:Qr.removeImport,args:[ye]}),ae.splice(ae.lastIndexOf(ye,ae.length-ue),1)):ue++,ie=ae[ae.length-xe],W.push({command:Qr.addImport,args:[K[ye],ie]}),ae.splice(ae.length-xe,0,ye));for(const ve of H){const Pe=ne[ve.id];Pe&&!k(Pe,ve)&&W.push({command:Qr.updateImport,args:[ve.id,ve]})}}(x.imports,v.imports,S),k(x.transition,v.transition)||S.push({command:Qr.setTransition,args:[v.transition]}),k(x.light,v.light)||S.push({command:Qr.setLight,args:[v.light]}),k(x.fog,v.fog)||S.push({command:Qr.setFog,args:[v.fog]}),k(x.projection,v.projection)||S.push({command:Qr.setProjection,args:[v.projection]}),k(x.lights,v.lights)||S.push({command:Qr.setLights,args:[v.lights]}),k(x.camera,v.camera)||S.push({command:Qr.setCamera,args:[v.camera]});const C={},I=[];(function(N,H,W,te){let ee;for(ee in H=H||{},N=N||{})N.hasOwnProperty(ee)&&(H.hasOwnProperty(ee)||Mp(ee,W,te));for(ee in H){if(!H.hasOwnProperty(ee))continue;const ne=H[ee];N.hasOwnProperty(ee)?k(N[ee],ne)||(N[ee].type==="geojson"&&ne.type==="geojson"&&wv(N,H,ee)?W.push({command:Qr.setGeoJSONSourceData,args:[ee,ne.data]}):vv(ee,H,W,te)):Zu(ee,H,W)}})(x.sources,v.sources,I,C);const D=[];x.layers&&x.layers.forEach(N=>{N.source&&C[N.source]?S.push({command:Qr.removeLayer,args:[N.id]}):D.push(N)});let L=x.terrain;L&&C[L.source]&&(S.push({command:Qr.setTerrain,args:[void 0]}),L=void 0),S=S.concat(I),k(L,v.terrain)||S.push({command:Qr.setTerrain,args:[v.terrain]}),function(N,H,W){H=H||[];const te=(N=N||[]).map(rl),ee=H.map(rl),ne=N.reduce(Sf,{}),K=H.reduce(Sf,{}),ae=te.slice(),xe=Object.create(null);let ue,ye,ie,ve,Pe,Fe,$e;for(ue=0,ye=0;ue<te.length;ue++)ie=te[ue],K.hasOwnProperty(ie)?ye++:(W.push({command:Qr.removeLayer,args:[ie]}),ae.splice(ae.indexOf(ie,ye),1));for(ue=0,ye=0;ue<ee.length;ue++)ie=ee[ee.length-1-ue],ae[ae.length-1-ue]!==ie&&(ne.hasOwnProperty(ie)?(W.push({command:Qr.removeLayer,args:[ie]}),ae.splice(ae.lastIndexOf(ie,ae.length-ye),1)):ye++,Fe=ae[ae.length-ue],W.push({command:Qr.addLayer,args:[K[ie],Fe]}),ae.splice(ae.length-ue,0,ie),xe[ie]=!0);for(ue=0;ue<ee.length;ue++)if(ie=ee[ue],ve=ne[ie],Pe=K[ie],!xe[ie]&&!k(ve,Pe))if(k(ve.source,Pe.source)&&k(ve["source-layer"],Pe["source-layer"])&&k(ve.type,Pe.type)){for($e in tl(ve.layout,Pe.layout,W,ie,null,Qr.setLayoutProperty),tl(ve.paint,Pe.paint,W,ie,null,Qr.setPaintProperty),k(ve.slot,Pe.slot)||W.push({command:Qr.setSlot,args:[ie,Pe.slot]}),k(ve.filter,Pe.filter)||W.push({command:Qr.setFilter,args:[ie,Pe.filter]}),k(ve.minzoom,Pe.minzoom)&&k(ve.maxzoom,Pe.maxzoom)||W.push({command:Qr.setLayerZoomRange,args:[ie,Pe.minzoom,Pe.maxzoom]}),ve)ve.hasOwnProperty($e)&&$e!=="layout"&&$e!=="paint"&&$e!=="filter"&&$e!=="metadata"&&$e!=="minzoom"&&$e!=="maxzoom"&&$e!=="slot"&&($e.indexOf("paint.")===0?tl(ve[$e],Pe[$e],W,ie,$e.slice(6),Qr.setPaintProperty):k(ve[$e],Pe[$e])||W.push({command:Qr.setLayerProperty,args:[ie,$e,Pe[$e]]}));for($e in Pe)Pe.hasOwnProperty($e)&&!ve.hasOwnProperty($e)&&$e!=="layout"&&$e!=="paint"&&$e!=="filter"&&$e!=="metadata"&&$e!=="minzoom"&&$e!=="maxzoom"&&$e!=="slot"&&($e.indexOf("paint.")===0?tl(ve[$e],Pe[$e],W,ie,$e.slice(6),Qr.setPaintProperty):k(ve[$e],Pe[$e])||W.push({command:Qr.setLayerProperty,args:[ie,$e,Pe[$e]]}))}else W.push({command:Qr.removeLayer,args:[ie]}),Fe=ae[ae.lastIndexOf(ie)+1],W.push({command:Qr.addLayer,args:[Pe,Fe]})}(D,v.layers,S)}catch(C){console.warn("Unable to compute style diff:",C),S=[{command:Qr.setStyle,args:[v]}]}return S}(this.serialize(),s).filter(x=>!(x.command in zc));if(c.length===0)return!1;const m=c.filter(x=>!(x.command in __));if(m.length>0)throw new Error(`Unimplemented: ${m.map(x=>x.command).join(", ")}.`);return c.forEach(x=>{this[x.command].apply(this,x.args)}),this.stylesheet=s,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(s,c){return this.getImage(s)?this.fire(new o.a(new Error("An image with this name already exists."))):(this.imageManager.addImage(s,this.scope,c),this._afterImageUpdated(s),this)}updateImage(s,c){this.imageManager.updateImage(s,this.scope,c)}getImage(s){return this.imageManager.getImage(s,this.scope)}removeImage(s){return this.getImage(s)?(this.imageManager.removeImage(s,this.scope),this._afterImageUpdated(s),this):this.fire(new o.a(new Error("No image with this name exists.")))}_afterImageUpdated(s){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(s),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new o.b("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(s,c,m={}){return this._checkLoaded(),this._validate($t,`models.${s}`,c,null,m)||(this.modelManager.addModel(s,c,this.scope),this._changes.setDirty()),this}hasModel(s){return this.modelManager.hasModel(s,this.scope)}removeModel(s){return this.hasModel(s)?(this.modelManager.removeModel(s,this.scope),this):this.fire(new o.a(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(s,c,m={}){if(this._checkLoaded(),this.getOwnSource(s)!==void 0)throw new Error(`There is already a source with ID "${s}".`);if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(Nn,`sources.${s}`,c,null,m))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);const x=Si(s,c,this.dispatcher,this);x.scope=this.scope,x.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(x.id),source:x.serialize(),sourceId:x.id}));const v=S=>{const C=(S?"symbol:":"other:")+x.id,I=o.ag(C,this.scope),D=this._sourceCaches[C]=new Ss(I,x,S);(S?this._symbolSourceCaches:this._otherSourceCaches)[x.id]=D,D.onAdd(this.map)};v(!1),c.type!=="vector"&&c.type!=="geojson"||v(!0),x.onAdd&&x.onAdd(this.map),m.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(s){this._checkLoaded();const c=this.getOwnSource(s);if(!c)throw new Error("There is no source with this ID");for(const x in this._layers)if(this._layers[x].source===s)return this.fire(new o.a(new Error(`Source "${s}" cannot be removed while layer "${x}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===s)return this.fire(new o.a(new Error(`Source "${s}" cannot be removed while terrain is using it.`)));const m=this.getOwnSourceCaches(s);for(const x of m){const v=o.c3(x.id);delete this._sourceCaches[v],this._changes.discardSourceCacheUpdate(x.id),x.fire(new o.b("data",{sourceDataType:"metadata",dataType:"source",sourceId:x.getSource().id})),x.setEventedParent(null),x.clearTiles()}return delete this._otherSourceCaches[s],delete this._symbolSourceCaches[s],this.mergeSources(),c.setEventedParent(null),c.onRemove&&c.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(s,c){this._checkLoaded(),this.getOwnSource(s).setData(c),this._changes.setDirty()}getOwnSource(s){const c=this.getOwnSourceCache(s);return c&&c.getSource()}getOwnSources(){const s=[];for(const c in this._otherSourceCaches){const m=this.getOwnSourceCache(c);m&&s.push(m.getSource())}return s}areTilesLoaded(){const s=this._mergedSourceCaches;for(const c in s){const m=s[c]._tiles;for(const x in m){const v=m[x];if(v.state!=="loaded"&&v.state!=="errored")return!1}}return!0}setLights(s){if(this._checkLoaded(),!s)return delete this.ambientLight,void delete this.directionalLight;const c=this._getTransitionParameters();for(const x of s){if(this._validate(gt,"lights",x))return;switch(x.type){case"ambient":if(this.ambientLight){const v=this.ambientLight;v.set(x),v.updateTransitions(c)}else this.ambientLight=new Mi(x,Xi,this.scope,this.options);break;case"directional":if(this.directionalLight){const v=this.directionalLight;v.set(x),v.updateTransitions(c)}else this.directionalLight=new Mi(x,Hn,this.scope,this.options)}}const m=new o.K(this.z||0,c);this.ambientLight&&this.ambientLight.recalculate(m),this.directionalLight&&this.directionalLight.recalculate(m),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const s=this.directionalLight,c=this.ambientLight;if(!s||!c)return;const m=N=>.2126*(N[0]<=.03928?N[0]/12.92:Math.pow((N[0]+.055)/1.055,2.4))+.7152*(N[1]<=.03928?N[1]/12.92:Math.pow((N[1]+.055)/1.055,2.4))+.0722*(N[2]<=.03928?N[2]/12.92:Math.pow((N[2]+.055)/1.055,2.4)),x=s.properties.get("color").toArray01(),v=s.properties.get("intensity"),S=s.properties.get("direction"),C=1-o.bQ(S.x,S.y,S.z)[2]/90,I=m(x)*v*C,D=c.properties.get("color").toArray01(),L=c.properties.get("intensity");return(I+m(D)*L)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const s=[];return this.directionalLight&&s.push(this.directionalLight.get()),this.ambientLight&&s.push(this.ambientLight.get()),s}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(s){if(!s)return this;if(o.c4(s)){const c=o.c5(s),m=this.fragments.find(({id:v})=>v===c);if(!m)throw new Error(`Style import not found: ${s}`);const x=o.c3(s);return m.style.getFragmentStyle(x)}{const c=this.fragments.find(({id:m})=>m===s);if(!c)throw new Error(`Style import not found: ${s}`);return c.style}}getConfigProperty(s,c){const m=this.getFragmentStyle(s);if(!m)return null;const x=o.ag(c,m.scope),v=m.options.get(x),S=v?v.value||v.default:null;return S?S.serialize():null}setConfigProperty(s,c,m){const x=o.r(m);if(x.result!=="success")return void ol(this,x.value);const v=x.value.expression,S=this.getFragmentStyle(s);if(!S)return;const C=o.ag(c,S.scope),I=S.options.get(C);I&&(this.options.set(C,{...I,value:v}),this.updateConfigDependencies())}setConfig(s,c){if(this._config=s,s||c)if(c)for(const m in c){let x,v;const S=o.r(c[m].default);if(S.result==="success"&&(x=S.value.expression),s&&s[m]!==void 0){const H=o.r(s[m]);H.result==="success"&&(v=H.value.expression)}const{minValue:C,maxValue:I,stepValue:D,type:L,values:N}=c[m];if(x){const H=o.ag(m,this.scope);this.options.set(H,{default:x,value:v,minValue:C,maxValue:I,stepValue:D,type:L,values:N})}else this.fire(new o.a(new Error(`No schema defined for config option "${m}".`)))}else this.fire(new o.a(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(const s of this._configDependentLayers){const c=this.getLayer(s);c&&(c.possiblyEvaluateVisibility(),this._updateLayer(c))}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this._changes.setDirty()}addLayer(s,c,m={}){this._checkLoaded();const x=s.id;if(this._layers[x])return void this.fire(new o.a(new Error(`Layer with id "${x}" already exists on this map`)));let v;if(s.type==="custom"){if(ol(this,o.c6(s)))return;v=o.c2(s,this.scope,this.options)}else{if(typeof s.source=="object"&&(this.addSource(x,s.source),s=o.c1(s),s=o.e(s,{source:x})),this._validate(Ne,`layers.${x}`,s,{arrayIndex:-1},m))return;v=o.c2(s,this.scope,this.options),this._validateLayer(v),v.setEventedParent(this,{layer:{id:x}}),this._serializedLayers[v.id]=v.serialize()}v.isConfigDependent&&this._configDependentLayers.add(v.fqid);let S=this._order.length;if(c){const L=this._order.indexOf(c);if(L===-1)return void this.fire(new o.a(new Error(`Layer with id "${c}" does not exist on this map.`)));v.slot===this._layers[c].slot?S=L:o.w(`Layer with id "${c}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(S,0,x),this._layerOrderChanged=!0,this._layers[x]=v;const C=this.getOwnLayerSourceCache(v),I=!!this.directionalLight&&this.directionalLight.shadowsEnabled();C&&v.canCastShadows()&&I&&(C.castsShadows=!0);const D=this._changes.getRemovedLayer(v);if(D&&v.source&&C&&v.type!=="custom"){this._changes.discardLayerRemoval(v);const L=o.ag(v.source,v.scope);D.type!==v.type?this._changes.updateSourceCache(L,"clear"):(this._changes.updateSourceCache(L,"reload"),C.pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map),v.scope=this.scope,this.mergeLayers()}moveLayer(s,c){this._checkLoaded();const m=this._checkLayer(s);if(!m||s===c)return;const x=this._order.indexOf(s);this._order.splice(x,1);let v=this._order.length;if(c){const S=this._order.indexOf(c);if(S===-1)return void this.fire(new o.a(new Error(`Layer with id "${c}" does not exist on this map.`)));m.slot===this._layers[c].slot?v=S:o.w(`Layer with id "${c}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(v,0,s),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(s){this._checkLoaded();const c=this._checkLayer(s);if(!c)return;c.setEventedParent(null);const m=this._order.indexOf(s);this._order.splice(m,1),delete this._layers[s],delete this._serializedLayers[s],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(c.fqid),this._changes.removeLayer(c);const x=this.getOwnLayerSourceCache(c);if(x&&x.castsShadows){let v=!1;for(const S in this._layers)if(this._layers[S].source===c.source&&this._layers[S].canCastShadows()){v=!0;break}x.castsShadows=v}c.onRemove&&c.onRemove(this.map),this.mergeLayers()}getOwnLayer(s){return this._layers[s]}hasLayer(s){return s in this._mergedLayers}hasLayerType(s){for(const c in this._layers)if(this._layers[c].type===s)return!0;return!1}setLayerZoomRange(s,c,m){this._checkLoaded();const x=this._checkLayer(s);x&&(x.minzoom===c&&x.maxzoom===m||(c!=null&&(x.minzoom=c),m!=null&&(x.maxzoom=m),this._updateLayer(x)))}setSlot(s,c){this._checkLoaded();const m=this._checkLayer(s);m&&m.slot!==c&&(m.slot=c,this._updateLayer(m))}setFilter(s,c,m={}){this._checkLoaded();const x=this._checkLayer(s);if(x&&!k(x.filter,c))return c==null?(x.filter=void 0,void this._updateLayer(x)):void(this._validate(et,`layers.${x.id}.filter`,c,{layerType:x.type},m)||(x.filter=o.c1(c),this._updateLayer(x)))}getFilter(s){const c=this._checkLayer(s);if(c)return o.c1(c.filter)}setLayoutProperty(s,c,m,x={}){this._checkLoaded();const v=this._checkLayer(s);if(v&&!k(v.getLayoutProperty(c),m)){if(m!=null&&(!x||x.validate!==!1)&&ol(v,_t.call(Mn,{key:`layers.${s}.layout.${c}`,layerType:v.type,objectKey:c,value:m,styleSpec:o.D,style:{glyphs:!0,sprite:!0}})))return;v.setLayoutProperty(c,m),v.isConfigDependent&&this._configDependentLayers.add(v.fqid),this._updateLayer(v)}}getLayoutProperty(s,c){const m=this._checkLayer(s);if(m)return m.getLayoutProperty(c)}setPaintProperty(s,c,m,x={}){this._checkLoaded();const v=this._checkLayer(s);if(!v||k(v.getPaintProperty(c),m)||m!=null&&(!x||x.validate!==!1)&&ol(v,ut.call(Mn,{key:`layers.${s}.paint.${c}`,layerType:v.type,objectKey:c,value:m,styleSpec:o.D})))return;const S=v.setPaintProperty(c,m);v.isConfigDependent&&this._configDependentLayers.add(v.fqid),S&&this._updateLayer(v),this._changes.updatePaintProperties(v)}getPaintProperty(s,c){const m=this._checkLayer(s);if(m)return m.getPaintProperty(c)}setFeatureState(s,c){this._checkLoaded();const m=s.source,x=s.sourceLayer,v=this._checkSource(m);if(!v)return;const S=v.type;if(S==="geojson"&&x)return void this.fire(new o.a(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(S==="vector"&&!x)return void this.fire(new o.a(new Error("The sourceLayer parameter must be provided for vector source types.")));s.id===void 0&&this.fire(new o.a(new Error("The feature id parameter must be provided.")));const C=this.getOwnSourceCaches(m);for(const I of C)I.setFeatureState(x,s.id,c)}removeFeatureState(s,c){this._checkLoaded();const m=s.source,x=this._checkSource(m);if(!x)return;const v=x.type,S=v==="vector"?s.sourceLayer:void 0;if(v==="vector"&&!S)return void this.fire(new o.a(new Error("The sourceLayer parameter must be provided for vector source types.")));if(c&&typeof s.id!="string"&&typeof s.id!="number")return void this.fire(new o.a(new Error("A feature id is required to remove its specific state property.")));const C=this.getOwnSourceCaches(m);for(const I of C)I.removeFeatureState(S,s.id,c)}getFeatureState(s){this._checkLoaded();const c=s.source,m=s.sourceLayer,x=this._checkSource(c);if(x){if(x.type!=="vector"||m)return s.id===void 0&&this.fire(new o.a(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(c)[0].getFeatureState(m,s.id);this.fire(new o.a(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(s){return this.stylesheet.transition=o.e({},this.stylesheet.transition,s),this.transition=this.stylesheet.transition,this}getTransition(){return o.e({},this.stylesheet.transition)}serialize(){this._checkLoaded();const s=this.getTerrain(),c=s&&this.terrain&&this.terrain.scope===this.scope?s:this.stylesheet.terrain;return o.c7({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:c,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},m=>m!==void 0)}_updateLayer(s){this._changes.updateLayer(s);const c=this.getLayerSourceCache(s),m=o.ag(s.source,s.scope),x=this._changes.getUpdatedSourceCaches();s.source&&!x[m]&&c&&c.getSource().type!=="raster"&&(this._changes.updateSourceCache(m,"reload"),c.pause()),s.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(s){const c=C=>this._mergedLayers[C].type==="fill-extrusion"||this._mergedLayers[C].type==="model",m=this.order,x={},v=[];for(let C=m.length-1;C>=0;C--){const I=m[C];if(c(I)){x[I]=C;for(const D of s){const L=D[I];if(L)for(const N of L)v.push(N)}}}v.sort((C,I)=>I.intersectionZ-C.intersectionZ);const S=[];for(let C=m.length-1;C>=0;C--){const I=m[C];if(c(I))for(let D=v.length-1;D>=0;D--){const L=v[D].feature;if(x[L.layer.id]<C)break;S.push(L),v.pop()}else for(const D of s){const L=D[I];if(L)for(const N of L)S.push(N.feature)}}return S}queryRenderedFeatures(s,c,m){c&&c.filter&&this._validate(et,"queryRenderedFeatures.filter",c.filter,null,c),c.scope=this.scope,c.availableImages=this._availableImages,c.serializedLayers=this._serializedLayers;const x={};if(c&&c.layers){if(!Array.isArray(c.layers))return this.fire(new o.a(new Error("parameters.layers must be an Array."))),[];for(const D of c.layers){const L=this._mergedLayers[D];if(!L)return this.fire(new o.a(new Error(`The layer '${D}' does not exist in the map's style and cannot be queried for features.`))),[];x[L.source]=!0}}const v=[],S=c.serializedLayers||{},C=c&&c.layers?c.layers.some(D=>{const L=this.getLayer(D);return L&&L.is3D()}):this.has3DLayers(),I=Wn.createFromScreenPoints(s,m);for(const D in this._mergedSourceCaches){const L=this._mergedSourceCaches[D].getSource();if(!L||L.scope!==c.scope)continue;const N=this._mergedSourceCaches[D].getSource().id;c.layers&&!x[N]||v.push(kp(this._mergedSourceCaches[D],this._mergedLayers,S,I,c,m,C,!!this.map._showQueryGeometry))}return this.placement&&v.push(function(D,L,N,H,W,te,ee){const ne={},K=te.queryRenderedSymbols(H),ae=[];for(const xe of Object.keys(K).map(Number))ae.push(ee[xe]);ae.sort(Pc);for(const xe of ae){const ue=xe.featureIndex.lookupSymbolFeatures(K[xe.bucketInstanceId],L,xe.bucketIndex,xe.sourceLayerIndex,W.filter,W.layers,W.availableImages,D);for(const ye in ue){const ie=ne[ye]=ne[ye]||[],ve=ue[ye];ve.sort((Pe,Fe)=>{const $e=xe.featureSortOrder;if($e){const nt=$e.indexOf(Pe.featureIndex);return $e.indexOf(Fe.featureIndex)-nt}return Fe.featureIndex-Pe.featureIndex});for(const Pe of ve)ie.push(Pe)}}for(const xe in ne)ne[xe].forEach(ue=>{const ye=ue.feature,ie=N(D[xe]);if(!ie)return;const ve=ie.getFeatureState(ye.layer["source-layer"],ye.id);ye.source=ye.layer.source,ye.layer["source-layer"]&&(ye.sourceLayer=ye.layer["source-layer"]),ye.state=ve});return ne}(this._mergedLayers,S,this.getLayerSourceCache.bind(this),I.screenGeometry,c,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(v)}querySourceFeatures(s,c){c&&c.filter&&this._validate(et,"querySourceFeatures.filter",c.filter,null,c);const m=this.getOwnSourceCaches(s);let x=[];for(const v of m)x=x.concat(wo(v,c));return x}addSourceType(s,c,m){return Cs.getSourceType(s)?m(new Error(`A source type called "${s}" already exists.`)):(Cs.setSourceType(s,c),c.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:s,url:c.workerSourceURL},m):m(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(s,c,m={}){this._checkLoaded();const x=this.light.getLight();let v=!1;for(const C in s)if(!k(s[C],x[C])){v=!0;break}if(!v)return;const S=this._getTransitionParameters();this.light.setLight(s,c,m),this.light.updateTransitions(S)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(s,c=1){if(this._checkLoaded(),!s)return this.terrainSetForDrapingOnly()&&c!==0||delete this.terrain,s===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let m=s;const x=s.source==null;if(c===1){if(typeof m.source=="object"){const C="terrain-dem-src";this.addSource(C,m.source),m=o.c1(m),m=o.e(m,{source:C})}const v=o.e({},m),S={};if(this.terrain&&x){v.source=this.terrain.get().source;const C=this.terrain?this.getFragmentStyle(this.terrain.scope):null;C&&(S.style=C.serialize())}if(this._validate(le,"terrain",v,S))return}if(!this.terrain||this.terrain.scope!==this.scope&&!x||this.terrain&&c!==this.terrain.drapeRenderMode){if(!m)return;this._createTerrain(m,c),this.fire(new o.b("data",{dataType:"style"}))}else{const v=this.terrain,S=v.get();for(const C of Object.keys(o.D.terrain))!m.hasOwnProperty(C)&&o.D.terrain[C].default&&(m[C]=o.D.terrain[C].default);for(const C in s)if(!k(s[C],S[C])){v.set(s,this.options),this.stylesheet.terrain=s;const I=this._getTransitionParameters({duration:0});v.updateTransitions(I),this.fire(new o.b("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(s){const c=this.fog=new Li(s,this.map.transform,this.scope,this.options);this.stylesheet.fog=c.get();const m=this._getTransitionParameters({duration:0});c.updateTransitions(m)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const s of this.map._markers)s._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(s){if(this._checkLoaded(),!s)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const c=this.fog;if(!k(c.get(),s)){c.set(s,this.options),this.stylesheet.fog=c.get();const m=this._getTransitionParameters({duration:0});c.updateTransitions(m)}}else this._createFog(s);this._markersNeedUpdate=!0}_getTransitionParameters(s){return{now:o.f.now(),transition:o.e(this.transition,s)}}updateDrapeFirstLayers(){if(!this.terrain)return;const s=[],c=[];for(const m in this._mergedLayers)this.isLayerDraped(this._mergedLayers[m])?s.push(m):c.push(m);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...s),this._drapedFirstOrder.push(...c)}_createTerrain(s,c){const m=this.terrain=new Hr(s,c,this.scope,this.options);c===1&&(this.stylesheet.terrain=s),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const x=this._getTransitionParameters({duration:0});m.updateTransitions(x)}_force3DLayerUpdate(){for(const s in this._layers){const c=this._layers[s];c.type==="fill-extrusion"&&this._updateLayer(c)}}_forceSymbolLayerUpdate(){for(const s in this._layers){const c=this._layers[s];c.type==="symbol"&&this._updateLayer(c)}}_validate(s,c,m,x,v={}){if(v&&v.validate===!1)return!1;const S=o.e({},this.serialize());return ol(this,s.call(Mn,o.e({key:c,style:S,value:m,styleSpec:o.D},x)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.c8.off("pluginStateChange",this._rtlTextPluginCallback);for(const s in this._mergedLayers)this._mergedLayers[s].setEventedParent(null);for(const s in this._mergedSourceCaches)this._mergedSourceCaches[s].clearTiles(),this._mergedSourceCaches[s].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(s){const c=this.getSourceCaches(s);for(const m of c)m.clearTiles()}clearSources(){for(const s in this._mergedSourceCaches)this._mergedSourceCaches[s].clearTiles()}reloadSource(s){const c=this.getSourceCaches(s);for(const m of c)m.resume(),m.reload()}reloadSources(){for(const s of this.getSources())s.reload&&s.reload()}updateSources(s){let c;this.directionalLight&&(c=Rf(this.directionalLight));for(const m in this._mergedSourceCaches)this._mergedSourceCaches[m].update(s,void 0,void 0,c)}_generateCollisionBoxes(){for(const s in this._sourceCaches){const c=this._sourceCaches[s];c.resume(),c.reload()}}_updatePlacement(s,c,m,x,v=!1){let S=!1,C=!1;const I={},D={};for(const L of this._mergedOrder){const N=this._mergedLayers[L];if(N.type!=="symbol")continue;const H=o.ag(N.source,N.scope);let W=I[H];if(!W){const ee=this.getLayerSourceCache(N);if(!ee)continue;const ne=ee.getRenderableIds(!0).map(K=>ee.getTileByID(K));D[H]=ne.slice(),W=I[H]=ne.sort((K,ae)=>ae.tileID.overscaledZ-K.tileID.overscaledZ||(K.tileID.isLessThan(ae.tileID)?-1:1))}const te=this.crossTileSymbolIndex.addLayer(N,W,s.center.lng,s.projection);S=S||te}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),v=v||this._layerOrderChanged||m===0,this._layerOrderChanged&&this.fire(new o.b("neworder")),(v||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.f.now(),s.zoom))&&(this.pauseablePlacement=new Mf(s,this._mergedOrder,v,c,m,x,this.placement,this.fog&&s.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,I,D),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.f.now()),C=!0),S&&this.pauseablePlacement.placement.setStale()),C||S){this._buildingIndex.onNewFrame(s.zoom);for(const L of this._mergedOrder){const N=this._mergedLayers[L];N.type==="symbol"&&this.placement.updateLayerOpacities(N,I[o.ag(N.source,N.scope)])}}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.f.now())}_releaseSymbolFadeTiles(){for(const s in this._sourceCaches)this._sourceCaches[s].releaseSymbolFadeTiles()}addImport(s,c){this._checkLoaded();const m=this.stylesheet.imports=this.stylesheet.imports||[];if(m.findIndex(({id:v})=>v===s.id)!==-1)return this.fire(new o.a(new Error(`Import with id '${s.id}' already exists in the map's style.`)));if(!c)return m.push(s),this._loadImports([s],!0),this;const x=m.findIndex(({id:v})=>v===c);return x===-1?this.fire(new o.a(new Error(`Import with id "${c}" does not exist on this map.`))):(this.stylesheet.imports=m.slice(0,x).concat(s).concat(m.slice(x)),this._loadImports([s],!0,c),this)}updateImport(s,c){this._checkLoaded();const m=this.stylesheet.imports||[],x=this.getImportIndex(s);return x===-1?this:typeof c=="string"?(this.setImportUrl(s,c),this):(c.url&&c.url!==m[x].url&&this.setImportUrl(s,c.url),k(c.config,m[x].config)||this.setImportConfig(s,c.config),k(c.data,m[x].data)||this.setImportData(s,c.data),this)}moveImport(s,c){this._checkLoaded();let m=this.stylesheet.imports||[];const x=this.getImportIndex(s);if(x===-1)return this;const v=this.getImportIndex(c);if(v===-1)return this;const S=m[x],C=this.fragments[x];return m=m.filter(({id:I})=>I!==s),this.fragments=this.fragments.filter(({id:I})=>I!==s),this.stylesheet.imports=m.slice(0,v).concat(S).concat(m.slice(v)),this.fragments=this.fragments.slice(0,v).concat(C).concat(this.fragments.slice(v)),this.mergeLayers(),this}setImportUrl(s,c){this._checkLoaded();const m=this.stylesheet.imports||[],x=this.getImportIndex(s);if(x===-1)return this;m[x].url=c;const v=this.fragments[x];return v.style=this._createFragmentStyle(m[x]),v.style.on("style.import.load",()=>this.mergeAll()),v.style.loadURL(c),this}setImportData(s,c){this._checkLoaded();const m=this.getImportIndex(s),x=this.stylesheet.imports||[];return m===-1?this:c?(this.fragments[m].style.setState(c),this._reloadImports(),this):(delete x[m].data,this.setImportUrl(s,x[m].url))}setImportConfig(s,c){this._checkLoaded();const m=this.getImportIndex(s),x=this.stylesheet.imports||[];if(m===-1)return this;c?x[m].config=c:delete x[m].config;const v=this.fragments[m],S=v.style.stylesheet&&v.style.stylesheet.schema;return v.config=c,v.style.setConfig(c,S),this.updateConfigDependencies(),this}removeImport(s){this._checkLoaded();const c=this.stylesheet.imports||[],m=this.getImportIndex(s);return m===-1||(c.splice(m,1),this.fragments[m].style._remove(),this.fragments.splice(m,1),this._reloadImports()),this}getImportIndex(s){const c=(this.stylesheet.imports||[]).findIndex(m=>m.id===s);return c===-1&&this.fire(new o.a(new Error(`Import '${s}' does not exist in the map's style and cannot be updated.`))),c}getLayer(s){return this._mergedLayers[s]}getSources(){const s=[];for(const c in this._mergedOtherSourceCaches){const m=this._mergedOtherSourceCaches[c];m&&s.push(m.getSource())}return s}getSource(s,c){const m=this.getSourceCache(s,c);return m&&m.getSource()}getLayerSource(s){const c=this.getLayerSourceCache(s);return c&&c.getSource()}getSourceCache(s,c){const m=o.ag(s,c);return this._mergedOtherSourceCaches[m]}getLayerSourceCache(s){const c=o.ag(s.source,s.scope);return s.type==="symbol"?this._mergedSymbolSourceCaches[c]:this._mergedOtherSourceCaches[c]}getSourceCaches(s){const c=[];return this._mergedOtherSourceCaches[s]&&c.push(this._mergedOtherSourceCaches[s]),this._mergedSymbolSourceCaches[s]&&c.push(this._mergedSymbolSourceCaches[s]),c}updateSourceCaches(){const s=this._changes.getUpdatedSourceCaches();for(const c in s){const m=s[c];m==="reload"?this.reloadSource(c):m==="clear"&&this.clearSource(c)}}updateLayers(s){const c=this._changes.getUpdatedPaintProperties();for(const m of c){const x=this.getLayer(m);x&&x.updateTransitions(s)}}getImages(s,c,m){this.imageManager.getImages(c.icons,c.scope,m),this._updateTilesForChangedImages();const x=v=>{v&&v.setDependencies(c.tileID.key,c.type,c.icons)};x(this._otherSourceCaches[c.source]),x(this._symbolSourceCaches[c.source])}getGlyphs(s,c,m){this.glyphManager.getGlyphs(c.stacks,c.scope,m)}getResource(s,c,m){return o.c9(c,m)}getOwnSourceCache(s){return this._otherSourceCaches[s]}getOwnLayerSourceCache(s){return s.type==="symbol"?this._symbolSourceCaches[s.source]:this._otherSourceCaches[s.source]}getOwnSourceCaches(s){const c=[];return this._otherSourceCaches[s]&&c.push(this._otherSourceCaches[s]),this._symbolSourceCaches[s]&&c.push(this._symbolSourceCaches[s]),c}_isSourceCacheLoaded(s){const c=this.getOwnSourceCaches(s);return c.length===0?(this.fire(new o.a(new Error(`There is no source with ID '${s}'`))),!1):c.every(m=>m.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(s=>{s.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Cs.getSourceType=function(p){return vo[p]},Cs.setSourceType=function(p,s){vo[p]=s},Cs.registerForPluginStateChange=o.bV;var Df=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Ff=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}`,Lf=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,Of="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Kp=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture(u_depth,uv-df.xz)),unpack_depth(texture(u_depth,uv+df.xz)),unpack_depth(texture(u_depth,uv-df.zy)),unpack_depth(texture(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,Jp=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,y_=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Bc=`#ifdef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Uc=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform vec2 u_velocity_res;uniform float u_max_speed;const vec2 INVALID_VELOCITY=vec2(-1);uniform vec2 u_texture_offset;uniform float u_data_offset;uniform vec4 u_data_scale;vec2 lookup_velocity(vec2 uv) {uv=u_texture_offset.x+u_texture_offset.y*uv;vec2 fxy;ivec4 c=_raTexLinearCoord(uv,u_velocity_res,fxy);vec4 tl=texelFetch(u_velocity,c.yz,0);vec4 tr=texelFetch(u_velocity,c.xz,0);vec4 bl=texelFetch(u_velocity,c.yw,0);vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NODATA) {return INVALID_VELOCITY;}if (tr==NODATA) {return INVALID_VELOCITY;}if (bl==NODATA) {return INVALID_VELOCITY;}if (br==NODATA) {return INVALID_VELOCITY;}vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);
#ifdef DATA_FORMAT_UINT32
vec2 velocity=vec2(u_data_offset+dot(t,u_data_scale),0);return velocity;
#else
vec2 velocity=vec2(u_data_offset+dot(t.rg,u_data_scale.yx),-(u_data_offset+dot(t.ba,u_data_scale.yx)));
#endif
return velocity/max(u_max_speed,length(velocity));}
#endif`,Qp=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,ih=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef NATIVE
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Vc=[];ll(Df,Vc),ll(Lf,Vc),ll(Ff,Vc);const Xa={"_prelude_fog.vertex.glsl":Jp,"_prelude_terrain.vertex.glsl":Kp,"_prelude_shadow.vertex.glsl":Qp,"_prelude_fog.fragment.glsl":y_,"_prelude_shadow.fragment.glsl":ih,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Bc,"_prelude_raster_particle.glsl":Uc},$c={};an("",Kp),an(y_,Jp),an(ih,Qp),an(Bc,""),an(Uc,"");const e0=an(Ff,Lf),Nf=Df;var t0={background:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:an("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:an(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:an(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:an("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:an("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:an("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
uniform float u_emissive_strength;in float v_height;void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=max(0.01,cutoff_opacity(u_cutoff_params,ground.z));if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff < 0.01 && centroid_pos.x !=0.0));gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:an(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
out vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:an(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:an(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:an(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trimmed,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 v_uv;
#endif
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float pattern_x=v_linesofar/pattern_size.x*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_ground(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 a_packed;
#endif
in float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec4 v_uv;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
float a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;vec2 uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
vec2 uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:an("precision highp float;uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`precision highp float;
#include "_prelude_raster_array.glsl"
#include "_prelude_raster_particle.glsl"
in vec3 a_pos;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {vec2 pos=a_pos.xy+u_tile_offset;vec2 tex_coords=fract(pos);gl_PointSize=1.0;vec2 velocity=lookup_velocity(tex_coords);if (velocity==INVALID_VELOCITY) {v_particle_speed=0.0;gl_Position=vec4(2.0,2.0,2.0,1.0);} else {v_particle_speed=length(velocity);gl_Position=vec4(2.0*pos-vec2(1.0),0.0,1.0);}}`),rasterParticleTexture:an("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {v_tex_pos=0.5*a_pos+vec2(0.5);gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:an("void main() {}",`#include "_prelude_raster_array.glsl"
#include "_prelude_raster_particle.glsl"
in vec3 a_pos;uniform float u_speed_factor;uniform float u_lifetime_delta;uniform float u_rand_seed;out vec3 v_new_particle;const vec3 rand_constants=vec3(12.9898,78.233,4375.85453);float rand(const vec2 co) {float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {float lifetime=a_pos.z;vec2 pos=a_pos.xy;vec2 uv=clamp(pos,vec2(0.0),vec2(1.0));vec2 velocity=lookup_velocity(uv);float next_lifetime=lifetime-u_lifetime_delta;float t=step(0.0,next_lifetime);
#ifdef DATA_FORMAT_UINT32
vec2 dp=vec2(0);
#else
vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;
#endif
vec2 seed=pos*u_rand_seed;vec2 next_pos=pos+dp;vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));v_new_particle=vec3(
vec2(mix(random_pos,next_pos,t)),mix(1.0,next_lifetime,t)
);}`),symbolIcon:an(`#include "_prelude_lighting.glsl"
uniform sampler2D u_texture;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
in float v_fade_opacity;in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
uniform mediump float u_icon_saturation;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
lowp float alpha=opacity*v_fade_opacity;vec4 out_color;
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b)*alpha;
#else
out_color=texture(u_texture,v_tex_a)*alpha;
#endif
#ifdef SATURATION
vec3 luma=vec3(dot(out_color.rgb,vec3(0.2126,0.7152,0.0722)));out_color.rgb=mix(luma,out_color.rgb,u_icon_saturation);
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
v_tex_a=a_tex/u_texsize;
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
v_fade_opacity=out_fade_opacity;}`),symbolSDF:an(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}`),symbolTextAndIcon:an(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}`),terrainRaster:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:an("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:an(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Of),skyboxGradient:an(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Of),skyboxCapture:an(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:an(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture(u_depthTexture,coord));return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
return vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);color=mix(color,v_color_mix.rgb,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=u_matrix*pos;pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=local_pos;
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1);v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:an(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=u_matrix*pos;
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:an(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`)};function ll(p,s){const c=p.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let m of c)if(m=m.trim(),m[0]==="#"&&m.includes("if")&&!m.includes("endif")){m=m.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const x=m.split(" ");for(const v of x)s.includes(v)||s.push(v)}}function an(p,s){const c=/#include\s+"([^"]+)"/g,m=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let x=s.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);x&&(x=x.map(D=>{const L=D.split(" ");return L[L.length-1]}),x=[...new Set(x)]);const v={},S=[],C=[];if(p=p.replace(c,(D,L)=>(C.push(L),"")),(s=s.replace(c,(D,L)=>(S.push(L),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let I=[...Vc];ll(p,I),ll(s,I);for(const D of[...S,...C])Xa[D]||console.error(`Undefined include: ${D}`),$c[D]||($c[D]=[],ll(Xa[D],$c[D])),I=[...I,...$c[D]];return{fragmentSource:p=p.replace(m,(D,L,N,H,W)=>(v[W]=!0,L==="define"?`
#ifndef HAS_UNIFORM_u_${W}
in ${N} ${H} ${W};
#else
uniform ${N} ${H} u_${W};
#endif
`:L==="initialize"?`
#ifdef HAS_UNIFORM_u_${W}
    ${N} ${H} ${W} = u_${W};
#endif
`:L==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${W}
    in ${N} ${H} ${W};
#endif
`:L==="initialize-attribute"?"":void 0)),vertexSource:s=s.replace(m,(D,L,N,H,W)=>{const te=H==="float"?"vec2":H,ee=W.match(/color/)?"color":te;return L==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${W}
in ${N} ${H} a_${W};
#endif
`:v[W]?L==="define"?`
#ifndef HAS_UNIFORM_u_${W}
uniform lowp float u_${W}_t;
in ${N} ${te} a_${W};
out ${N} ${H} ${W};
#else
uniform ${N} ${H} u_${W};
#endif
`:L==="initialize"?ee==="vec4"?`
#ifndef HAS_UNIFORM_u_${W}
    ${W} = a_${W};
#else
    ${N} ${H} ${W} = u_${W};
#endif
`:`
#ifndef HAS_UNIFORM_u_${W}
    ${W} = unpack_mix_${ee}(a_${W}, u_${W}_t);
#else
    ${N} ${H} ${W} = u_${W};
#endif
`:L==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${W}
    in ${N} ${H} a_${W};
    out ${N} ${H} ${W};
#endif
`:L==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${W}
    ${W} = a_${W};
#endif
`:void 0:L==="define"?`
#ifndef HAS_UNIFORM_u_${W}
uniform lowp float u_${W}_t;
in ${N} ${te} a_${W};
#else
uniform ${N} ${H} u_${W};
#endif
`:L==="define-instanced"?ee==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${W}0;
in vec4 a_${W}1;
in vec4 a_${W}2;
in vec4 a_${W}3;
#else
uniform ${N} ${H} u_${W};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${N} ${te} a_${W};
#else
uniform ${N} ${H} u_${W};
#endif
`:L==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${W}
    ${N} ${H} ${W} = a_${W};
#endif
`:ee==="vec4"?`
#ifndef HAS_UNIFORM_u_${W}
    ${N} ${H} ${W} = a_${W};
#else
    ${N} ${H} ${W} = u_${W};
#endif
`:`
#ifndef HAS_UNIFORM_u_${W}
    ${N} ${H} ${W} = unpack_mix_${ee}(a_${W}, u_${W}_t);
#else
    ${N} ${H} ${W} = u_${W};
#endif
`}),staticAttributes:x,usedDefines:I,vertexIncludes:S,fragmentIncludes:C}}class r0{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(s,c,m,x,v,S,C,I){this.context=s;let D=this.boundPaintVertexBuffers.length!==x.length;for(let N=0;!D&&N<x.length;N++)this.boundPaintVertexBuffers[N]!==x[N]&&(D=!0);let L=this.boundDynamicVertexBuffers.length!==C.length;for(let N=0;!L&&N<C.length;N++)this.boundDynamicVertexBuffers[N]!==C[N]&&(L=!0);if(!this.vao||this.boundProgram!==c||this.boundLayoutVertexBuffer!==m||D||L||this.boundIndexBuffer!==v||this.boundVertexOffset!==S)this.freshBind(c,m,x,v,S,C,I);else{s.bindVertexArrayOES.set(this.vao);for(const N of C)N&&(N.bind(),I&&N.instanceCount&&N.setVertexAttribDivisor(s.gl,c,I));v&&v.dynamicDraw&&v.bind()}}freshBind(s,c,m,x,v,S,C){const I=s.numAttributes,D=this.context,L=D.gl;this.vao&&this.destroy(),this.vao=D.gl.createVertexArray(),D.bindVertexArrayOES.set(this.vao),this.boundProgram=s,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=m,this.boundIndexBuffer=x,this.boundVertexOffset=v,this.boundDynamicVertexBuffers=S,c.enableAttributes(L,s),c.bind(),c.setVertexAttribPointers(L,s,v);for(const N of m)N.enableAttributes(L,s),N.bind(),N.setVertexAttribPointers(L,s,v);for(const N of S)N&&(N.enableAttributes(L,s),N.bind(),N.setVertexAttribPointers(L,s,v),C&&N.instanceCount&&N.setVertexAttribDivisor(L,s,C));x&&x.bind(),D.currentNumAttributes=I}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Mv(p,s){const c=Math.pow(2,s.canonical.z),m=s.canonical.y;return[new o.L(0,m/c).toLngLat().lat,new o.L(0,(m+1)/c).toLngLat().lat]}function zf(p,s,c,m,x,v,S){const C=p.context,I=C.gl,D=c.hillshadeFBO;if(!D)return;p.prepareDrawTile();const L=p.isTileAffectedByFog(s),N=p.getOrCreateProgram("hillshade",{overrideFog:L});C.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,D.colorAttachment.get());const H=((ne,K,ae,xe)=>{const ue=ae.paint.get("hillshade-shadow-color"),ye=ae.paint.get("hillshade-highlight-color"),ie=ae.paint.get("hillshade-accent-color"),ve=ae.paint.get("hillshade-emissive-strength");let Pe=o.bj(ae.paint.get("hillshade-illumination-direction"));if(ae.paint.get("hillshade-illumination-anchor")==="viewport")Pe-=ne.transform.angle;else if(ne.style&&ne.style.enable3dLights()&&ne.style.directionalLight){const $e=ne.style.directionalLight.properties.get("direction"),nt=o.bQ($e.x,$e.y,$e.z);Pe=o.bj(nt[1])}const Fe=!ne.options.moving;return{u_matrix:xe||ne.transform.calculateProjMatrix(K.tileID.toUnwrapped(),Fe),u_image:0,u_latrange:Mv(0,K.tileID),u_light:[ae.paint.get("hillshade-exaggeration"),Pe],u_shadow:ue,u_highlight:ye,u_emissive_strength:ve,u_accent:ie}})(p,c,m,p.terrain?s.projMatrix:null);p.uploadCommonUniforms(C,N,s.toUnwrapped());const{tileBoundsBuffer:W,tileBoundsIndexBuffer:te,tileBoundsSegments:ee}=p.getTileBoundsBuffers(c);N.draw(p,I.TRIANGLES,x,v,S,xr.disabled,H,m.id,W,te,ee)}function v_(p,s,c){if(!s.needsDEMTextureUpload)return;const m=p.context,x=m.gl;m.pixelStoreUnpackPremultiplyAlpha.set(!1),s.demTexture=s.demTexture||p.getTileTexture(c.stride);const v=c.getPixels();s.demTexture?s.demTexture.update(v,{premultiply:!1}):s.demTexture=new o.T(m,v,x.R32F,{premultiply:!1}),s.needsDEMTextureUpload=!1}function n0(p,s,c){const m=p.context,x=m.gl;if(!s.dem)return;const v=s.dem;if(m.activeTexture.set(x.TEXTURE1),v_(p,s,v),!s.demTexture)return;s.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE);const S=v.dim;m.activeTexture.set(x.TEXTURE0);let C=s.hillshadeFBO;if(!C){const H=new o.T(m,{width:S,height:S,data:null},x.RGBA);H.bind(x.LINEAR,x.CLAMP_TO_EDGE),C=s.hillshadeFBO=m.createFramebuffer(S,S,!0,"renderbuffer"),C.colorAttachment.set(H.texture)}m.bindFramebuffer.set(C.framebuffer),m.viewport.set([0,0,S,S]);const{tileBoundsBuffer:I,tileBoundsIndexBuffer:D,tileBoundsSegments:L}=p.getMercatorTileBoundsBuffers(),N=[];p.linearFloatFilteringSupported()&&N.push("TERRAIN_DEM_FLOAT_FORMAT"),p.getOrCreateProgram("hillshadePrepare",{defines:N}).draw(p,x.TRIANGLES,_r.disabled,Cr.disabled,jr.unblended,xr.disabled,((H,W)=>{const te=W.stride,ee=o.a6.create();return o.a6.ortho(ee,0,o.V,-o.V,0,0,1),o.a6.translate(ee,ee,[0,-o.V,0]),{u_matrix:ee,u_image:1,u_dimension:[te,te],u_zoom:H.overscaledZ}})(s.tileID,v),c.id,I,D,L),s.needsHillshadePrepare=!1}const w_=p=>({u_matrix:new o.bK(p),u_image0:new o.bO(p),u_skirt_height:new o.bN(p),u_ground_shadow_factor:new o.bM(p)}),Bf=(p,s,c)=>({u_matrix:p,u_image0:0,u_skirt_height:s,u_ground_shadow_factor:c}),b_=(p,s,c,m,x,v,S,C,I,D,L,N,H,W,te,ee)=>({u_proj_matrix:Float32Array.from(p),u_globe_matrix:s,u_normalize_matrix:Float32Array.from(m),u_merc_matrix:c,u_zoom_transition:x,u_merc_center:v,u_image0:0,u_frustum_tl:S,u_frustum_tr:C,u_frustum_br:I,u_frustum_bl:D,u_globe_pos:L,u_globe_radius:N,u_viewport:H,u_grid_matrix:ee?Float32Array.from(ee):new Float32Array(9),u_skirt_height:W,u_far_z_cutoff:te});function ah(p,s){return p!=null&&s!=null&&!(!p.hasData()||!s.hasData())&&p.demTexture!=null&&s.demTexture!=null&&p.tileID.key!==s.tileID.key}const jc=new class{constructor(){this.operations={}}newMorphing(p,s,c,m,x){if(p in this.operations){const v=this.operations[p];v.to.tileID.key!==c.tileID.key&&(v.queued=c)}else this.operations[p]={startTime:m,phase:0,duration:x,from:s,to:c,queued:null}}getMorphValuesForProxy(p){if(!(p in this.operations))return null;const s=this.operations[p];return{from:s.from,to:s.to,phase:s.phase}}update(p){for(const s in this.operations){const c=this.operations[s];for(c.phase=(p-c.startTime)/c.duration;c.phase>=1||!this._validOp(c);)if(!this._nextOp(c,p)){delete this.operations[s];break}}}_nextOp(p,s){return!!p.queued&&(p.from=p.to,p.to=p.queued,p.queued=null,p.phase=0,p.startTime=s,!0)}_validOp(p){return p.from.hasData()&&p.to.hasData()}},i0={0:null,1:"TERRAIN_VERTEX_MORPHING"};function a0(p,s,c){if(s===0)return 0;const m=s<1&&c===514?.25/s:1;return 6*Math.pow(1.5,22-p)*Math.max(s,1)*m}function Gc(p,s){const c=1<<p.z;return!s&&(p.x===0||p.x===c-1)||p.y===0||p.y===c-1}const s0=p=>({u_matrix:p});function o0(p,s,c,m,x){if(x>0){const v=o.f.now(),S=(v-p.timeAdded)/x,C=s?(v-s.timeAdded)/x:-1,I=c.getSource(),D=m.coveringZoomLevel({tileSize:I.tileSize,roundZoom:I.roundZoom}),L=!s||Math.abs(s.tileID.overscaledZ-D)>Math.abs(p.tileID.overscaledZ-D),N=L&&p.refreshedUponExpiration?1:o.aa(L?S:1-C,0,1);return p.refreshedUponExpiration&&S>=1&&(p.refreshedUponExpiration=!1),s?{opacity:1,mix:1-N}:{opacity:N,mix:0}}return{opacity:1,mix:0}}class Iv extends Ss{constructor(s){const c={type:"raster-dem",maxzoom:s.transform.maxZoom},m=new o.bW(o.bX(),null),x=Si("mock-dem",c,m,s.style);super("mock-dem",x,!1),x.setEventedParent(this),this._sourceLoaded=!0}_loadTile(s,c){s.state="loaded",c(null)}}class Pv extends Ss{constructor(s){const c=Si("proxy",{type:"geojson",maxzoom:s.transform.maxZoom},new o.bW(o.bX(),null),s.style);super("proxy",c,!1),c.setEventedParent(this),this.map=this.getSource().map=s,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(s,c,m){if(s.freezeTileCoverage)return;this.transform=s;const x=s.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((v,S)=>{if(v[S.key]="",!this._tiles[S.key]){const C=new el(S,this._source.tileSize*S.overscaleFactor(),s.tileZoom);C.state="loaded",this._tiles[S.key]=C}return v},{});for(const v in this._tiles)v in x||(this.freeFBO(v),this._tiles[v].unloadVectorData(),delete this._tiles[v])}freeFBO(s){const c=this.proxyCachedFBO[s];if(c!==void 0){const m=Object.values(c);this.renderCachePool.push(...m),delete this.proxyCachedFBO[s]}}deallocRenderCache(){this.renderCache.forEach(s=>s.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class T_ extends o.am{constructor(s,c,m){super(s.overscaledZ,s.wrap,s.canonical.z,s.canonical.x,s.canonical.y),this.proxyTileKey=c,this.projMatrix=m}}class Rv extends o.ck{constructor(s,c){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},s.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),s.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),s.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=s,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[m,x,v]=function(I){const D=new o.aN,L=new o.aw,N=131;D.reserve(17161),L.reserve(33800);const H=o.V/128,W=o.V+H/2,te=W+H;for(let ne=-H;ne<te;ne+=H)for(let K=-H;K<te;K+=H){const ae=K<0||K>W||ne<0||ne>W?24575:0,xe=o.aa(Math.round(K),0,o.V),ue=o.aa(Math.round(ne),0,o.V);D.emplaceBack(xe+ae,ue)}const ee=(ne,K)=>{const ae=K*N+ne;L.emplaceBack(ae+1,ae,ae+N),L.emplaceBack(ae+N,ae+N+1,ae+1)};for(let ne=1;ne<129;ne++)for(let K=1;K<129;K++)ee(K,ne);return[0,129].forEach(ne=>{for(let K=0;K<130;K++)ee(K,ne),ee(ne,K)}),[D,L,32768]}(),S=s.context;this.gridBuffer=S.createVertexBuffer(m,o.aP.members),this.gridIndexBuffer=S.createIndexBuffer(x),this.gridSegments=o.aB.simpleSegment(0,0,m.length,x.length),this.gridNoSkirtSegments=o.aB.simpleSegment(0,0,m.length,v),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Pv(c.map),this.orthoMatrix=o.a6.create(),o.a6.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,o.V,0,o.V,0,1);const C=S.gl;this._overlapStencilMode=new Cr({func:C.GEQUAL,mask:255},0,255,C.KEEP,C.KEEP,C.REPLACE),this._previousZoom=s.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=c,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Iv(c.map),this._pendingGroundEffectLayers=[]}set style(s){s.on("data",this._onStyleDataEvent.bind(this)),this._style=s,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(s,c,m){if(s&&s.terrain){this._style!==s&&(this.style=s,this._evaluationZoom=void 0);const x=s.terrain.properties,v=s.terrain.drapeRenderMode===0,S=s.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=o.f.now();const C=s.terrain&&s.terrain.scope,I=x.get("source"),D=v?this._mockSourceCache:s.getSourceCache(I,C);if(!D)return void o.w(`Couldn't find terrain source "${I}".`);if(this.sourceCache=D,this._exaggeration=S?this.calculateExaggeration(c):x.get("exaggeration"),!c.projection.requiresDraping&&S&&this._exaggeration===0)return void this._disable();this.enabled=!0;const L=()=>{this.sourceCache.used&&o.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const N=this.getScaledDemTileSize();this.sourceCache.update(c,N,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,L(),this._initializing=!0),L(),c.updateElevation(!0,m),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(c),this._emptyDEMTextureDirty=!0,this._previousZoom=c.zoom}else this._disable()}calculateExaggeration(s){const c=this._previousCameraAltitude,m=s.getFreeCameraOptions().position.z/s.pixelsPerMeter*s.worldSize;this._previousCameraAltitude=m;const x=c!=null?m-c:Number.MAX_VALUE;if(Math.abs(x)<2)return this._exaggeration;const v=s.zoom,S=this._style.terrain;if(!this._previousUpdateTimestamp)return S.getExaggeration(v);let C=v-this._previousZoom;const I=this._previousUpdateTimestamp;let D=v;this._evaluationZoom!=null&&(D=this._evaluationZoom,Math.abs(v-D)>.5&&(C=.5*(v-D+C)),C*x<0&&(D+=C)),this._evaluationZoom=D;const L=S.getExaggeration(D),N=L===S.getExaggeration(Math.max(0,D-.1));if(N&&Math.abs(L-this._exaggeration)<.01)return L;let H=Math.min(.1,.00375*(this._updateTimestamp-I));return(N||L<.1||Math.abs(C)<1e-4)&&(H=Math.min(.2,4*H)),o.U(this._exaggeration,L,H)}resetTileLookupCache(s){this._findCoveringTileCache[s]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(s){s.coord&&s.dataType==="source"?this._clearRenderCacheForTile(s.sourceCacheId,s.coord):s.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const s in this._style._mergedSourceCaches)this._style._mergedSourceCaches[s].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(s=>s.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const s=2*this.proxySourceCache.getSource().tileSize;return[s,s]}set useVertexMorphing(s){this._useVertexMorphing=s}updateTileBinding(s){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const c=this.proxySourceCache,m=this.painter.transform;this._initializing&&(this._initializing=m._centerAltitude===0&&this.getAtPointOrZero(o.L.fromLngLat(m.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const x=this.proxyCoords=c.getIds().map(I=>{const D=c.getTileByID(I).tileID;return D.projMatrix=m.calculateProjMatrix(D.toUnwrapped()),D});(function(I,D){const L=D.transform.pointCoordinate(D.transform.getCameraPoint()),N=new o.P(L.x,L.y);I.sort((H,W)=>{if(W.overscaledZ-H.overscaledZ)return W.overscaledZ-H.overscaledZ;const te=new o.P(H.canonical.x+(1<<H.canonical.z)*H.wrap,H.canonical.y),ee=new o.P(W.canonical.x+(1<<W.canonical.z)*W.wrap,W.canonical.y),ne=N.mult(1<<H.canonical.z);return ne.x-=.5,ne.y-=.5,ne.distSqr(te)-ne.distSqr(ee)})})(x,this.painter);const v=this.proxyToSource||{};this.proxyToSource={},x.forEach(I=>{this.proxyToSource[I.key]={}}),this.terrainTileForTile={};const S=this._style._mergedSourceCaches;for(const I in S){const D=S[I];if(!D.used||(D!==this.sourceCache&&this.resetTileLookupCache(D.id),this._setupProxiedCoordsForOrtho(D,s[I],v),D.usedForTerrain))continue;const L=s[I];D.getSource().reparseOverscaled&&this._assignTerrainTiles(L)}this.proxiedCoords[c.id]=x.map(I=>new T_(I,I.key,this.orthoMatrix)),this._assignTerrainTiles(x),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(v),this.renderingToTexture=!1;const C={};this._visibleDemTiles=[];for(const I of this.proxyCoords){const D=this.terrainTileForTile[I.key];if(!D)continue;const L=D.tileID.key;L in C||(this._visibleDemTiles.push(D),C[L]=L)}}_assignTerrainTiles(s){this._initializing||s.forEach(c=>{if(this.terrainTileForTile[c.key])return;const m=this._findTileCoveringTileID(c,this.sourceCache);m&&(this.terrainTileForTile[c.key]=m)})}_prepareDEMTextures(){const s=this.painter.context,c=s.gl;for(const m in this.terrainTileForTile){const x=this.terrainTileForTile[m],v=x.dem;!v||x.demTexture&&!x.needsDEMTextureUpload||(s.activeTexture.set(c.TEXTURE1),v_(this.painter,x,v))}}_prepareDemTileUniforms(s,c,m,x){if(!c||c.demTexture==null)return!1;const v=s.tileID.canonical,S=Math.pow(2,c.tileID.canonical.z-v.z),C=x||"";return m[`u_dem_tl${C}`]=[v.x*S%1,v.y*S%1],m[`u_dem_scale${C}`]=S,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const s=this.painter.context,c=s.gl;if(!this._emptyDepthBufferTexture){const m=new o.h({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new o.T(s,m,c.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let s=0;const c=this._visibleDemTiles.reduce((m,x)=>{if(!x.dem)return m;const v=x.dem.tree.minimums[0];return v>0&&s++,m+v},0);return s?c/s:0}_updateEmptyDEMTexture(){const s=this.painter.context,c=s.gl;s.activeTexture.set(c.TEXTURE2);const m=this._getLoadedAreaMinimum(),[x,v]=(()=>{const C=new o.cm({width:1,height:1},new Float32Array([m]));return[c.R32F,C]})();this._emptyDEMTextureDirty=!1;let S=this._emptyDEMTexture;return S?S.update(v,{premultiply:!1}):S=this._emptyDEMTexture=new o.T(s,v,x,{premultiply:!1}),S}setupElevationDraw(s,c,m){const x=this.painter.context,v=x.gl,S={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0};S.u_exaggeration=this.exaggeration();let C=null,I=null,D=1;if(m&&m.morphing&&this._useVertexMorphing){const H=m.morphing.srcDemTile,W=m.morphing.dstDemTile;D=m.morphing.phase,H&&W&&(this._prepareDemTileUniforms(s,H,S,"_prev")&&(I=H),this._prepareDemTileUniforms(s,W,S)&&(C=W))}const L=H=>H&&H.demTexture&&this.painter.linearFloatFilteringSupported()?v.LINEAR:v.NEAREST,N=H=>{S.u_dem_size=H.size[0]===1?1:H.size[0]-2};if(I&&C)x.activeTexture.set(v.TEXTURE2),C.demTexture.bind(L(C),v.CLAMP_TO_EDGE),x.activeTexture.set(v.TEXTURE4),I.demTexture.bind(L(I),v.CLAMP_TO_EDGE),C.demTexture&&N(C.demTexture),S.u_dem_lerp=D;else{C=this.terrainTileForTile[s.tileID.key],x.activeTexture.set(v.TEXTURE2);const H=this._prepareDemTileUniforms(s,C,S)?C.demTexture:this.emptyDEMTexture;H.bind(L(C),v.CLAMP_TO_EDGE),N(H)}if(x.activeTexture.set(v.TEXTURE3),m&&m.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),this._depthFBO&&(S.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),S.u_depth_size_inv=[1,1]),m&&m.useMeterToDem&&C){const H=(1<<C.tileID.canonical.z)*o.bl(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;S.u_meter_to_dem=H}if(m&&m.labelPlaneMatrixInv&&(S.u_label_plane_matrix_inv=m.labelPlaneMatrixInv),c.setTerrainUniformValues(x,S),this.painter.transform.projection.name==="globe"){const H=this.globeUniformValues(this.painter.transform,s.tileID.canonical,m&&m.useDenormalizedUpVectorScale);c.setGlobeUniformValues(x,H)}}globeUniformValues(s,c,m){const x=s.projection;return{u_tile_tl_up:x.upVector(c,0,0),u_tile_tr_up:x.upVector(c,o.V,0),u_tile_br_up:x.upVector(c,o.V,o.V),u_tile_bl_up:x.upVector(c,0,o.V),u_tile_up_scale:m?o.cl(1):x.upVectorScale(c,s.center.lat,s.worldSize).metersToTile}}renderToBackBuffer(s){const c=this.painter,m=this.painter.context;s.length!==0&&(m.bindFramebuffer.set(null),m.viewport.set([0,0,c.width,c.height]),c.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(x,v,S,C,I){if(x.transform.projection.name==="globe")(function(D,L,N,H,W){const te=D.context,ee=te.gl;let ne,K;const ae=D.transform,xe=o.cd(D,te,ae),ue=(ft,ct)=>{if(K===ct)return;const Ct=[i0[ct],"PROJECTION_GLOBE_VIEW"];xe&&Ct.push("CUSTOM_ANTIALIASING");const qe=D.isTileAffectedByFog(ft);ne=D.getOrCreateProgram("globeRaster",{defines:Ct,overrideFog:qe}),K=ct},ye=D.colorModeForRenderPass(),ie=new _r(ee.LEQUAL,_r.ReadWrite,D.depthRangeFor3D);jc.update(W);const ve=o.ce(ae),Pe=[o.a5(ae.center.lng),o.ae(ae.center.lat)],Fe=D.globeSharedBuffers,$e=[ae.width*o.f.devicePixelRatio,ae.height*o.f.devicePixelRatio],nt=Float32Array.from(ae.globeMatrix),Ge={useDenormalizedUpVectorScale:!0};{const ft=D.transform,ct=a0(ft.zoom,L.exaggeration(),L.sourceCache._source.tileSize);K=-1;const Ct=ee.TRIANGLES;for(const qe of H){const ot=N.getTile(qe),Ue=Cr.disabled,Qe=L.prevTerrainTileForTile[qe.key],Mt=L.terrainTileForTile[qe.key];ah(Qe,Mt)&&jc.newMorphing(qe.key,Qe,Mt,W,250),te.activeTexture.set(ee.TEXTURE0),ot.texture&&ot.texture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE);const Ut=jc.getMorphValuesForProxy(qe.key),Bt=Ut?1:0;Ut&&o.j(Ge,{morphing:{srcDemTile:Ut.from,dstDemTile:Ut.to,phase:o.cc(Ut.phase)}});const Yt=o.cf(qe.canonical),or=o.cg(Yt.getCenter().lat),pr=o.ch(qe.canonical,Yt,or,ft.worldSize/ft._pixelsPerMercatorPixel),ur=o.aT(o.ci(qe.canonical)),fr=b_(ft.expandedFarZProjMatrix,nt,ve,ur,o.S(ft.zoom),Pe,ft.frustumCorners.TL,ft.frustumCorners.TR,ft.frustumCorners.BR,ft.frustumCorners.BL,ft.globeCenterInViewSpace,ft.globeRadius,$e,ct,ft._farZ,pr);if(ue(qe,Bt),ne&&(L.setupElevationDraw(ot,ne,Ge),D.uploadCommonUniforms(te,ne,qe.toUnwrapped()),Fe)){const[zr,Sr,Pr]=Fe.getGridBuffers(or,ct!==0);ne.draw(D,Ct,ie,Ue,ye,xr.backCCW,fr,"globe_raster",zr,Sr,Pr)}}}if(Fe&&(D.renderDefaultNorthPole||D.renderDefaultSouthPole)){const ft=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];xe&&ft.push("CUSTOM_ANTIALIASING"),ne=D.getOrCreateProgram("globeRaster",{defines:ft});for(const ct of H){const{x:Ct,y:qe,z:ot}=ct.canonical,Ue=qe===0,Qe=qe===(1<<ot)-1,[Mt,Ut,Bt,Yt]=Fe.getPoleBuffers(ot,!1);if(Yt&&(Ue||Qe)){const or=N.getTile(ct);te.activeTexture.set(ee.TEXTURE0),or.texture&&or.texture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE);let pr=o.cj(ot,Ct,ae);const ur=o.aT(o.ci(ct.canonical)),fr=(zr,Sr)=>zr.draw(D,ee.TRIANGLES,ie,Cr.disabled,ye,xr.disabled,b_(ae.expandedFarZProjMatrix,pr,pr,ur,0,Pe,ae.frustumCorners.TL,ae.frustumCorners.TR,ae.frustumCorners.BR,ae.frustumCorners.BL,ae.globeCenterInViewSpace,ae.globeRadius,$e,0,ae._farZ),"globe_pole_raster",Sr,Bt,Yt);L.setupElevationDraw(or,ne,Ge),D.uploadCommonUniforms(te,ne,ct.toUnwrapped()),Ue&&D.renderDefaultNorthPole&&fr(ne,Mt),Qe&&D.renderDefaultSouthPole&&(pr=o.a6.scale(o.a6.create(),pr,[1,-1,1]),fr(ne,Ut))}}}})(x,v,S,C,I);else{const D=x.context,L=D.gl;let N,H;const W=x.shadowRenderer,te=sl(x,x.longestCutoffRange),ee=ye=>{if(H===ye)return;const ie=[];ie.push(i0[ye]),te.shouldRenderCutoff&&ie.push("RENDER_CUTOFF"),N=x.getOrCreateProgram("terrainRaster",{defines:ie}),H=ye},ne=x.colorModeForRenderPass(),K=new _r(L.LEQUAL,_r.ReadWrite,x.depthRangeFor3D);jc.update(I);const ae=x.transform,xe=a0(ae.zoom,v.exaggeration(),v.sourceCache._source.tileSize);let ue=[0,0,0];if(W){const ye=x.style.directionalLight,ie=x.style.ambientLight;ye&&ie&&(ue=nh(ye,ie))}{H=-1;const ye=L.TRIANGLES,[ie,ve]=[v.gridIndexBuffer,v.gridSegments];for(const Pe of C){const Fe=S.getTile(Pe),$e=Cr.disabled,nt=v.prevTerrainTileForTile[Pe.key],Ge=v.terrainTileForTile[Pe.key];ah(nt,Ge)&&jc.newMorphing(Pe.key,nt,Ge,I,250),D.activeTexture.set(L.TEXTURE0),Fe.texture&&Fe.texture.bind(L.LINEAR,L.CLAMP_TO_EDGE);const ft=jc.getMorphValuesForProxy(Pe.key),ct=ft?1:0;let Ct;ft&&(Ct={morphing:{srcDemTile:ft.from,dstDemTile:ft.to,phase:o.cc(ft.phase)}});const qe=Bf(Pe.projMatrix,Gc(Pe.canonical,ae.renderWorldCopies)?xe/10:xe,ue);if(ee(ct),!N)continue;v.setupElevationDraw(Fe,N,Ct);const ot=Pe.toUnwrapped();W&&W.setupShadows(ot,N),x.uploadCommonUniforms(D,N,ot,null,te),N.draw(x,ye,K,$e,ne,xr.backCCW,qe,"terrain_raster",v.gridBuffer,ie,ve)}}}}(c,this,this.proxySourceCache,s,this._updateTimestamp),this.renderingToTexture=!0,c.gpuTimingDeferredRenderEnd(),s.splice(0,s.length))}renderBatch(s){if(this._drapedRenderBatches.length===0)return s+1;this.renderingToTexture=!0;const c=this.painter,m=this.painter.context,x=this.proxySourceCache,v=this.proxiedCoords[x.id],S=this._drapedRenderBatches.shift(),C=c.style.order,I=[];let D=0;for(const L of v){const N=x.getTileByID(L.proxyTileKey),H=x.proxyCachedFBO[L.key]?x.proxyCachedFBO[L.key][s]:void 0,W=H!==void 0?x.renderCache[H]:this.pool[D++],te=H!==void 0;if(N.texture=W.tex,te&&!W.dirty){I.push(N.tileID);continue}let ee;m.bindFramebuffer.set(W.fb.framebuffer),this.renderedToTile=!1,W.dirty&&(m.clear({color:o.ax.transparent,stencil:0}),W.dirty=!1);for(let ne=S.start;ne<=S.end;++ne){const K=c.style._mergedLayers[C[ne]];if(K.isHidden(c.transform.zoom))continue;const ae=c.style.getLayerSourceCache(K),xe=ae?this.proxyToSource[L.key][ae.id]:[L];if(!xe)continue;const ue=xe;m.viewport.set([0,0,W.fb.width,W.fb.height]),ee!==(ae?ae.id:null)&&(this._setupStencil(W,xe,K,ae),ee=ae?ae.id:null),c.renderLayer(c,ae,K,ue)}if(this._drapedRenderBatches.length===0)for(const ne of this._pendingGroundEffectLayers){const K=c.style._mergedLayers[C[ne]];if(K.isHidden(c.transform.zoom))continue;const ae=c.style.getLayerSourceCache(K),xe=ae?this.proxyToSource[L.key][ae.id]:[L];if(!xe)continue;const ue=xe;m.viewport.set([0,0,W.fb.width,W.fb.height]),ee!==(ae?ae.id:null)&&(this._setupStencil(W,xe,K,ae),ee=ae?ae.id:null),c.renderLayer(c,ae,K,ue)}this.renderedToTile?(W.dirty=!0,I.push(N.tileID)):te||--D,D===5&&(D=0,this.renderToBackBuffer(I))}return this.renderToBackBuffer(I),this.renderingToTexture=!1,m.bindFramebuffer.set(null),m.viewport.set([0,0,c.width,c.height]),S.end+1}postRender(){}isLayerOrderingCorrect(s){const c=s.order.length;let m=-1,x=c;for(let v=0;v<c;++v)this._style.isLayerDraped(s._mergedLayers[s.order[v]])?m=Math.max(m,v):x=Math.min(x,v);return x>m}getMinElevationBelowMSL(){let s=0;return this._visibleDemTiles.filter(c=>c.dem).forEach(c=>{s=Math.min(s,c.dem.tree.minimums[0])}),s===0?s:(s-30)*this._exaggeration}raycast(s,c,m){if(!this._visibleDemTiles)return null;const x=this._visibleDemTiles.filter(v=>v.dem).map(v=>{const S=v.tileID,C=1<<S.overscaledZ,{x:I,y:D}=S.canonical,L=I/C,N=(I+1)/C,H=D/C,W=(D+1)/C;return{minx:L,miny:H,maxx:N,maxy:W,t:v.dem.tree.raycastRoot(L,H,N,W,s,c,m),tile:v}});x.sort((v,S)=>(v.t!==null?v.t:Number.MAX_VALUE)-(S.t!==null?S.t:Number.MAX_VALUE));for(const v of x){if(v.t==null)return null;const S=v.tile.dem.tree.raycast(v.minx,v.miny,v.maxx,v.maxy,s,c,m);if(S!=null)return S}return null}_createFBO(){const s=this.painter.context,c=s.gl,m=this.drapeBufferSize;s.activeTexture.set(c.TEXTURE0);const x=new o.T(s,{width:m[0],height:m[1],data:null},c.RGBA);x.bind(c.LINEAR,c.CLAMP_TO_EDGE);const v=s.createFramebuffer(m[0],m[1],!0,null);return v.colorAttachment.set(x.texture),v.depthAttachment=new Pa(s,v.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=s.createRenderbuffer(s.gl.DEPTH_STENCIL,m[0],m[1]),this._stencilRef=0,v.depthAttachment.set(this._sharedDepthStencil),s.clear({stencil:0})):v.depthAttachment.set(this._sharedDepthStencil),s.extTextureFilterAnisotropic&&c.texParameterf(c.TEXTURE_2D,s.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,s.extTextureFilterAnisotropicMax),{fb:v,tex:x,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const s in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[s].hasTransition())return!0;return this._style.order.some(s=>{const c=this._style._mergedLayers[s],m=c.isHidden(this.painter.transform.zoom);return c.type==="custom"?!m&&c.shouldRedrape():!m&&c.hasTransition()})}_clearLineLayersFromRenderCache(){let s=!1;for(const m of this._style.getSources())if(m instanceof se){s=!0;break}if(!s)return;const c={};for(let m=0;m<this._style.order.length;++m){const x=this._style._mergedLayers[this._style.order[m]],v=this._style.getLayerSourceCache(x);if(v&&!c[v.id]&&!x.isHidden(this.painter.transform.zoom)&&x.type==="line"&&x.widthExpression()instanceof o.Z){c[v.id]=!0;for(const S of this.proxyCoords){const C=this.proxyToSource[S.key][v.id];if(C)for(const I of C)this._clearRenderCacheForTile(v.id,I)}}}}_clearRasterLayersFromRenderCache(){let s=!1;for(const m in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[m]._source instanceof he){s=!0;break}if(!s)return;const c={};for(let m=0;m<this._style.order.length;++m){const x=this._style._mergedLayers[this._style.order[m]],v=this._style.getLayerSourceCache(x);if(!v||c[v.id]||x.isHidden(this.painter.transform.zoom)||x.type!=="raster")continue;const S=x.paint.get("raster-fade-duration");for(const C of this.proxyCoords){const I=this.proxyToSource[C.key][v.id];if(I)for(const D of I){const L=o0(v.getTile(D),v.findLoadedParent(D,0),v,this.painter.transform,S);(L.opacity!==1||L.mix!==0)&&this._clearRenderCacheForTile(v.id,D)}}}}_setupDrapedRenderBatches(){const s=this._style.order,c=s.length;if(c===0)return;const m=[];this._pendingGroundEffectLayers=[];let x,v=0,S=this._style._mergedLayers[s[v]];for(;!this._style.isLayerDraped(S)&&S.isHidden(this.painter.transform.zoom)&&++v<c;)S=this._style._mergedLayers[s[v]];for(;v<c;++v){const C=this._style._mergedLayers[s[v]];C.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(C)?x===void 0&&(x=v):(C.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(v),x!==void 0&&(m.push({start:x,end:v-1}),x=void 0)))}if(x!==void 0&&m.push({start:x,end:v-1}),m.length!==0){const C=m[m.length-1];this._pendingGroundEffectLayers.every(I=>I>C.end)||o.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=m}_setupRenderCache(s){const c=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,c.renderCache.length>c.renderCachePool.length){const S=Object.values(c.proxyCachedFBO);c.proxyCachedFBO={};for(let C=0;C<S.length;++C){const I=Object.values(S[C]);c.renderCachePool.push(...I)}}return}this._clearRasterLayersFromRenderCache();const m=this.proxyCoords,x=this._tilesDirty;for(let S=m.length-1;S>=0;S--){const C=m[S];if(c.getTileByID(C.key),c.proxyCachedFBO[C.key]!==void 0){const I=s[C.key],D=this.proxyToSource[C.key];let L=0;for(const N in D){const H=D[N],W=I[N];if(!W||W.length!==H.length||H.some((te,ee)=>te!==W[ee]||x[N]&&x[N].hasOwnProperty(te.key))){L=-1;break}++L}for(const N in c.proxyCachedFBO[C.key])c.renderCache[c.proxyCachedFBO[C.key][N]].dirty=L<0||L!==Object.values(I).length}}const v=[...this._drapedRenderBatches];v.sort((S,C)=>C.end-C.start-(S.end-S.start));for(const S of v)for(const C of m){if(c.proxyCachedFBO[C.key])continue;let I=c.renderCachePool.pop();I===void 0&&c.renderCache.length<50&&(I=c.renderCache.length,c.renderCache.push(this._createFBO())),I!==void 0&&(c.proxyCachedFBO[C.key]={},c.proxyCachedFBO[C.key][S.start]=I,c.renderCache[I].dirty=!0)}this._tilesDirty={}}_setupStencil(s,c,m,x){if(!x||!this._sourceTilesOverlap[x.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const v=this.painter.context,S=v.gl;if(c.length<=1)return void(this._overlapStencilType=!1);let C;if(m.isTileClipped())C=c.length,this._overlapStencilMode.test={func:S.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(c[0].overscaledZ>c[c.length-1].overscaledZ))return void(this._overlapStencilType=!1);C=1,this._overlapStencilMode.test={func:S.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+C>255&&(v.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=C,this._overlapStencilMode.ref=this._stencilRef,m.isTileClipped()&&this._renderTileClippingMasks(c,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(s){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[s.key]),this._overlapStencilMode):Cr.disabled}_renderTileClippingMasks(s,c){const m=this.painter,x=this.painter.context,v=x.gl;m._tileClippingMaskIDs={},x.setColorMode(jr.disabled),x.setDepthMode(_r.disabled);const S=m.getOrCreateProgram("clippingMask");for(const C of s){const I=m._tileClippingMaskIDs[C.key]=--c;S.draw(m,v.TRIANGLES,_r.disabled,new Cr({func:v.ALWAYS,mask:0},I,255,v.KEEP,v.KEEP,v.REPLACE),jr.disabled,xr.disabled,s0(C.projMatrix),"$clipping",m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}}pointCoordinate(s){const c=this.painter.transform;if(s.x<0||s.x>c.width||s.y<0||s.y>c.height)return null;const m=[s.x,s.y,1,1];o.a7.transformMat4(m,m,c.pixelMatrixInverse),o.a7.scale(m,m,1/m[3]),m[0]/=c.worldSize,m[1]/=c.worldSize;const x=c._camera.position,v=o.bl(1,c.center.lat),S=[x[0],x[1],x[2]/v,0],C=o.N.subtract([],m.slice(0,3),S);o.N.normalize(C,C);const I=this.raycast(S,C,this._exaggeration);return I!==null&&I?(o.N.scaleAndAdd(S,S,C,I),S[3]=S[2],S[2]*=v,S):null}drawDepth(){const s=this.painter,c=s.context,m=this.proxySourceCache,x=Math.ceil(s.width),v=Math.ceil(s.height);if(!this._depthFBO||this._depthFBO.width===x&&this._depthFBO.height===v||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const S=c.gl,C=c.createFramebuffer(x,v,!0,"renderbuffer");c.activeTexture.set(S.TEXTURE0);const I=new o.T(c,{width:x,height:v,data:null},S.RGBA);I.bind(S.NEAREST,S.CLAMP_TO_EDGE),C.colorAttachment.set(I.texture);const D=c.createRenderbuffer(c.gl.DEPTH_COMPONENT16,x,v);C.depthAttachment.set(D),this._depthFBO=C,this._depthTexture=I}c.bindFramebuffer.set(this._depthFBO.framebuffer),c.viewport.set([0,0,x,v]),function(S,C,I,D){if(S.transform.projection.name==="globe")return;const L=S.context,N=L.gl;L.clear({depth:1});const H=S.getOrCreateProgram("terrainDepth"),W=new _r(N.LESS,_r.ReadWrite,S.depthRangeFor3D);for(const te of D){const ee=I.getTile(te),ne=Bf(te.projMatrix,0,[0,0,0]);C.setupElevationDraw(ee,H),H.draw(S,N.TRIANGLES,W,Cr.disabled,jr.unblended,xr.backCCW,ne,"terrain_depth",C.gridBuffer,C.gridIndexBuffer,C.gridNoSkirtSegments)}}(s,this,m,this.proxyCoords)}_setupProxiedCoordsForOrtho(s,c,m){if(s.getSource()instanceof o.ap)return this._setupProxiedCoordsForImageSource(s,c,m);this._findCoveringTileCache[s.id]=this._findCoveringTileCache[s.id]||{};const x=this.proxiedCoords[s.id]=[],v=this.proxyCoords;for(let I=0;I<v.length;I++){const D=v[I],L=this._findTileCoveringTileID(D,s);if(L){const N=this._createProxiedId(D,L,m[D.key]&&m[D.key][s.id]);x.push(N),this.proxyToSource[D.key][s.id]=[N]}}let S=!1;const C=new Set;for(let I=0;I<c.length;I++){const D=s.getTile(c[I]);if(!D||!D.hasData())continue;const L=this._findTileCoveringTileID(D.tileID,this.proxySourceCache);if(L&&L.tileID.canonical.z!==D.tileID.canonical.z){const N=this.proxyToSource[L.tileID.key][s.id],H=this._createProxiedId(L.tileID,D,m[L.tileID.key]&&m[L.tileID.key][s.id]);N?N.splice(N.length-1,0,H):this.proxyToSource[L.tileID.key][s.id]=[H];const W=this.proxyToSource[L.tileID.key][s.id];C.has(W)||C.add(W),x.push(H),S=!0}}if(this._sourceTilesOverlap[s.id]=S,S&&this._debugParams.sortTilesHiZFirst)for(const I of C)I.sort((D,L)=>L.overscaledZ-D.overscaledZ)}_setupProxiedCoordsForImageSource(s,c,m){if(!s.getSource().loaded())return;const x=this.proxiedCoords[s.id]=[],v=this.proxyCoords,S=s.getSource(),C=S.tileID;if(!C)return;const I=new o.P(C.x,C.y)._div(1<<C.z),D=S.coordinates.map(o.L.fromLngLat).reduce((N,H)=>(N.min.x=Math.min(N.min.x,H.x-I.x),N.min.y=Math.min(N.min.y,H.y-I.y),N.max.x=Math.max(N.max.x,H.x-I.x),N.max.y=Math.max(N.max.y,H.y-I.y),N),{min:new o.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),L=(N,H)=>{const W=N.wrap+N.canonical.x/(1<<N.canonical.z),te=N.canonical.y/(1<<N.canonical.z),ee=o.V/(1<<N.canonical.z),ne=H.wrap+H.canonical.x/(1<<H.canonical.z),K=H.canonical.y/(1<<H.canonical.z);return W+ee<ne+D.min.x||W>ne+D.max.x||te+ee<K+D.min.y||te>K+D.max.y};for(let N=0;N<v.length;N++){const H=v[N];for(let W=0;W<c.length;W++){const te=s.getTile(c[W]);if(!te||!te.hasData()||L(H,te.tileID))continue;const ee=this._createProxiedId(H,te,m[H.key]&&m[H.key][s.id]),ne=this.proxyToSource[H.key][s.id];ne?ne.push(ee):this.proxyToSource[H.key][s.id]=[ee],x.push(ee)}}}_createProxiedId(s,c,m){let x=this.orthoMatrix;if(m){const v=m.find(S=>S.key===c.tileID.key);if(v)return v}if(c.tileID.key!==s.key){const v=s.canonical.z-c.tileID.canonical.z;let S,C,I;x=o.a6.create();const D=c.tileID.wrap-s.wrap<<s.overscaledZ;v>0?(S=o.V>>v,C=S*((c.tileID.canonical.x<<v)-s.canonical.x+D),I=S*((c.tileID.canonical.y<<v)-s.canonical.y)):(S=o.V<<-v,C=o.V*(c.tileID.canonical.x-(s.canonical.x+D<<-v)),I=o.V*(c.tileID.canonical.y-(s.canonical.y<<-v))),o.a6.ortho(x,0,S,0,S,0,1),o.a6.translate(x,x,[C,I,0])}return new T_(c.tileID,s.key,x)}_findTileCoveringTileID(s,c){let m=c.getTile(s);if(m&&m.hasData())return m;const x=this._findCoveringTileCache[c.id],v=x[s.key];if(m=v?c.getTileByID(v):null,m&&m.hasData()||v===null)return m;let S=m?m.tileID:s,C=S.overscaledZ;const I=c.getSource().minzoom,D=[];if(!v){const N=c.getSource().maxzoom;if(s.canonical.z>=N){const H=s.canonical.z-N;c.getSource().reparseOverscaled?(C=Math.max(s.canonical.z+2,c.transform.tileZoom),S=new o.am(C,s.wrap,N,s.canonical.x>>H,s.canonical.y>>H)):H!==0&&(C=N,S=new o.am(C,s.wrap,N,s.canonical.x>>H,s.canonical.y>>H))}S.key!==s.key&&(D.push(S.key),m=c.getTile(S))}const L=N=>{D.forEach(H=>{x[H]=N}),D.length=0};for(C-=1;C>=I&&(!m||!m.hasData());C--){m&&L(m.tileID.key);const N=S.calculateScaledKey(C);if(m=c.getTileByID(N),m&&m.hasData())break;const H=x[N];if(H===null)break;H===void 0?D.push(N):m=c.getTileByID(H)}return L(m?m.tileID.key:null),m&&m.hasData()?m:null}findDEMTileFor(s){return this.enabled?this._findTileCoveringTileID(s,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(s,c){let m=this._tilesDirty[s];m||(m=this._tilesDirty[s]={}),m[c.key]=!0}}function l0(p,s,c){const m=function(C,I,D){const L=o.N.dot(I,C),N=o.N.dot(D,[.2126,.7152,.0722]),H=(te,ee,ne)=>(1-ne)*te+ne*ee,W=H(1-.3*Math.min(N,1),1,Math.min(L+1,1));return H(.92,1,Math.asin(o.aa(I[2],-1,1))/Math.PI+.5)*W}(p,[0,0,1],s),x=[0,0,0];o.N.scale(x,c.slice(0,3),m);const v=[0,0,0];o.N.scale(v,s.slice(0,3),p[2]);const S=[0,0,0];return o.N.add(S,x,v),o.bU(S)}const c0=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],E_=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class u0{static cacheKey(s,c,m,x){let v=`${c}${x?x.cacheKey:""}`;for(const S of m)s.usedDefines.includes(S)&&(v+=`/${S}`);return v}constructor(s,c,m,x,v,S,C){const I=s.gl;this.program=I.createProgram(),this.configuration=x,this.name=c,this.fixedDefines=[...S];const D=x?x.getBinderAttributes():[],L=(m.staticAttributes||[]).concat(D);let N=x?x.defines():[];N=N.concat(S.map(K=>`#define ${K}`));const H=`#version 300 es
`;let W=H+N.concat("precision mediump float;",Nf,e0.fragmentSource).join(`
`);for(const K of m.fragmentIncludes)W+=`
${Xa[K]}`;W+=`
${m.fragmentSource}`;let te=H+N.concat("precision highp float;",Nf,e0.vertexSource).join(`
`);for(const K of m.vertexIncludes)te+=`
${Xa[K]}`;te+=`
${m.vertexSource}`;const ee=I.createShader(I.FRAGMENT_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);I.shaderSource(ee,W),I.compileShader(ee),I.attachShader(this.program,ee);const ne=I.createShader(I.VERTEX_SHADER);if(I.isContextLost())this.failedToCreate=!0;else{I.shaderSource(ne,te),I.compileShader(ne),I.attachShader(this.program,ne),this.attributes={},this.numAttributes=L.length;for(let K=0;K<this.numAttributes;K++)if(L[K]){const ae=L[K].startsWith("a_")?L[K]:`a_${L[K]}`;I.bindAttribLocation(this.program,K,ae),this.attributes[ae]=K}C&&C.shaderVaryings.length>0&&I.transformFeedbackVaryings(this.program,C.shaderVaryings,C.bufferMode),I.linkProgram(this.program),I.deleteShader(ne),I.deleteShader(ee),this.fixedUniforms=v(s),this.binderUniforms=x?x.getUniforms(s):[],S.includes("TERRAIN")&&(this.terrainUniforms=(K=>({u_dem:new o.bO(K),u_dem_prev:new o.bO(K),u_dem_tl:new o.bL(K),u_dem_scale:new o.bN(K),u_dem_tl_prev:new o.bL(K),u_dem_scale_prev:new o.bN(K),u_dem_size:new o.bN(K),u_dem_lerp:new o.bN(K),u_exaggeration:new o.bN(K),u_depth:new o.bO(K),u_depth_size_inv:new o.bL(K),u_meter_to_dem:new o.bN(K),u_label_plane_matrix_inv:new o.bK(K)}))(s)),S.includes("GLOBE")&&(this.globeUniforms=(K=>({u_tile_tl_up:new o.bM(K),u_tile_tr_up:new o.bM(K),u_tile_br_up:new o.bM(K),u_tile_bl_up:new o.bM(K),u_tile_up_scale:new o.bN(K)}))(s)),S.includes("FOG")&&(this.fogUniforms=(K=>({u_fog_matrix:new o.bK(K),u_fog_range:new o.bL(K),u_fog_color:new o.bP(K),u_fog_horizon_blend:new o.bN(K),u_fog_vertical_limit:new o.bL(K),u_fog_temporal_offset:new o.bN(K),u_frustum_tl:new o.bM(K),u_frustum_tr:new o.bM(K),u_frustum_br:new o.bM(K),u_frustum_bl:new o.bM(K),u_globe_pos:new o.bM(K),u_globe_radius:new o.bN(K),u_globe_transition:new o.bN(K),u_is_globe:new o.bO(K),u_viewport:new o.bL(K)}))(s)),S.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(K=>({u_cutoff_params:new o.bP(K)}))(s)),S.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(K=>({u_lighting_ambient_color:new o.bM(K),u_lighting_directional_dir:new o.bM(K),u_lighting_directional_color:new o.bM(K),u_ground_radiance:new o.bM(K)}))(s)),S.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(K=>({u_light_matrix_0:new o.bK(K),u_light_matrix_1:new o.bK(K),u_fade_range:new o.bL(K),u_shadow_normal_offset:new o.bM(K),u_shadow_intensity:new o.bN(K),u_shadow_texel_size:new o.bN(K),u_shadow_map_resolution:new o.bN(K),u_shadow_direction:new o.bM(K),u_shadow_bias:new o.bM(K),u_shadowmap_0:new o.bO(K),u_shadowmap_1:new o.bO(K)}))(s))}}setTerrainUniformValues(s,c){if(!this.terrainUniforms)return;const m=this.terrainUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const x in c)m[x]&&m[x].set(this.program,x,c[x])}}setGlobeUniformValues(s,c){if(!this.globeUniforms)return;const m=this.globeUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const x in c)m[x]&&m[x].set(this.program,x,c[x])}}setFogUniformValues(s,c){if(!this.fogUniforms)return;const m=this.fogUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const x in c)m[x].set(this.program,x,c[x])}}setCutoffUniformValues(s,c){if(!this.cutoffUniforms)return;const m=this.cutoffUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const x in c)m[x].set(this.program,x,c[x])}}setLightsUniformValues(s,c){if(!this.lightsUniforms)return;const m=this.lightsUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const x in c)m[x].set(this.program,x,c[x])}}setShadowUniformValues(s,c){if(this.failedToCreate||!this.shadowUniforms)return;const m=this.shadowUniforms;s.program.set(this.program);for(const x in c)m[x].set(this.program,x,c[x])}_drawDebugWireframe(s,c,m,x,v,S,C,I,D,L){const N=s.options.wireframe;if(N.terrain===!1&&N.layers2D===!1&&N.layers3D===!1)return;const H=s.context;if(!(!(!N.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!N.layers2D||s._terrain&&s._terrain.renderingToTexture||!c0.includes(this.name))||!(!N.layers3D||!E_.includes(this.name))))return;const W=H.gl,te=s.wireframeDebugCache.getLinesFromTrianglesBuffer(s.frameCounter,v,H);if(!te)return;const ee=[...this.fixedDefines];ee.push("DEBUG_WIREFRAME");const ne=s.getOrCreateProgram(this.name,{config:this.configuration,defines:ee});H.program.set(ne.program);const K=(ue,ye,ie)=>{if(ye[ue]&&ie[ue])for(const ve in ye[ue])ie[ue][ve]&&ie[ue][ve].set(ie.program,ve,ye[ue][ve].current)};D&&D.setUniforms(ne.program,H,ne.binderUniforms,C,{zoom:I}),K("fixedUniforms",this,ne),K("terrainUniforms",this,ne),K("globeUniforms",this,ne),K("fogUniforms",this,ne),K("lightsUniforms",this,ne),K("shadowUniforms",this,ne),te.bind(),H.setColorMode(new jr([W.ONE,W.ONE_MINUS_SRC_ALPHA,W.ZERO,W.ONE],o.ax.transparent,[!0,!0,!0,!1])),H.setDepthMode(new _r(c.func===W.LESS?W.LEQUAL:c.func,_r.ReadOnly,c.range)),H.setStencilMode(Cr.disabled);const ae=3*S.primitiveLength*2,xe=3*S.primitiveOffset*2*2;L&&L>1?W.drawElementsInstanced(W.LINES,ae,W.UNSIGNED_SHORT,xe,L):W.drawElements(W.LINES,ae,W.UNSIGNED_SHORT,xe),v.bind(),H.program.set(this.program),H.setDepthMode(c),H.setStencilMode(m),H.setColorMode(x)}draw(s,c,m,x,v,S,C,I,D,L,N,H,W,te,ee,ne,K){const ae=s.context,xe=ae.gl;if(this.failedToCreate)return;ae.program.set(this.program),ae.setDepthMode(m),ae.setStencilMode(x),ae.setColorMode(v),ae.setCullFace(S);for(const ve of Object.keys(this.fixedUniforms))this.fixedUniforms[ve].set(this.program,ve,C[ve]);te&&te.setUniforms(this.program,ae,this.binderUniforms,H,{zoom:W});const ue={[xe.POINTS]:1,[xe.LINES]:2,[xe.TRIANGLES]:3,[xe.LINE_STRIP]:1}[c],ye=K&&K.length>0;if(ye){for(const ve of K)xe.bindBufferBase(xe.TRANSFORM_FEEDBACK_BUFFER,ve.targetIndex,ve.buffer.buffer);xe.beginTransformFeedback(c)}const ie=ne&&ne>0?1:void 0;for(const ve of N.get()){const Pe=ve.vaos||(ve.vaos={});(Pe[I]||(Pe[I]=new r0)).bind(ae,this,D,te?te.getPaintVertexBuffers():[],L,ve.vertexOffset,ee||[],ie),ne&&ne>1?xe.drawElementsInstanced(c,ve.primitiveLength*ue,xe.UNSIGNED_SHORT,ve.primitiveOffset*ue*2,ne):L?xe.drawElements(c,ve.primitiveLength*ue,xe.UNSIGNED_SHORT,ve.primitiveOffset*ue*2):xe.drawArrays(c,ve.vertexOffset,ve.vertexLength),c===xe.TRIANGLES&&L&&this._drawDebugWireframe(s,m,x,v,L,ve,H,W,te,ne)}ye&&xe.endTransformFeedback()}}function h0(p,s){const c=Math.pow(2,s.tileID.overscaledZ),m=s.tileSize*Math.pow(2,p.transform.tileZoom)/c,x=m*(s.tileID.canonical.x+s.tileID.wrap*c),v=m*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture?s.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/o.a3(s,1,p.transform.tileZoom),u_pixel_coord_upper:[x>>16,v>>16],u_pixel_coord_lower:[65535&x,65535&v]}}const S_=o.a6.create(),f0=(p,s,c,m,x,v,S,C,I,D,L,N,H,W,te,ee)=>{const ne=s.style.light,K=ne.properties.get("position"),ae=[K.x,K.y,K.z],xe=o.co.create();ne.properties.get("anchor")==="viewport"&&(o.co.fromRotation(xe,-s.transform.angle),o.N.transformMat3(ae,ae,xe));const ue=ne.properties.get("color"),ye=s.transform,ie={u_matrix:p,u_lightpos:ae,u_lightintensity:ne.properties.get("intensity"),u_lightcolor:[ue.r,ue.g,ue.b],u_vertical_gradient:+c,u_opacity:m,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:S_,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:x,u_edge_radius:v,u_flood_light_color:N,u_vertical_scale:H,u_flood_light_intensity:W,u_ground_shadow_factor:te,u_emissive_strength:ee};return ye.projection.name==="globe"&&(ie.u_tile_id=[S.canonical.x,S.canonical.y,1<<S.canonical.z],ie.u_zoom_transition=I,ie.u_inv_rot_matrix=L,ie.u_merc_center=D,ie.u_up_dir=ye.projection.upVector(new o.bs(0,0,0),D[0]*o.V,D[1]*o.V),ie.u_height_lift=C),ie},d0=(p,s,c)=>({u_matrix:p,u_edge_radius:s,u_vertical_scale:c}),Wl=(p,s,c,m,x,v,S,C,I,D,L,N,H,W)=>{const te=f0(p,s,c,m,x,v,S,I,D,L,N,H,W,1,[0,0,0],0),ee={u_height_factor:-Math.pow(2,S.overscaledZ)/C.tileSize/8};return o.e(te,h0(s,C),ee)},Hc=(p,s)=>({u_matrix:p,u_emissive_strength:s}),p0=(p,s,c,m)=>o.e(Hc(p,s),h0(c,m)),ql=(p,s,c)=>({u_matrix:p,u_world:c,u_emissive_strength:s}),A_=(p,s,c,m,x)=>o.e(p0(p,s,c,m),{u_world:x}),Uf=(p,s,c,m)=>{const x=o.V/c.tileSize;return{u_matrix:p,u_camera_to_center_distance:s.getCameraToCenterDistance(m),u_extrude_scale:[s.pixelsToGLUnits[0]/x,s.pixelsToGLUnits[1]/x]}},m0=(p,s,c=1)=>({u_matrix:p,u_color:s,u_overlay:0,u_overlay_scale:c}),C_=o.a6.create(),g0=(p,s,c,m,x,v,S)=>{const C=p.transform,I=C.projection.name==="globe",D=I?o.cp(C.zoom,s.canonical)*C._pixelsPerMercatorPixel:o.a3(c,1,v),L={u_matrix:s.projMatrix,u_extrude_scale:D,u_intensity:S,u_inv_rot_matrix:C_,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(I){L.u_inv_rot_matrix=m,L.u_merc_center=x,L.u_tile_id=[s.canonical.x,s.canonical.y,1<<s.canonical.z],L.u_zoom_transition=o.S(C.zoom);const N=x[0]*o.V,H=x[1]*o.V;L.u_up_dir=C.projection.upVector(new o.bs(0,0,0),N,H)}return L};function Vf(p,[s,c,m,x],[v,S]){if(v===S)return[0,0,0,0];const C=255*(p-1)/(p*(S-v));return[s*C,c*C,m*C,x*C]}function k_(p,s,[c,m]){return c===m?0:.5/p+(s-c)*(p-1)/(p*(m-c))}const _0=(p,s,c,m,x,v,S,C,I,D,L,N,H,W,te,ee,ne,K,ae,xe,ue)=>{return{u_matrix:p,u_normalize_matrix:s,u_globe_matrix:c,u_merc_matrix:m,u_grid_matrix:x,u_tl_parent:v,u_scale_parent:D,u_fade_t:L.mix,u_opacity:L.opacity*N.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:N.paint.get("raster-brightness-min"),u_brightness_high:N.paint.get("raster-brightness-max"),u_saturation_factor:(ie=N.paint.get("raster-saturation"),ie>0?1-1/(1.001-ie):-ie),u_contrast_factor:(ye=N.paint.get("raster-contrast"),ye>0?1/(1-ye):1+ye),u_spin_weights:sh(N.paint.get("raster-hue-rotate")),u_perspective_transform:H,u_raster_elevation:W,u_zoom_transition:S,u_merc_center:C,u_cutoff_params:I,u_colorization_mix:Vf(o.cq,ee,K),u_colorization_offset:k_(o.cq,ne,K),u_color_ramp:te,u_texture_offset:[xe/(ae+2*xe),ae/(ae+2*xe)],u_texture_res:[ae+2*xe,ae+2*xe],u_emissive_strength:ue};var ye,ie};function sh(p){p*=Math.PI/180;const s=Math.sin(p),c=Math.cos(p);return[(2*c+1)/3,(-Math.sqrt(3)*s-c+1)/3,(Math.sqrt(3)*s-c+1)/3]}const Dv=(p,s,c,m,x,v,S,C,I,D,L,N)=>({u_matrix:p,u_normalize_matrix:s,u_globe_matrix:c,u_merc_matrix:m,u_grid_matrix:x,u_tl_parent:v,u_scale_parent:D,u_fade_t:L.mix,u_opacity:L.opacity,u_image0:0,u_image1:1,u_raster_elevation:N,u_zoom_transition:S,u_merc_center:C,u_cutoff_params:I}),Fv=(p,s,c,m,x,v,S,C)=>({u_tile_offset:p,u_velocity:s,u_color_ramp:m,u_velocity_res:c,u_max_speed:x,u_texture_offset:v,u_data_scale:S,u_data_offset:C}),M_=(p,s,c,m,x,v,S,C)=>({u_velocity:p,u_velocity_res:s,u_max_speed:c,u_speed_factor:m,u_lifetime_delta:x,u_rand_seed:Math.random(),u_texture_offset:v,u_data_scale:S,u_data_offset:C}),I_=o.a6.create(),$f=(p,s,c,m,x,v,S,C,I,D,L,N,H,W,te,ee,ne,K)=>{const ae=x.transform,xe={u_is_size_zoom_constant:+(p==="constant"||p==="source"),u_is_size_feature_constant:+(p==="constant"||p==="camera"),u_size_t:s?s.uSizeT:0,u_size:s?s.uSize:0,u_camera_to_center_distance:ae.getCameraToCenterDistance(ee),u_rotate_symbol:+c,u_aspect_ratio:ae.width/ae.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_matrix:v,u_label_plane_matrix:S,u_coord_matrix:C,u_is_text:+I,u_pitch_with_map:+m,u_texsize:D,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:I_,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:I_,u_up_vector:[0,-1,0],u_icon_transition:K||0,u_icon_saturation:ne};return ee.name==="globe"&&(xe.u_tile_id=[L.canonical.x,L.canonical.y,1<<L.canonical.z],xe.u_zoom_transition=N,xe.u_inv_rot_matrix=W,xe.u_merc_center=H,xe.u_camera_forward=ae._camera.forward(),xe.u_ecef_origin=o.cr(ae.globeMatrix,L.toUnwrapped()),xe.u_tile_matrix=Float32Array.from(ae.globeMatrix),xe.u_up_vector=te),xe},oh=(p,s,c,m,x,v,S,C,I,D,L,N,H,W,te,ee,ne)=>o.e($f(p,s,c,m,x,v,S,C,I,D,N,H,W,te,ee,ne,1),{u_gamma_scale:m?x.transform.getCameraToCenterDistance(ne)*Math.cos(x.terrain?0:x.transform._pitch):1,u_device_pixel_ratio:o.f.devicePixelRatio,u_is_halo:+L,undefined:void 0}),jf=(p,s,c,m,x,v,S,C,I,D,L,N,H,W,te,ee)=>o.e(oh(p,s,c,m,x,v,S,C,!0,I,!0,L,N,H,W,te,ee),{u_texsize_icon:D,u_texture_icon:1}),x0=(p,s,c,m)=>({u_matrix:p,u_emissive_strength:s,u_opacity:c,u_color:m}),lh=(p,s,c,m,x,v,S)=>o.e(function(C,I,D,L){const N=D.imageManager.getPattern(C.toString(),I),{width:H,height:W}=D.imageManager.getPixelSize(I),te=Math.pow(2,L.tileID.overscaledZ),ee=L.tileSize*Math.pow(2,D.transform.tileZoom)/te,ne=ee*(L.tileID.canonical.x+L.tileID.wrap*te),K=ee*L.tileID.canonical.y;return{u_image:0,u_pattern_tl:N.tl,u_pattern_br:N.br,u_texsize:[H,W],u_pattern_size:N.displaySize,u_tile_units_to_pixels:1/o.a3(L,1,D.transform.tileZoom),u_pixel_coord_upper:[ne>>16,K>>16],u_pixel_coord_lower:[65535&ne,65535&K]}}(x,v,m,S),{u_matrix:p,u_emissive_strength:s,u_opacity:c}),Gf=(p,s,c,m,x,v,S,C,I,D,L,N,H=[0,0,0],W)=>{const te=m.style.light,ee=te.properties.get("position"),ne=[-ee.x,-ee.y,ee.z],K=o.co.create();te.properties.get("anchor")==="viewport"&&(o.co.fromRotation(K,-m.transform.angle),o.N.transformMat3(ne,ne,K));const ae=D.alphaMode==="MASK",xe=te.properties.get("color"),ue=N.paint.get("model-ambient-occlusion-intensity"),ye=N.paint.get("model-color").constantOr(o.ax.white),ie=N.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:p,u_lighting_matrix:s,u_normal_matrix:c,u_lightpos:ne,u_lightintensity:te.properties.get("intensity"),u_lightcolor:[xe.r,xe.g,xe.b],u_camera_pos:H,u_opacity:x,u_baseTextureIsAlpha:0,u_alphaMask:+ae,u_alphaCutoff:D.alphaCutoff,u_baseColorFactor:[v.r,v.g,v.b,v.a],u_emissiveFactor:[S[0],S[1],S[2],1],u_metallicFactor:C,u_roughnessFactor:I,u_baseColorTexture:Ki.BaseColor,u_metallicRoughnessTexture:Ki.MetallicRoughness,u_normalTexture:Ki.Normal,u_occlusionTexture:Ki.Occlusion,u_emissionTexture:Ki.Emission,u_color_mix:[ye.r,ye.g,ye.b,ie],u_aoIntensity:ue,u_emissive_strength:L,u_occlusionTextureTransform:W||[0,0,0,0]}},ch=new Float32Array(16),uh=(p,s=ch,c=ch)=>({u_matrix:p,u_instance:s,u_node_matrix:c}),Lv={fillExtrusion:p=>({u_matrix:new o.bK(p),u_lightpos:new o.bM(p),u_lightintensity:new o.bN(p),u_lightcolor:new o.bM(p),u_vertical_gradient:new o.bN(p),u_opacity:new o.bN(p),u_edge_radius:new o.bN(p),u_ao:new o.bL(p),u_tile_id:new o.bM(p),u_zoom_transition:new o.bN(p),u_inv_rot_matrix:new o.bK(p),u_merc_center:new o.bL(p),u_up_dir:new o.bM(p),u_height_lift:new o.bN(p),u_flood_light_color:new o.bM(p),u_vertical_scale:new o.bN(p),u_flood_light_intensity:new o.bN(p),u_ground_shadow_factor:new o.bM(p),u_emissive_strength:new o.bN(p)}),fillExtrusionDepth:p=>({u_matrix:new o.bK(p),u_edge_radius:new o.bN(p),u_vertical_scale:new o.bN(p)}),fillExtrusionPattern:p=>({u_matrix:new o.bK(p),u_lightpos:new o.bM(p),u_lightintensity:new o.bN(p),u_lightcolor:new o.bM(p),u_vertical_gradient:new o.bN(p),u_height_factor:new o.bN(p),u_edge_radius:new o.bN(p),u_ao:new o.bL(p),u_tile_id:new o.bM(p),u_zoom_transition:new o.bN(p),u_inv_rot_matrix:new o.bK(p),u_merc_center:new o.bL(p),u_up_dir:new o.bM(p),u_height_lift:new o.bN(p),u_image:new o.bO(p),u_texsize:new o.bL(p),u_pixel_coord_upper:new o.bL(p),u_pixel_coord_lower:new o.bL(p),u_tile_units_to_pixels:new o.bN(p),u_opacity:new o.bN(p)}),fillExtrusionGroundEffect:p=>({u_matrix:new o.bK(p),u_opacity:new o.bN(p),u_ao_pass:new o.bN(p),u_meter_to_tile:new o.bN(p),u_ao:new o.bL(p),u_flood_light_intensity:new o.bN(p),u_flood_light_color:new o.bM(p),u_attenuation:new o.bN(p),u_edge_radius:new o.bN(p),u_fb:new o.bO(p),u_fb_size:new o.bN(p)}),fill:p=>({u_matrix:new o.bK(p),u_emissive_strength:new o.bN(p)}),fillPattern:p=>({u_matrix:new o.bK(p),u_emissive_strength:new o.bN(p),u_image:new o.bO(p),u_texsize:new o.bL(p),u_pixel_coord_upper:new o.bL(p),u_pixel_coord_lower:new o.bL(p),u_tile_units_to_pixels:new o.bN(p)}),fillOutline:p=>({u_matrix:new o.bK(p),u_emissive_strength:new o.bN(p),u_world:new o.bL(p)}),fillOutlinePattern:p=>({u_matrix:new o.bK(p),u_emissive_strength:new o.bN(p),u_world:new o.bL(p),u_image:new o.bO(p),u_texsize:new o.bL(p),u_pixel_coord_upper:new o.bL(p),u_pixel_coord_lower:new o.bL(p),u_tile_units_to_pixels:new o.bN(p)}),circle:o.cs,collisionBox:p=>({u_matrix:new o.bK(p),u_camera_to_center_distance:new o.bN(p),u_extrude_scale:new o.bL(p)}),collisionCircle:p=>({u_matrix:new o.bK(p),u_inv_matrix:new o.bK(p),u_camera_to_center_distance:new o.bN(p),u_viewport_size:new o.bL(p)}),debug:p=>({u_color:new o.ca(p),u_matrix:new o.bK(p),u_overlay:new o.bO(p),u_overlay_scale:new o.bN(p)}),clippingMask:p=>({u_matrix:new o.bK(p)}),heatmap:p=>({u_extrude_scale:new o.bN(p),u_intensity:new o.bN(p),u_matrix:new o.bK(p),u_inv_rot_matrix:new o.bK(p),u_merc_center:new o.bL(p),u_tile_id:new o.bM(p),u_zoom_transition:new o.bN(p),u_up_dir:new o.bM(p)}),heatmapTexture:p=>({u_image:new o.bO(p),u_color_ramp:new o.bO(p),u_opacity:new o.bN(p)}),hillshade:p=>({u_matrix:new o.bK(p),u_image:new o.bO(p),u_latrange:new o.bL(p),u_light:new o.bL(p),u_shadow:new o.ca(p),u_highlight:new o.ca(p),u_emissive_strength:new o.bN(p),u_accent:new o.ca(p)}),hillshadePrepare:p=>({u_matrix:new o.bK(p),u_image:new o.bO(p),u_dimension:new o.bL(p),u_zoom:new o.bN(p)}),line:o.ct,linePattern:o.cu,raster:p=>({u_matrix:new o.bK(p),u_normalize_matrix:new o.bK(p),u_globe_matrix:new o.bK(p),u_merc_matrix:new o.bK(p),u_grid_matrix:new o.cb(p),u_tl_parent:new o.bL(p),u_scale_parent:new o.bN(p),u_fade_t:new o.bN(p),u_opacity:new o.bN(p),u_image0:new o.bO(p),u_image1:new o.bO(p),u_brightness_low:new o.bN(p),u_brightness_high:new o.bN(p),u_saturation_factor:new o.bN(p),u_contrast_factor:new o.bN(p),u_spin_weights:new o.bM(p),u_perspective_transform:new o.bL(p),u_raster_elevation:new o.bN(p),u_zoom_transition:new o.bN(p),u_merc_center:new o.bL(p),u_cutoff_params:new o.bP(p),u_colorization_mix:new o.bP(p),u_colorization_offset:new o.bN(p),u_color_ramp:new o.bO(p),u_texture_offset:new o.bL(p),u_texture_res:new o.bL(p),u_emissive_strength:new o.bN(p)}),rasterParticle:p=>({u_matrix:new o.bK(p),u_normalize_matrix:new o.bK(p),u_globe_matrix:new o.bK(p),u_merc_matrix:new o.bK(p),u_grid_matrix:new o.cb(p),u_tl_parent:new o.bL(p),u_scale_parent:new o.bN(p),u_fade_t:new o.bN(p),u_opacity:new o.bN(p),u_image0:new o.bO(p),u_image1:new o.bO(p),u_raster_elevation:new o.bN(p),u_zoom_transition:new o.bN(p),u_merc_center:new o.bL(p),u_cutoff_params:new o.bP(p)}),rasterParticleTexture:p=>({u_texture:new o.bO(p),u_opacity:new o.bN(p)}),rasterParticleDraw:p=>({u_tile_offset:new o.bL(p),u_velocity:new o.bO(p),u_color_ramp:new o.bO(p),u_velocity_res:new o.bL(p),u_max_speed:new o.bN(p),u_texture_offset:new o.bL(p),u_data_scale:new o.bP(p),u_data_offset:new o.bN(p)}),rasterParticleUpdate:p=>({u_velocity:new o.bO(p),u_velocity_res:new o.bL(p),u_max_speed:new o.bN(p),u_speed_factor:new o.bN(p),u_lifetime_delta:new o.bN(p),u_rand_seed:new o.bN(p),u_texture_offset:new o.bL(p),u_data_scale:new o.bP(p),u_data_offset:new o.bN(p)}),symbolIcon:p=>({u_is_size_zoom_constant:new o.bO(p),u_is_size_feature_constant:new o.bO(p),u_size_t:new o.bN(p),u_size:new o.bN(p),u_camera_to_center_distance:new o.bN(p),u_rotate_symbol:new o.bO(p),u_aspect_ratio:new o.bN(p),u_fade_change:new o.bN(p),u_matrix:new o.bK(p),u_label_plane_matrix:new o.bK(p),u_coord_matrix:new o.bK(p),u_is_text:new o.bO(p),u_pitch_with_map:new o.bO(p),u_texsize:new o.bL(p),u_tile_id:new o.bM(p),u_zoom_transition:new o.bN(p),u_inv_rot_matrix:new o.bK(p),u_merc_center:new o.bL(p),u_camera_forward:new o.bM(p),u_tile_matrix:new o.bK(p),u_up_vector:new o.bM(p),u_ecef_origin:new o.bM(p),u_texture:new o.bO(p),u_icon_transition:new o.bN(p),u_icon_saturation:new o.bN(p)}),symbolSDF:p=>({u_is_size_zoom_constant:new o.bO(p),u_is_size_feature_constant:new o.bO(p),u_size_t:new o.bN(p),u_size:new o.bN(p),u_camera_to_center_distance:new o.bN(p),u_rotate_symbol:new o.bO(p),u_aspect_ratio:new o.bN(p),u_fade_change:new o.bN(p),u_matrix:new o.bK(p),u_label_plane_matrix:new o.bK(p),u_coord_matrix:new o.bK(p),u_is_text:new o.bO(p),u_pitch_with_map:new o.bO(p),u_texsize:new o.bL(p),u_texture:new o.bO(p),u_gamma_scale:new o.bN(p),u_device_pixel_ratio:new o.bN(p),u_tile_id:new o.bM(p),u_zoom_transition:new o.bN(p),u_inv_rot_matrix:new o.bK(p),u_merc_center:new o.bL(p),u_camera_forward:new o.bM(p),u_tile_matrix:new o.bK(p),u_up_vector:new o.bM(p),u_ecef_origin:new o.bM(p),u_is_halo:new o.bO(p)}),symbolTextAndIcon:p=>({u_is_size_zoom_constant:new o.bO(p),u_is_size_feature_constant:new o.bO(p),u_size_t:new o.bN(p),u_size:new o.bN(p),u_camera_to_center_distance:new o.bN(p),u_rotate_symbol:new o.bO(p),u_aspect_ratio:new o.bN(p),u_fade_change:new o.bN(p),u_matrix:new o.bK(p),u_label_plane_matrix:new o.bK(p),u_coord_matrix:new o.bK(p),u_is_text:new o.bO(p),u_pitch_with_map:new o.bO(p),u_texsize:new o.bL(p),u_texsize_icon:new o.bL(p),u_texture:new o.bO(p),u_texture_icon:new o.bO(p),u_gamma_scale:new o.bN(p),u_device_pixel_ratio:new o.bN(p),u_is_halo:new o.bO(p)}),background:p=>({u_matrix:new o.bK(p),u_emissive_strength:new o.bN(p),u_opacity:new o.bN(p),u_color:new o.ca(p)}),backgroundPattern:p=>({u_matrix:new o.bK(p),u_emissive_strength:new o.bN(p),u_opacity:new o.bN(p),u_image:new o.bO(p),u_pattern_tl:new o.bL(p),u_pattern_br:new o.bL(p),u_texsize:new o.bL(p),u_pattern_size:new o.bL(p),u_pixel_coord_upper:new o.bL(p),u_pixel_coord_lower:new o.bL(p),u_tile_units_to_pixels:new o.bN(p)}),terrainRaster:w_,terrainDepth:w_,skybox:p=>({u_matrix:new o.bK(p),u_sun_direction:new o.bM(p),u_cubemap:new o.bO(p),u_opacity:new o.bN(p),u_temporal_offset:new o.bN(p)}),skyboxGradient:p=>({u_matrix:new o.bK(p),u_color_ramp:new o.bO(p),u_center_direction:new o.bM(p),u_radius:new o.bN(p),u_opacity:new o.bN(p),u_temporal_offset:new o.bN(p)}),skyboxCapture:p=>({u_matrix_3f:new o.cb(p),u_sun_direction:new o.bM(p),u_sun_intensity:new o.bN(p),u_color_tint_r:new o.bP(p),u_color_tint_m:new o.bP(p),u_luminance:new o.bN(p)}),globeRaster:p=>({u_proj_matrix:new o.bK(p),u_globe_matrix:new o.bK(p),u_normalize_matrix:new o.bK(p),u_merc_matrix:new o.bK(p),u_zoom_transition:new o.bN(p),u_merc_center:new o.bL(p),u_image0:new o.bO(p),u_grid_matrix:new o.cb(p),u_skirt_height:new o.bN(p),u_far_z_cutoff:new o.bN(p),u_frustum_tl:new o.bM(p),u_frustum_tr:new o.bM(p),u_frustum_br:new o.bM(p),u_frustum_bl:new o.bM(p),u_globe_pos:new o.bM(p),u_globe_radius:new o.bN(p),u_viewport:new o.bL(p)}),globeAtmosphere:p=>({u_frustum_tl:new o.bM(p),u_frustum_tr:new o.bM(p),u_frustum_br:new o.bM(p),u_frustum_bl:new o.bM(p),u_horizon:new o.bN(p),u_transition:new o.bN(p),u_fadeout_range:new o.bN(p),u_color:new o.bP(p),u_high_color:new o.bP(p),u_space_color:new o.bP(p),u_temporal_offset:new o.bN(p),u_horizon_angle:new o.bN(p)}),model:p=>({u_matrix:new o.bK(p),u_lighting_matrix:new o.bK(p),u_normal_matrix:new o.bK(p),u_lightpos:new o.bM(p),u_lightintensity:new o.bN(p),u_lightcolor:new o.bM(p),u_camera_pos:new o.bM(p),u_opacity:new o.bN(p),u_baseColorFactor:new o.bP(p),u_emissiveFactor:new o.bP(p),u_metallicFactor:new o.bN(p),u_roughnessFactor:new o.bN(p),u_baseTextureIsAlpha:new o.bO(p),u_alphaMask:new o.bO(p),u_alphaCutoff:new o.bN(p),u_baseColorTexture:new o.bO(p),u_metallicRoughnessTexture:new o.bO(p),u_normalTexture:new o.bO(p),u_occlusionTexture:new o.bO(p),u_emissionTexture:new o.bO(p),u_color_mix:new o.bP(p),u_aoIntensity:new o.bN(p),u_emissive_strength:new o.bN(p),u_occlusionTextureTransform:new o.bP(p)}),modelDepth:p=>({u_matrix:new o.bK(p),u_instance:new o.bK(p),u_node_matrix:new o.bK(p)}),groundShadow:p=>({u_matrix:new o.bK(p),u_ground_shadow_factor:new o.bM(p)}),stars:p=>({u_matrix:new o.bK(p),u_up:new o.bM(p),u_right:new o.bM(p),u_intensity_multiplier:new o.bN(p)})};let ks;function Ms(p,s,c,m,x,v,S){const C=p.context,I=C.gl,D=p.transform,L=p.getOrCreateProgram("collisionBox"),N=[];let H=0,W=0;for(let ue=0;ue<m.length;ue++){const ye=m[ue],ie=s.getTile(ye),ve=ie.getBucket(c);if(!ve)continue;const Pe=Bp(ye,ve,D);let Fe=Pe;x[0]===0&&x[1]===0||(Fe=p.translatePosMatrix(Pe,ie,x,v));const $e=S?ve.textCollisionBox:ve.iconCollisionBox,nt=ve.collisionCircleArray;if(nt.length>0){const Ge=o.a6.create(),ft=Fe;o.a6.mul(Ge,ve.placementInvProjMatrix,D.glCoordMatrix),o.a6.mul(Ge,Ge,ve.placementViewportMatrix),N.push({circleArray:nt,circleOffset:W,transform:ft,invTransform:Ge,projection:ve.getProjection()}),H+=nt.length/4,W=H}$e&&(p.terrain&&p.terrain.setupElevationDraw(ie,L),L.draw(p,I.LINES,_r.disabled,Cr.disabled,p.colorModeForRenderPass(),xr.disabled,Uf(Fe,D,ie,ve.getProjection()),c.id,$e.layoutVertexBuffer,$e.indexBuffer,$e.segments,null,D.zoom,null,[$e.collisionVertexBuffer,$e.collisionVertexBufferExt]))}if(!S||!N.length)return;const te=p.getOrCreateProgram("collisionCircle"),ee=new o.cv;ee.resize(4*H),ee._trim();let ne=0;for(const ue of N)for(let ye=0;ye<ue.circleArray.length/4;ye++){const ie=4*ye,ve=ue.circleArray[ie+0],Pe=ue.circleArray[ie+1],Fe=ue.circleArray[ie+2],$e=ue.circleArray[ie+3];ee.emplace(ne++,ve,Pe,Fe,$e,0),ee.emplace(ne++,ve,Pe,Fe,$e,1),ee.emplace(ne++,ve,Pe,Fe,$e,2),ee.emplace(ne++,ve,Pe,Fe,$e,3)}(!ks||ks.length<2*H)&&(ks=function(ue){const ye=2*ue,ie=new o.aw;ie.resize(ye),ie._trim();for(let ve=0;ve<ye;ve++){const Pe=6*ve;ie.uint16[Pe+0]=4*ve+0,ie.uint16[Pe+1]=4*ve+1,ie.uint16[Pe+2]=4*ve+2,ie.uint16[Pe+3]=4*ve+2,ie.uint16[Pe+4]=4*ve+3,ie.uint16[Pe+5]=4*ve+0}return ie}(H));const K=C.createIndexBuffer(ks,!0),ae=C.createVertexBuffer(ee,o.cw.members,!0);for(const ue of N){const ye={u_matrix:ue.transform,u_inv_matrix:ue.invTransform,u_camera_to_center_distance:(xe=D).getCameraToCenterDistance(ue.projection),u_viewport_size:[xe.width,xe.height]};te.draw(p,I.TRIANGLES,_r.disabled,Cr.disabled,p.colorModeForRenderPass(),xr.disabled,ye,c.id,ae,K,o.aB.simpleSegment(0,2*ue.circleOffset,ue.circleArray.length,ue.circleArray.length/2),null,D.zoom)}var xe;ae.destroy(),K.destroy()}const Eo=o.a6.create();function hh(p){const s=p._camera.getWorldToCamera(p.worldSize,1),c=o.a6.multiply([],s,p.globeMatrix);o.a6.invert(c,c);const m=[0,0,0],x=[0,1,0,0];return o.a7.transformMat4(x,x,c),m[0]=x[0],m[1]=x[1],m[2]=x[2],o.N.normalize(m,m),m}function rr({width:p,height:s,anchor:c,textOffset:m,textScale:x},v){const{horizontalAlign:S,verticalAlign:C}=o.bf(c),I=-(S-.5)*p,D=-(C-.5)*s,L=o.bd(c,m);return new o.P((I/x+L[0])*v,(D/x+L[1])*v)}function P_(p,s,c,m,x,v,S,C,I,D,L){const N=p.text.placedSymbolArray,H=p.text.dynamicLayoutVertexArray,W=p.icon.dynamicLayoutVertexArray,te={},ee=p.getProjection(),ne=Ku(C,ee,v),K=v.elevation,ae=ee.upVectorScale(C.canonical,v.center.lat,v.worldSize).metersToTile;H.clear();for(let xe=0;xe<N.length;xe++){const ue=N.get(xe),{tileAnchorX:ye,tileAnchorY:ie,numGlyphs:ve}=ue,Pe=ue.hidden||!ue.crossTileID||p.allowVerticalPlacement&&!ue.placedOrientation?null:m[ue.crossTileID];if(Pe){let Fe=0,$e=0,nt=0;if(K){const Mt=K?K.getAtTileOffset(C,ye,ie):0,[Ut,Bt,Yt]=ee.upVector(C.canonical,ye,ie);Fe=Mt*Ut*ae,$e=Mt*Bt*ae,nt=Mt*Yt*ae}let[Ge,ft,ct,Ct]=fs(ue.projectedAnchorX+Fe,ue.projectedAnchorY+$e,ue.projectedAnchorZ+nt,c?ne:S);const qe=u_(v.getCameraToCenterDistance(ee),Ct);let ot=x.evaluateSizeForFeature(p.textSizeData,D,ue)*qe/o.bc;c&&(ot*=p.tilePixelRatio/I);const Ue=rr(Pe,ot);c?({x:Ge,y:ft,z:ct}=ee.projectTilePoint(ye+Ue.x,ie+Ue.y,C.canonical),[Ge,ft,ct]=fs(Ge+Fe,ft+$e,ct+nt,S)):(s&&Ue._rotate(-v.angle),Ge+=Ue.x,ft+=Ue.y,ct=0);const Qe=p.allowVerticalPlacement&&ue.placedOrientation===o.b6.vertical?Math.PI/2:0;for(let Mt=0;Mt<ve;Mt++)o.b9(H,Ge,ft,ct,Qe);L&&ue.associatedIconIndex>=0&&(te[ue.associatedIconIndex]={x:Ge,y:ft,z:ct,angle:Qe})}else il(ve,H)}if(L){W.clear();const xe=p.icon.placedSymbolArray;for(let ue=0;ue<xe.length;ue++){const ye=xe.get(ue),{numGlyphs:ie}=ye,ve=te[ue];if(ye.hidden||!ve)il(ie,W);else{const{x:Pe,y:Fe,z:$e,angle:nt}=ve;for(let Ge=0;Ge<ie;Ge++)o.b9(W,Pe,Fe,$e,nt)}}p.icon.dynamicLayoutVertexBuffer.updateData(W)}p.text.dynamicLayoutVertexBuffer.updateData(H)}function Hf(p,s,c,m,x,v,S={}){const C=c.paint.get("icon-translate"),I=c.paint.get("text-translate"),D=c.paint.get("icon-translate-anchor"),L=c.paint.get("text-translate-anchor"),N=c.layout.get("icon-rotation-alignment"),H=c.layout.get("text-rotation-alignment"),W=c.layout.get("icon-pitch-alignment"),te=c.layout.get("text-pitch-alignment"),ee=c.layout.get("icon-keep-upright"),ne=c.layout.get("text-keep-upright"),K=c.paint.get("icon-color-saturation"),ae=p.context,xe=ae.gl,ue=p.transform,ye=N==="map",ie=H==="map",ve=W==="map",Pe=te==="map",Fe=c.layout.get("symbol-sort-key").constantOr(1)!==void 0;let $e=!1;const nt=p.depthModeForSublayer(0,_r.ReadOnly),Ge=[o.a5(ue.center.lng),o.ae(ue.center.lat)],ft=c.layout.get("text-variable-anchor"),ct=ue.projection.name==="globe",Ct=[],qe=[0,-1,0];for(const ot of m){const Ue=s.getTile(ot),Qe=Ue.getBucket(c);if(!Qe||Qe.projection.name==="mercator"&&ct||Qe.fullyClipped)continue;const Mt=Qe.projection.name==="globe",Ut=Mt?o.S(ue.zoom):0,Bt=Ku(ot,Qe.getProjection(),ue),Yt=ue.calculatePixelsToTileUnitsMatrix(Ue),or=ft&&Qe.hasTextData(),pr=Qe.hasIconTextFit()&&or&&Qe.hasIconData(),ur=Qe.getProjection().createInversionMatrix(ue,ot.canonical),fr=()=>{const ii=ye&&c.layout.get("symbol-placement")!=="point",qr=[],un=ii||pr,Zr=c.paint.get("icon-image-cross-fade").constantOr(0);p.terrainRenderModeElevated()&&ve&&qr.push("PITCH_WITH_MAP_TERRAIN"),Mt&&(qr.push("PROJECTION_GLOBE_VIEW"),un&&qr.push("PROJECTED_POS_ON_VIEWPORT")),Zr>0&&qr.push("ICON_TRANSITION"),Qe.icon.zOffsetVertexBuffer&&qr.push("Z_OFFSET"),K<1&&qr.push("SATURATION");const sn=Qe.icon.programConfigurations.get(c.id),Bn=p.getOrCreateProgram(Qe.sdfIcons?"symbolSDF":"symbolIcon",{config:sn,defines:qr});let mn;const Ni=Ue.imageAtlasTexture?Ue.imageAtlasTexture.size:[0,0],Ji=Qe.iconSizeData,Fa=o.b5(Ji,ue.zoom),Qs=ve||ue.pitch!==0,La=Xu(Bt,Ue.tileID.canonical,ve,ye,ue,Qe.getProjection(),Yt),zi=Rp(Bt,Ue.tileID.canonical,ve,ye,ue,Qe.getProjection(),Yt),Ai=p.translatePosMatrix(zi,Ue,C,D,!0),da=p.translatePosMatrix(Bt,Ue,C,D),wa=un?Eo:La,Oa=ye&&!ve&&!ii;let eo=qe;!ct&&!ue.mercatorFromTransition||ye||(eo=hh(ue));const _l=Mt?eo:qe;mn=Qe.sdfIcons&&!Qe.iconsInText?oh(Ji.kind,Fa,Oa,ve,p,da,wa,Ai,!1,Ni,!0,ot,Ut,Ge,ur,_l,Qe.getProjection()):$f(Ji.kind,Fa,Oa,ve,p,da,wa,Ai,!1,Ni,ot,Ut,Ge,ur,_l,Qe.getProjection(),K,Zr);const Jl=Ue.imageAtlasTexture?Ue.imageAtlasTexture:null,Ih=c.layout.get("icon-size").constantOr(0)!==1||Qe.iconsNeedLinear,Ph=Qe.sdfIcons||p.options.rotating||p.options.zooming||Ih||Qs?xe.LINEAR:xe.NEAREST,Z0=Qe.sdfIcons&&c.paint.get("icon-halo-width").constantOr(1)!==0,Rh=p.terrain&&ve&&ii?o.a6.invert(o.a6.create(),La):Eo;if(ii&&Qe.icon){const Yc=ue.elevation,td=Yc?Yc.getAtTileOffsetFunc(ot,ue.center.lat,ue.worldSize,Qe.getProjection()):null,ko=Pp(Bt,Ue.tileID.canonical,ve,ye,ue,Qe.getProjection(),Yt);Fp(Qe,Bt,p,!1,ko,zi,ve,ee,td,ot)}return{program:Bn,buffers:Qe.icon,uniformValues:mn,atlasTexture:Jl,atlasTextureIcon:null,atlasInterpolation:Ph,atlasInterpolationIcon:null,isSDF:Qe.sdfIcons,hasHalo:Z0,tile:Ue,labelPlaneMatrixInv:Rh}},zr=()=>{const ii=ie&&c.layout.get("symbol-placement")!=="point",qr=[],un=ii||ft||pr;p.terrainRenderModeElevated()&&Pe&&qr.push("PITCH_WITH_MAP_TERRAIN"),Mt&&(qr.push("PROJECTION_GLOBE_VIEW"),un&&qr.push("PROJECTED_POS_ON_VIEWPORT")),Qe.text.zOffsetVertexBuffer&&qr.push("Z_OFFSET");const Zr=Qe.text.programConfigurations.get(c.id),sn=p.getOrCreateProgram(Qe.iconsInText?"symbolTextAndIcon":"symbolSDF",{config:Zr,defines:qr});let Bn,mn=[0,0],Ni=null;const Ji=Qe.textSizeData;Qe.iconsInText&&(mn=Ue.imageAtlasTexture?Ue.imageAtlasTexture.size:[0,0],Ni=Ue.imageAtlasTexture?Ue.imageAtlasTexture:null,Bn=Pe||ue.pitch!==0||p.options.rotating||p.options.zooming||Ji.kind==="composite"||Ji.kind==="camera"?xe.LINEAR:xe.NEAREST);const Fa=Ue.glyphAtlasTexture?Ue.glyphAtlasTexture.size:[0,0],Qs=o.b5(Ji,ue.zoom),La=Xu(Bt,Ue.tileID.canonical,Pe,ie,ue,Qe.getProjection(),Yt),zi=Rp(Bt,Ue.tileID.canonical,Pe,ie,ue,Qe.getProjection(),Yt),Ai=p.translatePosMatrix(zi,Ue,I,L,!0),da=p.translatePosMatrix(Bt,Ue,I,L),wa=un?Eo:La,Oa=ie&&!Pe&&!ii;let eo=qe;!ct&&!ue.mercatorFromTransition||ie||(eo=hh(ue));const _l=Mt?eo:qe;let Jl;Jl=Qe.iconsInText?jf(Ji.kind,Qs,Oa,Pe,p,da,wa,Ai,Fa,mn,ot,Ut,Ge,ur,_l,Qe.getProjection()):oh(Ji.kind,Qs,Oa,Pe,p,da,wa,Ai,!0,Fa,!0,ot,Ut,Ge,ur,_l,Qe.getProjection());const Ih=Ue.glyphAtlasTexture?Ue.glyphAtlasTexture:null,Ph=xe.LINEAR,Z0=c.paint.get("text-halo-width").constantOr(1)!==0,Rh=p.terrain&&Pe&&ii?o.a6.invert(o.a6.create(),La):Eo;if(ii&&Qe.text){const Yc=ue.elevation,td=Yc?Yc.getAtTileOffsetFunc(ot,ue.center.lat,ue.worldSize,Qe.getProjection()):null,ko=Pp(Bt,Ue.tileID.canonical,Pe,ie,ue,Qe.getProjection(),Yt);Fp(Qe,Bt,p,!0,ko,zi,Pe,ne,td,ot)}return{program:sn,buffers:Qe.text,uniformValues:Jl,atlasTexture:Ih,atlasTextureIcon:Ni,atlasInterpolation:Ph,atlasInterpolationIcon:Bn,isSDF:!0,hasHalo:Z0,tile:Ue,labelPlaneMatrixInv:Rh}},Sr=Qe.icon.segments.get().length,Pr=Qe.text.segments.get().length,Mr=Sr&&!S.onlyText?fr():null,en=Pr&&!S.onlyIcons?zr():null,Ln=c.paint.get("icon-opacity").constantOr(1),Wr=c.paint.get("text-opacity").constantOr(1);if(Fe&&Qe.canOverlap){$e=!0;const ii=Ln&&!S.onlyText?Qe.icon.segments.get():[],qr=Wr&&!S.onlyIcons?Qe.text.segments.get():[];for(const un of ii)Ct.push({segments:new o.aB([un]),sortKey:un.sortKey,state:Mr});for(const un of qr)Ct.push({segments:new o.aB([un]),sortKey:un.sortKey,state:en})}else S.onlyText||Ct.push({segments:Ln?Qe.icon.segments:new o.aB([]),sortKey:0,state:Mr}),S.onlyIcons||Ct.push({segments:Wr?Qe.text.segments:new o.aB([]),sortKey:0,state:en})}$e&&Ct.sort((ot,Ue)=>ot.sortKey-Ue.sortKey);for(const ot of Ct){const Ue=ot.state;if(Ue)if(p.terrain&&p.terrain.setupElevationDraw(Ue.tile,Ue.program,{useDepthForOcclusion:ue.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Ue.labelPlaneMatrixInv}),ae.activeTexture.set(xe.TEXTURE0),Ue.atlasTexture&&Ue.atlasTexture.bind(Ue.atlasInterpolation,xe.CLAMP_TO_EDGE,!0),Ue.atlasTextureIcon&&(ae.activeTexture.set(xe.TEXTURE1),Ue.atlasTextureIcon&&Ue.atlasTextureIcon.bind(Ue.atlasInterpolationIcon,xe.CLAMP_TO_EDGE,!0)),p.uploadCommonLightUniforms(p.context,Ue.program),Ue.hasHalo){const Qe=Ue.uniformValues;Qe.u_is_halo=1,cl(Ue.buffers,ot.segments,c,p,Ue.program,nt,x,v,Qe,2),Qe.u_is_halo=0}else{if(Ue.isSDF){const Qe=Ue.uniformValues;Ue.hasHalo&&(Qe.u_is_halo=1,cl(Ue.buffers,ot.segments,c,p,Ue.program,nt,x,v,Qe,1)),Qe.u_is_halo=0}cl(Ue.buffers,ot.segments,c,p,Ue.program,nt,x,v,Ue.uniformValues,1)}}}function cl(p,s,c,m,x,v,S,C,I,D){const L=[p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer,p.iconTransitioningVertexBuffer,p.globeExtVertexBuffer,p.zOffsetVertexBuffer];x.draw(m,m.context.gl.TRIANGLES,v,S,C,xr.disabled,I,c.id,p.layoutVertexBuffer,p.indexBuffer,s,c.paint,m.transform.zoom,p.programConfigurations.get(c.id),L,D)}function Zl(p,s,c,m,x,v,S){const C=p.context.gl,I=c.paint.get("fill-pattern"),D=I&&I.constantOr(1);let L,N,H,W,te;S?(N=D&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",L=C.LINES):(N=D?"fillPattern":"fill",L=C.TRIANGLES);for(const ee of m){const ne=s.getTile(ee);if(D&&!ne.patternsLoaded())continue;const K=ne.getBucket(c);if(!K)continue;p.prepareDrawTile();const ae=K.programConfigurations.get(c.id),xe=p.isTileAffectedByFog(ee),ue=p.getOrCreateProgram(N,{config:ae,overrideFog:xe});D&&(p.context.activeTexture.set(C.TEXTURE0),ne.imageAtlasTexture&&ne.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),ae.updatePaintBuffers());const ye=I.constantOr(null);if(ye&&ne.imageAtlas){const Pe=ne.imageAtlas.patternPositions[ye.toString()];Pe&&ae.setConstantPatternPositions(Pe)}const ie=p.translatePosMatrix(ee.projMatrix,ne,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor")),ve=c.paint.get("fill-emissive-strength");if(S){W=K.indexBuffer2,te=K.segments2;const Pe=p.terrain&&p.terrain.renderingToTexture?p.terrain.drapeBufferSize:[C.drawingBufferWidth,C.drawingBufferHeight];H=N==="fillOutlinePattern"&&D?A_(ie,ve,p,ne,Pe):ql(ie,ve,Pe)}else W=K.indexBuffer,te=K.segments,H=D?p0(ie,ve,p,ne):Hc(ie,ve);p.uploadCommonUniforms(p.context,ue,ee.toUnwrapped()),ue.draw(p,L,x,p.stencilModeForClipping(ee),v,xr.disabled,H,c.id,K.layoutVertexBuffer,W,te,c.paint,p.transform.zoom,ae,void 0)}}function cr(p,s,c,m,x,v,S,C){c.resetLayerRenderingStats(p);const I=p.context,D=I.gl,L=p.transform,N=c.paint.get("fill-extrusion-pattern"),H=N.constantOr(1),W=c.paint.get("fill-extrusion-opacity"),te=p.style.enable3dLights(),ee=c.paint.get(te&&!H?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),ne=[c.paint.get("fill-extrusion-ambient-occlusion-intensity"),ee],K=c.layout.get("fill-extrusion-edge-radius"),ae=K>0&&!c.paint.get("fill-extrusion-rounded-roof"),xe=ae?0:K,ue=L.projection.name==="globe"?o.cF():0,ye=L.projection.name==="globe",ie=ye?o.S(L.zoom):0,ve=[o.a5(L.center.lng),o.ae(L.center.lat)],Pe=c.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),Fe=c.paint.get("fill-extrusion-flood-light-intensity"),$e=c.paint.get("fill-extrusion-vertical-scale"),nt=sl(p,c.paint.get("fill-extrusion-cutoff-fade-range")),Ge=c.paint.get("fill-extrusion-emissive-strength"),ft=[];let ct;ye&&ft.push("PROJECTION_GLOBE_VIEW"),ne[0]>0&&ft.push("FAUX_AO"),ae&&ft.push("ZERO_ROOF_RADIUS"),C&&ft.push("HAS_CENTROID"),Fe>0&&ft.push("FLOOD_LIGHT"),nt.shouldRenderCutoff&&ft.push("RENDER_CUTOFF");const Ct=p.renderPass==="shadow",qe=p.shadowRenderer,ot=Ct&&!!qe;p.shadowRenderer&&(p.shadowRenderer.useNormalOffset=!0);let Ue=[0,0,0];if(qe){const Ut=p.style.directionalLight,Bt=p.style.ambientLight;Ut&&Bt&&(Ue=nh(Ut,Bt)),ct=ft.concat(["SHADOWS_SINGLE_CASCADE"])}const Qe=ot?"fillExtrusionDepth":H?"fillExtrusionPattern":"fillExtrusion",Mt=c.getLayerRenderingStats();for(const Ut of m){const Bt=s.getTile(Ut),Yt=Bt.getBucket(c);if(!Yt||Yt.projection.name!==L.projection.name)continue;let or=!1;qe&&(or=qe.getMaxCascadeForTile(Ut.toUnwrapped())===0);const pr=p.isTileAffectedByFog(Ut),ur=Yt.programConfigurations.get(c.id),fr=p.getOrCreateProgram(Qe,{config:ur,defines:or?ct:ft,overrideFog:pr});if(p.terrain&&p.terrain.setupElevationDraw(Bt,fr,{useMeterToDem:!0}),!Yt.centroidVertexBuffer){const Ln=fr.attributes.a_centroid_pos;Ln!==void 0&&D.vertexAttrib2f(Ln,0,0)}!Ct&&qe&&qe.setupShadows(Bt.tileID.toUnwrapped(),fr,"vector-tile",Bt.tileID.overscaledZ),H&&(p.context.activeTexture.set(D.TEXTURE0),Bt.imageAtlasTexture&&Bt.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),ur.updatePaintBuffers());const zr=N.constantOr(null);if(zr&&Bt.imageAtlas){const Ln=Bt.imageAtlas.patternPositions[zr.toString()];Ln&&ur.setConstantPatternPositions(Ln)}const Sr=c.paint.get("fill-extrusion-vertical-gradient");let Pr;if(Ct&&qe){if(D_(Bt.tileID,Yt,p))continue;const Ln=qe.calculateShadowPassMatrixFromTile(Bt.tileID.toUnwrapped());Pr=d0(Ln,xe,$e)}else{const Ln=p.translatePosMatrix(Ut.expandedProjMatrix,Bt,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),Wr=L.projection.createInversionMatrix(L,Ut.canonical);Pr=H?Wl(Ln,p,Sr,W,ne,xe,Ut,Bt,ue,ie,ve,Wr,Pe,$e):f0(Ln,p,Sr,W,ne,xe,Ut,ue,ie,ve,Wr,Pe,$e,Fe,Ue,Ge)}p.uploadCommonUniforms(I,fr,Ut.toUnwrapped(),null,nt);let Mr=Yt.segments;if(L.projection.name==="mercator"&&!Ct&&(Mr=Yt.getVisibleSegments(Bt.tileID,p.terrain,p.transform.getFrustum(0)),!Mr.get().length))continue;if(Mt)if(Ct)for(const Ln of Mr.get())Mt.numRenderedVerticesInShadowPass+=Ln.primitiveLength;else for(const Ln of Mr.get())Mt.numRenderedVerticesInTransparentPass+=Ln.primitiveLength;const en=[];(p.terrain||C)&&en.push(Yt.centroidVertexBuffer),ye&&en.push(Yt.layoutVertexExtBuffer),fr.draw(p,I.gl.TRIANGLES,x,v,S,xr.backCCW,Pr,c.id,Yt.layoutVertexBuffer,Yt.indexBuffer,Mr,c.paint,p.transform.zoom,ur,en)}p.shadowRenderer&&(p.shadowRenderer.useNormalOffset=!1)}function ul(p,s,c,m,x,v,S,C,I,D,L,N,H,W,te,ee,ne,K,ae){const xe=p.context,ue=xe.gl,ye=p.transform,ie=p.transform.zoom,ve=[],Pe=sl(p,c.paint.get("fill-extrusion-cutoff-fade-range"));D==="clear"?(ve.push("CLEAR_SUBPASS"),ae&&(ve.push("CLEAR_FROM_TEXTURE"),xe.activeTexture.set(ue.TEXTURE0),ae.bind(ue.LINEAR,ue.CLAMP_TO_EDGE))):D==="sdf"&&ve.push("SDF_SUBPASS"),ne&&ve.push("HAS_CENTROID"),Pe.shouldRenderCutoff&&ve.push("RENDER_CUTOFF");const Fe=c.layout.get("fill-extrusion-edge-radius"),$e=(nt,Ge,ft,ct,Ct)=>{const qe=Ge.programConfigurations.get(c.id),ot=p.isTileAffectedByFog(nt),Ue=p.getOrCreateProgram("fillExtrusionGroundEffect",{config:qe,defines:ve,overrideFog:ot}),Qe=((Ut,Bt,Yt,or,pr,ur,fr,zr,Sr,Pr,Mr)=>({u_matrix:Bt,u_opacity:Yt,u_ao_pass:or?1:0,u_meter_to_tile:pr,u_ao:ur,u_flood_light_intensity:fr,u_flood_light_color:zr,u_attenuation:Sr,u_edge_radius:Pr,u_fb:0,u_fb_size:Mr}))(0,ct,L,I,Ct,[N,H*Ct],W,te,ee,ie>=17?0:Fe*Ct,ae?ae.size[0]:0),Mt=[];ne&&Mt.push(Ge.hiddenByLandmarkVertexBuffer),p.uploadCommonUniforms(xe,Ue,nt.toUnwrapped(),null,Pe),Ue.draw(p,xe.gl.TRIANGLES,x,v,S,C,Qe,c.id,Ge.vertexBuffer,Ge.indexBuffer,ft,c.paint,ie,qe,Mt)};for(const nt of m){const Ge=s.getTile(nt),ft=Ge.getBucket(c);if(!ft||ft.projection.name!==ye.projection.name||!ft.groundEffect||ft.groundEffect&&!ft.groundEffect.hasData())continue;const ct=ft.groundEffect,Ct=1/ft.tileToMeter;{const qe=p.translatePosMatrix(nt.projMatrix,Ge,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),ot=ct.getDefaultSegment();$e(nt,ct,ot,qe,Ct)}if(K)for(let qe=0;qe<4;qe++){const ot=o.cG[qe](nt),Ue=s.getTile(ot);if(!Ue)continue;const Qe=Ue.getBucket(c);if(!Qe||Qe.projection.name!==ye.projection.name||!Qe.groundEffect||Qe.groundEffect&&!Qe.groundEffect.hasData())continue;const Mt=Qe.groundEffect;let Ut,Bt;qe===0?(Ut=[-o.V,0,0],Bt=1):qe===1?(Ut=[o.V,0,0],Bt=0):qe===2?(Ut=[0,-o.V,0],Bt=3):(Ut=[0,o.V,0],Bt=2);const Yt=Mt.regionSegments[Bt];if(!Yt)continue;const or=new Float32Array(16);o.a6.translate(or,nt.projMatrix,Ut),$e(nt,Mt,Yt,p.translatePosMatrix(or,Ge,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),Ct)}}}function Ov(p,s,c,m,x,v,S){m.centroidVertexArray.length===0&&m.createCentroidsBuffer();const C=v?v.findDEMTileFor(c):null;if(!(C&&C.dem||S))return;const I=K=>new o.P(Math.ceil((K+o.cJ)*o.cK),0),D=K=>{const ae=s.getSource().minzoom,xe=ye=>{const ie=s.getTileByID(ye);if(ie&&ie.hasData())return ie.getBucket(x)},ue=[0,-1,1];for(const ye of ue){if(K.overscaledZ+ye<ae)continue;const ie=xe(K.calculateScaledKey(K.overscaledZ+ye));if(ie)return ie}},L=[0,0,0],N=(K,ae)=>(L[0]=Math.min(K.min.y,ae.min.y),L[1]=Math.max(K.max.y,ae.max.y),L[2]=o.V-ae.min.x>K.max.x?ae.min.x-o.V:K.max.x,L),H=(K,ae)=>(L[0]=Math.min(K.min.x,ae.min.x),L[1]=Math.max(K.max.x,ae.max.x),L[2]=o.V-ae.min.y>K.max.y?ae.min.y-o.V:K.max.y,L),W=[(K,ae)=>N(K,ae),(K,ae)=>N(ae,K),(K,ae)=>H(K,ae),(K,ae)=>H(ae,K)],te=(K,ae,xe,ue,ye,ie,ve)=>{if(!v)return 0;const Pe=[[ie?xe:K,ie?K:xe,0],[ie?xe:ae,ie?ae:xe,0]],Fe=ve<0?o.V+ve:ve,$e=[ie?Fe:(K+ae)/2,ie?(K+ae)/2:Fe,0];return xe===0&&ve<0||xe!==0&&ve>0?v.getForTilePoints(ye,[$e],!0,ue):Pe.push($e),v.getForTilePoints(c,Pe,!0,C),Math.max(Pe[0][2],Pe[1][2],$e[2])/v.exaggeration()};for(let K=0;K<4;K++){const ae=m.borderFeatureIndices[K];if(ae.length===0)continue;const xe=o.cG[K](c),ue=D(xe);if(!(ue&&ue instanceof o.cH)||m.borderDoneWithNeighborZ[K]===ue.canonical.z)continue;ue.centroidVertexArray.length===0&&ue.createCentroidsBuffer();const ye=v?v.findDEMTileFor(xe):null;if(!(ye&&ye.dem||S))continue;const ie=(K<2?1:5)-K,ve=ue.borderDoneWithNeighborZ[ie]!==m.canonical.z,Pe=ue.borderFeatureIndices[ie];let Fe=0;if(m.canonical.z!==ue.canonical.z){for(const $e of ae)m.showCentroid(m.featuresOnBorder[$e]);if(ve)for(const $e of Pe)ue.showCentroid(ue.featuresOnBorder[$e]);m.borderDoneWithNeighborZ[K]=ue.canonical.z,ue.borderDoneWithNeighborZ[ie]=m.canonical.z}for(const $e of ae){const nt=m.featuresOnBorder[$e],Ge=m.centroidData[nt.centroidDataIndex],ft=nt.borders[K];let ct;for(;Fe<Pe.length;){ct=ue.featuresOnBorder[Pe[Fe]];const Ct=ct.borders[ie];if(Ct[1]>ft[0]+3||Ct[0]>ft[0]-3)break;ue.showCentroid(ct),Fe++}if(ct&&Fe<Pe.length){const Ct=Fe;let qe=0;for(;!(ct.borders[ie][0]>ft[1]-3)&&(qe++,++Fe!==Pe.length);)ct=ue.featuresOnBorder[Pe[Fe]];if(ct=ue.featuresOnBorder[Pe[Ct]],qe>1){const Qe=ct.borders[ie];Math.abs(ft[0]-Qe[0])<3&&Math.abs(ft[1]-Qe[1])<3&&(qe=1,Fe=Ct+1)}else if(qe===0){m.showCentroid(nt);continue}const ot=ue.centroidData[ct.centroidDataIndex];S&&qe===1&&(((ee=Ge).flags|(ne=ot).flags)&o.cI?(ee.flags|=o.cI,ne.flags|=o.cI):(ee.flags&=~o.cI,ne.flags&=~o.cI));const Ue=nt.intersectsCount()>1||ct.intersectsCount()>1;if(qe>1)Fe=Ct,Ge.centroidXY=ot.centroidXY=new o.P(0,0);else if(ye&&ye.dem&&!Ue){const Qe=W[K](Ge,ot),Mt=K%2?o.V-1:0,Ut=te(Qe[0],Math.min(o.V-1,Qe[1]),Mt,ye,xe,K<2,Qe[2]);Ge.centroidXY=ot.centroidXY=I(Ut)}else Ue?Ge.centroidXY=ot.centroidXY=new o.P(0,0):(Ge.centroidXY=m.encodeBorderCentroid(nt),ot.centroidXY=ue.encodeBorderCentroid(ct));m.writeCentroidToBuffer(Ge),ue.writeCentroidToBuffer(ot)}else m.showCentroid(nt)}m.borderDoneWithNeighborZ[K]=ue.canonical.z,ue.borderDoneWithNeighborZ[ie]=m.canonical.z}var ee,ne;(m.needsCentroidUpdate||!m.centroidVertexBuffer&&m.centroidVertexArray.length!==0)&&m.uploadCentroid(p)}const Nv=[1,0,0],y0=[0,1,0],R_=[0,0,1];function D_(p,s,c){const m=c.transform,x=c.shadowRenderer;if(!x)return!0;const v=p.toUnwrapped(),S=m.tileSize*x._cascades[c.currentShadowCascade].scale;let C=s.maxHeight;if(m.elevation){const ee=m.elevation.getMinMaxForTile(p);ee&&(C+=ee.max)}const I=[...x.shadowDirection];I[2]=-I[2];const D=x.computeSimplifiedTileShadowVolume(v,C,S,I);if(!D)return!1;const L=[Nv,y0,R_,I,[I[0],0,I[2]],[0,I[1],I[2]]],N=m.projection.name==="globe",H=m.scaleZoom(S),W=o.bq.fromInvProjectionMatrix(m.invProjMatrix,m.worldSize,H,!N),te=x.getCurrentCascadeFrustum();return W.intersectsPrecise(D.vertices,D.planes,L)===0||te.intersectsPrecise(D.vertices,D.planes,L)===0}function F_(p){return[p[0]*o.cL,p[1]*o.cL,p[2]*o.cL,0]}function v0(p,s,c,m,x,v,S,C,I){const D=m.getSource(),L=c.globeSharedBuffers;if(!L)return;let N,H,W;if(s&&(N=m.getTile(s)),D instanceof o.ap?(H=D.texture,W=o.cj(0,0,c.transform)):N&&s&&(H=N.texture,W=o.cj(s.canonical.z,s.canonical.x,c.transform)),!H||!W)return;p||(W=o.a6.scale(o.a6.create(),W,[1,-1,1]));const te=c.context,ee=te.gl,ne=x.paint.get("raster-resampling")==="nearest"?ee.NEAREST:ee.LINEAR,K=c.colorModeForDrapableLayerRenderPass(v),ae=S.defines;ae.push("GLOBE_POLES");const xe=new _r(ee.LEQUAL,_r.ReadWrite,c.depthRangeFor3D),ue=Float32Array.from(c.transform.expandedFarZProjMatrix),ye=Float32Array.from(o.aT(o.ci(new o.bs(0,0,0))));c.terrain&&c.terrain.prepareDrawTile(),te.activeTexture.set(ee.TEXTURE0),H.bind(ne,ee.CLAMP_TO_EDGE),te.activeTexture.set(ee.TEXTURE1),H.bind(ne,ee.CLAMP_TO_EDGE),H.useMipmap&&te.extTextureFilterAnisotropic&&c.transform.pitch>20&&ee.texParameterf(ee.TEXTURE_2D,te.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,te.extTextureFilterAnisotropicMax);const[ie,ve,Pe,Fe]=s?L.getPoleBuffers(s.canonical.z,!1):L.getPoleBuffers(0,!0),$e=x.paint.get("raster-elevation");let nt;p?(nt=ie,c.renderDefaultNorthPole=$e!==0):(nt=ve,c.renderDefaultSouthPole=$e!==0);const Ge=F_(S.mix),ft=((Ct,qe,ot,Ue,Qe,Mt,Ut,Bt,Yt,or,pr,ur,fr)=>_0(Ct,qe,ot,new Float32Array(16),new Float32Array(9),[0,0],Ue,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Mt,[0,0],Bt,2,or,pr,ur,1,0,fr))(ue,ye,W,o.S(c.transform.zoom),0,x,0,$e,0,Ge,S.offset,S.range,v),ct=c.getOrCreateProgram("raster",{defines:ae});c.uploadCommonUniforms(te,ct,null),ct.draw(c,ee.TRIANGLES,xe,I,K,C,ft,x.id,nt,Pe,Fe)}function w0(p){const s=p._nearZ,c=p.projection.farthestPixelDistance(p),m=c-s,x=.2*p.height,v=s+x;return[s,c,(v-x-s)/m,(v-s)/m]}function b0(p,s,c,m){if(p)return s instanceof ge&&p instanceof Ul?s.getTextureDescriptor(p,c,!0):{texture:p.texture,mix:F_(m.mix),offset:m.offset,buffer:0,tileSize:1}}function T0(p,s,c){if(!p)return null;const m=s.getTextureDescriptor(p,c,!0);if(!m)return null;let{texture:x,mix:v,offset:S,tileSize:C,buffer:I,format:D}=m;if(!x||!D)return null;let L=!1;return D==="uint32"&&(L=!0,v[3]=0,v=Vf(o.cM,v,[0,c.paint.get("raster-particle-max-speed")]),S=k_(o.cM,S,[0,c.paint.get("raster-particle-max-speed")])),{texture:x,textureOffset:[I/(C+2*I),C/(C+2*I)],tileSize:C,scalarData:L,scale:v,offset:S,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[D]]}}function E0(p){const s=p._nearZ,c=p.projection.farthestPixelDistance(p),m=c-s,x=.2*p.height,v=s+x;return[s,c,(v-x-s)/m,(v-s)/m]}const Ra=new o.ax(1,0,0,1),hl=new o.ax(0,1,0,1),L_=new o.ax(0,0,1,1),S0=new o.ax(1,0,1,1),A0=new o.ax(0,1,1,1);function fl(p,s,c,m,x,v,S){const C=p.context,I=p.transform,D=C.gl,L=I.projection.name==="globe",N=L?["PROJECTION_GLOBE_VIEW"]:[];let H=o.a6.clone(c.projMatrix);if(L&&o.S(I.zoom)>0){const Ge=o.aS(c.canonical,I),ft=o.cN(Ge);H=o.a6.multiply(new Float32Array(16),I.globeMatrix,ft),o.a6.multiply(H,I.projMatrix,H)}const W=o.a6.create();W[12]+=2*x/(o.f.devicePixelRatio*I.width),W[13]+=2*v/(o.f.devicePixelRatio*I.height),o.a6.multiply(H,W,H);const te=p.getOrCreateProgram("debug",{defines:N}),ee=s.getTileByID(c.key);p.terrain&&p.terrain.setupElevationDraw(ee,te);const ne=_r.disabled,K=Cr.disabled,ae=p.colorModeForRenderPass(),xe="$debug";C.activeTexture.set(D.TEXTURE0),p.emptyTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),L?ee._makeGlobeTileDebugBuffers(p.context,I):ee._makeDebugTileBoundsBuffers(p.context,I.projection);const ue=ee._tileDebugBuffer||p.debugBuffer,ye=ee._tileDebugIndexBuffer||p.debugIndexBuffer,ie=ee._tileDebugSegments||p.debugSegments;if(te.draw(p,D.LINE_STRIP,ne,K,ae,xr.disabled,m0(H,m),xe,ue,ye,ie,null,null,null,[ee._globeTileDebugBorderBuffer]),S){const Ge=ee.latestRawTileData,ft=Math.floor((Ge&&Ge.byteLength||0)/1024);let ct=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(ct+=` => ${c.overscaledZ}`),ct+=` ${ee.state}`,ct+=` ${ft}kb`,function(Ct,qe){Ct.initDebugOverlayCanvas();const ot=Ct.debugOverlayCanvas,Ue=Ct.context.gl,Qe=Ct.debugOverlayCanvas.getContext("2d");Qe.clearRect(0,0,ot.width,ot.height),Qe.shadowColor="white",Qe.shadowBlur=2,Qe.lineWidth=1.5,Qe.strokeStyle="white",Qe.textBaseline="top",Qe.font="bold 36px Open Sans, sans-serif",Qe.fillText(qe,5,5),Qe.strokeText(qe,5,5),Ct.debugOverlayTexture.update(ot),Ct.debugOverlayTexture.bind(Ue.LINEAR,Ue.CLAMP_TO_EDGE)}(p,ct)}const ve=s.getTile(c).tileSize,Pe=512/Math.min(ve,512)*(c.overscaledZ/I.zoom)*.5,Fe=ee._tileDebugTextBuffer||p.debugBuffer,$e=ee._tileDebugTextIndexBuffer||p.quadTriangleIndexBuffer,nt=ee._tileDebugTextSegments||p.debugSegments;te.draw(p,D.TRIANGLES,ne,K,jr.alphaBlended,xr.disabled,m0(H,o.ax.transparent,Pe),xe,Fe,$e,nt,null,null,null,[ee._globeTileDebugTextBuffer])}function C0(p,s,c,m){ri(p,0,s+c/2,p.transform.width,c,m)}function Ya(p,s,c,m){ri(p,s-c/2,0,c,p.transform.height,m)}function ri(p,s,c,m,x,v){const S=p.context,C=S.gl;C.enable(C.SCISSOR_TEST),C.scissor(s*o.f.devicePixelRatio,c*o.f.devicePixelRatio,m*o.f.devicePixelRatio,x*o.f.devicePixelRatio),S.clear({color:v}),C.disable(C.SCISSOR_TEST)}const Wf=o.ay([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:k0}=Wf;function So(p,s,c,m){p.emplaceBack(s,c,m)}class M0{constructor(s){this.vertexArray=new o.az,this.indices=new o.aw,So(this.vertexArray,-1,-1,1),So(this.vertexArray,1,-1,1),So(this.vertexArray,-1,1,1),So(this.vertexArray,1,1,1),So(this.vertexArray,-1,-1,-1),So(this.vertexArray,1,-1,-1),So(this.vertexArray,-1,1,-1),So(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=s.createVertexBuffer(this.vertexArray,k0),this.indexBuffer=s.createIndexBuffer(this.indices),this.segment=o.aB.simpleSegment(0,0,36,12)}}function Xl(p,s,c,m,x,v){const S=p.context.gl,C=s.paint.get("sky-atmosphere-color"),I=s.paint.get("sky-atmosphere-halo-color"),D=s.paint.get("sky-atmosphere-sun-intensity"),L=((N,H,W,te,ee)=>({u_matrix_3f:N,u_sun_direction:H,u_sun_intensity:W,u_color_tint_r:[te.r,te.g,te.b,te.a],u_color_tint_m:[ee.r,ee.g,ee.b,ee.a],u_luminance:5e-5}))(o.co.fromMat4(o.co.create(),m),x,D,C,I);S.framebufferTexture2D(S.FRAMEBUFFER,S.COLOR_ATTACHMENT0,S.TEXTURE_CUBE_MAP_POSITIVE_X+v,s.skyboxTexture,0),c.draw(p,S.TRIANGLES,_r.disabled,Cr.disabled,jr.unblended,xr.frontCW,L,"skyboxCapture",s.skyboxGeometry.vertexBuffer,s.skyboxGeometry.indexBuffer,s.skyboxGeometry.segment)}const zv=o.ay([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Wc{constructor(s){const c=new o.cO;c.emplaceBack(-1,1,1,0,0),c.emplaceBack(1,1,1,1,0),c.emplaceBack(1,-1,1,1,1),c.emplaceBack(-1,-1,1,0,1);const m=new o.aw;m.emplaceBack(0,1,2),m.emplaceBack(2,3,0),this.vertexBuffer=s.createVertexBuffer(c,zv.members),this.indexBuffer=s.createIndexBuffer(m),this.segments=o.aB.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const fh=o.ay([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class jt{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class mr{constructor(s){this.colorModeAlphaBlendedWriteRGB=new jr([1,Qo,1,Qo],o.ax.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new jr([1,0,1,0],o.ax.transparent,[!1,!1,!1,!0]),this.params=new jt,this.updateNeeded=!0,s.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),s.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),s.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),s.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(s){const c=s.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Wc(c);const m=this.params.sizeRange,x=this.params.intensityRange,v=function(L){const N=o.aA(30),H=[];for(let W=0;W<L;++W){const te=2*Math.PI*N(),ee=Math.acos(1-2*N())-.5*Math.PI;H.push(o.N.fromValues(Math.cos(ee)*Math.cos(te),Math.cos(ee)*Math.sin(te),Math.sin(ee)))}return H}(this.params.starsCount),S=o.aA(300),C=new o.cP,I=new o.aw;let D=0;for(let L=0;L<v.length;++L){const N=o.N.scale([],v[L],200),H=Math.max(0,1+.01*m*(1*S()-.5)),W=Math.max(0,1+.01*x*(1*S()-.5));C.emplaceBack(N[0],N[1],N[2],-1,-1,H,W),C.emplaceBack(N[0],N[1],N[2],1,-1,H,W),C.emplaceBack(N[0],N[1],N[2],1,1,H,W),C.emplaceBack(N[0],N[1],N[2],-1,1,H,W),I.emplaceBack(D+0,D+1,D+2),I.emplaceBack(D+0,D+2,D+3),D+=4}this.starsVx=c.createVertexBuffer(C,fh.members),this.starsIdx=c.createIndexBuffer(I),this.starsSegments=o.aB.simpleSegment(0,0,C.length,I.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(s,c){const m=s.context,x=m.gl,v=s.transform,S=new _r(x.LEQUAL,_r.ReadOnly,[0,1]),C=o.S(v.zoom),I=c.properties.get("color").toArray01(),D=c.properties.get("high-color").toArray01(),L=c.properties.get("space-color").toArray01PremultipliedAlpha(),N=5e-4,H=o.cQ(c.properties.get("horizon-blend"),0,1,N,.25),W=o.cd(s,m,v)&&H===N?v.worldSize/(2*Math.PI*1.025)-1:v.globeRadius,te=s.frameCounter/1e3%1,ee=o.N.length(v.globeCenterInViewSpace),ne=Math.sqrt(Math.pow(ee,2)-Math.pow(W,2)),K=Math.acos(ne/ee),ae=xe=>{const ue=v.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];xe&&ue.push("ALPHA_PASS");const ye=s.getOrCreateProgram("globeAtmosphere",{defines:ue}),ie=((Pe,Fe,$e,nt,Ge,ft,ct,Ct,qe,ot,Ue,Qe)=>({u_frustum_tl:Pe,u_frustum_tr:Fe,u_frustum_br:$e,u_frustum_bl:nt,u_horizon:Ge,u_transition:ft,u_fadeout_range:ct,u_color:Ct,u_high_color:qe,u_space_color:ot,u_temporal_offset:Ue,u_horizon_angle:Qe}))(v.frustumCorners.TL,v.frustumCorners.TR,v.frustumCorners.BR,v.frustumCorners.BL,v.frustumCorners.horizon,C,H,I,D,L,te,K);s.uploadCommonUniforms(m,ye);const ve=this.atmosphereBuffer;ve&&ye.draw(s,x.TRIANGLES,S,Cr.disabled,xe?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,xr.backCW,ie,xe?"atmosphere_glow_alpha":"atmosphere_glow",ve.vertexBuffer,ve.indexBuffer,ve.segments)};ae(!1),ae(!0)}drawStars(s,c){const m=o.aa(c.properties.get("star-intensity"),0,1);if(m===0)return;const x=s.context,v=x.gl,S=s.transform,C=s.getOrCreateProgram("stars"),I=o.bi.identity([]);o.bi.rotateX(I,I,-S._pitch),o.bi.rotateZ(I,I,-S.angle),o.bi.rotateX(I,I,o.bj(S._center.lat)),o.bi.rotateY(I,I,-o.bj(S._center.lng));const D=o.a6.fromQuat(new Float32Array(16),I),L=o.a6.multiply([],S.starsProjMatrix,D),N=o.co.fromMat4([],D),H=o.co.invert([],N),W=[0,1,0];o.N.transformMat3(W,W,H),o.N.scale(W,W,this.params.sizeMultiplier);const te=[1,0,0];o.N.transformMat3(te,te,H),o.N.scale(te,te,this.params.sizeMultiplier);const ee=(ne=W,K=te,ae=m,{u_matrix:Float32Array.from(L),u_up:ne,u_right:K,u_intensity_multiplier:ae});var ne,K,ae;s.uploadCommonUniforms(x,C),this.starsVx&&this.starsIdx&&C.draw(s,v.TRIANGLES,_r.disabled,Cr.disabled,this.colorModeAlphaBlendedWriteRGB,xr.disabled,ee,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function Yl(p,s){const c=[...p],m=s.cameraWorldSizeForFog/s.worldSize,x=o.a6.identity([]);return o.a6.scale(x,x,[m,m,1]),o.a6.multiply(c,x,c),o.a6.multiply(c,s.worldToFogMatrix,c),c}function ni(p,s,c,m){const x=c.material,v=m.context,{baseColorTexture:S,metallicRoughnessTexture:C}=x.pbrMetallicRoughness,{normalTexture:I,occlusionTexture:D,emissionTexture:L}=x;function N(H,W,te){if(H&&(p.push(W),v.activeTexture.set(v.gl.TEXTURE0+te),H.gfxTexture)){const{minFilter:ee,magFilter:ne,wrapS:K,wrapT:ae}=H.sampler;H.gfxTexture.bindExtraParam(ee,ne,K,ae)}}N(S,"HAS_TEXTURE_u_baseColorTexture",Ki.BaseColor),N(C,"HAS_TEXTURE_u_metallicRoughnessTexture",Ki.MetallicRoughness),N(I,"HAS_TEXTURE_u_normalTexture",Ki.Normal),N(D,"HAS_TEXTURE_u_occlusionTexture",Ki.Occlusion),N(L,"HAS_TEXTURE_u_emissionTexture",Ki.Emission),c.texcoordBuffer&&(p.push("HAS_ATTRIBUTE_a_uv_2f"),s.push(c.texcoordBuffer)),c.colorBuffer&&(p.push(c.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),s.push(c.colorBuffer)),c.normalBuffer&&(p.push("HAS_ATTRIBUTE_a_normal_3f"),s.push(c.normalBuffer)),c.pbrBuffer&&(p.push("HAS_ATTRIBUTE_a_pbr"),p.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),s.push(c.pbrBuffer)),x.alphaMode!=="OPAQUE"&&x.alphaMode!=="MASK"||p.push("UNPREMULT_TEXTURE_IN_SHADER"),x.defined||p.push("DIFFUSE_SHADED"),p.push("USE_STANDARD_DERIVATIVES")}function dh(p,s,c,m,x,v){const S=c.paint.get("model-opacity"),C=s.context,I=new _r(s.context.gl.LEQUAL,_r.ReadWrite,s.depthRangeFor3D),D=s.transform,L=p.mesh,N=L.material,H=N.pbrMetallicRoughness,W=s.style.fog;let te;te=s.transform.projection.zAxisUnit==="pixels"?[...p.nodeModelMatrix]:o.a6.multiply([],m.zScaleMatrix,p.nodeModelMatrix),o.a6.multiply(te,m.negCameraPosMatrix,te);const ee=o.a6.invert([],te);o.a6.transpose(ee,ee);const ne=c.paint.get("model-emissive-strength").constantOr(0),K=Gf(new Float32Array(p.worldViewProjection),new Float32Array(te),new Float32Array(ee),s,S,H.baseColorFactor,N.emissiveFactor,H.metallicFactor,H.roughnessFactor,N,ne,c),ae={defines:[]},xe=[];ni(ae.defines,xe,L,s);const ue=s.shadowRenderer;ue&&(ue.useNormalOffset=!1);let ye=null;if(W){const Pe=Yl(p.nodeModelMatrix,s.transform);if(ye=new Float32Array(Pe),D.projection.name!=="globe"){const Fe=L.aabb.min,$e=L.aabb.max,[nt,Ge]=W.getOpacityForBounds(Pe,Fe[0],Fe[1],$e[0],$e[1]);ae.overrideFog=nt>=ln||Ge>=ln}}const ie=sl(s,c.paint.get("model-cutoff-fade-range"));ie.shouldRenderCutoff&&ae.defines.push("RENDER_CUTOFF");const ve=s.getOrCreateProgram("model",ae);s.uploadCommonUniforms(C,ve,null,ye,ie),s.renderPass!=="shadow"&&ue&&ue.setupShadowsFromMatrix(p.nodeModelMatrix,ve),ve.draw(s,C.gl.TRIANGLES,I,x,v,L.material.doubleSided?xr.disabled:xr.backCCW,K,c.id,L.vertexBuffer,L.indexBuffer,L.segments,c.paint,s.transform.zoom,void 0,xe)}function ph(p,s,c,m,x,v,S){let C;C=p.projection.name==="globe"?o.cS(c,p):[...c],o.a6.multiply(C,C,s.matrix);const I=o.a6.multiply([],m,C);if(s.meshes)for(const D of s.meshes){if(D.material.alphaMode!=="BLEND"){S.push({mesh:D,depth:0,modelIndex:x,worldViewProjection:I,nodeModelMatrix:C});continue}const L=o.N.transformMat4([],D.centroid,I);L[2]>0&&v.push({mesh:D,depth:L[2],modelIndex:x,worldViewProjection:I,nodeModelMatrix:C})}if(s.children)for(const D of s.children)ph(p,D,c,m,x,v,S)}function tt(p,s,c,m){const x=c.shadowRenderer;if(!x)return;const v=x.getShadowPassDepthMode(),S=x.getShadowPassColorMode(),C=x.calculateShadowPassMatrixFromMatrix(s),I=uh(C);c.getOrCreateProgram("modelDepth",{defines:c._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(c,c.context.gl.TRIANGLES,v,Cr.disabled,S,xr.backCCW,I,m.id,p.vertexBuffer,p.indexBuffer,p.segments,m.paint,c.transform.zoom,void 0,void 0)}function I0(p,s,c){const m=s.updateZoomBasedPaintProperties(),x=function(v,S,C){let I,D,L,N=v.terrain?v.terrain.exaggeration():0;if(v.terrain&&N>0){const H=v.terrain,W=H.findDEMTileFor(C);W&&W.dem?I=o.cU.create(H,C,W):N=0}if(N===0&&(S.terrainElevationMin=0,S.terrainElevationMax=0),N===S.validForExaggeration&&(N===0||I&&I._demTile&&I._demTile.tileID===S.validForDEMTile.id&&I._dem._timestamp===S.validForDEMTile.timestamp))return!1;for(const H in S.instancesPerModel){const W=S.instancesPerModel[H];for(let te=0;te<W.instancedDataArray.length;++te){const ee=(I?N*I.getElevationAt(0|W.instancedDataArray.float32[16*te],0|W.instancedDataArray.float32[16*te+1],!0,!0):0)+W.instancesEvaluatedElevation[te];W.instancedDataArray.float32[16*te+6]=ee,D=D?Math.min(S.terrainElevationMin,ee):ee,L=L?Math.max(S.terrainElevationMax,ee):ee}}return S.terrainElevationMin=D||0,S.terrainElevationMax=L||0,S.validForExaggeration=N,S.validForDEMTile=I&&I._demTile?{id:I._demTile.tileID,timestamp:I._dem._timestamp}:{id:void 0,timestamp:0},!0}(p,s,c);(m||x)&&(s.uploaded=!1,s.upload(p.context))}const Ka={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new o.bS([0,0,0],[o.V,o.V,0])};function O_(p,s){const c=1<<p.canonical.z,m=s.getFreeCameraOptions().position,x=s.elevation,v=p.canonical.x/c,S=(p.canonical.x+1)/c,C=p.canonical.y/c,I=(p.canonical.y+1)/c;let D=s._centerAltitude;if(x){const W=x.getMinMaxForTile(p);W&&W.max>D&&(D=W.max)}const L=o.aa(m.x,v,S)-m.x,N=o.aa(m.y,C,I)-m.y,H=o.bl(D,s.center.lat)-m.z;return s._zoomFromMercatorZ(Math.sqrt(L*L+N*N+H*H))}function P0(p,s,c,m,x,v,S){const C=p.context,I=p.renderPass==="shadow",D=p.shadowRenderer,L=I&&D?D.getShadowPassDepthMode():new _r(C.gl.LEQUAL,_r.ReadWrite,p.depthRangeFor3D),N=p.isTileAffectedByFog(v);if(c.meshes)for(const H of c.meshes){const W=["MODEL_POSITION_ON_GPU"],te=[];let ee,ne,K;m.instancedDataArray.length>20&&W.push("INSTANCED_ARRAYS");const ae=sl(p,s.paint.get("model-cutoff-fade-range"));if(ae.shouldRenderCutoff&&W.push("RENDER_CUTOFF"),I&&D)ee=p.getOrCreateProgram("modelDepth",{defines:W}),ne=uh(S.shadowTileMatrix,S.shadowTileMatrix,Float32Array.from(c.matrix)),K=D.getShadowPassColorMode();else{ni(W,te,H,p),ee=p.getOrCreateProgram("model",{defines:W,overrideFog:N});const ue=H.material,ye=ue.pbrMetallicRoughness,ie=s.paint.get("model-opacity"),ve=s.paint.get("model-emissive-strength").constantOr(0);ne=Gf(v.expandedProjMatrix,Float32Array.from(c.matrix),new Float32Array(16),p,ie,ye.baseColorFactor,ue.emissiveFactor,ye.metallicFactor,ye.roughnessFactor,ue,ve,s,x),D&&(S.shadowUniformsInitialized?ee.setShadowUniformValues(C,D.getShadowUniformValues()):(D.setupShadows(v.toUnwrapped(),ee,"model-tile",v.overscaledZ),S.shadowUniformsInitialized=!0)),K=ae.shouldRenderCutoff||ie<1||ue.alphaMode!=="OPAQUE"?jr.alphaBlended:jr.unblended}p.uploadCommonUniforms(C,ee,v.toUnwrapped(),null,ae);const xe=H.material.doubleSided?xr.disabled:xr.backCCW;if(m.instancedDataArray.length>20)te.push(m.instancedDataBuffer),ee.draw(p,C.gl.TRIANGLES,L,Cr.disabled,K,xe,ne,s.id,H.vertexBuffer,H.indexBuffer,H.segments,s.paint,p.transform.zoom,void 0,te,m.instancedDataArray.length);else{const ue=I?"u_instance":"u_normal_matrix";for(let ye=0;ye<m.instancedDataArray.length;++ye)ne[ue]=new Float32Array(m.instancedDataArray.arrayBuffer,64*ye,16),ee.draw(p,C.gl.TRIANGLES,L,Cr.disabled,K,xe,ne,s.id,H.vertexBuffer,H.indexBuffer,H.segments,s.paint,p.transform.zoom,void 0,te)}}if(c.children)for(const H of c.children)P0(p,s,H,m,x,v,S)}const qc=[1,-1,1];function Bv(p,s,c,m){if(!c.modelManager)return!0;const x=c.modelManager;if(!c.shadowRenderer)return!0;const v=c.shadowRenderer,S=s.aabb;let C=!0,I=p.maxHeight;if(I===0){let L=0;for(const N in p.instancesPerModel){const H=x.getModel(N,m);H?L=Math.max(L,Math.max(Math.max(H.aabb.max[0],H.aabb.max[1]),H.aabb.max[2])):C=!1}I=p.maxScale*L*1.41+p.maxVerticalOffset,C&&(p.maxHeight=I)}S.max[2]=I,S.min[2]+=p.terrainElevationMin,S.max[2]+=p.terrainElevationMax,o.N.transformMat4(S.min,S.min,s.tileMatrix),o.N.transformMat4(S.max,S.max,s.tileMatrix);const D=S.intersects(v.getCurrentCascadeFrustum());return c.currentShadowCascade===0&&(p.isInsideFirstShadowMapFrustum=D===2),D===0}class Uv{}class N_{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(s,c,m){{const N=this._storage.get(c.id);if(N)return N.lastUsedFrameIdx=s,N.buf}const x=m.gl,v=x.getBufferParameter(x.ELEMENT_ARRAY_BUFFER,x.BUFFER_SIZE),S=new ArrayBuffer(v),C=new Int16Array(S);x.getBufferSubData(x.ELEMENT_ARRAY_BUFFER,0,new Int16Array(S));const I=new o.cW;for(let N=0;N<v/2;N+=3){const H=C[N],W=C[N+1],te=C[N+2];I.emplaceBack(H,W),I.emplaceBack(W,te),I.emplaceBack(te,H)}const D=m.bindVertexArrayOES.current,L=new Uv;return L.buf=new Rt(m,I),L.lastUsedFrameIdx=s,this._storage.set(c.id,L),m.bindVertexArrayOES.set(D),L.buf}update(s){for(const[c,m]of this._storage)s-m.lastUsedFrameIdx>30&&(m.buf.destroy(),this._storage.delete(c))}destroy(){for(const[s,c]of this._storage)c.buf.destroy(),this._storage.delete(s)}}class mh{registerParameter(s,c,m,x,v){}registerButton(s,c,m){}}const gh={symbol:function(p,s,c,m,x){if(p.renderPass!=="translucent")return;const v=Cr.disabled,S=p.colorModeForRenderPass();c.layout.get("text-variable-anchor")&&function(D,L,N,H,W,te,ee){const ne=L.transform,K=W==="map",ae=te==="map";for(const xe of D){const ue=H.getTile(xe),ye=ue.getBucket(N);if(!ye||!ye.text||!ye.text.segments.get().length)continue;const ie=o.b5(ye.textSizeData,ne.zoom),ve=Ku(xe,ye.getProjection(),ne),Pe=ne.calculatePixelsToTileUnitsMatrix(ue),Fe=Xu(ve,ue.tileID.canonical,ae,K,ne,ye.getProjection(),Pe),$e=ye.hasIconTextFit()&&ye.hasIconData();if(ie){const nt=Math.pow(2,ne.zoom-ue.tileID.overscaledZ);P_(ye,K,ae,ee,o.cx,ne,Fe,xe,nt,ie,$e)}}}(m,p,c,s,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),x);const C=c.paint.get("icon-opacity").constantOr(1)!==0,I=c.paint.get("text-opacity").constantOr(1)!==0;c.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(C||I)?Hf(p,s,c,m,v,S):(C&&Hf(p,s,c,m,v,S,{onlyIcons:!0}),I&&Hf(p,s,c,m,v,S,{onlyText:!0})),s.map.showCollisionBoxes&&(Ms(p,s,c,m,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),Ms(p,s,c,m,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))},circle:function(p,s,c,m){if(p.renderPass!=="translucent")return;const x=c.paint.get("circle-opacity"),v=c.paint.get("circle-stroke-width"),S=c.paint.get("circle-stroke-opacity"),C=c.layout.get("circle-sort-key").constantOr(1)!==void 0,I=c.paint.get("circle-emissive-strength");if(x.constantOr(1)===0&&(v.constantOr(1)===0||S.constantOr(1)===0))return;const D=p.context,L=D.gl,N=p.transform,H=p.depthModeForSublayer(0,_r.ReadOnly),W=Cr.disabled,te=p.colorModeForDrapableLayerRenderPass(I),ee=N.projection.name==="globe",ne=[o.a5(N.center.lng),o.ae(N.center.lat)],K=[];for(let xe=0;xe<m.length;xe++){const ue=m[xe],ye=s.getTile(ue),ie=ye.getBucket(c);if(!ie||ie.projection.name!==N.projection.name)continue;const ve=ie.programConfigurations.get(c.id),Pe=o.cy(c),Fe=p.isTileAffectedByFog(ue);ee&&Pe.push("PROJECTION_GLOBE_VIEW");const $e=p.getOrCreateProgram("circle",{config:ve,defines:Pe,overrideFog:Fe}),nt=ie.layoutVertexBuffer,Ge=ie.globeExtVertexBuffer,ft=ie.indexBuffer,ct=N.projection.createInversionMatrix(N,ue.canonical),Ct={programConfiguration:ve,program:$e,layoutVertexBuffer:nt,globeExtVertexBuffer:Ge,indexBuffer:ft,uniformValues:o.cz(p,ue,ye,ct,ne,c),tile:ye};if(C){const qe=ie.segments.get();for(const ot of qe)K.push({segments:new o.aB([ot]),sortKey:ot.sortKey,state:Ct})}else K.push({segments:ie.segments,sortKey:0,state:Ct})}C&&K.sort((xe,ue)=>xe.sortKey-ue.sortKey);const ae={useDepthForOcclusion:N.depthOcclusionForSymbolsAndCircles};for(const xe of K){const{programConfiguration:ue,program:ye,layoutVertexBuffer:ie,globeExtVertexBuffer:ve,indexBuffer:Pe,uniformValues:Fe,tile:$e}=xe.state,nt=xe.segments;p.terrain&&p.terrain.setupElevationDraw($e,ye,ae),p.uploadCommonUniforms(D,ye,$e.tileID.toUnwrapped()),ye.draw(p,L.TRIANGLES,H,W,te,xr.disabled,Fe,c.id,ie,Pe,nt,c.paint,N.zoom,ue,[ve])}},heatmap:function(p,s,c,m){if(c.paint.get("heatmap-opacity")!==0)if(p.renderPass==="offscreen"){const x=p.context,v=x.gl,S=Cr.disabled,C=new jr([v.ONE,v.ONE,v.ONE,v.ONE],o.ax.transparent,[!0,!0,!0,!0]);(function(W,te,ee,ne){const K=W.gl,ae=te.width*ne,xe=te.height*ne;W.activeTexture.set(K.TEXTURE1),W.viewport.set([0,0,ae,xe]);let ue=ee.heatmapFbo;if(!ue||ue&&(ue.width!==ae||ue.height!==xe)){ue&&ue.destroy();const ye=K.createTexture();K.bindTexture(K.TEXTURE_2D,ye),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_WRAP_S,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_WRAP_T,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_MIN_FILTER,K.LINEAR),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_MAG_FILTER,K.LINEAR),ue=ee.heatmapFbo=W.createFramebuffer(ae,xe,!0,null),function(ie,ve,Pe,Fe,$e,nt){const Ge=ie.gl;Ge.texImage2D(Ge.TEXTURE_2D,0,ie.extRenderToTextureHalfFloat?Ge.RGBA16F:Ge.RGBA,$e,nt,0,Ge.RGBA,ie.extRenderToTextureHalfFloat?Ge.HALF_FLOAT:Ge.UNSIGNED_BYTE,null),Fe.colorAttachment.set(Pe)}(W,0,ye,ue,ae,xe)}else K.bindTexture(K.TEXTURE_2D,ue.colorAttachment.get()),W.bindFramebuffer.set(ue.framebuffer)})(x,p,c,p.transform.projection.name==="globe"?.5:.25),x.clear({color:o.ax.transparent});const I=p.transform,D=I.projection.name==="globe",L=D?["PROJECTION_GLOBE_VIEW"]:[],N=D?xr.frontCCW:xr.disabled,H=[o.a5(I.center.lng),o.ae(I.center.lat)];for(let W=0;W<m.length;W++){const te=m[W];if(s.hasRenderableParent(te))continue;const ee=s.getTile(te),ne=ee.getBucket(c);if(!ne||ne.projection.name!==I.projection.name)continue;const K=p.isTileAffectedByFog(te),ae=ne.programConfigurations.get(c.id),xe=p.getOrCreateProgram("heatmap",{config:ae,defines:L,overrideFog:K}),{zoom:ue}=p.transform;p.terrain&&p.terrain.setupElevationDraw(ee,xe),p.uploadCommonUniforms(x,xe,te.toUnwrapped());const ye=I.projection.createInversionMatrix(I,te.canonical);xe.draw(p,v.TRIANGLES,_r.disabled,S,C,N,g0(p,te,ee,ye,H,ue,c.paint.get("heatmap-intensity")),c.id,ne.layoutVertexBuffer,ne.indexBuffer,ne.segments,c.paint,p.transform.zoom,ae,D?[ne.globeExtVertexBuffer]:null)}x.viewport.set([0,0,p.width,p.height])}else p.renderPass==="translucent"&&(p.context.setColorMode(p.colorModeForRenderPass()),function(x,v){const S=x.context,C=S.gl,I=v.heatmapFbo;if(!I)return;S.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,I.colorAttachment.get()),S.activeTexture.set(C.TEXTURE1);let D=v.colorRampTexture;D||(D=v.colorRampTexture=new o.T(S,v.colorRamp,C.RGBA)),D.bind(C.LINEAR,C.CLAMP_TO_EDGE),x.getOrCreateProgram("heatmapTexture").draw(x,C.TRIANGLES,_r.disabled,Cr.disabled,x.colorModeForRenderPass(),xr.disabled,((L,N,H,W)=>({u_image:0,u_color_ramp:1,u_opacity:N.paint.get("heatmap-opacity")}))(0,v),v.id,x.viewportBuffer,x.quadTriangleIndexBuffer,x.viewportSegments,v.paint,x.transform.zoom)}(p,c))},line:function(p,s,c,m){if(p.renderPass!=="translucent")return;const x=c.paint.get("line-opacity"),v=c.paint.get("line-width");if(x.constantOr(1)===0||v.constantOr(1)===0)return;const S=c.paint.get("line-emissive-strength"),C=p.depthModeForSublayer(0,_r.ReadOnly),I=p.colorModeForDrapableLayerRenderPass(S),D=p.terrain&&p.terrain.renderingToTexture?1:o.f.devicePixelRatio,L=c.paint.get("line-dasharray"),N=L.constantOr(1),H=c.layout.get("line-cap"),W=c.paint.get("line-pattern"),te=W.constantOr(1),ee=c.paint.get("line-pattern").constantOr(1),ne=c.paint.get("line-opacity").constantOr(1)!==1;let K=!ee&&ne;const ae=c.paint.get("line-gradient"),xe=te?"linePattern":"line",ue=p.context,ye=ue.gl,ie=o.cA(c);p.terrain&&p.terrain.clipOrMaskOverlapStencilType()&&(K=!1);for(const ve of m){const Pe=s.getTile(ve);if(te&&!Pe.patternsLoaded())continue;const Fe=Pe.getBucket(c);if(!Fe)continue;p.prepareDrawTile();const $e=Fe.programConfigurations.get(c.id),nt=p.isTileAffectedByFog(ve),Ge=p.getOrCreateProgram(xe,{config:$e,defines:ie,overrideFog:nt}),ft=W.constantOr(null);if(ft&&Pe.imageAtlas){const Ut=Pe.imageAtlas.patternPositions[ft.toString()];Ut&&$e.setConstantPatternPositions(Ut)}const ct=L.constantOr(null),Ct=H.constantOr(null);if(!te&&ct&&Ct&&Pe.lineAtlas){const Ut=Pe.lineAtlas.getDash(ct,Ct);Ut&&$e.setConstantPatternPositions(Ut)}let[qe,ot]=c.paint.get("line-trim-offset");(Ct==="round"||Ct==="square")&&qe!==ot&&(qe===0&&(qe-=1),ot===1&&(ot+=1));const Ue=p.terrain?ve.projMatrix:null,Qe=te?o.cB(p,Pe,c,Ue,D,[qe,ot]):o.cC(p,Pe,c,Ue,Fe.lineClipsArray.length,D,[qe,ot]);if(ae){const Ut=Fe.gradients[c.id];let Bt=Ut.texture;if(c.gradientVersion!==Ut.version){let Yt=256;if(c.stepInterpolant){const or=s.getSource().maxzoom,pr=ve.canonical.z===or?Math.ceil(1<<p.transform.maxZoom-ve.canonical.z):1;Yt=o.aa(o.cD(Fe.maxLineLength/o.V*1024*pr),256,ue.maxTextureSize)}Ut.gradient=o.cE({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:Yt,image:Ut.gradient||void 0,clips:Fe.lineClipsArray}),Ut.texture?Ut.texture.update(Ut.gradient):Ut.texture=new o.T(ue,Ut.gradient,ye.RGBA),Ut.version=c.gradientVersion,Bt=Ut.texture}ue.activeTexture.set(ye.TEXTURE1),Bt.bind(c.stepInterpolant?ye.NEAREST:ye.LINEAR,ye.CLAMP_TO_EDGE)}N&&(ue.activeTexture.set(ye.TEXTURE0),Pe.lineAtlasTexture&&Pe.lineAtlasTexture.bind(ye.LINEAR,ye.REPEAT),$e.updatePaintBuffers()),te&&(ue.activeTexture.set(ye.TEXTURE0),Pe.imageAtlasTexture&&Pe.imageAtlasTexture.bind(ye.LINEAR,ye.CLAMP_TO_EDGE),$e.updatePaintBuffers()),p.uploadCommonUniforms(ue,Ge,ve.toUnwrapped());const Mt=Ut=>{Ge.draw(p,ye.TRIANGLES,C,Ut,I,xr.disabled,Qe,c.id,Fe.layoutVertexBuffer,Fe.indexBuffer,Fe.segments,c.paint,p.transform.zoom,$e,[Fe.layoutVertexBuffer2])};if(K){const Ut=p.stencilModeForClipping(ve).ref;Ut===0&&p.terrain&&ue.clear({stencil:0});const Bt={func:ye.EQUAL,mask:255};Qe.u_alpha_discard_threshold=.8,Mt(new Cr(Bt,Ut,255,ye.KEEP,ye.KEEP,ye.INVERT)),Qe.u_alpha_discard_threshold=0,Mt(new Cr(Bt,Ut,255,ye.KEEP,ye.KEEP,ye.KEEP))}else Mt(p.stencilModeForClipping(ve))}K&&(p.resetStencilClippingMasks(),p.terrain&&ue.clear({stencil:0}))},fill:function(p,s,c,m){const x=c.paint.get("fill-color"),v=c.paint.get("fill-opacity");if(v.constantOr(1)===0)return;const S=c.paint.get("fill-emissive-strength"),C=p.colorModeForDrapableLayerRenderPass(S),I=c.paint.get("fill-pattern"),D=p.opaquePassEnabledForLayer()&&!I.constantOr(1)&&x.constantOr(o.ax.transparent).a===1&&v.constantOr(0)===1?"opaque":"translucent";if(p.renderPass===D){const L=p.depthModeForSublayer(1,p.renderPass==="opaque"?_r.ReadWrite:_r.ReadOnly);Zl(p,s,c,m,L,C,!1)}if(p.renderPass==="translucent"&&c.paint.get("fill-antialias")){const L=p.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,_r.ReadOnly);Zl(p,s,c,m,L,C,!0)}},"fill-extrusion":function(p,s,c,m){const x=c.paint.get("fill-extrusion-opacity"),v=p.context,S=v.gl,C=p.terrain,I=C&&C.renderingToTexture;if(x===0)return;const D=p.conflationActive&&p.layerUsedInConflation(c,s.getSource());if(D&&function(L,N,H,W){for(const te of W){const ee=N.getTile(te).getBucket(H);ee&&(ee.updateReplacement(te,L.replacementSource),ee.uploadCentroid(L.context))}}(p,s,c,m),C||D)for(const L of m){const N=s.getTile(L).getBucket(c);N&&Ov(p.context,s,L,N,c,C,D)}if(p.renderPass==="shadow"&&p.shadowRenderer){const L=p.shadowRenderer;if(C&&x<.65&&c._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof o.Z)return;const N=L.getShadowPassDepthMode(),H=L.getShadowPassColorMode();cr(p,s,c,m,N,Cr.disabled,H,D)}else if(p.renderPass==="translucent"){const L=!c.paint.get("fill-extrusion-pattern").constantOr(1),N=c.paint.get("fill-extrusion-color").constantOr(o.ax.white);if(!I&&N.a!==0){const H=new _r(p.context.gl.LEQUAL,_r.ReadWrite,p.depthRangeFor3D);x===1&&L?cr(p,s,c,m,H,Cr.disabled,jr.unblended,D):(cr(p,s,c,m,H,Cr.disabled,jr.disabled,D),cr(p,s,c,m,H,p.stencilModeFor3D(),p.colorModeForRenderPass(),D),p.resetStencilClippingMasks())}if(p.style.enable3dLights()&&L&&(!C&&p.transform.projection.name!=="globe"||I)){const H=c.paint.get("fill-extrusion-opacity"),W=c.paint.get("fill-extrusion-ambient-occlusion-intensity"),te=c.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),ee=c.paint.get("fill-extrusion-flood-light-intensity"),ne=c.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),K=W>0&&te>0,ae=ee>0,xe=(ye,ie,ve)=>(1-ve)*ye+ve*ie,ue=ye=>{const ie=p.depthModeForSublayer(1,_r.ReadOnly,S.LEQUAL,!0),ve=c.paint.get(ye?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Pe=xe(.1,3,ve),Fe=p._showOverdrawInspector;if(!Fe){const $e=new Cr({func:S.ALWAYS,mask:255},255,255,S.KEEP,S.KEEP,S.REPLACE),nt=new jr([S.ONE,S.ONE,S.ONE,S.ONE],o.ax.transparent,[!1,!1,!1,!0],S.MIN);ul(p,s,c,m,ie,$e,nt,xr.disabled,ye,"sdf",H,W,te,ee,ne,Pe,D,!1)}{const $e=Fe?Cr.disabled:new Cr({func:S.EQUAL,mask:255},255,255,S.KEEP,S.DECR,S.DECR),nt=Fe?p.colorModeForRenderPass():new jr([S.ONE_MINUS_DST_ALPHA,S.DST_ALPHA,S.ONE,S.ONE],o.ax.transparent,[!0,!0,!0,!0]);ul(p,s,c,m,ie,$e,nt,xr.disabled,ye,"color",H,W,te,ee,ne,Pe,D,!1)}};if(I){const ye=(ie,ve,Pe)=>{const Fe=p.depthModeForSublayer(1,_r.ReadOnly,S.LEQUAL,!1),$e=c.paint.get(ie?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),nt=xe(.1,3,$e);{const Ge=new jr([S.ONE,S.ONE,S.ONE,S.ONE],o.ax.transparent,[!1,!1,!1,!0]);ul(p,s,c,m,Fe,Cr.disabled,Ge,xr.disabled,ie,"clear",H,W,te,ee,ne,nt,D,ve)}{const Ge=new Cr({func:S.ALWAYS,mask:255},255,255,S.KEEP,S.KEEP,S.REPLACE),ft=new jr([S.ONE,S.ONE,S.ONE,S.ONE],o.ax.transparent,[!1,!1,!1,!0],S.MIN);ul(p,s,c,m,Fe,Ge,ft,xr.disabled,ie,"sdf",H,W,te,ee,ne,nt,D,ve)}{const Ge=ie?S.ZERO:S.ONE_MINUS_DST_ALPHA,ft=new Cr({func:S.EQUAL,mask:255},255,255,S.KEEP,S.DECR,S.DECR),ct=new jr([Ge,S.DST_ALPHA,S.ONE_MINUS_DST_ALPHA,S.ZERO],o.ax.transparent,[!0,!0,!0,!0]);ul(p,s,c,m,Fe,ft,ct,xr.disabled,ie,"color",H,W,te,ee,ne,nt,D,ve)}{const Ge=new jr([S.ONE,S.ONE,S.ONE,ie?S.ZERO:S.ONE],o.ax.transparent,[!1,!1,!1,!0],ie?S.FUNC_ADD:S.MAX);ul(p,s,c,m,Fe,Cr.disabled,Ge,xr.disabled,ie,"clear",H,W,te,ee,ne,nt,D,ve,Pe)}};if(K||ae){let ie;if(p.prepareDrawTile(),C){const ve=C.drapeBufferSize[0],Pe=C.drapeBufferSize[1];ie=C.framebufferCopyTexture,ie&&(!ie||ie.size[0]===ve&&ie.size[1]===Pe)||(ie&&ie.destroy(),ie=C.framebufferCopyTexture=new o.T(v,new o.h({width:ve,height:Pe}),S.RGBA)),ie.bind(S.LINEAR,S.CLAMP_TO_EDGE),S.copyTexImage2D(S.TEXTURE_2D,0,S.RGBA,0,0,ve,Pe,0)}K&&ye(!0,!1,ie),ae&&ye(!1,!0,ie)}}else K&&ue(!0),ae&&ue(!1)}}},hillshade:function(p,s,c,m){if(p.renderPass!=="offscreen"&&p.renderPass!=="translucent"||p.style.disableElevatedTerrain)return;const x=p.context,v=p.terrain&&p.terrain.renderingToTexture,[S,C]=p.renderPass!=="translucent"||v?[{},m]:p.stencilConfigForOverlap(m);for(const I of C){const D=s.getTile(I);if(D.needsHillshadePrepare&&p.renderPass==="offscreen")n0(p,D,c);else if(p.renderPass==="translucent"){const L=p.depthModeForSublayer(0,_r.ReadOnly),N=c.paint.get("hillshade-emissive-strength"),H=p.colorModeForDrapableLayerRenderPass(N),W=v&&p.terrain?p.terrain.stencilModeForRTTOverlap(I):S[I.overscaledZ];zf(p,I,D,c,L,W,H)}}x.viewport.set([0,0,p.width,p.height]),p.resetStencilClippingMasks()},raster:function(p,s,c,m,x,v){if(p.renderPass!=="translucent"||c.paint.get("raster-opacity")===0)return;const S=p.transform.projection.name==="globe",C=c.paint.get("raster-elevation")!==0,I=C&&S;if(p.renderElevatedRasterBackface&&!I)return;const D=p.context,L=D.gl,N=s.getSource(),H=function(ie,ve,Pe,Fe){const $e=ve.paint.get("raster-color"),nt=ie.type==="raster-array",Ge=[],ft=ve.paint.get("raster-resampling"),ct=ve.paint.get("raster-color-mix");let Ct=ve.paint.get("raster-color-range");const qe=[ct[0],ct[1],ct[2],0],ot=ct[3];let Ue=ft==="nearest"?Fe.NEAREST:Fe.LINEAR;if(nt&&(Ge.push("RASTER_ARRAY"),$e||Ge.push("RASTER_COLOR"),ft==="linear"&&Ge.push("RASTER_ARRAY_LINEAR"),Ue=Fe.NEAREST,!Ct&&ie.rasterLayers)){const Qe=ie.rasterLayers.find(({id:Mt})=>Mt===ve.sourceLayer);Qe&&Qe.fields&&Qe.fields.range&&(Ct=Qe.fields.range)}if(Ct=Ct||[0,1],$e){Ge.push("RASTER_COLOR"),Pe.activeTexture.set(Fe.TEXTURE2),ve.updateColorRamp(Ct);let Qe=ve.colorRampTexture;Qe||(Qe=ve.colorRampTexture=new o.T(Pe,ve.colorRamp,Fe.RGBA)),Qe.bind(Fe.LINEAR,Fe.CLAMP_TO_EDGE)}return{mix:qe,range:Ct,offset:ot,defines:Ge,resampling:Ue}}(N,c,D,L);if(N instanceof o.ap&&!m.length&&!S)return;const W=c.paint.get("raster-emissive-strength"),te=p.colorModeForDrapableLayerRenderPass(W),ee=p.terrain&&p.terrain.renderingToTexture,ne=!p.options.moving,K=c.paint.get("raster-resampling")==="nearest"?L.NEAREST:L.LINEAR;if(N instanceof o.ap&&!m.length&&(N.onNorthPole||N.onSouthPole)){const ie=C?p.stencilModeFor3D():Cr.disabled;return void v0(!!N.onNorthPole,null,p,s,c,W,H,xr.disabled,ie)}if(!m.length)return;const[ae,xe]=N instanceof o.ap||ee?[{},m]:p.stencilConfigForOverlap(m),ue=xe[xe.length-1].overscaledZ;I&&H.defines.push("PROJECTION_GLOBE_VIEW"),C&&H.defines.push("RENDER_CUTOFF");const ye=(ie,ve,Pe)=>{for(const Fe of ie){const $e=Fe.toUnwrapped(),nt=s.getTile(Fe);if(ee&&(!nt||!nt.hasData()))continue;D.activeTexture.set(L.TEXTURE0);const Ge=b0(nt,N,c,H);if(!Ge||!Ge.texture)continue;const{texture:ft,mix:ct,offset:Ct,tileSize:qe,buffer:ot}=Ge;let Ue,Qe;ee?(Ue=_r.disabled,Qe=Fe.projMatrix):C?(Ue=new _r(L.LEQUAL,_r.ReadWrite,p.depthRangeFor3D),Qe=S?Float32Array.from(p.transform.expandedFarZProjMatrix):p.transform.calculateProjMatrix($e,ne)):(Ue=p.depthModeForSublayer(Fe.overscaledZ-ue,c.paint.get("raster-opacity")===1?_r.ReadWrite:_r.ReadOnly,L.LESS),Qe=p.transform.calculateProjMatrix($e,ne));const Mt=p.terrain&&ee?p.terrain.stencilModeForRTTOverlap(Fe):ae[Fe.overscaledZ],Ut=v?0:c.paint.get("raster-fade-duration");nt.registerFadeDuration(Ut);const Bt=s.findLoadedParent(Fe,0),Yt=o0(nt,Bt,s,p.transform,Ut);let or,pr;p.terrain&&p.terrain.prepareDrawTile(),D.activeTexture.set(L.TEXTURE0),ft.bind(K,L.CLAMP_TO_EDGE),D.activeTexture.set(L.TEXTURE1),Bt?(Bt.texture&&Bt.texture.bind(K,L.CLAMP_TO_EDGE),or=Math.pow(2,Bt.tileID.overscaledZ-nt.tileID.overscaledZ),pr=[nt.tileID.canonical.x*or%1,nt.tileID.canonical.y*or%1]):ft.bind(K,L.CLAMP_TO_EDGE),ft.useMipmap&&D.extTextureFilterAnisotropic&&p.transform.pitch>20&&L.texParameterf(L.TEXTURE_2D,D.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,D.extTextureFilterAnisotropicMax);const ur=p.transform;let fr;const zr=C?w0(ur):[0,0,0,0];let Sr,Pr,Mr,en,Ln,Wr=0;if(I&&N instanceof o.ap&&N.coordinates.length>3)Sr=Float32Array.from(o.aT(o.ci(new o.bs(0,0,0)))),Pr=Float32Array.from(ur.globeMatrix),Mr=Float32Array.from(o.ce(ur)),en=[o.a5(ur.center.lng),o.ae(ur.center.lat)],fr=N.elevatedGlobePerspectiveTransform,Ln=N.elevatedGlobeGridMatrix||new Float32Array(9);else if(I){const Zr=o.cf(Fe.canonical);Wr=o.cg(Zr.getCenter().lat),Sr=Float32Array.from(o.aT(o.ci(Fe.canonical))),Pr=Float32Array.from(ur.globeMatrix),Mr=Float32Array.from(o.ce(ur)),en=[o.a5(ur.center.lng),o.ae(ur.center.lat)],fr=[0,0],Ln=Float32Array.from(o.ch(Fe.canonical,Zr,Wr,ur.worldSize/ur._pixelsPerMercatorPixel))}else fr=N instanceof o.ap?N.perspectiveTransform:[0,0],Sr=new Float32Array(16),Pr=new Float32Array(9),Mr=new Float32Array(16),en=[0,0],Ln=new Float32Array(9);const ii=_0(Qe,Sr,Pr,Mr,Ln,pr||[0,0],o.S(p.transform.zoom),en,zr,or||1,Yt,c,fr,C?c.paint.get("raster-elevation"):0,2,ct,Ct,H.range,qe,ot,W),qr=p.isTileAffectedByFog(Fe),un=p.getOrCreateProgram("raster",{defines:H.defines,overrideFog:qr});if(p.uploadCommonUniforms(D,un,$e),N instanceof o.ap){const Zr=N.elevatedGlobeVertexBuffer,sn=N.elevatedGlobeIndexBuffer;if(ee||!S)N.boundsBuffer&&N.boundsSegments&&un.draw(p,L.TRIANGLES,Ue,Cr.disabled,te,xr.disabled,ii,c.id,N.boundsBuffer,p.quadTriangleIndexBuffer,N.boundsSegments);else if(Zr&&sn){const Bn=ur.zoom<=o.bG?N.elevatedGlobeSegments:N.getSegmentsForLongitude(ur.center.lng);Bn&&un.draw(p,L.TRIANGLES,Ue,Cr.disabled,te,ve,ii,c.id,Zr,sn,Bn)}}else if(I){Ue=new _r(L.LEQUAL,_r.ReadOnly,p.depthRangeFor3D);const Zr=p.globeSharedBuffers;if(Zr){const[sn,Bn,mn]=Zr.getGridBuffers(Wr,!1);un.draw(p,L.TRIANGLES,Ue,Pe||Mt,p.colorModeForRenderPass(),ve,ii,c.id,sn,Bn,mn)}}else{const{tileBoundsBuffer:Zr,tileBoundsIndexBuffer:sn,tileBoundsSegments:Bn}=p.getTileBoundsBuffers(nt);un.draw(p,L.TRIANGLES,Ue,Mt,te,xr.disabled,ii,c.id,Zr,sn,Bn)}}if(!(N instanceof o.ap)&&I)for(const Fe of ie){const $e=Fe.canonical.y===(1<<Fe.canonical.z)-1;Fe.canonical.y===0&&v0(!0,Fe,p,s,c,W,H,ve,Pe||Cr.disabled),$e&&v0(!1,Fe,p,s,c,W,H,ve===xr.frontCW?xr.backCW:xr.frontCW,Pe||Cr.disabled)}};I?ye(xe,p.renderElevatedRasterBackface?xr.backCW:xr.frontCW,p.stencilModeFor3D()):ye(xe,xr.disabled,void 0),p.resetStencilClippingMasks()},"raster-particle":function(p,s,c,m,x,v){p.renderPass==="offscreen"&&function(S,C,I,D){if(!D.length)return;const L=S.context,N=L.gl,H=C.getSource();if(!(H instanceof ge))return;const W=[];for(const ne of D){const K=C.getTile(ne);if(!(K instanceof Ul))continue;const ae=T0(K,H,I);if(!ae)continue;const xe=[ae.tileSize,ae.tileSize];let ue=I.tileFramebuffer;ue||(ue=I.tileFramebuffer=L.createFramebuffer(xe[0],xe[1],!0,null));let ye=K.rasterParticleState;const ie=I.paint.get("raster-particle-count");ye||(ye=K.rasterParticleState=new Ei(L,ne,xe,ie));const ve=ye.update(I.lastInvalidatedAt);ye.numParticles!==ie&&ye.setNumParticles(ne,ie);const Pe=ye.targetColorTexture;ye.targetColorTexture=ye.backgroundColorTexture,ye.backgroundColorTexture=Pe;const Fe=ye.particleVertices0;ye.particleVertices0=ye.particleVertices1,ye.particleVertices1=Fe,W.push([ne,ae,ye,ve])}if(W.length===0)return;const te=o.f.now(),ee=I.previousDrawTimestamp?.001*(te-I.previousDrawTimestamp):.0167;if(I.previousDrawTimestamp=te,I.hasColorMap()){L.activeTexture.set(N.TEXTURE0+2);let ne=I.colorRampTexture;ne||(ne=I.colorRampTexture=new o.T(L,I.colorRamp,N.RGBA)),ne.bind(N.LINEAR,N.CLAMP_TO_EDGE)}L.bindFramebuffer.set(I.tileFramebuffer.framebuffer),L.activeTexture.set(N.TEXTURE0),function(ne,K,ae){const xe=ne.context,ue=xe.gl,ye=K.tileFramebuffer;xe.activeTexture.set(ue.TEXTURE0);const ie={u_texture:0,u_opacity:1.05*(Pe=K.paint.get("raster-particle-fade-opacity-factor"))/(Pe+.05)},ve=ne.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Pe;for(const Fe of ae){const[,,$e,nt]=Fe;ye.colorAttachment.set($e.targetColorTexture.texture),xe.viewport.set([0,0,ye.width,ye.height]),xe.clear({color:o.ax.transparent}),nt&&($e.backgroundColorTexture.bind(ue.NEAREST,ue.CLAMP_TO_EDGE),ve.draw(ne,ue.TRIANGLES,_r.disabled,Cr.disabled,jr.alphaBlended,xr.disabled,ie,K.id,ne.viewportBuffer,ne.quadTriangleIndexBuffer,ne.viewportSegments))}}(S,I,W),function(ne,K,ae,xe){const ue=ne.context.gl,ye=ae.tileFramebuffer,ie=ne.transform.projection.name==="globe",ve=ae.paint.get("raster-particle-max-speed");for(const Pe of xe){const[Fe,$e,nt]=Pe;$e.texture.bind(ue.LINEAR,ue.CLAMP_TO_EDGE),ye.colorAttachment.set(nt.targetColorTexture.texture);const Ge=ne.getOrCreateProgram("rasterParticleDraw",{defines:$e.defines,overrideFog:!1}),ft=$e.scalarData?[]:[0,1,2,3].map(qe=>o.cG[qe](Fe));ft.push(Fe);const ct=Fe.canonical.x,Ct=Fe.canonical.y;for(const qe of ft){const ot=K.getTile(ie?qe.wrapped():qe);if(!ot)continue;const Ue=ot.rasterParticleState;if(!Ue)continue;const Qe=Fv([qe.canonical.x+(1<<qe.canonical.z)*(qe.wrap-Fe.wrap)-ct,qe.canonical.y-Ct],0,$e.texture.size,2,ve,$e.textureOffset,$e.scale,$e.offset);Ge.draw(ne,ue.POINTS,_r.disabled,Cr.disabled,jr.alphaBlended,xr.disabled,Qe,ae.id,Ue.particleVertices0,void 0,Ue.particleSegment)}}}(S,C,I,W),function(ne,K,ae,xe){const ue=ne.context.gl;let ye=K.transformFeedbackObject;ye||(ye=K.transformFeedbackObject=ue.createTransformFeedback()),ue.bindTransformFeedback(ue.TRANSFORM_FEEDBACK,K.transformFeedbackObject);const ie=K.paint.get("raster-particle-max-speed"),ve=xe*K.paint.get("raster-particle-speed-factor")*.3,Pe=(Fe=K.paint.get("raster-particle-reset-rate-factor"),Math.pow(Fe,6));var Fe;for(const $e of ae){const[,nt,Ge]=$e;nt.texture.bind(ue.LINEAR,ue.CLAMP_TO_EDGE);const ft=M_(0,nt.texture.size,ie,ve,Pe,nt.textureOffset,nt.scale,nt.offset);ne.getOrCreateProgram("rasterParticleUpdate",{defines:nt.defines,transformFeedback:{bufferMode:ue.SEPARATE_ATTRIBS,shaderVaryings:["v_new_particle"]}}).draw(ne,ue.POINTS,_r.disabled,Cr.disabled,jr.disabled,xr.disabled,ft,K.id,Ge.particleVertices0,void 0,Ge.particleSegment,{},void 0,void 0,void 0,void 0,[{buffer:Ge.particleVertices1,targetIndex:0}])}ue.bindTransformFeedback(ue.TRANSFORM_FEEDBACK,null)}(S,I,W,ee)}(p,s,c,m),p.renderPass==="translucent"&&(function(S,C,I,D,L){const N=S.context,H=N.gl,W=!S.options.moving,te=S.transform.projection.name==="globe";if(!D.length)return;const[ee,ne]=S.stencilConfigForOverlap(D),K=[];te&&K.push("PROJECTION_GLOBE_VIEW");for(const ae of ne){const xe=ae.toUnwrapped(),ue=C.getTile(ae);if(!ue.rasterParticleState)continue;const ye=ue.rasterParticleState,ie=100;ue.registerFadeDuration(ie);const ve=C.findLoadedParent(ae,0),Pe=o0(ue,ve,C,S.transform,ie);let Fe,$e;S.terrain&&S.terrain.prepareDrawTile(),N.activeTexture.set(H.TEXTURE0),ye.targetColorTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE),N.activeTexture.set(H.TEXTURE1),ve&&ve.rasterParticleState?(ve.rasterParticleState.targetColorTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE),Fe=Math.pow(2,ve.tileID.overscaledZ-ue.tileID.overscaledZ),$e=[ue.tileID.canonical.x*Fe%1,ue.tileID.canonical.y*Fe%1]):ye.targetColorTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE);const nt=te?Float32Array.from(S.transform.expandedFarZProjMatrix):S.transform.calculateProjMatrix(xe,W),Ge=S.transform,ft=E0(Ge),ct=o.cf(ae.canonical),Ct=o.cg(ct.getCenter().lat);let qe,ot,Ue,Qe,Mt;te?(qe=Float32Array.from(o.aT(o.ci(ae.canonical))),ot=Float32Array.from(Ge.globeMatrix),Ue=Float32Array.from(o.ce(Ge)),Qe=[o.a5(Ge.center.lng),o.ae(Ge.center.lat)],Mt=Float32Array.from(o.ch(ae.canonical,ct,Ct,Ge.worldSize/Ge._pixelsPerMercatorPixel))):(qe=new Float32Array(16),ot=new Float32Array(9),Ue=new Float32Array(16),Qe=[0,0],Mt=new Float32Array(9));const Ut=Dv(nt,qe,ot,Ue,Mt,$e||[0,0],o.S(S.transform.zoom),Qe,ft,Fe||1,Pe,250),Bt=S.isTileAffectedByFog(ae),Yt=S.getOrCreateProgram("rasterParticle",{defines:K,overrideFog:Bt});if(S.uploadCommonUniforms(N,Yt,xe),te){const or=new _r(H.LEQUAL,_r.ReadWrite,S.depthRangeFor3D),pr=0,ur=S.globeSharedBuffers;if(ur){const[fr,zr,Sr]=ur.getGridBuffers(Ct,pr!==0);Yt.draw(S,H.TRIANGLES,or,Cr.disabled,jr.alphaBlended,xr.backCCW,Ut,I.id,fr,zr,Sr)}}else{const or=S.depthModeForSublayer(0,_r.ReadOnly),pr=ee[ae.overscaledZ],{tileBoundsBuffer:ur,tileBoundsIndexBuffer:fr,tileBoundsSegments:zr}=S.getTileBoundsBuffers(ue);Yt.draw(S,H.TRIANGLES,or,pr,jr.alphaBlended,xr.disabled,Ut,I.id,ur,fr,zr)}}S.resetStencilClippingMasks()}(p,s,c,m),p.style.map.triggerRepaint())},background:function(p,s,c,m){const x=c.paint.get("background-color"),v=c.paint.get("background-opacity"),S=c.paint.get("background-emissive-strength");if(v===0)return;const C=p.context,I=C.gl,D=p.transform,L=D.tileSize,N=c.paint.get("background-pattern");if(p.isPatternMissing(N,c.scope))return;const H=!N&&x.a===1&&v===1&&p.opaquePassEnabledForLayer()?"opaque":"translucent";if(p.renderPass!==H)return;const W=Cr.disabled,te=p.depthModeForSublayer(0,H==="opaque"?_r.ReadWrite:_r.ReadOnly),ee=p.colorModeForDrapableLayerRenderPass(S),ne=N?"backgroundPattern":"background";let K,ae=m;ae||(K=p.getBackgroundTiles(),ae=Object.values(K).map(xe=>xe.tileID)),N&&(C.activeTexture.set(I.TEXTURE0),p.imageManager.bind(p.context,c.scope));for(const xe of ae){const ue=p.isTileAffectedByFog(xe),ye=p.getOrCreateProgram(ne,{overrideFog:ue}),ie=xe.toUnwrapped(),ve=m?xe.projMatrix:p.transform.calculateProjMatrix(ie);p.prepareDrawTile();const Pe=s?s.getTile(xe):K?K[xe.key]:new el(xe,L,D.zoom,p),Fe=N?lh(ve,S,v,p,N,c.scope,{tileID:xe,tileSize:L}):x0(ve,S,v,x);p.uploadCommonUniforms(C,ye,ie);const{tileBoundsBuffer:$e,tileBoundsIndexBuffer:nt,tileBoundsSegments:Ge}=p.getTileBoundsBuffers(Pe);ye.draw(p,I.TRIANGLES,te,W,ee,xr.disabled,Fe,c.id,$e,nt,Ge)}},sky:function(p,s,c){const m=p._atmosphere?o.S(p.transform.zoom):1,x=c.paint.get("sky-opacity")*m;if(x===0)return;const v=p.context,S=c.paint.get("sky-type"),C=new _r(v.gl.LEQUAL,_r.ReadOnly,[0,1]),I=p.frameCounter/1e3%1;S==="atmosphere"?p.renderPass==="offscreen"?c.needsSkyboxCapture(p)&&(function(D,L,N,H){const W=D.context,te=W.gl;let ee=L.skyboxFbo;if(!ee){ee=L.skyboxFbo=W.createFramebuffer(32,32,!0,null),L.skyboxGeometry=new M0(W),L.skyboxTexture=W.gl.createTexture(),te.bindTexture(te.TEXTURE_CUBE_MAP,L.skyboxTexture),te.texParameteri(te.TEXTURE_CUBE_MAP,te.TEXTURE_WRAP_S,te.CLAMP_TO_EDGE),te.texParameteri(te.TEXTURE_CUBE_MAP,te.TEXTURE_WRAP_T,te.CLAMP_TO_EDGE),te.texParameteri(te.TEXTURE_CUBE_MAP,te.TEXTURE_MIN_FILTER,te.LINEAR),te.texParameteri(te.TEXTURE_CUBE_MAP,te.TEXTURE_MAG_FILTER,te.LINEAR);for(let xe=0;xe<6;++xe)te.texImage2D(te.TEXTURE_CUBE_MAP_POSITIVE_X+xe,0,te.RGBA,32,32,0,te.RGBA,te.UNSIGNED_BYTE,null)}W.bindFramebuffer.set(ee.framebuffer),W.viewport.set([0,0,32,32]);const ne=L.getCenter(D,!0),K=D.getOrCreateProgram("skyboxCapture"),ae=new Float64Array(16);o.a6.identity(ae),o.a6.rotateY(ae,ae,.5*-Math.PI),Xl(D,L,K,ae,ne,0),o.a6.identity(ae),o.a6.rotateY(ae,ae,.5*Math.PI),Xl(D,L,K,ae,ne,1),o.a6.identity(ae),o.a6.rotateX(ae,ae,.5*-Math.PI),Xl(D,L,K,ae,ne,2),o.a6.identity(ae),o.a6.rotateX(ae,ae,.5*Math.PI),Xl(D,L,K,ae,ne,3),o.a6.identity(ae),Xl(D,L,K,ae,ne,4),o.a6.identity(ae),o.a6.rotateY(ae,ae,Math.PI),Xl(D,L,K,ae,ne,5),W.viewport.set([0,0,D.width,D.height])}(p,c),c.markSkyboxValid(p)):p.renderPass==="sky"&&function(D,L,N,H,W){const te=D.context,ee=te.gl,ne=D.transform,K=D.getOrCreateProgram("skybox");te.activeTexture.set(ee.TEXTURE0),ee.bindTexture(ee.TEXTURE_CUBE_MAP,L.skyboxTexture);const ae=((xe,ue,ye,ie,ve)=>({u_matrix:xe,u_sun_direction:ue,u_cubemap:0,u_opacity:ie,u_temporal_offset:ve}))(ne.skyboxMatrix,L.getCenter(D,!1),0,H,W);D.uploadCommonUniforms(te,K),K.draw(D,ee.TRIANGLES,N,Cr.disabled,D.colorModeForRenderPass(),xr.backCW,ae,"skybox",L.skyboxGeometry.vertexBuffer,L.skyboxGeometry.indexBuffer,L.skyboxGeometry.segment)}(p,c,C,x,I):S==="gradient"&&p.renderPass==="sky"&&function(D,L,N,H,W){const te=D.context,ee=te.gl,ne=D.transform,K=D.getOrCreateProgram("skyboxGradient");L.skyboxGeometry||(L.skyboxGeometry=new M0(te)),te.activeTexture.set(ee.TEXTURE0);let ae=L.colorRampTexture;ae||(ae=L.colorRampTexture=new o.T(te,L.colorRamp,ee.RGBA)),ae.bind(ee.LINEAR,ee.CLAMP_TO_EDGE);const xe=((ue,ye,ie,ve,Pe)=>({u_matrix:ue,u_color_ramp:0,u_center_direction:ye,u_radius:o.bj(ie),u_opacity:ve,u_temporal_offset:Pe}))(ne.skyboxMatrix,L.getCenter(D,!1),L.paint.get("sky-gradient-radius"),H,W);D.uploadCommonUniforms(te,K),K.draw(D,ee.TRIANGLES,N,Cr.disabled,D.colorModeForRenderPass(),xr.backCW,xe,"skyboxGradient",L.skyboxGeometry.vertexBuffer,L.skyboxGeometry.indexBuffer,L.skyboxGeometry.segment)}(p,c,C,x,I)},debug:function(p,s,c,m,x,v){for(let S=0;S<c.length;S++)if(x){const D=new o.ax(m.r*.8,m.g*.8,m.b*.8,1);fl(p,s,c[S],m,-1,-1,v),fl(p,s,c[S],m,-1,1,v),fl(p,s,c[S],m,1,1,v),fl(p,s,c[S],m,1,-1,v),fl(p,s,c[S],D,0,0,v)}else fl(p,s,c[S],m,0,0,v)},custom:function(p,s,c,m){const x=p.context,v=c.implementation;if(!p.transform.projection.unsupportedLayers||!p.transform.projection.unsupportedLayers.includes("custom")||p.terrain&&(p.terrain.renderingToTexture||p.renderPass==="offscreen")&&c.isLayerDraped(s)){if(p.renderPass==="offscreen"){const S=v.prerender;if(S){if(p.setCustomLayerDefaults(),x.setColorMode(p.colorModeForRenderPass()),p.transform.projection.name==="globe"){const C=p.transform.pointMerc;S.call(v,x.gl,p.transform.customLayerMatrix(),p.transform.getProjection(),p.transform.globeToMercatorMatrix(),o.S(p.transform.zoom),[C.x,C.y],p.transform.pixelsPerMeterRatio)}else S.call(v,x.gl,p.transform.customLayerMatrix());x.setDirty(),p.setBaseState()}}else if(p.renderPass==="translucent"){if(p.terrain&&p.terrain.renderingToTexture){const C=v.renderToTile;if(C){const I=m[0].canonical,D=new o.L(I.x+m[0].wrap*(1<<I.z),I.y,I.z);x.setDepthMode(_r.disabled),x.setStencilMode(Cr.disabled),x.setColorMode(p.colorModeForRenderPass()),p.setCustomLayerDefaults(),C.call(v,x.gl,D),x.setDirty(),p.setBaseState()}return}p.setCustomLayerDefaults(),x.setColorMode(p.colorModeForRenderPass()),x.setStencilMode(Cr.disabled);const S=v.renderingMode==="3d"?new _r(p.context.gl.LEQUAL,_r.ReadWrite,p.depthRangeFor3D):p.depthModeForSublayer(0,_r.ReadOnly);if(x.setDepthMode(S),p.transform.projection.name==="globe"){const C=p.transform.pointMerc;v.render(x.gl,p.transform.customLayerMatrix(),p.transform.getProjection(),p.transform.globeToMercatorMatrix(),o.S(p.transform.zoom),[C.x,C.y],p.transform.pixelsPerMeterRatio)}else v.render(x.gl,p.transform.customLayerMatrix());x.setDirty(),p.setBaseState(),x.bindFramebuffer.set(null)}}else o.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(p,s,c,m){if(p.renderPass==="opaque")return;const x=c.paint.get("model-opacity");if(x===0)return;const v=c.paint.get("model-cast-shadows");if(p.renderPass==="shadow"&&(!v||p.terrain&&x<.65&&c._transitionablePaint._values["model-opacity"].value.expression instanceof o.Z))return;const S=p.shadowRenderer,C=c.paint.get("model-receive-shadows");S&&(S.useNormalOffset=!0,C||(S.enabled=!1));const I=()=>{S&&(S.useNormalOffset=!0,C||(S.enabled=!0))},D=s.getSource();if(p.renderPass==="light-beam"&&D.type!=="batched-model")return;if(D.type==="vector"||D.type==="geojson")return function(K,ae,xe,ue){const ye=K.transform;if(ye.projection.name!=="mercator")return void o.w(`Drawing 3D models for ${ye.projection.name} projection is not yet implemented`);const ie=ye.getFreeCameraOptions().position;if(!K.modelManager)return;const ve=K.modelManager;xe.modelManager=ve;const Pe=K.shadowRenderer;if(!xe._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Fe=xe._unevaluatedLayout._values["model-id"],$e={...xe.layout.get("model-id").parameters};for(const nt of ue){const Ge=ae.getTile(nt).getBucket(xe);if(!Ge||Ge.projection.name!==ye.projection.name)continue;const ft=O_(nt,ye);$e.zoom=ft;const ct=Fe.possiblyEvaluate($e);if(I0(K,Ge,nt),Ka.shadowUniformsInitialized=!1,Ka.useSingleShadowCascade=!!Pe&&Pe.getMaxCascadeForTile(nt.toUnwrapped())===0,K.renderPass==="shadow"&&Pe){if(K.currentShadowCascade===1&&Ge.isInsideFirstShadowMapFrustum)continue;const ot=ye.calculatePosMatrix(nt.toUnwrapped(),ye.worldSize);if(Ka.tileMatrix.set(ot),Ka.shadowTileMatrix=Float32Array.from(Pe.calculateShadowPassMatrixFromMatrix(ot)),Ka.aabb.min.fill(0),Ka.aabb.max[0]=Ka.aabb.max[1]=o.V,Ka.aabb.max[2]=0,Bv(Ge,Ka,K,xe.scope))continue}const Ct=1<<nt.canonical.z,qe=[((ie.x-nt.wrap)*Ct-nt.canonical.x)*o.V,(ie.y*Ct-nt.canonical.y)*o.V,ie.z*Ct*o.V];for(let ot in Ge.instancesPerModel){const Ue=Ge.instancesPerModel[ot];Ue.features.length>0&&(ot=ct.evaluate(Ue.features[0].feature,{}));const Qe=ve.getModel(ot,xe.scope);if(Qe&&Qe.uploaded)for(const Mt of Qe.nodes)P0(K,xe,Mt,Ue,qe,nt,Ka)}}}(p,s,c,m),void I();if(!D.loaded())return;if(D.type==="batched-model")return function(K,ae,xe,ue){xe.resetLayerRenderingStats(K);const ye=K.context,ie=K.transform,ve=K.style.fog,Pe=K.shadowRenderer;if(ie.projection.name!=="mercator")return void o.w(`Drawing 3D landmark models for ${ie.projection.name} projection is not yet implemented`);const Fe=K.transform.getFreeCameraOptions().position,$e=o.N.scale([],[Fe.x,Fe.y,Fe.z],K.transform.worldSize);o.N.negate($e,$e);const nt=o.a6.identity([]),Ge=o.cR(ie.center.lat,ie.zoom),ft=o.a6.fromScaling([],[1,1,1/Ge]);o.a6.translate(nt,nt,$e);const ct=xe.paint.get("model-opacity"),Ct=new _r(ye.gl.LEQUAL,_r.ReadWrite,K.depthRangeFor3D),qe=new _r(ye.gl.LEQUAL,_r.ReadOnly,K.depthRangeFor3D),ot=new o.bS([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),Ue=K.renderPass==="shadow",Qe=Ue&&Pe?Pe.getCurrentCascadeFrustum():ie.getFrustum(ie.scaleZoom(ie.worldSize)),Mt=xe.getLayerRenderingStats(),Ut=function(Bt,Yt){for(const or of ue){const pr=ae.getTile(or).getBucket(xe);if(!pr||!pr.uploaded)continue;let ur=!1;Pe&&(ur=Pe.getMaxCascadeForTile(or.toUnwrapped())===0);const fr=ie.calculatePosMatrix(or.toUnwrapped(),ie.worldSize),zr=pr.modelTraits;for(const Sr of pr.getNodesInfo()){if(Sr.hiddenByReplacement||!Sr.node.meshes)continue;const Pr=Sr.evaluatedScale,Mr=Sr.node;let en=0;if(K.terrain&&Mr.elevation&&(en=Mr.elevation*K.terrain.exaggeration()),Pr[0]<=1&&Pr[1]<=1&&Pr[2]<=1&&(()=>{const Bn=Sr.getLocalBounds();return ot.min=[...Bn.min],ot.max=[...Bn.max],ot.min[2]+=en,ot.max[2]+=en,o.N.transformMat4(ot.min,ot.min,fr),o.N.transformMat4(ot.max,ot.max,fr),ot})().intersects(Qe)===0)continue;const Ln=K.renderPass==="light-beam",Wr=[...fr];o.a6.translate(Wr,Wr,[(Mr.anchor?Mr.anchor[0]:0)*(Pr[0]-1),(Mr.anchor?Mr.anchor[1]:0)*(Pr[1]-1),en]),o.N.exactEquals(Pr,o.cT)||o.a6.scale(Wr,Wr,Pr),o.a6.multiply(Wr,Wr,Mr.matrix);const ii=o.a6.multiply([],ft,Wr);o.a6.multiply(ii,nt,ii);const qr=o.a6.invert([],ii);o.a6.transpose(qr,qr),o.a6.scale(qr,qr,qc);const un=o.a6.multiply([],ie.expandedFarZProjMatrix,Wr),Zr=zr&o.cV.HasMapboxMeshFeatures,sn=Zr?0:Sr.evaluatedRMEA[0][2];for(let Bn=0;Bn<Mr.meshes.length;++Bn){const mn=Mr.meshes[Bn],Ni=Bn===Mr.lightMeshIndex;if(Ni){if(!Ln&&!K.terrain&&K.shadowRenderer){K.currentLayer<K.firstLightBeamLayer&&(K.firstLightBeamLayer=K.currentLayer);continue}}else if(Ln)continue;const Ji={defines:[]},Fa=[];if(ni(Ji.defines,Fa,mn,K),Zr||Ji.defines.push("DIFFUSE_SHADED"),ur&&Ji.defines.push("SHADOWS_SINGLE_CASCADE"),Mt&&(Ue?Mt.numRenderedVerticesInShadowPass+=mn.vertexArray.length:Mt.numRenderedVerticesInTransparentPass+=mn.vertexArray.length),Ue){tt(mn,Wr,K,xe);continue}let Qs=null;if(ve){const Oa=Yl(Wr,K.transform);if(Qs=new Float32Array(Oa),ie.projection.name!=="globe"){const eo=mn.aabb.min,_l=mn.aabb.max,[Jl,Ih]=ve.getOpacityForBounds(Oa,eo[0],eo[1],_l[0],_l[1]);Ji.overrideFog=Jl>=ln||Ih>=ln}}const La=mn.material;let zi;La.occlusionTexture&&La.occlusionTexture.offsetScale&&(zi=La.occlusionTexture.offsetScale,Ji.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!Ue&&Pe&&(Pe.useNormalOffset=!!mn.normalBuffer);const Ai=K.getOrCreateProgram("model",Ji);!Ue&&Pe&&Pe.setupShadowsFromMatrix(Wr,Ai,Pe.useNormalOffset),K.uploadCommonUniforms(ye,Ai,or.toUnwrapped(),Qs);const da=La.pbrMetallicRoughness;da.metallicFactor=.9,da.roughnessFactor=.5;const wa=Gf(new Float32Array(un),new Float32Array(ii),new Float32Array(qr),K,ct,da.baseColorFactor,La.emissiveFactor,da.metallicFactor,da.roughnessFactor,La,sn,xe,[0,0,0],zi);Ai.draw(K,ye.gl.TRIANGLES,Yt&&!Ni?Ct:qe,Cr.disabled,Bt?Ni||ct<1||Sr.hasTranslucentParts?jr.alphaBlended:jr.unblended:jr.disabled,xr.backCCW,wa,xe.id,mn.vertexBuffer,mn.indexBuffer,mn.segments,xe.paint,K.transform.zoom,void 0,Fa)}}}};(function(Bt,Yt,or,pr){const ur=Bt.terrain?Bt.terrain.exaggeration():0,fr=Bt.transform.zoom;for(const zr of pr){const Sr=Yt.getTile(zr).getBucket(or);Sr&&(Bt.conflationActive&&Sr.updateReplacement(zr,Bt.replacementSource),Sr.evaluateScale(Bt,or),Bt.terrain&&ur>0&&Sr.elevationUpdate(Bt.terrain,ur,zr,or.source),Sr.needsReEvaluation(Bt,fr,or)&&Sr.evaluate(or))}})(K,ae,xe,ue),ct===1?Ut(!0,!0):(Ut(!1,!0),Ut(!0,!1))}(p,s,c,m),void I();const L=D.getModels(),N=[],H=p.transform.getFreeCameraOptions().position,W=o.N.scale([],[H.x,H.y,H.z],p.transform.worldSize);o.N.negate(W,W);const te=[],ee=[];let ne=0;for(const K of L){const ae=c.paint.get("model-rotation").constantOr(null),xe=c.paint.get("model-scale").constantOr(null),ue=c.paint.get("model-translation").constantOr(null);K.computeModelMatrix(p,ae,xe,ue,!0,!0,!1);const ye=o.a6.identity([]),ie=o.cR(K.position.lat,p.transform.zoom),ve=o.a6.fromScaling([],[1,1,1/ie]);o.a6.translate(ye,ye,W),N.push({zScaleMatrix:ve,negCameraPosMatrix:ye});for(const Pe of K.nodes)ph(p.transform,Pe,K.matrix,p.transform.expandedFarZProjMatrix,ne,te,ee);ne++}if(te.sort((K,ae)=>ae.depth-K.depth),p.renderPass!=="shadow"){if(x===1)for(const K of ee)dh(K,p,c,N[K.modelIndex],Cr.disabled,p.colorModeForRenderPass());else{for(const K of ee)dh(K,p,c,N[K.modelIndex],Cr.disabled,jr.disabled);for(const K of ee)dh(K,p,c,N[K.modelIndex],p.stencilModeFor3D(),p.colorModeForRenderPass());p.resetStencilClippingMasks()}for(const K of te)dh(K,p,c,N[K.modelIndex],Cr.disabled,p.colorModeForRenderPass());I()}else{for(const K of ee)tt(K.mesh,K.nodeModelMatrix,p,c);for(const K of te)tt(K.mesh,K.nodeModelMatrix,p,c);I()}}},R0={model:function(p,s,c){const m=p.scope,x=s.getSource();if(!x.loaded())return;if(x.type==="vector"||x.type==="geojson")return void(c.modelManager&&c.modelManager.upload(c,m));if(x.type==="batched-model")return;const v=x.getModels();for(const S of v)S.upload(c.context)},raster:function(p,s,c){const m=s.getSource();if(!(m instanceof ge&&m.loaded()))return;const x=p.sourceLayer||m.rasterLayerIds&&m.rasterLayerIds[0];if(!x)return;const v=p.paint.get("raster-array-band")||m.getInitialBand(x);if(v==null)return;const S=s.getIds().map(C=>s.getTileByID(C));for(const C of S)C.updateNeeded(x,v)&&m.prepareTile(C,x,v)},"raster-particle":function(p,s,c){const m=s.getSource();if(!(m instanceof ge&&m.loaded()))return;const x=p.sourceLayer||m.rasterLayerIds&&m.rasterLayerIds[0];if(!x)return;const v=p.paint.get("raster-particle-array-band")||m.getInitialBand(x);if(v==null)return;const S=s.getIds().map(C=>s.getTileByID(C));for(const C of S)C.updateNeeded(x,v)&&m.prepareTile(C,x,v)}};class z_{constructor(s,c,m,x){this.context=new o_(s,c),this.transform=m,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=x,this._debugParams={showTerrainProxyTiles:!1},x.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),this.setup(),this.numSublayers=Ss.maxUnderzooming+Ss.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new o.cX,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Xp(this),this._wireframeDebugCache=new N_,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0}updateTerrain(s,c){const m=!!s&&!!s.terrain&&this.transform.projection.supportsTerrain;if(!(m||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Rv(this,s));const x=this._terrain;this.transform.elevation=m?x:null,x.update(s,this.transform,c),this.transform.elevation&&!x.enabled&&(this.transform.elevation=null)}_updateFog(s){const c=s.fog;if(!c||this.transform.projection.name==="globe"||c.getOpacity(this.transform.pitch)<1||c.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[m,x]=c.getFovAdjustedRange(this.transform._fov);if(m>x)return void(this.transform.fogCullDistSq=null);const v=m+.78*(x-m);this.transform.fogCullDistSq=v*v}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(s,c){if(this.width=s*o.f.devicePixelRatio,this.height=c*o.f.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style.order)this.style._mergedLayers[m].resize()}setup(){const s=this.context,c=new o.aN;c.emplaceBack(0,0),c.emplaceBack(o.V,0),c.emplaceBack(0,o.V),c.emplaceBack(o.V,o.V),this.tileExtentBuffer=s.createVertexBuffer(c,o.aP.members),this.tileExtentSegments=o.aB.simpleSegment(0,0,4,2);const m=new o.aN;m.emplaceBack(0,0),m.emplaceBack(o.V,0),m.emplaceBack(0,o.V),m.emplaceBack(o.V,o.V),this.debugBuffer=s.createVertexBuffer(m,o.aP.members),this.debugSegments=o.aB.simpleSegment(0,0,4,5);const x=new o.aN;x.emplaceBack(-1,-1),x.emplaceBack(1,-1),x.emplaceBack(-1,1),x.emplaceBack(1,1),this.viewportBuffer=s.createVertexBuffer(x,o.aP.members),this.viewportSegments=o.aB.simpleSegment(0,0,4,2);const v=new o.av;v.emplaceBack(0,0,0,0),v.emplaceBack(o.V,0,o.V,0),v.emplaceBack(0,o.V,0,o.V),v.emplaceBack(o.V,o.V,o.V,o.V),this.mercatorBoundsBuffer=s.createVertexBuffer(v,o.aR.members),this.mercatorBoundsSegments=o.aB.simpleSegment(0,0,4,2);const S=new o.aw;S.emplaceBack(0,1,2),S.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=s.createIndexBuffer(S);const C=new o.aO;for(const D of[0,1,3,2,0])C.emplaceBack(D);this.debugIndexBuffer=s.createIndexBuffer(C),this.emptyTexture=new o.T(s,new o.h({width:1,height:1},Uint8Array.of(0,0,0,0)),s.gl.RGBA),this.identityMat=o.a6.create();const I=this.context.gl;this.stencilClearMode=new Cr({func:I.ALWAYS,mask:0},0,255,I.ZERO,I.ZERO,I.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(s){return s._makeTileBoundsBuffers(this.context,this.transform.projection),s._tileBoundsBuffer?{tileBoundsBuffer:s._tileBoundsBuffer,tileBoundsIndexBuffer:s._tileBoundsIndexBuffer,tileBoundsSegments:s._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const s=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,s.TRIANGLES,_r.disabled,this.stencilClearMode,jr.disabled,xr.disabled,s0(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(s,c,m){if(!c||this.currentStencilSource===c.id||!s.isTileClipped()||!m||m.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let C=!1;for(const I of m)if(this._tileClippingMaskIDs[I.key]===void 0){C=!0;break}if(!C)return}this.currentStencilSource=c.id;const x=this.context,v=x.gl;this.nextStencilID+m.length>256&&this.clearStencil(),x.setColorMode(jr.disabled),x.setDepthMode(_r.disabled);const S=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const C of m){const I=c.getTile(C),D=this._tileClippingMaskIDs[C.key]=this.nextStencilID++,{tileBoundsBuffer:L,tileBoundsIndexBuffer:N,tileBoundsSegments:H}=this.getTileBoundsBuffers(I);S.draw(this,v.TRIANGLES,_r.disabled,new Cr({func:v.ALWAYS,mask:0},D,255,v.KEEP,v.KEEP,v.REPLACE),jr.disabled,xr.disabled,s0(C.projMatrix),"$clipping",L,N,H)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const s=this.nextStencilID++,c=this.context.gl;return new Cr({func:c.NOTEQUAL,mask:255},s,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(s){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(s);const c=this.context.gl;return new Cr({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[s.key],0,c.KEEP,c.KEEP,c.REPLACE)}stencilConfigForOverlap(s){const c=this.context.gl,m=s.sort((S,C)=>C.overscaledZ-S.overscaledZ),x=m[m.length-1].overscaledZ,v=m[0].overscaledZ-x+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();const S={};for(let C=0;C<v;C++)S[C+x]=new Cr({func:c.GEQUAL,mask:255},C+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=v,[S,m]}return[{[x]:Cr.disabled},m]}colorModeForRenderPass(){const s=this.context.gl;return this._showOverdrawInspector?new jr([s.CONSTANT_COLOR,s.ONE,s.CONSTANT_COLOR,s.ONE],new o.ax(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?jr.unblended:jr.alphaBlended}colorModeForDrapableLayerRenderPass(s){const c=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new jr([c.ONE,c.ONE_MINUS_SRC_ALPHA,c.CONSTANT_ALPHA,c.ONE_MINUS_SRC_ALPHA],new o.ax(0,0,0,s===void 0?0:s),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(s,c,m,x=!1){if(!this.opaquePassEnabledForLayer()&&!x)return _r.disabled;const v=1-((1+this.currentLayer)*this.numSublayers+s)*this.depthEpsilon;return new _r(m||this.context.gl.LEQUAL,c,[v,v])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(s,c){this._wireframeDebugCache.update(this.frameCounter),this.style=s,this.options=c;const m=this.style._mergedLayers,x=this.style.order,v=x.map(ie=>m[ie]),S=this.style._mergedSourceCaches;this.imageManager=s.imageManager,this.modelManager=s.modelManager,this.symbolFadeChange=s.placement.symbolFadeChange(o.f.now()),this.imageManager.beginFrame();let C=0,I=!1;for(const ie in S){const ve=S[ie];ve.used&&(ve.prepare(this.context),ve.getSource().usedInConflation&&++C)}for(const ie of v)ie.isHidden(this.transform.zoom)||this.prepareLayer(ie);const D={},L={},N={},H={},W={};for(const ie in S){const ve=S[ie];D[ie]=ve.getVisibleCoordinates(),L[ie]=D[ie].slice().reverse(),N[ie]=ve.getVisibleCoordinates(!0).reverse(),H[ie]=ve.getShadowCasterCoordinates(),W[ie]=ve.sortCoordinatesByDistance(D[ie])}const te=ie=>{const ve=this.style.getLayerSourceCache(ie);return ve&&ve.used?ve.getSource():null};if(C){const ie=[];for(const ve of v)this.layerUsedInConflation(ve,te(ve))&&ie.push(ve);if(ie&&ie.length>1){const ve=[];for(const Pe of ie){const Fe=this.style.getLayerSourceCache(Pe);Fe&&Fe.used&&Fe.getSource().usedInConflation&&ve.push({layer:Pe.fqid,cache:Fe})}this.replacementSource.setSources(ve),I=!0}}I||this.replacementSource.clear(),this.conflationActive=I,this.minCutoffZoom=0,this.longestCutoffRange=0;for(const ie of v){const ve=ie.cutoffRange();if(this.longestCutoffRange=Math.max(ve,this.longestCutoffRange),ve>0){const Pe=te(ie);Pe&&(this.minCutoffZoom=Math.max(Pe.minzoom,this.minCutoffZoom)),ie.minzoom&&(this.minCutoffZoom=Math.max(ie.minzoom,this.minCutoffZoom))}}this.opaquePassCutoff=1/0;for(let ie=0;ie<v.length;ie++)if(v[ie].is3D()){this.opaquePassCutoff=ie;break}const ee=this.style&&this.style.fog;ee?(this._fogVisible=ee.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=ee.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(N),this.opaquePassCutoff=0);const ne=this._shadowRenderer;if(ne){ne.updateShadowParameters(this.transform,this.style.directionalLight);for(const ie in S)for(const ve of D[ie]){let Pe={min:0,max:0};this.terrain&&(Pe=this.terrain.getMinMaxForTile(ve)||Pe),ne.addShadowReceiver(ve.toUnwrapped(),Pe.min,Pe.max)}}if(this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new o.cY(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new mr(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!o.cZ(this.context.gl))return;this.renderPass="offscreen";for(const ie of v){const ve=s.getLayerSourceCache(ie);if(!ie.hasOffscreenPass()||ie.isHidden(this.transform.zoom))continue;const Pe=ve?L[ve.id]:void 0;(ie.type==="custom"||ie.type==="raster"||ie.type==="raster-particle"||ie.isSky()||Pe&&Pe.length)&&this.renderLayer(this,ve,ie,Pe)}this.depthRangeFor3D=[0,1-(v.length+2)*this.numSublayers*this.depthEpsilon];const K=this.terrain;K&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&K.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,H)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const ae=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),xe=(()=>{if(c.showOverdrawInspector)return o.ax.black;if(this.style.fog&&this.transform.projection.supportsFog&&!ae){const ie=this.style.fog.properties.get("color").toArray01();return new o.ax(...ie)}if(this.style.fog&&this.transform.projection.supportsFog&&ae){const ie=this.style.fog.properties.get("space-color").toArray01();return new o.ax(...ie)}return o.ax.transparent})();if(this.context.clear({color:xe,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ae&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=x.length-1;this.currentLayer>=0;this.currentLayer--){const ie=v[this.currentLayer],ve=s.getLayerSourceCache(ie);if(ie.isSky())continue;const Pe=ve?(ie.is3D()?W:L)[ve.id]:void 0;this._renderTileClippingMasks(ie,ve,Pe),this.renderLayer(this,ve,ie,Pe)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ae&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||o.S(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<x.length;this.currentLayer++){const ie=v[this.currentLayer],ve=s.getLayerSourceCache(ie);ie.isSky()&&this.renderLayer(this,ve,ie,ve?L[ve.id]:void 0)}function ue(ie,ve){let Pe;return ve&&(Pe=(ie.type==="symbol"?N:ie.is3D()?W:L)[ve.id]),Pe}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<x.length;){const ie=v[this.currentLayer];if(ie.type==="raster"){const ve=s.getLayerSourceCache(ie);this.renderLayer(this,ve,ie,ue(ie,ve))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let ye=0;for(ne&&(ye=ne.getShadowCastingLayerCount());this.currentLayer<x.length;){const ie=v[this.currentLayer],ve=s.getLayerSourceCache(ie);if(ie.isSky())++this.currentLayer;else if(K&&this.style.isLayerDraped(ie)){if(ie.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=K.renderBatch(this.currentLayer)}else{if(this._renderTileClippingMasks(ie,ve,ve?D[ve.id]:void 0),this.renderLayer(this,ve,ie,ue(ie,ve)),!K&&ne&&ye>0&&ie.hasShadowPass()&&--ye==0&&(ne.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const Pe=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Pe;this.currentLayer++){const Fe=v[this.currentLayer];if(!Fe.hasLightBeamPass())continue;const $e=s.getLayerSourceCache(Fe);this.renderLayer(this,$e,Fe,$e?L[$e.id]:void 0)}this.currentLayer=Pe,this.renderPass="translucent"}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let ie=null;v.forEach(ve=>{const Pe=s.getLayerSourceCache(ve);Pe&&!ve.isHidden(this.transform.zoom)&&Pe.getVisibleCoordinates().length&&(!ie||ie.getSource().maxzoom<Pe.getSource().maxzoom)&&(ie=Pe)}),ie&&this.options.showTileBoundaries&&gh.debug(this,ie,ie.getVisibleCoordinates(),o.ax.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&gh.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new o.ax(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(ie){const ve=ie.transform.padding;C0(ie,ie.transform.height-(ve.top||0),3,Ra),C0(ie,ve.bottom||0,3,hl),Ya(ie,ve.left||0,3,L_),Ya(ie,ie.transform.width-(ve.right||0),3,S0);const Pe=ie.transform.centerPoint;(function(Fe,$e,nt,Ge){ri(Fe,$e-1,nt-10,2,20,Ge),ri(Fe,$e-10,nt-1,20,2,Ge)})(ie,Pe.x,ie.transform.height-Pe.y,A0)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),I||(this.conflationActive=!1)}prepareLayer(s){this.gpuTimingStart(s);const{unsupportedLayers:c}=this.transform.projection,m=!c||!c.includes(s.type);if(R0[s.type]&&(m||this.terrain&&s.type==="custom")){const x=this.style.getLayerSourceCache(s);R0[s.type](s,x,this)}this.gpuTimingEnd()}renderLayer(s,c,m,x){m.isHidden(this.transform.zoom)||(m.type==="background"||m.type==="sky"||m.type==="custom"||m.type==="model"||m.type==="raster"||m.type==="raster-particle"||x&&x.length)&&(this.id=m.id,this.gpuTimingStart(m),(!s.transform.projection.unsupportedLayers||!s.transform.projection.unsupportedLayers.includes(m.type)||s.terrain&&m.type==="custom")&&gh[m.type](s,c,m,x,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(s){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery,m=this.context.gl;let x=this.gpuTimers[s.id];x||(x=this.gpuTimers[s.id]={calls:0,cpuTime:0,query:m.createQuery()}),x.calls++,m.beginQuery(c.TIME_ELAPSED_EXT,x.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const s=this.context.extTimerQuery,c=this.context.gl,m=c.createQuery();this.deferredRenderGpuTimeQueries.push(m),c.beginQuery(s.TIME_ELAPSED_EXT,m)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const s=this.gpuTimers;return this.gpuTimers={},s}collectDeferredRenderGpuQueries(){const s=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],s}queryGpuTimers(s){const c={};for(const m in s){const x=s[m],v=this.context.extTimerQuery,S=v.getQueryParameter(x.query,this.context.gl.QUERY_RESULT)/1e6;v.deleteQueryEXT(x.query),c[m]=S}return c}queryGpuTimeDeferredRender(s){if(!this.options.gpuTimingDeferredRender)return 0;const c=this.context.extTimerQuery,m=this.context.gl;let x=0;for(const v of s)x+=c.getQueryParameter(v,m.QUERY_RESULT)/1e6,c.deleteQueryEXT(v);return x}translatePosMatrix(s,c,m,x,v){if(!m[0]&&!m[1])return s;const S=v?x==="map"?this.transform.angle:0:x==="viewport"?-this.transform.angle:0;if(S){const D=Math.sin(S),L=Math.cos(S);m=[m[0]*L-m[1]*D,m[0]*D+m[1]*L]}const C=[v?m[0]:o.a3(c,m[0],this.transform.zoom),v?m[1]:o.a3(c,m[1],this.transform.zoom),0],I=new Float32Array(16);return o.a6.translate(I,s,C),I}saveTileTexture(s){const c=s.size[0],m=this._tileTextures[c];m?m.push(s):this._tileTextures[c]=[s]}getTileTexture(s){const c=this._tileTextures[s];return c&&c.length>0?c.pop():null}isPatternMissing(s,c){return s===null||s!==void 0&&!this.imageManager.getPattern(s.toString(),c)}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(s,c,m){const x=m===void 0?this.terrain&&this.terrain.renderingToTexture:m,v=this.terrain&&this.terrain.exaggeration()===0,S=[];return this.style&&this.style.enable3dLights()&&(s==="globeRaster"||s==="terrainRaster"?(S.push("LIGHTING_3D_MODE"),S.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):x||S.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||S.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?S.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):S.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(S.push("TERRAIN"),this.linearFloatFilteringSupported()&&S.push("TERRAIN_DEM_FLOAT_FORMAT"),v&&S.push("ZERO_EXAGGERATION")),this.transform.projection.name==="globe"&&S.push("GLOBE"),!this._fogVisible||x||c!==void 0&&!c||S.push("FOG","FOG_DITHERING"),x&&S.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&S.push("OVERDRAW_INSPECTOR"),S}getOrCreateProgram(s,c){this.cache=this.cache||{};const m=c&&c.defines||[],x=c&&c.config,v=c&&c.transformFeedback,S=this.currentGlobalDefines(s,c&&c.overrideFog,c&&c.overrideRtt).concat(m),C=u0.cacheKey(t0[s],s,S,x);return this.cache[C]||(this.cache[C]=new u0(this.context,s,t0[s],x,Lv[s],S,v)),this.cache[C]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const s=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(s.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(s,c){if(this.style.enable3dLights()){const m=this.style.directionalLight,x=this.style.ambientLight;if(m&&x){const v=((S,C)=>{const I=S.properties.get("direction"),D=S.properties.get("color").toArray01(),L=S.properties.get("intensity"),N=C.properties.get("color").toArray01(),H=C.properties.get("intensity"),W=[I.x,I.y,I.z],te=o.cn(N,H),ee=o.cn(D,L);return{u_lighting_ambient_color:te,u_lighting_directional_dir:W,u_lighting_directional_color:ee,u_ground_radiance:l0(W,ee,te)}})(m,x);c.setLightsUniformValues(s,v)}}}uploadCommonUniforms(s,c,m,x,v){if(this.uploadCommonLightUniforms(s,c),this.terrain&&this.terrain.renderingToTexture)return;const S=this.style.fog;if(S){const C=S.getOpacity(this.transform.pitch),I=((D,L,N,H,W,te,ee,ne,K,ae,xe,ue)=>{const ye=D.transform,ie=L.properties.get("color").toArray01();ie[3]=H;const ve=D.frameCounter/1e3%1,[Pe,Fe]=L.properties.get("vertical-range");return{u_fog_matrix:N?ye.calculateFogTileMatrix(N):ue||D.identityMat,u_fog_range:L.getFovAdjustedRange(ye._fov),u_fog_color:ie,u_fog_horizon_blend:L.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Pe,Fe),Fe],u_fog_temporal_offset:ve,u_frustum_tl:W,u_frustum_tr:te,u_frustum_br:ee,u_frustum_bl:ne,u_globe_pos:K,u_globe_radius:ae,u_viewport:xe,u_globe_transition:o.S(ye.zoom),u_is_globe:+(ye.projection.name==="globe")}})(this,S,m,C,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*o.f.devicePixelRatio,this.transform.height*o.f.devicePixelRatio],x);c.setFogUniformValues(s,I)}v&&c.setCutoffUniformValues(s,v.uniformValues)}setTileLoadedFlag(s){this.tileLoaded=s}saveCanvasCopy(){const s=this.canvasCopy();s&&(this.frameCopies.push(s),this.tileLoaded=!1)}canvasCopy(){const s=this.context.gl,c=s.createTexture();return s.bindTexture(s.TEXTURE_2D,c),s.copyTexImage2D(s.TEXTURE_2D,0,s.RGBA,0,0,s.drawingBufferWidth,s.drawingBufferHeight,0),c}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const s=this.style&&this.style.fog;return!!s&&s.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const s=this._backgroundTiles,c=this._backgroundTiles={},m=this.transform.coveringTiles({tileSize:512});for(const x of m)c[x.key]=s[x.key]||new el(x,512,this.transform.tileZoom,this);return c}clearBackgroundTiles(){this._backgroundTiles={}}layerUsedInConflation(s,c){return!(!s.is3D()||s.minzoom&&s.minzoom>this.transform.zoom||s.sourceLayer!=="building"&&(!c||c.type!=="batched-model"))}isTileAffectedByFog(s){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let c=this._cachedTileFogOpacities[s.key];return c||(this._cachedTileFogOpacities[s.key]=c=this.style.fog.getOpacityForTile(s)),c[0]>=ln||c[1]>=ln}}function _h(p,s){let c=!1,m=null;const x=()=>{m=null,c&&(p(),m=setTimeout(x,s),c=!1)};return()=>(c=!0,m||x(),m)}class qf{constructor(s){this._hashName=s&&encodeURIComponent(s),o.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=_h(this._updateHashUnthrottled.bind(this),300)}addTo(s){return this._map=s,window.addEventListener("hashchange",this._onHashChange,!1),s.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const s=this._map;if(!s)return"";const c=D0(s);if(this._hashName){const m=this._hashName;let x=!1;const v=location.hash.slice(1).split("&").map(S=>{const C=S.split("=")[0];return C===m?(x=!0,`${C}=${c}`):S}).filter(S=>S);return x||v.push(`${m}=${c}`),`#${v.join("&")}`}return`#${c}`}_getCurrentHash(){const s=location.hash.replace("#","");if(this._hashName){let c;return s.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(c=m)}),(c&&c[1]||"").split("/")}return s.split("/")}_onHashChange(){const s=this._map;if(!s)return!1;const c=this._getCurrentHash();if(c.length>=3&&!c.some(m=>isNaN(m))){const m=s.dragRotate.isEnabled()&&s.touchZoomRotate.isEnabled()?+(c[3]||0):s.getBearing();return s.jumpTo({center:[+c[2],+c[1]],zoom:+c[0],bearing:m,pitch:+(c[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function D0(p,s){const c=p.getCenter(),m=Math.round(100*p.getZoom())/100,x=Math.ceil((m*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,x),S=Math.round(c.lng*v)/v,C=Math.round(c.lat*v)/v,I=p.getBearing(),D=p.getPitch();let L=s?`/${S}/${C}/${m}`:`${m}/${C}/${S}`;return(I||D)&&(L+="/"+Math.round(10*I)/10),D&&(L+=`/${Math.round(D)}`),L}const xh={linearity:.3,easing:o.c_(0,0,.3,1)},Da=o.e({deceleration:2500,maxSpeed:1400},xh),Vv=o.e({deceleration:20,maxSpeed:1400},xh),Zf=o.e({deceleration:1e3,maxSpeed:360},xh),Yn=o.e({deceleration:1e3,maxSpeed:90},xh);class bn{constructor(s){this._map=s,this.clear()}clear(){this._inertiaBuffer=[]}record(s){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.f.now(),settings:s})}_drainInertiaBuffer(){const s=this._inertiaBuffer,c=o.f.now();for(;s.length>0&&c-s[0].time>160;)s.shift()}_onMoveEnd(s){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const c={zoom:0,bearing:0,pitch:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:v}of this._inertiaBuffer)c.zoom+=v.zoomDelta||0,c.bearing+=v.bearingDelta||0,c.pitch+=v.pitchDelta||0,v.panDelta&&c.pan._add(v.panDelta),v.around&&(c.around=v.around),v.pinchAround&&(c.pinchAround=v.pinchAround);const m=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,x={};if(c.pan.mag()){const v=Is(c.pan.mag(),m,o.e({},Da,s||{}));x.offset=c.pan.mult(v.amount/c.pan.mag()),x.center=this._map.transform.center,yh(x,v)}if(c.zoom){const v=Is(c.zoom,m,Vv);x.zoom=this._map.transform.zoom+v.amount,yh(x,v)}if(c.bearing){const v=Is(c.bearing,m,Zf);x.bearing=this._map.transform.bearing+o.aa(v.amount,-179,179),yh(x,v)}if(c.pitch){const v=Is(c.pitch,m,Yn);x.pitch=this._map.transform.pitch+v.amount,yh(x,v)}if(x.zoom||x.bearing){const v=c.pinchAround===void 0?c.around:c.pinchAround;x.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),x.noMoveStart=!0,x}}function yh(p,s){(!p.duration||p.duration<s.duration)&&(p.duration=s.duration,p.easing=s.easing)}function Is(p,s,c){const{maxSpeed:m,linearity:x,deceleration:v}=c,S=o.aa(p*x/(s/1e3),-m,m),C=Math.abs(S)/(v*x);return{easing:c.easing,duration:1e3*C,amount:S*(C/2)}}class va extends o.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,c,m,x={}){const v=Ae(c.getCanvasContainer(),m),S=c.unproject(v);super(s,o.e({point:v,lngLat:S,originalEvent:m},x)),this._defaultPrevented=!1,this.target=c}}class Ao extends o.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,c,m){const x=s==="touchend"?m.changedTouches:m.touches,v=me(c.getCanvasContainer(),x),S=v.map(I=>c.unproject(I)),C=v.reduce((I,D,L,N)=>I.add(D.div(N.length)),new o.P(0,0));super(s,{points:v,point:C,lngLats:S,lngLat:c.unproject(C),originalEvent:m}),this._defaultPrevented=!1}}class F0 extends o.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,c,m){super(s,{originalEvent:m}),this._defaultPrevented=!1}}class L0{constructor(s,c){this._map=s,this._clickTolerance=c.clickTolerance}reset(){this._mousedownPos=void 0}wheel(s){return this._firePreventable(new F0(s.type,this._map,s))}mousedown(s,c){return this._mousedownPos=c,this._firePreventable(new va(s.type,this._map,s))}mouseup(s){this._map.fire(new va(s.type,this._map,s))}preclick(s){const c=o.e({},s);c.type="preclick",this._map.fire(new va(c.type,this._map,c))}click(s,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||(this.preclick(s),this._map.fire(new va(s.type,this._map,s)))}dblclick(s){return this._firePreventable(new va(s.type,this._map,s))}mouseover(s){this._map.fire(new va(s.type,this._map,s))}mouseout(s){this._map.fire(new va(s.type,this._map,s))}touchstart(s){return this._firePreventable(new Ao(s.type,this._map,s))}touchmove(s){this._map.fire(new Ao(s.type,this._map,s))}touchend(s){this._map.fire(new Ao(s.type,this._map,s))}touchcancel(s){this._map.fire(new Ao(s.type,this._map,s))}_firePreventable(s){if(this._map.fire(s),s.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class dl{constructor(s){this._map=s}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(s){this._map.fire(new va(s.type,this._map,s))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new va("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(s){this._delayContextMenu?this._contextMenuEvent=s:this._map.fire(new va(s.type,this._map,s)),this._map.listens("contextmenu")&&s.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class pl{constructor(s,c){this._map=s,this._el=s.getCanvasContainer(),this._container=s.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(s,c){this.isEnabled()&&s.shiftKey&&s.button===0&&(Y(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(s,c){if(!this._active)return;const m=c,x=this._startPos,v=this._lastPos;if(!x||!v||v.equals(m)||!this._box&&m.dist(x)<this._clickTolerance)return;this._lastPos=m,this._box||(this._box=V("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",s));const S=Math.min(x.x,m.x),C=Math.max(x.x,m.x),I=Math.min(x.y,m.y),D=Math.max(x.y,m.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${S}px,${I}px)`,this._box.style.width=C-S+"px",this._box.style.height=D-I+"px")})}mouseupWindow(s,c){if(!this._active)return;const m=this._startPos,x=c;if(m&&s.button===0){if(this.reset(),ke(),m.x!==x.x||m.y!==x.y)return this._map.fire(new o.b("boxzoomend",{originalEvent:s})),{cameraAnimation:v=>v.fitScreenCoordinates(m,x,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",s)}}keydown(s){this._active&&s.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",s))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Z(),delete this._startPos,delete this._lastPos}_fireEvent(s,c){return this._map.fire(new o.b(s,{originalEvent:c}))}}function Zc(p,s){const c={};for(let m=0;m<p.length;m++)c[p[m].identifier]=s[m];return c}class Xf{constructor(s){this.reset(),this.numTouches=s.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(s,c,m){(this.centroid||m.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=s.timeStamp),m.length===this.numTouches&&(this.centroid=function(x){const v=new o.P(0,0);for(const S of x)v._add(S);return v.div(x.length)}(c),this.touches=Zc(m,c)))}touchmove(s,c,m){if(this.aborted||!this.centroid)return;const x=Zc(m,c);for(const v in this.touches){const S=x[v];(!S||S.dist(this.touches[v])>30)&&(this.aborted=!0)}}touchend(s,c,m){if((!this.centroid||s.timeStamp-this.startTime>500)&&(this.aborted=!0),m.length===0){const x=!this.aborted&&this.centroid;if(this.reset(),x)return x}}}class vh{constructor(s){this.singleTap=new Xf(s),this.numTaps=s.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(s,c,m){this.singleTap.touchstart(s,c,m)}touchmove(s,c,m){this.singleTap.touchmove(s,c,m)}touchend(s,c,m){const x=this.singleTap.touchend(s,c,m);if(x){const v=s.timeStamp-this.lastTime<500,S=!this.lastTap||this.lastTap.dist(x)<30;if(v&&S||this.reset(),this.count++,this.lastTime=s.timeStamp,this.lastTap=x,this.count===this.numTaps)return this.reset(),x}}}class O0{constructor(){this._zoomIn=new vh({numTouches:1,numTaps:2}),this._zoomOut=new vh({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(s,c,m){this._zoomIn.touchstart(s,c,m),this._zoomOut.touchstart(s,c,m)}touchmove(s,c,m){this._zoomIn.touchmove(s,c,m),this._zoomOut.touchmove(s,c,m)}touchend(s,c,m){const x=this._zoomIn.touchend(s,c,m),v=this._zoomOut.touchend(s,c,m);return x?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()+1,around:S.unproject(x)},{originalEvent:s})}):v?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()-1,around:S.unproject(v)},{originalEvent:s})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const N0={0:1,2:2};class Js{constructor(s){this.reset(),this._clickTolerance=s.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(s,c){return!1}_move(s,c){return{}}mousedown(s,c){if(this._lastPoint)return;const m=De(s);this._correctButton(s,m)&&(this._lastPoint=c,this._eventButton=m)}mousemoveWindow(s,c){const m=this._lastPoint;if(m){if(s.preventDefault(),this._eventButton!=null&&function(x,v){const S=N0[v];return x.buttons===void 0||(x.buttons&S)!==S}(s,this._eventButton))this.reset();else if(this._moved||!(c.dist(m)<this._clickTolerance))return this._moved=!0,this._lastPoint=c,this._move(m,c)}}mouseupWindow(s){this._lastPoint&&De(s)===this._eventButton&&(this._moved&&ke(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class z0 extends Js{mousedown(s,c){super.mousedown(s,c),this._lastPoint&&(this._active=!0)}_correctButton(s,c){return c===0&&!s.ctrlKey}_move(s,c){return{around:c,panDelta:c.sub(s)}}}class wh extends Js{_correctButton(s,c){return c===0&&s.ctrlKey||c===2}_move(s,c){const m=.8*(c.x-s.x);if(m)return this._active=!0,{bearingDelta:m}}contextmenu(s){s.preventDefault()}}class Yf extends Js{_correctButton(s,c){return c===0&&s.ctrlKey||c===2}_move(s,c){const m=-.5*(c.y-s.y);if(m)return this._active=!0,{pitchDelta:m}}contextmenu(s){s.preventDefault()}}class B0{constructor(s,c){this._map=s,this._el=s.getCanvasContainer(),this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset(),o.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0)}touchstart(s,c,m){return this._calculateTransform(s,c,m)}touchmove(s,c,m){if(this._active&&!(m.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(m.length===1&&!o.c$())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return s.cancelable&&s.preventDefault(),this._calculateTransform(s,c,m)}}touchend(s,c,m){this._calculateTransform(s,c,m),this._active&&m.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(s,c,m){m.length>0&&(this._active=!0);const x=Zc(m,c),v=new o.P(0,0),S=new o.P(0,0);let C=0;for(const D in x){const L=x[D],N=this._touches[D];N&&(v._add(L),S._add(L.sub(N)),C++,x[D]=L)}if(this._touches=x,C<this._minTouches||!S.mag())return;const I=S.div(C);return this._sum._add(I),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(C),panDelta:I}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=V("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Oi{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(s){}_move(s,c,m){return{}}touchstart(s,c,m){this._firstTwoTouches||m.length<2||(this._firstTwoTouches=[m[0].identifier,m[1].identifier],this._start([c[0],c[1]]))}touchmove(s,c,m){const x=this._firstTwoTouches;if(!x)return;s.preventDefault();const[v,S]=x,C=Xc(m,c,v),I=Xc(m,c,S);if(!C||!I)return;const D=this._aroundCenter?null:C.add(I).div(2);return this._move([C,I],D,s)}touchend(s,c,m){if(!this._firstTwoTouches)return;const[x,v]=this._firstTwoTouches,S=Xc(m,c,x),C=Xc(m,c,v);S&&C||(this._active&&ke(),this.reset())}touchcancel(){this.reset()}enable(s){this._enabled=!0,this._aroundCenter=!!s&&s.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Xc(p,s,c){for(let m=0;m<p.length;m++)if(p[m].identifier===c)return s[m]}function Kf(p,s){return Math.log(p/s)/Math.LN2}class bh extends Oi{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(s){this._startDistance=this._distance=s[0].dist(s[1])}_move(s,c){const m=this._distance;if(this._distance=s[0].dist(s[1]),this._active||!(Math.abs(Kf(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Kf(this._distance,m),pinchAround:c}}}function ml(p,s){return 180*p.angleWith(s)/Math.PI}class U0 extends Oi{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(s){this._startVector=this._vector=s[0].sub(s[1]),this._minDiameter=s[0].dist(s[1])}_move(s,c){const m=this._vector;if(this._vector=s[0].sub(s[1]),m&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:ml(this._vector,m),pinchAround:c}}_isBelowThreshold(s){this._minDiameter=Math.min(this._minDiameter,s.mag());const c=25/(Math.PI*this._minDiameter)*360,m=this._startVector;if(!m)return!1;const x=ml(s,m);return Math.abs(x)<c}}function Th(p){return Math.abs(p.y)>Math.abs(p.x)}class V0 extends Oi{constructor(s){super(),this._map=s}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(s){this._lastPoints=s,Th(s[0].sub(s[1]))&&(this._valid=!1)}_move(s,c,m){const x=this._lastPoints;if(!x)return;const v=s[0].sub(x[0]),S=s[1].sub(x[1]);return this._map._cooperativeGestures&&!o.c$()&&m.touches.length<3||(this._valid=this.gestureBeginsVertically(v,S,m.timeStamp),!this._valid)?void 0:(this._lastPoints=s,this._active=!0,{pitchDelta:(v.y+S.y)/2*-.5})}gestureBeginsVertically(s,c,m){if(this._valid!==void 0)return this._valid;const x=s.mag()>=2,v=c.mag()>=2;if(!x&&!v)return;if(!x||!v)return this._firstMove==null&&(this._firstMove=m),m-this._firstMove<100&&void 0;const S=s.y>0==c.y>0;return Th(s)&&Th(c)&&S}}const Kl={panStep:100,bearingStep:15,pitchStep:10};class Eh{constructor(){const s=Kl;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(s){if(s.altKey||s.ctrlKey||s.metaKey)return;let c=0,m=0,x=0,v=0,S=0;switch(s.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:s.shiftKey?m=-1:(s.preventDefault(),v=-1);break;case 39:s.shiftKey?m=1:(s.preventDefault(),v=1);break;case 38:s.shiftKey?x=1:(s.preventDefault(),S=-1);break;case 40:s.shiftKey?x=-1:(s.preventDefault(),S=1);break;default:return}return this._rotationDisabled&&(m=0,x=0),{cameraAnimation:C=>{const I=C.getZoom();C.easeTo({duration:300,easeId:"keyboardHandler",easing:$0,zoom:c?Math.round(I)+c*(s.shiftKey?2:1):I,bearing:C.getBearing()+m*this._bearingStep,pitch:C.getPitch()+x*this._pitchStep,offset:[-v*this._panStep,-S*this._panStep],center:C.getCenter()},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function $0(p){return p*(2-p)}const Sh=4.000244140625,j0=1/450;class B_{constructor(s,c){this._map=s,this._el=s.getCanvasContainer(),this._handler=c,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=j0,o.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(s){this._defaultZoomRate=s}setWheelZoomRate(s){this._wheelZoomRate=s}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(s){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!s&&s.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(s){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(s.ctrlKey||s.metaKey||this.isZooming()||o.c$()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let c=s.deltaMode===WheelEvent.DOM_DELTA_LINE?40*s.deltaY:s.deltaY;const m=o.f.now(),x=m-(this._lastWheelEventTime||0);this._lastWheelEventTime=m,c!==0&&c%Sh==0?this._type="wheel":c!==0&&Math.abs(c)<4?this._type="trackpad":x>400?(this._type=null,this._lastValue=c,this._timeout=setTimeout(this._onTimeout,40,s)):this._type||(this._type=Math.abs(x*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),s.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=s,this._delta-=c,this._active||this._start(s)),s.preventDefault()}_onTimeout(s){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(s)}_start(s){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const c=Ae(this._el,s);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:c,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const s=this._map.transform;this._type==="wheel"&&s.projection.wrap&&(s._center.lng>=180||s._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const c=()=>s._terrainEnabled()&&this._aroundCoord?s.computeZoomRelativeTo(this._aroundCoord):s.zoom;if(this._delta!==0){const D=this._type==="wheel"&&Math.abs(this._delta)>Sh?this._wheelZoomRate:this._defaultZoomRate;let L=2/(1+Math.exp(-Math.abs(this._delta*D)));this._delta<0&&L!==0&&(L=1/L);const N=c(),H=Math.pow(2,N),W=typeof this._targetZoom=="number"?s.zoomScale(this._targetZoom):H;this._targetZoom=Math.min(s.maxZoom,Math.max(s.minZoom,s.scaleZoom(W*L))),this._type==="wheel"&&(this._startZoom=N,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const m=typeof this._targetZoom=="number"?this._targetZoom:c(),x=this._startZoom,v=this._easing;let S,C=!1;if(this._type==="wheel"&&x&&v){const D=Math.min((o.f.now()-this._lastWheelEventTime)/200,1),L=v(D);S=o.U(x,m,L),D<1?this._frameId||(this._frameId=!0):C=!0}else S=m,C=!0;this._active=!0,C&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let I=S-c();return I*this._lastDelta<0&&(I=0),{noInertia:!0,needsRenderFrame:!C,zoomDelta:I,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(s){let c=o.d0;if(this._prevEase){const m=this._prevEase,x=(o.f.now()-m.start)/m.duration,v=m.easing(x+.01)-m.easing(x),S=.27/Math.sqrt(v*v+1e-4)*.01,C=Math.sqrt(.0729-S*S);c=o.c_(S,C,.25,1)}return this._prevEase={start:o.f.now(),duration:s,easing:c},c}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=V("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class U_{constructor(s,c){this._clickZoom=s,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class V_{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(s,c){return s.preventDefault(),{cameraAnimation:m=>{m.easeTo({duration:300,zoom:m.getZoom()+(s.shiftKey?-1:1),around:m.unproject(c)},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class $_{constructor(){this._tap=new vh({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(s,c,m){this._swipePoint||(this._tapTime&&s.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?m.length>0&&(this._swipePoint=c[0],this._swipeTouch=m[0].identifier):this._tap.touchstart(s,c,m))}touchmove(s,c,m){if(this._tapTime){if(this._swipePoint){if(m[0].identifier!==this._swipeTouch)return;const x=c[0],v=x.y-this._swipePoint.y;return this._swipePoint=x,s.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(s,c,m)}touchend(s,c,m){this._tapTime?this._swipePoint&&m.length===0&&this.reset():this._tap.touchend(s,c,m)&&(this._tapTime=s.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class j_{constructor(s,c,m){this._el=s,this._mousePan=c,this._touchPan=m}enable(s){this._inertiaOptions=s||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class G_{constructor(s,c,m){this._pitchWithRotate=s.pitchWithRotate,this._mouseRotate=c,this._mousePitch=m}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class H_{constructor(s,c,m,x){this._el=s,this._touchZoom=c,this._touchRotate=m,this._tapDragZoom=x,this._rotationDisabled=!1,this._enabled=!0}enable(s){this._touchZoom.enable(s),this._rotationDisabled||this._touchRotate.enable(s),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Ah=p=>p.zoom||p.drag||p.pitch||p.rotate;class W_ extends o.b{}class q_{constructor(){this.constants=[1,1,.01],this.radius=0}setup(s,c){const m=o.N.sub([],c,s);this.radius=o.N.length(m[2]<0?o.N.div([],m,this.constants):[m[0],m[1],0])}projectRay(s){o.N.div(s,s,this.constants),o.N.normalize(s,s),o.N.mul(s,s,this.constants);const c=o.N.scale([],s,this.radius);if(c[2]>0){const m=o.N.scale([],[0,0,1],o.N.dot(c,[0,0,1])),x=o.N.scale([],o.N.normalize([],[c[0],c[1],0]),this.radius),v=o.N.add([],c,o.N.scale([],o.N.sub([],o.N.add([],x,m),c),2));c[0]=v[0],c[1]=v[1]}return c}}function Ch(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}class $v{constructor(s,c){this._map=s,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new bn(s),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new q_,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(c),o.aY(["handleEvent","handleWindowEvent"],this);const m=this._el;this._listeners=[[m,"touchstart",{passive:!0}],[m,"touchmove",{passive:!1}],[m,"touchend",void 0],[m,"touchcancel",void 0],[m,"mousedown",void 0],[m,"mousemove",void 0],[m,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[m,"mouseover",void 0],[m,"mouseout",void 0],[m,"dblclick",void 0],[m,"click",void 0],[m,"keydown",{capture:!1}],[m,"keyup",void 0],[m,"wheel",{passive:!1}],[m,"contextmenu",void 0],[window,"blur",void 0]];for(const[x,v,S]of this._listeners){const C=x===document?this.handleWindowEvent:this.handleEvent;x.addEventListener(v,C,S)}}destroy(){for(const[s,c,m]of this._listeners){const x=s===document?this.handleWindowEvent:this.handleEvent;s.removeEventListener(c,x,m)}}_addDefaultHandlers(s){const c=this._map,m=c.getCanvasContainer();this._add("mapEvent",new L0(c,s));const x=c.boxZoom=new pl(c,s);this._add("boxZoom",x);const v=new O0,S=new V_;c.doubleClickZoom=new U_(S,v),this._add("tapZoom",v),this._add("clickZoom",S);const C=new $_;this._add("tapDragZoom",C);const I=c.touchPitch=new V0(c);this._add("touchPitch",I);const D=new wh(s),L=new Yf(s);c.dragRotate=new G_(s,D,L),this._add("mouseRotate",D,["mousePitch"]),this._add("mousePitch",L,["mouseRotate"]);const N=new z0(s),H=new B0(c,s);c.dragPan=new j_(m,N,H),this._add("mousePan",N),this._add("touchPan",H,["touchZoom","touchRotate"]);const W=new U0,te=new bh;c.touchZoomRotate=new H_(m,te,W,C),this._add("touchRotate",W,["touchPan","touchZoom"]),this._add("touchZoom",te,["touchPan","touchRotate"]),this._add("blockableMapEvent",new dl(c));const ee=c.scrollZoom=new B_(c,this);this._add("scrollZoom",ee,["mousePan"]);const ne=c.keyboard=new Eh;this._add("keyboard",ne);for(const K of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])s.interactive&&s[K]&&c[K].enable(s[K])}_add(s,c,m){this._handlers.push({handlerName:s,handler:c,allowed:m}),this._handlersById[s]=c}stop(s){if(!this._updatingCamera){for(const{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},s),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:s}of this._handlers)if(s.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ah(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(s,c,m){for(const x in s)if(x!==m&&(!c||c.indexOf(x)<0))return!0;return!1}handleWindowEvent(s){this.handleEvent(s,`${s.type}Window`)}_getMapTouches(s){const c=[];for(const m of s)this._el.contains(m.target)&&c.push(m);return c}handleEvent(s,c){this._updatingCamera=!0;const m=s.type==="renderFrame",x=m?void 0:s,v={needsRenderFrame:!1},S={},C={},I=s.touches?this._getMapTouches(s.touches):void 0,D=I?me(this._el,I):m?void 0:Ae(this._el,s);for(const{handlerName:H,handler:W,allowed:te}of this._handlers){if(!W.isEnabled())continue;let ee;this._blockedByActive(C,te,H)?W.reset():W[c||s.type]&&(ee=W[c||s.type](s,D,I),this.mergeHandlerResult(v,S,ee,H,x),ee&&ee.needsRenderFrame&&this._triggerRenderFrame()),(ee||W.isActive())&&(C[H]=W)}const L={};for(const H in this._previousActiveHandlers)C[H]||(L[H]=x);this._previousActiveHandlers=C,(Object.keys(L).length||Ch(v))&&(this._changes.push([v,S,L]),this._triggerRenderFrame()),(Object.keys(C).length||Ch(v))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:N}=v;N&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],N(this._map))}mergeHandlerResult(s,c,m,x,v){if(!m)return;o.e(s,m);const S={handlerName:x,originalEvent:m.originalEvent||v};m.zoomDelta!==void 0&&(c.zoom=S),m.panDelta!==void 0&&(c.drag=S),m.pitchDelta!==void 0&&(c.pitch=S),m.bearingDelta!==void 0&&(c.rotate=S)}_applyChanges(){const s={},c={},m={};for(const[x,v,S]of this._changes)x.panDelta&&(s.panDelta=(s.panDelta||new o.P(0,0))._add(x.panDelta)),x.zoomDelta&&(s.zoomDelta=(s.zoomDelta||0)+x.zoomDelta),x.bearingDelta&&(s.bearingDelta=(s.bearingDelta||0)+x.bearingDelta),x.pitchDelta&&(s.pitchDelta=(s.pitchDelta||0)+x.pitchDelta),x.around!==void 0&&(s.around=x.around),x.aroundCoord!==void 0&&(s.aroundCoord=x.aroundCoord),x.pinchAround!==void 0&&(s.pinchAround=x.pinchAround),x.noInertia&&(s.noInertia=x.noInertia),o.e(c,v),o.e(m,S);this._updateMapTransform(s,c,m),this._changes=[]}_updateMapTransform(s,c,m){const x=this._map,v=x.transform,S=ae=>[ae.x,ae.y,ae.z];if((ae=>{const xe=this._eventsInProgress.drag;return xe&&!this._handlersById[xe.handlerName].isActive()})()&&!Ch(s)){const ae=v.zoom;v.cameraElevationReference="sea",this._originalZoom!=null&&v._orthographicProjectionAtLowPitch&&v.projection.name!=="globe"&&v.pitch===0?(v.cameraElevationReference="ground",v.zoom=this._originalZoom):(v.recenterOnTerrain(),v.cameraElevationReference="ground"),ae!==v.zoom&&this._map._update(!0)}if(v._isCameraConstrained&&x._stop(!0),!Ch(s))return void this._fireEvents(c,m,!0);let{panDelta:C,zoomDelta:I,bearingDelta:D,pitchDelta:L,around:N,aroundCoord:H,pinchAround:W}=s;v._isCameraConstrained&&(I>0&&(I=0),v._isCameraConstrained=!1),W!==void 0&&(N=W),(I||(ae=>c[ae]&&!this._eventsInProgress[ae])("drag"))&&N&&(this._dragOrigin=S(v.pointCoordinate3D(N)),this._originalZoom=v.zoom,this._trackingEllipsoid.setup(v._camera.position,this._dragOrigin)),v.cameraElevationReference="sea",x._stop(!0),N=N||x.transform.centerPoint,D&&(v.bearing+=D),L&&(v.pitch+=L),v._updateCameraState();const te=[0,0,0];if(C)if(v.projection.name==="mercator"){const ae=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(N).dir),xe=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(N.sub(C)).dir);te[0]=xe[0]-ae[0],te[1]=xe[1]-ae[1]}else{const ae=v.pointCoordinate(N);if(v.projection.name==="globe"){C=C.rotate(-v.angle);const xe=v._pixelsPerMercatorPixel/v.worldSize;te[0]=-C.x*o.d1(o.au(ae.y))*xe,te[1]=-C.y*o.d1(v.center.lat)*xe}else{const xe=v.pointCoordinate(N.sub(C));ae&&xe&&(te[0]=xe.x-ae.x,te[1]=xe.y-ae.y)}}const ee=v.zoom,ne=[0,0,0];if(I){const ae=S(H||v.pointCoordinate3D(N)),xe={dir:o.N.normalize([],o.N.sub([],ae,v._camera.position))};if(xe.dir[2]<0){const ue=v.zoomDeltaToMovement(ae,I);o.N.scale(ne,xe.dir,ue)}}const K=o.N.add(te,te,ne);v._translateCameraConstrained(K),I&&Math.abs(v.zoom-ee)>1e-4&&v.recenterOnTerrain(),v.cameraElevationReference="ground",this._map._update(),s.noInertia||this._inertia.record(s),this._fireEvents(c,m,!0)}_fireEvents(s,c,m){const x=Ah(this._eventsInProgress),v=Ah(s),S={};for(const L in s){const{originalEvent:N}=s[L];this._eventsInProgress[L]||(S[`${L}start`]=N),this._eventsInProgress[L]=s[L]}!x&&v&&this._fireEvent("movestart",v.originalEvent);for(const L in S)this._fireEvent(L,S[L]);v&&this._fireEvent("move",v.originalEvent);for(const L in s){const{originalEvent:N}=s[L];this._fireEvent(L,N)}const C={};let I;for(const L in this._eventsInProgress){const{handlerName:N,originalEvent:H}=this._eventsInProgress[L];this._handlersById[N].isActive()||(delete this._eventsInProgress[L],I=c[N]||H,C[`${L}end`]=I)}for(const L in C)this._fireEvent(L,C[L]);const D=Ah(this._eventsInProgress);if(m&&(x||v)&&!D){this._updatingCamera=!0;const L=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),N=H=>H!==0&&-this._bearingSnap<H&&H<this._bearingSnap;L?(N(L.bearing||this._map.getBearing())&&(L.bearing=0),this._map.easeTo(L,{originalEvent:I})):(this._map.fire(new o.b("moveend",{originalEvent:I})),N(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(s,c){this._map.fire(new o.b(s,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(s=>{this._frameId=void 0,this.handleEvent(new W_("renderFrame",{timeStamp:s})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Z_="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class ui extends o.E{constructor(s,c){super(),this._moving=!1,this._zooming=!1,this.transform=s,this._bearingSnap=c.bearingSnap,this._respectPrefersReducedMotion=c.respectPrefersReducedMotion!==!1,o.aY(["_renderFrameCallback"],this)}getCenter(){return new o.bn(this.transform.center.lng,this.transform.center.lat)}setCenter(s,c){return this.jumpTo({center:s},c)}panBy(s,c,m){return s=o.P.convert(s).mult(-1),this.panTo(this.transform.center,o.e({offset:s},c),m)}panTo(s,c,m){return this.easeTo(o.e({center:s},c),m)}getZoom(){return this.transform.zoom}setZoom(s,c){return this.jumpTo({zoom:s},c),this}zoomTo(s,c,m){return this.easeTo(o.e({zoom:s},c),m)}zoomIn(s,c){return this.zoomTo(this.getZoom()+1,s,c),this}zoomOut(s,c){return this.zoomTo(this.getZoom()-1,s,c),this}getBearing(){return this.transform.bearing}setBearing(s,c){return this.jumpTo({bearing:s},c),this}getPadding(){return this.transform.padding}setPadding(s,c){return this.jumpTo({padding:s},c),this}rotateTo(s,c,m){return this.easeTo(o.e({bearing:s},c),m)}resetNorth(s,c){return this.rotateTo(0,o.e({duration:1e3},s),c),this}resetNorthPitch(s,c){return this.easeTo(o.e({bearing:0,pitch:0,duration:1e3},s),c),this}snapToNorth(s,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(s,c):this}getPitch(){return this.transform.pitch}setPitch(s,c){return this.jumpTo({pitch:s},c),this}cameraForBounds(s,c){s=o.ad.convert(s);const m=c&&c.bearing||0,x=c&&c.pitch||0,v=s.getNorthWest(),S=s.getSouthEast();return this._cameraForBounds(this.transform,v,S,m,x,c)}_extendCameraOptions(s){const c={top:0,bottom:0,right:0,left:0};if(typeof(s=o.e({padding:c,offset:[0,0],maxZoom:this.transform.maxZoom},s)).padding=="number"){const m=s.padding;s.padding={top:m,bottom:m,right:m,left:m}}return s.padding=o.e(c,s.padding),s}_minimumAABBFrustumDistance(s,c){const m=c.max[0]-c.min[0],x=c.max[1]-c.min[1];return m/x>s.aspect?m/(2*Math.tan(.5*s.fovX)*s.aspect):x/(2*Math.tan(.5*s.fovY)*s.aspect)}_cameraForBoundsOnGlobe(s,c,m,x,v,S){const C=s.clone(),I=this._extendCameraOptions(S);C.bearing=x,C.pitch=v;const D=o.bn.convert(c),L=o.bn.convert(m),N=.5*(D.lat+L.lat),H=.5*(D.lng+L.lng),W=o.d2(N,H),te=o.N.normalize([],W),ee=o.N.normalize([],o.N.cross([],te,[0,1,0])),ne=o.N.cross([],ee,te),K=[ee[0],ee[1],ee[2],0,ne[0],ne[1],ne[2],0,te[0],te[1],te[2],0,0,0,0,1],ae=[W,o.d2(D.lat,D.lng),o.d2(L.lat,D.lng),o.d2(L.lat,L.lng),o.d2(D.lat,L.lng),o.d2(N,D.lng),o.d2(N,L.lng),o.d2(D.lat,H),o.d2(L.lat,H)];let xe=o.bS.fromPoints(ae.map(Qe=>[o.N.dot(ee,Qe),o.N.dot(ne,Qe),o.N.dot(te,Qe)]));const ue=o.N.transformMat4([],xe.center,K);o.N.squaredLength(ue)===0&&o.N.set(ue,0,0,1),o.N.normalize(ue,ue),o.N.scale(ue,ue,o.ab),C.center=o.d3(ue);const ye=C.getWorldToCameraMatrix(),ie=o.a6.invert(new Float64Array(16),ye);xe=o.bS.applyTransform(xe,o.a6.multiply([],ye,K)),o.N.transformMat4(ue,ue,ye);const ve=.5*(xe.max[2]-xe.min[2]),Pe=this._minimumAABBFrustumDistance(C,xe),Fe=o.N.scale([],[0,0,1],ve),$e=o.N.add(Fe,ue,Fe),nt=Pe+(C.pitch===0?0:o.N.distance(ue,$e)),Ge=C.globeCenterInViewSpace,ft=o.N.sub([],ue,[Ge[0],Ge[1],Ge[2]]);o.N.normalize(ft,ft),o.N.scale(ft,ft,nt);const ct=o.N.add([],ue,ft);o.N.transformMat4(ct,ct,ie);const Ct=o.d4/o.ab,qe=o.N.length(ct),ot=o.bl(Math.max(qe*Ct-o.d4,Number.EPSILON),0),Ue=Math.min(C.zoomFromMercatorZAdjusted(ot),I.maxZoom);return Ue>.5*(o.bG+o.bx)?(C.setProjection({name:"mercator"}),C.zoom=Ue,this._cameraForBounds(C,c,m,x,v,S)):{center:C.center,zoom:Ue,bearing:x,pitch:v}}queryTerrainElevation(s,c){const m=this.transform.elevation;return m?(c=o.e({},{exaggerated:!0},c),m.getAtPoint(o.L.fromLngLat(s),null,c.exaggerated)):null}_cameraForBounds(s,c,m,x,v,S){if(s.projection.name==="globe")return this._cameraForBoundsOnGlobe(s,c,m,x,v,S);const C=s.clone(),I=this._extendCameraOptions(S),D=C.padding;C.bearing=x,C.pitch=v;const L=o.bn.convert(c),N=o.bn.convert(m),H=new o.bn(L.lng,N.lat),W=new o.bn(N.lng,L.lat),te=C.project(L),ee=C.project(N),ne=this.queryTerrainElevation(L),K=this.queryTerrainElevation(N),ae=this.queryTerrainElevation(H),xe=this.queryTerrainElevation(W),ue=[[te.x,te.y,Math.min(ne||0,K||0,ae||0,xe||0)],[ee.x,ee.y,Math.max(ne||0,K||0,ae||0,xe||0)]];let ye=o.bS.fromPoints(ue);const ie=C.getWorldToCameraMatrix(),ve=o.a6.invert(new Float64Array(16),ie);ye=o.bS.applyTransform(ye,ie);const Pe=o.N.sub([],ye.max,ye.min),Fe=D.left||0,$e=D.right||0,nt=D.bottom||0,Ge=D.top||0,{left:ft,right:ct,top:Ct,bottom:qe}=I.padding,ot=.5*(Fe+$e),Ue=.5*(Ge+nt),Qe=Math.min(C.scaleZoom(C.scale*Math.min((C.width-(Fe+$e+ft+ct))/Pe[0],(C.height-(nt+Ge+qe+Ct))/Pe[1])),I.maxZoom),Mt=C.scale/C.zoomScale(Qe);ye=new o.bS([ye.min[0]-(ft+ot)*Mt,ye.min[1]-(qe+Ue)*Mt,ye.min[2]],[ye.max[0]+(ct+ot)*Mt,ye.max[1]+(Ct+Ue)*Mt,ye.max[2]]);const Ut=.5*Pe[2],Bt=this._minimumAABBFrustumDistance(C,ye),Yt=[0,0,1,0];o.a7.transformMat4(Yt,Yt,ie),o.a7.normalize(Yt,Yt);const or=o.N.scale([],Yt,Bt+Ut),pr=o.N.add([],ye.center,or),ur=(typeof I.offset.x=="number"&&typeof I.offset.y=="number"?new o.P(I.offset.x,I.offset.y):o.P.convert(I.offset)).rotate(-o.bj(x));ye.center[0]-=ur.x*Mt,ye.center[1]+=ur.y*Mt,o.N.transformMat4(ye.center,ye.center,ve),o.N.transformMat4(pr,pr,ve);const fr=[ye.center[0],ye.center[1],pr[2]*C.pixelsPerMeter];o.N.scale(fr,fr,1/C.worldSize);const zr=o.at(fr[0]),Sr=o.au(fr[1]),Pr=Math.min(C._zoomFromMercatorZ(fr[2]),I.maxZoom),Mr=new o.bn(zr,Sr);return C.mercatorFromTransition&&Pr<.5*(o.bG+o.bx)?(C.setProjection({name:"globe"}),C.zoom=Pr,this._cameraForBounds(C,c,m,x,v,S)):{center:Mr,zoom:Pr,bearing:x,pitch:v}}fitBounds(s,c,m){const x=this.cameraForBounds(s,c);return this._fitInternal(x,c,m)}fitScreenCoordinates(s,c,m,x,v){const S=o.P.convert(s),C=o.P.convert(c),I=new o.P(Math.min(S.x,C.x),Math.min(S.y,C.y)),D=new o.P(Math.max(S.x,C.x),Math.max(S.y,C.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(S,C))return this;const L=this.transform.pointLocation3D(I),N=this.transform.pointLocation3D(D),H=this.transform.pointLocation3D(new o.P(I.x,D.y)),W=this.transform.pointLocation3D(new o.P(D.x,I.y)),te=[Math.min(L.lng,N.lng,H.lng,W.lng),Math.min(L.lat,N.lat,H.lat,W.lat)],ee=[Math.max(L.lng,N.lng,H.lng,W.lng),Math.max(L.lat,N.lat,H.lat,W.lat)],ne=x&&x.pitch?x.pitch:this.getPitch(),K=this._cameraForBounds(this.transform,te,ee,m,ne,x);return this._fitInternal(K,x,v)}_fitInternal(s,c,m){return s?(delete(c=o.e(s,c)).padding,c.linear?this.easeTo(c,m):this.flyTo(c,m)):this}jumpTo(s,c){this.stop();const m=s.preloadOnly?this.transform.clone():this.transform;let x=!1,v=!1,S=!1;return"zoom"in s&&m.zoom!==+s.zoom&&(x=!0,m.zoom=+s.zoom),s.center!==void 0&&(m.center=o.bn.convert(s.center)),"bearing"in s&&m.bearing!==+s.bearing&&(v=!0,m.bearing=+s.bearing),"pitch"in s&&m.pitch!==+s.pitch&&(S=!0,m.pitch=+s.pitch),s.padding==null||m.isPaddingEqual(s.padding)||(m.padding=s.padding),s.preloadOnly?(this._preloadTiles(m),this):(this.fire(new o.b("movestart",c)).fire(new o.b("move",c)),x&&this.fire(new o.b("zoomstart",c)).fire(new o.b("zoom",c)).fire(new o.b("zoomend",c)),v&&this.fire(new o.b("rotatestart",c)).fire(new o.b("rotate",c)).fire(new o.b("rotateend",c)),S&&this.fire(new o.b("pitchstart",c)).fire(new o.b("pitch",c)).fire(new o.b("pitchend",c)),this.fire(new o.b("moveend",c)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.w(Z_),this.transform.getFreeCameraOptions()}setFreeCameraOptions(s,c){const m=this.transform;if(!m.projection.supportsFreeCamera)return o.w(Z_),this;this.stop();const x=m.zoom,v=m.pitch,S=m.bearing;m.setFreeCameraOptions(s);const C=x!==m.zoom,I=v!==m.pitch,D=S!==m.bearing;return this.fire(new o.b("movestart",c)).fire(new o.b("move",c)),C&&this.fire(new o.b("zoomstart",c)).fire(new o.b("zoom",c)).fire(new o.b("zoomend",c)),D&&this.fire(new o.b("rotatestart",c)).fire(new o.b("rotate",c)).fire(new o.b("rotateend",c)),I&&this.fire(new o.b("pitchstart",c)).fire(new o.b("pitch",c)).fire(new o.b("pitchend",c)),this.fire(new o.b("moveend",c)),this}easeTo(s,c){this._stop(!1,s.easeId),((s=o.e({offset:[0,0],duration:500,easing:o.d0},s)).animate===!1||this._prefersReducedMotion(s))&&(s.duration=0);const m=this.transform,x=this.getZoom(),v=this.getBearing(),S=this.getPitch(),C=this.getPadding(),I="zoom"in s?+s.zoom:x,D="bearing"in s?this._normalizeBearing(s.bearing,v):v,L="pitch"in s?+s.pitch:S,N="padding"in s?s.padding:m.padding,H=o.P.convert(s.offset);let W,te,ee;if(m.projection.name==="globe"){const Fe=o.L.fromLngLat(m.center),$e=H.rotate(-m.angle);Fe.x+=$e.x/m.worldSize,Fe.y+=$e.y/m.worldSize;const nt=Fe.toLngLat(),Ge=o.bn.convert(s.center||nt);this._normalizeCenter(Ge),W=m.centerPoint.add($e),te=new o.P(Fe.x,Fe.y).mult(m.worldSize),ee=new o.P(o.a5(Ge.lng),o.ae(Ge.lat)).mult(m.worldSize).sub(te)}else{W=m.centerPoint.add(H);const Fe=m.pointLocation(W),$e=o.bn.convert(s.center||Fe);this._normalizeCenter($e),te=m.project(Fe),ee=m.project($e).sub(te)}const ne=m.zoomScale(I-x);let K,ae;s.around&&(K=o.bn.convert(s.around),ae=m.locationPoint(K));const xe=this._zooming||I!==x,ue=this._rotating||v!==D,ye=this._pitching||L!==S,ie=!m.isPaddingEqual(N),ve=Fe=>$e=>{if(xe&&(Fe.zoom=o.U(x,I,$e)),ue&&(Fe.bearing=o.U(v,D,$e)),ye&&(Fe.pitch=o.U(S,L,$e)),ie&&(Fe.interpolatePadding(C,N,$e),W=Fe.centerPoint.add(H)),K)Fe.setLocationAtPoint(K,ae);else{const nt=Fe.zoomScale(Fe.zoom-x),Ge=I>x?Math.min(2,ne):Math.max(.5,ne),ft=Math.pow(Ge,1-$e),ct=Fe.unproject(te.add(ee.mult($e*ft)).mult(nt));Fe.setLocationAtPoint(Fe.renderWorldCopies?ct.wrap():ct,W)}return s.preloadOnly||this._fireMoveEvents(c),Fe};if(s.preloadOnly){const Fe=this._emulate(ve,s.duration,m);return this._preloadTiles(Fe),this}const Pe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=xe,this._rotating=ue,this._pitching=ye,this._easeId=s.easeId,this._prepareEase(c,s.noMoveStart,Pe),this._ease(ve(m),Fe=>{m.cameraElevationReference==="sea"&&m.recenterOnTerrain(),this._afterEase(c,Fe)},s),this}_prepareEase(s,c,m={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),c||m.moving||this.fire(new o.b("movestart",s)),this._zooming&&!m.zooming&&this.fire(new o.b("zoomstart",s)),this._rotating&&!m.rotating&&this.fire(new o.b("rotatestart",s)),this._pitching&&!m.pitching&&this.fire(new o.b("pitchstart",s))}_fireMoveEvents(s){this.fire(new o.b("move",s)),this._zooming&&this.fire(new o.b("zoom",s)),this._rotating&&this.fire(new o.b("rotate",s)),this._pitching&&this.fire(new o.b("pitch",s))}_afterEase(s,c){if(this._easeId&&c&&this._easeId===c)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const m=this._zooming,x=this._rotating,v=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,m&&this.fire(new o.b("zoomend",s)),x&&this.fire(new o.b("rotateend",s)),v&&this.fire(new o.b("pitchend",s)),this.fire(new o.b("moveend",s))}flyTo(s,c){if(this._prefersReducedMotion(s)){const qe=o.ac(s,["center","zoom","bearing","pitch","around"]);return this.jumpTo(qe,c)}this.stop(),s=o.e({offset:[0,0],speed:1.2,curve:1.42,easing:o.d0},s);const m=this.transform,x=this.getZoom(),v=this.getBearing(),S=this.getPitch(),C="zoom"in s?o.aa(+s.zoom,m.minZoom,m.maxZoom):x,I="bearing"in s?this._normalizeBearing(s.bearing,v):v,D="pitch"in s?+s.pitch:S,L=m.zoomScale(C-x),N=o.P.convert(s.offset),H=m.centerPoint.add(N),W=m.pointLocation(H);let te=s.center;if(te&&s.padding){const qe=this._cameraForBounds(this.transform,te,te,I,D,s);qe&&(te=qe.center)}te=o.bn.convert(te||W),this._normalizeCenter(te);const ee=m.project(W),ne=m.project(te).sub(ee);let K=s.curve;const ae=Math.max(m.width,m.height),xe=ae/L,ue=ne.mag();if("minZoom"in s){const qe=o.aa(Math.min(s.minZoom,x,C),m.minZoom,m.maxZoom),ot=ae/m.zoomScale(qe-x);K=Math.sqrt(ot/ue*2)}const ye=K*K;function ie(qe){const ot=(xe*xe-ae*ae+(qe?-1:1)*ye*ye*ue*ue)/(2*(qe?xe:ae)*ye*ue);return Math.log(Math.sqrt(ot*ot+1)-ot)}function ve(qe){return(Math.exp(qe)-Math.exp(-qe))/2}function Pe(qe){return(Math.exp(qe)+Math.exp(-qe))/2}const Fe=ie(0);let $e=function(qe){return Pe(Fe)/Pe(Fe+K*qe)},nt=function(qe){return ae*((Pe(Fe)*(ve(ot=Fe+K*qe)/Pe(ot))-ve(Fe))/ye)/ue;var ot},Ge=(ie(1)-Fe)/K;if(Math.abs(ue)<1e-6||!isFinite(Ge)){if(Math.abs(ae-xe)<1e-6)return this.easeTo(s,c);const qe=xe<ae?-1:1;Ge=Math.abs(Math.log(xe/ae))/K,nt=function(){return 0},$e=function(ot){return Math.exp(qe*K*ot)}}s.duration="duration"in s?+s.duration:1e3*Ge/("screenSpeed"in s?+s.screenSpeed/K:+s.speed),s.maxDuration&&s.duration>s.maxDuration&&(s.duration=0);const ft=v!==I,ct=D!==S,Ct=qe=>ot=>{const Ue=ot*Ge,Qe=1/$e(Ue);qe.zoom=ot===1?C:x+qe.scaleZoom(Qe),ft&&(qe.bearing=o.U(v,I,ot)),ct&&(qe.pitch=o.U(S,D,ot));const Mt=ot===1?te:qe.unproject(ee.add(ne.mult(nt(Ue))).mult(Qe));return qe.setLocationAtPoint(qe.renderWorldCopies?Mt.wrap():Mt,H),qe._updateCameraOnTerrain(),s.preloadOnly||this._fireMoveEvents(c),qe};if(s.preloadOnly){const qe=this._emulate(Ct,s.duration,m);return this._preloadTiles(qe),this}return this._zooming=!0,this._rotating=ft,this._pitching=ct,this._prepareEase(c,!1),this._ease(Ct(m),()=>this._afterEase(c),s),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(s,c){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const m=this._onEaseEnd;this._onEaseEnd=void 0,m.call(this,c)}if(!s){const m=this.handlers;m&&m.stop(!1)}return this}_ease(s,c,m){m.animate===!1||m.duration===0?(s(1),c()):(this._easeStart=o.f.now(),this._easeOptions=m,this._onEaseFrame=s,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const s=Math.min((o.f.now()-this._easeStart)/this._easeOptions.duration,1),c=this._onEaseFrame;c&&c(this._easeOptions.easing(s)),s<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(s,c){s=o.bh(s,-180,180);const m=Math.abs(s-c);return Math.abs(s-360-c)<m&&(s-=360),Math.abs(s+360-c)<m&&(s+=360),s}_normalizeCenter(s){const c=this.transform;if(c.maxBounds||c.projection.name!=="globe"&&!c.renderWorldCopies)return;const m=s.lng-c.center.lng;s.lng+=m>180?-360:m<-180?360:0}_prefersReducedMotion(s){return this._respectPrefersReducedMotion&&o.f.prefersReducedMotion&&!(s&&s.essential)}_emulate(s,c,m){const x=Math.ceil(15*c/1e3),v=[],S=s(m.clone());for(let C=0;C<=x;C++){const I=S(C/x);v.push(I.clone())}return v}}class G0{constructor(s={}){this.options=s,o.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(s){const c=this.options&&this.options.compact;return this._map=s,this._container=V("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=V("button","mapboxgl-ctrl-attrib-button",this._container),V("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=V("div","mapboxgl-ctrl-attrib-inner",this._container),c&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),c===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(s,c){const m=this._map._getUIString(`AttributionControl.${c}`);s.removeAttribute("title"),s.firstElementChild&&s.firstElementChild.setAttribute("title",m)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let s=this._editLink;s||(s=this._editLink=this._container.querySelector(".mapbox-improve-map"));const c=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.d5.ACCESS_TOKEN}];if(s){const m=c.reduce((x,v,S)=>(v.value&&(x+=`${v.key}=${v.value}${S<c.length-1?"&":""}`),x),"?");s.href=`${o.d5.FEEDBACK_URL}/${m}#${D0(this._map,!0)}`,s.rel="noopener nofollow",this._setElementTitle(s,"MapFeedback")}}_updateData(s){!s||s.sourceDataType!=="metadata"&&s.sourceDataType!=="visibility"&&s.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let s=[];if(this._map.style.stylesheet){const x=this._map.style.stylesheet;this.styleOwner=x.owner,this.styleId=x.id}const c=this._map.style._mergedSourceCaches;for(const x in c){const v=c[x];if(v.used){const S=v.getSource();S.attribution&&s.indexOf(S.attribution)<0&&s.push(S.attribution)}}s.sort((x,v)=>x.length-v.length),s=s.filter((x,v)=>{for(let S=v+1;S<s.length;S++)if(s[S].indexOf(x)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?s=[...this.options.customAttribution,...s]:s.unshift(this.options.customAttribution));const m=s.join(" | ");m!==this._attribHTML&&(this._attribHTML=m,s.length?(this._innerContainer.innerHTML=m,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class X_{constructor(){o.aY(["_updateLogo","_updateCompact"],this)}onAdd(s){this._map=s,this._container=V("div","mapboxgl-ctrl");const c=V("a","mapboxgl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://www.mapbox.com/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(s){s&&s.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const s=this._map.style._sourceCaches;if(Object.entries(s).length===0)return!0;for(const c in s){const m=s[c].getSource();if(m.hasOwnProperty("mapbox_logo")&&!m.mapbox_logo)return!1}return!0}_updateCompact(){const s=this._container.children;if(s.length){const c=s[0];this._map.getCanvasContainer().offsetWidth<250?c.classList.add("mapboxgl-compact"):c.classList.remove("mapboxgl-compact")}}}class Y_{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(s){const c=++this._id;return this._queue.push({callback:s,id:c,cancelled:!1}),c}remove(s){const c=this._currentlyRunning,m=c?this._queue.concat(c):this._queue;for(const x of m)if(x.id===s)return void(x.cancelled=!0)}run(s=0){const c=this._currentlyRunning=this._queue;this._queue=[];for(const m of c)if(!m.cancelled&&(m.callback(s),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function kh(p,s,c){if(p=new o.bn(p.lng,p.lat),s){const m=new o.bn(p.lng-360,p.lat),x=new o.bn(p.lng+360,p.lat),v=360*Math.ceil(Math.abs(p.lng-c.center.lng)/360),S=c.locationPoint(p).distSqr(s),C=s.x<0||s.y<0||s.x>c.width||s.y>c.height;c.locationPoint(m).distSqr(s)<S&&(C||Math.abs(m.lng-c.center.lng)<v)?p=m:c.locationPoint(x).distSqr(s)<S&&(C||Math.abs(x.lng-c.center.lng)<v)&&(p=x)}for(;Math.abs(p.lng-c.center.lng)>180;){const m=c.locationPoint(p);if(m.x>=0&&m.y>=0&&m.x<=c.width&&m.y<=c.height)break;p.lng>c.center.lng?p.lng-=360:p.lng+=360}return p}const Jf={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class H0 extends o.E{constructor(s,c){if(super(),(s instanceof HTMLElement||c)&&(s=o.e({element:s},c)),o.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=s&&s.anchor||"center",this._color=s&&s.color||"#3FB1CE",this._scale=s&&s.scale||1,this._draggable=s&&s.draggable||!1,this._clickTolerance=s&&s.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=s&&s.rotation||0,this._rotationAlignment=s&&s.rotationAlignment||"auto",this._pitchAlignment=s&&s.pitchAlignment&&s.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=s&&s.occludedOpacity||.2,s&&s.element)this._element=s.element,this._offset=o.P.convert(s&&s.offset||[0,0]);else{this._defaultMarker=!0,this._element=V("div");const v=41,S=27,C=G("svg",{display:"block",height:v*this._scale+"px",width:S*this._scale+"px",viewBox:`0 0 ${S} ${v}`},this._element),I=G("radialGradient",{id:"shadowGradient"},G("defs",{},C));G("stop",{offset:"10%","stop-opacity":.4},I),G("stop",{offset:"100%","stop-opacity":.05},I),G("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},C),G("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},C),G("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},C),G("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},C),this._offset=o.P.convert(s&&s.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",v=>{v.preventDefault()}),this._element.addEventListener("mousedown",v=>{v.preventDefault()});const m=this._element.classList;for(const v in Jf)m.remove(`mapboxgl-marker-anchor-${v}`);m.add(`mapboxgl-marker-anchor-${this._anchor}`);const x=s&&s.className?s.className.trim().split(/\s+/):[];m.add(...x),this._popup=null}addTo(s){return s===this._map||(this.remove(),this._map=s,s.getCanvasContainer().appendChild(this._element),s.on("move",this._updateMoving),s.on("moveend",this._update),s.on("remove",this._clearFadeTimer),s._addMarker(this),this.setDraggable(this._draggable),this._update(),s.on("click",this._onMapClick)),this}remove(){const s=this._map;return s&&(s.off("click",this._onMapClick),s.off("move",this._updateMoving),s.off("moveend",this._update),s.off("mousedown",this._addDragHandler),s.off("touchstart",this._addDragHandler),s.off("mouseup",this._onUp),s.off("touchend",this._onUp),s.off("mousemove",this._onMove),s.off("touchmove",this._onMove),s.off("remove",this._clearFadeTimer),s._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(s){return this._lngLat=o.bn.convert(s),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(s){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),s){if(!("offset"in s.options)){const x=Math.sqrt(Math.pow(13.5,2)/2);s.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[x,-1*(38.1-13.5+x)],"bottom-right":[-x,-1*(38.1-13.5+x)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=s,s._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(s){const c=s.code,m=s.charCode||s.keyCode;c!=="Space"&&c!=="Enter"&&m!==32&&m!==13||this.togglePopup()}_onMapClick(s){const c=s.originalEvent.target,m=this._element;this._popup&&(c===m||m.contains(c))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const s=this._popup;return s?(s.isOpen()?(s.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(s.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const s=this._map,c=this._pos;if(!s||!c)return!1;const m=s.unproject(c),x=s.getFreeCameraOptions();if(!x.position)return!1;const v=x.position.toLngLat();return v.distanceTo(m)<.9*v.distanceTo(this._lngLat)}_evaluateOpacity(){const s=this._map;if(!s)return;const c=this._pos;if(!c||c.x<0||c.x>s.transform.width||c.y<0||c.y>s.transform.height)return void this._clearFadeTimer();const m=s.unproject(c);let x;s._showingGlobe()&&o.d6(s.transform,this._lngLat)?x=0:(x=1-s._queryFogOpacity(m),s.transform._terrainEnabled()&&s.getTerrain()&&this._behindTerrain()&&(x*=this._occludedOpacity)),this._element.style.opacity=`${x}`,this._element.style.pointerEvents=x>0?"auto":"none",this._popup&&this._popup._setOpacity(x),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const s=this._pos;if(!s||!this._map)return;const c=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${s.x}px,${s.y}px)
            ${Jf[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${c.x}px,${c.y}px)
        `}_calculateXYTransform(){const s=this._pos,c=this._map,m=this.getPitchAlignment();if(!c||!s||m!=="map")return"";if(!c._showingGlobe()){const I=c.getPitch();return I?`rotateX(${I}deg)`:""}const x=o.bF(o.d7(c.transform,this._lngLat)),v=s.sub(o.d8(c.transform)),S=Math.abs(v.x)+Math.abs(v.y);if(S===0)return"";const C=x/S;return`rotateX(${-v.y*C}deg) rotateY(${v.x*C}deg)`}_calculateZTransform(){const s=this._pos,c=this._map;if(!c||!s)return"";let m=0;const x=this.getRotationAlignment();if(x==="map")if(c._showingGlobe()){const v=c.project(new o.bn(this._lngLat.lng,this._lngLat.lat+.001)),S=c.project(new o.bn(this._lngLat.lng,this._lngLat.lat-.001)).sub(v);m=o.bF(Math.atan2(S.y,S.x))-90}else m=-c.getBearing();else if(x==="horizon"){const v=o.O(4,6,c.getZoom()),S=o.d8(c.transform);S.y+=v*c.transform.height;const C=s.sub(S),I=o.bF(Math.atan2(C.y,C.x));m=(I>90?I-270:I+90)*(1-v)}return m+=this._rotation,m?`rotateZ(${m}deg)`:""}_update(s){cancelAnimationFrame(this._updateFrameId);const c=this._map;c&&(c.transform.renderWorldCopies&&(this._lngLat=kh(this._lngLat,this._pos,c.transform)),this._pos=c.project(this._lngLat),s===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),c._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(c._showingGlobe()||c.getTerrain()||c.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(s){return this._offset=o.P.convert(s),this._update(),this}addClassName(s){return this._element.classList.add(s),this}removeClassName(s){return this._element.classList.remove(s),this}toggleClassName(s){return this._element.classList.toggle(s)}_onMove(s){const c=this._map;if(!c)return;const m=this._pointerdownPos,x=this._positionDelta;if(m&&x){if(!this._isDragging){const v=this._clickTolerance||c._clickTolerance;if(s.point.dist(m)<v)return;this._isDragging=!0}this._pos=s.point.sub(x),this._lngLat=c.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.b("dragstart"))),this.fire(new o.b("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const s=this._map;s&&(s.off("mousemove",this._onMove),s.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new o.b("dragend")),this._state="inactive"}_addDragHandler(s){const c=this._map,m=this._pos;c&&m&&this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(m),this._pointerdownPos=s.point,this._state="pending",c.on("mousemove",this._onMove),c.on("touchmove",this._onMove),c.once("mouseup",this._onUp),c.once("touchend",this._onUp))}setDraggable(s){this._draggable=!!s;const c=this._map;return c&&(s?(c.on("mousedown",this._addDragHandler),c.on("touchstart",this._addDragHandler)):(c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(s){return this._rotation=s||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(s){return this._rotationAlignment=s||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(s){return this._pitchAlignment=s||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(s){return this._occludedOpacity=s||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const K_={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},J_=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Q_(p=new o.P(0,0),s="bottom"){if(typeof p=="number"){const c=Math.round(Math.sqrt(.5*Math.pow(p,2)));switch(s){case"top":return new o.P(0,p);case"top-left":return new o.P(c,c);case"top-right":return new o.P(-c,c);case"bottom":return new o.P(0,-p);case"bottom-left":return new o.P(c,-c);case"bottom-right":return new o.P(-c,-c);case"left":return new o.P(p,0);case"right":return new o.P(-p,0)}return new o.P(0,0)}return p instanceof o.P||Array.isArray(p)?o.P.convert(p):o.P.convert(p[s]||[0,0])}class W0{constructor(s){this.jumpTo(s)}getValue(s){if(s<=this._startTime)return this._start;if(s>=this._endTime)return this._end;const c=o.cc((s-this._startTime)/(this._endTime-this._startTime));return this._start*(1-c)+this._end*c}isEasing(s){return s>=this._startTime&&s<=this._endTime}jumpTo(s){this._startTime=-1/0,this._endTime=-1/0,this._start=s,this._end=s}easeTo(s,c,m){this._start=this.getValue(c),this._end=s,this._startTime=c,this._endTime=c+m}}const Mh={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},ex={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1};class q0{constructor(){this.showOverdrawInspector=!1,this.showTileBoundaries=!1,this.showParseStatus=!1,this.continuousRedraw=!1,this.showTileAABBs=!1,this.showPadding=!1,this.showTerrainWireframe=!1,this.showLayers2DWireframe=!1,this.showLayers3DWireframe=!1}}const Qf={showCompass:!0,showZoom:!0,visualizePitch:!1};class Co{constructor(s,c,m=!1){this._clickTolerance=10,this.element=c,this.mouseRotate=new wh({clickTolerance:s.dragRotate._mouseRotate._clickTolerance}),this.map=s,m&&(this.mousePitch=new Yf({clickTolerance:s.dragRotate._mousePitch._clickTolerance})),o.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),c.addEventListener("mousedown",this.mousedown),c.addEventListener("touchstart",this.touchstart,{passive:!1}),c.addEventListener("touchmove",this.touchmove),c.addEventListener("touchend",this.touchend),c.addEventListener("touchcancel",this.reset)}down(s,c){this.mouseRotate.mousedown(s,c),this.mousePitch&&this.mousePitch.mousedown(s,c),Y()}move(s,c){const m=this.map,x=this.mouseRotate.mousemoveWindow(s,c),v=x&&x.bearingDelta;if(v&&m.setBearing(m.getBearing()+v),this.mousePitch){const S=this.mousePitch.mousemoveWindow(s,c),C=S&&S.pitchDelta;C&&m.setPitch(m.getPitch()+C)}}off(){const s=this.element;s.removeEventListener("mousedown",this.mousedown),s.removeEventListener("touchstart",this.touchstart,{passive:!1}),s.removeEventListener("touchmove",this.touchmove),s.removeEventListener("touchend",this.touchend),s.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Z(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(s){this.down(o.e({},s,{ctrlKey:!0,preventDefault:()=>s.preventDefault()}),Ae(this.element,s)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(s){this.move(s,Ae(this.element,s))}mouseup(s){this.mouseRotate.mouseupWindow(s),this.mousePitch&&this.mousePitch.mouseupWindow(s),this.offTemp()}touchstart(s){s.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=me(this.element,s.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>s.preventDefault()},this._startPos))}touchmove(s){s.targetTouches.length!==1?this.reset():(this._lastPos=me(this.element,s.targetTouches)[0],this.move({preventDefault:()=>s.preventDefault()},this._lastPos))}touchend(s){s.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const ed={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},fa={maxWidth:100,unit:"metric"},gl={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"};return{version:o.dk,supported:R,setRTLTextPlugin:o.dm,getRTLTextPluginStatus:o.dn,Map:class extends ui{constructor(p){const s=p;if((p=o.e({},ex,p)).minZoom!=null&&p.maxZoom!=null&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(p.minPitch!=null&&p.maxPitch!=null&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(p.minPitch!=null&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(p.maxPitch!=null&&p.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(p.antialias&&o.d9(window)&&(p.antialias=!1,o.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new rh(p.minZoom,p.maxZoom,p.minPitch,p.maxPitch,p.renderWorldCopies),p),this._repaint=!1,this._interactive=p.interactive,this._minTileCacheSize=p.minTileCacheSize,this._maxTileCacheSize=p.maxTileCacheSize,this._failIfMajorPerformanceCaveat=p.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=p.preserveDrawingBuffer,this._antialias=p.antialias,this._trackResize=p.trackResize,this._bearingSnap=p.bearingSnap,this._refreshExpiredTiles=p.refreshExpiredTiles,this._fadeDuration=p.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=p.crossSourceCollisions,this._collectResourceTiming=p.collectResourceTiming,this._language=this._parseLanguage(p.language),this._worldview=p.worldview,this._renderTaskQueue=new Y_,this._domRenderTaskQueue=new Y_,this._controls=[],this._markers=[],this._popups=[],this._mapId=o.aC(),this._locale=o.e({},Mh,p.locale),this._clickTolerance=p.clickTolerance,this._cooperativeGestures=p.cooperativeGestures,this._performanceMetricsCollection=p.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new W0(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new o.da(p.transformRequest,p.accessToken,p.testMode),this._silenceAuthErrors=!!p.testMode,this._contextCreateOptions=p.contextCreateOptions?{...p.contextCreateOptions}:{},typeof p.container=="string"){const c=document.getElementById(p.container);if(!c)throw new Error(`Container '${p.container.toString()}' not found.`);this._container=c}else{if(!(p.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(this._container.childNodes.length>0&&o.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),p.maxBounds&&this.setMaxBounds(p.maxBounds),o.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._debugParams=new q0,this._tp=p.devtools?new mh(this):new mh,this._tp.registerParameter(this._debugParams,["Debug"],"showOverdrawInspector",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug"],"showTileBoundaries",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug"],"showParseStatus",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug"],"continuousRedraw",void 0,c=>{this.repaint=c}),this._tp.registerParameter(this._debugParams,["Debug"],"showTileAABBs",void 0,c=>{this.showTileAABBs=c}),this._tp.registerParameter(this._debugParams,["Debug"],"showPadding",void 0,c=>{this.showPadding=c}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showTerrainWireframe",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showLayers2DWireframe",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showLayers3DWireframe",void 0,()=>{this._update()}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new $v(this,p),this._localFontFamily=p.localFontFamily,this._localIdeographFontFamily=p.localIdeographFontFamily,(p.style||!p.testMode)&&this.setStyle(p.style||o.d5.DEFAULT_STYLE,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),p.projection&&this.setProjection(p.projection),p.hash&&(this._hash=new qf(typeof p.hash=="string"&&p.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){s.center==null&&s.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch});const c=p.bounds;c&&(this.resize(),this.fitBounds(c,o.e({},p.fitBoundsOptions,{duration:0})))}this.resize(),p.attributionControl&&this.addControl(new G0({customAttribution:p.customAttribution})),this._logoControl=new X_,this.addControl(this._logoControl,p.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",c=>{this._update(c.dataType==="style"),this.fire(new o.b(`${c.dataType}data`,c))}),this.on("dataloading",c=>{this.fire(new o.b(`${c.dataType}dataloading`,c))})}_getMapId(){return this._mapId}addControl(p,s){if(s===void 0&&(s=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new o.a(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const c=p.onAdd(this);this._controls.push(p);const m=this._controlPositions[s];return s.indexOf("bottom")!==-1?m.insertBefore(c,m.firstChild):m.appendChild(c),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new o.a(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const s=this._controls.indexOf(p);return s>-1&&this._controls.splice(s,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(p){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const s=!this._moving;return s&&this.fire(new o.b("movestart",p)).fire(new o.b("move",p)),this.fire(new o.b("resize",p)),s&&this.fire(new o.b("moveend",p)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(p){return this.transform.setMaxBounds(o.ad.convert(p)),this._update()}setMinZoom(p){if((p=p??-2)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p?this.setZoom(p):this.fire(new o.b("zoomstart")).fire(new o.b("zoom")).fire(new o.b("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=p??22)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p?this.setZoom(p):this.fire(new o.b("zoomstart")).fire(new o.b("zoom")).fire(new o.b("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=p??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p?this.setPitch(p):this.fire(new o.b("pitchstart")).fire(new o.b("pitch")).fire(new o.b("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=p??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p?this.setPitch(p):this.fire(new o.b("pitchstart")).fire(new o.b("pitch")).fire(new o.b("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.renderWorldCopies=p,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(p){return p==="auto"?navigator.language:Array.isArray(p)?p.length===0?void 0:p.map(s=>s==="auto"?navigator.language:s):p}setLanguage(p){const s=this._parseLanguage(p);if(!this.style||s===this._language)return this;this._language=s,this.style.reloadSources();for(const c of this._controls)c._setLanguage&&c._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(p){return this.style&&p!==this._worldview?(this._worldview=p,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(p){return this._lazyInitEmptyStyle(),p?typeof p=="string"&&(p={name:p}):p=null,this._useExplicitProjection=!!p,this._prioritizeAndUpdateProjection(p,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const p=this.transform,s=p.projection.name;let c;s==="globe"&&p.zoom>=o.bx?(p.setMercatorFromTransition(),c=!0):s==="mercator"&&p.zoom<o.bx&&(p.setProjection({name:"globe"}),c=!0),c&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(p,s){return this._updateProjection(p||s||{name:"mercator"})}_updateProjection(p){let s;return s=p.name==="globe"&&this.transform.zoom>=o.bx?this.transform.setMercatorFromTransition():this.transform.setProjection(p),this.style.applyProjectionUpdate(),s&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(p){return this.transform.locationPoint3D(o.bn.convert(p))}unproject(p){return this.transform.pointLocation3D(o.P.convert(p))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(p,s,c){if(p==="mouseenter"||p==="mouseover"){let m=!1;const x=S=>{const C=s.filter(D=>this.getLayer(D)),I=C.length?this.queryRenderedFeatures(S.point,{layers:C}):[];I.length?m||(m=!0,c.call(this,new va(p,this,S.originalEvent,{features:I}))):m=!1},v=()=>{m=!1};return{layers:new Set(s),listener:c,delegates:{mousemove:x,mouseout:v}}}if(p==="mouseleave"||p==="mouseout"){let m=!1;const x=S=>{const C=s.filter(I=>this.getLayer(I));(C.length?this.queryRenderedFeatures(S.point,{layers:C}):[]).length?m=!0:m&&(m=!1,c.call(this,new va(p,this,S.originalEvent)))},v=S=>{m&&(m=!1,c.call(this,new va(p,this,S.originalEvent)))};return{layers:new Set(s),listener:c,delegates:{mousemove:x,mouseout:v}}}{const m=x=>{const v=s.filter(C=>this.getLayer(C)),S=v.length?this.queryRenderedFeatures(x.point,{layers:v}):[];S.length&&(x.features=S,c.call(this,x),delete x.features)};return{layers:new Set(s),listener:c,delegates:{[p]:m}}}}on(p,s,c){if(c===void 0)return super.on(p,s);if(Array.isArray(s)||(s=[s]),s){for(const x of s)if(!this._isValidId(x))return this}const m=this._createDelegatedListener(p,s,c);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(m);for(const x in m.delegates)this.on(x,m.delegates[x]);return this}once(p,s,c){if(c===void 0)return super.once(p,s);if(Array.isArray(s)||(s=[s]),s){for(const x of s)if(!this._isValidId(x))return this}const m=this._createDelegatedListener(p,s,c);for(const x in m.delegates)this.once(x,m.delegates[x]);return this}off(p,s,c){if(c===void 0)return super.off(p,s);s=new Set(Array.isArray(s)?s:[s]);for(const v of s)if(!this._isValidId(v))return this;const m=(v,S)=>{if(v.size!==S.size)return!1;for(const C of v)if(!S.has(C))return!1;return!0},x=this._delegatedListeners?this._delegatedListeners[p]:void 0;return x&&(v=>{for(let S=0;S<v.length;S++){const C=v[S];if(C.listener===c&&m(C.layers,s)){for(const I in C.delegates)this.off(I,C.delegates[I]);return v.splice(S,1),this}}})(x),this}queryRenderedFeatures(p,s){if(!this.style)return[];if(s!==void 0||p===void 0||p instanceof o.P||Array.isArray(p)||(s=p,p=void 0),p=p||[[0,0],[this.transform.width,this.transform.height]],(s=s||{}).layers&&Array.isArray(s.layers)){for(const c of s.layers)if(!this._isValidId(c))return[]}return this.style.queryRenderedFeatures(p,s,this.transform)}querySourceFeatures(p,s){return this._isValidId(p)?this.style.querySourceFeatures(p,s):[]}isPointOnSurface(p){const{name:s}=this.transform.projection;return s!=="globe"&&s!=="mercator"&&o.w(`${s} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(o.P.convert(p))}setStyle(p,s){return(s=o.e({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},s)).diff!==!1&&s.localIdeographFontFamily===this._localIdeographFontFamily&&s.localFontFamily===this._localFontFamily&&this.style&&p?(this._diffStyle(p,s),this):(this._localIdeographFontFamily=s.localIdeographFontFamily,this._localFontFamily=s.localFontFamily,this._updateStyle(p,s))}_getUIString(p){const s=this._locale[p];if(s==null)throw new Error(`Missing UI string '${p}'`);return s}_updateStyle(p,s){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),p&&(this.style=new Cs(this,s||{}),this.style.setEventedParent(this,{style:this.style}),typeof p=="string"?this.style.loadURL(p):this.style.loadJSON(p)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Cs(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(p,s){if(typeof p=="string"){const c=this._requestManager.normalizeStyleURL(p),m=this._requestManager.transformRequest(c,o.R.Style);o.g(m,(x,v)=>{x?this.fire(new o.a(x)):v&&this._updateDiff(v,s)})}else typeof p=="object"&&this._updateDiff(p,s)}_updateDiff(p,s){try{this.style.setState(p)&&this._update(!0)}catch(c){o.w(`Unable to perform style diff: ${c.message||c.error||c}.  Rebuilding the style from scratch.`),this._updateStyle(p,s)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(o.w("There is no style added to the map."),!1)}_isValidId(p){return p==null?(this.fire(new o.a(new Error("IDs can't be empty."))),!1):!o.c4(p)||(this.fire(new o.a(new Error(`IDs can't contain special symbols: "${p}".`))),!1)}addSource(p,s){return this._isValidId(p)?(this._lazyInitEmptyStyle(),this.style.addSource(p,s),this._update(!0)):this}isSourceLoaded(p){return!!this._isValidId(p)&&!!this.style&&this.style._isSourceCacheLoaded(p)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(p,s,c){this._lazyInitEmptyStyle(),this.style.addSourceType(p,s,c)}removeSource(p){return this._isValidId(p)?(this.style.removeSource(p),this._updateTerrain(),this._update(!0)):this}getSource(p){return this._isValidId(p)?this.style.getOwnSource(p):null}addImage(p,s,{pixelRatio:c=1,sdf:m=!1,stretchX:x,stretchY:v,content:S}={}){if(this._lazyInitEmptyStyle(),s instanceof HTMLImageElement||ImageBitmap&&s instanceof ImageBitmap){const{width:C,height:I,data:D}=o.f.getImageData(s);this.style.addImage(p,{data:new o.h({width:C,height:I},D),pixelRatio:c,stretchX:x,stretchY:v,content:S,sdf:m,version:0})}else if(s.width===void 0||s.height===void 0)this.fire(new o.a(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:C,height:I}=s,D=s;this.style.addImage(p,{data:new o.h({width:C,height:I},new Uint8Array(D.data)),pixelRatio:c,stretchX:x,stretchY:v,content:S,sdf:m,version:0,userImage:D}),D.onAdd&&D.onAdd(this,p)}}updateImage(p,s){this._lazyInitEmptyStyle();const c=this.style.getImage(p);if(!c)return void this.fire(new o.a(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const m=s instanceof HTMLImageElement||ImageBitmap&&s instanceof ImageBitmap?o.f.getImageData(s):s,{width:x,height:v}=m,S=m.data;if(x===void 0||v===void 0)return void this.fire(new o.a(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(x!==c.data.width||v!==c.data.height)return void this.fire(new o.a(new Error(`The width and height of the updated image (${x}, ${v})
                must be that same as the previous version of the image
                (${c.data.width}, ${c.data.height})`)));const C=!(s instanceof HTMLImageElement||ImageBitmap&&s instanceof ImageBitmap);c.data.replace(S,C),this.style.updateImage(p,c)}hasImage(p){return p?!!this.style&&!!this.style.getImage(p):(this.fire(new o.a(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(p)}loadImage(p,s){o.d(this._requestManager.transformRequest(p,o.R.Image),(c,m)=>{s(c,m instanceof HTMLImageElement?o.f.getImageData(m):m)})}listImages(){return this.style.listImages()}addModel(p,s){this._lazyInitEmptyStyle(),this.style.addModel(p,s)}hasModel(p){return p?this.style.hasModel(p):(this.fire(new o.a(new Error("Missing required model id"))),!1)}removeModel(p){this.style.removeModel(p)}listModels(){return this.style.listModels()}addLayer(p,s){return this._isValidId(p.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(p,s),this._update(!0)):this}getSlot(p){const s=this.getLayer(p);return s&&s.slot||null}setSlot(p,s){return this.style.setSlot(p,s),this.style.mergeLayers(),this._update(!0)}addImport(p,s){return this.style.addImport(p,s),this}updateImport(p,s){return typeof s!="string"&&s.id!==p?(this.removeImport(p),this.addImport(s)):(this.style.updateImport(p,s),this._update(!0))}removeImport(p){return this.style.removeImport(p),this}moveImport(p,s){return this.style.moveImport(p,s),this._update(!0)}moveLayer(p,s){return this._isValidId(p)?(this.style.moveLayer(p,s),this._update(!0)):this}removeLayer(p){return this._isValidId(p)?(this.style.removeLayer(p),this._update(!0)):this}getLayer(p){return this._isValidId(p)?this.style.getOwnLayer(p):null}setLayerZoomRange(p,s,c){return this._isValidId(p)?(this.style.setLayerZoomRange(p,s,c),this._update(!0)):this}setFilter(p,s,c={}){return this._isValidId(p)?(this.style.setFilter(p,s,c),this._update(!0)):this}getFilter(p){return this._isValidId(p)?this.style.getFilter(p):null}setPaintProperty(p,s,c,m={}){return this._isValidId(p)?(this.style.setPaintProperty(p,s,c,m),this._update(!0)):this}getPaintProperty(p,s){return this._isValidId(p)?this.style.getPaintProperty(p,s):null}setLayoutProperty(p,s,c,m={}){return this._isValidId(p)?(this.style.setLayoutProperty(p,s,c,m),this._update(!0)):this}getLayoutProperty(p,s){return this._isValidId(p)?this.style.getLayoutProperty(p,s):null}getConfigProperty(p,s){return this.style.getConfigProperty(p,s)}setConfigProperty(p,s,c){return this.style.setConfigProperty(p,s,c),this._update(!0)}setLights(p){if(this._lazyInitEmptyStyle(),p&&p.length===1&&p[0].type==="flat"){const s=p[0];s.properties?this.style.setFlatLight(s.properties,s.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(p),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const p=this.style.getLights()||[];return p.length===0&&p.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),p}setLight(p,s={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:p}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(p){return this._lazyInitEmptyStyle(),!p&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(p),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(p){return this._lazyInitEmptyStyle(),this.style.setFog(p),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setCamera(p){return this.style.setCamera(p),this._triggerCameraUpdate(p)}_triggerCameraUpdate(p){return this._update(this.transform.setOrthographicProjectionAtLowPitch(p["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(p){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.bn.convert(p),this.transform):0}setFeatureState(p,s){return this._isValidId(p.source)?(this.style.setFeatureState(p,s),this._update()):this}removeFeatureState(p,s){return this._isValidId(p.source)?(this.style.removeFeatureState(p,s),this._update()):this}getFeatureState(p){return this._isValidId(p.source)?this.style.getFeatureState(p):null}_updateContainerDimensions(){if(!this._container)return;const p=this._container.getBoundingClientRect().width||400,s=this._container.getBoundingClientRect().height||300;let c,m,x,v=this._container;for(;v&&(!m||!x);){const S=window.getComputedStyle(v).transform;S&&S!=="none"&&(c=S.match(/matrix.*\((.+)\)/)[1].split(", "),c[0]&&c[0]!=="0"&&c[0]!=="1"&&(m=c[0]),c[3]&&c[3]!=="0"&&c[3]!=="1"&&(x=c[3])),v=v.parentElement}this._containerWidth=m?Math.abs(p/m):p,this._containerHeight=x?Math.abs(s/x):s}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const p=this._container;p.classList.add("mapboxgl-map"),(this._missingCSSCanary=V("div","mapboxgl-canary",p)).style.visibility="hidden",this._detectMissingCSS();const s=this._canvasContainer=V("div","mapboxgl-canvas-container",p);this._canvas=V("canvas","mapboxgl-canvas",s),this._interactive&&(s.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const c=this._controlContainer=V("div","mapboxgl-control-container",p),m=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(x=>{m[x]=V("div",`mapboxgl-ctrl-${x}`,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(p,s){const c=o.f.devicePixelRatio||1;this._canvas.width=c*Math.ceil(p),this._canvas.height=c*Math.ceil(s),this._canvas.style.width=`${p}px`,this._canvas.style.height=`${s}px`}_addMarker(p){this._markers.push(p)}_removeMarker(p){const s=this._markers.indexOf(p);s!==-1&&this._markers.splice(s,1)}_addPopup(p){this._popups.push(p)}_removePopup(p){const s=this._popups.indexOf(p);s!==-1&&this._popups.splice(s,1)}_setupPainter(){const p=o.e({},R.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),s=this._canvas.getContext("webgl2",p);s?(o.db(s,!0),this.painter=new z_(s,this._contextCreateOptions,this.transform,this._tp),this.on("data",c=>{c.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),o.dc.testSupport(s)):this.fire(new o.a(new Error("Failed to initialize WebGL")))}_contextLost(p){p.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.b("webglcontextlost",{originalEvent:p}))}_contextRestored(p){this._setupPainter(),this.resize(),this._update(),this.fire(new o.b("webglcontextrestored",{originalEvent:p}))}_onMapScroll(p){if(p.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(p){return this.style?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_requestDomTask(p){!this.loaded()||this.loaded()&&!this.isMoving()?p():this._domRenderTaskQueue.add(p)}_render(p){let s;this.fire(new o.b("renderstart"));const c=this.painter.context.extTimerQuery,m=o.f.now(),x=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(s=x.createQuery(),x.beginQuery(c.TIME_ELAPSED_EXT,s)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(p),this._domRenderTaskQueue.run(p),this._removed)return;this._updateProjectionTransition();const v=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const I=this.transform.zoom,D=this.transform.pitch,L=o.f.now(),N=new o.K(I,{now:L,fadeDuration:v,pitch:D,transition:this.style.transition});this.style.update(N)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let S=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),S=this._updateAverageElevation(m),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):S=this._updateAverageElevation(m),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,v,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries||this._debugParams.showTileBoundaries,showParseStatus:this.showParseStatus||this._debugParams.showParseStatus,wireframe:{terrain:this.showTerrainWireframe||this._debugParams.showTerrainWireframe,layers2D:this.showLayers2DWireframe||this._debugParams.showLayers2DWireframe,layers3D:this.showLayers3DWireframe||this._debugParams.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector||this._debugParams.showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs||this._debugParams.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:v,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding||this._debugParams.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.b("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new o.b("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),s){const I=o.f.now()-m;x.endQuery(c.TIME_ELAPSED_EXT),setTimeout(()=>{const D=x.getQueryParameter(s,x.QUERY_RESULT)/1e6;x.deleteQuery(s),this.fire(new o.b("gpu-timing-frame",{cpuTime:I,gpuTime:D}))},50)}if(this.listens("gpu-timing-layer")){const I=this.painter.collectGpuTimers();setTimeout(()=>{const D=this.painter.queryGpuTimers(I);this.fire(new o.b("gpu-timing-layer",{layerTimes:D}))},50)}if(this.listens("gpu-timing-deferred-render")){const I=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const D=this.painter.queryGpuTimeDeferredRender(I);this.fire(new o.b("gpu-timing-deferred-render",{gpuTime:D}))},50)}const C=this._sourcesDirty||this._styleDirty||this._placementDirty||S;if(C||this._repaint)this.triggerRepaint();else{const I=!this.isMoving()&&this.loaded();if(I&&(S=this._updateAverageElevation(m,!0)),S)this.triggerRepaint();else if(this._triggerFrame(!1),I&&(this.fire(new o.b("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const D=this._calculateSpeedIndex();this.fire(new o.b("speedindexcompleted",{speedIndex:D})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||C||(this._fullyLoaded=!0,this._performanceMetricsCollection&&o.dd(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(p){for(const s of this._markers)p&&!this.getRenderWorldCopies()&&(s._lngLat=s._lngLat.wrap()),s._update();for(const s of this._popups)!p||this.getRenderWorldCopies()||s._trackPointer||(s._lngLat=s._lngLat.wrap()),s._update()}_updateAverageElevation(p,s=!1){const c=x=>(this.transform.averageElevation=x,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&c(0);const m=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(m||(s||p-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(p)){const x=this.transform.averageElevation;let v=this.transform.sampleAverageElevation();this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(v)?v=0:this._averageElevationLastSampledAt=p;const S=Math.abs(x-v);if(S>1){if(this._isInitialLoad||m)return this._averageElevation.jumpTo(v),c(v);this._averageElevation.easeTo(v,p,300)}else if(S>1e-4)return this._averageElevation.jumpTo(v),c(v)}return!!this._averageElevation.isEasing(p)&&c(this._averageElevation.getValue(p))}_authenticate(){o.de(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,p=>{if(p&&(p.message===o.df||p.status===401)){const s=this.painter.context.gl;o.db(s,!1),this._logoControl instanceof X_&&this._logoControl._updateLogo(),s&&s.clear(s.DEPTH_BUFFER_BIT|s.COLOR_BUFFER_BIT|s.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.a(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),o.dg(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const p=this._isDragging();this.painter.updateTerrain(this.style,p)}_calculateSpeedIndex(){const p=this.painter.canvasCopy(),s=this.painter.getCanvasCopiesAndTimestamps();s.timeStamps.push(performance.now());const c=this.painter.context.gl,m=c.createFramebuffer();function x(v){c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,v,0);const S=new Uint8Array(c.drawingBufferWidth*c.drawingBufferHeight*4);return c.readPixels(0,0,c.drawingBufferWidth,c.drawingBufferHeight,c.RGBA,c.UNSIGNED_BYTE,S),S}return c.bindFramebuffer(c.FRAMEBUFFER,m),this._canvasPixelComparison(x(p),s.canvasCopies.map(x),s.timeStamps)}_canvasPixelComparison(p,s,c){let m=c[1]-c[0];const x=p.length/4;for(let v=0;v<s.length;v++){const S=s[v];let C=0;for(let I=0;I<S.length;I+=4)S[I]===p[I]&&S[I+1]===p[I+1]&&S[I+2]===p[I+2]&&S[I+3]===p[I+3]&&(C+=1);m+=(c[v+2]-c[v+1])*(1-C/x)}return m}remove(){this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const p=this.painter.context.gl.getExtension("WEBGL_lose_context");p&&p.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),o.dh(this.painter.context.gl),o.di.remove(),o.dj.remove(),this._removed=!0,this.fire(new o.b("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(p){this._renderNextFrame=this._renderNextFrame||p,this.style&&!this._frame&&(this._frame=o.f.frame(s=>{const c=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,c&&this._render(s)}))}_preloadTiles(p){const s=this.style?Object.values(this.style._sourceCaches):[];return o.b1(s,(c,m)=>c._preloadTiles(p,m),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(p){this._trackResize&&this.resize({originalEvent:p})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(p){this._showParseStatus!==p&&(this._showParseStatus=p,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(p){this._showTerrainWireframe!==p&&(this._showTerrainWireframe=p,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(p){this._showLayers2DWireframe!==p&&(this._showLayers2DWireframe=p,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(p){this._showLayers3DWireframe!==p&&(this._showLayers3DWireframe=p,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(p){this._speedIndexTiming!==p&&(this._speedIndexTiming=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(p){this._showTileAABBs!==p&&(this._showTileAABBs=p,p&&this._update())}_setCacheLimits(p,s){o.dl(p,s)}get version(){return o.dk}},NavigationControl:class{constructor(p){this.options=o.e({},Qf,p),this._container=V("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",s=>s.preventDefault()),this.options.showZoom&&(o.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",s=>{this._map&&this._map.zoomIn({},{originalEvent:s})}),V("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",s=>{this._map&&this._map.zoomOut({},{originalEvent:s})}),V("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",s=>{const c=this._map;c&&(this.options.visualizePitch?c.resetNorthPitch({},{originalEvent:s}):c.resetNorth({},{originalEvent:s}))}),this._compassIcon=V("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const p=this._map;if(!p)return;const s=p.getZoom(),c=s===p.getMaxZoom(),m=s===p.getMinZoom();this._zoomInButton.disabled=c,this._zoomOutButton.disabled=m,this._zoomInButton.setAttribute("aria-disabled",c.toString()),this._zoomOutButton.setAttribute("aria-disabled",m.toString())}_rotateCompassArrow(){const p=this._map;if(!p)return;const s=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(p.transform.pitch*(Math.PI/180)),.5)}) rotateX(${p.transform.pitch}deg) rotateZ(${p.transform.angle*(180/Math.PI)}deg)`:`rotate(${p.transform.angle*(180/Math.PI)}deg)`;p._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=s)})}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),p.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&p.on("pitch",this._rotateCompassArrow),p.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Co(p,this._compass,this.options.visualizePitch)),this._container}onRemove(){const p=this._map;p&&(this._container.remove(),this.options.showZoom&&p.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&p.off("pitch",this._rotateCompassArrow),p.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(p,s){const c=V("button",p,this._container);return c.type="button",c.addEventListener("click",s),c}_setButtonTitle(p,s){if(!this._map)return;const c=this._map._getUIString(`NavigationControl.${s}`);p.setAttribute("aria-label",c),p.firstElementChild&&p.firstElementChild.setAttribute("title",c)}},GeolocateControl:class extends o.E{constructor(p){super();const s=navigator.geolocation;this.options=o.e({geolocation:s},ed,p),o.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=_h(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(p){return this._map=p,this._container=V("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(p){const s=(c=!!this.options.geolocation)=>{this._supportsGeolocation=c,p(c)};this._supportsGeolocation!==void 0?p(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(c=>s(c.state!=="denied")).catch(()=>s()):s()}_isOutOfMapMaxBounds(p){const s=this._map.getMaxBounds(),c=p.coords;return!!s&&(c.longitude<s.getWest()||c.longitude>s.getEast()||c.latitude<s.getSouth()||c.latitude>s.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(p){if(this._map){if(this._isOutOfMapMaxBounds(p))return this._setErrorState(),this.fire(new o.b("outofmaxbounds",p)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=p,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(p),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(p),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.b("geolocate",p)),this._finish()}}_updateCamera(p){const s=new o.bn(p.coords.longitude,p.coords.latitude),c=p.coords.accuracy,m=this._map.getBearing(),x=o.e({bearing:m},this.options.fitBoundsOptions);this._map.fitBounds(s.toBounds(c),x,{geolocateSource:!0})}_updateMarker(p){if(p){const s=new o.bn(p.coords.longitude,p.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=p.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const p=this._map.transform,s=o.bl(1,p._center.lat)*p.worldSize,c=Math.ceil(2*this._accuracy*s);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(p){if(this._map){if(this.options.trackUserLocation)if(p.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(p.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.b("error",p)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(p){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",s=>s.preventDefault()),this._geolocateButton=V("button","mapboxgl-ctrl-geolocate",this._container),V("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",p===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=V("div","mapboxgl-user-location"),this._dotElement.appendChild(V("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(V("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new H0({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=V("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new H0({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",s=>{s.geolocateSource||this._watchState!=="ACTIVE_LOCK"||s.originalEvent&&s.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.b("trackuserlocationend")))})}}_onDeviceOrientation(p){this._userLocationDotMarker&&(p.webkitCompassHeading?this._heading=p.webkitCompassHeading:p.absolute===!0&&(this._heading=-1*p.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.b("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.b("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.b("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let p;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(p={maximumAge:6e5,timeout:0},this._noTimeout=!0):(p=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,p),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const p=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(s=>{s==="granted"&&p()}).catch(console.error):p()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:G0,ScaleControl:class{constructor(p){this.options=o.e({},fa,p),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),o.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const p=this.options.maxWidth||100,s=this._map,c=s._containerHeight/2,m=s._containerWidth/2-p/2,x=s.unproject([m,c]),v=s.unproject([m+p,c]),S=x.distanceTo(v);if(this.options.unit==="imperial"){const C=3.2808*S;C>5280?this._setScale(p,C/5280,"mile"):this._setScale(p,C,"foot")}else this.options.unit==="nautical"?this._setScale(p,S/1852,"nautical-mile"):S>=1e3?this._setScale(p,S/1e3,"kilometer"):this._setScale(p,S,"meter")}_setScale(p,s,c){this._map._requestDomTask(()=>{const m=function(v){const S=Math.pow(10,`${Math.floor(v)}`.length-1);let C=v/S;return C=C>=10?10:C>=5?5:C>=3?3:C>=2?2:C>=1?1:function(I){const D=Math.pow(10,Math.ceil(-Math.log(I)/Math.LN10));return Math.round(I*D)/D}(C),S*C}(s),x=m/s;this._container.innerHTML=this._isNumberFormatSupported&&c!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:c}).format(m):`${m}&nbsp;${gl[c]}`,this._container.style.width=p*x+"px"})}onAdd(p){return this._map=p,this._language=p.getLanguage(),this._container=V("div","mapboxgl-ctrl mapboxgl-ctrl-scale",p.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(p){this._language=p,this._update()}setUnit(p){this.options.unit=p,this._update()}},FullscreenControl:class{constructor(p){this._fullscreen=!1,p&&p.container&&(p.container instanceof HTMLElement?this._container=p.container:o.w("Full screen control 'container' must be a DOM element.")),o.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=V("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const p=this._fullscreenButton=V("button","mapboxgl-ctrl-fullscreen",this._controlContainer);V("span","mapboxgl-ctrl-icon",p).setAttribute("aria-hidden","true"),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",p)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends o.E{constructor(p){super(),this.options=o.e(Object.create(K_),p),o.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(p&&p.className?p.className.trim().split(/\s+/):[])}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&p.on("preclick",this._onClose),this.options.closeOnMove&&p.on("move",this._onClose),p.on("remove",this.remove),this._update(),p._addPopup(this),this._focusFirstElement(),this._trackPointer?(p.on("mousemove",this._onMouseEvent),p.on("mouseup",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")):p.on("move",this._update),this.fire(new o.b("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const p=this._map;return p&&(p.off("move",this._update),p.off("move",this._onClose),p.off("preclick",this._onClose),p.off("click",this._onClose),p.off("remove",this.remove),p.off("mousemove",this._onMouseEvent),p.off("mouseup",this._onMouseEvent),p.off("drag",this._onMouseEvent),p._canvasContainer&&p._canvasContainer.classList.remove("mapboxgl-track-pointer"),p._removePopup(this),this._map=void 0),this.fire(new o.b("close")),this}getLngLat(){return this._lngLat}setLngLat(p){this._lngLat=o.bn.convert(p),this._pos=null,this._trackPointer=!1,this._update();const s=this._map;return s&&(s.on("move",this._update),s.off("mousemove",this._onMouseEvent),s._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const p=this._map;return p&&(p.off("move",this._update),p.on("mousemove",this._onMouseEvent),p.on("drag",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(document.createTextNode(p))}setHTML(p){const s=document.createDocumentFragment(),c=document.createElement("body");let m;for(c.innerHTML=p;m=c.firstChild,m;)s.appendChild(m);return this.setDOMContent(s)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){let s=this._content;if(s)for(;s.hasChildNodes();)s.firstChild&&s.removeChild(s.firstChild);else s=this._content=V("div","mapboxgl-popup-content",this._container||void 0);if(s.appendChild(p),this.options.closeButton){const c=this._closeButton=V("button","mapboxgl-popup-close-button",s);c.type="button",c.setAttribute("aria-label","Close popup"),c.setAttribute("aria-hidden","true"),c.innerHTML="&#215;",c.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(p){return this._classList.add(p),this._updateClassList(),this}removeClassName(p){return this._classList.delete(p),this._updateClassList(),this}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){let s;return this._classList.delete(p)?s=!1:(this._classList.add(p),s=!0),this._updateClassList(),s}_onMouseEvent(p){this._update(p.point)}_getAnchor(p){if(this.options.anchor)return this.options.anchor;const s=this._map,c=this._container,m=this._pos;if(!s||!c||!m)return"bottom";const x=c.offsetWidth,v=c.offsetHeight,S=m.x<x/2,C=m.x>s.transform.width-x/2;if(m.y+p<v)return S?"top-left":C?"top-right":"top";if(m.y>s.transform.height-v){if(S)return"bottom-left";if(C)return"bottom-right"}return S?"left":C?"right":"bottom"}_updateClassList(){const p=this._container;if(!p)return;const s=[...this._classList];s.push("mapboxgl-popup"),this._anchor&&s.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&s.push("mapboxgl-popup-track-pointer"),p.className=s.join(" ")}_update(p){const s=this._map,c=this._content;if(!s||!this._lngLat&&!this._trackPointer||!c)return;let m=this._container;if(m||(m=this._container=V("div","mapboxgl-popup",s.getContainer()),this._tip=V("div","mapboxgl-popup-tip",m),m.appendChild(c)),this.options.maxWidth&&m.style.maxWidth!==this.options.maxWidth&&(m.style.maxWidth=this.options.maxWidth),s.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=kh(this._lngLat,this._pos,s.transform)),!this._trackPointer||p){const x=this._pos=this._trackPointer&&p?p:s.project(this._lngLat),v=Q_(this.options.offset),S=this._anchor=this._getAnchor(v.y),C=Q_(this.options.offset,S),I=x.add(C).round();s._requestDomTask(()=>{this._container&&S&&(this._container.style.transform=`${Jf[S]} translate(${I.x}px,${I.y}px)`)})}if(!this._marker&&s._showingGlobe()){const x=o.d6(s.transform,this._lngLat)?0:1;this._setOpacity(x)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const p=this._container.querySelector(J_);p&&p.focus()}_onClose(){this.remove()}_setOpacity(p){this._container&&(this._container.style.opacity=`${p}`),this._content&&(this._content.style.pointerEvents=p?"auto":"none")}},Marker:H0,Style:Cs,LngLat:o.bn,LngLatBounds:o.ad,Point:o.P,MercatorCoordinate:o.L,FreeCameraOptions:eh,Evented:o.E,config:o.d5,prewarm:o.dp,clearPrewarmedResources:o.dq,get accessToken(){return o.d5.ACCESS_TOKEN},set accessToken(p){o.d5.ACCESS_TOKEN=p},get baseApiUrl(){return o.d5.API_URL},set baseApiUrl(p){o.d5.API_URL=p},get workerCount(){return o.dr.workerCount},set workerCount(p){o.dr.workerCount=p},get maxParallelImageRequests(){return o.d5.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(p){o.d5.MAX_PARALLEL_IMAGE_REQUESTS=p},clearStorage(p){o.ds(p)},get workerUrl(){return o.dt.workerUrl},set workerUrl(p){o.dt.workerUrl=p},get workerClass(){return o.dt.workerClass},set workerClass(p){o.dt.workerClass=p},get workerParams(){return o.dt.workerParams},set workerParams(p){o.dt.workerParams=p},get dracoUrl(){return o.du()},set dracoUrl(p){o.dv(p)},get meshoptUrl(){return o.dw()},set meshoptUrl(p){o.dx(p)},setNow:o.f.setNow,restoreNow:o.f.restoreNow}});var T=_;return T})})(qD);var mU=qD.exports;const tg=RE(mU),gU=({map:e})=>(Ie.useEffect(()=>{tg.accessToken="pk.eyJ1IjoicmFqYXNnaDE4IiwiYSI6ImNsbDJsaXBxejAxanMzZHA4N2M3Y25nZnQifQ.tax8bLXV0ELmaMYH1PtevQ",e.current=new tg.Map({container:"map",style:"mapbox://styles/mapbox/satellite-streets-v12",center:[80.63333,19.23333],zoom:12});const n="my-data-"+Math.random().toString(36).substr(2,9);e.current.on("load",function(){e.current.addSource(n,{type:"geojson",data:"./asd/Barsur_Area_Committee.geojson"}),e.current.addLayer({id:n,type:"line",source:n,paint:{"line-color":"#000000","line-width":4}}),e.current.addLayer({id:n+"askjd",type:"fill",source:n,paint:{"fill-color":"#FFFFFF","fill-opacity":.29,"fill-outline-color":"#000000"}})})},[]),Lr.jsx("section",{id:"map",className:"w-full h-[calc(100vh-200px)]"}));/*! xlsx.js (C) 2013-present SheetJS -- http://sheetjs.com */var XD=1252,_U=[874,932,936,949,950,1250,1251,1252,1253,1254,1255,1256,1257,1258,1e4],CS={0:1252,1:65001,2:65001,77:1e4,128:932,129:949,130:1361,134:936,136:950,161:1253,162:1254,163:1258,177:1255,178:1256,186:1257,204:1251,222:874,238:1250,255:1252,69:6969},kS=function(e){_U.indexOf(e)!=-1&&(XD=CS[0]=e)};function xU(){kS(1252)}var Wo=function(e){kS(e)};function YD(){Wo(1200),xU()}function LI(e){for(var n=[],a=0,u=e.length;a<u;++a)n[a]=e.charCodeAt(a);return n}function yU(e){for(var n=[],a=0;a<e.length>>1;++a)n[a]=String.fromCharCode(e.charCodeAt(2*a)+(e.charCodeAt(2*a+1)<<8));return n.join("")}function KD(e){for(var n=[],a=0;a<e.length>>1;++a)n[a]=String.fromCharCode(e.charCodeAt(2*a+1)+(e.charCodeAt(2*a)<<8));return n.join("")}var Vm=function(e){var n=e.charCodeAt(0),a=e.charCodeAt(1);return n==255&&a==254?yU(e.slice(2)):n==254&&a==255?KD(e.slice(2)):n==65279?e.slice(1):e},py=function(n){return String.fromCharCode(n)},OI=function(n){return String.fromCharCode(n)},vu,Eu="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function NI(e){for(var n="",a=0,u=0,f=0,_=0,w=0,T=0,o=0,k=0;k<e.length;)a=e.charCodeAt(k++),_=a>>2,u=e.charCodeAt(k++),w=(a&3)<<4|u>>4,f=e.charCodeAt(k++),T=(u&15)<<2|f>>6,o=f&63,isNaN(u)?T=o=64:isNaN(f)&&(o=64),n+=Eu.charAt(_)+Eu.charAt(w)+Eu.charAt(T)+Eu.charAt(o);return n}function Ws(e){var n="",a=0,u=0,f=0,_=0,w=0,T=0,o=0;e=e.replace(/[^\w\+\/\=]/g,"");for(var k=0;k<e.length;)_=Eu.indexOf(e.charAt(k++)),w=Eu.indexOf(e.charAt(k++)),a=_<<2|w>>4,n+=String.fromCharCode(a),T=Eu.indexOf(e.charAt(k++)),u=(w&15)<<4|T>>2,T!==64&&(n+=String.fromCharCode(u)),o=Eu.indexOf(e.charAt(k++)),f=(T&3)<<6|o,o!==64&&(n+=String.fromCharCode(f));return n}var zn=function(){return typeof Buffer<"u"&&typeof process<"u"&&typeof process.versions<"u"&&!!process.versions.node}(),ff=function(){if(typeof Buffer<"u"){var e=!Buffer.from;if(!e)try{Buffer.from("foo","utf8")}catch{e=!0}return e?function(n,a){return a?new Buffer(n,a):new Buffer(n)}:Buffer.from.bind(Buffer)}return function(){}}();function Nu(e){return zn?Buffer.alloc?Buffer.alloc(e):new Buffer(e):typeof Uint8Array<"u"?new Uint8Array(e):new Array(e)}function zI(e){return zn?Buffer.allocUnsafe?Buffer.allocUnsafe(e):new Buffer(e):typeof Uint8Array<"u"?new Uint8Array(e):new Array(e)}var Ho=function(n){return zn?ff(n,"binary"):n.split("").map(function(a){return a.charCodeAt(0)&255})};function df(e){if(Array.isArray(e))return e.map(function(u){return String.fromCharCode(u)}).join("");for(var n=[],a=0;a<e.length;++a)n[a]=String.fromCharCode(e[a]);return n.join("")}function MS(e){if(typeof ArrayBuffer>"u")throw new Error("Unsupported");if(e instanceof ArrayBuffer)return MS(new Uint8Array(e));for(var n=new Array(e.length),a=0;a<e.length;++a)n[a]=e[a];return n}var wu=zn?function(e){return Buffer.concat(e.map(function(n){return Buffer.isBuffer(n)?n:ff(n)}))}:function(e){if(typeof Uint8Array<"u"){var n=0,a=0;for(n=0;n<e.length;++n)a+=e[n].length;var u=new Uint8Array(a),f=0;for(n=0,a=0;n<e.length;a+=f,++n)if(f=e[n].length,e[n]instanceof Uint8Array)u.set(e[n],a);else{if(typeof e[n]=="string")throw"wtf";u.set(new Uint8Array(e[n]),a)}return u}return[].concat.apply([],e.map(function(_){return Array.isArray(_)?_:[].slice.call(_)}))};function vU(e){for(var n=[],a=0,u=e.length+250,f=Nu(e.length+255),_=0;_<e.length;++_){var w=e.charCodeAt(_);if(w<128)f[a++]=w;else if(w<2048)f[a++]=192|w>>6&31,f[a++]=128|w&63;else if(w>=55296&&w<57344){w=(w&1023)+64;var T=e.charCodeAt(++_)&1023;f[a++]=240|w>>8&7,f[a++]=128|w>>2&63,f[a++]=128|T>>6&15|(w&3)<<4,f[a++]=128|T&63}else f[a++]=224|w>>12&15,f[a++]=128|w>>6&63,f[a++]=128|w&63;a>u&&(n.push(f.slice(0,a)),a=0,f=Nu(65535),u=65530)}return n.push(f.slice(0,a)),wu(n)}var is=/\u0000/g,$m=/[\u0001-\u0006]/g;function Xd(e){for(var n="",a=e.length-1;a>=0;)n+=e.charAt(a--);return n}function qo(e,n){var a=""+e;return a.length>=n?a:Ui("0",n-a.length)+a}function IS(e,n){var a=""+e;return a.length>=n?a:Ui(" ",n-a.length)+a}function S1(e,n){var a=""+e;return a.length>=n?a:a+Ui(" ",n-a.length)}function wU(e,n){var a=""+Math.round(e);return a.length>=n?a:Ui("0",n-a.length)+a}function bU(e,n){var a=""+e;return a.length>=n?a:Ui("0",n-a.length)+a}var BI=Math.pow(2,32);function Ed(e,n){if(e>BI||e<-BI)return wU(e,n);var a=Math.round(e);return bU(a,n)}function A1(e,n){return n=n||0,e.length>=7+n&&(e.charCodeAt(n)|32)===103&&(e.charCodeAt(n+1)|32)===101&&(e.charCodeAt(n+2)|32)===110&&(e.charCodeAt(n+3)|32)===101&&(e.charCodeAt(n+4)|32)===114&&(e.charCodeAt(n+5)|32)===97&&(e.charCodeAt(n+6)|32)===108}var UI=[["Sun","Sunday"],["Mon","Monday"],["Tue","Tuesday"],["Wed","Wednesday"],["Thu","Thursday"],["Fri","Friday"],["Sat","Saturday"]],Lb=[["J","Jan","January"],["F","Feb","February"],["M","Mar","March"],["A","Apr","April"],["M","May","May"],["J","Jun","June"],["J","Jul","July"],["A","Aug","August"],["S","Sep","September"],["O","Oct","October"],["N","Nov","November"],["D","Dec","December"]];function TU(e){return e||(e={}),e[0]="General",e[1]="0",e[2]="0.00",e[3]="#,##0",e[4]="#,##0.00",e[9]="0%",e[10]="0.00%",e[11]="0.00E+00",e[12]="# ?/?",e[13]="# ??/??",e[14]="m/d/yy",e[15]="d-mmm-yy",e[16]="d-mmm",e[17]="mmm-yy",e[18]="h:mm AM/PM",e[19]="h:mm:ss AM/PM",e[20]="h:mm",e[21]="h:mm:ss",e[22]="m/d/yy h:mm",e[37]="#,##0 ;(#,##0)",e[38]="#,##0 ;[Red](#,##0)",e[39]="#,##0.00;(#,##0.00)",e[40]="#,##0.00;[Red](#,##0.00)",e[45]="mm:ss",e[46]="[h]:mm:ss",e[47]="mmss.0",e[48]="##0.0E+0",e[49]="@",e[56]='"上午/下午 "hh"時"mm"分"ss"秒 "',e}var Tn={0:"General",1:"0",2:"0.00",3:"#,##0",4:"#,##0.00",9:"0%",10:"0.00%",11:"0.00E+00",12:"# ?/?",13:"# ??/??",14:"m/d/yy",15:"d-mmm-yy",16:"d-mmm",17:"mmm-yy",18:"h:mm AM/PM",19:"h:mm:ss AM/PM",20:"h:mm",21:"h:mm:ss",22:"m/d/yy h:mm",37:"#,##0 ;(#,##0)",38:"#,##0 ;[Red](#,##0)",39:"#,##0.00;(#,##0.00)",40:"#,##0.00;[Red](#,##0.00)",45:"mm:ss",46:"[h]:mm:ss",47:"mmss.0",48:"##0.0E+0",49:"@",56:'"上午/下午 "hh"時"mm"分"ss"秒 "'},VI={5:37,6:38,7:39,8:40,23:0,24:0,25:0,26:0,27:14,28:14,29:14,30:14,31:14,50:14,51:14,52:14,53:14,54:14,55:14,56:14,57:14,58:14,59:1,60:2,61:3,62:4,67:9,68:10,69:12,70:13,71:14,72:14,73:15,74:16,75:17,76:20,77:21,78:22,79:45,80:46,81:47,82:0},EU={5:'"$"#,##0_);\\("$"#,##0\\)',63:'"$"#,##0_);\\("$"#,##0\\)',6:'"$"#,##0_);[Red]\\("$"#,##0\\)',64:'"$"#,##0_);[Red]\\("$"#,##0\\)',7:'"$"#,##0.00_);\\("$"#,##0.00\\)',65:'"$"#,##0.00_);\\("$"#,##0.00\\)',8:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',66:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',41:'_(* #,##0_);_(* \\(#,##0\\);_(* "-"_);_(@_)',42:'_("$"* #,##0_);_("$"* \\(#,##0\\);_("$"* "-"_);_(@_)',43:'_(* #,##0.00_);_(* \\(#,##0.00\\);_(* "-"??_);_(@_)',44:'_("$"* #,##0.00_);_("$"* \\(#,##0.00\\);_("$"* "-"??_);_(@_)'};function C1(e,n,a){for(var u=e<0?-1:1,f=e*u,_=0,w=1,T=0,o=1,k=0,R=0,F=Math.floor(f);k<n&&(F=Math.floor(f),T=F*w+_,R=F*k+o,!(f-F<5e-8));)f=1/(f-F),_=w,w=T,o=k,k=R;if(R>n&&(k>n?(R=o,T=_):(R=k,T=w)),!a)return[0,u*T,R];var B=Math.floor(u*T/R);return[B,u*T-B*R,R]}function Zh(e,n,a){if(e>2958465||e<0)return null;var u=e|0,f=Math.floor(86400*(e-u)),_=0,w=[],T={D:u,T:f,u:86400*(e-u)-f,y:0,m:0,d:0,H:0,M:0,S:0,q:0};if(Math.abs(T.u)<1e-6&&(T.u=0),n&&n.date1904&&(u+=1462),T.u>.9999&&(T.u=0,++f==86400&&(T.T=f=0,++u,++T.D)),u===60)w=a?[1317,10,29]:[1900,2,29],_=3;else if(u===0)w=a?[1317,8,29]:[1900,1,0],_=6;else{u>60&&--u;var o=new Date(1900,0,1);o.setDate(o.getDate()+u-1),w=[o.getFullYear(),o.getMonth()+1,o.getDate()],_=o.getDay(),u<60&&(_=(_+6)%7),a&&(_=IU(o,w))}return T.y=w[0],T.m=w[1],T.d=w[2],T.S=f%60,f=Math.floor(f/60),T.M=f%60,f=Math.floor(f/60),T.H=f,T.q=_,T}var JD=new Date(1899,11,31,0,0,0),SU=JD.getTime(),AU=new Date(1900,2,1,0,0,0);function QD(e,n){var a=e.getTime();return n?a-=1461*24*60*60*1e3:e>=AU&&(a+=24*60*60*1e3),(a-(SU+(e.getTimezoneOffset()-JD.getTimezoneOffset())*6e4))/(24*60*60*1e3)}function PS(e){return e.indexOf(".")==-1?e:e.replace(/(?:\.0*|(\.\d*[1-9])0+)$/,"$1")}function CU(e){return e.indexOf("E")==-1?e:e.replace(/(?:\.0*|(\.\d*[1-9])0+)[Ee]/,"$1E").replace(/(E[+-])(\d)$/,"$10$2")}function kU(e){var n=e<0?12:11,a=PS(e.toFixed(12));return a.length<=n||(a=e.toPrecision(10),a.length<=n)?a:e.toExponential(5)}function MU(e){var n=PS(e.toFixed(11));return n.length>(e<0?12:11)||n==="0"||n==="-0"?e.toPrecision(6):n}function kg(e){var n=Math.floor(Math.log(Math.abs(e))*Math.LOG10E),a;return n>=-4&&n<=-1?a=e.toPrecision(10+n):Math.abs(n)<=9?a=kU(e):n===10?a=e.toFixed(10).substr(0,12):a=MU(e),PS(CU(a.toUpperCase()))}function sf(e,n){switch(typeof e){case"string":return e;case"boolean":return e?"TRUE":"FALSE";case"number":return(e|0)===e?e.toString(10):kg(e);case"undefined":return"";case"object":if(e==null)return"";if(e instanceof Date)return fo(14,QD(e,n&&n.date1904),n)}throw new Error("unsupported value in General format: "+e)}function IU(e,n){n[0]-=581;var a=e.getDay();return e<60&&(a=(a+6)%7),a}function PU(e,n,a,u){var f="",_=0,w=0,T=a.y,o,k=0;switch(e){case 98:T=a.y+543;case 121:switch(n.length){case 1:case 2:o=T%100,k=2;break;default:o=T%1e4,k=4;break}break;case 109:switch(n.length){case 1:case 2:o=a.m,k=n.length;break;case 3:return Lb[a.m-1][1];case 5:return Lb[a.m-1][0];default:return Lb[a.m-1][2]}break;case 100:switch(n.length){case 1:case 2:o=a.d,k=n.length;break;case 3:return UI[a.q][0];default:return UI[a.q][1]}break;case 104:switch(n.length){case 1:case 2:o=1+(a.H+11)%12,k=n.length;break;default:throw"bad hour format: "+n}break;case 72:switch(n.length){case 1:case 2:o=a.H,k=n.length;break;default:throw"bad hour format: "+n}break;case 77:switch(n.length){case 1:case 2:o=a.M,k=n.length;break;default:throw"bad minute format: "+n}break;case 115:if(n!="s"&&n!="ss"&&n!=".0"&&n!=".00"&&n!=".000")throw"bad second format: "+n;return a.u===0&&(n=="s"||n=="ss")?qo(a.S,n.length):(u>=2?w=u===3?1e3:100:w=u===1?10:1,_=Math.round(w*(a.S+a.u)),_>=60*w&&(_=0),n==="s"?_===0?"0":""+_/w:(f=qo(_,2+u),n==="ss"?f.substr(0,2):"."+f.substr(2,n.length-1)));case 90:switch(n){case"[h]":case"[hh]":o=a.D*24+a.H;break;case"[m]":case"[mm]":o=(a.D*24+a.H)*60+a.M;break;case"[s]":case"[ss]":o=((a.D*24+a.H)*60+a.M)*60+Math.round(a.S+a.u);break;default:throw"bad abstime format: "+n}k=n.length===3?1:2;break;case 101:o=T,k=1;break}var R=k>0?qo(o,k):"";return R}function Su(e){var n=3;if(e.length<=n)return e;for(var a=e.length%n,u=e.substr(0,a);a!=e.length;a+=n)u+=(u.length>0?",":"")+e.substr(a,n);return u}var eF=/%/g;function RU(e,n,a){var u=n.replace(eF,""),f=n.length-u.length;return dc(e,u,a*Math.pow(10,2*f))+Ui("%",f)}function DU(e,n,a){for(var u=n.length-1;n.charCodeAt(u-1)===44;)--u;return dc(e,n.substr(0,u),a/Math.pow(10,3*(n.length-u)))}function tF(e,n){var a,u=e.indexOf("E")-e.indexOf(".")-1;if(e.match(/^#+0.0E\+0$/)){if(n==0)return"0.0E+0";if(n<0)return"-"+tF(e,-n);var f=e.indexOf(".");f===-1&&(f=e.indexOf("E"));var _=Math.floor(Math.log(n)*Math.LOG10E)%f;if(_<0&&(_+=f),a=(n/Math.pow(10,_)).toPrecision(u+1+(f+_)%f),a.indexOf("e")===-1){var w=Math.floor(Math.log(n)*Math.LOG10E);for(a.indexOf(".")===-1?a=a.charAt(0)+"."+a.substr(1)+"E+"+(w-a.length+_):a+="E+"+(w-_);a.substr(0,2)==="0.";)a=a.charAt(0)+a.substr(2,f)+"."+a.substr(2+f),a=a.replace(/^0+([1-9])/,"$1").replace(/^0+\./,"0.");a=a.replace(/\+-/,"-")}a=a.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function(T,o,k,R){return o+k+R.substr(0,(f+_)%f)+"."+R.substr(_)+"E"})}else a=n.toExponential(u);return e.match(/E\+00$/)&&a.match(/e[+-]\d$/)&&(a=a.substr(0,a.length-1)+"0"+a.charAt(a.length-1)),e.match(/E\-/)&&a.match(/e\+/)&&(a=a.replace(/e\+/,"e")),a.replace("e","E")}var rF=/# (\?+)( ?)\/( ?)(\d+)/;function FU(e,n,a){var u=parseInt(e[4],10),f=Math.round(n*u),_=Math.floor(f/u),w=f-_*u,T=u;return a+(_===0?"":""+_)+" "+(w===0?Ui(" ",e[1].length+1+e[4].length):IS(w,e[1].length)+e[2]+"/"+e[3]+qo(T,e[4].length))}function LU(e,n,a){return a+(n===0?"":""+n)+Ui(" ",e[1].length+2+e[4].length)}var nF=/^#*0*\.([0#]+)/,iF=/\).*[0#]/,aF=/\(###\) ###\\?-####/;function es(e){for(var n="",a,u=0;u!=e.length;++u)switch(a=e.charCodeAt(u)){case 35:break;case 63:n+=" ";break;case 48:n+="0";break;default:n+=String.fromCharCode(a)}return n}function $I(e,n){var a=Math.pow(10,n);return""+Math.round(e*a)/a}function jI(e,n){var a=e-Math.floor(e),u=Math.pow(10,n);return n<(""+Math.round(a*u)).length?0:Math.round(a*u)}function OU(e,n){return n<(""+Math.round((e-Math.floor(e))*Math.pow(10,n))).length?1:0}function NU(e){return e<2147483647&&e>-2147483648?""+(e>=0?e|0:e-1|0):""+Math.floor(e)}function no(e,n,a){if(e.charCodeAt(0)===40&&!n.match(iF)){var u=n.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return a>=0?no("n",u,a):"("+no("n",u,-a)+")"}if(n.charCodeAt(n.length-1)===44)return DU(e,n,a);if(n.indexOf("%")!==-1)return RU(e,n,a);if(n.indexOf("E")!==-1)return tF(n,a);if(n.charCodeAt(0)===36)return"$"+no(e,n.substr(n.charAt(1)==" "?2:1),a);var f,_,w,T,o=Math.abs(a),k=a<0?"-":"";if(n.match(/^00+$/))return k+Ed(o,n.length);if(n.match(/^[#?]+$/))return f=Ed(a,0),f==="0"&&(f=""),f.length>n.length?f:es(n.substr(0,n.length-f.length))+f;if(_=n.match(rF))return FU(_,o,k);if(n.match(/^#+0+$/))return k+Ed(o,n.length-n.indexOf("0"));if(_=n.match(nF))return f=$I(a,_[1].length).replace(/^([^\.]+)$/,"$1."+es(_[1])).replace(/\.$/,"."+es(_[1])).replace(/\.(\d*)$/,function(G,U){return"."+U+Ui("0",es(_[1]).length-U.length)}),n.indexOf("0.")!==-1?f:f.replace(/^0\./,".");if(n=n.replace(/^#+([0.])/,"$1"),_=n.match(/^(0*)\.(#*)$/))return k+$I(o,_[2].length).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,_[1].length?"0.":".");if(_=n.match(/^#{1,3},##0(\.?)$/))return k+Su(Ed(o,0));if(_=n.match(/^#,##0\.([#0]*0)$/))return a<0?"-"+no(e,n,-a):Su(""+(Math.floor(a)+OU(a,_[1].length)))+"."+qo(jI(a,_[1].length),_[1].length);if(_=n.match(/^#,#*,#0/))return no(e,n.replace(/^#,#*,/,""),a);if(_=n.match(/^([0#]+)(\\?-([0#]+))+$/))return f=Xd(no(e,n.replace(/[\\-]/g,""),a)),w=0,Xd(Xd(n.replace(/\\/g,"")).replace(/[0#]/g,function(G){return w<f.length?f.charAt(w++):G==="0"?"0":""}));if(n.match(aF))return f=no(e,"##########",a),"("+f.substr(0,3)+") "+f.substr(3,3)+"-"+f.substr(6);var R="";if(_=n.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return w=Math.min(_[4].length,7),T=C1(o,Math.pow(10,w)-1,!1),f=""+k,R=dc("n",_[1],T[1]),R.charAt(R.length-1)==" "&&(R=R.substr(0,R.length-1)+"0"),f+=R+_[2]+"/"+_[3],R=S1(T[2],w),R.length<_[4].length&&(R=es(_[4].substr(_[4].length-R.length))+R),f+=R,f;if(_=n.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return w=Math.min(Math.max(_[1].length,_[4].length),7),T=C1(o,Math.pow(10,w)-1,!0),k+(T[0]||(T[1]?"":"0"))+" "+(T[1]?IS(T[1],w)+_[2]+"/"+_[3]+S1(T[2],w):Ui(" ",2*w+1+_[2].length+_[3].length));if(_=n.match(/^[#0?]+$/))return f=Ed(a,0),n.length<=f.length?f:es(n.substr(0,n.length-f.length))+f;if(_=n.match(/^([#0?]+)\.([#0]+)$/)){f=""+a.toFixed(Math.min(_[2].length,10)).replace(/([^0])0+$/,"$1"),w=f.indexOf(".");var F=n.indexOf(".")-w,B=n.length-f.length-F;return es(n.substr(0,F)+f+n.substr(n.length-B))}if(_=n.match(/^00,000\.([#0]*0)$/))return w=jI(a,_[1].length),a<0?"-"+no(e,n,-a):Su(NU(a)).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function(G){return"00,"+(G.length<3?qo(0,3-G.length):"")+G})+"."+qo(w,_[1].length);switch(n){case"###,##0.00":return no(e,"#,##0.00",a);case"###,###":case"##,###":case"#,###":var V=Su(Ed(o,0));return V!=="0"?k+V:"";case"###,###.00":return no(e,"###,##0.00",a).replace(/^0\./,".");case"#,###.00":return no(e,"#,##0.00",a).replace(/^0\./,".")}throw new Error("unsupported format |"+n+"|")}function zU(e,n,a){for(var u=n.length-1;n.charCodeAt(u-1)===44;)--u;return dc(e,n.substr(0,u),a/Math.pow(10,3*(n.length-u)))}function BU(e,n,a){var u=n.replace(eF,""),f=n.length-u.length;return dc(e,u,a*Math.pow(10,2*f))+Ui("%",f)}function sF(e,n){var a,u=e.indexOf("E")-e.indexOf(".")-1;if(e.match(/^#+0.0E\+0$/)){if(n==0)return"0.0E+0";if(n<0)return"-"+sF(e,-n);var f=e.indexOf(".");f===-1&&(f=e.indexOf("E"));var _=Math.floor(Math.log(n)*Math.LOG10E)%f;if(_<0&&(_+=f),a=(n/Math.pow(10,_)).toPrecision(u+1+(f+_)%f),!a.match(/[Ee]/)){var w=Math.floor(Math.log(n)*Math.LOG10E);a.indexOf(".")===-1?a=a.charAt(0)+"."+a.substr(1)+"E+"+(w-a.length+_):a+="E+"+(w-_),a=a.replace(/\+-/,"-")}a=a.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function(T,o,k,R){return o+k+R.substr(0,(f+_)%f)+"."+R.substr(_)+"E"})}else a=n.toExponential(u);return e.match(/E\+00$/)&&a.match(/e[+-]\d$/)&&(a=a.substr(0,a.length-1)+"0"+a.charAt(a.length-1)),e.match(/E\-/)&&a.match(/e\+/)&&(a=a.replace(/e\+/,"e")),a.replace("e","E")}function El(e,n,a){if(e.charCodeAt(0)===40&&!n.match(iF)){var u=n.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return a>=0?El("n",u,a):"("+El("n",u,-a)+")"}if(n.charCodeAt(n.length-1)===44)return zU(e,n,a);if(n.indexOf("%")!==-1)return BU(e,n,a);if(n.indexOf("E")!==-1)return sF(n,a);if(n.charCodeAt(0)===36)return"$"+El(e,n.substr(n.charAt(1)==" "?2:1),a);var f,_,w,T,o=Math.abs(a),k=a<0?"-":"";if(n.match(/^00+$/))return k+qo(o,n.length);if(n.match(/^[#?]+$/))return f=""+a,a===0&&(f=""),f.length>n.length?f:es(n.substr(0,n.length-f.length))+f;if(_=n.match(rF))return LU(_,o,k);if(n.match(/^#+0+$/))return k+qo(o,n.length-n.indexOf("0"));if(_=n.match(nF))return f=(""+a).replace(/^([^\.]+)$/,"$1."+es(_[1])).replace(/\.$/,"."+es(_[1])),f=f.replace(/\.(\d*)$/,function(G,U){return"."+U+Ui("0",es(_[1]).length-U.length)}),n.indexOf("0.")!==-1?f:f.replace(/^0\./,".");if(n=n.replace(/^#+([0.])/,"$1"),_=n.match(/^(0*)\.(#*)$/))return k+(""+o).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,_[1].length?"0.":".");if(_=n.match(/^#{1,3},##0(\.?)$/))return k+Su(""+o);if(_=n.match(/^#,##0\.([#0]*0)$/))return a<0?"-"+El(e,n,-a):Su(""+a)+"."+Ui("0",_[1].length);if(_=n.match(/^#,#*,#0/))return El(e,n.replace(/^#,#*,/,""),a);if(_=n.match(/^([0#]+)(\\?-([0#]+))+$/))return f=Xd(El(e,n.replace(/[\\-]/g,""),a)),w=0,Xd(Xd(n.replace(/\\/g,"")).replace(/[0#]/g,function(G){return w<f.length?f.charAt(w++):G==="0"?"0":""}));if(n.match(aF))return f=El(e,"##########",a),"("+f.substr(0,3)+") "+f.substr(3,3)+"-"+f.substr(6);var R="";if(_=n.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return w=Math.min(_[4].length,7),T=C1(o,Math.pow(10,w)-1,!1),f=""+k,R=dc("n",_[1],T[1]),R.charAt(R.length-1)==" "&&(R=R.substr(0,R.length-1)+"0"),f+=R+_[2]+"/"+_[3],R=S1(T[2],w),R.length<_[4].length&&(R=es(_[4].substr(_[4].length-R.length))+R),f+=R,f;if(_=n.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return w=Math.min(Math.max(_[1].length,_[4].length),7),T=C1(o,Math.pow(10,w)-1,!0),k+(T[0]||(T[1]?"":"0"))+" "+(T[1]?IS(T[1],w)+_[2]+"/"+_[3]+S1(T[2],w):Ui(" ",2*w+1+_[2].length+_[3].length));if(_=n.match(/^[#0?]+$/))return f=""+a,n.length<=f.length?f:es(n.substr(0,n.length-f.length))+f;if(_=n.match(/^([#0]+)\.([#0]+)$/)){f=""+a.toFixed(Math.min(_[2].length,10)).replace(/([^0])0+$/,"$1"),w=f.indexOf(".");var F=n.indexOf(".")-w,B=n.length-f.length-F;return es(n.substr(0,F)+f+n.substr(n.length-B))}if(_=n.match(/^00,000\.([#0]*0)$/))return a<0?"-"+El(e,n,-a):Su(""+a).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function(G){return"00,"+(G.length<3?qo(0,3-G.length):"")+G})+"."+qo(0,_[1].length);switch(n){case"###,###":case"##,###":case"#,###":var V=Su(""+o);return V!=="0"?k+V:"";default:if(n.match(/\.[0#?]*$/))return El(e,n.slice(0,n.lastIndexOf(".")),a)+es(n.slice(n.lastIndexOf(".")))}throw new Error("unsupported format |"+n+"|")}function dc(e,n,a){return(a|0)===a?El(e,n,a):no(e,n,a)}function UU(e){for(var n=[],a=!1,u=0,f=0;u<e.length;++u)switch(e.charCodeAt(u)){case 34:a=!a;break;case 95:case 42:case 92:++u;break;case 59:n[n.length]=e.substr(f,u-f),f=u+1}if(n[n.length]=e.substr(f),a===!0)throw new Error("Format |"+e+"| unterminated string ");return n}var oF=/\[[HhMmSs\u0E0A\u0E19\u0E17]*\]/;function gp(e){for(var n=0,a="",u="";n<e.length;)switch(a=e.charAt(n)){case"G":A1(e,n)&&(n+=6),n++;break;case'"':for(;e.charCodeAt(++n)!==34&&n<e.length;);++n;break;case"\\":n+=2;break;case"_":n+=2;break;case"@":++n;break;case"B":case"b":if(e.charAt(n+1)==="1"||e.charAt(n+1)==="2")return!0;case"M":case"D":case"Y":case"H":case"S":case"E":case"m":case"d":case"y":case"h":case"s":case"e":case"g":return!0;case"A":case"a":case"上":if(e.substr(n,3).toUpperCase()==="A/P"||e.substr(n,5).toUpperCase()==="AM/PM"||e.substr(n,5).toUpperCase()==="上午/下午")return!0;++n;break;case"[":for(u=a;e.charAt(n++)!=="]"&&n<e.length;)u+=e.charAt(n);if(u.match(oF))return!0;break;case".":case"0":case"#":for(;n<e.length&&("0#?.,E+-%".indexOf(a=e.charAt(++n))>-1||a=="\\"&&e.charAt(n+1)=="-"&&"0#".indexOf(e.charAt(n+2))>-1););break;case"?":for(;e.charAt(++n)===a;);break;case"*":++n,(e.charAt(n)==" "||e.charAt(n)=="*")&&++n;break;case"(":case")":++n;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(;n<e.length&&"0123456789".indexOf(e.charAt(++n))>-1;);break;case" ":++n;break;default:++n;break}return!1}function VU(e,n,a,u){for(var f=[],_="",w=0,T="",o="t",k,R,F,B="H";w<e.length;)switch(T=e.charAt(w)){case"G":if(!A1(e,w))throw new Error("unrecognized character "+T+" in "+e);f[f.length]={t:"G",v:"General"},w+=7;break;case'"':for(_="";(F=e.charCodeAt(++w))!==34&&w<e.length;)_+=String.fromCharCode(F);f[f.length]={t:"t",v:_},++w;break;case"\\":var V=e.charAt(++w),G=V==="("||V===")"?V:"t";f[f.length]={t:G,v:V},++w;break;case"_":f[f.length]={t:"t",v:" "},w+=2;break;case"@":f[f.length]={t:"T",v:n},++w;break;case"B":case"b":if(e.charAt(w+1)==="1"||e.charAt(w+1)==="2"){if(k==null&&(k=Zh(n,a,e.charAt(w+1)==="2"),k==null))return"";f[f.length]={t:"X",v:e.substr(w,2)},o=T,w+=2;break}case"M":case"D":case"Y":case"H":case"S":case"E":T=T.toLowerCase();case"m":case"d":case"y":case"h":case"s":case"e":case"g":if(n<0||k==null&&(k=Zh(n,a),k==null))return"";for(_=T;++w<e.length&&e.charAt(w).toLowerCase()===T;)_+=T;T==="m"&&o.toLowerCase()==="h"&&(T="M"),T==="h"&&(T=B),f[f.length]={t:T,v:_},o=T;break;case"A":case"a":case"上":var U={t:T,v:T};if(k==null&&(k=Zh(n,a)),e.substr(w,3).toUpperCase()==="A/P"?(k!=null&&(U.v=k.H>=12?"P":"A"),U.t="T",B="h",w+=3):e.substr(w,5).toUpperCase()==="AM/PM"?(k!=null&&(U.v=k.H>=12?"PM":"AM"),U.t="T",w+=5,B="h"):e.substr(w,5).toUpperCase()==="上午/下午"?(k!=null&&(U.v=k.H>=12?"下午":"上午"),U.t="T",w+=5,B="h"):(U.t="t",++w),k==null&&U.t==="T")return"";f[f.length]=U,o=T;break;case"[":for(_=T;e.charAt(w++)!=="]"&&w<e.length;)_+=e.charAt(w);if(_.slice(-1)!=="]")throw'unterminated "[" block: |'+_+"|";if(_.match(oF)){if(k==null&&(k=Zh(n,a),k==null))return"";f[f.length]={t:"Z",v:_.toLowerCase()},o=_.charAt(1)}else _.indexOf("$")>-1&&(_=(_.match(/\$([^-\[\]]*)/)||[])[1]||"$",gp(e)||(f[f.length]={t:"t",v:_}));break;case".":if(k!=null){for(_=T;++w<e.length&&(T=e.charAt(w))==="0";)_+=T;f[f.length]={t:"s",v:_};break}case"0":case"#":for(_=T;++w<e.length&&"0#?.,E+-%".indexOf(T=e.charAt(w))>-1;)_+=T;f[f.length]={t:"n",v:_};break;case"?":for(_=T;e.charAt(++w)===T;)_+=T;f[f.length]={t:T,v:_},o=T;break;case"*":++w,(e.charAt(w)==" "||e.charAt(w)=="*")&&++w;break;case"(":case")":f[f.length]={t:u===1?"t":T,v:T},++w;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(_=T;w<e.length&&"0123456789".indexOf(e.charAt(++w))>-1;)_+=e.charAt(w);f[f.length]={t:"D",v:_};break;case" ":f[f.length]={t:T,v:T},++w;break;case"$":f[f.length]={t:"t",v:"$"},++w;break;default:if(",$-+/():!^&'~{}<>=€acfijklopqrtuvwxzP".indexOf(T)===-1)throw new Error("unrecognized character "+T+" in "+e);f[f.length]={t:"t",v:T},++w;break}var J=0,X=0,Y;for(w=f.length-1,o="t";w>=0;--w)switch(f[w].t){case"h":case"H":f[w].t=B,o="h",J<1&&(J=1);break;case"s":(Y=f[w].v.match(/\.0+$/))&&(X=Math.max(X,Y[0].length-1)),J<3&&(J=3);case"d":case"y":case"M":case"e":o=f[w].t;break;case"m":o==="s"&&(f[w].t="M",J<2&&(J=2));break;case"X":break;case"Z":J<1&&f[w].v.match(/[Hh]/)&&(J=1),J<2&&f[w].v.match(/[Mm]/)&&(J=2),J<3&&f[w].v.match(/[Ss]/)&&(J=3)}switch(J){case 0:break;case 1:k.u>=.5&&(k.u=0,++k.S),k.S>=60&&(k.S=0,++k.M),k.M>=60&&(k.M=0,++k.H);break;case 2:k.u>=.5&&(k.u=0,++k.S),k.S>=60&&(k.S=0,++k.M);break}var Z="",_e;for(w=0;w<f.length;++w)switch(f[w].t){case"t":case"T":case" ":case"D":break;case"X":f[w].v="",f[w].t=";";break;case"d":case"m":case"y":case"h":case"H":case"M":case"s":case"e":case"b":case"Z":f[w].v=PU(f[w].t.charCodeAt(0),f[w].v,k,X),f[w].t="t";break;case"n":case"?":for(_e=w+1;f[_e]!=null&&((T=f[_e].t)==="?"||T==="D"||(T===" "||T==="t")&&f[_e+1]!=null&&(f[_e+1].t==="?"||f[_e+1].t==="t"&&f[_e+1].v==="/")||f[w].t==="("&&(T===" "||T==="n"||T===")")||T==="t"&&(f[_e].v==="/"||f[_e].v===" "&&f[_e+1]!=null&&f[_e+1].t=="?"));)f[w].v+=f[_e].v,f[_e]={v:"",t:";"},++_e;Z+=f[w].v,w=_e-1;break;case"G":f[w].t="t",f[w].v=sf(n,a);break}var ke="",Ae,me;if(Z.length>0){Z.charCodeAt(0)==40?(Ae=n<0&&Z.charCodeAt(0)===45?-n:n,me=dc("n",Z,Ae)):(Ae=n<0&&u>1?-n:n,me=dc("n",Z,Ae),Ae<0&&f[0]&&f[0].t=="t"&&(me=me.substr(1),f[0].v="-"+f[0].v)),_e=me.length-1;var De=f.length;for(w=0;w<f.length;++w)if(f[w]!=null&&f[w].t!="t"&&f[w].v.indexOf(".")>-1){De=w;break}var we=f.length;if(De===f.length&&me.indexOf("E")===-1){for(w=f.length-1;w>=0;--w)f[w]==null||"n?".indexOf(f[w].t)===-1||(_e>=f[w].v.length-1?(_e-=f[w].v.length,f[w].v=me.substr(_e+1,f[w].v.length)):_e<0?f[w].v="":(f[w].v=me.substr(0,_e+1),_e=-1),f[w].t="t",we=w);_e>=0&&we<f.length&&(f[we].v=me.substr(0,_e+1)+f[we].v)}else if(De!==f.length&&me.indexOf("E")===-1){for(_e=me.indexOf(".")-1,w=De;w>=0;--w)if(!(f[w]==null||"n?".indexOf(f[w].t)===-1)){for(R=f[w].v.indexOf(".")>-1&&w===De?f[w].v.indexOf(".")-1:f[w].v.length-1,ke=f[w].v.substr(R+1);R>=0;--R)_e>=0&&(f[w].v.charAt(R)==="0"||f[w].v.charAt(R)==="#")&&(ke=me.charAt(_e--)+ke);f[w].v=ke,f[w].t="t",we=w}for(_e>=0&&we<f.length&&(f[we].v=me.substr(0,_e+1)+f[we].v),_e=me.indexOf(".")+1,w=De;w<f.length;++w)if(!(f[w]==null||"n?(".indexOf(f[w].t)===-1&&w!==De)){for(R=f[w].v.indexOf(".")>-1&&w===De?f[w].v.indexOf(".")+1:0,ke=f[w].v.substr(0,R);R<f[w].v.length;++R)_e<me.length&&(ke+=me.charAt(_e++));f[w].v=ke,f[w].t="t",we=w}}}for(w=0;w<f.length;++w)f[w]!=null&&"n?".indexOf(f[w].t)>-1&&(Ae=u>1&&n<0&&w>0&&f[w-1].v==="-"?-n:n,f[w].v=dc(f[w].t,f[w].v,Ae),f[w].t="t");var Je="";for(w=0;w!==f.length;++w)f[w]!=null&&(Je+=f[w].v);return Je}var GI=/\[(=|>[=]?|<[>=]?)(-?\d+(?:\.\d*)?)\]/;function HI(e,n){if(n==null)return!1;var a=parseFloat(n[2]);switch(n[1]){case"=":if(e==a)return!0;break;case">":if(e>a)return!0;break;case"<":if(e<a)return!0;break;case"<>":if(e!=a)return!0;break;case">=":if(e>=a)return!0;break;case"<=":if(e<=a)return!0;break}return!1}function $U(e,n){var a=UU(e),u=a.length,f=a[u-1].indexOf("@");if(u<4&&f>-1&&--u,a.length>4)throw new Error("cannot find right format for |"+a.join("|")+"|");if(typeof n!="number")return[4,a.length===4||f>-1?a[a.length-1]:"@"];switch(a.length){case 1:a=f>-1?["General","General","General",a[0]]:[a[0],a[0],a[0],"@"];break;case 2:a=f>-1?[a[0],a[0],a[0],a[1]]:[a[0],a[1],a[0],"@"];break;case 3:a=f>-1?[a[0],a[1],a[0],a[2]]:[a[0],a[1],a[2],"@"];break}var _=n>0?a[0]:n<0?a[1]:a[2];if(a[0].indexOf("[")===-1&&a[1].indexOf("[")===-1)return[u,_];if(a[0].match(/\[[=<>]/)!=null||a[1].match(/\[[=<>]/)!=null){var w=a[0].match(GI),T=a[1].match(GI);return HI(n,w)?[u,a[0]]:HI(n,T)?[u,a[1]]:[u,a[w!=null&&T!=null?2:1]]}return[u,_]}function fo(e,n,a){a==null&&(a={});var u="";switch(typeof e){case"string":e=="m/d/yy"&&a.dateNF?u=a.dateNF:u=e;break;case"number":e==14&&a.dateNF?u=a.dateNF:u=(a.table!=null?a.table:Tn)[e],u==null&&(u=a.table&&a.table[VI[e]]||Tn[VI[e]]),u==null&&(u=EU[e]||"General");break}if(A1(u,0))return sf(n,a);n instanceof Date&&(n=QD(n,a.date1904));var f=$U(u,n);if(A1(f[1]))return sf(n,a);if(n===!0)n="TRUE";else if(n===!1)n="FALSE";else if(n===""||n==null)return"";return VU(f[1],n,a,f[0])}function Jh(e,n){if(typeof n!="number"){n=+n||-1;for(var a=0;a<392;++a){if(Tn[a]==null){n<0&&(n=a);continue}if(Tn[a]==e){n=a;break}}n<0&&(n=391)}return Tn[n]=e,n}function lF(){Tn=TU()}var jU={5:'"$"#,##0_);\\("$"#,##0\\)',6:'"$"#,##0_);[Red]\\("$"#,##0\\)',7:'"$"#,##0.00_);\\("$"#,##0.00\\)',8:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',23:"General",24:"General",25:"General",26:"General",27:"m/d/yy",28:"m/d/yy",29:"m/d/yy",30:"m/d/yy",31:"m/d/yy",32:"h:mm:ss",33:"h:mm:ss",34:"h:mm:ss",35:"h:mm:ss",36:"m/d/yy",41:'_(* #,##0_);_(* (#,##0);_(* "-"_);_(@_)',42:'_("$"* #,##0_);_("$"* (#,##0);_("$"* "-"_);_(@_)',43:'_(* #,##0.00_);_(* (#,##0.00);_(* "-"??_);_(@_)',44:'_("$"* #,##0.00_);_("$"* (#,##0.00);_("$"* "-"??_);_(@_)',50:"m/d/yy",51:"m/d/yy",52:"m/d/yy",53:"m/d/yy",54:"m/d/yy",55:"m/d/yy",56:"m/d/yy",57:"m/d/yy",58:"m/d/yy",59:"0",60:"0.00",61:"#,##0",62:"#,##0.00",63:'"$"#,##0_);\\("$"#,##0\\)',64:'"$"#,##0_);[Red]\\("$"#,##0\\)',65:'"$"#,##0.00_);\\("$"#,##0.00\\)',66:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',67:"0%",68:"0.00%",69:"# ?/?",70:"# ??/??",71:"m/d/yy",72:"m/d/yy",73:"d-mmm-yy",74:"d-mmm",75:"mmm-yy",76:"h:mm",77:"h:mm:ss",78:"m/d/yy h:mm",79:"mm:ss",80:"[h]:mm:ss",81:"mmss.0"},cF=/[dD]+|[mM]+|[yYeE]+|[Hh]+|[Ss]+/g;function GU(e){var n=typeof e=="number"?Tn[e]:e;return n=n.replace(cF,"(\\d+)"),new RegExp("^"+n+"$")}function HU(e,n,a){var u=-1,f=-1,_=-1,w=-1,T=-1,o=-1;(n.match(cF)||[]).forEach(function(F,B){var V=parseInt(a[B+1],10);switch(F.toLowerCase().charAt(0)){case"y":u=V;break;case"d":_=V;break;case"h":w=V;break;case"s":o=V;break;case"m":w>=0?T=V:f=V;break}}),o>=0&&T==-1&&f>=0&&(T=f,f=-1);var k=(""+(u>=0?u:new Date().getFullYear())).slice(-4)+"-"+("00"+(f>=1?f:1)).slice(-2)+"-"+("00"+(_>=1?_:1)).slice(-2);k.length==7&&(k="0"+k),k.length==8&&(k="20"+k);var R=("00"+(w>=0?w:0)).slice(-2)+":"+("00"+(T>=0?T:0)).slice(-2)+":"+("00"+(o>=0?o:0)).slice(-2);return w==-1&&T==-1&&o==-1?k:u==-1&&f==-1&&_==-1?R:k+"T"+R}var WU=function(){var e={};e.version="1.2.0";function n(){for(var me=0,De=new Array(256),we=0;we!=256;++we)me=we,me=me&1?-306674912^me>>>1:me>>>1,me=me&1?-306674912^me>>>1:me>>>1,me=me&1?-306674912^me>>>1:me>>>1,me=me&1?-306674912^me>>>1:me>>>1,me=me&1?-306674912^me>>>1:me>>>1,me=me&1?-306674912^me>>>1:me>>>1,me=me&1?-306674912^me>>>1:me>>>1,me=me&1?-306674912^me>>>1:me>>>1,De[we]=me;return typeof Int32Array<"u"?new Int32Array(De):De}var a=n();function u(me){var De=0,we=0,Je=0,rt=typeof Int32Array<"u"?new Int32Array(4096):new Array(4096);for(Je=0;Je!=256;++Je)rt[Je]=me[Je];for(Je=0;Je!=256;++Je)for(we=me[Je],De=256+Je;De<4096;De+=256)we=rt[De]=we>>>8^me[we&255];var Re=[];for(Je=1;Je!=16;++Je)Re[Je-1]=typeof Int32Array<"u"?rt.subarray(Je*256,Je*256+256):rt.slice(Je*256,Je*256+256);return Re}var f=u(a),_=f[0],w=f[1],T=f[2],o=f[3],k=f[4],R=f[5],F=f[6],B=f[7],V=f[8],G=f[9],U=f[10],J=f[11],X=f[12],Y=f[13],Z=f[14];function _e(me,De){for(var we=De^-1,Je=0,rt=me.length;Je<rt;)we=we>>>8^a[(we^me.charCodeAt(Je++))&255];return~we}function ke(me,De){for(var we=De^-1,Je=me.length-15,rt=0;rt<Je;)we=Z[me[rt++]^we&255]^Y[me[rt++]^we>>8&255]^X[me[rt++]^we>>16&255]^J[me[rt++]^we>>>24]^U[me[rt++]]^G[me[rt++]]^V[me[rt++]]^B[me[rt++]]^F[me[rt++]]^R[me[rt++]]^k[me[rt++]]^o[me[rt++]]^T[me[rt++]]^w[me[rt++]]^_[me[rt++]]^a[me[rt++]];for(Je+=15;rt<Je;)we=we>>>8^a[(we^me[rt++])&255];return~we}function Ae(me,De){for(var we=De^-1,Je=0,rt=me.length,Re=0,St=0;Je<rt;)Re=me.charCodeAt(Je++),Re<128?we=we>>>8^a[(we^Re)&255]:Re<2048?(we=we>>>8^a[(we^(192|Re>>6&31))&255],we=we>>>8^a[(we^(128|Re&63))&255]):Re>=55296&&Re<57344?(Re=(Re&1023)+64,St=me.charCodeAt(Je++)&1023,we=we>>>8^a[(we^(240|Re>>8&7))&255],we=we>>>8^a[(we^(128|Re>>2&63))&255],we=we>>>8^a[(we^(128|St>>6&15|(Re&3)<<4))&255],we=we>>>8^a[(we^(128|St&63))&255]):(we=we>>>8^a[(we^(224|Re>>12&15))&255],we=we>>>8^a[(we^(128|Re>>6&63))&255],we=we>>>8^a[(we^(128|Re&63))&255]);return~we}return e.table=a,e.bstr=_e,e.buf=ke,e.str=Ae,e}(),$n=function(){var n={};n.version="1.2.1";function a(re,fe){for(var se=re.split("/"),he=fe.split("/"),ge=0,be=0,ze=Math.min(se.length,he.length);ge<ze;++ge){if(be=se[ge].length-he[ge].length)return be;if(se[ge]!=he[ge])return se[ge]<he[ge]?-1:1}return se.length-he.length}function u(re){if(re.charAt(re.length-1)=="/")return re.slice(0,-1).indexOf("/")===-1?re:u(re.slice(0,-1));var fe=re.lastIndexOf("/");return fe===-1?re:re.slice(0,fe+1)}function f(re){if(re.charAt(re.length-1)=="/")return f(re.slice(0,-1));var fe=re.lastIndexOf("/");return fe===-1?re:re.slice(fe+1)}function _(re,fe){typeof fe=="string"&&(fe=new Date(fe));var se=fe.getHours();se=se<<6|fe.getMinutes(),se=se<<5|fe.getSeconds()>>>1,re.write_shift(2,se);var he=fe.getFullYear()-1980;he=he<<4|fe.getMonth()+1,he=he<<5|fe.getDate(),re.write_shift(2,he)}function w(re){var fe=re.read_shift(2)&65535,se=re.read_shift(2)&65535,he=new Date,ge=se&31;se>>>=5;var be=se&15;se>>>=4,he.setMilliseconds(0),he.setFullYear(se+1980),he.setMonth(be-1),he.setDate(ge);var ze=fe&31;fe>>>=5;var ce=fe&63;return fe>>>=6,he.setHours(fe),he.setMinutes(ce),he.setSeconds(ze<<1),he}function T(re){Ea(re,0);for(var fe={},se=0;re.l<=re.length-4;){var he=re.read_shift(2),ge=re.read_shift(2),be=re.l+ge,ze={};switch(he){case 21589:se=re.read_shift(1),se&1&&(ze.mtime=re.read_shift(4)),ge>5&&(se&2&&(ze.atime=re.read_shift(4)),se&4&&(ze.ctime=re.read_shift(4))),ze.mtime&&(ze.mt=new Date(ze.mtime*1e3));break}re.l=be,fe[he]=ze}return fe}var o;function k(){return o||(o={})}function R(re,fe){if(re[0]==80&&re[1]==75)return Nr(re,fe);if((re[0]|32)==109&&(re[1]|32)==105)return Mi(re,fe);if(re.length<512)throw new Error("CFB file size "+re.length+" < 512");var se=3,he=512,ge=0,be=0,ze=0,ce=0,Oe=0,Me=[],Ke=re.slice(0,512);Ea(Ke,0);var At=F(Ke);switch(se=At[0],se){case 3:he=512;break;case 4:he=4096;break;case 0:if(At[1]==0)return Nr(re,fe);default:throw new Error("Major Version: Expected 3 or 4 saw "+se)}he!==512&&(Ke=re.slice(0,he),Ea(Ke,28));var Rt=re.slice(0,he);B(Ke,se);var er=Ke.read_shift(4,"i");if(se===3&&er!==0)throw new Error("# Directory Sectors: Expected 0 saw "+er);Ke.l+=4,ze=Ke.read_shift(4,"i"),Ke.l+=4,Ke.chk("00100000","Mini Stream Cutoff Size: "),ce=Ke.read_shift(4,"i"),ge=Ke.read_shift(4,"i"),Oe=Ke.read_shift(4,"i"),be=Ke.read_shift(4,"i");for(var Ht=-1,Nt=0;Nt<109&&(Ht=Ke.read_shift(4,"i"),!(Ht<0));++Nt)Me[Nt]=Ht;var yr=V(re,he);J(Oe,be,yr,he,Me);var An=Y(yr,ze,Me,he);An[ze].name="!Directory",ge>0&&ce!==St&&(An[ce].name="!MiniFAT"),An[Me[0]].name="!FAT",An.fat_addrs=Me,An.ssz=he;var cn={},Ti=[],Ma=[],cs=[];Z(ze,An,yr,Ti,ge,cn,Ma,ce),G(Ma,cs,Ti),Ti.shift();var yo={FileIndex:Ma,FullPaths:cs};return fe&&fe.raw&&(yo.raw={header:Rt,sectors:yr}),yo}function F(re){if(re[re.l]==80&&re[re.l+1]==75)return[0,0];re.chk(Lt,"Header Signature: "),re.l+=16;var fe=re.read_shift(2,"u");return[re.read_shift(2,"u"),fe]}function B(re,fe){var se=9;switch(re.l+=2,se=re.read_shift(2)){case 9:if(fe!=3)throw new Error("Sector Shift: Expected 9 saw "+se);break;case 12:if(fe!=4)throw new Error("Sector Shift: Expected 12 saw "+se);break;default:throw new Error("Sector Shift: Expected 9 or 12 saw "+se)}re.chk("0600","Mini Sector Shift: "),re.chk("000000000000","Reserved: ")}function V(re,fe){for(var se=Math.ceil(re.length/fe)-1,he=[],ge=1;ge<se;++ge)he[ge-1]=re.slice(ge*fe,(ge+1)*fe);return he[se-1]=re.slice(se*fe),he}function G(re,fe,se){for(var he=0,ge=0,be=0,ze=0,ce=0,Oe=se.length,Me=[],Ke=[];he<Oe;++he)Me[he]=Ke[he]=he,fe[he]=se[he];for(;ce<Ke.length;++ce)he=Ke[ce],ge=re[he].L,be=re[he].R,ze=re[he].C,Me[he]===he&&(ge!==-1&&Me[ge]!==ge&&(Me[he]=Me[ge]),be!==-1&&Me[be]!==be&&(Me[he]=Me[be])),ze!==-1&&(Me[ze]=he),ge!==-1&&he!=Me[he]&&(Me[ge]=Me[he],Ke.lastIndexOf(ge)<ce&&Ke.push(ge)),be!==-1&&he!=Me[he]&&(Me[be]=Me[he],Ke.lastIndexOf(be)<ce&&Ke.push(be));for(he=1;he<Oe;++he)Me[he]===he&&(be!==-1&&Me[be]!==be?Me[he]=Me[be]:ge!==-1&&Me[ge]!==ge&&(Me[he]=Me[ge]));for(he=1;he<Oe;++he)if(re[he].type!==0){if(ce=he,ce!=Me[ce])do ce=Me[ce],fe[he]=fe[ce]+"/"+fe[he];while(ce!==0&&Me[ce]!==-1&&ce!=Me[ce]);Me[he]=-1}for(fe[0]+="/",he=1;he<Oe;++he)re[he].type!==2&&(fe[he]+="/")}function U(re,fe,se){for(var he=re.start,ge=re.size,be=[],ze=he;se&&ge>0&&ze>=0;)be.push(fe.slice(ze*Re,ze*Re+Re)),ge-=Re,ze=Gh(se,ze*4);return be.length===0?sa(0):wu(be).slice(0,re.size)}function J(re,fe,se,he,ge){var be=St;if(re===St){if(fe!==0)throw new Error("DIFAT chain shorter than expected")}else if(re!==-1){var ze=se[re],ce=(he>>>2)-1;if(!ze)return;for(var Oe=0;Oe<ce&&(be=Gh(ze,Oe*4))!==St;++Oe)ge.push(be);J(Gh(ze,he-4),fe-1,se,he,ge)}}function X(re,fe,se,he,ge){var be=[],ze=[];ge||(ge=[]);var ce=he-1,Oe=0,Me=0;for(Oe=fe;Oe>=0;){ge[Oe]=!0,be[be.length]=Oe,ze.push(re[Oe]);var Ke=se[Math.floor(Oe*4/he)];if(Me=Oe*4&ce,he<4+Me)throw new Error("FAT boundary crossed: "+Oe+" 4 "+he);if(!re[Ke])break;Oe=Gh(re[Ke],Me)}return{nodes:be,data:tP([ze])}}function Y(re,fe,se,he){var ge=re.length,be=[],ze=[],ce=[],Oe=[],Me=he-1,Ke=0,At=0,Rt=0,er=0;for(Ke=0;Ke<ge;++Ke)if(ce=[],Rt=Ke+fe,Rt>=ge&&(Rt-=ge),!ze[Rt]){Oe=[];var Ht=[];for(At=Rt;At>=0;){Ht[At]=!0,ze[At]=!0,ce[ce.length]=At,Oe.push(re[At]);var Nt=se[Math.floor(At*4/he)];if(er=At*4&Me,he<4+er)throw new Error("FAT boundary crossed: "+At+" 4 "+he);if(!re[Nt]||(At=Gh(re[Nt],er),Ht[At]))break}be[Rt]={nodes:ce,data:tP([Oe])}}return be}function Z(re,fe,se,he,ge,be,ze,ce){for(var Oe=0,Me=he.length?2:0,Ke=fe[re].data,At=0,Rt=0,er;At<Ke.length;At+=128){var Ht=Ke.slice(At,At+128);Ea(Ht,64),Rt=Ht.read_shift(2),er=OS(Ht,0,Rt-Me),he.push(er);var Nt={name:er,type:Ht.read_shift(1),color:Ht.read_shift(1),L:Ht.read_shift(4,"i"),R:Ht.read_shift(4,"i"),C:Ht.read_shift(4,"i"),clsid:Ht.read_shift(16),state:Ht.read_shift(4,"i"),start:0,size:0},yr=Ht.read_shift(2)+Ht.read_shift(2)+Ht.read_shift(2)+Ht.read_shift(2);yr!==0&&(Nt.ct=_e(Ht,Ht.l-8));var An=Ht.read_shift(2)+Ht.read_shift(2)+Ht.read_shift(2)+Ht.read_shift(2);An!==0&&(Nt.mt=_e(Ht,Ht.l-8)),Nt.start=Ht.read_shift(4,"i"),Nt.size=Ht.read_shift(4,"i"),Nt.size<0&&Nt.start<0&&(Nt.size=Nt.type=0,Nt.start=St,Nt.name=""),Nt.type===5?(Oe=Nt.start,ge>0&&Oe!==St&&(fe[Oe].name="!StreamData")):Nt.size>=4096?(Nt.storage="fat",fe[Nt.start]===void 0&&(fe[Nt.start]=X(se,Nt.start,fe.fat_addrs,fe.ssz)),fe[Nt.start].name=Nt.name,Nt.content=fe[Nt.start].data.slice(0,Nt.size)):(Nt.storage="minifat",Nt.size<0?Nt.size=0:Oe!==St&&Nt.start!==St&&fe[Oe]&&(Nt.content=U(Nt,fe[Oe].data,(fe[ce]||{}).data))),Nt.content&&Ea(Nt.content,0),be[er]=Nt,ze.push(Nt)}}function _e(re,fe){return new Date((Bs(re,fe+4)/1e7*Math.pow(2,32)+Bs(re,fe)/1e7-11644473600)*1e3)}function ke(re,fe){return k(),R(o.readFileSync(re),fe)}function Ae(re,fe){var se=fe&&fe.type;switch(se||zn&&Buffer.isBuffer(re)&&(se="buffer"),se||"base64"){case"file":return ke(re,fe);case"base64":return R(Ho(Ws(re)),fe);case"binary":return R(Ho(re),fe)}return R(re,fe)}function me(re,fe){var se=fe||{},he=se.root||"Root Entry";if(re.FullPaths||(re.FullPaths=[]),re.FileIndex||(re.FileIndex=[]),re.FullPaths.length!==re.FileIndex.length)throw new Error("inconsistent CFB structure");re.FullPaths.length===0&&(re.FullPaths[0]=he+"/",re.FileIndex[0]={name:he,type:5}),se.CLSID&&(re.FileIndex[0].clsid=se.CLSID),De(re)}function De(re){var fe="Sh33tJ5";if(!$n.find(re,"/"+fe)){var se=sa(4);se[0]=55,se[1]=se[3]=50,se[2]=54,re.FileIndex.push({name:fe,type:2,content:se,size:4,L:69,R:69,C:69}),re.FullPaths.push(re.FullPaths[0]+fe),we(re)}}function we(re,fe){me(re);for(var se=!1,he=!1,ge=re.FullPaths.length-1;ge>=0;--ge){var be=re.FileIndex[ge];switch(be.type){case 0:he?se=!0:(re.FileIndex.pop(),re.FullPaths.pop());break;case 1:case 2:case 5:he=!0,isNaN(be.R*be.L*be.C)&&(se=!0),be.R>-1&&be.L>-1&&be.R==be.L&&(se=!0);break;default:se=!0;break}}if(!(!se&&!fe)){var ze=new Date(1987,1,19),ce=0,Oe=Object.create?Object.create(null):{},Me=[];for(ge=0;ge<re.FullPaths.length;++ge)Oe[re.FullPaths[ge]]=!0,re.FileIndex[ge].type!==0&&Me.push([re.FullPaths[ge],re.FileIndex[ge]]);for(ge=0;ge<Me.length;++ge){var Ke=u(Me[ge][0]);he=Oe[Ke],he||(Me.push([Ke,{name:f(Ke).replace("/",""),type:1,clsid:qt,ct:ze,mt:ze,content:null}]),Oe[Ke]=!0)}for(Me.sort(function(er,Ht){return a(er[0],Ht[0])}),re.FullPaths=[],re.FileIndex=[],ge=0;ge<Me.length;++ge)re.FullPaths[ge]=Me[ge][0],re.FileIndex[ge]=Me[ge][1];for(ge=0;ge<Me.length;++ge){var At=re.FileIndex[ge],Rt=re.FullPaths[ge];if(At.name=f(Rt).replace("/",""),At.L=At.R=At.C=-(At.color=1),At.size=At.content?At.content.length:0,At.start=0,At.clsid=At.clsid||qt,ge===0)At.C=Me.length>1?1:-1,At.size=0,At.type=5;else if(Rt.slice(-1)=="/"){for(ce=ge+1;ce<Me.length&&u(re.FullPaths[ce])!=Rt;++ce);for(At.C=ce>=Me.length?-1:ce,ce=ge+1;ce<Me.length&&u(re.FullPaths[ce])!=u(Rt);++ce);At.R=ce>=Me.length?-1:ce,At.type=1}else u(re.FullPaths[ge+1]||"")==u(Rt)&&(At.R=ge+1),At.type=2}}}function Je(re,fe){var se=fe||{};if(se.fileType=="mad")return Xi(re,se);switch(we(re),se.fileType){case"zip":return ln(re,se)}var he=function(er){for(var Ht=0,Nt=0,yr=0;yr<er.FileIndex.length;++yr){var An=er.FileIndex[yr];if(An.content){var cn=An.content.length;cn>0&&(cn<4096?Ht+=cn+63>>6:Nt+=cn+511>>9)}}for(var Ti=er.FullPaths.length+3>>2,Ma=Ht+7>>3,cs=Ht+127>>7,yo=Ma+Nt+Ti+cs,xa=yo+127>>7,Nl=xa<=109?0:Math.ceil((xa-109)/127);yo+xa+Nl+127>>7>xa;)Nl=++xa<=109?0:Math.ceil((xa-109)/127);var ha=[1,Nl,xa,cs,Ti,Nt,Ht,0];return er.FileIndex[0].size=Ht<<6,ha[7]=(er.FileIndex[0].start=ha[0]+ha[1]+ha[2]+ha[3]+ha[4]+ha[5])+(ha[6]+7>>3),ha}(re),ge=sa(he[7]<<9),be=0,ze=0;{for(be=0;be<8;++be)ge.write_shift(1,We[be]);for(be=0;be<8;++be)ge.write_shift(2,0);for(ge.write_shift(2,62),ge.write_shift(2,3),ge.write_shift(2,65534),ge.write_shift(2,9),ge.write_shift(2,6),be=0;be<3;++be)ge.write_shift(2,0);for(ge.write_shift(4,0),ge.write_shift(4,he[2]),ge.write_shift(4,he[0]+he[1]+he[2]+he[3]-1),ge.write_shift(4,0),ge.write_shift(4,4096),ge.write_shift(4,he[3]?he[0]+he[1]+he[2]-1:St),ge.write_shift(4,he[3]),ge.write_shift(-4,he[1]?he[0]-1:St),ge.write_shift(4,he[1]),be=0;be<109;++be)ge.write_shift(-4,be<he[2]?he[1]+be:-1)}if(he[1])for(ze=0;ze<he[1];++ze){for(;be<236+ze*127;++be)ge.write_shift(-4,be<he[2]?he[1]+be:-1);ge.write_shift(-4,ze===he[1]-1?St:ze+1)}var ce=function(er){for(ze+=er;be<ze-1;++be)ge.write_shift(-4,be+1);er&&(++be,ge.write_shift(-4,St))};for(ze=be=0,ze+=he[1];be<ze;++be)ge.write_shift(-4,Ot.DIFSECT);for(ze+=he[2];be<ze;++be)ge.write_shift(-4,Ot.FATSECT);ce(he[3]),ce(he[4]);for(var Oe=0,Me=0,Ke=re.FileIndex[0];Oe<re.FileIndex.length;++Oe)Ke=re.FileIndex[Oe],Ke.content&&(Me=Ke.content.length,!(Me<4096)&&(Ke.start=ze,ce(Me+511>>9)));for(ce(he[6]+7>>3);ge.l&511;)ge.write_shift(-4,Ot.ENDOFCHAIN);for(ze=be=0,Oe=0;Oe<re.FileIndex.length;++Oe)Ke=re.FileIndex[Oe],Ke.content&&(Me=Ke.content.length,!(!Me||Me>=4096)&&(Ke.start=ze,ce(Me+63>>6)));for(;ge.l&511;)ge.write_shift(-4,Ot.ENDOFCHAIN);for(be=0;be<he[4]<<2;++be){var At=re.FullPaths[be];if(!At||At.length===0){for(Oe=0;Oe<17;++Oe)ge.write_shift(4,0);for(Oe=0;Oe<3;++Oe)ge.write_shift(4,-1);for(Oe=0;Oe<12;++Oe)ge.write_shift(4,0);continue}Ke=re.FileIndex[be],be===0&&(Ke.start=Ke.size?Ke.start-1:St);var Rt=be===0&&se.root||Ke.name;if(Me=2*(Rt.length+1),ge.write_shift(64,Rt,"utf16le"),ge.write_shift(2,Me),ge.write_shift(1,Ke.type),ge.write_shift(1,Ke.color),ge.write_shift(-4,Ke.L),ge.write_shift(-4,Ke.R),ge.write_shift(-4,Ke.C),Ke.clsid)ge.write_shift(16,Ke.clsid,"hex");else for(Oe=0;Oe<4;++Oe)ge.write_shift(4,0);ge.write_shift(4,Ke.state||0),ge.write_shift(4,0),ge.write_shift(4,0),ge.write_shift(4,0),ge.write_shift(4,0),ge.write_shift(4,Ke.start),ge.write_shift(4,Ke.size),ge.write_shift(4,0)}for(be=1;be<re.FileIndex.length;++be)if(Ke=re.FileIndex[be],Ke.size>=4096)if(ge.l=Ke.start+1<<9,zn&&Buffer.isBuffer(Ke.content))Ke.content.copy(ge,ge.l,0,Ke.size),ge.l+=Ke.size+511&-512;else{for(Oe=0;Oe<Ke.size;++Oe)ge.write_shift(1,Ke.content[Oe]);for(;Oe&511;++Oe)ge.write_shift(1,0)}for(be=1;be<re.FileIndex.length;++be)if(Ke=re.FileIndex[be],Ke.size>0&&Ke.size<4096)if(zn&&Buffer.isBuffer(Ke.content))Ke.content.copy(ge,ge.l,0,Ke.size),ge.l+=Ke.size+63&-64;else{for(Oe=0;Oe<Ke.size;++Oe)ge.write_shift(1,Ke.content[Oe]);for(;Oe&63;++Oe)ge.write_shift(1,0)}if(zn)ge.l=ge.length;else for(;ge.l<ge.length;)ge.write_shift(1,0);return ge}function rt(re,fe){var se=re.FullPaths.map(function(Oe){return Oe.toUpperCase()}),he=se.map(function(Oe){var Me=Oe.split("/");return Me[Me.length-(Oe.slice(-1)=="/"?2:1)]}),ge=!1;fe.charCodeAt(0)===47?(ge=!0,fe=se[0].slice(0,-1)+fe):ge=fe.indexOf("/")!==-1;var be=fe.toUpperCase(),ze=ge===!0?se.indexOf(be):he.indexOf(be);if(ze!==-1)return re.FileIndex[ze];var ce=!be.match($m);for(be=be.replace(is,""),ce&&(be=be.replace($m,"!")),ze=0;ze<se.length;++ze)if((ce?se[ze].replace($m,"!"):se[ze]).replace(is,"")==be||(ce?he[ze].replace($m,"!"):he[ze]).replace(is,"")==be)return re.FileIndex[ze];return null}var Re=64,St=-2,Lt="d0cf11e0a1b11ae1",We=[208,207,17,224,161,177,26,225],qt="00000000000000000000000000000000",Ot={MAXREGSECT:-6,DIFSECT:-4,FATSECT:-3,ENDOFCHAIN:St,FREESECT:-1,HEADER_SIGNATURE:Lt,HEADER_MINOR_VERSION:"3e00",MAXREGSID:-6,NOSTREAM:-1,HEADER_CLSID:qt,EntryTypes:["unknown","storage","stream","lockbytes","property","root"]};function st(re,fe,se){k();var he=Je(re,se);o.writeFileSync(fe,he)}function Ve(re){for(var fe=new Array(re.length),se=0;se<re.length;++se)fe[se]=String.fromCharCode(re[se]);return fe.join("")}function Et(re,fe){var se=Je(re,fe);switch(fe&&fe.type||"buffer"){case"file":return k(),o.writeFileSync(fe.filename,se),se;case"binary":return typeof se=="string"?se:Ve(se);case"base64":return NI(typeof se=="string"?se:Ve(se));case"buffer":if(zn)return Buffer.isBuffer(se)?se:ff(se);case"array":return typeof se=="string"?Ho(se):se}return se}var Dt;function Se(re){try{var fe=re.InflateRaw,se=new fe;if(se._processChunk(new Uint8Array([3,0]),se._finishFlushFlag),se.bytesRead)Dt=re;else throw new Error("zlib does not expose bytesRead")}catch(he){console.error("cannot use native zlib: "+(he.message||he))}}function at(re,fe){if(!Dt)return br(re,fe);var se=Dt.InflateRaw,he=new se,ge=he._processChunk(re.slice(re.l),he._finishFlushFlag);return re.l+=he.bytesRead,ge}function He(re){return Dt?Dt.deflateRawSync(re):et(re)}var Xe=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],yt=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258],Jt=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577];function sr(re){var fe=(re<<1|re<<11)&139536|(re<<5|re<<15)&558144;return(fe>>16|fe>>8|fe)&255}for(var Xt=typeof Uint8Array<"u",zt=Xt?new Uint8Array(256):[],Or=0;Or<256;++Or)zt[Or]=sr(Or);function Be(re,fe){var se=zt[re&255];return fe<=8?se>>>8-fe:(se=se<<8|zt[re>>8&255],fe<=16?se>>>16-fe:(se=se<<8|zt[re>>16&255],se>>>24-fe))}function Fn(re,fe){var se=fe&7,he=fe>>>3;return(re[he]|(se<=6?0:re[he+1]<<8))>>>se&3}function Tr(re,fe){var se=fe&7,he=fe>>>3;return(re[he]|(se<=5?0:re[he+1]<<8))>>>se&7}function Er(re,fe){var se=fe&7,he=fe>>>3;return(re[he]|(se<=4?0:re[he+1]<<8))>>>se&15}function Ir(re,fe){var se=fe&7,he=fe>>>3;return(re[he]|(se<=3?0:re[he+1]<<8))>>>se&31}function nr(re,fe){var se=fe&7,he=fe>>>3;return(re[he]|(se<=1?0:re[he+1]<<8))>>>se&127}function En(re,fe,se){var he=fe&7,ge=fe>>>3,be=(1<<se)-1,ze=re[ge]>>>he;return se<8-he||(ze|=re[ge+1]<<8-he,se<16-he)||(ze|=re[ge+2]<<16-he,se<24-he)||(ze|=re[ge+3]<<24-he),ze&be}function Xn(re,fe,se){var he=fe&7,ge=fe>>>3;return he<=5?re[ge]|=(se&7)<<he:(re[ge]|=se<<he&255,re[ge+1]=(se&7)>>8-he),fe+3}function wn(re,fe,se){var he=fe&7,ge=fe>>>3;return se=(se&1)<<he,re[ge]|=se,fe+1}function ei(re,fe,se){var he=fe&7,ge=fe>>>3;return se<<=he,re[ge]|=se&255,se>>>=8,re[ge+1]=se,fe+8}function bi(re,fe,se){var he=fe&7,ge=fe>>>3;return se<<=he,re[ge]|=se&255,se>>>=8,re[ge+1]=se&255,re[ge+2]=se>>>8,fe+16}function Mn(re,fe){var se=re.length,he=2*se>fe?2*se:fe+5,ge=0;if(se>=fe)return re;if(zn){var be=zI(he);if(re.copy)re.copy(be);else for(;ge<re.length;++ge)be[ge]=re[ge];return be}else if(Xt){var ze=new Uint8Array(he);if(ze.set)ze.set(re);else for(;ge<se;++ge)ze[ge]=re[ge];return ze}return re.length=he,re}function Nn(re){for(var fe=new Array(re),se=0;se<re;++se)fe[se]=0;return fe}function ti(re,fe,se){var he=1,ge=0,be=0,ze=0,ce=0,Oe=re.length,Me=Xt?new Uint16Array(32):Nn(32);for(be=0;be<32;++be)Me[be]=0;for(be=Oe;be<se;++be)re[be]=0;Oe=re.length;var Ke=Xt?new Uint16Array(Oe):Nn(Oe);for(be=0;be<Oe;++be)Me[ge=re[be]]++,he<ge&&(he=ge),Ke[be]=0;for(Me[0]=0,be=1;be<=he;++be)Me[be+16]=ce=ce+Me[be-1]<<1;for(be=0;be<Oe;++be)ce=re[be],ce!=0&&(Ke[be]=Me[ce+16]++);var At=0;for(be=0;be<Oe;++be)if(At=re[be],At!=0)for(ce=Be(Ke[be],he)>>he-At,ze=(1<<he+4-At)-1;ze>=0;--ze)fe[ce|ze<<At]=At&15|be<<4;return he}var gt=Xt?new Uint16Array(512):Nn(512),le=Xt?new Uint16Array(32):Nn(32);if(!Xt){for(var Te=0;Te<512;++Te)gt[Te]=0;for(Te=0;Te<32;++Te)le[Te]=0}(function(){for(var re=[],fe=0;fe<32;fe++)re.push(5);ti(re,le,32);var se=[];for(fe=0;fe<=143;fe++)se.push(8);for(;fe<=255;fe++)se.push(9);for(;fe<=279;fe++)se.push(7);for(;fe<=287;fe++)se.push(8);ti(se,gt,288)})();var Ne=function(){for(var fe=Xt?new Uint8Array(32768):[],se=0,he=0;se<Jt.length-1;++se)for(;he<Jt[se+1];++he)fe[he]=se;for(;he<32768;++he)fe[he]=29;var ge=Xt?new Uint8Array(259):[];for(se=0,he=0;se<yt.length-1;++se)for(;he<yt[se+1];++he)ge[he]=se;function be(ce,Oe){for(var Me=0;Me<ce.length;){var Ke=Math.min(65535,ce.length-Me),At=Me+Ke==ce.length;for(Oe.write_shift(1,+At),Oe.write_shift(2,Ke),Oe.write_shift(2,~Ke&65535);Ke-- >0;)Oe[Oe.l++]=ce[Me++]}return Oe.l}function ze(ce,Oe){for(var Me=0,Ke=0,At=Xt?new Uint16Array(32768):[];Ke<ce.length;){var Rt=Math.min(65535,ce.length-Ke);if(Rt<10){for(Me=Xn(Oe,Me,+(Ke+Rt==ce.length)),Me&7&&(Me+=8-(Me&7)),Oe.l=Me/8|0,Oe.write_shift(2,Rt),Oe.write_shift(2,~Rt&65535);Rt-- >0;)Oe[Oe.l++]=ce[Ke++];Me=Oe.l*8;continue}Me=Xn(Oe,Me,+(Ke+Rt==ce.length)+2);for(var er=0;Rt-- >0;){var Ht=ce[Ke];er=(er<<5^Ht)&32767;var Nt=-1,yr=0;if((Nt=At[er])&&(Nt|=Ke&-32768,Nt>Ke&&(Nt-=32768),Nt<Ke))for(;ce[Nt+yr]==ce[Ke+yr]&&yr<250;)++yr;if(yr>2){Ht=ge[yr],Ht<=22?Me=ei(Oe,Me,zt[Ht+1]>>1)-1:(ei(Oe,Me,3),Me+=5,ei(Oe,Me,zt[Ht-23]>>5),Me+=3);var An=Ht<8?0:Ht-4>>2;An>0&&(bi(Oe,Me,yr-yt[Ht]),Me+=An),Ht=fe[Ke-Nt],Me=ei(Oe,Me,zt[Ht]>>3),Me-=3;var cn=Ht<4?0:Ht-2>>1;cn>0&&(bi(Oe,Me,Ke-Nt-Jt[Ht]),Me+=cn);for(var Ti=0;Ti<yr;++Ti)At[er]=Ke&32767,er=(er<<5^ce[Ke])&32767,++Ke;Rt-=yr-1}else Ht<=143?Ht=Ht+48:Me=wn(Oe,Me,1),Me=ei(Oe,Me,zt[Ht]),At[er]=Ke&32767,++Ke}Me=ei(Oe,Me,0)-1}return Oe.l=(Me+7)/8|0,Oe.l}return function(Oe,Me){return Oe.length<8?be(Oe,Me):ze(Oe,Me)}}();function et(re){var fe=sa(50+Math.floor(re.length*1.1)),se=Ne(re,fe);return fe.slice(0,se)}var ut=Xt?new Uint16Array(32768):Nn(32768),_t=Xt?new Uint16Array(32768):Nn(32768),$t=Xt?new Uint16Array(128):Nn(128),dt=1,kt=1;function Vt(re,fe){var se=Ir(re,fe)+257;fe+=5;var he=Ir(re,fe)+1;fe+=5;var ge=Er(re,fe)+4;fe+=4;for(var be=0,ze=Xt?new Uint8Array(19):Nn(19),ce=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Oe=1,Me=Xt?new Uint8Array(8):Nn(8),Ke=Xt?new Uint8Array(8):Nn(8),At=ze.length,Rt=0;Rt<ge;++Rt)ze[Xe[Rt]]=be=Tr(re,fe),Oe<be&&(Oe=be),Me[be]++,fe+=3;var er=0;for(Me[0]=0,Rt=1;Rt<=Oe;++Rt)Ke[Rt]=er=er+Me[Rt-1]<<1;for(Rt=0;Rt<At;++Rt)(er=ze[Rt])!=0&&(ce[Rt]=Ke[er]++);var Ht=0;for(Rt=0;Rt<At;++Rt)if(Ht=ze[Rt],Ht!=0){er=zt[ce[Rt]]>>8-Ht;for(var Nt=(1<<7-Ht)-1;Nt>=0;--Nt)$t[er|Nt<<Ht]=Ht&7|Rt<<3}var yr=[];for(Oe=1;yr.length<se+he;)switch(er=$t[nr(re,fe)],fe+=er&7,er>>>=3){case 16:for(be=3+Fn(re,fe),fe+=2,er=yr[yr.length-1];be-- >0;)yr.push(er);break;case 17:for(be=3+Tr(re,fe),fe+=3;be-- >0;)yr.push(0);break;case 18:for(be=11+nr(re,fe),fe+=7;be-- >0;)yr.push(0);break;default:yr.push(er),Oe<er&&(Oe=er);break}var An=yr.slice(0,se),cn=yr.slice(se);for(Rt=se;Rt<286;++Rt)An[Rt]=0;for(Rt=he;Rt<30;++Rt)cn[Rt]=0;return dt=ti(An,ut,286),kt=ti(cn,_t,30),fe}function Wt(re,fe){if(re[0]==3&&!(re[1]&3))return[Nu(fe),2];for(var se=0,he=0,ge=zI(fe||1<<18),be=0,ze=ge.length>>>0,ce=0,Oe=0;!(he&1);){if(he=Tr(re,se),se+=3,he>>>1)he>>1==1?(ce=9,Oe=5):(se=Vt(re,se),ce=dt,Oe=kt);else{se&7&&(se+=8-(se&7));var Me=re[se>>>3]|re[(se>>>3)+1]<<8;if(se+=32,Me>0)for(!fe&&ze<be+Me&&(ge=Mn(ge,be+Me),ze=ge.length);Me-- >0;)ge[be++]=re[se>>>3],se+=8;continue}for(;;){!fe&&ze<be+32767&&(ge=Mn(ge,be+32767),ze=ge.length);var Ke=En(re,se,ce),At=he>>>1==1?gt[Ke]:ut[Ke];if(se+=At&15,At>>>=4,!(At>>>8&255))ge[be++]=At;else{if(At==256)break;At-=257;var Rt=At<8?0:At-4>>2;Rt>5&&(Rt=0);var er=be+yt[At];Rt>0&&(er+=En(re,se,Rt),se+=Rt),Ke=En(re,se,Oe),At=he>>>1==1?le[Ke]:_t[Ke],se+=At&15,At>>>=4;var Ht=At<4?0:At-2>>1,Nt=Jt[At];for(Ht>0&&(Nt+=En(re,se,Ht),se+=Ht),!fe&&ze<er&&(ge=Mn(ge,er+100),ze=ge.length);be<er;)ge[be]=ge[be-Nt],++be}}}return fe?[ge,se+7>>>3]:[ge.slice(0,be),se+7>>>3]}function br(re,fe){var se=re.slice(re.l||0),he=Wt(se,fe);return re.l+=he[1],he[0]}function Hr(re,fe){if(re)typeof console<"u"&&console.error(fe);else throw new Error(fe)}function Nr(re,fe){var se=re;Ea(se,0);var he=[],ge=[],be={FileIndex:he,FullPaths:ge};me(be,{root:fe.root});for(var ze=se.length-4;(se[ze]!=80||se[ze+1]!=75||se[ze+2]!=5||se[ze+3]!=6)&&ze>=0;)--ze;se.l=ze+4,se.l+=4;var ce=se.read_shift(2);se.l+=6;var Oe=se.read_shift(4);for(se.l=Oe,ze=0;ze<ce;++ze){se.l+=20;var Me=se.read_shift(4),Ke=se.read_shift(4),At=se.read_shift(2),Rt=se.read_shift(2),er=se.read_shift(2);se.l+=8;var Ht=se.read_shift(4),Nt=T(se.slice(se.l+At,se.l+At+Rt));se.l+=At+Rt+er;var yr=se.l;se.l=Ht+4,tn(se,Me,Ke,be,Nt),se.l=yr}return be}function tn(re,fe,se,he,ge){re.l+=2;var be=re.read_shift(2),ze=re.read_shift(2),ce=w(re);if(be&8257)throw new Error("Unsupported ZIP encryption");for(var Oe=re.read_shift(4),Me=re.read_shift(4),Ke=re.read_shift(4),At=re.read_shift(2),Rt=re.read_shift(2),er="",Ht=0;Ht<At;++Ht)er+=String.fromCharCode(re[re.l++]);if(Rt){var Nt=T(re.slice(re.l,re.l+Rt));(Nt[21589]||{}).mt&&(ce=Nt[21589].mt),((ge||{})[21589]||{}).mt&&(ce=ge[21589].mt)}re.l+=Rt;var yr=re.slice(re.l,re.l+Me);switch(ze){case 8:yr=at(re,Ke);break;case 0:break;default:throw new Error("Unsupported ZIP Compression method "+ze)}var An=!1;be&8&&(Oe=re.read_shift(4),Oe==134695760&&(Oe=re.read_shift(4),An=!0),Me=re.read_shift(4),Ke=re.read_shift(4)),Me!=fe&&Hr(An,"Bad compressed size: "+fe+" != "+Me),Ke!=se&&Hr(An,"Bad uncompressed size: "+se+" != "+Ke),Wn(he,er,yr,{unsafe:!0,mt:ce})}function ln(re,fe){var se=fe||{},he=[],ge=[],be=sa(1),ze=se.compression?8:0,ce=0,Oe=0,Me=0,Ke=0,At=0,Rt=re.FullPaths[0],er=Rt,Ht=re.FileIndex[0],Nt=[],yr=0;for(Oe=1;Oe<re.FullPaths.length;++Oe)if(er=re.FullPaths[Oe].slice(Rt.length),Ht=re.FileIndex[Oe],!(!Ht.size||!Ht.content||er=="Sh33tJ5")){var An=Ke,cn=sa(er.length);for(Me=0;Me<er.length;++Me)cn.write_shift(1,er.charCodeAt(Me)&127);cn=cn.slice(0,cn.l),Nt[At]=WU.buf(Ht.content,0);var Ti=Ht.content;ze==8&&(Ti=He(Ti)),be=sa(30),be.write_shift(4,67324752),be.write_shift(2,20),be.write_shift(2,ce),be.write_shift(2,ze),Ht.mt?_(be,Ht.mt):be.write_shift(4,0),be.write_shift(-4,Nt[At]),be.write_shift(4,Ti.length),be.write_shift(4,Ht.content.length),be.write_shift(2,cn.length),be.write_shift(2,0),Ke+=be.length,he.push(be),Ke+=cn.length,he.push(cn),Ke+=Ti.length,he.push(Ti),be=sa(46),be.write_shift(4,33639248),be.write_shift(2,0),be.write_shift(2,20),be.write_shift(2,ce),be.write_shift(2,ze),be.write_shift(4,0),be.write_shift(-4,Nt[At]),be.write_shift(4,Ti.length),be.write_shift(4,Ht.content.length),be.write_shift(2,cn.length),be.write_shift(2,0),be.write_shift(2,0),be.write_shift(2,0),be.write_shift(2,0),be.write_shift(4,0),be.write_shift(4,An),yr+=be.l,ge.push(be),yr+=cn.length,ge.push(cn),++At}return be=sa(22),be.write_shift(4,101010256),be.write_shift(2,0),be.write_shift(2,0),be.write_shift(2,At),be.write_shift(2,At),be.write_shift(4,yr),be.write_shift(4,Ke),be.write_shift(2,0),wu([wu(he),wu(ge),be])}var Xr={htm:"text/html",xml:"text/xml",gif:"image/gif",jpg:"image/jpeg",png:"image/png",mso:"application/x-mso",thmx:"application/vnd.ms-officetheme",sh33tj5:"application/octet-stream"};function dn(re,fe){if(re.ctype)return re.ctype;var se=re.name||"",he=se.match(/\.([^\.]+)$/);return he&&Xr[he[1]]||fe&&(he=(se=fe).match(/[\.\\]([^\.\\])+$/),he&&Xr[he[1]])?Xr[he[1]]:"application/octet-stream"}function kn(re){for(var fe=NI(re),se=[],he=0;he<fe.length;he+=76)se.push(fe.slice(he,he+76));return se.join(`\r
`)+`\r
`}function fi(re){var fe=re.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7E-\xFF=]/g,function(Me){var Ke=Me.charCodeAt(0).toString(16).toUpperCase();return"="+(Ke.length==1?"0"+Ke:Ke)});fe=fe.replace(/ $/mg,"=20").replace(/\t$/mg,"=09"),fe.charAt(0)==`
`&&(fe="=0D"+fe.slice(1)),fe=fe.replace(/\r(?!\n)/mg,"=0D").replace(/\n\n/mg,`
=0A`).replace(/([^\r\n])\n/mg,"$1=0A");for(var se=[],he=fe.split(`\r
`),ge=0;ge<he.length;++ge){var be=he[ge];if(be.length==0){se.push("");continue}for(var ze=0;ze<be.length;){var ce=76,Oe=be.slice(ze,ze+ce);Oe.charAt(ce-1)=="="?ce--:Oe.charAt(ce-2)=="="?ce-=2:Oe.charAt(ce-3)=="="&&(ce-=3),Oe=be.slice(ze,ze+ce),ze+=ce,ze<be.length&&(Oe+="="),se.push(Oe)}}return se.join(`\r
`)}function In(re){for(var fe=[],se=0;se<re.length;++se){for(var he=re[se];se<=re.length&&he.charAt(he.length-1)=="=";)he=he.slice(0,he.length-1)+re[++se];fe.push(he)}for(var ge=0;ge<fe.length;++ge)fe[ge]=fe[ge].replace(/[=][0-9A-Fa-f]{2}/g,function(be){return String.fromCharCode(parseInt(be.slice(1),16))});return Ho(fe.join(`\r
`))}function Li(re,fe,se){for(var he="",ge="",be="",ze,ce=0;ce<10;++ce){var Oe=fe[ce];if(!Oe||Oe.match(/^\s*$/))break;var Me=Oe.match(/^(.*?):\s*([^\s].*)$/);if(Me)switch(Me[1].toLowerCase()){case"content-location":he=Me[2].trim();break;case"content-type":be=Me[2].trim();break;case"content-transfer-encoding":ge=Me[2].trim();break}}switch(++ce,ge.toLowerCase()){case"base64":ze=Ho(Ws(fe.slice(ce).join("")));break;case"quoted-printable":ze=In(fe.slice(ce));break;default:throw new Error("Unsupported Content-Transfer-Encoding "+ge)}var Ke=Wn(re,he.slice(se.length),ze,{unsafe:!0});be&&(Ke.ctype=be)}function Mi(re,fe){if(Ve(re.slice(0,13)).toLowerCase()!="mime-version:")throw new Error("Unsupported MAD header");var se=fe&&fe.root||"",he=(zn&&Buffer.isBuffer(re)?re.toString("binary"):Ve(re)).split(`\r
`),ge=0,be="";for(ge=0;ge<he.length;++ge)if(be=he[ge],!!/^Content-Location:/i.test(be)&&(be=be.slice(be.indexOf("file")),se||(se=be.slice(0,be.lastIndexOf("/")+1)),be.slice(0,se.length)!=se))for(;se.length>0&&(se=se.slice(0,se.length-1),se=se.slice(0,se.lastIndexOf("/")+1),be.slice(0,se.length)!=se););var ze=(he[1]||"").match(/boundary="(.*?)"/);if(!ze)throw new Error("MAD cannot find boundary");var ce="--"+(ze[1]||""),Oe=[],Me=[],Ke={FileIndex:Oe,FullPaths:Me};me(Ke);var At,Rt=0;for(ge=0;ge<he.length;++ge){var er=he[ge];er!==ce&&er!==ce+"--"||(Rt++&&Li(Ke,he.slice(At,ge),se),At=ge)}return Ke}function Xi(re,fe){var se=fe||{},he=se.boundary||"SheetJS";he="------="+he;for(var ge=["MIME-Version: 1.0",'Content-Type: multipart/related; boundary="'+he.slice(2)+'"',"","",""],be=re.FullPaths[0],ze=be,ce=re.FileIndex[0],Oe=1;Oe<re.FullPaths.length;++Oe)if(ze=re.FullPaths[Oe].slice(be.length),ce=re.FileIndex[Oe],!(!ce.size||!ce.content||ze=="Sh33tJ5")){ze=ze.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7E-\xFF]/g,function(yr){return"_x"+yr.charCodeAt(0).toString(16)+"_"}).replace(/[\u0080-\uFFFF]/g,function(yr){return"_u"+yr.charCodeAt(0).toString(16)+"_"});for(var Me=ce.content,Ke=zn&&Buffer.isBuffer(Me)?Me.toString("binary"):Ve(Me),At=0,Rt=Math.min(1024,Ke.length),er=0,Ht=0;Ht<=Rt;++Ht)(er=Ke.charCodeAt(Ht))>=32&&er<128&&++At;var Nt=At>=Rt*4/5;ge.push(he),ge.push("Content-Location: "+(se.root||"file:///C:/SheetJS/")+ze),ge.push("Content-Transfer-Encoding: "+(Nt?"quoted-printable":"base64")),ge.push("Content-Type: "+dn(ce,ze)),ge.push(""),ge.push(Nt?fi(Ke):kn(Ke))}return ge.push(he+`--\r
`),ge.join(`\r
`)}function Hn(re){var fe={};return me(fe,re),fe}function Wn(re,fe,se,he){var ge=he&&he.unsafe;ge||me(re);var be=!ge&&$n.find(re,fe);if(!be){var ze=re.FullPaths[0];fe.slice(0,ze.length)==ze?ze=fe:(ze.slice(-1)!="/"&&(ze+="/"),ze=(ze+fe).replace("//","/")),be={name:f(fe),type:2},re.FileIndex.push(be),re.FullPaths.push(ze),ge||$n.utils.cfb_gc(re)}return be.content=se,be.size=se?se.length:0,he&&(he.CLSID&&(be.clsid=he.CLSID),he.mt&&(be.mt=he.mt),he.ct&&(be.ct=he.ct)),be}function pt(re,fe){me(re);var se=$n.find(re,fe);if(se){for(var he=0;he<re.FileIndex.length;++he)if(re.FileIndex[he]==se)return re.FileIndex.splice(he,1),re.FullPaths.splice(he,1),!0}return!1}function xt(re,fe,se){me(re);var he=$n.find(re,fe);if(he){for(var ge=0;ge<re.FileIndex.length;++ge)if(re.FileIndex[ge]==he)return re.FileIndex[ge].name=f(se),re.FullPaths[ge]=se,!0}return!1}function Ft(re){we(re,!0)}return n.find=rt,n.read=Ae,n.parse=R,n.write=Et,n.writeFile=st,n.utils={cfb_new:Hn,cfb_add:Wn,cfb_del:pt,cfb_mov:xt,cfb_gc:Ft,ReadShift:rg,CheckField:RF,prep_blob:Ea,bconcat:wu,use_zlib:Se,_deflateRaw:et,_inflateRaw:br,consts:Ot},n}();function qU(e){if(typeof Deno<"u")return Deno.readFileSync(e);if(typeof $<"u"&&typeof File<"u"&&typeof Folder<"u")try{var n=File(e);n.open("r"),n.encoding="binary";var a=n.read();return n.close(),a}catch(u){if(!u.message||!u.message.match(/onstruct/))throw u}throw new Error("Cannot access file "+e)}function Pl(e){for(var n=Object.keys(e),a=[],u=0;u<n.length;++u)Object.prototype.hasOwnProperty.call(e,n[u])&&a.push(n[u]);return a}function RS(e){for(var n=[],a=Pl(e),u=0;u!==a.length;++u)n[e[a[u]]]=a[u];return n}var k1=new Date(1899,11,30,0,0,0);function as(e,n){var a=e.getTime();n&&(a-=1462*24*60*60*1e3);var u=k1.getTime()+(e.getTimezoneOffset()-k1.getTimezoneOffset())*6e4;return(a-u)/(24*60*60*1e3)}var uF=new Date,ZU=k1.getTime()+(uF.getTimezoneOffset()-k1.getTimezoneOffset())*6e4,WI=uF.getTimezoneOffset();function iv(e){var n=new Date;return n.setTime(e*24*60*60*1e3+ZU),n.getTimezoneOffset()!==WI&&n.setTime(n.getTime()+(n.getTimezoneOffset()-WI)*6e4),n}function XU(e){var n=0,a=0,u=!1,f=e.match(/P([0-9\.]+Y)?([0-9\.]+M)?([0-9\.]+D)?T([0-9\.]+H)?([0-9\.]+M)?([0-9\.]+S)?/);if(!f)throw new Error("|"+e+"| is not an ISO8601 Duration");for(var _=1;_!=f.length;++_)if(f[_]){switch(a=1,_>3&&(u=!0),f[_].slice(f[_].length-1)){case"Y":throw new Error("Unsupported ISO Duration Field: "+f[_].slice(f[_].length-1));case"D":a*=24;case"H":a*=60;case"M":if(u)a*=60;else throw new Error("Unsupported ISO Duration Field: M")}n+=a*parseInt(f[_],10)}return n}var qI=new Date("2017-02-19T19:06:09.000Z"),hF=isNaN(qI.getFullYear())?new Date("2/19/17"):qI,YU=hF.getFullYear()==2017;function _a(e,n){var a=new Date(e);if(YU)return n>0?a.setTime(a.getTime()+a.getTimezoneOffset()*60*1e3):n<0&&a.setTime(a.getTime()-a.getTimezoneOffset()*60*1e3),a;if(e instanceof Date)return e;if(hF.getFullYear()==1917&&!isNaN(a.getFullYear())){var u=a.getFullYear();return e.indexOf(""+u)>-1||a.setFullYear(a.getFullYear()+100),a}var f=e.match(/\d+/g)||["2017","2","19","0","0","0"],_=new Date(+f[0],+f[1]-1,+f[2],+f[3]||0,+f[4]||0,+f[5]||0);return e.indexOf("Z")>-1&&(_=new Date(_.getTime()-_.getTimezoneOffset()*60*1e3)),_}function of(e,n){if(zn&&Buffer.isBuffer(e)){if(n){if(e[0]==255&&e[1]==254)return Gm(e.slice(2).toString("utf16le"));if(e[1]==254&&e[2]==255)return Gm(KD(e.slice(2).toString("binary")))}return e.toString("binary")}if(typeof TextDecoder<"u")try{if(n){if(e[0]==255&&e[1]==254)return Gm(new TextDecoder("utf-16le").decode(e.slice(2)));if(e[0]==254&&e[1]==255)return Gm(new TextDecoder("utf-16be").decode(e.slice(2)))}var a={"€":"","‚":"",ƒ:"","„":"","…":"","†":"","‡":"","ˆ":"","‰":"",Š:"","‹":"",Œ:"",Ž:"","‘":"","’":"","“":"","”":"","•":"","–":"","—":"","˜":"","™":"",š:"","›":"",œ:"",ž:"",Ÿ:""};return Array.isArray(e)&&(e=new Uint8Array(e)),new TextDecoder("latin1").decode(e).replace(/[€‚ƒ„…†‡ˆ‰Š‹ŒŽ‘’“”•–—˜™š›œžŸ]/g,function(_){return a[_]||_})}catch{}for(var u=[],f=0;f!=e.length;++f)u.push(String.fromCharCode(e[f]));return u.join("")}function Aa(e){if(typeof JSON<"u"&&!Array.isArray(e))return JSON.parse(JSON.stringify(e));if(typeof e!="object"||e==null)return e;if(e instanceof Date)return new Date(e.getTime());var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(n[a]=Aa(e[a]));return n}function Ui(e,n){for(var a="";a.length<n;)a+=e;return a}function Yo(e){var n=Number(e);if(!isNaN(n))return isFinite(n)?n:NaN;if(!/\d/.test(e))return n;var a=1,u=e.replace(/([\d]),([\d])/g,"$1$2").replace(/[$]/g,"").replace(/[%]/g,function(){return a*=100,""});return!isNaN(n=Number(u))||(u=u.replace(/[(](.*)[)]/,function(f,_){return a=-a,_}),!isNaN(n=Number(u)))?n/a:n}var KU=["january","february","march","april","may","june","july","august","september","october","november","december"];function op(e){var n=new Date(e),a=new Date(NaN),u=n.getYear(),f=n.getMonth(),_=n.getDate();if(isNaN(_))return a;var w=e.toLowerCase();if(w.match(/jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec/)){if(w=w.replace(/[^a-z]/g,"").replace(/([^a-z]|^)[ap]m?([^a-z]|$)/,""),w.length>3&&KU.indexOf(w)==-1)return a}else if(w.match(/[a-z]/))return a;return u<0||u>8099?a:(f>0||_>1)&&u!=101?n:e.match(/[^-0-9:,\/\\]/)?a:n}var JU=function(){var e="abacaba".split(/(:?b)/i).length==5;return function(a,u,f){if(e||typeof u=="string")return a.split(u);for(var _=a.split(u),w=[_[0]],T=1;T<_.length;++T)w.push(f),w.push(_[T]);return w}}();function fF(e){return e?e.content&&e.type?of(e.content,!0):e.data?Vm(e.data):e.asNodeBuffer&&zn?Vm(e.asNodeBuffer().toString("binary")):e.asBinary?Vm(e.asBinary()):e._data&&e._data.getContent?Vm(of(Array.prototype.slice.call(e._data.getContent(),0))):null:null}function dF(e){if(!e)return null;if(e.data)return LI(e.data);if(e.asNodeBuffer&&zn)return e.asNodeBuffer();if(e._data&&e._data.getContent){var n=e._data.getContent();return typeof n=="string"?LI(n):Array.prototype.slice.call(n)}return e.content&&e.type?e.content:null}function QU(e){return e&&e.name.slice(-4)===".bin"?dF(e):fF(e)}function io(e,n){for(var a=e.FullPaths||Pl(e.files),u=n.toLowerCase().replace(/[\/]/g,"\\"),f=u.replace(/\\/g,"/"),_=0;_<a.length;++_){var w=a[_].replace(/^Root Entry[\/]/,"").toLowerCase();if(u==w||f==w)return e.files?e.files[a[_]]:e.FileIndex[_]}return null}function DS(e,n){var a=io(e,n);if(a==null)throw new Error("Cannot find file "+n+" in zip");return a}function ta(e,n,a){if(!a)return QU(DS(e,n));if(!n)return null;try{return ta(e,n)}catch{return null}}function Vs(e,n,a){if(!a)return fF(DS(e,n));if(!n)return null;try{return Vs(e,n)}catch{return null}}function pF(e,n,a){if(!a)return dF(DS(e,n));if(!n)return null;try{return pF(e,n)}catch{return null}}function ZI(e){for(var n=e.FullPaths||Pl(e.files),a=[],u=0;u<n.length;++u)n[u].slice(-1)!="/"&&a.push(n[u].replace(/^Root Entry[\/]/,""));return a.sort()}function e7(e,n,a){if(e.FullPaths){if(typeof a=="string"){var u;return zn?u=ff(a):u=vU(a),$n.utils.cfb_add(e,n,u)}$n.utils.cfb_add(e,n,a)}else e.file(n,a)}function mF(e,n){switch(n.type){case"base64":return $n.read(e,{type:"base64"});case"binary":return $n.read(e,{type:"binary"});case"buffer":case"array":return $n.read(e,{type:"buffer"})}throw new Error("Unrecognized type "+n.type)}function jm(e,n){if(e.charAt(0)=="/")return e.slice(1);var a=n.split("/");n.slice(-1)!="/"&&a.pop();for(var u=e.split("/");u.length!==0;){var f=u.shift();f===".."?a.pop():f!=="."&&a.push(f)}return a.join("/")}var gF=`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\r
`,t7=/([^"\s?>\/]+)\s*=\s*((?:")([^"]*)(?:")|(?:')([^']*)(?:')|([^'">\s]+))/g,XI=/<[\/\?]?[a-zA-Z0-9:_-]+(?:\s+[^"\s?>\/]+\s*=\s*(?:"[^"]*"|'[^']*'|[^'">\s=]+))*\s*[\/\?]?>/mg,r7=/<[^>]*>/g,Za=gF.match(XI)?XI:r7,n7=/<\w*:/,i7=/<(\/?)\w+:/;function on(e,n,a){for(var u={},f=0,_=0;f!==e.length&&!((_=e.charCodeAt(f))===32||_===10||_===13);++f);if(n||(u[0]=e.slice(0,f)),f===e.length)return u;var w=e.match(t7),T=0,o="",k=0,R="",F="",B=1;if(w)for(k=0;k!=w.length;++k){for(F=w[k],_=0;_!=F.length&&F.charCodeAt(_)!==61;++_);for(R=F.slice(0,_).trim();F.charCodeAt(_+1)==32;)++_;for(B=(f=F.charCodeAt(_+1))==34||f==39?1:0,o=F.slice(_+1+B,F.length-B),T=0;T!=R.length&&R.charCodeAt(T)!==58;++T);if(T===R.length)R.indexOf("_")>0&&(R=R.slice(0,R.indexOf("_"))),u[R]=o,a||(u[R.toLowerCase()]=o);else{var V=(T===5&&R.slice(0,5)==="xmlns"?"xmlns":"")+R.slice(T+1);if(u[V]&&R.slice(T-3,T)=="ext")continue;u[V]=o,a||(u[V.toLowerCase()]=o)}}return u}function Fl(e){return e.replace(i7,"<$1")}var _F={"&quot;":'"',"&apos;":"'","&gt;":">","&lt;":"<","&amp;":"&"},a7=RS(_F),Zn=function(){var e=/&(?:quot|apos|gt|lt|amp|#x?([\da-fA-F]+));/ig,n=/_x([\da-fA-F]{4})_/ig;return function a(u){var f=u+"",_=f.indexOf("<![CDATA[");if(_==-1)return f.replace(e,function(T,o){return _F[T]||String.fromCharCode(parseInt(o,T.indexOf("x")>-1?16:10))||T}).replace(n,function(T,o){return String.fromCharCode(parseInt(o,16))});var w=f.indexOf("]]>");return a(f.slice(0,_))+f.slice(_+9,w)+a(f.slice(w+3))}}(),s7=/[&<>'"]/g,o7=/[\u0000-\u001f]/g;function FS(e){var n=e+"";return n.replace(s7,function(a){return a7[a]}).replace(/\n/g,"<br/>").replace(o7,function(a){return"&#x"+("000"+a.charCodeAt(0).toString(16)).slice(-4)+";"})}var YI=function(){var e=/&#(\d+);/g;function n(a,u){return String.fromCharCode(parseInt(u,10))}return function(u){return u.replace(e,n)}}();function Ci(e){switch(e){case 1:case!0:case"1":case"true":case"TRUE":return!0;default:return!1}}function Ob(e){for(var n="",a=0,u=0,f=0,_=0,w=0,T=0;a<e.length;){if(u=e.charCodeAt(a++),u<128){n+=String.fromCharCode(u);continue}if(f=e.charCodeAt(a++),u>191&&u<224){w=(u&31)<<6,w|=f&63,n+=String.fromCharCode(w);continue}if(_=e.charCodeAt(a++),u<240){n+=String.fromCharCode((u&15)<<12|(f&63)<<6|_&63);continue}w=e.charCodeAt(a++),T=((u&7)<<18|(f&63)<<12|(_&63)<<6|w&63)-65536,n+=String.fromCharCode(55296+(T>>>10&1023)),n+=String.fromCharCode(56320+(T&1023))}return n}function KI(e){var n=Nu(2*e.length),a,u,f=1,_=0,w=0,T;for(u=0;u<e.length;u+=f)f=1,(T=e.charCodeAt(u))<128?a=T:T<224?(a=(T&31)*64+(e.charCodeAt(u+1)&63),f=2):T<240?(a=(T&15)*4096+(e.charCodeAt(u+1)&63)*64+(e.charCodeAt(u+2)&63),f=3):(f=4,a=(T&7)*262144+(e.charCodeAt(u+1)&63)*4096+(e.charCodeAt(u+2)&63)*64+(e.charCodeAt(u+3)&63),a-=65536,w=55296+(a>>>10&1023),a=56320+(a&1023)),w!==0&&(n[_++]=w&255,n[_++]=w>>>8,w=0),n[_++]=a%256,n[_++]=a>>>8;return n.slice(0,_).toString("ucs2")}function JI(e){return ff(e,"binary").toString("utf8")}var my="foo bar bazâð£",gi=zn&&(JI(my)==Ob(my)&&JI||KI(my)==Ob(my)&&KI)||Ob,Gm=zn?function(e){return ff(e,"utf8").toString("binary")}:function(e){for(var n=[],a=0,u=0,f=0;a<e.length;)switch(u=e.charCodeAt(a++),!0){case u<128:n.push(String.fromCharCode(u));break;case u<2048:n.push(String.fromCharCode(192+(u>>6))),n.push(String.fromCharCode(128+(u&63)));break;case(u>=55296&&u<57344):u-=55296,f=e.charCodeAt(a++)-56320+(u<<10),n.push(String.fromCharCode(240+(f>>18&7))),n.push(String.fromCharCode(144+(f>>12&63))),n.push(String.fromCharCode(128+(f>>6&63))),n.push(String.fromCharCode(128+(f&63)));break;default:n.push(String.fromCharCode(224+(u>>12))),n.push(String.fromCharCode(128+(u>>6&63))),n.push(String.fromCharCode(128+(u&63)))}return n.join("")},Mg=function(){var e={};return function(a,u){var f=a+"|"+(u||"");return e[f]?e[f]:e[f]=new RegExp("<(?:\\w+:)?"+a+'(?: xml:space="preserve")?(?:[^>]*)>([\\s\\S]*?)</(?:\\w+:)?'+a+">",u||"")}}(),xF=function(){var e=[["nbsp"," "],["middot","·"],["quot",'"'],["apos","'"],["gt",">"],["lt","<"],["amp","&"]].map(function(n){return[new RegExp("&"+n[0]+";","ig"),n[1]]});return function(a){for(var u=a.replace(/^[\t\n\r ]+/,"").replace(/[\t\n\r ]+$/,"").replace(/>\s+/g,">").replace(/\s+</g,"<").replace(/[\t\n\r ]+/g," ").replace(/<\s*[bB][rR]\s*\/?>/g,`
`).replace(/<[^>]*>/g,""),f=0;f<e.length;++f)u=u.replace(e[f][0],e[f][1]);return u}}(),l7=function(){var e={};return function(a){return e[a]!==void 0?e[a]:e[a]=new RegExp("<(?:vt:)?"+a+">([\\s\\S]*?)</(?:vt:)?"+a+">","g")}}(),c7=/<\/?(?:vt:)?variant>/g,u7=/<(?:vt:)([^>]*)>([\s\S]*)</;function QI(e,n){var a=on(e),u=e.match(l7(a.baseType))||[],f=[];if(u.length!=a.size){if(n.WTF)throw new Error("unexpected vector length "+u.length+" != "+a.size);return f}return u.forEach(function(_){var w=_.replace(c7,"").match(u7);w&&f.push({v:gi(w[2]),t:w[1]})}),f}var h7=/(^\s|\s$|\n)/;function f7(e){return Pl(e).map(function(n){return" "+n+'="'+e[n]+'"'}).join("")}function d7(e,n,a){return"<"+e+(a!=null?f7(a):"")+(n!=null?(n.match(h7)?' xml:space="preserve"':"")+">"+n+"</"+e:"/")+">"}function LS(e){if(zn&&Buffer.isBuffer(e))return e.toString("utf8");if(typeof e=="string")return e;if(typeof Uint8Array<"u"&&e instanceof Uint8Array)return gi(df(MS(e)));throw new Error("Bad input format: expected Buffer or string")}var Ig=/<(\/?)([^\s?><!\/:]*:|)([^\s?<>:\/]+)(?:[\s?:\/][^>]*)?>/mg,p7={CORE_PROPS:"http://schemas.openxmlformats.org/package/2006/metadata/core-properties",CUST_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/custom-properties",EXT_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/extended-properties",CT:"http://schemas.openxmlformats.org/package/2006/content-types",RELS:"http://schemas.openxmlformats.org/package/2006/relationships",TCMNT:"http://schemas.microsoft.com/office/spreadsheetml/2018/threadedcomments",dc:"http://purl.org/dc/elements/1.1/",dcterms:"http://purl.org/dc/terms/",dcmitype:"http://purl.org/dc/dcmitype/",mx:"http://schemas.microsoft.com/office/mac/excel/2008/main",r:"http://schemas.openxmlformats.org/officeDocument/2006/relationships",sjs:"http://schemas.openxmlformats.org/package/2006/sheetjs/core-properties",vt:"http://schemas.openxmlformats.org/officeDocument/2006/docPropsVTypes",xsi:"http://www.w3.org/2001/XMLSchema-instance",xsd:"http://www.w3.org/2001/XMLSchema"},m7=["http://schemas.openxmlformats.org/spreadsheetml/2006/main","http://purl.oclc.org/ooxml/spreadsheetml/main","http://schemas.microsoft.com/office/excel/2006/main","http://schemas.microsoft.com/office/excel/2006/2"];function g7(e,n){for(var a=1-2*(e[n+7]>>>7),u=((e[n+7]&127)<<4)+(e[n+6]>>>4&15),f=e[n+6]&15,_=5;_>=0;--_)f=f*256+e[n+_];return u==2047?f==0?a*(1/0):NaN:(u==0?u=-1022:(u-=1023,f+=Math.pow(2,52)),a*Math.pow(2,u-52)*f)}function _7(e,n,a){var u=(n<0||1/n==-1/0?1:0)<<7,f=0,_=0,w=u?-n:n;isFinite(w)?w==0?f=_=0:(f=Math.floor(Math.log(w)/Math.LN2),_=w*Math.pow(2,52-f),f<=-1023&&(!isFinite(_)||_<Math.pow(2,52))?f=-1022:(_-=Math.pow(2,52),f+=1023)):(f=2047,_=isNaN(n)?26985:0);for(var T=0;T<=5;++T,_/=256)e[a+T]=_&255;e[a+6]=(f&15)<<4|_&15,e[a+7]=f>>4|u}var eP=function(e){for(var n=[],a=10240,u=0;u<e[0].length;++u)if(e[0][u])for(var f=0,_=e[0][u].length;f<_;f+=a)n.push.apply(n,e[0][u].slice(f,f+a));return n},tP=zn?function(e){return e[0].length>0&&Buffer.isBuffer(e[0][0])?Buffer.concat(e[0].map(function(n){return Buffer.isBuffer(n)?n:ff(n)})):eP(e)}:eP,rP=function(e,n,a){for(var u=[],f=n;f<a;f+=2)u.push(String.fromCharCode(hc(e,f)));return u.join("").replace(is,"")},OS=zn?function(e,n,a){return Buffer.isBuffer(e)?e.toString("utf16le",n,a).replace(is,""):rP(e,n,a)}:rP,nP=function(e,n,a){for(var u=[],f=n;f<n+a;++f)u.push(("0"+e[f].toString(16)).slice(-2));return u.join("")},yF=zn?function(e,n,a){return Buffer.isBuffer(e)?e.toString("hex",n,n+a):nP(e,n,a)}:nP,iP=function(e,n,a){for(var u=[],f=n;f<a;f++)u.push(String.fromCharCode(Md(e,f)));return u.join("")},qg=zn?function(n,a,u){return Buffer.isBuffer(n)?n.toString("utf8",a,u):iP(n,a,u)}:iP,vF=function(e,n){var a=Bs(e,n);return a>0?qg(e,n+4,n+4+a-1):""},wF=vF,bF=function(e,n){var a=Bs(e,n);return a>0?qg(e,n+4,n+4+a-1):""},TF=bF,EF=function(e,n){var a=2*Bs(e,n);return a>0?qg(e,n+4,n+4+a-1):""},SF=EF,AF=function(n,a){var u=Bs(n,a);return u>0?OS(n,a+4,a+4+u):""},CF=AF,kF=function(e,n){var a=Bs(e,n);return a>0?qg(e,n+4,n+4+a):""},MF=kF,IF=function(e,n){return g7(e,n)},M1=IF,PF=function(n){return Array.isArray(n)||typeof Uint8Array<"u"&&n instanceof Uint8Array};zn&&(wF=function(n,a){if(!Buffer.isBuffer(n))return vF(n,a);var u=n.readUInt32LE(a);return u>0?n.toString("utf8",a+4,a+4+u-1):""},TF=function(n,a){if(!Buffer.isBuffer(n))return bF(n,a);var u=n.readUInt32LE(a);return u>0?n.toString("utf8",a+4,a+4+u-1):""},SF=function(n,a){if(!Buffer.isBuffer(n))return EF(n,a);var u=2*n.readUInt32LE(a);return n.toString("utf16le",a+4,a+4+u-1)},CF=function(n,a){if(!Buffer.isBuffer(n))return AF(n,a);var u=n.readUInt32LE(a);return n.toString("utf16le",a+4,a+4+u)},MF=function(n,a){if(!Buffer.isBuffer(n))return kF(n,a);var u=n.readUInt32LE(a);return n.toString("utf8",a+4,a+4+u)},M1=function(n,a){return Buffer.isBuffer(n)?n.readDoubleLE(a):IF(n,a)},PF=function(n){return Buffer.isBuffer(n)||Array.isArray(n)||typeof Uint8Array<"u"&&n instanceof Uint8Array});var Md=function(e,n){return e[n]},hc=function(e,n){return e[n+1]*256+e[n]},x7=function(e,n){var a=e[n+1]*256+e[n];return a<32768?a:(65535-a+1)*-1},Bs=function(e,n){return e[n+3]*(1<<24)+(e[n+2]<<16)+(e[n+1]<<8)+e[n]},Gh=function(e,n){return e[n+3]<<24|e[n+2]<<16|e[n+1]<<8|e[n]},y7=function(e,n){return e[n]<<24|e[n+1]<<16|e[n+2]<<8|e[n+3]};function rg(e,n){var a="",u,f,_=[],w,T,o,k;switch(n){case"dbcs":if(k=this.l,zn&&Buffer.isBuffer(this))a=this.slice(this.l,this.l+2*e).toString("utf16le");else for(o=0;o<e;++o)a+=String.fromCharCode(hc(this,k)),k+=2;e*=2;break;case"utf8":a=qg(this,this.l,this.l+e);break;case"utf16le":e*=2,a=OS(this,this.l,this.l+e);break;case"wstr":return rg.call(this,e,"dbcs");case"lpstr-ansi":a=wF(this,this.l),e=4+Bs(this,this.l);break;case"lpstr-cp":a=TF(this,this.l),e=4+Bs(this,this.l);break;case"lpwstr":a=SF(this,this.l),e=4+2*Bs(this,this.l);break;case"lpp4":e=4+Bs(this,this.l),a=CF(this,this.l),e&2&&(e+=2);break;case"8lpp4":e=4+Bs(this,this.l),a=MF(this,this.l),e&3&&(e+=4-(e&3));break;case"cstr":for(e=0,a="";(w=Md(this,this.l+e++))!==0;)_.push(py(w));a=_.join("");break;case"_wstr":for(e=0,a="";(w=hc(this,this.l+e))!==0;)_.push(py(w)),e+=2;e+=2,a=_.join("");break;case"dbcs-cont":for(a="",k=this.l,o=0;o<e;++o){if(this.lens&&this.lens.indexOf(k)!==-1)return w=Md(this,k),this.l=k+1,T=rg.call(this,e-o,w?"dbcs-cont":"sbcs-cont"),_.join("")+T;_.push(py(hc(this,k))),k+=2}a=_.join(""),e*=2;break;case"cpstr":case"sbcs-cont":for(a="",k=this.l,o=0;o!=e;++o){if(this.lens&&this.lens.indexOf(k)!==-1)return w=Md(this,k),this.l=k+1,T=rg.call(this,e-o,w?"dbcs-cont":"sbcs-cont"),_.join("")+T;_.push(py(Md(this,k))),k+=1}a=_.join("");break;default:switch(e){case 1:return u=Md(this,this.l),this.l++,u;case 2:return u=(n==="i"?x7:hc)(this,this.l),this.l+=2,u;case 4:case-4:return n==="i"||!(this[this.l+3]&128)?(u=(e>0?Gh:y7)(this,this.l),this.l+=4,u):(f=Bs(this,this.l),this.l+=4,f);case 8:case-8:if(n==="f")return e==8?f=M1(this,this.l):f=M1([this[this.l+7],this[this.l+6],this[this.l+5],this[this.l+4],this[this.l+3],this[this.l+2],this[this.l+1],this[this.l+0]],0),this.l+=8,f;e=8;case 16:a=yF(this,this.l,e);break}}return this.l+=e,a}var v7=function(e,n,a){e[a]=n&255,e[a+1]=n>>>8&255,e[a+2]=n>>>16&255,e[a+3]=n>>>24&255},w7=function(e,n,a){e[a]=n&255,e[a+1]=n>>8&255,e[a+2]=n>>16&255,e[a+3]=n>>24&255},b7=function(e,n,a){e[a]=n&255,e[a+1]=n>>>8&255};function T7(e,n,a){var u=0,f=0;if(a==="dbcs"){for(f=0;f!=n.length;++f)b7(this,n.charCodeAt(f),this.l+2*f);u=2*n.length}else if(a==="sbcs"){for(n=n.replace(/[^\x00-\x7F]/g,"_"),f=0;f!=n.length;++f)this[this.l+f]=n.charCodeAt(f)&255;u=n.length}else if(a==="hex"){for(;f<e;++f)this[this.l++]=parseInt(n.slice(2*f,2*f+2),16)||0;return this}else if(a==="utf16le"){var _=Math.min(this.l+e,this.length);for(f=0;f<Math.min(n.length,e);++f){var w=n.charCodeAt(f);this[this.l++]=w&255,this[this.l++]=w>>8}for(;this.l<_;)this[this.l++]=0;return this}else switch(e){case 1:u=1,this[this.l]=n&255;break;case 2:u=2,this[this.l]=n&255,n>>>=8,this[this.l+1]=n&255;break;case 3:u=3,this[this.l]=n&255,n>>>=8,this[this.l+1]=n&255,n>>>=8,this[this.l+2]=n&255;break;case 4:u=4,v7(this,n,this.l);break;case 8:if(u=8,a==="f"){_7(this,n,this.l);break}case 16:break;case-4:u=4,w7(this,n,this.l);break}return this.l+=u,this}function RF(e,n){var a=yF(this,this.l,e.length>>1);if(a!==e)throw new Error(n+"Expected "+e+" saw "+a);this.l+=e.length>>1}function Ea(e,n){e.l=n,e.read_shift=rg,e.chk=RF,e.write_shift=T7}function qa(e,n){e.l+=n}function sa(e){var n=Nu(e);return Ea(n,0),n}function Sc(e,n,a){if(e){var u,f,_;Ea(e,e.l||0);for(var w=e.length,T=0,o=0;e.l<w;){T=e.read_shift(1),T&128&&(T=(T&127)+((e.read_shift(1)&127)<<7));var k=L1[T]||L1[65535];for(u=e.read_shift(1),_=u&127,f=1;f<4&&u&128;++f)_+=((u=e.read_shift(1))&127)<<7*f;o=e.l+_;var R=k.f&&k.f(e,_,a);if(e.l=o,n(R,k,T))return}}}function tE(){var e=[],n=zn?256:2048,a=function(k){var R=sa(k);return Ea(R,0),R},u=a(n),f=function(){u&&(u.length>u.l&&(u=u.slice(0,u.l),u.l=u.length),u.length>0&&e.push(u),u=null)},_=function(k){return u&&k<u.length-u.l?u:(f(),u=a(Math.max(k+1,n)))},w=function(){return f(),wu(e)},T=function(k){f(),u=k,u.l==null&&(u.l=u.length),_(n)};return{next:_,push:T,end:w,_bufs:e}}function ng(e,n,a){var u=Aa(e);if(n.s?(u.cRel&&(u.c+=n.s.c),u.rRel&&(u.r+=n.s.r)):(u.cRel&&(u.c+=n.c),u.rRel&&(u.r+=n.r)),!a||a.biff<12){for(;u.c>=256;)u.c-=256;for(;u.r>=65536;)u.r-=65536}return u}function aP(e,n,a){var u=Aa(e);return u.s=ng(u.s,n.s,a),u.e=ng(u.e,n.s,a),u}function ig(e,n){if(e.cRel&&e.c<0)for(e=Aa(e);e.c<0;)e.c+=n>8?16384:256;if(e.rRel&&e.r<0)for(e=Aa(e);e.r<0;)e.r+=n>8?1048576:n>5?65536:16384;var a=yn(e);return!e.cRel&&e.cRel!=null&&(a=A7(a)),!e.rRel&&e.rRel!=null&&(a=E7(a)),a}function Nb(e,n){return e.s.r==0&&!e.s.rRel&&e.e.r==(n.biff>=12?1048575:n.biff>=8?65536:16384)&&!e.e.rRel?(e.s.cRel?"":"$")+ca(e.s.c)+":"+(e.e.cRel?"":"$")+ca(e.e.c):e.s.c==0&&!e.s.cRel&&e.e.c==(n.biff>=12?16383:255)&&!e.e.cRel?(e.s.rRel?"":"$")+Ca(e.s.r)+":"+(e.e.rRel?"":"$")+Ca(e.e.r):ig(e.s,n.biff)+":"+ig(e.e,n.biff)}function NS(e){return parseInt(S7(e),10)-1}function Ca(e){return""+(e+1)}function E7(e){return e.replace(/([A-Z]|^)(\d+)$/,"$1$$$2")}function S7(e){return e.replace(/\$(\d+)$/,"$1")}function zS(e){for(var n=C7(e),a=0,u=0;u!==n.length;++u)a=26*a+n.charCodeAt(u)-64;return a-1}function ca(e){if(e<0)throw new Error("invalid column "+e);var n="";for(++e;e;e=Math.floor((e-1)/26))n=String.fromCharCode((e-1)%26+65)+n;return n}function A7(e){return e.replace(/^([A-Z])/,"$$$1")}function C7(e){return e.replace(/^\$([A-Z])/,"$1")}function k7(e){return e.replace(/(\$?[A-Z]*)(\$?\d*)/,"$1,$2").split(",")}function rs(e){for(var n=0,a=0,u=0;u<e.length;++u){var f=e.charCodeAt(u);f>=48&&f<=57?n=10*n+(f-48):f>=65&&f<=90&&(a=26*a+(f-64))}return{c:a-1,r:n-1}}function yn(e){for(var n=e.c+1,a="";n;n=(n-1)/26|0)a=String.fromCharCode((n-1)%26+65)+a;return a+(e.r+1)}function _p(e){var n=e.indexOf(":");return n==-1?{s:rs(e),e:rs(e)}:{s:rs(e.slice(0,n)),e:rs(e.slice(n+1))}}function jn(e,n){return typeof n>"u"||typeof n=="number"?jn(e.s,e.e):(typeof e!="string"&&(e=yn(e)),typeof n!="string"&&(n=yn(n)),e==n?e:e+":"+n)}function Vi(e){var n={s:{c:0,r:0},e:{c:0,r:0}},a=0,u=0,f=0,_=e.length;for(a=0;u<_&&!((f=e.charCodeAt(u)-64)<1||f>26);++u)a=26*a+f;for(n.s.c=--a,a=0;u<_&&!((f=e.charCodeAt(u)-48)<0||f>9);++u)a=10*a+f;if(n.s.r=--a,u===_||f!=10)return n.e.c=n.s.c,n.e.r=n.s.r,n;for(++u,a=0;u!=_&&!((f=e.charCodeAt(u)-64)<1||f>26);++u)a=26*a+f;for(n.e.c=--a,a=0;u!=_&&!((f=e.charCodeAt(u)-48)<0||f>9);++u)a=10*a+f;return n.e.r=--a,n}function sP(e,n){var a=e.t=="d"&&n instanceof Date;if(e.z!=null)try{return e.w=fo(e.z,a?as(n):n)}catch{}try{return e.w=fo((e.XF||{}).numFmtId||(a?14:0),a?as(n):n)}catch{return""+n}}function vc(e,n,a){return e==null||e.t==null||e.t=="z"?"":e.w!==void 0?e.w:(e.t=="d"&&!e.z&&a&&a.dateNF&&(e.z=a.dateNF),e.t=="e"?gf[e.v]||e.v:n==null?sP(e,e.v):sP(e,n))}function Hu(e,n){var a=n&&n.sheet?n.sheet:"Sheet1",u={};return u[a]=e,{SheetNames:[a],Sheets:u}}function DF(e,n,a){var u=a||{},f=e?Array.isArray(e):u.dense,_=e||(f?[]:{}),w=0,T=0;if(_&&u.origin!=null){if(typeof u.origin=="number")w=u.origin;else{var o=typeof u.origin=="string"?rs(u.origin):u.origin;w=o.r,T=o.c}_["!ref"]||(_["!ref"]="A1:A1")}var k={s:{c:1e7,r:1e7},e:{c:0,r:0}};if(_["!ref"]){var R=Vi(_["!ref"]);k.s.c=R.s.c,k.s.r=R.s.r,k.e.c=Math.max(k.e.c,R.e.c),k.e.r=Math.max(k.e.r,R.e.r),w==-1&&(k.e.r=w=R.e.r+1)}for(var F=0;F!=n.length;++F)if(n[F]){if(!Array.isArray(n[F]))throw new Error("aoa_to_sheet expects an array of arrays");for(var B=0;B!=n[F].length;++B)if(!(typeof n[F][B]>"u")){var V={v:n[F][B]},G=w+F,U=T+B;if(k.s.r>G&&(k.s.r=G),k.s.c>U&&(k.s.c=U),k.e.r<G&&(k.e.r=G),k.e.c<U&&(k.e.c=U),n[F][B]&&typeof n[F][B]=="object"&&!Array.isArray(n[F][B])&&!(n[F][B]instanceof Date))V=n[F][B];else if(Array.isArray(V.v)&&(V.f=n[F][B][1],V.v=V.v[0]),V.v===null)if(V.f)V.t="n";else if(u.nullError)V.t="e",V.v=0;else if(u.sheetStubs)V.t="z";else continue;else typeof V.v=="number"?V.t="n":typeof V.v=="boolean"?V.t="b":V.v instanceof Date?(V.z=u.dateNF||Tn[14],u.cellDates?(V.t="d",V.w=fo(V.z,as(V.v))):(V.t="n",V.v=as(V.v),V.w=fo(V.z,V.v))):V.t="s";if(f)_[G]||(_[G]=[]),_[G][U]&&_[G][U].z&&(V.z=_[G][U].z),_[G][U]=V;else{var J=yn({c:U,r:G});_[J]&&_[J].z&&(V.z=_[J].z),_[J]=V}}}return k.s.c<1e7&&(_["!ref"]=jn(k)),_}function xp(e,n){return DF(null,e,n)}function M7(e){return e.read_shift(4,"i")}function Ha(e){var n=e.read_shift(4);return n===0?"":e.read_shift(n,"dbcs")}function I7(e){return{ich:e.read_shift(2),ifnt:e.read_shift(2)}}function BS(e,n){var a=e.l,u=e.read_shift(1),f=Ha(e),_=[],w={t:f,h:f};if(u&1){for(var T=e.read_shift(4),o=0;o!=T;++o)_.push(I7(e));w.r=_}else w.r=[{ich:0,ifnt:0}];return e.l=a+n,w}var P7=BS;function go(e){var n=e.read_shift(4),a=e.read_shift(2);return a+=e.read_shift(1)<<16,e.l++,{c:n,iStyleRef:a}}function pf(e){var n=e.read_shift(2);return n+=e.read_shift(1)<<16,e.l++,{c:-1,iStyleRef:n}}var R7=Ha;function US(e){var n=e.read_shift(4);return n===0||n===4294967295?"":e.read_shift(n,"dbcs")}var D7=Ha,rE=US;function VS(e){var n=e.slice(e.l,e.l+4),a=n[0]&1,u=n[0]&2;e.l+=4;var f=u===0?M1([0,0,0,0,n[0]&252,n[1],n[2],n[3]],0):Gh(n,0)>>2;return a?f/100:f}function FF(e){var n={s:{},e:{}};return n.s.r=e.read_shift(4),n.e.r=e.read_shift(4),n.s.c=e.read_shift(4),n.e.c=e.read_shift(4),n}var mf=FF;function ja(e){if(e.length-e.l<8)throw"XLS Xnum Buffer underflow";return e.read_shift(8,"f")}function F7(e){var n={},a=e.read_shift(1),u=a>>>1,f=e.read_shift(1),_=e.read_shift(2,"i"),w=e.read_shift(1),T=e.read_shift(1),o=e.read_shift(1);switch(e.l++,u){case 0:n.auto=1;break;case 1:n.index=f;var k=Qh[f];k&&(n.rgb=Rg(k));break;case 2:n.rgb=Rg([w,T,o]);break;case 3:n.theme=f;break}return _!=0&&(n.tint=_>0?_/32767:_/32768),n}function L7(e){var n=e.read_shift(1);e.l++;var a={fBold:n&1,fItalic:n&2,fUnderline:n&4,fStrikeout:n&8,fOutline:n&16,fShadow:n&32,fCondense:n&64,fExtend:n&128};return a}function LF(e,n){var a={2:"BITMAP",3:"METAFILEPICT",8:"DIB",14:"ENHMETAFILE"},u=e.read_shift(4);switch(u){case 0:return"";case 4294967295:case 4294967294:return a[e.read_shift(4)]||""}if(u>400)throw new Error("Unsupported Clipboard: "+u.toString(16));return e.l-=4,e.read_shift(0,n==1?"lpstr":"lpwstr")}function O7(e){return LF(e,1)}function N7(e){return LF(e,2)}var $S=2,xs=3,gy=11,oP=12,I1=19,_y=64,z7=65,B7=71,U7=4108,V7=4126,pa=80,OF=81,$7=[pa,OF],j7={1:{n:"CodePage",t:$S},2:{n:"Category",t:pa},3:{n:"PresentationFormat",t:pa},4:{n:"ByteCount",t:xs},5:{n:"LineCount",t:xs},6:{n:"ParagraphCount",t:xs},7:{n:"SlideCount",t:xs},8:{n:"NoteCount",t:xs},9:{n:"HiddenCount",t:xs},10:{n:"MultimediaClipCount",t:xs},11:{n:"ScaleCrop",t:gy},12:{n:"HeadingPairs",t:U7},13:{n:"TitlesOfParts",t:V7},14:{n:"Manager",t:pa},15:{n:"Company",t:pa},16:{n:"LinksUpToDate",t:gy},17:{n:"CharacterCount",t:xs},19:{n:"SharedDoc",t:gy},22:{n:"HyperlinksChanged",t:gy},23:{n:"AppVersion",t:xs,p:"version"},24:{n:"DigSig",t:z7},26:{n:"ContentType",t:pa},27:{n:"ContentStatus",t:pa},28:{n:"Language",t:pa},29:{n:"Version",t:pa},255:{},2147483648:{n:"Locale",t:I1},2147483651:{n:"Behavior",t:I1},1919054434:{}},G7={1:{n:"CodePage",t:$S},2:{n:"Title",t:pa},3:{n:"Subject",t:pa},4:{n:"Author",t:pa},5:{n:"Keywords",t:pa},6:{n:"Comments",t:pa},7:{n:"Template",t:pa},8:{n:"LastAuthor",t:pa},9:{n:"RevNumber",t:pa},10:{n:"EditTime",t:_y},11:{n:"LastPrinted",t:_y},12:{n:"CreatedDate",t:_y},13:{n:"ModifiedDate",t:_y},14:{n:"PageCount",t:xs},15:{n:"WordCount",t:xs},16:{n:"CharCount",t:xs},17:{n:"Thumbnail",t:B7},18:{n:"Application",t:pa},19:{n:"DocSecurity",t:xs},255:{},2147483648:{n:"Locale",t:I1},2147483651:{n:"Behavior",t:I1},1919054434:{}},lP={1:"US",2:"CA",3:"",7:"RU",20:"EG",30:"GR",31:"NL",32:"BE",33:"FR",34:"ES",36:"HU",39:"IT",41:"CH",43:"AT",44:"GB",45:"DK",46:"SE",47:"NO",48:"PL",49:"DE",52:"MX",55:"BR",61:"AU",64:"NZ",66:"TH",81:"JP",82:"KR",84:"VN",86:"CN",90:"TR",105:"JS",213:"DZ",216:"MA",218:"LY",351:"PT",354:"IS",358:"FI",420:"CZ",886:"TW",961:"LB",962:"JO",963:"SY",964:"IQ",965:"KW",966:"SA",971:"AE",972:"IL",974:"QA",981:"IR",65535:"US"},H7=[null,"solid","mediumGray","darkGray","lightGray","darkHorizontal","darkVertical","darkDown","darkUp","darkGrid","darkTrellis","lightHorizontal","lightVertical","lightDown","lightUp","lightGrid","lightTrellis","gray125","gray0625"];function W7(e){return e.map(function(n){return[n>>16&255,n>>8&255,n&255]})}var q7=W7([0,16777215,16711680,65280,255,16776960,16711935,65535,0,16777215,16711680,65280,255,16776960,16711935,65535,8388608,32768,128,8421376,8388736,32896,12632256,8421504,10066431,10040166,16777164,13434879,6684774,16744576,26316,13421823,128,16711935,16776960,65535,8388736,8388608,32896,255,52479,13434879,13434828,16777113,10079487,16751052,13408767,16764057,3368703,3394764,10079232,16763904,16750848,16737792,6710937,9868950,13158,3381606,13056,3355392,10040064,10040166,3355545,3355443,16777215,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Qh=Aa(q7),gf={0:"#NULL!",7:"#DIV/0!",15:"#VALUE!",23:"#REF!",29:"#NAME?",36:"#NUM!",42:"#N/A",43:"#GETTING_DATA",255:"#WTF?"},NF={"#NULL!":0,"#DIV/0!":7,"#VALUE!":15,"#REF!":23,"#NAME?":29,"#NUM!":36,"#N/A":42,"#GETTING_DATA":43,"#WTF?":255},cP={"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml":"workbooks","application/vnd.ms-excel.sheet.macroEnabled.main+xml":"workbooks","application/vnd.ms-excel.sheet.binary.macroEnabled.main":"workbooks","application/vnd.ms-excel.addin.macroEnabled.main+xml":"workbooks","application/vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml":"workbooks","application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml":"sheets","application/vnd.ms-excel.worksheet":"sheets","application/vnd.ms-excel.binIndexWs":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml":"charts","application/vnd.ms-excel.chartsheet":"charts","application/vnd.ms-excel.macrosheet+xml":"macros","application/vnd.ms-excel.macrosheet":"macros","application/vnd.ms-excel.intlmacrosheet":"TODO","application/vnd.ms-excel.binIndexMs":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml":"dialogs","application/vnd.ms-excel.dialogsheet":"dialogs","application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml":"strs","application/vnd.ms-excel.sharedStrings":"strs","application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml":"styles","application/vnd.ms-excel.styles":"styles","application/vnd.openxmlformats-package.core-properties+xml":"coreprops","application/vnd.openxmlformats-officedocument.custom-properties+xml":"custprops","application/vnd.openxmlformats-officedocument.extended-properties+xml":"extprops","application/vnd.openxmlformats-officedocument.customXmlProperties+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.customProperty":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml":"comments","application/vnd.ms-excel.comments":"comments","application/vnd.ms-excel.threadedcomments+xml":"threadedcomments","application/vnd.ms-excel.person+xml":"people","application/vnd.openxmlformats-officedocument.spreadsheetml.sheetMetadata+xml":"metadata","application/vnd.ms-excel.sheetMetadata":"metadata","application/vnd.ms-excel.pivotTable":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotTable+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.chart+xml":"TODO","application/vnd.ms-office.chartcolorstyle+xml":"TODO","application/vnd.ms-office.chartstyle+xml":"TODO","application/vnd.ms-office.chartex+xml":"TODO","application/vnd.ms-excel.calcChain":"calcchains","application/vnd.openxmlformats-officedocument.spreadsheetml.calcChain+xml":"calcchains","application/vnd.openxmlformats-officedocument.spreadsheetml.printerSettings":"TODO","application/vnd.ms-office.activeX":"TODO","application/vnd.ms-office.activeX+xml":"TODO","application/vnd.ms-excel.attachedToolbars":"TODO","application/vnd.ms-excel.connections":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.connections+xml":"TODO","application/vnd.ms-excel.externalLink":"links","application/vnd.openxmlformats-officedocument.spreadsheetml.externalLink+xml":"links","application/vnd.ms-excel.pivotCacheDefinition":"TODO","application/vnd.ms-excel.pivotCacheRecords":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotCacheDefinition+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotCacheRecords+xml":"TODO","application/vnd.ms-excel.queryTable":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.queryTable+xml":"TODO","application/vnd.ms-excel.userNames":"TODO","application/vnd.ms-excel.revisionHeaders":"TODO","application/vnd.ms-excel.revisionLog":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.revisionHeaders+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.revisionLog+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.userNames+xml":"TODO","application/vnd.ms-excel.tableSingleCells":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.tableSingleCells+xml":"TODO","application/vnd.ms-excel.slicer":"TODO","application/vnd.ms-excel.slicerCache":"TODO","application/vnd.ms-excel.slicer+xml":"TODO","application/vnd.ms-excel.slicerCache+xml":"TODO","application/vnd.ms-excel.wsSortMap":"TODO","application/vnd.ms-excel.table":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.table+xml":"TODO","application/vnd.openxmlformats-officedocument.theme+xml":"themes","application/vnd.openxmlformats-officedocument.themeOverride+xml":"TODO","application/vnd.ms-excel.Timeline+xml":"TODO","application/vnd.ms-excel.TimelineCache+xml":"TODO","application/vnd.ms-office.vbaProject":"vba","application/vnd.ms-office.vbaProjectSignature":"TODO","application/vnd.ms-office.volatileDependencies":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.volatileDependencies+xml":"TODO","application/vnd.ms-excel.controlproperties+xml":"TODO","application/vnd.openxmlformats-officedocument.model+data":"TODO","application/vnd.ms-excel.Survey+xml":"TODO","application/vnd.openxmlformats-officedocument.drawing+xml":"drawings","application/vnd.openxmlformats-officedocument.drawingml.chartshapes+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramColors+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramData+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramLayout+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramStyle+xml":"TODO","application/vnd.openxmlformats-officedocument.vmlDrawing":"TODO","application/vnd.openxmlformats-package.relationships+xml":"rels","application/vnd.openxmlformats-officedocument.oleObject":"TODO","image/png":"TODO",sheet:"js"};function Z7(){return{workbooks:[],sheets:[],charts:[],dialogs:[],macros:[],rels:[],strs:[],comments:[],threadedcomments:[],links:[],coreprops:[],extprops:[],custprops:[],themes:[],styles:[],calcchains:[],vba:[],drawings:[],metadata:[],people:[],TODO:[],xmlns:""}}function X7(e){var n=Z7();if(!e||!e.match)return n;var a={};if((e.match(Za)||[]).forEach(function(u){var f=on(u);switch(f[0].replace(n7,"<")){case"<?xml":break;case"<Types":n.xmlns=f["xmlns"+(f[0].match(/<(\w+):/)||["",""])[1]];break;case"<Default":a[f.Extension]=f.ContentType;break;case"<Override":n[cP[f.ContentType]]!==void 0&&n[cP[f.ContentType]].push(f.PartName);break}}),n.xmlns!==p7.CT)throw new Error("Unknown Namespace: "+n.xmlns);return n.calcchain=n.calcchains.length>0?n.calcchains[0]:"",n.sst=n.strs.length>0?n.strs[0]:"",n.style=n.styles.length>0?n.styles[0]:"",n.defaults=a,delete n.calcchains,n}var $d={WB:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument",SHEET:"http://sheetjs.openxmlformats.org/officeDocument/2006/relationships/officeDocument",HLINK:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/hyperlink",VML:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/vmlDrawing",XPATH:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/externalLinkPath",XMISS:"http://schemas.microsoft.com/office/2006/relationships/xlExternalLinkPath/xlPathMissing",XLINK:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/externalLink",CXML:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/customXml",CXMLP:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/customXmlProps",CMNT:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/comments",CORE_PROPS:"http://schemas.openxmlformats.org/package/2006/relationships/metadata/core-properties",EXT_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/extended-properties",CUST_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/custom-properties",SST:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sharedStrings",STY:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles",THEME:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/theme",CHART:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/chart",CHARTEX:"http://schemas.microsoft.com/office/2014/relationships/chartEx",CS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/chartsheet",WS:["http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet","http://purl.oclc.org/ooxml/officeDocument/relationships/worksheet"],DS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/dialogsheet",MS:"http://schemas.microsoft.com/office/2006/relationships/xlMacrosheet",IMG:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/image",DRAW:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/drawing",XLMETA:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sheetMetadata",TCMNT:"http://schemas.microsoft.com/office/2017/10/relationships/threadedComment",PEOPLE:"http://schemas.microsoft.com/office/2017/10/relationships/person",VBA:"http://schemas.microsoft.com/office/2006/relationships/vbaProject"};function nE(e){var n=e.lastIndexOf("/");return e.slice(0,n+1)+"_rels/"+e.slice(n+1)+".rels"}function ag(e,n){var a={"!id":{}};if(!e)return a;n.charAt(0)!=="/"&&(n="/"+n);var u={};return(e.match(Za)||[]).forEach(function(f){var _=on(f);if(_[0]==="<Relationship"){var w={};w.Type=_.Type,w.Target=_.Target,w.Id=_.Id,_.TargetMode&&(w.TargetMode=_.TargetMode);var T=_.TargetMode==="External"?_.Target:jm(_.Target,n);a[T]=w,u[_.Id]=w}}),a["!id"]=u,a}var Y7="application/vnd.oasis.opendocument.spreadsheet";function K7(e,n){for(var a=LS(e),u,f;u=Ig.exec(a);)switch(u[3]){case"manifest":break;case"file-entry":if(f=on(u[0],!1),f.path=="/"&&f.type!==Y7)throw new Error("This OpenDocument is not a spreadsheet");break;case"encryption-data":case"algorithm":case"start-key-generation":case"key-derivation":throw new Error("Unsupported ODS Encryption");default:if(n&&n.WTF)throw u}}var sg=[["cp:category","Category"],["cp:contentStatus","ContentStatus"],["cp:keywords","Keywords"],["cp:lastModifiedBy","LastAuthor"],["cp:lastPrinted","LastPrinted"],["cp:revision","RevNumber"],["cp:version","Version"],["dc:creator","Author"],["dc:description","Comments"],["dc:identifier","Identifier"],["dc:language","Language"],["dc:subject","Subject"],["dc:title","Title"],["dcterms:created","CreatedDate","date"],["dcterms:modified","ModifiedDate","date"]],J7=function(){for(var e=new Array(sg.length),n=0;n<sg.length;++n){var a=sg[n],u="(?:"+a[0].slice(0,a[0].indexOf(":"))+":)"+a[0].slice(a[0].indexOf(":")+1);e[n]=new RegExp("<"+u+"[^>]*>([\\s\\S]*?)</"+u+">")}return e}();function zF(e){var n={};e=gi(e);for(var a=0;a<sg.length;++a){var u=sg[a],f=e.match(J7[a]);f!=null&&f.length>0&&(n[u[1]]=Zn(f[1])),u[2]==="date"&&n[u[1]]&&(n[u[1]]=_a(n[u[1]]))}return n}var Q7=[["Application","Application","string"],["AppVersion","AppVersion","string"],["Company","Company","string"],["DocSecurity","DocSecurity","string"],["Manager","Manager","string"],["HyperlinksChanged","HyperlinksChanged","bool"],["SharedDoc","SharedDoc","bool"],["LinksUpToDate","LinksUpToDate","bool"],["ScaleCrop","ScaleCrop","bool"],["HeadingPairs","HeadingPairs","raw"],["TitlesOfParts","TitlesOfParts","raw"]];function BF(e,n,a,u){var f=[];if(typeof e=="string")f=QI(e,u);else for(var _=0;_<e.length;++_)f=f.concat(e[_].map(function(R){return{v:R}}));var w=typeof n=="string"?QI(n,u).map(function(R){return R.v}):n,T=0,o=0;if(w.length>0)for(var k=0;k!==f.length;k+=2){switch(o=+f[k+1].v,f[k].v){case"Worksheets":case"工作表":case"Листы":case"أوراق العمل":case"ワークシート":case"גליונות עבודה":case"Arbeitsblätter":case"Çalışma Sayfaları":case"Feuilles de calcul":case"Fogli di lavoro":case"Folhas de cálculo":case"Planilhas":case"Regneark":case"Hojas de cálculo":case"Werkbladen":a.Worksheets=o,a.SheetNames=w.slice(T,T+o);break;case"Named Ranges":case"Rangos con nombre":case"名前付き一覧":case"Benannte Bereiche":case"Navngivne områder":a.NamedRanges=o,a.DefinedNames=w.slice(T,T+o);break;case"Charts":case"Diagramme":a.Chartsheets=o,a.ChartNames=w.slice(T,T+o);break}T+=o}}function e9(e,n,a){var u={};return n||(n={}),e=gi(e),Q7.forEach(function(f){var _=(e.match(Mg(f[0]))||[])[1];switch(f[2]){case"string":_&&(n[f[1]]=Zn(_));break;case"bool":n[f[1]]=_==="true";break;case"raw":var w=e.match(new RegExp("<"+f[0]+"[^>]*>([\\s\\S]*?)</"+f[0]+">"));w&&w.length>0&&(u[f[1]]=w[1]);break}}),u.HeadingPairs&&u.TitlesOfParts&&BF(u.HeadingPairs,u.TitlesOfParts,n,a),n}var t9=/<[^>]+>[^<]*/g;function r9(e,n){var a={},u="",f=e.match(t9);if(f)for(var _=0;_!=f.length;++_){var w=f[_],T=on(w);switch(T[0]){case"<?xml":break;case"<Properties":break;case"<property":u=Zn(T.name);break;case"</property>":u=null;break;default:if(w.indexOf("<vt:")===0){var o=w.split(">"),k=o[0].slice(4),R=o[1];switch(k){case"lpstr":case"bstr":case"lpwstr":a[u]=Zn(R);break;case"bool":a[u]=Ci(R);break;case"i1":case"i2":case"i4":case"i8":case"int":case"uint":a[u]=parseInt(R,10);break;case"r4":case"r8":case"decimal":a[u]=parseFloat(R);break;case"filetime":case"date":a[u]=_a(R);break;case"cy":case"error":a[u]=Zn(R);break;default:if(k.slice(-1)=="/")break;n.WTF&&typeof console<"u"&&console.warn("Unexpected",w,k,o)}}else if(w.slice(0,2)!=="</"){if(n.WTF)throw new Error(w)}}}return a}var n9={Title:"Title",Subject:"Subject",Author:"Author",Keywords:"Keywords",Comments:"Description",LastAuthor:"LastAuthor",RevNumber:"Revision",Application:"AppName",LastPrinted:"LastPrinted",CreatedDate:"Created",ModifiedDate:"LastSaved",Category:"Category",Manager:"Manager",Company:"Company",AppVersion:"Version",ContentStatus:"ContentStatus",Identifier:"Identifier",Language:"Language"},zb;function i9(e,n,a){zb||(zb=RS(n9)),n=zb[n]||n,e[n]=a}function jS(e){var n=e.read_shift(4),a=e.read_shift(4);return new Date((a/1e7*Math.pow(2,32)+n/1e7-11644473600)*1e3).toISOString().replace(/\.000/,"")}function UF(e,n,a){var u=e.l,f=e.read_shift(0,"lpstr-cp");if(a)for(;e.l-u&3;)++e.l;return f}function VF(e,n,a){var u=e.read_shift(0,"lpwstr");return a&&(e.l+=4-(u.length+1&3)&3),u}function $F(e,n,a){return n===31?VF(e):UF(e,n,a)}function iE(e,n,a){return $F(e,n,a===!1?0:4)}function a9(e,n){if(!n)throw new Error("VtUnalignedString must have positive length");return $F(e,n,0)}function s9(e){for(var n=e.read_shift(4),a=[],u=0;u!=n;++u){var f=e.l;a[u]=e.read_shift(0,"lpwstr").replace(is,""),e.l-f&2&&(e.l+=2)}return a}function o9(e){for(var n=e.read_shift(4),a=[],u=0;u!=n;++u)a[u]=e.read_shift(0,"lpstr-cp").replace(is,"");return a}function l9(e){var n=e.l,a=P1(e,OF);e[e.l]==0&&e[e.l+1]==0&&e.l-n&2&&(e.l+=2);var u=P1(e,xs);return[a,u]}function c9(e){for(var n=e.read_shift(4),a=[],u=0;u<n/2;++u)a.push(l9(e));return a}function uP(e,n){for(var a=e.read_shift(4),u={},f=0;f!=a;++f){var _=e.read_shift(4),w=e.read_shift(4);u[_]=e.read_shift(w,n===1200?"utf16le":"utf8").replace(is,"").replace($m,"!"),n===1200&&w%2&&(e.l+=2)}return e.l&3&&(e.l=e.l>>3<<2),u}function jF(e){var n=e.read_shift(4),a=e.slice(e.l,e.l+n);return e.l+=n,(n&3)>0&&(e.l+=4-(n&3)&3),a}function u9(e){var n={};return n.Size=e.read_shift(4),e.l+=n.Size+3-(n.Size-1)%4,n}function P1(e,n,a){var u=e.read_shift(2),f,_=a||{};if(e.l+=2,n!==oP&&u!==n&&$7.indexOf(n)===-1&&!((n&65534)==4126&&(u&65534)==4126))throw new Error("Expected type "+n+" saw "+u);switch(n===oP?u:n){case 2:return f=e.read_shift(2,"i"),_.raw||(e.l+=2),f;case 3:return f=e.read_shift(4,"i"),f;case 11:return e.read_shift(4)!==0;case 19:return f=e.read_shift(4),f;case 30:return UF(e,u,4).replace(is,"");case 31:return VF(e);case 64:return jS(e);case 65:return jF(e);case 71:return u9(e);case 80:return iE(e,u,!_.raw).replace(is,"");case 81:return a9(e,u).replace(is,"");case 4108:return c9(e);case 4126:case 4127:return u==4127?s9(e):o9(e);default:throw new Error("TypedPropertyValue unrecognized type "+n+" "+u)}}function hP(e,n){var a=e.l,u=e.read_shift(4),f=e.read_shift(4),_=[],w=0,T=0,o=-1,k={};for(w=0;w!=f;++w){var R=e.read_shift(4),F=e.read_shift(4);_[w]=[R,F+a]}_.sort(function(Y,Z){return Y[1]-Z[1]});var B={};for(w=0;w!=f;++w){if(e.l!==_[w][1]){var V=!0;if(w>0&&n)switch(n[_[w-1][0]].t){case 2:e.l+2===_[w][1]&&(e.l+=2,V=!1);break;case 80:e.l<=_[w][1]&&(e.l=_[w][1],V=!1);break;case 4108:e.l<=_[w][1]&&(e.l=_[w][1],V=!1);break}if((!n||w==0)&&e.l<=_[w][1]&&(V=!1,e.l=_[w][1]),V)throw new Error("Read Error: Expected address "+_[w][1]+" at "+e.l+" :"+w)}if(n){var G=n[_[w][0]];if(B[G.n]=P1(e,G.t,{raw:!0}),G.p==="version"&&(B[G.n]=String(B[G.n]>>16)+"."+("0000"+String(B[G.n]&65535)).slice(-4)),G.n=="CodePage")switch(B[G.n]){case 0:B[G.n]=1252;case 874:case 932:case 936:case 949:case 950:case 1250:case 1251:case 1253:case 1254:case 1255:case 1256:case 1257:case 1258:case 1e4:case 1200:case 1201:case 1252:case 65e3:case-536:case 65001:case-535:Wo(T=B[G.n]>>>0&65535);break;default:throw new Error("Unsupported CodePage: "+B[G.n])}}else if(_[w][0]===1){if(T=B.CodePage=P1(e,$S),Wo(T),o!==-1){var U=e.l;e.l=_[o][1],k=uP(e,T),e.l=U}}else if(_[w][0]===0){if(T===0){o=w,e.l=_[w+1][1];continue}k=uP(e,T)}else{var J=k[_[w][0]],X;switch(e[e.l]){case 65:e.l+=4,X=jF(e);break;case 30:e.l+=4,X=iE(e,e[e.l-4]).replace(/\u0000+$/,"");break;case 31:e.l+=4,X=iE(e,e[e.l-4]).replace(/\u0000+$/,"");break;case 3:e.l+=4,X=e.read_shift(4,"i");break;case 19:e.l+=4,X=e.read_shift(4);break;case 5:e.l+=4,X=e.read_shift(8,"f");break;case 11:e.l+=4,X=qi(e,4);break;case 64:e.l+=4,X=_a(jS(e));break;default:throw new Error("unparsed value: "+e[e.l])}B[J]=X}}return e.l=a+u,B}function fP(e,n,a){var u=e.content;if(!u)return{};Ea(u,0);var f,_,w,T,o=0;u.chk("feff","Byte Order: "),u.read_shift(2);var k=u.read_shift(4),R=u.read_shift(16);if(R!==$n.utils.consts.HEADER_CLSID&&R!==a)throw new Error("Bad PropertySet CLSID "+R);if(f=u.read_shift(4),f!==1&&f!==2)throw new Error("Unrecognized #Sets: "+f);if(_=u.read_shift(16),T=u.read_shift(4),f===1&&T!==u.l)throw new Error("Length mismatch: "+T+" !== "+u.l);f===2&&(w=u.read_shift(16),o=u.read_shift(4));var F=hP(u,n),B={SystemIdentifier:k};for(var V in F)B[V]=F[V];if(B.FMTID=_,f===1)return B;if(o-u.l==2&&(u.l+=2),u.l!==o)throw new Error("Length mismatch 2: "+u.l+" !== "+o);var G;try{G=hP(u,null)}catch{}for(V in G)B[V]=G[V];return B.FMTID=[_,w],B}function hu(e,n){return e.read_shift(n),null}function h9(e,n,a){for(var u=[],f=e.l+n;e.l<f;)u.push(a(e,f-e.l));if(f!==e.l)throw new Error("Slurp error");return u}function qi(e,n){return e.read_shift(n)===1}function ra(e){return e.read_shift(2,"u")}function GF(e,n){return h9(e,n,ra)}function f9(e){var n=e.read_shift(1),a=e.read_shift(1);return a===1?n:n===1}function Zg(e,n,a){var u=e.read_shift(a&&a.biff>=12?2:1),f="sbcs-cont";if(a&&a.biff>=8,!a||a.biff==8){var _=e.read_shift(1);_&&(f="dbcs-cont")}else a.biff==12&&(f="wstr");a.biff>=2&&a.biff<=5&&(f="cpstr");var w=u?e.read_shift(u,f):"";return w}function d9(e){var n=e.read_shift(2),a=e.read_shift(1),u=a&4,f=a&8,_=1+(a&1),w=0,T,o={};f&&(w=e.read_shift(2)),u&&(T=e.read_shift(4));var k=_==2?"dbcs-cont":"sbcs-cont",R=n===0?"":e.read_shift(n,k);return f&&(e.l+=4*w),u&&(e.l+=T),o.t=R,f||(o.raw="<t>"+o.t+"</t>",o.r=o.t),o}function lf(e,n,a){var u;if(a){if(a.biff>=2&&a.biff<=5)return e.read_shift(n,"cpstr");if(a.biff>=12)return e.read_shift(n,"dbcs-cont")}var f=e.read_shift(1);return f===0?u=e.read_shift(n,"sbcs-cont"):u=e.read_shift(n,"dbcs-cont"),u}function Xg(e,n,a){var u=e.read_shift(a&&a.biff==2?1:2);return u===0?(e.l++,""):lf(e,u,a)}function _f(e,n,a){if(a.biff>5)return Xg(e,n,a);var u=e.read_shift(1);return u===0?(e.l++,""):e.read_shift(u,a.biff<=4||!e.lens?"cpstr":"sbcs-cont")}function p9(e){var n=e.read_shift(1);e.l++;var a=e.read_shift(2);return e.l+=2,[n,a]}function m9(e){var n=e.read_shift(4),a=e.l,u=!1;n>24&&(e.l+=n-24,e.read_shift(16)==="795881f43b1d7f48af2c825dc4852763"&&(u=!0),e.l=a);var f=e.read_shift((u?n-24:n)>>1,"utf16le").replace(is,"");return u&&(e.l+=24),f}function g9(e){for(var n=e.read_shift(2),a="";n-- >0;)a+="../";var u=e.read_shift(0,"lpstr-ansi");if(e.l+=2,e.read_shift(2)!=57005)throw new Error("Bad FileMoniker");var f=e.read_shift(4);if(f===0)return a+u.replace(/\\/g,"/");var _=e.read_shift(4);if(e.read_shift(2)!=3)throw new Error("Bad FileMoniker");var w=e.read_shift(_>>1,"utf16le").replace(is,"");return a+w}function _9(e,n){var a=e.read_shift(16);switch(a){case"e0c9ea79f9bace118c8200aa004ba90b":return m9(e);case"0303000000000000c000000000000046":return g9(e);default:throw new Error("Unsupported Moniker "+a)}}function xy(e){var n=e.read_shift(4),a=n>0?e.read_shift(n,"utf16le").replace(is,""):"";return a}function x9(e,n){var a=e.l+n,u=e.read_shift(4);if(u!==2)throw new Error("Unrecognized streamVersion: "+u);var f=e.read_shift(2);e.l+=2;var _,w,T,o,k="",R,F;f&16&&(_=xy(e,a-e.l)),f&128&&(w=xy(e,a-e.l)),(f&257)===257&&(T=xy(e,a-e.l)),(f&257)===1&&(o=_9(e,a-e.l)),f&8&&(k=xy(e,a-e.l)),f&32&&(R=e.read_shift(16)),f&64&&(F=jS(e)),e.l=a;var B=w||T||o||"";B&&k&&(B+="#"+k),B||(B="#"+k),f&2&&B.charAt(0)=="/"&&B.charAt(1)!="/"&&(B="file://"+B);var V={Target:B};return R&&(V.guid=R),F&&(V.time=F),_&&(V.Tooltip=_),V}function HF(e){var n=e.read_shift(1),a=e.read_shift(1),u=e.read_shift(1),f=e.read_shift(1);return[n,a,u,f]}function WF(e,n){var a=HF(e);return a[3]=0,a}function Ll(e){var n=e.read_shift(2),a=e.read_shift(2),u=e.read_shift(2);return{r:n,c:a,ixfe:u}}function y9(e){var n=e.read_shift(2),a=e.read_shift(2);return e.l+=8,{type:n,flags:a}}function v9(e,n,a){return n===0?"":_f(e,n,a)}function w9(e,n,a){var u=a.biff>8?4:2,f=e.read_shift(u),_=e.read_shift(u,"i"),w=e.read_shift(u,"i");return[f,_,w]}function qF(e){var n=e.read_shift(2),a=VS(e);return[n,a]}function b9(e,n,a){e.l+=4,n-=4;var u=e.l+n,f=Zg(e,n,a),_=e.read_shift(2);if(u-=e.l,_!==u)throw new Error("Malformed AddinUdf: padding = "+u+" != "+_);return e.l+=_,f}function av(e){var n=e.read_shift(2),a=e.read_shift(2),u=e.read_shift(2),f=e.read_shift(2);return{s:{c:u,r:n},e:{c:f,r:a}}}function ZF(e){var n=e.read_shift(2),a=e.read_shift(2),u=e.read_shift(1),f=e.read_shift(1);return{s:{c:u,r:n},e:{c:f,r:a}}}var T9=ZF;function XF(e){e.l+=4;var n=e.read_shift(2),a=e.read_shift(2),u=e.read_shift(2);return e.l+=12,[a,n,u]}function E9(e){var n={};return e.l+=4,e.l+=16,n.fSharedNote=e.read_shift(2),e.l+=4,n}function S9(e){var n={};return e.l+=4,e.cf=e.read_shift(2),n}function Ua(e){e.l+=2,e.l+=e.read_shift(2)}var A9={0:Ua,4:Ua,5:Ua,6:Ua,7:S9,8:Ua,9:Ua,10:Ua,11:Ua,12:Ua,13:E9,14:Ua,15:Ua,16:Ua,17:Ua,18:Ua,19:Ua,20:Ua,21:XF};function C9(e,n){for(var a=e.l+n,u=[];e.l<a;){var f=e.read_shift(2);e.l-=2;try{u.push(A9[f](e,a-e.l))}catch{return e.l=a,u}}return e.l!=a&&(e.l=a),u}function yy(e,n){var a={BIFFVer:0,dt:0};switch(a.BIFFVer=e.read_shift(2),n-=2,n>=2&&(a.dt=e.read_shift(2),e.l-=2),a.BIFFVer){case 1536:case 1280:case 1024:case 768:case 512:case 2:case 7:break;default:if(n>6)throw new Error("Unexpected BIFF Ver "+a.BIFFVer)}return e.read_shift(n),a}function k9(e,n){return n===0||e.read_shift(2),1200}function M9(e,n,a){if(a.enc)return e.l+=n,"";var u=e.l,f=_f(e,0,a);return e.read_shift(n+u-e.l),f}function I9(e,n,a){var u=a&&a.biff==8||n==2?e.read_shift(2):(e.l+=n,0);return{fDialog:u&16,fBelow:u&64,fRight:u&128}}function P9(e,n,a){var u=e.read_shift(4),f=e.read_shift(1)&3,_=e.read_shift(1);switch(_){case 0:_="Worksheet";break;case 1:_="Macrosheet";break;case 2:_="Chartsheet";break;case 6:_="VBAModule";break}var w=Zg(e,0,a);return w.length===0&&(w="Sheet1"),{pos:u,hs:f,dt:_,name:w}}function R9(e,n){for(var a=e.l+n,u=e.read_shift(4),f=e.read_shift(4),_=[],w=0;w!=f&&e.l<a;++w)_.push(d9(e));return _.Count=u,_.Unique=f,_}function D9(e,n){var a={};return a.dsst=e.read_shift(2),e.l+=n-2,a}function F9(e){var n={};n.r=e.read_shift(2),n.c=e.read_shift(2),n.cnt=e.read_shift(2)-n.c;var a=e.read_shift(2);e.l+=4;var u=e.read_shift(1);return e.l+=3,u&7&&(n.level=u&7),u&32&&(n.hidden=!0),u&64&&(n.hpt=a/20),n}function L9(e){var n=y9(e);if(n.type!=2211)throw new Error("Invalid Future Record "+n.type);var a=e.read_shift(4);return a!==0}function O9(e){return e.read_shift(2),e.read_shift(4)}function dP(e,n,a){var u=0;a&&a.biff==2||(u=e.read_shift(2));var f=e.read_shift(2);a&&a.biff==2&&(u=1-(f>>15),f&=32767);var _={Unsynced:u&1,DyZero:(u&2)>>1,ExAsc:(u&4)>>2,ExDsc:(u&8)>>3};return[_,f]}function N9(e){var n=e.read_shift(2),a=e.read_shift(2),u=e.read_shift(2),f=e.read_shift(2),_=e.read_shift(2),w=e.read_shift(2),T=e.read_shift(2),o=e.read_shift(2),k=e.read_shift(2);return{Pos:[n,a],Dim:[u,f],Flags:_,CurTab:w,FirstTab:T,Selected:o,TabRatio:k}}function z9(e,n,a){if(a&&a.biff>=2&&a.biff<5)return{};var u=e.read_shift(2);return{RTL:u&64}}function B9(){}function U9(e,n,a){var u={dyHeight:e.read_shift(2),fl:e.read_shift(2)};switch(a&&a.biff||8){case 2:break;case 3:case 4:e.l+=2;break;default:e.l+=10;break}return u.name=Zg(e,0,a),u}function V9(e){var n=Ll(e);return n.isst=e.read_shift(4),n}function $9(e,n,a){a.biffguess&&a.biff==2&&(a.biff=5);var u=e.l+n,f=Ll(e);a.biff==2&&e.l++;var _=Xg(e,u-e.l,a);return f.val=_,f}function j9(e,n,a){var u=e.read_shift(2),f=_f(e,0,a);return[u,f]}var G9=_f;function pP(e,n,a){var u=e.l+n,f=a.biff==8||!a.biff?4:2,_=e.read_shift(f),w=e.read_shift(f),T=e.read_shift(2),o=e.read_shift(2);return e.l=u,{s:{r:_,c:T},e:{r:w,c:o}}}function H9(e){var n=e.read_shift(2),a=e.read_shift(2),u=qF(e);return{r:n,c:a,ixfe:u[0],rknum:u[1]}}function W9(e,n){for(var a=e.l+n-2,u=e.read_shift(2),f=e.read_shift(2),_=[];e.l<a;)_.push(qF(e));if(e.l!==a)throw new Error("MulRK read error");var w=e.read_shift(2);if(_.length!=w-f+1)throw new Error("MulRK length mismatch");return{r:u,c:f,C:w,rkrec:_}}function q9(e,n){for(var a=e.l+n-2,u=e.read_shift(2),f=e.read_shift(2),_=[];e.l<a;)_.push(e.read_shift(2));if(e.l!==a)throw new Error("MulBlank read error");var w=e.read_shift(2);if(_.length!=w-f+1)throw new Error("MulBlank length mismatch");return{r:u,c:f,C:w,ixfe:_}}function Z9(e,n,a,u){var f={},_=e.read_shift(4),w=e.read_shift(4),T=e.read_shift(4),o=e.read_shift(2);return f.patternType=H7[T>>26],u.cellStyles&&(f.alc=_&7,f.fWrap=_>>3&1,f.alcV=_>>4&7,f.fJustLast=_>>7&1,f.trot=_>>8&255,f.cIndent=_>>16&15,f.fShrinkToFit=_>>20&1,f.iReadOrder=_>>22&2,f.fAtrNum=_>>26&1,f.fAtrFnt=_>>27&1,f.fAtrAlc=_>>28&1,f.fAtrBdr=_>>29&1,f.fAtrPat=_>>30&1,f.fAtrProt=_>>31&1,f.dgLeft=w&15,f.dgRight=w>>4&15,f.dgTop=w>>8&15,f.dgBottom=w>>12&15,f.icvLeft=w>>16&127,f.icvRight=w>>23&127,f.grbitDiag=w>>30&3,f.icvTop=T&127,f.icvBottom=T>>7&127,f.icvDiag=T>>14&127,f.dgDiag=T>>21&15,f.icvFore=o&127,f.icvBack=o>>7&127,f.fsxButton=o>>14&1),f}function X9(e,n,a){var u={};return u.ifnt=e.read_shift(2),u.numFmtId=e.read_shift(2),u.flags=e.read_shift(2),u.fStyle=u.flags>>2&1,n-=6,u.data=Z9(e,n,u.fStyle,a),u}function Y9(e){e.l+=4;var n=[e.read_shift(2),e.read_shift(2)];if(n[0]!==0&&n[0]--,n[1]!==0&&n[1]--,n[0]>7||n[1]>7)throw new Error("Bad Gutters: "+n.join("|"));return n}function mP(e,n,a){var u=Ll(e);(a.biff==2||n==9)&&++e.l;var f=f9(e);return u.val=f,u.t=f===!0||f===!1?"b":"e",u}function K9(e,n,a){a.biffguess&&a.biff==2&&(a.biff=5);var u=Ll(e),f=ja(e);return u.val=f,u}var gP=v9;function J9(e,n,a){var u=e.l+n,f=e.read_shift(2),_=e.read_shift(2);if(a.sbcch=_,_==1025||_==14849)return[_,f];if(_<1||_>255)throw new Error("Unexpected SupBook type: "+_);for(var w=lf(e,_),T=[];u>e.l;)T.push(Xg(e));return[_,f,w,T]}function _P(e,n,a){var u=e.read_shift(2),f,_={fBuiltIn:u&1,fWantAdvise:u>>>1&1,fWantPict:u>>>2&1,fOle:u>>>3&1,fOleLink:u>>>4&1,cf:u>>>5&1023,fIcon:u>>>15&1};return a.sbcch===14849&&(f=b9(e,n-2,a)),_.body=f||e.read_shift(n-2),typeof f=="string"&&(_.Name=f),_}var Q9=["_xlnm.Consolidate_Area","_xlnm.Auto_Open","_xlnm.Auto_Close","_xlnm.Extract","_xlnm.Database","_xlnm.Criteria","_xlnm.Print_Area","_xlnm.Print_Titles","_xlnm.Recorder","_xlnm.Data_Form","_xlnm.Auto_Activate","_xlnm.Auto_Deactivate","_xlnm.Sheet_Title","_xlnm._FilterDatabase"];function xP(e,n,a){var u=e.l+n,f=e.read_shift(2),_=e.read_shift(1),w=e.read_shift(1),T=e.read_shift(a&&a.biff==2?1:2),o=0;(!a||a.biff>=5)&&(a.biff!=5&&(e.l+=2),o=e.read_shift(2),a.biff==5&&(e.l+=2),e.l+=4);var k=lf(e,w,a);f&32&&(k=Q9[k.charCodeAt(0)]);var R=u-e.l;a&&a.biff==2&&--R;var F=u==e.l||T===0||!(R>0)?[]:F2(e,R,a,T);return{chKey:_,Name:k,itab:o,rgce:F}}function YF(e,n,a){if(a.biff<8)return eV(e,n,a);for(var u=[],f=e.l+n,_=e.read_shift(a.biff>8?4:2);_--!==0;)u.push(w9(e,a.biff>8?12:6,a));if(e.l!=f)throw new Error("Bad ExternSheet: "+e.l+" != "+f);return u}function eV(e,n,a){e[e.l+1]==3&&e[e.l]++;var u=Zg(e,n,a);return u.charCodeAt(0)==3?u.slice(1):u}function tV(e,n,a){if(a.biff<8){e.l+=n;return}var u=e.read_shift(2),f=e.read_shift(2),_=lf(e,u,a),w=lf(e,f,a);return[_,w]}function rV(e,n,a){var u=ZF(e);e.l++;var f=e.read_shift(1);return n-=8,[L2(e,n,a),f,u]}function yP(e,n,a){var u=T9(e);switch(a.biff){case 2:e.l++,n-=7;break;case 3:case 4:e.l+=2,n-=8;break;default:e.l+=6,n-=12}return[u,R2(e,n,a)]}function nV(e){var n=e.read_shift(4)!==0,a=e.read_shift(4)!==0,u=e.read_shift(4);return[n,a,u]}function iV(e,n,a){if(!(a.biff<8)){var u=e.read_shift(2),f=e.read_shift(2),_=e.read_shift(2),w=e.read_shift(2),T=_f(e,0,a);return a.biff<8&&e.read_shift(1),[{r:u,c:f},T,w,_]}}function aV(e,n,a){return iV(e,n,a)}function sV(e,n){for(var a=[],u=e.read_shift(2);u--;)a.push(av(e));return a}function oV(e,n,a){if(a&&a.biff<8)return cV(e,n,a);var u=XF(e),f=C9(e,n-22,u[1]);return{cmo:u,ft:f}}var lV={8:function(e,n){var a=e.l+n;e.l+=10;var u=e.read_shift(2);e.l+=4,e.l+=2,e.l+=2,e.l+=2,e.l+=4;var f=e.read_shift(1);return e.l+=f,e.l=a,{fmt:u}}};function cV(e,n,a){e.l+=4;var u=e.read_shift(2),f=e.read_shift(2),_=e.read_shift(2);e.l+=2,e.l+=2,e.l+=2,e.l+=2,e.l+=2,e.l+=2,e.l+=2,e.l+=2,e.l+=2,e.l+=6,n-=36;var w=[];return w.push((lV[u]||qa)(e,n,a)),{cmo:[f,u,_],ft:w}}function uV(e,n,a){var u=e.l,f="";try{e.l+=4;var _=(a.lastobj||{cmo:[0,0]}).cmo[1],w;[0,5,7,11,12,14].indexOf(_)==-1?e.l+=6:w=p9(e,6,a);var T=e.read_shift(2);e.read_shift(2),ra(e,2);var o=e.read_shift(2);e.l+=o;for(var k=1;k<e.lens.length-1;++k){if(e.l-u!=e.lens[k])throw new Error("TxO: bad continue record");var R=e[e.l],F=lf(e,e.lens[k+1]-e.lens[k]-1);if(f+=F,f.length>=(R?T:2*T))break}if(f.length!==T&&f.length!==T*2)throw new Error("cchText: "+T+" != "+f.length);return e.l=u+n,{t:f}}catch{return e.l=u+n,{t:f}}}function hV(e,n){var a=av(e);e.l+=16;var u=x9(e,n-24);return[a,u]}function fV(e,n){e.read_shift(2);var a=av(e),u=e.read_shift((n-10)/2,"dbcs-cont");return u=u.replace(is,""),[a,u]}function dV(e){var n=[0,0],a;return a=e.read_shift(2),n[0]=lP[a]||a,a=e.read_shift(2),n[1]=lP[a]||a,n}function pV(e){for(var n=e.read_shift(2),a=[];n-- >0;)a.push(WF(e));return a}function mV(e){for(var n=e.read_shift(2),a=[];n-- >0;)a.push(WF(e));return a}function gV(e){e.l+=2;var n={cxfs:0,crc:0};return n.cxfs=e.read_shift(2),n.crc=e.read_shift(4),n}function KF(e,n,a){if(!a.cellStyles)return qa(e,n);var u=a&&a.biff>=12?4:2,f=e.read_shift(u),_=e.read_shift(u),w=e.read_shift(u),T=e.read_shift(u),o=e.read_shift(2);u==2&&(e.l+=2);var k={s:f,e:_,w,ixfe:T,flags:o};return(a.biff>=5||!a.biff)&&(k.level=o>>8&7),k}function _V(e,n){var a={};return n<32||(e.l+=16,a.header=ja(e),a.footer=ja(e),e.l+=2),a}function xV(e,n,a){var u={area:!1};if(a.biff!=5)return e.l+=n,u;var f=e.read_shift(1);return e.l+=3,f&16&&(u.area=!0),u}var yV=Ll,vV=GF,wV=Xg;function bV(e){var n=e.read_shift(2),a=e.read_shift(2),u=e.read_shift(4),f={fmt:n,env:a,len:u,data:e.slice(e.l,e.l+u)};return e.l+=u,f}function TV(e,n,a){a.biffguess&&a.biff==5&&(a.biff=2);var u=Ll(e);++e.l;var f=_f(e,n-7,a);return u.t="str",u.val=f,u}function EV(e){var n=Ll(e);++e.l;var a=ja(e);return n.t="n",n.val=a,n}function SV(e){var n=Ll(e);++e.l;var a=e.read_shift(2);return n.t="n",n.val=a,n}function AV(e){var n=e.read_shift(1);return n===0?(e.l++,""):e.read_shift(n,"sbcs-cont")}function CV(e,n){e.l+=6,e.l+=2,e.l+=1,e.l+=3,e.l+=1,e.l+=n-13}function kV(e,n,a){var u=e.l+n,f=Ll(e),_=e.read_shift(2),w=lf(e,_,a);return e.l=u,f.t="str",f.val=w,f}var MV=[2,3,48,49,131,139,140,245],vP=function(){var e={1:437,2:850,3:1252,4:1e4,100:852,101:866,102:865,103:861,104:895,105:620,106:737,107:857,120:950,121:949,122:936,123:932,124:874,125:1255,126:1256,150:10007,151:10029,152:10006,200:1250,201:1251,202:1254,203:1253,0:20127,8:865,9:437,10:850,11:437,13:437,14:850,15:437,16:850,17:437,18:850,19:932,20:850,21:437,22:850,23:865,24:437,25:437,26:850,27:437,28:863,29:850,31:852,34:852,35:852,36:860,37:850,38:866,55:850,64:852,77:936,78:949,79:950,80:874,87:1252,88:1252,89:1252,108:863,134:737,135:852,136:857,204:1257,255:16969},n=RS({1:437,2:850,3:1252,4:1e4,100:852,101:866,102:865,103:861,104:895,105:620,106:737,107:857,120:950,121:949,122:936,123:932,124:874,125:1255,126:1256,150:10007,151:10029,152:10006,200:1250,201:1251,202:1254,203:1253,0:20127});function a(T,o){var k=[],R=Nu(1);switch(o.type){case"base64":R=Ho(Ws(T));break;case"binary":R=Ho(T);break;case"buffer":case"array":R=T;break}Ea(R,0);var F=R.read_shift(1),B=!!(F&136),V=!1,G=!1;switch(F){case 2:break;case 3:break;case 48:V=!0,B=!0;break;case 49:V=!0,B=!0;break;case 131:break;case 139:break;case 140:G=!0;break;case 245:break;default:throw new Error("DBF Unsupported Version: "+F.toString(16))}var U=0,J=521;F==2&&(U=R.read_shift(2)),R.l+=3,F!=2&&(U=R.read_shift(4)),U>1048576&&(U=1e6),F!=2&&(J=R.read_shift(2));var X=R.read_shift(2),Y=o.codepage||1252;F!=2&&(R.l+=16,R.read_shift(1),R[R.l]!==0&&(Y=e[R[R.l]]),R.l+=1,R.l+=2),G&&(R.l+=36);for(var Z=[],_e={},ke=Math.min(R.length,F==2?521:J-10-(V?264:0)),Ae=G?32:11;R.l<ke&&R[R.l]!=13;)switch(_e={},_e.name=vu.utils.decode(Y,R.slice(R.l,R.l+Ae)).replace(/[\u0000\r\n].*$/g,""),R.l+=Ae,_e.type=String.fromCharCode(R.read_shift(1)),F!=2&&!G&&(_e.offset=R.read_shift(4)),_e.len=R.read_shift(1),F==2&&(_e.offset=R.read_shift(2)),_e.dec=R.read_shift(1),_e.name.length&&Z.push(_e),F!=2&&(R.l+=G?13:14),_e.type){case"B":(!V||_e.len!=8)&&o.WTF&&console.log("Skipping "+_e.name+":"+_e.type);break;case"G":case"P":o.WTF&&console.log("Skipping "+_e.name+":"+_e.type);break;case"+":case"0":case"@":case"C":case"D":case"F":case"I":case"L":case"M":case"N":case"O":case"T":case"Y":break;default:throw new Error("Unknown Field Type: "+_e.type)}if(R[R.l]!==13&&(R.l=J-1),R.read_shift(1)!==13)throw new Error("DBF Terminator not found "+R.l+" "+R[R.l]);R.l=J;var me=0,De=0;for(k[0]=[],De=0;De!=Z.length;++De)k[0][De]=Z[De].name;for(;U-- >0;){if(R[R.l]===42){R.l+=X;continue}for(++R.l,k[++me]=[],De=0,De=0;De!=Z.length;++De){var we=R.slice(R.l,R.l+Z[De].len);R.l+=Z[De].len,Ea(we,0);var Je=vu.utils.decode(Y,we);switch(Z[De].type){case"C":Je.trim().length&&(k[me][De]=Je.replace(/\s+$/,""));break;case"D":Je.length===8?k[me][De]=new Date(+Je.slice(0,4),+Je.slice(4,6)-1,+Je.slice(6,8)):k[me][De]=Je;break;case"F":k[me][De]=parseFloat(Je.trim());break;case"+":case"I":k[me][De]=G?we.read_shift(-4,"i")^2147483648:we.read_shift(4,"i");break;case"L":switch(Je.trim().toUpperCase()){case"Y":case"T":k[me][De]=!0;break;case"N":case"F":k[me][De]=!1;break;case"":case"?":break;default:throw new Error("DBF Unrecognized L:|"+Je+"|")}break;case"M":if(!B)throw new Error("DBF Unexpected MEMO for type "+F.toString(16));k[me][De]="##MEMO##"+(G?parseInt(Je.trim(),10):we.read_shift(4));break;case"N":Je=Je.replace(/\u0000/g,"").trim(),Je&&Je!="."&&(k[me][De]=+Je||0);break;case"@":k[me][De]=new Date(we.read_shift(-8,"f")-621356832e5);break;case"T":k[me][De]=new Date((we.read_shift(4)-2440588)*864e5+we.read_shift(4));break;case"Y":k[me][De]=we.read_shift(4,"i")/1e4+we.read_shift(4,"i")/1e4*Math.pow(2,32);break;case"O":k[me][De]=-we.read_shift(-8,"f");break;case"B":if(V&&Z[De].len==8){k[me][De]=we.read_shift(8,"f");break}case"G":case"P":we.l+=Z[De].len;break;case"0":if(Z[De].name==="_NullFlags")break;default:throw new Error("DBF Unsupported data type "+Z[De].type)}}}if(F!=2&&R.l<R.length&&R[R.l++]!=26)throw new Error("DBF EOF Marker missing "+(R.l-1)+" of "+R.length+" "+R[R.l-1].toString(16));return o&&o.sheetRows&&(k=k.slice(0,o.sheetRows)),o.DBF=Z,k}function u(T,o){var k=o||{};k.dateNF||(k.dateNF="yyyymmdd");var R=xp(a(T,k),k);return R["!cols"]=k.DBF.map(function(F){return{wch:F.len,DBF:F}}),delete k.DBF,R}function f(T,o){try{return Hu(u(T,o),o)}catch(k){if(o&&o.WTF)throw k}return{SheetNames:[],Sheets:{}}}var _={B:8,C:250,L:1,D:8,"?":0,"":0};function w(T,o){var k=o||{};if(+k.codepage>=0&&Wo(+k.codepage),k.type=="string")throw new Error("Cannot write DBF to JS string");var R=tE(),F=hE(T,{header:1,raw:!0,cellDates:!0}),B=F[0],V=F.slice(1),G=T["!cols"]||[],U=0,J=0,X=0,Y=1;for(U=0;U<B.length;++U){if(((G[U]||{}).DBF||{}).name){B[U]=G[U].DBF.name,++X;continue}if(B[U]!=null){if(++X,typeof B[U]=="number"&&(B[U]=B[U].toString(10)),typeof B[U]!="string")throw new Error("DBF Invalid column name "+B[U]+" |"+typeof B[U]+"|");if(B.indexOf(B[U])!==U){for(J=0;J<1024;++J)if(B.indexOf(B[U]+"_"+J)==-1){B[U]+="_"+J;break}}}}var Z=Vi(T["!ref"]),_e=[],ke=[],Ae=[];for(U=0;U<=Z.e.c-Z.s.c;++U){var me="",De="",we=0,Je=[];for(J=0;J<V.length;++J)V[J][U]!=null&&Je.push(V[J][U]);if(Je.length==0||B[U]==null){_e[U]="?";continue}for(J=0;J<Je.length;++J){switch(typeof Je[J]){case"number":De="B";break;case"string":De="C";break;case"boolean":De="L";break;case"object":De=Je[J]instanceof Date?"D":"C";break;default:De="C"}we=Math.max(we,String(Je[J]).length),me=me&&me!=De?"C":De}we>250&&(we=250),De=((G[U]||{}).DBF||{}).type,De=="C"&&G[U].DBF.len>we&&(we=G[U].DBF.len),me=="B"&&De=="N"&&(me="N",Ae[U]=G[U].DBF.dec,we=G[U].DBF.len),ke[U]=me=="C"||De=="N"?we:_[me]||0,Y+=ke[U],_e[U]=me}var rt=R.next(32);for(rt.write_shift(4,318902576),rt.write_shift(4,V.length),rt.write_shift(2,296+32*X),rt.write_shift(2,Y),U=0;U<4;++U)rt.write_shift(4,0);for(rt.write_shift(4,0|(+n[XD]||3)<<8),U=0,J=0;U<B.length;++U)if(B[U]!=null){var Re=R.next(32),St=(B[U].slice(-10)+"\0\0\0\0\0\0\0\0\0\0\0").slice(0,11);Re.write_shift(1,St,"sbcs"),Re.write_shift(1,_e[U]=="?"?"C":_e[U],"sbcs"),Re.write_shift(4,J),Re.write_shift(1,ke[U]||_[_e[U]]||0),Re.write_shift(1,Ae[U]||0),Re.write_shift(1,2),Re.write_shift(4,0),Re.write_shift(1,0),Re.write_shift(4,0),Re.write_shift(4,0),J+=ke[U]||_[_e[U]]||0}var Lt=R.next(264);for(Lt.write_shift(4,13),U=0;U<65;++U)Lt.write_shift(4,0);for(U=0;U<V.length;++U){var We=R.next(Y);for(We.write_shift(1,0),J=0;J<B.length;++J)if(B[J]!=null)switch(_e[J]){case"L":We.write_shift(1,V[U][J]==null?63:V[U][J]?84:70);break;case"B":We.write_shift(8,V[U][J]||0,"f");break;case"N":var qt="0";for(typeof V[U][J]=="number"&&(qt=V[U][J].toFixed(Ae[J]||0)),X=0;X<ke[J]-qt.length;++X)We.write_shift(1,32);We.write_shift(1,qt,"sbcs");break;case"D":V[U][J]?(We.write_shift(4,("0000"+V[U][J].getFullYear()).slice(-4),"sbcs"),We.write_shift(2,("00"+(V[U][J].getMonth()+1)).slice(-2),"sbcs"),We.write_shift(2,("00"+V[U][J].getDate()).slice(-2),"sbcs")):We.write_shift(8,"00000000","sbcs");break;case"C":var Ot=String(V[U][J]!=null?V[U][J]:"").slice(0,ke[J]);for(We.write_shift(1,Ot,"sbcs"),X=0;X<ke[J]-Ot.length;++X)We.write_shift(1,32);break}}return R.next(1).write_shift(1,26),R.end()}return{to_workbook:f,to_sheet:u,from_sheet:w}}(),IV=function(){var e={AA:"À",BA:"Á",CA:"Â",DA:195,HA:"Ä",JA:197,AE:"È",BE:"É",CE:"Ê",HE:"Ë",AI:"Ì",BI:"Í",CI:"Î",HI:"Ï",AO:"Ò",BO:"Ó",CO:"Ô",DO:213,HO:"Ö",AU:"Ù",BU:"Ú",CU:"Û",HU:"Ü",Aa:"à",Ba:"á",Ca:"â",Da:227,Ha:"ä",Ja:229,Ae:"è",Be:"é",Ce:"ê",He:"ë",Ai:"ì",Bi:"í",Ci:"î",Hi:"ï",Ao:"ò",Bo:"ó",Co:"ô",Do:245,Ho:"ö",Au:"ù",Bu:"ú",Cu:"û",Hu:"ü",KC:"Ç",Kc:"ç",q:"æ",z:"œ",a:"Æ",j:"Œ",DN:209,Dn:241,Hy:255,S:169,c:170,R:174,"B ":180,0:176,1:177,2:178,3:179,5:181,6:182,7:183,Q:185,k:186,b:208,i:216,l:222,s:240,y:248,"!":161,'"':162,"#":163,"(":164,"%":165,"'":167,"H ":168,"+":171,";":187,"<":188,"=":189,">":190,"?":191,"{":223},n=new RegExp("\x1BN("+Pl(e).join("|").replace(/\|\|\|/,"|\\||").replace(/([?()+])/g,"\\$1")+"|\\|)","gm"),a=function(B,V){var G=e[V];return typeof G=="number"?OI(G):G},u=function(B,V,G){var U=V.charCodeAt(0)-32<<4|G.charCodeAt(0)-48;return U==59?B:OI(U)};e["|"]=254;function f(B,V){switch(V.type){case"base64":return _(Ws(B),V);case"binary":return _(B,V);case"buffer":return _(zn&&Buffer.isBuffer(B)?B.toString("binary"):df(B),V);case"array":return _(of(B),V)}throw new Error("Unrecognized type "+V.type)}function _(B,V){var G=B.split(/[\n\r]+/),U=-1,J=-1,X=0,Y=0,Z=[],_e=[],ke=null,Ae={},me=[],De=[],we=[],Je=0,rt;for(+V.codepage>=0&&Wo(+V.codepage);X!==G.length;++X){Je=0;var Re=G[X].trim().replace(/\x1B([\x20-\x2F])([\x30-\x3F])/g,u).replace(n,a),St=Re.replace(/;;/g,"\0").split(";").map(function(Xe){return Xe.replace(/\u0000/g,";")}),Lt=St[0],We;if(Re.length>0)switch(Lt){case"ID":break;case"E":break;case"B":break;case"O":break;case"W":break;case"P":St[1].charAt(0)=="P"&&_e.push(Re.slice(3).replace(/;;/g,";"));break;case"C":var qt=!1,Ot=!1,st=!1,Ve=!1,Et=-1,Dt=-1;for(Y=1;Y<St.length;++Y)switch(St[Y].charAt(0)){case"A":break;case"X":J=parseInt(St[Y].slice(1))-1,Ot=!0;break;case"Y":for(U=parseInt(St[Y].slice(1))-1,Ot||(J=0),rt=Z.length;rt<=U;++rt)Z[rt]=[];break;case"K":We=St[Y].slice(1),We.charAt(0)==='"'?We=We.slice(1,We.length-1):We==="TRUE"?We=!0:We==="FALSE"?We=!1:isNaN(Yo(We))?isNaN(op(We).getDate())||(We=_a(We)):(We=Yo(We),ke!==null&&gp(ke)&&(We=iv(We))),qt=!0;break;case"E":Ve=!0;var Se=Yd(St[Y].slice(1),{r:U,c:J});Z[U][J]=[Z[U][J],Se];break;case"S":st=!0,Z[U][J]=[Z[U][J],"S5S"];break;case"G":break;case"R":Et=parseInt(St[Y].slice(1))-1;break;case"C":Dt=parseInt(St[Y].slice(1))-1;break;default:if(V&&V.WTF)throw new Error("SYLK bad record "+Re)}if(qt&&(Z[U][J]&&Z[U][J].length==2?Z[U][J][0]=We:Z[U][J]=We,ke=null),st){if(Ve)throw new Error("SYLK shared formula cannot have own formula");var at=Et>-1&&Z[Et][Dt];if(!at||!at[1])throw new Error("SYLK shared formula cannot find base");Z[U][J][1]=oL(at[1],{r:U-Et,c:J-Dt})}break;case"F":var He=0;for(Y=1;Y<St.length;++Y)switch(St[Y].charAt(0)){case"X":J=parseInt(St[Y].slice(1))-1,++He;break;case"Y":for(U=parseInt(St[Y].slice(1))-1,rt=Z.length;rt<=U;++rt)Z[rt]=[];break;case"M":Je=parseInt(St[Y].slice(1))/20;break;case"F":break;case"G":break;case"P":ke=_e[parseInt(St[Y].slice(1))];break;case"S":break;case"D":break;case"N":break;case"W":for(we=St[Y].slice(1).split(" "),rt=parseInt(we[0],10);rt<=parseInt(we[1],10);++rt)Je=parseInt(we[2],10),De[rt-1]=Je===0?{hidden:!0}:{wch:Je},lp(De[rt-1]);break;case"C":J=parseInt(St[Y].slice(1))-1,De[J]||(De[J]={});break;case"R":U=parseInt(St[Y].slice(1))-1,me[U]||(me[U]={}),Je>0?(me[U].hpt=Je,me[U].hpx=Dg(Je)):Je===0&&(me[U].hidden=!0);break;default:if(V&&V.WTF)throw new Error("SYLK bad record "+Re)}He<1&&(ke=null);break;default:if(V&&V.WTF)throw new Error("SYLK bad record "+Re)}}return me.length>0&&(Ae["!rows"]=me),De.length>0&&(Ae["!cols"]=De),V&&V.sheetRows&&(Z=Z.slice(0,V.sheetRows)),[Z,Ae]}function w(B,V){var G=f(B,V),U=G[0],J=G[1],X=xp(U,V);return Pl(J).forEach(function(Y){X[Y]=J[Y]}),X}function T(B,V){return Hu(w(B,V),V)}function o(B,V,G,U){var J="C;Y"+(G+1)+";X"+(U+1)+";K";switch(B.t){case"n":J+=B.v||0,B.f&&!B.F&&(J+=";E"+gj(B.f,{r:G,c:U}));break;case"b":J+=B.v?"TRUE":"FALSE";break;case"e":J+=B.w||B.v;break;case"d":J+='"'+(B.w||B.v)+'"';break;case"s":J+='"'+B.v.replace(/"/g,"").replace(/;/g,";;")+'"';break}return J}function k(B,V){V.forEach(function(G,U){var J="F;W"+(U+1)+" "+(U+1)+" ";G.hidden?J+="0":(typeof G.width=="number"&&!G.wpx&&(G.wpx=D1(G.width)),typeof G.wpx=="number"&&!G.wch&&(G.wch=F1(G.wpx)),typeof G.wch=="number"&&(J+=Math.round(G.wch))),J.charAt(J.length-1)!=" "&&B.push(J)})}function R(B,V){V.forEach(function(G,U){var J="F;";G.hidden?J+="M0;":G.hpt?J+="M"+20*G.hpt+";":G.hpx&&(J+="M"+20*iL(G.hpx)+";"),J.length>2&&B.push(J+"R"+(U+1))})}function F(B,V){var G=["ID;PWXL;N;E"],U=[],J=Vi(B["!ref"]),X,Y=Array.isArray(B),Z=`\r
`;G.push("P;PGeneral"),G.push("F;P0;DG0G8;M255"),B["!cols"]&&k(G,B["!cols"]),B["!rows"]&&R(G,B["!rows"]),G.push("B;Y"+(J.e.r-J.s.r+1)+";X"+(J.e.c-J.s.c+1)+";D"+[J.s.c,J.s.r,J.e.c,J.e.r].join(" "));for(var _e=J.s.r;_e<=J.e.r;++_e)for(var ke=J.s.c;ke<=J.e.c;++ke){var Ae=yn({r:_e,c:ke});X=Y?(B[_e]||[])[ke]:B[Ae],!(!X||X.v==null&&(!X.f||X.F))&&U.push(o(X,B,_e,ke))}return G.join(Z)+Z+U.join(Z)+Z+"E"+Z}return{to_workbook:T,to_sheet:w,from_sheet:F}}(),PV=function(){function e(_,w){switch(w.type){case"base64":return n(Ws(_),w);case"binary":return n(_,w);case"buffer":return n(zn&&Buffer.isBuffer(_)?_.toString("binary"):df(_),w);case"array":return n(of(_),w)}throw new Error("Unrecognized type "+w.type)}function n(_,w){for(var T=_.split(`
`),o=-1,k=-1,R=0,F=[];R!==T.length;++R){if(T[R].trim()==="BOT"){F[++o]=[],k=0;continue}if(!(o<0)){var B=T[R].trim().split(","),V=B[0],G=B[1];++R;for(var U=T[R]||"";(U.match(/["]/g)||[]).length&1&&R<T.length-1;)U+=`
`+T[++R];switch(U=U.trim(),+V){case-1:if(U==="BOT"){F[++o]=[],k=0;continue}else if(U!=="EOD")throw new Error("Unrecognized DIF special command "+U);break;case 0:U==="TRUE"?F[o][k]=!0:U==="FALSE"?F[o][k]=!1:isNaN(Yo(G))?isNaN(op(G).getDate())?F[o][k]=G:F[o][k]=_a(G):F[o][k]=Yo(G),++k;break;case 1:U=U.slice(1,U.length-1),U=U.replace(/""/g,'"'),U&&U.match(/^=".*"$/)&&(U=U.slice(2,-1)),F[o][k++]=U!==""?U:null;break}if(U==="EOD")break}}return w&&w.sheetRows&&(F=F.slice(0,w.sheetRows)),F}function a(_,w){return xp(e(_,w),w)}function u(_,w){return Hu(a(_,w),w)}var f=function(){var _=function(o,k,R,F,B){o.push(k),o.push(R+","+F),o.push('"'+B.replace(/"/g,'""')+'"')},w=function(o,k,R,F){o.push(k+","+R),o.push(k==1?'"'+F.replace(/"/g,'""')+'"':F)};return function(o){var k=[],R=Vi(o["!ref"]),F,B=Array.isArray(o);_(k,"TABLE",0,1,"sheetjs"),_(k,"VECTORS",0,R.e.r-R.s.r+1,""),_(k,"TUPLES",0,R.e.c-R.s.c+1,""),_(k,"DATA",0,0,"");for(var V=R.s.r;V<=R.e.r;++V){w(k,-1,0,"BOT");for(var G=R.s.c;G<=R.e.c;++G){var U=yn({r:V,c:G});if(F=B?(o[V]||[])[G]:o[U],!F){w(k,1,0,"");continue}switch(F.t){case"n":var J=F.w;!J&&F.v!=null&&(J=F.v),J==null?F.f&&!F.F?w(k,1,0,"="+F.f):w(k,1,0,""):w(k,0,J,"V");break;case"b":w(k,0,F.v?1:0,F.v?"TRUE":"FALSE");break;case"s":w(k,1,0,isNaN(F.v)?F.v:'="'+F.v+'"');break;case"d":F.w||(F.w=fo(F.z||Tn[14],as(_a(F.v)))),w(k,0,F.w,"V");break;default:w(k,1,0,"")}}}w(k,-1,0,"EOD");var X=`\r
`,Y=k.join(X);return Y}}();return{to_workbook:u,to_sheet:a,from_sheet:f}}(),RV=function(){function e(F){return F.replace(/\\b/g,"\\").replace(/\\c/g,":").replace(/\\n/g,`
`)}function n(F){return F.replace(/\\/g,"\\b").replace(/:/g,"\\c").replace(/\n/g,"\\n")}function a(F,B){for(var V=F.split(`
`),G=-1,U=-1,J=0,X=[];J!==V.length;++J){var Y=V[J].trim().split(":");if(Y[0]==="cell"){var Z=rs(Y[1]);if(X.length<=Z.r)for(G=X.length;G<=Z.r;++G)X[G]||(X[G]=[]);switch(G=Z.r,U=Z.c,Y[2]){case"t":X[G][U]=e(Y[3]);break;case"v":X[G][U]=+Y[3];break;case"vtf":var _e=Y[Y.length-1];case"vtc":switch(Y[3]){case"nl":X[G][U]=!!+Y[4];break;default:X[G][U]=+Y[4];break}Y[2]=="vtf"&&(X[G][U]=[X[G][U],_e])}}}return B&&B.sheetRows&&(X=X.slice(0,B.sheetRows)),X}function u(F,B){return xp(a(F,B),B)}function f(F,B){return Hu(u(F,B),B)}var _=["socialcalc:version:1.5","MIME-Version: 1.0","Content-Type: multipart/mixed; boundary=SocialCalcSpreadsheetControlSave"].join(`
`),w=["--SocialCalcSpreadsheetControlSave","Content-type: text/plain; charset=UTF-8"].join(`
`)+`
`,T=["# SocialCalc Spreadsheet Control Save","part:sheet"].join(`
`),o="--SocialCalcSpreadsheetControlSave--";function k(F){if(!F||!F["!ref"])return"";for(var B=[],V=[],G,U="",J=_p(F["!ref"]),X=Array.isArray(F),Y=J.s.r;Y<=J.e.r;++Y)for(var Z=J.s.c;Z<=J.e.c;++Z)if(U=yn({r:Y,c:Z}),G=X?(F[Y]||[])[Z]:F[U],!(!G||G.v==null||G.t==="z")){switch(V=["cell",U,"t"],G.t){case"s":case"str":V.push(n(G.v));break;case"n":G.f?(V[2]="vtf",V[3]="n",V[4]=G.v,V[5]=n(G.f)):(V[2]="v",V[3]=G.v);break;case"b":V[2]="vt"+(G.f?"f":"c"),V[3]="nl",V[4]=G.v?"1":"0",V[5]=n(G.f||(G.v?"TRUE":"FALSE"));break;case"d":var _e=as(_a(G.v));V[2]="vtc",V[3]="nd",V[4]=""+_e,V[5]=G.w||fo(G.z||Tn[14],_e);break;case"e":continue}B.push(V.join(":"))}return B.push("sheet:c:"+(J.e.c-J.s.c+1)+":r:"+(J.e.r-J.s.r+1)+":tvf:1"),B.push("valueformat:1:text-wiki"),B.join(`
`)}function R(F){return[_,w,T,w,k(F),o].join(`
`)}return{to_workbook:f,to_sheet:u,from_sheet:R}}(),Pg=function(){function e(R,F,B,V,G){G.raw?F[B][V]=R:R===""||(R==="TRUE"?F[B][V]=!0:R==="FALSE"?F[B][V]=!1:isNaN(Yo(R))?isNaN(op(R).getDate())?F[B][V]=R:F[B][V]=_a(R):F[B][V]=Yo(R))}function n(R,F){var B=F||{},V=[];if(!R||R.length===0)return V;for(var G=R.split(/[\r\n]/),U=G.length-1;U>=0&&G[U].length===0;)--U;for(var J=10,X=0,Y=0;Y<=U;++Y)X=G[Y].indexOf(" "),X==-1?X=G[Y].length:X++,J=Math.max(J,X);for(Y=0;Y<=U;++Y){V[Y]=[];var Z=0;for(e(G[Y].slice(0,J).trim(),V,Y,Z,B),Z=1;Z<=(G[Y].length-J)/10+1;++Z)e(G[Y].slice(J+(Z-1)*10,J+Z*10).trim(),V,Y,Z,B)}return B.sheetRows&&(V=V.slice(0,B.sheetRows)),V}var a={44:",",9:"	",59:";",124:"|"},u={44:3,9:2,59:1,124:0};function f(R){for(var F={},B=!1,V=0,G=0;V<R.length;++V)(G=R.charCodeAt(V))==34?B=!B:!B&&G in a&&(F[G]=(F[G]||0)+1);G=[];for(V in F)Object.prototype.hasOwnProperty.call(F,V)&&G.push([F[V],V]);if(!G.length){F=u;for(V in F)Object.prototype.hasOwnProperty.call(F,V)&&G.push([F[V],V])}return G.sort(function(U,J){return U[0]-J[0]||u[U[1]]-u[J[1]]}),a[G.pop()[1]]||44}function _(R,F){var B=F||{},V="",G=B.dense?[]:{},U={s:{c:0,r:0},e:{c:0,r:0}};R.slice(0,4)=="sep="?R.charCodeAt(5)==13&&R.charCodeAt(6)==10?(V=R.charAt(4),R=R.slice(7)):R.charCodeAt(5)==13||R.charCodeAt(5)==10?(V=R.charAt(4),R=R.slice(6)):V=f(R.slice(0,1024)):B&&B.FS?V=B.FS:V=f(R.slice(0,1024));var J=0,X=0,Y=0,Z=0,_e=0,ke=V.charCodeAt(0),Ae=!1,me=0,De=R.charCodeAt(0);R=R.replace(/\r\n/mg,`
`);var we=B.dateNF!=null?GU(B.dateNF):null;function Je(){var rt=R.slice(Z,_e),Re={};if(rt.charAt(0)=='"'&&rt.charAt(rt.length-1)=='"'&&(rt=rt.slice(1,-1).replace(/""/g,'"')),rt.length===0)Re.t="z";else if(B.raw)Re.t="s",Re.v=rt;else if(rt.trim().length===0)Re.t="s",Re.v=rt;else if(rt.charCodeAt(0)==61)rt.charCodeAt(1)==34&&rt.charCodeAt(rt.length-1)==34?(Re.t="s",Re.v=rt.slice(2,-1).replace(/""/g,'"')):xj(rt)?(Re.t="n",Re.f=rt.slice(1)):(Re.t="s",Re.v=rt);else if(rt=="TRUE")Re.t="b",Re.v=!0;else if(rt=="FALSE")Re.t="b",Re.v=!1;else if(!isNaN(Y=Yo(rt)))Re.t="n",B.cellText!==!1&&(Re.w=rt),Re.v=Y;else if(!isNaN(op(rt).getDate())||we&&rt.match(we)){Re.z=B.dateNF||Tn[14];var St=0;we&&rt.match(we)&&(rt=HU(rt,B.dateNF,rt.match(we)||[]),St=1),B.cellDates?(Re.t="d",Re.v=_a(rt,St)):(Re.t="n",Re.v=as(_a(rt,St))),B.cellText!==!1&&(Re.w=fo(Re.z,Re.v instanceof Date?as(Re.v):Re.v)),B.cellNF||delete Re.z}else Re.t="s",Re.v=rt;if(Re.t=="z"||(B.dense?(G[J]||(G[J]=[]),G[J][X]=Re):G[yn({c:X,r:J})]=Re),Z=_e+1,De=R.charCodeAt(Z),U.e.c<X&&(U.e.c=X),U.e.r<J&&(U.e.r=J),me==ke)++X;else if(X=0,++J,B.sheetRows&&B.sheetRows<=J)return!0}e:for(;_e<R.length;++_e)switch(me=R.charCodeAt(_e)){case 34:De===34&&(Ae=!Ae);break;case ke:case 10:case 13:if(!Ae&&Je())break e;break}return _e-Z>0&&Je(),G["!ref"]=jn(U),G}function w(R,F){return!(F&&F.PRN)||F.FS||R.slice(0,4)=="sep="||R.indexOf("	")>=0||R.indexOf(",")>=0||R.indexOf(";")>=0?_(R,F):xp(n(R,F),F)}function T(R,F){var B="",V=F.type=="string"?[0,0,0,0]:KS(R,F);switch(F.type){case"base64":B=Ws(R);break;case"binary":B=R;break;case"buffer":F.codepage==65001?B=R.toString("utf8"):F.codepage&&typeof vu<"u"?B=vu.utils.decode(F.codepage,R):B=zn&&Buffer.isBuffer(R)?R.toString("binary"):df(R);break;case"array":B=of(R);break;case"string":B=R;break;default:throw new Error("Unrecognized type "+F.type)}return V[0]==239&&V[1]==187&&V[2]==191?B=gi(B.slice(3)):F.type!="string"&&F.type!="buffer"&&F.codepage==65001?B=gi(B):F.type=="binary"&&typeof vu<"u"&&F.codepage&&(B=vu.utils.decode(F.codepage,vu.utils.encode(28591,B))),B.slice(0,19)=="socialcalc:version:"?RV.to_sheet(F.type=="string"?B:gi(B),F):w(B,F)}function o(R,F){return Hu(T(R,F),F)}function k(R){for(var F=[],B=Vi(R["!ref"]),V,G=Array.isArray(R),U=B.s.r;U<=B.e.r;++U){for(var J=[],X=B.s.c;X<=B.e.c;++X){var Y=yn({r:U,c:X});if(V=G?(R[U]||[])[X]:R[Y],!V||V.v==null){J.push("          ");continue}for(var Z=(V.w||(vc(V),V.w)||"").slice(0,10);Z.length<10;)Z+=" ";J.push(Z+(X===0?" ":""))}F.push(J.join(""))}return F.join(`
`)}return{to_workbook:o,to_sheet:T,from_sheet:k}}();function DV(e,n){var a=n||{},u=!!a.WTF;a.WTF=!0;try{var f=IV.to_workbook(e,a);return a.WTF=u,f}catch(_){if(a.WTF=u,!_.message.match(/SYLK bad record ID/)&&u)throw _;return Pg.to_workbook(e,n)}}var og=function(){function e(Se,at,He){if(Se){Ea(Se,Se.l||0);for(var Xe=He.Enum||Et;Se.l<Se.length;){var yt=Se.read_shift(2),Jt=Xe[yt]||Xe[65535],sr=Se.read_shift(2),Xt=Se.l+sr,zt=Jt.f&&Jt.f(Se,sr,He);if(Se.l=Xt,at(zt,Jt,yt))return}}}function n(Se,at){switch(at.type){case"base64":return a(Ho(Ws(Se)),at);case"binary":return a(Ho(Se),at);case"buffer":case"array":return a(Se,at)}throw"Unsupported type "+at.type}function a(Se,at){if(!Se)return Se;var He=at||{},Xe=He.dense?[]:{},yt="Sheet1",Jt="",sr=0,Xt={},zt=[],Or=[],Be={s:{r:0,c:0},e:{r:0,c:0}},Fn=He.sheetRows||0;if(Se[2]==0&&(Se[3]==8||Se[3]==9)&&Se.length>=16&&Se[14]==5&&Se[15]===108)throw new Error("Unsupported Works 3 for Mac file");if(Se[2]==2)He.Enum=Et,e(Se,function(nr,En,Xn){switch(Xn){case 0:He.vers=nr,nr>=4096&&(He.qpro=!0);break;case 6:Be=nr;break;case 204:nr&&(Jt=nr);break;case 222:Jt=nr;break;case 15:case 51:He.qpro||(nr[1].v=nr[1].v.slice(1));case 13:case 14:case 16:Xn==14&&(nr[2]&112)==112&&(nr[2]&15)>1&&(nr[2]&15)<15&&(nr[1].z=He.dateNF||Tn[14],He.cellDates&&(nr[1].t="d",nr[1].v=iv(nr[1].v))),He.qpro&&nr[3]>sr&&(Xe["!ref"]=jn(Be),Xt[yt]=Xe,zt.push(yt),Xe=He.dense?[]:{},Be={s:{r:0,c:0},e:{r:0,c:0}},sr=nr[3],yt=Jt||"Sheet"+(sr+1),Jt="");var wn=He.dense?(Xe[nr[0].r]||[])[nr[0].c]:Xe[yn(nr[0])];if(wn){wn.t=nr[1].t,wn.v=nr[1].v,nr[1].z!=null&&(wn.z=nr[1].z),nr[1].f!=null&&(wn.f=nr[1].f);break}He.dense?(Xe[nr[0].r]||(Xe[nr[0].r]=[]),Xe[nr[0].r][nr[0].c]=nr[1]):Xe[yn(nr[0])]=nr[1];break}},He);else if(Se[2]==26||Se[2]==14)He.Enum=Dt,Se[2]==14&&(He.qpro=!0,Se.l=0),e(Se,function(nr,En,Xn){switch(Xn){case 204:yt=nr;break;case 22:nr[1].v=nr[1].v.slice(1);case 23:case 24:case 25:case 37:case 39:case 40:if(nr[3]>sr&&(Xe["!ref"]=jn(Be),Xt[yt]=Xe,zt.push(yt),Xe=He.dense?[]:{},Be={s:{r:0,c:0},e:{r:0,c:0}},sr=nr[3],yt="Sheet"+(sr+1)),Fn>0&&nr[0].r>=Fn)break;He.dense?(Xe[nr[0].r]||(Xe[nr[0].r]=[]),Xe[nr[0].r][nr[0].c]=nr[1]):Xe[yn(nr[0])]=nr[1],Be.e.c<nr[0].c&&(Be.e.c=nr[0].c),Be.e.r<nr[0].r&&(Be.e.r=nr[0].r);break;case 27:nr[14e3]&&(Or[nr[14e3][0]]=nr[14e3][1]);break;case 1537:Or[nr[0]]=nr[1],nr[0]==sr&&(yt=nr[1]);break}},He);else throw new Error("Unrecognized LOTUS BOF "+Se[2]);if(Xe["!ref"]=jn(Be),Xt[Jt||yt]=Xe,zt.push(Jt||yt),!Or.length)return{SheetNames:zt,Sheets:Xt};for(var Tr={},Er=[],Ir=0;Ir<Or.length;++Ir)Xt[zt[Ir]]?(Er.push(Or[Ir]||zt[Ir]),Tr[Or[Ir]]=Xt[Or[Ir]]||Xt[zt[Ir]]):(Er.push(Or[Ir]),Tr[Or[Ir]]={"!ref":"A1"});return{SheetNames:Er,Sheets:Tr}}function u(Se,at){var He=at||{};if(+He.codepage>=0&&Wo(+He.codepage),He.type=="string")throw new Error("Cannot write WK1 to JS string");var Xe=tE(),yt=Vi(Se["!ref"]),Jt=Array.isArray(Se),sr=[];Bo(Xe,0,_(1030)),Bo(Xe,6,o(yt));for(var Xt=Math.min(yt.e.r,8191),zt=yt.s.r;zt<=Xt;++zt)for(var Or=Ca(zt),Be=yt.s.c;Be<=yt.e.c;++Be){zt===yt.s.r&&(sr[Be]=ca(Be));var Fn=sr[Be]+Or,Tr=Jt?(Se[zt]||[])[Be]:Se[Fn];if(!(!Tr||Tr.t=="z"))if(Tr.t=="n")(Tr.v|0)==Tr.v&&Tr.v>=-32768&&Tr.v<=32767?Bo(Xe,13,V(zt,Be,Tr.v)):Bo(Xe,14,U(zt,Be,Tr.v));else{var Er=vc(Tr);Bo(Xe,15,F(zt,Be,Er.slice(0,239)))}}return Bo(Xe,1),Xe.end()}function f(Se,at){var He=at||{};if(+He.codepage>=0&&Wo(+He.codepage),He.type=="string")throw new Error("Cannot write WK3 to JS string");var Xe=tE();Bo(Xe,0,w(Se));for(var yt=0,Jt=0;yt<Se.SheetNames.length;++yt)(Se.Sheets[Se.SheetNames[yt]]||{})["!ref"]&&Bo(Xe,27,Ve(Se.SheetNames[yt],Jt++));var sr=0;for(yt=0;yt<Se.SheetNames.length;++yt){var Xt=Se.Sheets[Se.SheetNames[yt]];if(!(!Xt||!Xt["!ref"])){for(var zt=Vi(Xt["!ref"]),Or=Array.isArray(Xt),Be=[],Fn=Math.min(zt.e.r,8191),Tr=zt.s.r;Tr<=Fn;++Tr)for(var Er=Ca(Tr),Ir=zt.s.c;Ir<=zt.e.c;++Ir){Tr===zt.s.r&&(Be[Ir]=ca(Ir));var nr=Be[Ir]+Er,En=Or?(Xt[Tr]||[])[Ir]:Xt[nr];if(!(!En||En.t=="z"))if(En.t=="n")Bo(Xe,23,Je(Tr,Ir,sr,En.v));else{var Xn=vc(En);Bo(Xe,22,me(Tr,Ir,sr,Xn.slice(0,239)))}}++sr}}return Bo(Xe,1),Xe.end()}function _(Se){var at=sa(2);return at.write_shift(2,Se),at}function w(Se){var at=sa(26);at.write_shift(2,4096),at.write_shift(2,4),at.write_shift(4,0);for(var He=0,Xe=0,yt=0,Jt=0;Jt<Se.SheetNames.length;++Jt){var sr=Se.SheetNames[Jt],Xt=Se.Sheets[sr];if(!(!Xt||!Xt["!ref"])){++yt;var zt=_p(Xt["!ref"]);He<zt.e.r&&(He=zt.e.r),Xe<zt.e.c&&(Xe=zt.e.c)}}return He>8191&&(He=8191),at.write_shift(2,He),at.write_shift(1,yt),at.write_shift(1,Xe),at.write_shift(2,0),at.write_shift(2,0),at.write_shift(1,1),at.write_shift(1,2),at.write_shift(4,0),at.write_shift(4,0),at}function T(Se,at,He){var Xe={s:{c:0,r:0},e:{c:0,r:0}};return at==8&&He.qpro?(Xe.s.c=Se.read_shift(1),Se.l++,Xe.s.r=Se.read_shift(2),Xe.e.c=Se.read_shift(1),Se.l++,Xe.e.r=Se.read_shift(2),Xe):(Xe.s.c=Se.read_shift(2),Xe.s.r=Se.read_shift(2),at==12&&He.qpro&&(Se.l+=2),Xe.e.c=Se.read_shift(2),Xe.e.r=Se.read_shift(2),at==12&&He.qpro&&(Se.l+=2),Xe.s.c==65535&&(Xe.s.c=Xe.e.c=Xe.s.r=Xe.e.r=0),Xe)}function o(Se){var at=sa(8);return at.write_shift(2,Se.s.c),at.write_shift(2,Se.s.r),at.write_shift(2,Se.e.c),at.write_shift(2,Se.e.r),at}function k(Se,at,He){var Xe=[{c:0,r:0},{t:"n",v:0},0,0];return He.qpro&&He.vers!=20768?(Xe[0].c=Se.read_shift(1),Xe[3]=Se.read_shift(1),Xe[0].r=Se.read_shift(2),Se.l+=2):(Xe[2]=Se.read_shift(1),Xe[0].c=Se.read_shift(2),Xe[0].r=Se.read_shift(2)),Xe}function R(Se,at,He){var Xe=Se.l+at,yt=k(Se,at,He);if(yt[1].t="s",He.vers==20768){Se.l++;var Jt=Se.read_shift(1);return yt[1].v=Se.read_shift(Jt,"utf8"),yt}return He.qpro&&Se.l++,yt[1].v=Se.read_shift(Xe-Se.l,"cstr"),yt}function F(Se,at,He){var Xe=sa(7+He.length);Xe.write_shift(1,255),Xe.write_shift(2,at),Xe.write_shift(2,Se),Xe.write_shift(1,39);for(var yt=0;yt<Xe.length;++yt){var Jt=He.charCodeAt(yt);Xe.write_shift(1,Jt>=128?95:Jt)}return Xe.write_shift(1,0),Xe}function B(Se,at,He){var Xe=k(Se,at,He);return Xe[1].v=Se.read_shift(2,"i"),Xe}function V(Se,at,He){var Xe=sa(7);return Xe.write_shift(1,255),Xe.write_shift(2,at),Xe.write_shift(2,Se),Xe.write_shift(2,He,"i"),Xe}function G(Se,at,He){var Xe=k(Se,at,He);return Xe[1].v=Se.read_shift(8,"f"),Xe}function U(Se,at,He){var Xe=sa(13);return Xe.write_shift(1,255),Xe.write_shift(2,at),Xe.write_shift(2,Se),Xe.write_shift(8,He,"f"),Xe}function J(Se,at,He){var Xe=Se.l+at,yt=k(Se,at,He);if(yt[1].v=Se.read_shift(8,"f"),He.qpro)Se.l=Xe;else{var Jt=Se.read_shift(2);_e(Se.slice(Se.l,Se.l+Jt),yt),Se.l+=Jt}return yt}function X(Se,at,He){var Xe=at&32768;return at&=-32769,at=(Xe?Se:0)+(at>=8192?at-16384:at),(Xe?"":"$")+(He?ca(at):Ca(at))}var Y={51:["FALSE",0],52:["TRUE",0],70:["LEN",1],80:["SUM",69],81:["AVERAGEA",69],82:["COUNTA",69],83:["MINA",69],84:["MAXA",69],111:["T",1]},Z=["","","","","","","","","","+","-","*","/","^","=","<>","<=",">=","<",">","","","","","&","","","","","","",""];function _e(Se,at){Ea(Se,0);for(var He=[],Xe=0,yt="",Jt="",sr="",Xt="";Se.l<Se.length;){var zt=Se[Se.l++];switch(zt){case 0:He.push(Se.read_shift(8,"f"));break;case 1:Jt=X(at[0].c,Se.read_shift(2),!0),yt=X(at[0].r,Se.read_shift(2),!1),He.push(Jt+yt);break;case 2:{var Or=X(at[0].c,Se.read_shift(2),!0),Be=X(at[0].r,Se.read_shift(2),!1);Jt=X(at[0].c,Se.read_shift(2),!0),yt=X(at[0].r,Se.read_shift(2),!1),He.push(Or+Be+":"+Jt+yt)}break;case 3:if(Se.l<Se.length){console.error("WK1 premature formula end");return}break;case 4:He.push("("+He.pop()+")");break;case 5:He.push(Se.read_shift(2));break;case 6:{for(var Fn="";zt=Se[Se.l++];)Fn+=String.fromCharCode(zt);He.push('"'+Fn.replace(/"/g,'""')+'"')}break;case 8:He.push("-"+He.pop());break;case 23:He.push("+"+He.pop());break;case 22:He.push("NOT("+He.pop()+")");break;case 20:case 21:Xt=He.pop(),sr=He.pop(),He.push(["AND","OR"][zt-20]+"("+sr+","+Xt+")");break;default:if(zt<32&&Z[zt])Xt=He.pop(),sr=He.pop(),He.push(sr+Z[zt]+Xt);else if(Y[zt]){if(Xe=Y[zt][1],Xe==69&&(Xe=Se[Se.l++]),Xe>He.length){console.error("WK1 bad formula parse 0x"+zt.toString(16)+":|"+He.join("|")+"|");return}var Tr=He.slice(-Xe);He.length-=Xe,He.push(Y[zt][0]+"("+Tr.join(",")+")")}else return zt<=7?console.error("WK1 invalid opcode "+zt.toString(16)):zt<=24?console.error("WK1 unsupported op "+zt.toString(16)):zt<=30?console.error("WK1 invalid opcode "+zt.toString(16)):zt<=115?console.error("WK1 unsupported function opcode "+zt.toString(16)):console.error("WK1 unrecognized opcode "+zt.toString(16))}}He.length==1?at[1].f=""+He[0]:console.error("WK1 bad formula parse |"+He.join("|")+"|")}function ke(Se){var at=[{c:0,r:0},{t:"n",v:0},0];return at[0].r=Se.read_shift(2),at[3]=Se[Se.l++],at[0].c=Se[Se.l++],at}function Ae(Se,at){var He=ke(Se);return He[1].t="s",He[1].v=Se.read_shift(at-4,"cstr"),He}function me(Se,at,He,Xe){var yt=sa(6+Xe.length);yt.write_shift(2,Se),yt.write_shift(1,He),yt.write_shift(1,at),yt.write_shift(1,39);for(var Jt=0;Jt<Xe.length;++Jt){var sr=Xe.charCodeAt(Jt);yt.write_shift(1,sr>=128?95:sr)}return yt.write_shift(1,0),yt}function De(Se,at){var He=ke(Se);He[1].v=Se.read_shift(2);var Xe=He[1].v>>1;if(He[1].v&1)switch(Xe&7){case 0:Xe=(Xe>>3)*5e3;break;case 1:Xe=(Xe>>3)*500;break;case 2:Xe=(Xe>>3)/20;break;case 3:Xe=(Xe>>3)/200;break;case 4:Xe=(Xe>>3)/2e3;break;case 5:Xe=(Xe>>3)/2e4;break;case 6:Xe=(Xe>>3)/16;break;case 7:Xe=(Xe>>3)/64;break}return He[1].v=Xe,He}function we(Se,at){var He=ke(Se),Xe=Se.read_shift(4),yt=Se.read_shift(4),Jt=Se.read_shift(2);if(Jt==65535)return Xe===0&&yt===3221225472?(He[1].t="e",He[1].v=15):Xe===0&&yt===3489660928?(He[1].t="e",He[1].v=42):He[1].v=0,He;var sr=Jt&32768;return Jt=(Jt&32767)-16446,He[1].v=(1-sr*2)*(yt*Math.pow(2,Jt+32)+Xe*Math.pow(2,Jt)),He}function Je(Se,at,He,Xe){var yt=sa(14);if(yt.write_shift(2,Se),yt.write_shift(1,He),yt.write_shift(1,at),Xe==0)return yt.write_shift(4,0),yt.write_shift(4,0),yt.write_shift(2,65535),yt;var Jt=0,sr=0,Xt=0,zt=0;return Xe<0&&(Jt=1,Xe=-Xe),sr=Math.log2(Xe)|0,Xe/=Math.pow(2,sr-31),zt=Xe>>>0,zt&2147483648||(Xe/=2,++sr,zt=Xe>>>0),Xe-=zt,zt|=2147483648,zt>>>=0,Xe*=Math.pow(2,32),Xt=Xe>>>0,yt.write_shift(4,Xt),yt.write_shift(4,zt),sr+=16383+(Jt?32768:0),yt.write_shift(2,sr),yt}function rt(Se,at){var He=we(Se);return Se.l+=at-14,He}function Re(Se,at){var He=ke(Se),Xe=Se.read_shift(4);return He[1].v=Xe>>6,He}function St(Se,at){var He=ke(Se),Xe=Se.read_shift(8,"f");return He[1].v=Xe,He}function Lt(Se,at){var He=St(Se);return Se.l+=at-10,He}function We(Se,at){return Se[Se.l+at-1]==0?Se.read_shift(at,"cstr"):""}function qt(Se,at){var He=Se[Se.l++];He>at-1&&(He=at-1);for(var Xe="";Xe.length<He;)Xe+=String.fromCharCode(Se[Se.l++]);return Xe}function Ot(Se,at,He){if(!(!He.qpro||at<21)){var Xe=Se.read_shift(1);Se.l+=17,Se.l+=1,Se.l+=2;var yt=Se.read_shift(at-21,"cstr");return[Xe,yt]}}function st(Se,at){for(var He={},Xe=Se.l+at;Se.l<Xe;){var yt=Se.read_shift(2);if(yt==14e3){for(He[yt]=[0,""],He[yt][0]=Se.read_shift(2);Se[Se.l];)He[yt][1]+=String.fromCharCode(Se[Se.l]),Se.l++;Se.l++}}return He}function Ve(Se,at){var He=sa(5+Se.length);He.write_shift(2,14e3),He.write_shift(2,at);for(var Xe=0;Xe<Se.length;++Xe){var yt=Se.charCodeAt(Xe);He[He.l++]=yt>127?95:yt}return He[He.l++]=0,He}var Et={0:{n:"BOF",f:ra},1:{n:"EOF"},2:{n:"CALCMODE"},3:{n:"CALCORDER"},4:{n:"SPLIT"},5:{n:"SYNC"},6:{n:"RANGE",f:T},7:{n:"WINDOW1"},8:{n:"COLW1"},9:{n:"WINTWO"},10:{n:"COLW2"},11:{n:"NAME"},12:{n:"BLANK"},13:{n:"INTEGER",f:B},14:{n:"NUMBER",f:G},15:{n:"LABEL",f:R},16:{n:"FORMULA",f:J},24:{n:"TABLE"},25:{n:"ORANGE"},26:{n:"PRANGE"},27:{n:"SRANGE"},28:{n:"FRANGE"},29:{n:"KRANGE1"},32:{n:"HRANGE"},35:{n:"KRANGE2"},36:{n:"PROTEC"},37:{n:"FOOTER"},38:{n:"HEADER"},39:{n:"SETUP"},40:{n:"MARGINS"},41:{n:"LABELFMT"},42:{n:"TITLES"},43:{n:"SHEETJS"},45:{n:"GRAPH"},46:{n:"NGRAPH"},47:{n:"CALCCOUNT"},48:{n:"UNFORMATTED"},49:{n:"CURSORW12"},50:{n:"WINDOW"},51:{n:"STRING",f:R},55:{n:"PASSWORD"},56:{n:"LOCKED"},60:{n:"QUERY"},61:{n:"QUERYNAME"},62:{n:"PRINT"},63:{n:"PRINTNAME"},64:{n:"GRAPH2"},65:{n:"GRAPHNAME"},66:{n:"ZOOM"},67:{n:"SYMSPLIT"},68:{n:"NSROWS"},69:{n:"NSCOLS"},70:{n:"RULER"},71:{n:"NNAME"},72:{n:"ACOMM"},73:{n:"AMACRO"},74:{n:"PARSE"},102:{n:"PRANGES??"},103:{n:"RRANGES??"},104:{n:"FNAME??"},105:{n:"MRANGES??"},204:{n:"SHEETNAMECS",f:We},222:{n:"SHEETNAMELP",f:qt},65535:{n:""}},Dt={0:{n:"BOF"},1:{n:"EOF"},2:{n:"PASSWORD"},3:{n:"CALCSET"},4:{n:"WINDOWSET"},5:{n:"SHEETCELLPTR"},6:{n:"SHEETLAYOUT"},7:{n:"COLUMNWIDTH"},8:{n:"HIDDENCOLUMN"},9:{n:"USERRANGE"},10:{n:"SYSTEMRANGE"},11:{n:"ZEROFORCE"},12:{n:"SORTKEYDIR"},13:{n:"FILESEAL"},14:{n:"DATAFILLNUMS"},15:{n:"PRINTMAIN"},16:{n:"PRINTSTRING"},17:{n:"GRAPHMAIN"},18:{n:"GRAPHSTRING"},19:{n:"??"},20:{n:"ERRCELL"},21:{n:"NACELL"},22:{n:"LABEL16",f:Ae},23:{n:"NUMBER17",f:we},24:{n:"NUMBER18",f:De},25:{n:"FORMULA19",f:rt},26:{n:"FORMULA1A"},27:{n:"XFORMAT",f:st},28:{n:"DTLABELMISC"},29:{n:"DTLABELCELL"},30:{n:"GRAPHWINDOW"},31:{n:"CPA"},32:{n:"LPLAUTO"},33:{n:"QUERY"},34:{n:"HIDDENSHEET"},35:{n:"??"},37:{n:"NUMBER25",f:Re},38:{n:"??"},39:{n:"NUMBER27",f:St},40:{n:"FORMULA28",f:Lt},142:{n:"??"},147:{n:"??"},150:{n:"??"},151:{n:"??"},152:{n:"??"},153:{n:"??"},154:{n:"??"},155:{n:"??"},156:{n:"??"},163:{n:"??"},174:{n:"??"},175:{n:"??"},176:{n:"??"},177:{n:"??"},184:{n:"??"},185:{n:"??"},186:{n:"??"},187:{n:"??"},188:{n:"??"},195:{n:"??"},201:{n:"??"},204:{n:"SHEETNAMECS",f:We},205:{n:"??"},206:{n:"??"},207:{n:"??"},208:{n:"??"},256:{n:"??"},259:{n:"??"},260:{n:"??"},261:{n:"??"},262:{n:"??"},263:{n:"??"},265:{n:"??"},266:{n:"??"},267:{n:"??"},268:{n:"??"},270:{n:"??"},271:{n:"??"},384:{n:"??"},389:{n:"??"},390:{n:"??"},393:{n:"??"},396:{n:"??"},512:{n:"??"},514:{n:"??"},513:{n:"??"},516:{n:"??"},517:{n:"??"},640:{n:"??"},641:{n:"??"},642:{n:"??"},643:{n:"??"},644:{n:"??"},645:{n:"??"},646:{n:"??"},647:{n:"??"},648:{n:"??"},658:{n:"??"},659:{n:"??"},660:{n:"??"},661:{n:"??"},662:{n:"??"},665:{n:"??"},666:{n:"??"},768:{n:"??"},772:{n:"??"},1537:{n:"SHEETINFOQP",f:Ot},1600:{n:"??"},1602:{n:"??"},1793:{n:"??"},1794:{n:"??"},1795:{n:"??"},1796:{n:"??"},1920:{n:"??"},2048:{n:"??"},2049:{n:"??"},2052:{n:"??"},2688:{n:"??"},10998:{n:"??"},12849:{n:"??"},28233:{n:"??"},28484:{n:"??"},65535:{n:""}};return{sheet_to_wk1:u,book_to_wk3:f,to_workbook:n}}();function FV(e){var n={},a=e.match(Za),u=0,f=!1;if(a)for(;u!=a.length;++u){var _=on(a[u]);switch(_[0].replace(/\w*:/g,"")){case"<condense":break;case"<extend":break;case"<shadow":if(!_.val)break;case"<shadow>":case"<shadow/>":n.shadow=1;break;case"</shadow>":break;case"<charset":if(_.val=="1")break;n.cp=CS[parseInt(_.val,10)];break;case"<outline":if(!_.val)break;case"<outline>":case"<outline/>":n.outline=1;break;case"</outline>":break;case"<rFont":n.name=_.val;break;case"<sz":n.sz=_.val;break;case"<strike":if(!_.val)break;case"<strike>":case"<strike/>":n.strike=1;break;case"</strike>":break;case"<u":if(!_.val)break;switch(_.val){case"double":n.uval="double";break;case"singleAccounting":n.uval="single-accounting";break;case"doubleAccounting":n.uval="double-accounting";break}case"<u>":case"<u/>":n.u=1;break;case"</u>":break;case"<b":if(_.val=="0")break;case"<b>":case"<b/>":n.b=1;break;case"</b>":break;case"<i":if(_.val=="0")break;case"<i>":case"<i/>":n.i=1;break;case"</i>":break;case"<color":_.rgb&&(n.color=_.rgb.slice(2,8));break;case"<color>":case"<color/>":case"</color>":break;case"<family":n.family=_.val;break;case"<family>":case"<family/>":case"</family>":break;case"<vertAlign":n.valign=_.val;break;case"<vertAlign>":case"<vertAlign/>":case"</vertAlign>":break;case"<scheme":break;case"<scheme>":case"<scheme/>":case"</scheme>":break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":f=!0;break;case"</ext>":f=!1;break;default:if(_[0].charCodeAt(1)!==47&&!f)throw new Error("Unrecognized rich format "+_[0])}}return n}var LV=function(){var e=Mg("t"),n=Mg("rPr");function a(_){var w=_.match(e);if(!w)return{t:"s",v:""};var T={t:"s",v:Zn(w[1])},o=_.match(n);return o&&(T.s=FV(o[1])),T}var u=/<(?:\w+:)?r>/g,f=/<\/(?:\w+:)?r>/;return function(w){return w.replace(u,"").split(f).map(a).filter(function(T){return T.v})}}(),OV=function(){var n=/(\r\n|\n)/g;function a(f,_,w){var T=[];f.u&&T.push("text-decoration: underline;"),f.uval&&T.push("text-underline-style:"+f.uval+";"),f.sz&&T.push("font-size:"+f.sz+"pt;"),f.outline&&T.push("text-effect: outline;"),f.shadow&&T.push("text-shadow: auto;"),_.push('<span style="'+T.join("")+'">'),f.b&&(_.push("<b>"),w.push("</b>")),f.i&&(_.push("<i>"),w.push("</i>")),f.strike&&(_.push("<s>"),w.push("</s>"));var o=f.valign||"";return o=="superscript"||o=="super"?o="sup":o=="subscript"&&(o="sub"),o!=""&&(_.push("<"+o+">"),w.push("</"+o+">")),w.push("</span>"),f}function u(f){var _=[[],f.v,[]];return f.v?(f.s&&a(f.s,_[0],_[2]),_[0].join("")+_[1].replace(n,"<br/>")+_[2].join("")):""}return function(_){return _.map(u).join("")}}(),NV=/<(?:\w+:)?t[^>]*>([^<]*)<\/(?:\w+:)?t>/g,zV=/<(?:\w+:)?r>/,BV=/<(?:\w+:)?rPh.*?>([\s\S]*?)<\/(?:\w+:)?rPh>/g;function GS(e,n){var a=n?n.cellHTML:!0,u={};return e?(e.match(/^\s*<(?:\w+:)?t[^>]*>/)?(u.t=Zn(gi(e.slice(e.indexOf(">")+1).split(/<\/(?:\w+:)?t>/)[0]||"")),u.r=gi(e),a&&(u.h=FS(u.t))):e.match(zV)&&(u.r=gi(e),u.t=Zn(gi((e.replace(BV,"").match(NV)||[]).join("").replace(Za,""))),a&&(u.h=OV(LV(u.r)))),u):{t:""}}var UV=/<(?:\w+:)?sst([^>]*)>([\s\S]*)<\/(?:\w+:)?sst>/,VV=/<(?:\w+:)?(?:si|sstItem)>/g,$V=/<\/(?:\w+:)?(?:si|sstItem)>/;function jV(e,n){var a=[],u="";if(!e)return a;var f=e.match(UV);if(f){u=f[2].replace(VV,"").split($V);for(var _=0;_!=u.length;++_){var w=GS(u[_].trim(),n);w!=null&&(a[a.length]=w)}f=on(f[1]),a.Count=f.count,a.Unique=f.uniqueCount}return a}function GV(e){return[e.read_shift(4),e.read_shift(4)]}function HV(e,n){var a=[],u=!1;return Sc(e,function(_,w,T){switch(T){case 159:a.Count=_[0],a.Unique=_[1];break;case 19:a.push(_);break;case 160:return!0;case 35:u=!0;break;case 36:u=!1;break;default:if(w.T,!u||n.WTF)throw new Error("Unexpected record 0x"+T.toString(16))}}),a}function JF(e){for(var n=[],a=e.split(""),u=0;u<a.length;++u)n[u]=a[u].charCodeAt(0);return n}function pc(e,n){var a={};return a.Major=e.read_shift(2),a.Minor=e.read_shift(2),n>=4&&(e.l+=n-4),a}function WV(e){var n={};return n.id=e.read_shift(0,"lpp4"),n.R=pc(e,4),n.U=pc(e,4),n.W=pc(e,4),n}function qV(e){for(var n=e.read_shift(4),a=e.l+n-4,u={},f=e.read_shift(4),_=[];f-- >0;)_.push({t:e.read_shift(4),v:e.read_shift(0,"lpp4")});if(u.name=e.read_shift(0,"lpp4"),u.comps=_,e.l!=a)throw new Error("Bad DataSpaceMapEntry: "+e.l+" != "+a);return u}function ZV(e){var n=[];e.l+=4;for(var a=e.read_shift(4);a-- >0;)n.push(qV(e));return n}function XV(e){var n=[];e.l+=4;for(var a=e.read_shift(4);a-- >0;)n.push(e.read_shift(0,"lpp4"));return n}function YV(e){var n={};return e.read_shift(4),e.l+=4,n.id=e.read_shift(0,"lpp4"),n.name=e.read_shift(0,"lpp4"),n.R=pc(e,4),n.U=pc(e,4),n.W=pc(e,4),n}function KV(e){var n=YV(e);if(n.ename=e.read_shift(0,"8lpp4"),n.blksz=e.read_shift(4),n.cmode=e.read_shift(4),e.read_shift(4)!=4)throw new Error("Bad !Primary record");return n}function QF(e,n){var a=e.l+n,u={};u.Flags=e.read_shift(4)&63,e.l+=4,u.AlgID=e.read_shift(4);var f=!1;switch(u.AlgID){case 26126:case 26127:case 26128:f=u.Flags==36;break;case 26625:f=u.Flags==4;break;case 0:f=u.Flags==16||u.Flags==4||u.Flags==36;break;default:throw"Unrecognized encryption algorithm: "+u.AlgID}if(!f)throw new Error("Encryption Flags/AlgID mismatch");return u.AlgIDHash=e.read_shift(4),u.KeySize=e.read_shift(4),u.ProviderType=e.read_shift(4),e.l+=8,u.CSPName=e.read_shift(a-e.l>>1,"utf16le"),e.l=a,u}function eL(e,n){var a={},u=e.l+n;return e.l+=4,a.Salt=e.slice(e.l,e.l+16),e.l+=16,a.Verifier=e.slice(e.l,e.l+16),e.l+=16,e.read_shift(4),a.VerifierHash=e.slice(e.l,u),e.l=u,a}function JV(e){var n=pc(e);switch(n.Minor){case 2:return[n.Minor,QV(e)];case 3:return[n.Minor,e$()];case 4:return[n.Minor,t$(e)]}throw new Error("ECMA-376 Encrypted file unrecognized Version: "+n.Minor)}function QV(e){var n=e.read_shift(4);if((n&63)!=36)throw new Error("EncryptionInfo mismatch");var a=e.read_shift(4),u=QF(e,a),f=eL(e,e.length-e.l);return{t:"Std",h:u,v:f}}function e$(){throw new Error("File is password-protected: ECMA-376 Extensible")}function t$(e){var n=["saltSize","blockSize","keyBits","hashSize","cipherAlgorithm","cipherChaining","hashAlgorithm","saltValue"];e.l+=4;var a=e.read_shift(e.length-e.l,"utf8"),u={};return a.replace(Za,function(_){var w=on(_);switch(Fl(w[0])){case"<?xml":break;case"<encryption":case"</encryption>":break;case"<keyData":n.forEach(function(T){u[T]=w[T]});break;case"<dataIntegrity":u.encryptedHmacKey=w.encryptedHmacKey,u.encryptedHmacValue=w.encryptedHmacValue;break;case"<keyEncryptors>":case"<keyEncryptors":u.encs=[];break;case"</keyEncryptors>":break;case"<keyEncryptor":u.uri=w.uri;break;case"</keyEncryptor>":break;case"<encryptedKey":u.encs.push(w);break;default:throw w[0]}}),u}function r$(e,n){var a={},u=a.EncryptionVersionInfo=pc(e,4);if(n-=4,u.Minor!=2)throw new Error("unrecognized minor version code: "+u.Minor);if(u.Major>4||u.Major<2)throw new Error("unrecognized major version code: "+u.Major);a.Flags=e.read_shift(4),n-=4;var f=e.read_shift(4);return n-=4,a.EncryptionHeader=QF(e,f),n-=f,a.EncryptionVerifier=eL(e,n),a}function n$(e){var n={},a=n.EncryptionVersionInfo=pc(e,4);if(a.Major!=1||a.Minor!=1)throw"unrecognized version code "+a.Major+" : "+a.Minor;return n.Salt=e.read_shift(16),n.EncryptedVerifier=e.read_shift(16),n.EncryptedVerifierHash=e.read_shift(16),n}function i$(e){var n=0,a,u=JF(e),f=u.length+1,_,w,T,o,k;for(a=Nu(f),a[0]=u.length,_=1;_!=f;++_)a[_]=u[_-1];for(_=f-1;_>=0;--_)w=a[_],T=n&16384?1:0,o=n<<1&32767,k=T|o,n=k^w;return n^52811}var tL=function(){var e=[187,255,255,186,255,255,185,128,0,190,15,0,191,15,0],n=[57840,7439,52380,33984,4364,3600,61902,12606,6258,57657,54287,34041,10252,43370,20163],a=[44796,19929,39858,10053,20106,40212,10761,31585,63170,64933,60267,50935,40399,11199,17763,35526,1453,2906,5812,11624,23248,885,1770,3540,7080,14160,28320,56640,55369,41139,20807,41614,21821,43642,17621,28485,56970,44341,19019,38038,14605,29210,60195,50791,40175,10751,21502,43004,24537,18387,36774,3949,7898,15796,31592,63184,47201,24803,49606,37805,14203,28406,56812,17824,35648,1697,3394,6788,13576,27152,43601,17539,35078,557,1114,2228,4456,30388,60776,51953,34243,7079,14158,28316,14128,28256,56512,43425,17251,34502,7597,13105,26210,52420,35241,883,1766,3532,4129,8258,16516,33032,4657,9314,18628],u=function(w){return(w/2|w*128)&255},f=function(w,T){return u(w^T)},_=function(w){for(var T=n[w.length-1],o=104,k=w.length-1;k>=0;--k)for(var R=w[k],F=0;F!=7;++F)R&64&&(T^=a[o]),R*=2,--o;return T};return function(w){for(var T=JF(w),o=_(T),k=T.length,R=Nu(16),F=0;F!=16;++F)R[F]=0;var B,V,G;for((k&1)===1&&(B=o>>8,R[k]=f(e[0],B),--k,B=o&255,V=T[T.length-1],R[k]=f(V,B));k>0;)--k,B=o>>8,R[k]=f(T[k],B),--k,B=o&255,R[k]=f(T[k],B);for(k=15,G=15-T.length;G>0;)B=o>>8,R[k]=f(e[G],B),--k,--G,B=o&255,R[k]=f(T[k],B),--k,--G;return R}}(),a$=function(e,n,a,u,f){f||(f=n),u||(u=tL(e));var _,w;for(_=0;_!=n.length;++_)w=n[_],w^=u[a],w=(w>>5|w<<3)&255,f[_]=w,++a;return[f,a,u]},s$=function(e){var n=0,a=tL(e);return function(u){var f=a$("",u,n,a);return n=f[1],f[0]}};function o$(e,n,a,u){var f={key:ra(e),verificationBytes:ra(e)};return a.password&&(f.verifier=i$(a.password)),u.valid=f.verificationBytes===f.verifier,u.valid&&(u.insitu=s$(a.password)),f}function l$(e,n,a){var u=a||{};return u.Info=e.read_shift(2),e.l-=2,u.Info===1?u.Data=n$(e):u.Data=r$(e,n),u}function c$(e,n,a){var u={Type:a.biff>=8?e.read_shift(2):0};return u.Type?l$(e,n-2,u):o$(e,a.biff>=8?n:n-2,a,u),u}var u$=function(){function e(f,_){switch(_.type){case"base64":return n(Ws(f),_);case"binary":return n(f,_);case"buffer":return n(zn&&Buffer.isBuffer(f)?f.toString("binary"):df(f),_);case"array":return n(of(f),_)}throw new Error("Unrecognized type "+_.type)}function n(f,_){var w=_||{},T=w.dense?[]:{},o=f.match(/\\trowd.*?\\row\b/g);if(!o.length)throw new Error("RTF missing table");var k={s:{c:0,r:0},e:{c:0,r:o.length-1}};return o.forEach(function(R,F){Array.isArray(T)&&(T[F]=[]);for(var B=/\\\w+\b/g,V=0,G,U=-1;G=B.exec(R);){switch(G[0]){case"\\cell":var J=R.slice(V,B.lastIndex-G[0].length);if(J[0]==" "&&(J=J.slice(1)),++U,J.length){var X={v:J,t:"s"};Array.isArray(T)?T[F][U]=X:T[yn({r:F,c:U})]=X}break}V=B.lastIndex}U>k.e.c&&(k.e.c=U)}),T["!ref"]=jn(k),T}function a(f,_){return Hu(e(f,_),_)}function u(f){for(var _=["{\\rtf1\\ansi"],w=Vi(f["!ref"]),T,o=Array.isArray(f),k=w.s.r;k<=w.e.r;++k){_.push("\\trowd\\trautofit1");for(var R=w.s.c;R<=w.e.c;++R)_.push("\\cellx"+(R+1));for(_.push("\\pard\\intbl"),R=w.s.c;R<=w.e.c;++R){var F=yn({r:k,c:R});T=o?(f[k]||[])[R]:f[F],!(!T||T.v==null&&(!T.f||T.F))&&(_.push(" "+(T.w||(vc(T),T.w))),_.push("\\cell"))}_.push("\\pard\\intbl\\row")}return _.join("")+"}"}return{to_workbook:a,to_sheet:e,from_sheet:u}}();function h$(e){var n=e.slice(e[0]==="#"?1:0).slice(0,6);return[parseInt(n.slice(0,2),16),parseInt(n.slice(2,4),16),parseInt(n.slice(4,6),16)]}function Rg(e){for(var n=0,a=1;n!=3;++n)a=a*256+(e[n]>255?255:e[n]<0?0:e[n]);return a.toString(16).toUpperCase().slice(1)}function f$(e){var n=e[0]/255,a=e[1]/255,u=e[2]/255,f=Math.max(n,a,u),_=Math.min(n,a,u),w=f-_;if(w===0)return[0,0,n];var T=0,o=0,k=f+_;switch(o=w/(k>1?2-k:k),f){case n:T=((a-u)/w+6)%6;break;case a:T=(u-n)/w+2;break;case u:T=(n-a)/w+4;break}return[T/6,o,k/2]}function d$(e){var n=e[0],a=e[1],u=e[2],f=a*2*(u<.5?u:1-u),_=u-f/2,w=[_,_,_],T=6*n,o;if(a!==0)switch(T|0){case 0:case 6:o=f*T,w[0]+=f,w[1]+=o;break;case 1:o=f*(2-T),w[0]+=o,w[1]+=f;break;case 2:o=f*(T-2),w[1]+=f,w[2]+=o;break;case 3:o=f*(4-T),w[1]+=o,w[2]+=f;break;case 4:o=f*(T-4),w[2]+=f,w[0]+=o;break;case 5:o=f*(6-T),w[2]+=o,w[0]+=f;break}for(var k=0;k!=3;++k)w[k]=Math.round(w[k]*255);return w}function R1(e,n){if(n===0)return e;var a=f$(h$(e));return n<0?a[2]=a[2]*(1+n):a[2]=1-(1-a[2])*(1-n),Rg(d$(a))}var rL=6,p$=15,m$=1,ts=rL;function D1(e){return Math.floor((e+Math.round(128/ts)/256)*ts)}function F1(e){return Math.floor((e-5)/ts*100+.5)/100}function aE(e){return Math.round((e*ts+5)/ts*256)/256}function Bb(e){return aE(F1(D1(e)))}function HS(e){var n=Math.abs(e-Bb(e)),a=ts;if(n>.005)for(ts=m$;ts<p$;++ts)Math.abs(e-Bb(e))<=n&&(n=Math.abs(e-Bb(e)),a=ts);ts=a}function lp(e){e.width?(e.wpx=D1(e.width),e.wch=F1(e.wpx),e.MDW=ts):e.wpx?(e.wch=F1(e.wpx),e.width=aE(e.wch),e.MDW=ts):typeof e.wch=="number"&&(e.width=aE(e.wch),e.wpx=D1(e.width),e.MDW=ts),e.customWidth&&delete e.customWidth}var g$=96,nL=g$;function iL(e){return e*96/nL}function Dg(e){return e*nL/96}var _$={None:"none",Solid:"solid",Gray50:"mediumGray",Gray75:"darkGray",Gray25:"lightGray",HorzStripe:"darkHorizontal",VertStripe:"darkVertical",ReverseDiagStripe:"darkDown",DiagStripe:"darkUp",DiagCross:"darkGrid",ThickDiagCross:"darkTrellis",ThinHorzStripe:"lightHorizontal",ThinVertStripe:"lightVertical",ThinReverseDiagStripe:"lightDown",ThinHorzCross:"lightGrid"};function x$(e,n,a,u){n.Borders=[];var f={},_=!1;(e[0].match(Za)||[]).forEach(function(w){var T=on(w);switch(Fl(T[0])){case"<borders":case"<borders>":case"</borders>":break;case"<border":case"<border>":case"<border/>":f={},T.diagonalUp&&(f.diagonalUp=Ci(T.diagonalUp)),T.diagonalDown&&(f.diagonalDown=Ci(T.diagonalDown)),n.Borders.push(f);break;case"</border>":break;case"<left/>":break;case"<left":case"<left>":break;case"</left>":break;case"<right/>":break;case"<right":case"<right>":break;case"</right>":break;case"<top/>":break;case"<top":case"<top>":break;case"</top>":break;case"<bottom/>":break;case"<bottom":case"<bottom>":break;case"</bottom>":break;case"<diagonal":case"<diagonal>":case"<diagonal/>":break;case"</diagonal>":break;case"<horizontal":case"<horizontal>":case"<horizontal/>":break;case"</horizontal>":break;case"<vertical":case"<vertical>":case"<vertical/>":break;case"</vertical>":break;case"<start":case"<start>":case"<start/>":break;case"</start>":break;case"<end":case"<end>":case"<end/>":break;case"</end>":break;case"<color":case"<color>":break;case"<color/>":case"</color>":break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":_=!0;break;case"</ext>":_=!1;break;default:if(u&&u.WTF&&!_)throw new Error("unrecognized "+T[0]+" in borders")}})}function y$(e,n,a,u){n.Fills=[];var f={},_=!1;(e[0].match(Za)||[]).forEach(function(w){var T=on(w);switch(Fl(T[0])){case"<fills":case"<fills>":case"</fills>":break;case"<fill>":case"<fill":case"<fill/>":f={},n.Fills.push(f);break;case"</fill>":break;case"<gradientFill>":break;case"<gradientFill":case"</gradientFill>":n.Fills.push(f),f={};break;case"<patternFill":case"<patternFill>":T.patternType&&(f.patternType=T.patternType);break;case"<patternFill/>":case"</patternFill>":break;case"<bgColor":f.bgColor||(f.bgColor={}),T.indexed&&(f.bgColor.indexed=parseInt(T.indexed,10)),T.theme&&(f.bgColor.theme=parseInt(T.theme,10)),T.tint&&(f.bgColor.tint=parseFloat(T.tint)),T.rgb&&(f.bgColor.rgb=T.rgb.slice(-6));break;case"<bgColor/>":case"</bgColor>":break;case"<fgColor":f.fgColor||(f.fgColor={}),T.theme&&(f.fgColor.theme=parseInt(T.theme,10)),T.tint&&(f.fgColor.tint=parseFloat(T.tint)),T.rgb!=null&&(f.fgColor.rgb=T.rgb.slice(-6));break;case"<fgColor/>":case"</fgColor>":break;case"<stop":case"<stop/>":break;case"</stop>":break;case"<color":case"<color/>":break;case"</color>":break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":_=!0;break;case"</ext>":_=!1;break;default:if(u&&u.WTF&&!_)throw new Error("unrecognized "+T[0]+" in fills")}})}function v$(e,n,a,u){n.Fonts=[];var f={},_=!1;(e[0].match(Za)||[]).forEach(function(w){var T=on(w);switch(Fl(T[0])){case"<fonts":case"<fonts>":case"</fonts>":break;case"<font":case"<font>":break;case"</font>":case"<font/>":n.Fonts.push(f),f={};break;case"<name":T.val&&(f.name=gi(T.val));break;case"<name/>":case"</name>":break;case"<b":f.bold=T.val?Ci(T.val):1;break;case"<b/>":f.bold=1;break;case"<i":f.italic=T.val?Ci(T.val):1;break;case"<i/>":f.italic=1;break;case"<u":switch(T.val){case"none":f.underline=0;break;case"single":f.underline=1;break;case"double":f.underline=2;break;case"singleAccounting":f.underline=33;break;case"doubleAccounting":f.underline=34;break}break;case"<u/>":f.underline=1;break;case"<strike":f.strike=T.val?Ci(T.val):1;break;case"<strike/>":f.strike=1;break;case"<outline":f.outline=T.val?Ci(T.val):1;break;case"<outline/>":f.outline=1;break;case"<shadow":f.shadow=T.val?Ci(T.val):1;break;case"<shadow/>":f.shadow=1;break;case"<condense":f.condense=T.val?Ci(T.val):1;break;case"<condense/>":f.condense=1;break;case"<extend":f.extend=T.val?Ci(T.val):1;break;case"<extend/>":f.extend=1;break;case"<sz":T.val&&(f.sz=+T.val);break;case"<sz/>":case"</sz>":break;case"<vertAlign":T.val&&(f.vertAlign=T.val);break;case"<vertAlign/>":case"</vertAlign>":break;case"<family":T.val&&(f.family=parseInt(T.val,10));break;case"<family/>":case"</family>":break;case"<scheme":T.val&&(f.scheme=T.val);break;case"<scheme/>":case"</scheme>":break;case"<charset":if(T.val=="1")break;T.codepage=CS[parseInt(T.val,10)];break;case"<color":if(f.color||(f.color={}),T.auto&&(f.color.auto=Ci(T.auto)),T.rgb)f.color.rgb=T.rgb.slice(-6);else if(T.indexed){f.color.index=parseInt(T.indexed,10);var o=Qh[f.color.index];f.color.index==81&&(o=Qh[1]),o||(o=Qh[1]),f.color.rgb=o[0].toString(16)+o[1].toString(16)+o[2].toString(16)}else T.theme&&(f.color.theme=parseInt(T.theme,10),T.tint&&(f.color.tint=parseFloat(T.tint)),T.theme&&a.themeElements&&a.themeElements.clrScheme&&(f.color.rgb=R1(a.themeElements.clrScheme[f.color.theme].rgb,f.color.tint||0)));break;case"<color/>":case"</color>":break;case"<AlternateContent":_=!0;break;case"</AlternateContent>":_=!1;break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":_=!0;break;case"</ext>":_=!1;break;default:if(u&&u.WTF&&!_)throw new Error("unrecognized "+T[0]+" in fonts")}})}function w$(e,n,a){n.NumberFmt=[];for(var u=Pl(Tn),f=0;f<u.length;++f)n.NumberFmt[u[f]]=Tn[u[f]];var _=e[0].match(Za);if(_)for(f=0;f<_.length;++f){var w=on(_[f]);switch(Fl(w[0])){case"<numFmts":case"</numFmts>":case"<numFmts/>":case"<numFmts>":break;case"<numFmt":{var T=Zn(gi(w.formatCode)),o=parseInt(w.numFmtId,10);if(n.NumberFmt[o]=T,o>0){if(o>392){for(o=392;o>60&&n.NumberFmt[o]!=null;--o);n.NumberFmt[o]=T}Jh(T,o)}}break;case"</numFmt>":break;default:if(a.WTF)throw new Error("unrecognized "+w[0]+" in numFmts")}}}var vy=["numFmtId","fillId","fontId","borderId","xfId"],wy=["applyAlignment","applyBorder","applyFill","applyFont","applyNumberFormat","applyProtection","pivotButton","quotePrefix"];function b$(e,n,a){n.CellXf=[];var u,f=!1;(e[0].match(Za)||[]).forEach(function(_){var w=on(_),T=0;switch(Fl(w[0])){case"<cellXfs":case"<cellXfs>":case"<cellXfs/>":case"</cellXfs>":break;case"<xf":case"<xf/>":for(u=w,delete u[0],T=0;T<vy.length;++T)u[vy[T]]&&(u[vy[T]]=parseInt(u[vy[T]],10));for(T=0;T<wy.length;++T)u[wy[T]]&&(u[wy[T]]=Ci(u[wy[T]]));if(n.NumberFmt&&u.numFmtId>392){for(T=392;T>60;--T)if(n.NumberFmt[u.numFmtId]==n.NumberFmt[T]){u.numFmtId=T;break}}n.CellXf.push(u);break;case"</xf>":break;case"<alignment":case"<alignment/>":var o={};w.vertical&&(o.vertical=w.vertical),w.horizontal&&(o.horizontal=w.horizontal),w.textRotation!=null&&(o.textRotation=w.textRotation),w.indent&&(o.indent=w.indent),w.wrapText&&(o.wrapText=Ci(w.wrapText)),u.alignment=o;break;case"</alignment>":break;case"<protection":break;case"</protection>":case"<protection/>":break;case"<AlternateContent":f=!0;break;case"</AlternateContent>":f=!1;break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":f=!0;break;case"</ext>":f=!1;break;default:if(a&&a.WTF&&!f)throw new Error("unrecognized "+w[0]+" in cellXfs")}})}var T$=function(){var n=/<(?:\w+:)?numFmts([^>]*)>[\S\s]*?<\/(?:\w+:)?numFmts>/,a=/<(?:\w+:)?cellXfs([^>]*)>[\S\s]*?<\/(?:\w+:)?cellXfs>/,u=/<(?:\w+:)?fills([^>]*)>[\S\s]*?<\/(?:\w+:)?fills>/,f=/<(?:\w+:)?fonts([^>]*)>[\S\s]*?<\/(?:\w+:)?fonts>/,_=/<(?:\w+:)?borders([^>]*)>[\S\s]*?<\/(?:\w+:)?borders>/;return function(T,o,k){var R={};if(!T)return R;T=T.replace(/<!--([\s\S]*?)-->/mg,"").replace(/<!DOCTYPE[^\[]*\[[^\]]*\]>/gm,"");var F;return(F=T.match(n))&&w$(F,R,k),(F=T.match(f))&&v$(F,R,o,k),(F=T.match(u))&&y$(F,R,o,k),(F=T.match(_))&&x$(F,R,o,k),(F=T.match(a))&&b$(F,R,k),R}}();function E$(e,n){var a=e.read_shift(2),u=Ha(e);return[a,u]}function S$(e,n,a){var u={};u.sz=e.read_shift(2)/20;var f=L7(e);f.fItalic&&(u.italic=1),f.fCondense&&(u.condense=1),f.fExtend&&(u.extend=1),f.fShadow&&(u.shadow=1),f.fOutline&&(u.outline=1),f.fStrikeout&&(u.strike=1);var _=e.read_shift(2);switch(_===700&&(u.bold=1),e.read_shift(2)){case 1:u.vertAlign="superscript";break;case 2:u.vertAlign="subscript";break}var w=e.read_shift(1);w!=0&&(u.underline=w);var T=e.read_shift(1);T>0&&(u.family=T);var o=e.read_shift(1);switch(o>0&&(u.charset=o),e.l++,u.color=F7(e),e.read_shift(1)){case 1:u.scheme="major";break;case 2:u.scheme="minor";break}return u.name=Ha(e),u}var A$=qa;function C$(e,n){var a=e.l+n,u=e.read_shift(2),f=e.read_shift(2);return e.l=a,{ixfe:u,numFmtId:f}}var k$=qa;function M$(e,n,a){var u={};u.NumberFmt=[];for(var f in Tn)u.NumberFmt[f]=Tn[f];u.CellXf=[],u.Fonts=[];var _=[],w=!1;return Sc(e,function(o,k,R){switch(R){case 44:u.NumberFmt[o[0]]=o[1],Jh(o[1],o[0]);break;case 43:u.Fonts.push(o),o.color.theme!=null&&n&&n.themeElements&&n.themeElements.clrScheme&&(o.color.rgb=R1(n.themeElements.clrScheme[o.color.theme].rgb,o.color.tint||0));break;case 1025:break;case 45:break;case 46:break;case 47:_[_.length-1]==617&&u.CellXf.push(o);break;case 48:case 507:case 572:case 475:break;case 1171:case 2102:case 1130:case 512:case 2095:case 3072:break;case 35:w=!0;break;case 36:w=!1;break;case 37:_.push(R),w=!0;break;case 38:_.pop(),w=!1;break;default:if(k.T>0)_.push(R);else if(k.T<0)_.pop();else if(!w||a.WTF&&_[_.length-1]!=37)throw new Error("Unexpected record 0x"+R.toString(16))}}),u}var I$=["</a:lt1>","</a:dk1>","</a:lt2>","</a:dk2>","</a:accent1>","</a:accent2>","</a:accent3>","</a:accent4>","</a:accent5>","</a:accent6>","</a:hlink>","</a:folHlink>"];function P$(e,n,a){n.themeElements.clrScheme=[];var u={};(e[0].match(Za)||[]).forEach(function(f){var _=on(f);switch(_[0]){case"<a:clrScheme":case"</a:clrScheme>":break;case"<a:srgbClr":u.rgb=_.val;break;case"<a:sysClr":u.rgb=_.lastClr;break;case"<a:dk1>":case"</a:dk1>":case"<a:lt1>":case"</a:lt1>":case"<a:dk2>":case"</a:dk2>":case"<a:lt2>":case"</a:lt2>":case"<a:accent1>":case"</a:accent1>":case"<a:accent2>":case"</a:accent2>":case"<a:accent3>":case"</a:accent3>":case"<a:accent4>":case"</a:accent4>":case"<a:accent5>":case"</a:accent5>":case"<a:accent6>":case"</a:accent6>":case"<a:hlink>":case"</a:hlink>":case"<a:folHlink>":case"</a:folHlink>":_[0].charAt(1)==="/"?(n.themeElements.clrScheme[I$.indexOf(_[0])]=u,u={}):u.name=_[0].slice(3,_[0].length-1);break;default:if(a&&a.WTF)throw new Error("Unrecognized "+_[0]+" in clrScheme")}})}function R$(){}function D$(){}var F$=/<a:clrScheme([^>]*)>[\s\S]*<\/a:clrScheme>/,L$=/<a:fontScheme([^>]*)>[\s\S]*<\/a:fontScheme>/,O$=/<a:fmtScheme([^>]*)>[\s\S]*<\/a:fmtScheme>/;function N$(e,n,a){n.themeElements={};var u;[["clrScheme",F$,P$],["fontScheme",L$,R$],["fmtScheme",O$,D$]].forEach(function(f){if(!(u=e.match(f[1])))throw new Error(f[0]+" not found in themeElements");f[2](u,n,a)})}var z$=/<a:themeElements([^>]*)>[\s\S]*<\/a:themeElements>/;function aL(e,n){(!e||e.length===0)&&(e=B$());var a,u={};if(!(a=e.match(z$)))throw new Error("themeElements not found in theme");return N$(a[0],u,n),u.raw=e,u}function B$(e,n){if(n&&n.themeXLSX)return n.themeXLSX;if(e&&typeof e.raw=="string")return e.raw;var a=[gF];return a[a.length]='<a:theme xmlns:a="http://schemas.openxmlformats.org/drawingml/2006/main" name="Office Theme">',a[a.length]="<a:themeElements>",a[a.length]='<a:clrScheme name="Office">',a[a.length]='<a:dk1><a:sysClr val="windowText" lastClr="000000"/></a:dk1>',a[a.length]='<a:lt1><a:sysClr val="window" lastClr="FFFFFF"/></a:lt1>',a[a.length]='<a:dk2><a:srgbClr val="1F497D"/></a:dk2>',a[a.length]='<a:lt2><a:srgbClr val="EEECE1"/></a:lt2>',a[a.length]='<a:accent1><a:srgbClr val="4F81BD"/></a:accent1>',a[a.length]='<a:accent2><a:srgbClr val="C0504D"/></a:accent2>',a[a.length]='<a:accent3><a:srgbClr val="9BBB59"/></a:accent3>',a[a.length]='<a:accent4><a:srgbClr val="8064A2"/></a:accent4>',a[a.length]='<a:accent5><a:srgbClr val="4BACC6"/></a:accent5>',a[a.length]='<a:accent6><a:srgbClr val="F79646"/></a:accent6>',a[a.length]='<a:hlink><a:srgbClr val="0000FF"/></a:hlink>',a[a.length]='<a:folHlink><a:srgbClr val="800080"/></a:folHlink>',a[a.length]="</a:clrScheme>",a[a.length]='<a:fontScheme name="Office">',a[a.length]="<a:majorFont>",a[a.length]='<a:latin typeface="Cambria"/>',a[a.length]='<a:ea typeface=""/>',a[a.length]='<a:cs typeface=""/>',a[a.length]='<a:font script="Jpan" typeface="ＭＳ Ｐゴシック"/>',a[a.length]='<a:font script="Hang" typeface="맑은 고딕"/>',a[a.length]='<a:font script="Hans" typeface="宋体"/>',a[a.length]='<a:font script="Hant" typeface="新細明體"/>',a[a.length]='<a:font script="Arab" typeface="Times New Roman"/>',a[a.length]='<a:font script="Hebr" typeface="Times New Roman"/>',a[a.length]='<a:font script="Thai" typeface="Tahoma"/>',a[a.length]='<a:font script="Ethi" typeface="Nyala"/>',a[a.length]='<a:font script="Beng" typeface="Vrinda"/>',a[a.length]='<a:font script="Gujr" typeface="Shruti"/>',a[a.length]='<a:font script="Khmr" typeface="MoolBoran"/>',a[a.length]='<a:font script="Knda" typeface="Tunga"/>',a[a.length]='<a:font script="Guru" typeface="Raavi"/>',a[a.length]='<a:font script="Cans" typeface="Euphemia"/>',a[a.length]='<a:font script="Cher" typeface="Plantagenet Cherokee"/>',a[a.length]='<a:font script="Yiii" typeface="Microsoft Yi Baiti"/>',a[a.length]='<a:font script="Tibt" typeface="Microsoft Himalaya"/>',a[a.length]='<a:font script="Thaa" typeface="MV Boli"/>',a[a.length]='<a:font script="Deva" typeface="Mangal"/>',a[a.length]='<a:font script="Telu" typeface="Gautami"/>',a[a.length]='<a:font script="Taml" typeface="Latha"/>',a[a.length]='<a:font script="Syrc" typeface="Estrangelo Edessa"/>',a[a.length]='<a:font script="Orya" typeface="Kalinga"/>',a[a.length]='<a:font script="Mlym" typeface="Kartika"/>',a[a.length]='<a:font script="Laoo" typeface="DokChampa"/>',a[a.length]='<a:font script="Sinh" typeface="Iskoola Pota"/>',a[a.length]='<a:font script="Mong" typeface="Mongolian Baiti"/>',a[a.length]='<a:font script="Viet" typeface="Times New Roman"/>',a[a.length]='<a:font script="Uigh" typeface="Microsoft Uighur"/>',a[a.length]='<a:font script="Geor" typeface="Sylfaen"/>',a[a.length]="</a:majorFont>",a[a.length]="<a:minorFont>",a[a.length]='<a:latin typeface="Calibri"/>',a[a.length]='<a:ea typeface=""/>',a[a.length]='<a:cs typeface=""/>',a[a.length]='<a:font script="Jpan" typeface="ＭＳ Ｐゴシック"/>',a[a.length]='<a:font script="Hang" typeface="맑은 고딕"/>',a[a.length]='<a:font script="Hans" typeface="宋体"/>',a[a.length]='<a:font script="Hant" typeface="新細明體"/>',a[a.length]='<a:font script="Arab" typeface="Arial"/>',a[a.length]='<a:font script="Hebr" typeface="Arial"/>',a[a.length]='<a:font script="Thai" typeface="Tahoma"/>',a[a.length]='<a:font script="Ethi" typeface="Nyala"/>',a[a.length]='<a:font script="Beng" typeface="Vrinda"/>',a[a.length]='<a:font script="Gujr" typeface="Shruti"/>',a[a.length]='<a:font script="Khmr" typeface="DaunPenh"/>',a[a.length]='<a:font script="Knda" typeface="Tunga"/>',a[a.length]='<a:font script="Guru" typeface="Raavi"/>',a[a.length]='<a:font script="Cans" typeface="Euphemia"/>',a[a.length]='<a:font script="Cher" typeface="Plantagenet Cherokee"/>',a[a.length]='<a:font script="Yiii" typeface="Microsoft Yi Baiti"/>',a[a.length]='<a:font script="Tibt" typeface="Microsoft Himalaya"/>',a[a.length]='<a:font script="Thaa" typeface="MV Boli"/>',a[a.length]='<a:font script="Deva" typeface="Mangal"/>',a[a.length]='<a:font script="Telu" typeface="Gautami"/>',a[a.length]='<a:font script="Taml" typeface="Latha"/>',a[a.length]='<a:font script="Syrc" typeface="Estrangelo Edessa"/>',a[a.length]='<a:font script="Orya" typeface="Kalinga"/>',a[a.length]='<a:font script="Mlym" typeface="Kartika"/>',a[a.length]='<a:font script="Laoo" typeface="DokChampa"/>',a[a.length]='<a:font script="Sinh" typeface="Iskoola Pota"/>',a[a.length]='<a:font script="Mong" typeface="Mongolian Baiti"/>',a[a.length]='<a:font script="Viet" typeface="Arial"/>',a[a.length]='<a:font script="Uigh" typeface="Microsoft Uighur"/>',a[a.length]='<a:font script="Geor" typeface="Sylfaen"/>',a[a.length]="</a:minorFont>",a[a.length]="</a:fontScheme>",a[a.length]='<a:fmtScheme name="Office">',a[a.length]="<a:fillStyleLst>",a[a.length]='<a:solidFill><a:schemeClr val="phClr"/></a:solidFill>',a[a.length]='<a:gradFill rotWithShape="1">',a[a.length]="<a:gsLst>",a[a.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="50000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',a[a.length]='<a:gs pos="35000"><a:schemeClr val="phClr"><a:tint val="37000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',a[a.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="15000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',a[a.length]="</a:gsLst>",a[a.length]='<a:lin ang="16200000" scaled="1"/>',a[a.length]="</a:gradFill>",a[a.length]='<a:gradFill rotWithShape="1">',a[a.length]="<a:gsLst>",a[a.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="100000"/><a:shade val="100000"/><a:satMod val="130000"/></a:schemeClr></a:gs>',a[a.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="50000"/><a:shade val="100000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',a[a.length]="</a:gsLst>",a[a.length]='<a:lin ang="16200000" scaled="0"/>',a[a.length]="</a:gradFill>",a[a.length]="</a:fillStyleLst>",a[a.length]="<a:lnStyleLst>",a[a.length]='<a:ln w="9525" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"><a:shade val="95000"/><a:satMod val="105000"/></a:schemeClr></a:solidFill><a:prstDash val="solid"/></a:ln>',a[a.length]='<a:ln w="25400" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln>',a[a.length]='<a:ln w="38100" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln>',a[a.length]="</a:lnStyleLst>",a[a.length]="<a:effectStyleLst>",a[a.length]="<a:effectStyle>",a[a.length]="<a:effectLst>",a[a.length]='<a:outerShdw blurRad="40000" dist="20000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="38000"/></a:srgbClr></a:outerShdw>',a[a.length]="</a:effectLst>",a[a.length]="</a:effectStyle>",a[a.length]="<a:effectStyle>",a[a.length]="<a:effectLst>",a[a.length]='<a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw>',a[a.length]="</a:effectLst>",a[a.length]="</a:effectStyle>",a[a.length]="<a:effectStyle>",a[a.length]="<a:effectLst>",a[a.length]='<a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw>',a[a.length]="</a:effectLst>",a[a.length]='<a:scene3d><a:camera prst="orthographicFront"><a:rot lat="0" lon="0" rev="0"/></a:camera><a:lightRig rig="threePt" dir="t"><a:rot lat="0" lon="0" rev="1200000"/></a:lightRig></a:scene3d>',a[a.length]='<a:sp3d><a:bevelT w="63500" h="25400"/></a:sp3d>',a[a.length]="</a:effectStyle>",a[a.length]="</a:effectStyleLst>",a[a.length]="<a:bgFillStyleLst>",a[a.length]='<a:solidFill><a:schemeClr val="phClr"/></a:solidFill>',a[a.length]='<a:gradFill rotWithShape="1">',a[a.length]="<a:gsLst>",a[a.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="40000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',a[a.length]='<a:gs pos="40000"><a:schemeClr val="phClr"><a:tint val="45000"/><a:shade val="99000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',a[a.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="20000"/><a:satMod val="255000"/></a:schemeClr></a:gs>',a[a.length]="</a:gsLst>",a[a.length]='<a:path path="circle"><a:fillToRect l="50000" t="-80000" r="50000" b="180000"/></a:path>',a[a.length]="</a:gradFill>",a[a.length]='<a:gradFill rotWithShape="1">',a[a.length]="<a:gsLst>",a[a.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="80000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',a[a.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="30000"/><a:satMod val="200000"/></a:schemeClr></a:gs>',a[a.length]="</a:gsLst>",a[a.length]='<a:path path="circle"><a:fillToRect l="50000" t="50000" r="50000" b="50000"/></a:path>',a[a.length]="</a:gradFill>",a[a.length]="</a:bgFillStyleLst>",a[a.length]="</a:fmtScheme>",a[a.length]="</a:themeElements>",a[a.length]="<a:objectDefaults>",a[a.length]="<a:spDef>",a[a.length]='<a:spPr/><a:bodyPr/><a:lstStyle/><a:style><a:lnRef idx="1"><a:schemeClr val="accent1"/></a:lnRef><a:fillRef idx="3"><a:schemeClr val="accent1"/></a:fillRef><a:effectRef idx="2"><a:schemeClr val="accent1"/></a:effectRef><a:fontRef idx="minor"><a:schemeClr val="lt1"/></a:fontRef></a:style>',a[a.length]="</a:spDef>",a[a.length]="<a:lnDef>",a[a.length]='<a:spPr/><a:bodyPr/><a:lstStyle/><a:style><a:lnRef idx="2"><a:schemeClr val="accent1"/></a:lnRef><a:fillRef idx="0"><a:schemeClr val="accent1"/></a:fillRef><a:effectRef idx="1"><a:schemeClr val="accent1"/></a:effectRef><a:fontRef idx="minor"><a:schemeClr val="tx1"/></a:fontRef></a:style>',a[a.length]="</a:lnDef>",a[a.length]="</a:objectDefaults>",a[a.length]="<a:extraClrSchemeLst/>",a[a.length]="</a:theme>",a.join("")}function U$(e,n,a){var u=e.l+n,f=e.read_shift(4);if(f!==124226){if(!a.cellStyles){e.l=u;return}var _=e.slice(e.l);e.l=u;var w;try{w=mF(_,{type:"array"})}catch{return}var T=Vs(w,"theme/theme/theme1.xml",!0);if(T)return aL(T,a)}}function V$(e){return e.read_shift(4)}function $$(e){var n={};switch(n.xclrType=e.read_shift(2),n.nTintShade=e.read_shift(2),n.xclrType){case 0:e.l+=4;break;case 1:n.xclrValue=j$(e,4);break;case 2:n.xclrValue=HF(e);break;case 3:n.xclrValue=V$(e);break;case 4:e.l+=4;break}return e.l+=8,n}function j$(e,n){return qa(e,n)}function G$(e,n){return qa(e,n)}function H$(e){var n=e.read_shift(2),a=e.read_shift(2)-4,u=[n];switch(n){case 4:case 5:case 7:case 8:case 9:case 10:case 11:case 13:u[1]=$$(e);break;case 6:u[1]=G$(e,a);break;case 14:case 15:u[1]=e.read_shift(a===1?1:2);break;default:throw new Error("Unrecognized ExtProp type: "+n+" "+a)}return u}function W$(e,n){var a=e.l+n;e.l+=2;var u=e.read_shift(2);e.l+=2;for(var f=e.read_shift(2),_=[];f-- >0;)_.push(H$(e,a-e.l));return{ixfe:u,ext:_}}function q$(e,n){n.forEach(function(a){switch(a[0]){}})}function Z$(e,n){return{flags:e.read_shift(4),version:e.read_shift(4),name:Ha(e)}}function X$(e){for(var n=[],a=e.read_shift(4);a-- >0;)n.push([e.read_shift(4),e.read_shift(4)]);return n}function Y$(e){return e.l+=4,e.read_shift(4)!=0}function K$(e,n,a){var u={Types:[],Cell:[],Value:[]},f=a||{},_=[],w=!1,T=2;return Sc(e,function(o,k,R){switch(R){case 335:u.Types.push({name:o.name});break;case 51:o.forEach(function(F){T==1?u.Cell.push({type:u.Types[F[0]-1].name,index:F[1]}):T==0&&u.Value.push({type:u.Types[F[0]-1].name,index:F[1]})});break;case 337:T=o?1:0;break;case 338:T=2;break;case 35:_.push(R),w=!0;break;case 36:_.pop(),w=!1;break;default:if(!k.T){if(!w||f.WTF&&_[_.length-1]!=35)throw new Error("Unexpected record 0x"+R.toString(16))}}}),u}function J$(e,n,a){var u={Types:[],Cell:[],Value:[]};if(!e)return u;var f=!1,_=2,w;return e.replace(Za,function(T){var o=on(T);switch(Fl(o[0])){case"<?xml":break;case"<metadata":case"</metadata>":break;case"<metadataTypes":case"</metadataTypes>":break;case"<metadataType":u.Types.push({name:o.name});break;case"</metadataType>":break;case"<futureMetadata":for(var k=0;k<u.Types.length;++k)u.Types[k].name==o.name&&(w=u.Types[k]);break;case"</futureMetadata>":break;case"<bk>":break;case"</bk>":break;case"<rc":_==1?u.Cell.push({type:u.Types[o.t-1].name,index:+o.v}):_==0&&u.Value.push({type:u.Types[o.t-1].name,index:+o.v});break;case"</rc>":break;case"<cellMetadata":_=1;break;case"</cellMetadata>":_=2;break;case"<valueMetadata":_=0;break;case"</valueMetadata>":_=2;break;case"<extLst":case"<extLst>":case"</extLst>":case"<extLst/>":break;case"<ext":f=!0;break;case"</ext>":f=!1;break;case"<rvb":if(!w)break;w.offsets||(w.offsets=[]),w.offsets.push(+o.i);break;default:if(!f&&a.WTF)throw new Error("unrecognized "+o[0]+" in metadata")}return T}),u}function Q$(e){var n=[];if(!e)return n;var a=1;return(e.match(Za)||[]).forEach(function(u){var f=on(u);switch(f[0]){case"<?xml":break;case"<calcChain":case"<calcChain>":case"</calcChain>":break;case"<c":delete f[0],f.i?a=f.i:f.i=a,n.push(f);break}}),n}function ej(e){var n={};n.i=e.read_shift(4);var a={};a.r=e.read_shift(4),a.c=e.read_shift(4),n.r=yn(a);var u=e.read_shift(1);return u&2&&(n.l="1"),u&8&&(n.a="1"),n}function tj(e,n,a){var u=[];return Sc(e,function(_,w,T){switch(T){case 63:u.push(_);break;default:if(!w.T)throw new Error("Unexpected record 0x"+T.toString(16))}}),u}function rj(e,n,a,u){if(!e)return e;var f=u||{},_=!1;Sc(e,function(T,o,k){switch(k){case 359:case 363:case 364:case 366:case 367:case 368:case 369:case 370:case 371:case 472:case 577:case 578:case 579:case 580:case 581:case 582:case 583:case 584:case 585:case 586:case 587:break;case 35:_=!0;break;case 36:_=!1;break;default:if(!o.T){if(!_||f.WTF)throw new Error("Unexpected record 0x"+k.toString(16))}}},f)}function nj(e,n){if(!e)return"??";var a=(e.match(/<c:chart [^>]*r:id="([^"]*)"/)||["",""])[1];return n["!id"][a].Target}function wP(e,n,a,u){var f=Array.isArray(e),_;n.forEach(function(w){var T=rs(w.ref);if(f?(e[T.r]||(e[T.r]=[]),_=e[T.r][T.c]):_=e[w.ref],!_){_={t:"z"},f?e[T.r][T.c]=_:e[w.ref]=_;var o=Vi(e["!ref"]||"BDWGO1000001:A1");o.s.r>T.r&&(o.s.r=T.r),o.e.r<T.r&&(o.e.r=T.r),o.s.c>T.c&&(o.s.c=T.c),o.e.c<T.c&&(o.e.c=T.c);var k=jn(o);k!==e["!ref"]&&(e["!ref"]=k)}_.c||(_.c=[]);var R={a:w.author,t:w.t,r:w.r,T:a};w.h&&(R.h=w.h);for(var F=_.c.length-1;F>=0;--F){if(!a&&_.c[F].T)return;a&&!_.c[F].T&&_.c.splice(F,1)}if(a&&u){for(F=0;F<u.length;++F)if(R.a==u[F].id){R.a=u[F].name||R.a;break}}_.c.push(R)})}function ij(e,n){if(e.match(/<(?:\w+:)?comments *\/>/))return[];var a=[],u=[],f=e.match(/<(?:\w+:)?authors>([\s\S]*)<\/(?:\w+:)?authors>/);f&&f[1]&&f[1].split(/<\/\w*:?author>/).forEach(function(w){if(!(w===""||w.trim()==="")){var T=w.match(/<(?:\w+:)?author[^>]*>(.*)/);T&&a.push(T[1])}});var _=e.match(/<(?:\w+:)?commentList>([\s\S]*)<\/(?:\w+:)?commentList>/);return _&&_[1]&&_[1].split(/<\/\w*:?comment>/).forEach(function(w){if(!(w===""||w.trim()==="")){var T=w.match(/<(?:\w+:)?comment[^>]*>/);if(T){var o=on(T[0]),k={author:o.authorId&&a[o.authorId]||"sheetjsghost",ref:o.ref,guid:o.guid},R=rs(o.ref);if(!(n.sheetRows&&n.sheetRows<=R.r)){var F=w.match(/<(?:\w+:)?text>([\s\S]*)<\/(?:\w+:)?text>/),B=!!F&&!!F[1]&&GS(F[1])||{r:"",t:"",h:""};k.r=B.r,B.r=="<t></t>"&&(B.t=B.h=""),k.t=(B.t||"").replace(/\r\n/g,`
`).replace(/\r/g,`
`),n.cellHTML&&(k.h=B.h),u.push(k)}}}}),u}function aj(e,n){var a=[],u=!1,f={},_=0;return e.replace(Za,function(T,o){var k=on(T);switch(Fl(k[0])){case"<?xml":break;case"<ThreadedComments":break;case"</ThreadedComments>":break;case"<threadedComment":f={author:k.personId,guid:k.id,ref:k.ref,T:1};break;case"</threadedComment>":f.t!=null&&a.push(f);break;case"<text>":case"<text":_=o+T.length;break;case"</text>":f.t=e.slice(_,o).replace(/\r\n/g,`
`).replace(/\r/g,`
`);break;case"<mentions":case"<mentions>":u=!0;break;case"</mentions>":u=!1;break;case"<extLst":case"<extLst>":case"</extLst>":case"<extLst/>":break;case"<ext":u=!0;break;case"</ext>":u=!1;break;default:if(!u&&n.WTF)throw new Error("unrecognized "+k[0]+" in threaded comments")}return T}),a}function sj(e,n){var a=[],u=!1;return e.replace(Za,function(_){var w=on(_);switch(Fl(w[0])){case"<?xml":break;case"<personList":break;case"</personList>":break;case"<person":a.push({name:w.displayname,id:w.id});break;case"</person>":break;case"<extLst":case"<extLst>":case"</extLst>":case"<extLst/>":break;case"<ext":u=!0;break;case"</ext>":u=!1;break;default:if(!u&&n.WTF)throw new Error("unrecognized "+w[0]+" in threaded comments")}return _}),a}function oj(e){var n={};n.iauthor=e.read_shift(4);var a=mf(e);return n.rfx=a.s,n.ref=yn(a.s),e.l+=16,n}var lj=Ha;function cj(e,n){var a=[],u=[],f={},_=!1;return Sc(e,function(T,o,k){switch(k){case 632:u.push(T);break;case 635:f=T;break;case 637:f.t=T.t,f.h=T.h,f.r=T.r;break;case 636:if(f.author=u[f.iauthor],delete f.iauthor,n.sheetRows&&f.rfx&&n.sheetRows<=f.rfx.r)break;f.t||(f.t=""),delete f.rfx,a.push(f);break;case 3072:break;case 35:_=!0;break;case 36:_=!1;break;case 37:break;case 38:break;default:if(!o.T){if(!_||n.WTF)throw new Error("Unexpected record 0x"+k.toString(16))}}}),a}var uj="application/vnd.ms-office.vbaProject";function hj(e){var n=$n.utils.cfb_new({root:"R"});return e.FullPaths.forEach(function(a,u){if(!(a.slice(-1)==="/"||!a.match(/_VBA_PROJECT_CUR/))){var f=a.replace(/^[^\/]*/,"R").replace(/\/_VBA_PROJECT_CUR\u0000*/,"");$n.utils.cfb_add(n,f,e.FileIndex[u].content)}}),$n.write(n)}function fj(){return{"!type":"dialog"}}function dj(){return{"!type":"dialog"}}function pj(){return{"!type":"macro"}}function mj(){return{"!type":"macro"}}var Yd=function(){var e=/(^|[^A-Za-z_])R(\[?-?\d+\]|[1-9]\d*|)C(\[?-?\d+\]|[1-9]\d*|)(?![A-Za-z0-9_])/g,n={r:0,c:0};function a(u,f,_,w){var T=!1,o=!1;_.length==0?o=!0:_.charAt(0)=="["&&(o=!0,_=_.slice(1,-1)),w.length==0?T=!0:w.charAt(0)=="["&&(T=!0,w=w.slice(1,-1));var k=_.length>0?parseInt(_,10)|0:0,R=w.length>0?parseInt(w,10)|0:0;return T?R+=n.c:--R,o?k+=n.r:--k,f+(T?"":"$")+ca(R)+(o?"":"$")+Ca(k)}return function(f,_){return n=_,f.replace(e,a)}}(),sL=/(^|[^._A-Z0-9])([$]?)([A-Z]{1,2}|[A-W][A-Z]{2}|X[A-E][A-Z]|XF[A-D])([$]?)(10[0-3]\d{4}|104[0-7]\d{3}|1048[0-4]\d{2}|10485[0-6]\d|104857[0-6]|[1-9]\d{0,5})(?![_.\(A-Za-z0-9])/g,gj=function(){return function(n,a){return n.replace(sL,function(u,f,_,w,T,o){var k=zS(w)-(_?0:a.c),R=NS(o)-(T?0:a.r),F=R==0?"":T?R+1:"["+R+"]",B=k==0?"":_?k+1:"["+k+"]";return f+"R"+F+"C"+B})}}();function oL(e,n){return e.replace(sL,function(a,u,f,_,w,T){return u+(f=="$"?f+_:ca(zS(_)+n.c))+(w=="$"?w+T:Ca(NS(T)+n.r))})}function _j(e,n,a){var u=_p(n),f=u.s,_=rs(a),w={r:_.r-f.r,c:_.c-f.c};return oL(e,w)}function xj(e){return e.length!=1}function bP(e){return e.replace(/_xlfn\./g,"")}function ea(e){e.l+=1}function zu(e,n){var a=e.read_shift(n==1?1:2);return[a&16383,a>>14&1,a>>15&1]}function lL(e,n,a){var u=2;if(a){if(a.biff>=2&&a.biff<=5)return cL(e);a.biff==12&&(u=4)}var f=e.read_shift(u),_=e.read_shift(u),w=zu(e,2),T=zu(e,2);return{s:{r:f,c:w[0],cRel:w[1],rRel:w[2]},e:{r:_,c:T[0],cRel:T[1],rRel:T[2]}}}function cL(e){var n=zu(e,2),a=zu(e,2),u=e.read_shift(1),f=e.read_shift(1);return{s:{r:n[0],c:u,cRel:n[1],rRel:n[2]},e:{r:a[0],c:f,cRel:a[1],rRel:a[2]}}}function yj(e,n,a){if(a.biff<8)return cL(e);var u=e.read_shift(a.biff==12?4:2),f=e.read_shift(a.biff==12?4:2),_=zu(e,2),w=zu(e,2);return{s:{r:u,c:_[0],cRel:_[1],rRel:_[2]},e:{r:f,c:w[0],cRel:w[1],rRel:w[2]}}}function uL(e,n,a){if(a&&a.biff>=2&&a.biff<=5)return vj(e);var u=e.read_shift(a&&a.biff==12?4:2),f=zu(e,2);return{r:u,c:f[0],cRel:f[1],rRel:f[2]}}function vj(e){var n=zu(e,2),a=e.read_shift(1);return{r:n[0],c:a,cRel:n[1],rRel:n[2]}}function wj(e){var n=e.read_shift(2),a=e.read_shift(2);return{r:n,c:a&255,fQuoted:!!(a&16384),cRel:a>>15,rRel:a>>15}}function bj(e,n,a){var u=a&&a.biff?a.biff:8;if(u>=2&&u<=5)return Tj(e);var f=e.read_shift(u>=12?4:2),_=e.read_shift(2),w=(_&16384)>>14,T=(_&32768)>>15;if(_&=16383,T==1)for(;f>524287;)f-=1048576;if(w==1)for(;_>8191;)_=_-16384;return{r:f,c:_,cRel:w,rRel:T}}function Tj(e){var n=e.read_shift(2),a=e.read_shift(1),u=(n&32768)>>15,f=(n&16384)>>14;return n&=16383,u==1&&n>=8192&&(n=n-16384),f==1&&a>=128&&(a=a-256),{r:n,c:a,cRel:f,rRel:u}}function Ej(e,n,a){var u=(e[e.l++]&96)>>5,f=lL(e,a.biff>=2&&a.biff<=5?6:8,a);return[u,f]}function Sj(e,n,a){var u=(e[e.l++]&96)>>5,f=e.read_shift(2,"i"),_=8;if(a)switch(a.biff){case 5:e.l+=12,_=6;break;case 12:_=12;break}var w=lL(e,_,a);return[u,f,w]}function Aj(e,n,a){var u=(e[e.l++]&96)>>5;return e.l+=a&&a.biff>8?12:a.biff<8?6:8,[u]}function Cj(e,n,a){var u=(e[e.l++]&96)>>5,f=e.read_shift(2),_=8;if(a)switch(a.biff){case 5:e.l+=12,_=6;break;case 12:_=12;break}return e.l+=_,[u,f]}function kj(e,n,a){var u=(e[e.l++]&96)>>5,f=yj(e,n-1,a);return[u,f]}function Mj(e,n,a){var u=(e[e.l++]&96)>>5;return e.l+=a.biff==2?6:a.biff==12?14:7,[u]}function TP(e){var n=e[e.l+1]&1,a=1;return e.l+=4,[n,a]}function Ij(e,n,a){e.l+=2;for(var u=e.read_shift(a&&a.biff==2?1:2),f=[],_=0;_<=u;++_)f.push(e.read_shift(a&&a.biff==2?1:2));return f}function Pj(e,n,a){var u=e[e.l+1]&255?1:0;return e.l+=2,[u,e.read_shift(a&&a.biff==2?1:2)]}function Rj(e,n,a){var u=e[e.l+1]&255?1:0;return e.l+=2,[u,e.read_shift(a&&a.biff==2?1:2)]}function Dj(e){var n=e[e.l+1]&255?1:0;return e.l+=2,[n,e.read_shift(2)]}function Fj(e,n,a){var u=e[e.l+1]&255?1:0;return e.l+=a&&a.biff==2?3:4,[u]}function hL(e){var n=e.read_shift(1),a=e.read_shift(1);return[n,a]}function Lj(e){return e.read_shift(2),hL(e)}function Oj(e){return e.read_shift(2),hL(e)}function Nj(e,n,a){var u=(e[e.l]&96)>>5;e.l+=1;var f=uL(e,0,a);return[u,f]}function zj(e,n,a){var u=(e[e.l]&96)>>5;e.l+=1;var f=bj(e,0,a);return[u,f]}function Bj(e,n,a){var u=(e[e.l]&96)>>5;e.l+=1;var f=e.read_shift(2);a&&a.biff==5&&(e.l+=12);var _=uL(e,0,a);return[u,f,_]}function Uj(e,n,a){var u=(e[e.l]&96)>>5;e.l+=1;var f=e.read_shift(a&&a.biff<=3?1:2);return[V2[f],pL[f],u]}function Vj(e,n,a){var u=e[e.l++],f=e.read_shift(1),_=a&&a.biff<=3?[u==88?-1:0,e.read_shift(1)]:$j(e);return[f,(_[0]===0?pL:U2)[_[1]]]}function $j(e){return[e[e.l+1]>>7,e.read_shift(2)&32767]}function jj(e,n,a){e.l+=a&&a.biff==2?3:4}function Gj(e,n,a){if(e.l++,a&&a.biff==12)return[e.read_shift(4,"i"),0];var u=e.read_shift(2),f=e.read_shift(a&&a.biff==2?1:2);return[u,f]}function Hj(e){return e.l++,gf[e.read_shift(1)]}function Wj(e){return e.l++,e.read_shift(2)}function qj(e){return e.l++,e.read_shift(1)!==0}function Zj(e){return e.l++,ja(e)}function Xj(e,n,a){return e.l++,Zg(e,n-1,a)}function Yj(e,n){var a=[e.read_shift(1)];if(n==12)switch(a[0]){case 2:a[0]=4;break;case 4:a[0]=16;break;case 0:a[0]=1;break;case 1:a[0]=2;break}switch(a[0]){case 4:a[1]=qi(e,1)?"TRUE":"FALSE",n!=12&&(e.l+=7);break;case 37:case 16:a[1]=gf[e[e.l]],e.l+=n==12?4:8;break;case 0:e.l+=8;break;case 1:a[1]=ja(e);break;case 2:a[1]=_f(e,0,{biff:n>0&&n<8?2:n});break;default:throw new Error("Bad SerAr: "+a[0])}return a}function Kj(e,n,a){for(var u=e.read_shift(a.biff==12?4:2),f=[],_=0;_!=u;++_)f.push((a.biff==12?mf:av)(e));return f}function Jj(e,n,a){var u=0,f=0;a.biff==12?(u=e.read_shift(4),f=e.read_shift(4)):(f=1+e.read_shift(1),u=1+e.read_shift(2)),a.biff>=2&&a.biff<8&&(--u,--f==0&&(f=256));for(var _=0,w=[];_!=u&&(w[_]=[]);++_)for(var T=0;T!=f;++T)w[_][T]=Yj(e,a.biff);return w}function Qj(e,n,a){var u=e.read_shift(1)>>>5&3,f=!a||a.biff>=8?4:2,_=e.read_shift(f);switch(a.biff){case 2:e.l+=5;break;case 3:case 4:e.l+=8;break;case 5:e.l+=12;break}return[u,0,_]}function e2(e,n,a){if(a.biff==5)return t2(e);var u=e.read_shift(1)>>>5&3,f=e.read_shift(2),_=e.read_shift(4);return[u,f,_]}function t2(e){var n=e.read_shift(1)>>>5&3,a=e.read_shift(2,"i");e.l+=8;var u=e.read_shift(2);return e.l+=12,[n,a,u]}function r2(e,n,a){var u=e.read_shift(1)>>>5&3;e.l+=a&&a.biff==2?3:4;var f=e.read_shift(a&&a.biff==2?1:2);return[u,f]}function n2(e,n,a){var u=e.read_shift(1)>>>5&3,f=e.read_shift(a&&a.biff==2?1:2);return[u,f]}function i2(e,n,a){var u=e.read_shift(1)>>>5&3;return e.l+=4,a.biff<8&&e.l--,a.biff==12&&(e.l+=2),[u]}function a2(e,n,a){var u=(e[e.l++]&96)>>5,f=e.read_shift(2),_=4;if(a)switch(a.biff){case 5:_=15;break;case 12:_=6;break}return e.l+=_,[u,f]}var s2=qa,o2=qa,l2=qa;function Yg(e,n,a){return e.l+=2,[wj(e)]}function WS(e){return e.l+=6,[]}var c2=Yg,u2=WS,h2=WS,f2=Yg;function fL(e){return e.l+=2,[ra(e),e.read_shift(2)&1]}var d2=Yg,p2=fL,m2=WS,g2=Yg,_2=Yg,x2=["Data","All","Headers","??","?Data2","??","?DataHeaders","??","Totals","??","??","??","?DataTotals","??","??","??","?Current"];function y2(e){e.l+=2;var n=e.read_shift(2),a=e.read_shift(2),u=e.read_shift(4),f=e.read_shift(2),_=e.read_shift(2),w=x2[a>>2&31];return{ixti:n,coltype:a&3,rt:w,idx:u,c:f,C:_}}function v2(e){return e.l+=2,[e.read_shift(4)]}function w2(e,n,a){return e.l+=5,e.l+=2,e.l+=a.biff==2?1:4,["PTGSHEET"]}function b2(e,n,a){return e.l+=a.biff==2?4:5,["PTGENDSHEET"]}function T2(e){var n=e.read_shift(1)>>>5&3,a=e.read_shift(2);return[n,a]}function E2(e){var n=e.read_shift(1)>>>5&3,a=e.read_shift(2);return[n,a]}function S2(e){return e.l+=4,[0,0]}var EP={1:{n:"PtgExp",f:Gj},2:{n:"PtgTbl",f:l2},3:{n:"PtgAdd",f:ea},4:{n:"PtgSub",f:ea},5:{n:"PtgMul",f:ea},6:{n:"PtgDiv",f:ea},7:{n:"PtgPower",f:ea},8:{n:"PtgConcat",f:ea},9:{n:"PtgLt",f:ea},10:{n:"PtgLe",f:ea},11:{n:"PtgEq",f:ea},12:{n:"PtgGe",f:ea},13:{n:"PtgGt",f:ea},14:{n:"PtgNe",f:ea},15:{n:"PtgIsect",f:ea},16:{n:"PtgUnion",f:ea},17:{n:"PtgRange",f:ea},18:{n:"PtgUplus",f:ea},19:{n:"PtgUminus",f:ea},20:{n:"PtgPercent",f:ea},21:{n:"PtgParen",f:ea},22:{n:"PtgMissArg",f:ea},23:{n:"PtgStr",f:Xj},26:{n:"PtgSheet",f:w2},27:{n:"PtgEndSheet",f:b2},28:{n:"PtgErr",f:Hj},29:{n:"PtgBool",f:qj},30:{n:"PtgInt",f:Wj},31:{n:"PtgNum",f:Zj},32:{n:"PtgArray",f:Mj},33:{n:"PtgFunc",f:Uj},34:{n:"PtgFuncVar",f:Vj},35:{n:"PtgName",f:Qj},36:{n:"PtgRef",f:Nj},37:{n:"PtgArea",f:Ej},38:{n:"PtgMemArea",f:r2},39:{n:"PtgMemErr",f:s2},40:{n:"PtgMemNoMem",f:o2},41:{n:"PtgMemFunc",f:n2},42:{n:"PtgRefErr",f:i2},43:{n:"PtgAreaErr",f:Aj},44:{n:"PtgRefN",f:zj},45:{n:"PtgAreaN",f:kj},46:{n:"PtgMemAreaN",f:T2},47:{n:"PtgMemNoMemN",f:E2},57:{n:"PtgNameX",f:e2},58:{n:"PtgRef3d",f:Bj},59:{n:"PtgArea3d",f:Sj},60:{n:"PtgRefErr3d",f:a2},61:{n:"PtgAreaErr3d",f:Cj},255:{}},A2={64:32,96:32,65:33,97:33,66:34,98:34,67:35,99:35,68:36,100:36,69:37,101:37,70:38,102:38,71:39,103:39,72:40,104:40,73:41,105:41,74:42,106:42,75:43,107:43,76:44,108:44,77:45,109:45,78:46,110:46,79:47,111:47,88:34,120:34,89:57,121:57,90:58,122:58,91:59,123:59,92:60,124:60,93:61,125:61},C2={1:{n:"PtgElfLel",f:fL},2:{n:"PtgElfRw",f:g2},3:{n:"PtgElfCol",f:c2},6:{n:"PtgElfRwV",f:_2},7:{n:"PtgElfColV",f:f2},10:{n:"PtgElfRadical",f:d2},11:{n:"PtgElfRadicalS",f:m2},13:{n:"PtgElfColS",f:u2},15:{n:"PtgElfColSV",f:h2},16:{n:"PtgElfRadicalLel",f:p2},25:{n:"PtgList",f:y2},29:{n:"PtgSxName",f:v2},255:{}},k2={0:{n:"PtgAttrNoop",f:S2},1:{n:"PtgAttrSemi",f:Fj},2:{n:"PtgAttrIf",f:Rj},4:{n:"PtgAttrChoose",f:Ij},8:{n:"PtgAttrGoto",f:Pj},16:{n:"PtgAttrSum",f:jj},32:{n:"PtgAttrBaxcel",f:TP},33:{n:"PtgAttrBaxcel",f:TP},64:{n:"PtgAttrSpace",f:Lj},65:{n:"PtgAttrSpaceSemi",f:Oj},128:{n:"PtgAttrIfError",f:Dj},255:{}};function Kg(e,n,a,u){if(u.biff<8)return qa(e,n);for(var f=e.l+n,_=[],w=0;w!==a.length;++w)switch(a[w][0]){case"PtgArray":a[w][1]=Jj(e,0,u),_.push(a[w][1]);break;case"PtgMemArea":a[w][2]=Kj(e,a[w][1],u),_.push(a[w][2]);break;case"PtgExp":u&&u.biff==12&&(a[w][1][1]=e.read_shift(4),_.push(a[w][1]));break;case"PtgList":case"PtgElfRadicalS":case"PtgElfColS":case"PtgElfColSV":throw"Unsupported "+a[w][0]}return n=f-e.l,n!==0&&_.push(qa(e,n)),_}function Jg(e,n,a){for(var u=e.l+n,f,_,w=[];u!=e.l;)n=u-e.l,_=e[e.l],f=EP[_]||EP[A2[_]],(_===24||_===25)&&(f=(_===24?C2:k2)[e[e.l+1]]),!f||!f.f?qa(e,n):w.push([f.n,f.f(e,n,a)]);return w}function M2(e){for(var n=[],a=0;a<e.length;++a){for(var u=e[a],f=[],_=0;_<u.length;++_){var w=u[_];if(w)switch(w[0]){case 2:f.push('"'+w[1].replace(/"/g,'""')+'"');break;default:f.push(w[1])}else f.push("")}n.push(f.join(","))}return n.join(";")}var I2={PtgAdd:"+",PtgConcat:"&",PtgDiv:"/",PtgEq:"=",PtgGe:">=",PtgGt:">",PtgLe:"<=",PtgLt:"<",PtgMul:"*",PtgNe:"<>",PtgPower:"^",PtgSub:"-"};function P2(e,n){if(!e&&!(n&&n.biff<=5&&n.biff>=2))throw new Error("empty sheet name");return/[^\w\u4E00-\u9FFF\u3040-\u30FF]/.test(e)?"'"+e+"'":e}function dL(e,n,a){if(!e)return"SH33TJSERR0";if(a.biff>8&&(!e.XTI||!e.XTI[n]))return e.SheetNames[n];if(!e.XTI)return"SH33TJSERR6";var u=e.XTI[n];if(a.biff<8)return n>1e4&&(n-=65536),n<0&&(n=-n),n==0?"":e.XTI[n-1];if(!u)return"SH33TJSERR1";var f="";if(a.biff>8)switch(e[u[0]][0]){case 357:return f=u[1]==-1?"#REF":e.SheetNames[u[1]],u[1]==u[2]?f:f+":"+e.SheetNames[u[2]];case 358:return a.SID!=null?e.SheetNames[a.SID]:"SH33TJSSAME"+e[u[0]][0];case 355:default:return"SH33TJSSRC"+e[u[0]][0]}switch(e[u[0]][0][0]){case 1025:return f=u[1]==-1?"#REF":e.SheetNames[u[1]]||"SH33TJSERR3",u[1]==u[2]?f:f+":"+e.SheetNames[u[2]];case 14849:return e[u[0]].slice(1).map(function(_){return _.Name}).join(";;");default:return e[u[0]][0][3]?(f=u[1]==-1?"#REF":e[u[0]][0][3][u[1]]||"SH33TJSERR4",u[1]==u[2]?f:f+":"+e[u[0]][0][3][u[2]]):"SH33TJSERR2"}}function SP(e,n,a){var u=dL(e,n,a);return u=="#REF"?u:P2(u,a)}function Va(e,n,a,u,f){var _=f&&f.biff||8,w={s:{c:0,r:0},e:{c:0,r:0}},T=[],o,k,R,F=0,B=0,V,G="";if(!e[0]||!e[0][0])return"";for(var U=-1,J="",X=0,Y=e[0].length;X<Y;++X){var Z=e[0][X];switch(Z[0]){case"PtgUminus":T.push("-"+T.pop());break;case"PtgUplus":T.push("+"+T.pop());break;case"PtgPercent":T.push(T.pop()+"%");break;case"PtgAdd":case"PtgConcat":case"PtgDiv":case"PtgEq":case"PtgGe":case"PtgGt":case"PtgLe":case"PtgLt":case"PtgMul":case"PtgNe":case"PtgPower":case"PtgSub":if(o=T.pop(),k=T.pop(),U>=0){switch(e[0][U][1][0]){case 0:J=Ui(" ",e[0][U][1][1]);break;case 1:J=Ui("\r",e[0][U][1][1]);break;default:if(J="",f.WTF)throw new Error("Unexpected PtgAttrSpaceType "+e[0][U][1][0])}k=k+J,U=-1}T.push(k+I2[Z[0]]+o);break;case"PtgIsect":o=T.pop(),k=T.pop(),T.push(k+" "+o);break;case"PtgUnion":o=T.pop(),k=T.pop(),T.push(k+","+o);break;case"PtgRange":o=T.pop(),k=T.pop(),T.push(k+":"+o);break;case"PtgAttrChoose":break;case"PtgAttrGoto":break;case"PtgAttrIf":break;case"PtgAttrIfError":break;case"PtgRef":R=ng(Z[1][1],w,f),T.push(ig(R,_));break;case"PtgRefN":R=a?ng(Z[1][1],a,f):Z[1][1],T.push(ig(R,_));break;case"PtgRef3d":F=Z[1][1],R=ng(Z[1][2],w,f),G=SP(u,F,f),T.push(G+"!"+ig(R,_));break;case"PtgFunc":case"PtgFuncVar":var _e=Z[1][0],ke=Z[1][1];_e||(_e=0),_e&=127;var Ae=_e==0?[]:T.slice(-_e);T.length-=_e,ke==="User"&&(ke=Ae.shift()),T.push(ke+"("+Ae.join(",")+")");break;case"PtgBool":T.push(Z[1]?"TRUE":"FALSE");break;case"PtgInt":T.push(Z[1]);break;case"PtgNum":T.push(String(Z[1]));break;case"PtgStr":T.push('"'+Z[1].replace(/"/g,'""')+'"');break;case"PtgErr":T.push(Z[1]);break;case"PtgAreaN":V=aP(Z[1][1],a?{s:a}:w,f),T.push(Nb(V,f));break;case"PtgArea":V=aP(Z[1][1],w,f),T.push(Nb(V,f));break;case"PtgArea3d":F=Z[1][1],V=Z[1][2],G=SP(u,F,f),T.push(G+"!"+Nb(V,f));break;case"PtgAttrSum":T.push("SUM("+T.pop()+")");break;case"PtgAttrBaxcel":case"PtgAttrSemi":break;case"PtgName":B=Z[1][2];var me=(u.names||[])[B-1]||(u[0]||[])[B],De=me?me.Name:"SH33TJSNAME"+String(B);De&&De.slice(0,6)=="_xlfn."&&!f.xlfn&&(De=De.slice(6)),T.push(De);break;case"PtgNameX":var we=Z[1][1];B=Z[1][2];var Je;if(f.biff<=5)we<0&&(we=-we),u[we]&&(Je=u[we][B]);else{var rt="";if(((u[we]||[])[0]||[])[0]==14849||(((u[we]||[])[0]||[])[0]==1025?u[we][B]&&u[we][B].itab>0&&(rt=u.SheetNames[u[we][B].itab-1]+"!"):rt=u.SheetNames[B-1]+"!"),u[we]&&u[we][B])rt+=u[we][B].Name;else if(u[0]&&u[0][B])rt+=u[0][B].Name;else{var Re=(dL(u,we,f)||"").split(";;");Re[B-1]?rt=Re[B-1]:rt+="SH33TJSERRX"}T.push(rt);break}Je||(Je={Name:"SH33TJSERRY"}),T.push(Je.Name);break;case"PtgParen":var St="(",Lt=")";if(U>=0){switch(J="",e[0][U][1][0]){case 2:St=Ui(" ",e[0][U][1][1])+St;break;case 3:St=Ui("\r",e[0][U][1][1])+St;break;case 4:Lt=Ui(" ",e[0][U][1][1])+Lt;break;case 5:Lt=Ui("\r",e[0][U][1][1])+Lt;break;default:if(f.WTF)throw new Error("Unexpected PtgAttrSpaceType "+e[0][U][1][0])}U=-1}T.push(St+T.pop()+Lt);break;case"PtgRefErr":T.push("#REF!");break;case"PtgRefErr3d":T.push("#REF!");break;case"PtgExp":R={c:Z[1][1],r:Z[1][0]};var We={c:a.c,r:a.r};if(u.sharedf[yn(R)]){var qt=u.sharedf[yn(R)];T.push(Va(qt,w,We,u,f))}else{var Ot=!1;for(o=0;o!=u.arrayf.length;++o)if(k=u.arrayf[o],!(R.c<k[0].s.c||R.c>k[0].e.c)&&!(R.r<k[0].s.r||R.r>k[0].e.r)){T.push(Va(k[1],w,We,u,f)),Ot=!0;break}Ot||T.push(Z[1])}break;case"PtgArray":T.push("{"+M2(Z[1])+"}");break;case"PtgMemArea":break;case"PtgAttrSpace":case"PtgAttrSpaceSemi":U=X;break;case"PtgTbl":break;case"PtgMemErr":break;case"PtgMissArg":T.push("");break;case"PtgAreaErr":T.push("#REF!");break;case"PtgAreaErr3d":T.push("#REF!");break;case"PtgList":T.push("Table"+Z[1].idx+"[#"+Z[1].rt+"]");break;case"PtgMemAreaN":case"PtgMemNoMemN":case"PtgAttrNoop":case"PtgSheet":case"PtgEndSheet":break;case"PtgMemFunc":break;case"PtgMemNoMem":break;case"PtgElfCol":case"PtgElfColS":case"PtgElfColSV":case"PtgElfColV":case"PtgElfLel":case"PtgElfRadical":case"PtgElfRadicalLel":case"PtgElfRadicalS":case"PtgElfRw":case"PtgElfRwV":throw new Error("Unsupported ELFs");case"PtgSxName":throw new Error("Unrecognized Formula Token: "+String(Z));default:throw new Error("Unrecognized Formula Token: "+String(Z))}var st=["PtgAttrSpace","PtgAttrSpaceSemi","PtgAttrGoto"];if(f.biff!=3&&U>=0&&st.indexOf(e[0][X][0])==-1){Z=e[0][U];var Ve=!0;switch(Z[1][0]){case 4:Ve=!1;case 0:J=Ui(" ",Z[1][1]);break;case 5:Ve=!1;case 1:J=Ui("\r",Z[1][1]);break;default:if(J="",f.WTF)throw new Error("Unexpected PtgAttrSpaceType "+Z[1][0])}T.push((Ve?J:"")+T.pop()+(Ve?"":J)),U=-1}}if(T.length>1&&f.WTF)throw new Error("bad formula stack");return T[0]}function R2(e,n,a){var u=e.l+n,f=a.biff==2?1:2,_,w=e.read_shift(f);if(w==65535)return[[],qa(e,n-2)];var T=Jg(e,w,a);return n!==w+f&&(_=Kg(e,n-w-f,T,a)),e.l=u,[T,_]}function D2(e,n,a){var u=e.l+n,f=a.biff==2?1:2,_,w=e.read_shift(f);if(w==65535)return[[],qa(e,n-2)];var T=Jg(e,w,a);return n!==w+f&&(_=Kg(e,n-w-f,T,a)),e.l=u,[T,_]}function F2(e,n,a,u){var f=e.l+n,_=Jg(e,u,a),w;return f!==e.l&&(w=Kg(e,f-e.l,_,a)),[_,w]}function L2(e,n,a){var u=e.l+n,f,_=e.read_shift(2),w=Jg(e,_,a);return _==65535?[[],qa(e,n-2)]:(n!==_+2&&(f=Kg(e,u-_-2,w,a)),[w,f])}function O2(e){var n;if(hc(e,e.l+6)!==65535)return[ja(e),"n"];switch(e[e.l]){case 0:return e.l+=8,["String","s"];case 1:return n=e[e.l+2]===1,e.l+=8,[n,"b"];case 2:return n=e[e.l+2],e.l+=8,[n,"e"];case 3:return e.l+=8,["","s"]}return[]}function Ub(e,n,a){var u=e.l+n,f=Ll(e);a.biff==2&&++e.l;var _=O2(e),w=e.read_shift(1);a.biff!=2&&(e.read_shift(1),a.biff>=5&&e.read_shift(4));var T=D2(e,u-e.l,a);return{cell:f,val:_[0],formula:T,shared:w>>3&1,tt:_[1]}}function sv(e,n,a){var u=e.read_shift(4),f=Jg(e,u,a),_=e.read_shift(4),w=_>0?Kg(e,_,f,a):null;return[f,w]}var N2=sv,ov=sv,z2=sv,B2=sv,U2={0:"BEEP",1:"OPEN",2:"OPEN.LINKS",3:"CLOSE.ALL",4:"SAVE",5:"SAVE.AS",6:"FILE.DELETE",7:"PAGE.SETUP",8:"PRINT",9:"PRINTER.SETUP",10:"QUIT",11:"NEW.WINDOW",12:"ARRANGE.ALL",13:"WINDOW.SIZE",14:"WINDOW.MOVE",15:"FULL",16:"CLOSE",17:"RUN",22:"SET.PRINT.AREA",23:"SET.PRINT.TITLES",24:"SET.PAGE.BREAK",25:"REMOVE.PAGE.BREAK",26:"FONT",27:"DISPLAY",28:"PROTECT.DOCUMENT",29:"PRECISION",30:"A1.R1C1",31:"CALCULATE.NOW",32:"CALCULATION",34:"DATA.FIND",35:"EXTRACT",36:"DATA.DELETE",37:"SET.DATABASE",38:"SET.CRITERIA",39:"SORT",40:"DATA.SERIES",41:"TABLE",42:"FORMAT.NUMBER",43:"ALIGNMENT",44:"STYLE",45:"BORDER",46:"CELL.PROTECTION",47:"COLUMN.WIDTH",48:"UNDO",49:"CUT",50:"COPY",51:"PASTE",52:"CLEAR",53:"PASTE.SPECIAL",54:"EDIT.DELETE",55:"INSERT",56:"FILL.RIGHT",57:"FILL.DOWN",61:"DEFINE.NAME",62:"CREATE.NAMES",63:"FORMULA.GOTO",64:"FORMULA.FIND",65:"SELECT.LAST.CELL",66:"SHOW.ACTIVE.CELL",67:"GALLERY.AREA",68:"GALLERY.BAR",69:"GALLERY.COLUMN",70:"GALLERY.LINE",71:"GALLERY.PIE",72:"GALLERY.SCATTER",73:"COMBINATION",74:"PREFERRED",75:"ADD.OVERLAY",76:"GRIDLINES",77:"SET.PREFERRED",78:"AXES",79:"LEGEND",80:"ATTACH.TEXT",81:"ADD.ARROW",82:"SELECT.CHART",83:"SELECT.PLOT.AREA",84:"PATTERNS",85:"MAIN.CHART",86:"OVERLAY",87:"SCALE",88:"FORMAT.LEGEND",89:"FORMAT.TEXT",90:"EDIT.REPEAT",91:"PARSE",92:"JUSTIFY",93:"HIDE",94:"UNHIDE",95:"WORKSPACE",96:"FORMULA",97:"FORMULA.FILL",98:"FORMULA.ARRAY",99:"DATA.FIND.NEXT",100:"DATA.FIND.PREV",101:"FORMULA.FIND.NEXT",102:"FORMULA.FIND.PREV",103:"ACTIVATE",104:"ACTIVATE.NEXT",105:"ACTIVATE.PREV",106:"UNLOCKED.NEXT",107:"UNLOCKED.PREV",108:"COPY.PICTURE",109:"SELECT",110:"DELETE.NAME",111:"DELETE.FORMAT",112:"VLINE",113:"HLINE",114:"VPAGE",115:"HPAGE",116:"VSCROLL",117:"HSCROLL",118:"ALERT",119:"NEW",120:"CANCEL.COPY",121:"SHOW.CLIPBOARD",122:"MESSAGE",124:"PASTE.LINK",125:"APP.ACTIVATE",126:"DELETE.ARROW",127:"ROW.HEIGHT",128:"FORMAT.MOVE",129:"FORMAT.SIZE",130:"FORMULA.REPLACE",131:"SEND.KEYS",132:"SELECT.SPECIAL",133:"APPLY.NAMES",134:"REPLACE.FONT",135:"FREEZE.PANES",136:"SHOW.INFO",137:"SPLIT",138:"ON.WINDOW",139:"ON.DATA",140:"DISABLE.INPUT",142:"OUTLINE",143:"LIST.NAMES",144:"FILE.CLOSE",145:"SAVE.WORKBOOK",146:"DATA.FORM",147:"COPY.CHART",148:"ON.TIME",149:"WAIT",150:"FORMAT.FONT",151:"FILL.UP",152:"FILL.LEFT",153:"DELETE.OVERLAY",155:"SHORT.MENUS",159:"SET.UPDATE.STATUS",161:"COLOR.PALETTE",162:"DELETE.STYLE",163:"WINDOW.RESTORE",164:"WINDOW.MAXIMIZE",166:"CHANGE.LINK",167:"CALCULATE.DOCUMENT",168:"ON.KEY",169:"APP.RESTORE",170:"APP.MOVE",171:"APP.SIZE",172:"APP.MINIMIZE",173:"APP.MAXIMIZE",174:"BRING.TO.FRONT",175:"SEND.TO.BACK",185:"MAIN.CHART.TYPE",186:"OVERLAY.CHART.TYPE",187:"SELECT.END",188:"OPEN.MAIL",189:"SEND.MAIL",190:"STANDARD.FONT",191:"CONSOLIDATE",192:"SORT.SPECIAL",193:"GALLERY.3D.AREA",194:"GALLERY.3D.COLUMN",195:"GALLERY.3D.LINE",196:"GALLERY.3D.PIE",197:"VIEW.3D",198:"GOAL.SEEK",199:"WORKGROUP",200:"FILL.GROUP",201:"UPDATE.LINK",202:"PROMOTE",203:"DEMOTE",204:"SHOW.DETAIL",206:"UNGROUP",207:"OBJECT.PROPERTIES",208:"SAVE.NEW.OBJECT",209:"SHARE",210:"SHARE.NAME",211:"DUPLICATE",212:"APPLY.STYLE",213:"ASSIGN.TO.OBJECT",214:"OBJECT.PROTECTION",215:"HIDE.OBJECT",216:"SET.EXTRACT",217:"CREATE.PUBLISHER",218:"SUBSCRIBE.TO",219:"ATTRIBUTES",220:"SHOW.TOOLBAR",222:"PRINT.PREVIEW",223:"EDIT.COLOR",224:"SHOW.LEVELS",225:"FORMAT.MAIN",226:"FORMAT.OVERLAY",227:"ON.RECALC",228:"EDIT.SERIES",229:"DEFINE.STYLE",240:"LINE.PRINT",243:"ENTER.DATA",249:"GALLERY.RADAR",250:"MERGE.STYLES",251:"EDITION.OPTIONS",252:"PASTE.PICTURE",253:"PASTE.PICTURE.LINK",254:"SPELLING",256:"ZOOM",259:"INSERT.OBJECT",260:"WINDOW.MINIMIZE",265:"SOUND.NOTE",266:"SOUND.PLAY",267:"FORMAT.SHAPE",268:"EXTEND.POLYGON",269:"FORMAT.AUTO",272:"GALLERY.3D.BAR",273:"GALLERY.3D.SURFACE",274:"FILL.AUTO",276:"CUSTOMIZE.TOOLBAR",277:"ADD.TOOL",278:"EDIT.OBJECT",279:"ON.DOUBLECLICK",280:"ON.ENTRY",281:"WORKBOOK.ADD",282:"WORKBOOK.MOVE",283:"WORKBOOK.COPY",284:"WORKBOOK.OPTIONS",285:"SAVE.WORKSPACE",288:"CHART.WIZARD",289:"DELETE.TOOL",290:"MOVE.TOOL",291:"WORKBOOK.SELECT",292:"WORKBOOK.ACTIVATE",293:"ASSIGN.TO.TOOL",295:"COPY.TOOL",296:"RESET.TOOL",297:"CONSTRAIN.NUMERIC",298:"PASTE.TOOL",302:"WORKBOOK.NEW",305:"SCENARIO.CELLS",306:"SCENARIO.DELETE",307:"SCENARIO.ADD",308:"SCENARIO.EDIT",309:"SCENARIO.SHOW",310:"SCENARIO.SHOW.NEXT",311:"SCENARIO.SUMMARY",312:"PIVOT.TABLE.WIZARD",313:"PIVOT.FIELD.PROPERTIES",314:"PIVOT.FIELD",315:"PIVOT.ITEM",316:"PIVOT.ADD.FIELDS",318:"OPTIONS.CALCULATION",319:"OPTIONS.EDIT",320:"OPTIONS.VIEW",321:"ADDIN.MANAGER",322:"MENU.EDITOR",323:"ATTACH.TOOLBARS",324:"VBAActivate",325:"OPTIONS.CHART",328:"VBA.INSERT.FILE",330:"VBA.PROCEDURE.DEFINITION",336:"ROUTING.SLIP",338:"ROUTE.DOCUMENT",339:"MAIL.LOGON",342:"INSERT.PICTURE",343:"EDIT.TOOL",344:"GALLERY.DOUGHNUT",350:"CHART.TREND",352:"PIVOT.ITEM.PROPERTIES",354:"WORKBOOK.INSERT",355:"OPTIONS.TRANSITION",356:"OPTIONS.GENERAL",370:"FILTER.ADVANCED",373:"MAIL.ADD.MAILER",374:"MAIL.DELETE.MAILER",375:"MAIL.REPLY",376:"MAIL.REPLY.ALL",377:"MAIL.FORWARD",378:"MAIL.NEXT.LETTER",379:"DATA.LABEL",380:"INSERT.TITLE",381:"FONT.PROPERTIES",382:"MACRO.OPTIONS",383:"WORKBOOK.HIDE",384:"WORKBOOK.UNHIDE",385:"WORKBOOK.DELETE",386:"WORKBOOK.NAME",388:"GALLERY.CUSTOM",390:"ADD.CHART.AUTOFORMAT",391:"DELETE.CHART.AUTOFORMAT",392:"CHART.ADD.DATA",393:"AUTO.OUTLINE",394:"TAB.ORDER",395:"SHOW.DIALOG",396:"SELECT.ALL",397:"UNGROUP.SHEETS",398:"SUBTOTAL.CREATE",399:"SUBTOTAL.REMOVE",400:"RENAME.OBJECT",412:"WORKBOOK.SCROLL",413:"WORKBOOK.NEXT",414:"WORKBOOK.PREV",415:"WORKBOOK.TAB.SPLIT",416:"FULL.SCREEN",417:"WORKBOOK.PROTECT",420:"SCROLLBAR.PROPERTIES",421:"PIVOT.SHOW.PAGES",422:"TEXT.TO.COLUMNS",423:"FORMAT.CHARTTYPE",424:"LINK.FORMAT",425:"TRACER.DISPLAY",430:"TRACER.NAVIGATE",431:"TRACER.CLEAR",432:"TRACER.ERROR",433:"PIVOT.FIELD.GROUP",434:"PIVOT.FIELD.UNGROUP",435:"CHECKBOX.PROPERTIES",436:"LABEL.PROPERTIES",437:"LISTBOX.PROPERTIES",438:"EDITBOX.PROPERTIES",439:"PIVOT.REFRESH",440:"LINK.COMBO",441:"OPEN.TEXT",442:"HIDE.DIALOG",443:"SET.DIALOG.FOCUS",444:"ENABLE.OBJECT",445:"PUSHBUTTON.PROPERTIES",446:"SET.DIALOG.DEFAULT",447:"FILTER",448:"FILTER.SHOW.ALL",449:"CLEAR.OUTLINE",450:"FUNCTION.WIZARD",451:"ADD.LIST.ITEM",452:"SET.LIST.ITEM",453:"REMOVE.LIST.ITEM",454:"SELECT.LIST.ITEM",455:"SET.CONTROL.VALUE",456:"SAVE.COPY.AS",458:"OPTIONS.LISTS.ADD",459:"OPTIONS.LISTS.DELETE",460:"SERIES.AXES",461:"SERIES.X",462:"SERIES.Y",463:"ERRORBAR.X",464:"ERRORBAR.Y",465:"FORMAT.CHART",466:"SERIES.ORDER",467:"MAIL.LOGOFF",468:"CLEAR.ROUTING.SLIP",469:"APP.ACTIVATE.MICROSOFT",470:"MAIL.EDIT.MAILER",471:"ON.SHEET",472:"STANDARD.WIDTH",473:"SCENARIO.MERGE",474:"SUMMARY.INFO",475:"FIND.FILE",476:"ACTIVE.CELL.FONT",477:"ENABLE.TIPWIZARD",478:"VBA.MAKE.ADDIN",480:"INSERTDATATABLE",481:"WORKGROUP.OPTIONS",482:"MAIL.SEND.MAILER",485:"AUTOCORRECT",489:"POST.DOCUMENT",491:"PICKLIST",493:"VIEW.SHOW",494:"VIEW.DEFINE",495:"VIEW.DELETE",509:"SHEET.BACKGROUND",510:"INSERT.MAP.OBJECT",511:"OPTIONS.MENONO",517:"MSOCHECKS",518:"NORMAL",519:"LAYOUT",520:"RM.PRINT.AREA",521:"CLEAR.PRINT.AREA",522:"ADD.PRINT.AREA",523:"MOVE.BRK",545:"HIDECURR.NOTE",546:"HIDEALL.NOTES",547:"DELETE.NOTE",548:"TRAVERSE.NOTES",549:"ACTIVATE.NOTES",620:"PROTECT.REVISIONS",621:"UNPROTECT.REVISIONS",647:"OPTIONS.ME",653:"WEB.PUBLISH",667:"NEWWEBQUERY",673:"PIVOT.TABLE.CHART",753:"OPTIONS.SAVE",755:"OPTIONS.SPELL",808:"HIDEALL.INKANNOTS"},pL={0:"COUNT",1:"IF",2:"ISNA",3:"ISERROR",4:"SUM",5:"AVERAGE",6:"MIN",7:"MAX",8:"ROW",9:"COLUMN",10:"NA",11:"NPV",12:"STDEV",13:"DOLLAR",14:"FIXED",15:"SIN",16:"COS",17:"TAN",18:"ATAN",19:"PI",20:"SQRT",21:"EXP",22:"LN",23:"LOG10",24:"ABS",25:"INT",26:"SIGN",27:"ROUND",28:"LOOKUP",29:"INDEX",30:"REPT",31:"MID",32:"LEN",33:"VALUE",34:"TRUE",35:"FALSE",36:"AND",37:"OR",38:"NOT",39:"MOD",40:"DCOUNT",41:"DSUM",42:"DAVERAGE",43:"DMIN",44:"DMAX",45:"DSTDEV",46:"VAR",47:"DVAR",48:"TEXT",49:"LINEST",50:"TREND",51:"LOGEST",52:"GROWTH",53:"GOTO",54:"HALT",55:"RETURN",56:"PV",57:"FV",58:"NPER",59:"PMT",60:"RATE",61:"MIRR",62:"IRR",63:"RAND",64:"MATCH",65:"DATE",66:"TIME",67:"DAY",68:"MONTH",69:"YEAR",70:"WEEKDAY",71:"HOUR",72:"MINUTE",73:"SECOND",74:"NOW",75:"AREAS",76:"ROWS",77:"COLUMNS",78:"OFFSET",79:"ABSREF",80:"RELREF",81:"ARGUMENT",82:"SEARCH",83:"TRANSPOSE",84:"ERROR",85:"STEP",86:"TYPE",87:"ECHO",88:"SET.NAME",89:"CALLER",90:"DEREF",91:"WINDOWS",92:"SERIES",93:"DOCUMENTS",94:"ACTIVE.CELL",95:"SELECTION",96:"RESULT",97:"ATAN2",98:"ASIN",99:"ACOS",100:"CHOOSE",101:"HLOOKUP",102:"VLOOKUP",103:"LINKS",104:"INPUT",105:"ISREF",106:"GET.FORMULA",107:"GET.NAME",108:"SET.VALUE",109:"LOG",110:"EXEC",111:"CHAR",112:"LOWER",113:"UPPER",114:"PROPER",115:"LEFT",116:"RIGHT",117:"EXACT",118:"TRIM",119:"REPLACE",120:"SUBSTITUTE",121:"CODE",122:"NAMES",123:"DIRECTORY",124:"FIND",125:"CELL",126:"ISERR",127:"ISTEXT",128:"ISNUMBER",129:"ISBLANK",130:"T",131:"N",132:"FOPEN",133:"FCLOSE",134:"FSIZE",135:"FREADLN",136:"FREAD",137:"FWRITELN",138:"FWRITE",139:"FPOS",140:"DATEVALUE",141:"TIMEVALUE",142:"SLN",143:"SYD",144:"DDB",145:"GET.DEF",146:"REFTEXT",147:"TEXTREF",148:"INDIRECT",149:"REGISTER",150:"CALL",151:"ADD.BAR",152:"ADD.MENU",153:"ADD.COMMAND",154:"ENABLE.COMMAND",155:"CHECK.COMMAND",156:"RENAME.COMMAND",157:"SHOW.BAR",158:"DELETE.MENU",159:"DELETE.COMMAND",160:"GET.CHART.ITEM",161:"DIALOG.BOX",162:"CLEAN",163:"MDETERM",164:"MINVERSE",165:"MMULT",166:"FILES",167:"IPMT",168:"PPMT",169:"COUNTA",170:"CANCEL.KEY",171:"FOR",172:"WHILE",173:"BREAK",174:"NEXT",175:"INITIATE",176:"REQUEST",177:"POKE",178:"EXECUTE",179:"TERMINATE",180:"RESTART",181:"HELP",182:"GET.BAR",183:"PRODUCT",184:"FACT",185:"GET.CELL",186:"GET.WORKSPACE",187:"GET.WINDOW",188:"GET.DOCUMENT",189:"DPRODUCT",190:"ISNONTEXT",191:"GET.NOTE",192:"NOTE",193:"STDEVP",194:"VARP",195:"DSTDEVP",196:"DVARP",197:"TRUNC",198:"ISLOGICAL",199:"DCOUNTA",200:"DELETE.BAR",201:"UNREGISTER",204:"USDOLLAR",205:"FINDB",206:"SEARCHB",207:"REPLACEB",208:"LEFTB",209:"RIGHTB",210:"MIDB",211:"LENB",212:"ROUNDUP",213:"ROUNDDOWN",214:"ASC",215:"DBCS",216:"RANK",219:"ADDRESS",220:"DAYS360",221:"TODAY",222:"VDB",223:"ELSE",224:"ELSE.IF",225:"END.IF",226:"FOR.CELL",227:"MEDIAN",228:"SUMPRODUCT",229:"SINH",230:"COSH",231:"TANH",232:"ASINH",233:"ACOSH",234:"ATANH",235:"DGET",236:"CREATE.OBJECT",237:"VOLATILE",238:"LAST.ERROR",239:"CUSTOM.UNDO",240:"CUSTOM.REPEAT",241:"FORMULA.CONVERT",242:"GET.LINK.INFO",243:"TEXT.BOX",244:"INFO",245:"GROUP",246:"GET.OBJECT",247:"DB",248:"PAUSE",251:"RESUME",252:"FREQUENCY",253:"ADD.TOOLBAR",254:"DELETE.TOOLBAR",255:"User",256:"RESET.TOOLBAR",257:"EVALUATE",258:"GET.TOOLBAR",259:"GET.TOOL",260:"SPELLING.CHECK",261:"ERROR.TYPE",262:"APP.TITLE",263:"WINDOW.TITLE",264:"SAVE.TOOLBAR",265:"ENABLE.TOOL",266:"PRESS.TOOL",267:"REGISTER.ID",268:"GET.WORKBOOK",269:"AVEDEV",270:"BETADIST",271:"GAMMALN",272:"BETAINV",273:"BINOMDIST",274:"CHIDIST",275:"CHIINV",276:"COMBIN",277:"CONFIDENCE",278:"CRITBINOM",279:"EVEN",280:"EXPONDIST",281:"FDIST",282:"FINV",283:"FISHER",284:"FISHERINV",285:"FLOOR",286:"GAMMADIST",287:"GAMMAINV",288:"CEILING",289:"HYPGEOMDIST",290:"LOGNORMDIST",291:"LOGINV",292:"NEGBINOMDIST",293:"NORMDIST",294:"NORMSDIST",295:"NORMINV",296:"NORMSINV",297:"STANDARDIZE",298:"ODD",299:"PERMUT",300:"POISSON",301:"TDIST",302:"WEIBULL",303:"SUMXMY2",304:"SUMX2MY2",305:"SUMX2PY2",306:"CHITEST",307:"CORREL",308:"COVAR",309:"FORECAST",310:"FTEST",311:"INTERCEPT",312:"PEARSON",313:"RSQ",314:"STEYX",315:"SLOPE",316:"TTEST",317:"PROB",318:"DEVSQ",319:"GEOMEAN",320:"HARMEAN",321:"SUMSQ",322:"KURT",323:"SKEW",324:"ZTEST",325:"LARGE",326:"SMALL",327:"QUARTILE",328:"PERCENTILE",329:"PERCENTRANK",330:"MODE",331:"TRIMMEAN",332:"TINV",334:"MOVIE.COMMAND",335:"GET.MOVIE",336:"CONCATENATE",337:"POWER",338:"PIVOT.ADD.DATA",339:"GET.PIVOT.TABLE",340:"GET.PIVOT.FIELD",341:"GET.PIVOT.ITEM",342:"RADIANS",343:"DEGREES",344:"SUBTOTAL",345:"SUMIF",346:"COUNTIF",347:"COUNTBLANK",348:"SCENARIO.GET",349:"OPTIONS.LISTS.GET",350:"ISPMT",351:"DATEDIF",352:"DATESTRING",353:"NUMBERSTRING",354:"ROMAN",355:"OPEN.DIALOG",356:"SAVE.DIALOG",357:"VIEW.GET",358:"GETPIVOTDATA",359:"HYPERLINK",360:"PHONETIC",361:"AVERAGEA",362:"MAXA",363:"MINA",364:"STDEVPA",365:"VARPA",366:"STDEVA",367:"VARA",368:"BAHTTEXT",369:"THAIDAYOFWEEK",370:"THAIDIGIT",371:"THAIMONTHOFYEAR",372:"THAINUMSOUND",373:"THAINUMSTRING",374:"THAISTRINGLENGTH",375:"ISTHAIDIGIT",376:"ROUNDBAHTDOWN",377:"ROUNDBAHTUP",378:"THAIYEAR",379:"RTD",380:"CUBEVALUE",381:"CUBEMEMBER",382:"CUBEMEMBERPROPERTY",383:"CUBERANKEDMEMBER",384:"HEX2BIN",385:"HEX2DEC",386:"HEX2OCT",387:"DEC2BIN",388:"DEC2HEX",389:"DEC2OCT",390:"OCT2BIN",391:"OCT2HEX",392:"OCT2DEC",393:"BIN2DEC",394:"BIN2OCT",395:"BIN2HEX",396:"IMSUB",397:"IMDIV",398:"IMPOWER",399:"IMABS",400:"IMSQRT",401:"IMLN",402:"IMLOG2",403:"IMLOG10",404:"IMSIN",405:"IMCOS",406:"IMEXP",407:"IMARGUMENT",408:"IMCONJUGATE",409:"IMAGINARY",410:"IMREAL",411:"COMPLEX",412:"IMSUM",413:"IMPRODUCT",414:"SERIESSUM",415:"FACTDOUBLE",416:"SQRTPI",417:"QUOTIENT",418:"DELTA",419:"GESTEP",420:"ISEVEN",421:"ISODD",422:"MROUND",423:"ERF",424:"ERFC",425:"BESSELJ",426:"BESSELK",427:"BESSELY",428:"BESSELI",429:"XIRR",430:"XNPV",431:"PRICEMAT",432:"YIELDMAT",433:"INTRATE",434:"RECEIVED",435:"DISC",436:"PRICEDISC",437:"YIELDDISC",438:"TBILLEQ",439:"TBILLPRICE",440:"TBILLYIELD",441:"PRICE",442:"YIELD",443:"DOLLARDE",444:"DOLLARFR",445:"NOMINAL",446:"EFFECT",447:"CUMPRINC",448:"CUMIPMT",449:"EDATE",450:"EOMONTH",451:"YEARFRAC",452:"COUPDAYBS",453:"COUPDAYS",454:"COUPDAYSNC",455:"COUPNCD",456:"COUPNUM",457:"COUPPCD",458:"DURATION",459:"MDURATION",460:"ODDLPRICE",461:"ODDLYIELD",462:"ODDFPRICE",463:"ODDFYIELD",464:"RANDBETWEEN",465:"WEEKNUM",466:"AMORDEGRC",467:"AMORLINC",468:"CONVERT",724:"SHEETJS",469:"ACCRINT",470:"ACCRINTM",471:"WORKDAY",472:"NETWORKDAYS",473:"GCD",474:"MULTINOMIAL",475:"LCM",476:"FVSCHEDULE",477:"CUBEKPIMEMBER",478:"CUBESET",479:"CUBESETCOUNT",480:"IFERROR",481:"COUNTIFS",482:"SUMIFS",483:"AVERAGEIF",484:"AVERAGEIFS"},V2={2:1,3:1,10:0,15:1,16:1,17:1,18:1,19:0,20:1,21:1,22:1,23:1,24:1,25:1,26:1,27:2,30:2,31:3,32:1,33:1,34:0,35:0,38:1,39:2,40:3,41:3,42:3,43:3,44:3,45:3,47:3,48:2,53:1,61:3,63:0,65:3,66:3,67:1,68:1,69:1,70:1,71:1,72:1,73:1,74:0,75:1,76:1,77:1,79:2,80:2,83:1,85:0,86:1,89:0,90:1,94:0,95:0,97:2,98:1,99:1,101:3,102:3,105:1,106:1,108:2,111:1,112:1,113:1,114:1,117:2,118:1,119:4,121:1,126:1,127:1,128:1,129:1,130:1,131:1,133:1,134:1,135:1,136:2,137:2,138:2,140:1,141:1,142:3,143:4,144:4,161:1,162:1,163:1,164:1,165:2,172:1,175:2,176:2,177:3,178:2,179:1,184:1,186:1,189:3,190:1,195:3,196:3,197:1,198:1,199:3,201:1,207:4,210:3,211:1,212:2,213:2,214:1,215:1,225:0,229:1,230:1,231:1,232:1,233:1,234:1,235:3,244:1,247:4,252:2,257:1,261:1,271:1,273:4,274:2,275:2,276:2,277:3,278:3,279:1,280:3,281:3,282:3,283:1,284:1,285:2,286:4,287:3,288:2,289:4,290:3,291:3,292:3,293:4,294:1,295:3,296:1,297:3,298:1,299:2,300:3,301:3,302:4,303:2,304:2,305:2,306:2,307:2,308:2,309:3,310:2,311:2,312:2,313:2,314:2,315:2,316:4,325:2,326:2,327:2,328:2,331:2,332:2,337:2,342:1,343:1,346:2,347:1,350:4,351:3,352:1,353:2,360:1,368:1,369:1,370:1,371:1,372:1,373:1,374:1,375:1,376:1,377:1,378:1,382:3,385:1,392:1,393:1,396:2,397:2,398:2,399:1,400:1,401:1,402:1,403:1,404:1,405:1,406:1,407:1,408:1,409:1,410:1,414:4,415:1,416:1,417:2,420:1,421:1,422:2,424:1,425:2,426:2,427:2,428:2,430:3,438:3,439:3,440:3,443:2,444:2,445:2,446:2,447:6,448:6,449:2,450:2,464:2,468:3,476:2,479:1,480:2,65535:0};function AP(e){return e.slice(0,3)=="of:"&&(e=e.slice(3)),e.charCodeAt(0)==61&&(e=e.slice(1),e.charCodeAt(0)==61&&(e=e.slice(1))),e=e.replace(/COM\.MICROSOFT\./g,""),e=e.replace(/\[((?:\.[A-Z]+[0-9]+)(?::\.[A-Z]+[0-9]+)?)\]/g,function(n,a){return a.replace(/\./g,"")}),e=e.replace(/\[.(#[A-Z]*[?!])\]/g,"$1"),e.replace(/[;~]/g,",").replace(/\|/g,";")}function Vb(e){var n=e.split(":"),a=n[0].split(".")[0];return[a,n[0].split(".")[1]+(n.length>1?":"+(n[1].split(".")[1]||n[1].split(".")[0]):"")]}var lg={},Kd={};function cg(e,n){if(e){var a=[.7,.7,.75,.75,.3,.3];n=="xlml"&&(a=[1,1,1,1,.5,.5]),e.left==null&&(e.left=a[0]),e.right==null&&(e.right=a[1]),e.top==null&&(e.top=a[2]),e.bottom==null&&(e.bottom=a[3]),e.header==null&&(e.header=a[4]),e.footer==null&&(e.footer=a[5])}}function mL(e,n,a,u,f,_){try{u.cellNF&&(e.z=Tn[n])}catch(T){if(u.WTF)throw T}if(!(e.t==="z"&&!u.cellStyles)){if(e.t==="d"&&typeof e.v=="string"&&(e.v=_a(e.v)),(!u||u.cellText!==!1)&&e.t!=="z")try{if(Tn[n]==null&&Jh(jU[n]||"General",n),e.t==="e")e.w=e.w||gf[e.v];else if(n===0)if(e.t==="n")(e.v|0)===e.v?e.w=e.v.toString(10):e.w=kg(e.v);else if(e.t==="d"){var w=as(e.v);(w|0)===w?e.w=w.toString(10):e.w=kg(w)}else{if(e.v===void 0)return"";e.w=sf(e.v,Kd)}else e.t==="d"?e.w=fo(n,as(e.v),Kd):e.w=fo(n,e.v,Kd)}catch(T){if(u.WTF)throw T}if(u.cellStyles&&a!=null)try{e.s=_.Fills[a],e.s.fgColor&&e.s.fgColor.theme&&!e.s.fgColor.rgb&&(e.s.fgColor.rgb=R1(f.themeElements.clrScheme[e.s.fgColor.theme].rgb,e.s.fgColor.tint||0),u.WTF&&(e.s.fgColor.raw_rgb=f.themeElements.clrScheme[e.s.fgColor.theme].rgb)),e.s.bgColor&&e.s.bgColor.theme&&(e.s.bgColor.rgb=R1(f.themeElements.clrScheme[e.s.bgColor.theme].rgb,e.s.bgColor.tint||0),u.WTF&&(e.s.bgColor.raw_rgb=f.themeElements.clrScheme[e.s.bgColor.theme].rgb))}catch(T){if(u.WTF&&_.Fills)throw T}}}function $2(e,n){var a=Vi(n);a.s.r<=a.e.r&&a.s.c<=a.e.c&&a.s.r>=0&&a.s.c>=0&&(e["!ref"]=jn(a))}var j2=/<(?:\w:)?mergeCell ref="[A-Z0-9:]+"\s*[\/]?>/g,G2=/<(?:\w+:)?sheetData[^>]*>([\s\S]*)<\/(?:\w+:)?sheetData>/,H2=/<(?:\w:)?hyperlink [^>]*>/mg,W2=/"(\w*:\w*)"/,q2=/<(?:\w:)?col\b[^>]*[\/]?>/g,Z2=/<(?:\w:)?autoFilter[^>]*([\/]|>([\s\S]*)<\/(?:\w:)?autoFilter)>/g,X2=/<(?:\w:)?pageMargins[^>]*\/>/g,gL=/<(?:\w:)?sheetPr\b(?:[^>a-z][^>]*)?\/>/,Y2=/<(?:\w:)?sheetPr[^>]*(?:[\/]|>([\s\S]*)<\/(?:\w:)?sheetPr)>/,K2=/<(?:\w:)?sheetViews[^>]*(?:[\/]|>([\s\S]*)<\/(?:\w:)?sheetViews)>/;function J2(e,n,a,u,f,_,w){if(!e)return e;u||(u={"!id":{}});var T=n.dense?[]:{},o={s:{r:2e6,c:2e6},e:{r:0,c:0}},k="",R="",F=e.match(G2);F?(k=e.slice(0,F.index),R=e.slice(F.index+F[0].length)):k=R=e;var B=k.match(gL);B?qS(B[0],T,f,a):(B=k.match(Y2))&&Q2(B[0],B[1]||"",T,f,a);var V=(k.match(/<(?:\w*:)?dimension/)||{index:-1}).index;if(V>0){var G=k.slice(V,V+50).match(W2);G&&$2(T,G[1])}var U=k.match(K2);U&&U[1]&&aG(U[1],f);var J=[];if(n.cellStyles){var X=k.match(q2);X&&rG(J,X)}F&&sG(F[1],T,n,o,_,w);var Y=R.match(Z2);Y&&(T["!autofilter"]=nG(Y[0]));var Z=[],_e=R.match(j2);if(_e)for(V=0;V!=_e.length;++V)Z[V]=Vi(_e[V].slice(_e[V].indexOf('"')+1));var ke=R.match(H2);ke&&eG(T,ke,u);var Ae=R.match(X2);if(Ae&&(T["!margins"]=tG(on(Ae[0]))),!T["!ref"]&&o.e.c>=o.s.c&&o.e.r>=o.s.r&&(T["!ref"]=jn(o)),n.sheetRows>0&&T["!ref"]){var me=Vi(T["!ref"]);n.sheetRows<=+me.e.r&&(me.e.r=n.sheetRows-1,me.e.r>o.e.r&&(me.e.r=o.e.r),me.e.r<me.s.r&&(me.s.r=me.e.r),me.e.c>o.e.c&&(me.e.c=o.e.c),me.e.c<me.s.c&&(me.s.c=me.e.c),T["!fullref"]=T["!ref"],T["!ref"]=jn(me))}return J.length>0&&(T["!cols"]=J),Z.length>0&&(T["!merges"]=Z),T}function qS(e,n,a,u){var f=on(e);a.Sheets[u]||(a.Sheets[u]={}),f.codeName&&(a.Sheets[u].CodeName=Zn(gi(f.codeName)))}function Q2(e,n,a,u,f){qS(e.slice(0,e.indexOf(">")),a,u,f)}function eG(e,n,a){for(var u=Array.isArray(e),f=0;f!=n.length;++f){var _=on(gi(n[f]),!0);if(!_.ref)return;var w=((a||{})["!id"]||[])[_.id];w?(_.Target=w.Target,_.location&&(_.Target+="#"+Zn(_.location))):(_.Target="#"+Zn(_.location),w={Target:_.Target,TargetMode:"Internal"}),_.Rel=w,_.tooltip&&(_.Tooltip=_.tooltip,delete _.tooltip);for(var T=Vi(_.ref),o=T.s.r;o<=T.e.r;++o)for(var k=T.s.c;k<=T.e.c;++k){var R=yn({c:k,r:o});u?(e[o]||(e[o]=[]),e[o][k]||(e[o][k]={t:"z",v:void 0}),e[o][k].l=_):(e[R]||(e[R]={t:"z",v:void 0}),e[R].l=_)}}}function tG(e){var n={};return["left","right","top","bottom","header","footer"].forEach(function(a){e[a]&&(n[a]=parseFloat(e[a]))}),n}function rG(e,n){for(var a=!1,u=0;u!=n.length;++u){var f=on(n[u],!0);f.hidden&&(f.hidden=Ci(f.hidden));var _=parseInt(f.min,10)-1,w=parseInt(f.max,10)-1;for(f.outlineLevel&&(f.level=+f.outlineLevel||0),delete f.min,delete f.max,f.width=+f.width,!a&&f.width&&(a=!0,HS(f.width)),lp(f);_<=w;)e[_++]=Aa(f)}}function nG(e){var n={ref:(e.match(/ref="([^"]*)"/)||[])[1]};return n}var iG=/<(?:\w:)?sheetView(?:[^>a-z][^>]*)?\/?>/;function aG(e,n){n.Views||(n.Views=[{}]),(e.match(iG)||[]).forEach(function(a,u){var f=on(a);n.Views[u]||(n.Views[u]={}),+f.zoomScale&&(n.Views[u].zoom=+f.zoomScale),Ci(f.rightToLeft)&&(n.Views[u].RTL=!0)})}var sG=function(){var e=/<(?:\w+:)?c[ \/>]/,n=/<\/(?:\w+:)?row>/,a=/r=["']([^"']*)["']/,u=/<(?:\w+:)?is>([\S\s]*?)<\/(?:\w+:)?is>/,f=/ref=["']([^"']*)["']/,_=Mg("v"),w=Mg("f");return function(o,k,R,F,B,V){for(var G=0,U="",J=[],X=[],Y=0,Z=0,_e=0,ke="",Ae,me,De=0,we=0,Je,rt,Re=0,St=0,Lt=Array.isArray(V.CellXf),We,qt=[],Ot=[],st=Array.isArray(k),Ve=[],Et={},Dt=!1,Se=!!R.sheetStubs,at=o.split(n),He=0,Xe=at.length;He!=Xe;++He){U=at[He].trim();var yt=U.length;if(yt!==0){var Jt=0;e:for(G=0;G<yt;++G)switch(U[G]){case">":if(U[G-1]!="/"){++G;break e}if(R&&R.cellStyles){if(me=on(U.slice(Jt,G),!0),De=me.r!=null?parseInt(me.r,10):De+1,we=-1,R.sheetRows&&R.sheetRows<De)continue;Et={},Dt=!1,me.ht&&(Dt=!0,Et.hpt=parseFloat(me.ht),Et.hpx=Dg(Et.hpt)),me.hidden=="1"&&(Dt=!0,Et.hidden=!0),me.outlineLevel!=null&&(Dt=!0,Et.level=+me.outlineLevel),Dt&&(Ve[De-1]=Et)}break;case"<":Jt=G;break}if(Jt>=G)break;if(me=on(U.slice(Jt,G),!0),De=me.r!=null?parseInt(me.r,10):De+1,we=-1,!(R.sheetRows&&R.sheetRows<De)){F.s.r>De-1&&(F.s.r=De-1),F.e.r<De-1&&(F.e.r=De-1),R&&R.cellStyles&&(Et={},Dt=!1,me.ht&&(Dt=!0,Et.hpt=parseFloat(me.ht),Et.hpx=Dg(Et.hpt)),me.hidden=="1"&&(Dt=!0,Et.hidden=!0),me.outlineLevel!=null&&(Dt=!0,Et.level=+me.outlineLevel),Dt&&(Ve[De-1]=Et)),J=U.slice(G).split(e);for(var sr=0;sr!=J.length&&J[sr].trim().charAt(0)=="<";++sr);for(J=J.slice(sr),G=0;G!=J.length;++G)if(U=J[G].trim(),U.length!==0){if(X=U.match(a),Y=G,Z=0,_e=0,U="<c "+(U.slice(0,1)=="<"?">":"")+U,X!=null&&X.length===2){for(Y=0,ke=X[1],Z=0;Z!=ke.length&&!((_e=ke.charCodeAt(Z)-64)<1||_e>26);++Z)Y=26*Y+_e;--Y,we=Y}else++we;for(Z=0;Z!=U.length&&U.charCodeAt(Z)!==62;++Z);if(++Z,me=on(U.slice(0,Z),!0),me.r||(me.r=yn({r:De-1,c:we})),ke=U.slice(Z),Ae={t:""},(X=ke.match(_))!=null&&X[1]!==""&&(Ae.v=Zn(X[1])),R.cellFormula){if((X=ke.match(w))!=null&&X[1]!==""){if(Ae.f=Zn(gi(X[1])).replace(/\r\n/g,`
`),R.xlfn||(Ae.f=bP(Ae.f)),X[0].indexOf('t="array"')>-1)Ae.F=(ke.match(f)||[])[1],Ae.F.indexOf(":")>-1&&qt.push([Vi(Ae.F),Ae.F]);else if(X[0].indexOf('t="shared"')>-1){rt=on(X[0]);var Xt=Zn(gi(X[1]));R.xlfn||(Xt=bP(Xt)),Ot[parseInt(rt.si,10)]=[rt,Xt,me.r]}}else(X=ke.match(/<f[^>]*\/>/))&&(rt=on(X[0]),Ot[rt.si]&&(Ae.f=_j(Ot[rt.si][1],Ot[rt.si][2],me.r)));var zt=rs(me.r);for(Z=0;Z<qt.length;++Z)zt.r>=qt[Z][0].s.r&&zt.r<=qt[Z][0].e.r&&zt.c>=qt[Z][0].s.c&&zt.c<=qt[Z][0].e.c&&(Ae.F=qt[Z][1])}if(me.t==null&&Ae.v===void 0)if(Ae.f||Ae.F)Ae.v=0,Ae.t="n";else if(Se)Ae.t="z";else continue;else Ae.t=me.t||"n";switch(F.s.c>we&&(F.s.c=we),F.e.c<we&&(F.e.c=we),Ae.t){case"n":if(Ae.v==""||Ae.v==null){if(!Se)continue;Ae.t="z"}else Ae.v=parseFloat(Ae.v);break;case"s":if(typeof Ae.v>"u"){if(!Se)continue;Ae.t="z"}else Je=lg[parseInt(Ae.v,10)],Ae.v=Je.t,Ae.r=Je.r,R.cellHTML&&(Ae.h=Je.h);break;case"str":Ae.t="s",Ae.v=Ae.v!=null?gi(Ae.v):"",R.cellHTML&&(Ae.h=FS(Ae.v));break;case"inlineStr":X=ke.match(u),Ae.t="s",X!=null&&(Je=GS(X[1]))?(Ae.v=Je.t,R.cellHTML&&(Ae.h=Je.h)):Ae.v="";break;case"b":Ae.v=Ci(Ae.v);break;case"d":R.cellDates?Ae.v=_a(Ae.v,1):(Ae.v=as(_a(Ae.v,1)),Ae.t="n");break;case"e":(!R||R.cellText!==!1)&&(Ae.w=Ae.v),Ae.v=NF[Ae.v];break}if(Re=St=0,We=null,Lt&&me.s!==void 0&&(We=V.CellXf[me.s],We!=null&&(We.numFmtId!=null&&(Re=We.numFmtId),R.cellStyles&&We.fillId!=null&&(St=We.fillId))),mL(Ae,Re,St,R,B,V),R.cellDates&&Lt&&Ae.t=="n"&&gp(Tn[Re])&&(Ae.t="d",Ae.v=iv(Ae.v)),me.cm&&R.xlmeta){var Or=(R.xlmeta.Cell||[])[+me.cm-1];Or&&Or.type=="XLDAPR"&&(Ae.D=!0)}if(st){var Be=rs(me.r);k[Be.r]||(k[Be.r]=[]),k[Be.r][Be.c]=Ae}else k[me.r]=Ae}}}}Ve.length>0&&(k["!rows"]=Ve)}}();function oG(e,n){var a={},u=e.l+n;a.r=e.read_shift(4),e.l+=4;var f=e.read_shift(2);e.l+=1;var _=e.read_shift(1);return e.l=u,_&7&&(a.level=_&7),_&16&&(a.hidden=!0),_&32&&(a.hpt=f/20),a}var lG=mf;function cG(){}function uG(e,n){var a={},u=e[e.l];return++e.l,a.above=!(u&64),a.left=!(u&128),e.l+=18,a.name=R7(e),a}function hG(e){var n=go(e);return[n]}function fG(e){var n=pf(e);return[n]}function dG(e){var n=go(e),a=e.read_shift(1);return[n,a,"b"]}function pG(e){var n=pf(e),a=e.read_shift(1);return[n,a,"b"]}function mG(e){var n=go(e),a=e.read_shift(1);return[n,a,"e"]}function gG(e){var n=pf(e),a=e.read_shift(1);return[n,a,"e"]}function _G(e){var n=go(e),a=e.read_shift(4);return[n,a,"s"]}function xG(e){var n=pf(e),a=e.read_shift(4);return[n,a,"s"]}function yG(e){var n=go(e),a=ja(e);return[n,a,"n"]}function _L(e){var n=pf(e),a=ja(e);return[n,a,"n"]}function vG(e){var n=go(e),a=VS(e);return[n,a,"n"]}function wG(e){var n=pf(e),a=VS(e);return[n,a,"n"]}function bG(e){var n=go(e),a=BS(e);return[n,a,"is"]}function TG(e){var n=go(e),a=Ha(e);return[n,a,"str"]}function EG(e){var n=pf(e),a=Ha(e);return[n,a,"str"]}function SG(e,n,a){var u=e.l+n,f=go(e);f.r=a["!row"];var _=e.read_shift(1),w=[f,_,"b"];if(a.cellFormula){e.l+=2;var T=ov(e,u-e.l,a);w[3]=Va(T,null,f,a.supbooks,a)}else e.l=u;return w}function AG(e,n,a){var u=e.l+n,f=go(e);f.r=a["!row"];var _=e.read_shift(1),w=[f,_,"e"];if(a.cellFormula){e.l+=2;var T=ov(e,u-e.l,a);w[3]=Va(T,null,f,a.supbooks,a)}else e.l=u;return w}function CG(e,n,a){var u=e.l+n,f=go(e);f.r=a["!row"];var _=ja(e),w=[f,_,"n"];if(a.cellFormula){e.l+=2;var T=ov(e,u-e.l,a);w[3]=Va(T,null,f,a.supbooks,a)}else e.l=u;return w}function kG(e,n,a){var u=e.l+n,f=go(e);f.r=a["!row"];var _=Ha(e),w=[f,_,"str"];if(a.cellFormula){e.l+=2;var T=ov(e,u-e.l,a);w[3]=Va(T,null,f,a.supbooks,a)}else e.l=u;return w}var MG=mf;function IG(e,n){var a=e.l+n,u=mf(e),f=US(e),_=Ha(e),w=Ha(e),T=Ha(e);e.l=a;var o={rfx:u,relId:f,loc:_,display:T};return w&&(o.Tooltip=w),o}function PG(){}function RG(e,n,a){var u=e.l+n,f=FF(e),_=e.read_shift(1),w=[f];if(w[2]=_,a.cellFormula){var T=N2(e,u-e.l,a);w[1]=T}else e.l=u;return w}function DG(e,n,a){var u=e.l+n,f=mf(e),_=[f];if(a.cellFormula){var w=B2(e,u-e.l,a);_[1]=w,e.l=u}else e.l=u;return _}var FG=["left","right","top","bottom","header","footer"];function LG(e){var n={};return FG.forEach(function(a){n[a]=ja(e)}),n}function OG(e){var n=e.read_shift(2);return e.l+=28,{RTL:n&32}}function NG(){}function zG(){}function BG(e,n,a,u,f,_,w){if(!e)return e;var T=n||{};u||(u={"!id":{}});var o=T.dense?[]:{},k,R={s:{r:2e6,c:2e6},e:{r:0,c:0}},F=!1,B=!1,V,G,U,J,X,Y,Z,_e,ke,Ae=[];T.biff=12,T["!row"]=0;var me=0,De=!1,we=[],Je={},rt=T.supbooks||f.supbooks||[[]];if(rt.sharedf=Je,rt.arrayf=we,rt.SheetNames=f.SheetNames||f.Sheets.map(function(st){return st.name}),!T.supbooks&&(T.supbooks=rt,f.Names))for(var Re=0;Re<f.Names.length;++Re)rt[0][Re+1]=f.Names[Re];var St=[],Lt=[],We=!1;L1[16]={n:"BrtShortReal",f:_L};var qt;if(Sc(e,function(Ve,Et,Dt){if(!B)switch(Dt){case 148:k=Ve;break;case 0:V=Ve,T.sheetRows&&T.sheetRows<=V.r&&(B=!0),_e=Ca(J=V.r),T["!row"]=V.r,(Ve.hidden||Ve.hpt||Ve.level!=null)&&(Ve.hpt&&(Ve.hpx=Dg(Ve.hpt)),Lt[Ve.r]=Ve);break;case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 13:case 14:case 15:case 16:case 17:case 18:case 62:switch(G={t:Ve[2]},Ve[2]){case"n":G.v=Ve[1];break;case"s":Z=lg[Ve[1]],G.v=Z.t,G.r=Z.r;break;case"b":G.v=!!Ve[1];break;case"e":G.v=Ve[1],T.cellText!==!1&&(G.w=gf[G.v]);break;case"str":G.t="s",G.v=Ve[1];break;case"is":G.t="s",G.v=Ve[1].t;break}if((U=w.CellXf[Ve[0].iStyleRef])&&mL(G,U.numFmtId,null,T,_,w),X=Ve[0].c==-1?X+1:Ve[0].c,T.dense?(o[J]||(o[J]=[]),o[J][X]=G):o[ca(X)+_e]=G,T.cellFormula){for(De=!1,me=0;me<we.length;++me){var Se=we[me];V.r>=Se[0].s.r&&V.r<=Se[0].e.r&&X>=Se[0].s.c&&X<=Se[0].e.c&&(G.F=jn(Se[0]),De=!0)}!De&&Ve.length>3&&(G.f=Ve[3])}if(R.s.r>V.r&&(R.s.r=V.r),R.s.c>X&&(R.s.c=X),R.e.r<V.r&&(R.e.r=V.r),R.e.c<X&&(R.e.c=X),T.cellDates&&U&&G.t=="n"&&gp(Tn[U.numFmtId])){var at=Zh(G.v);at&&(G.t="d",G.v=new Date(at.y,at.m-1,at.d,at.H,at.M,at.S,at.u))}qt&&(qt.type=="XLDAPR"&&(G.D=!0),qt=void 0);break;case 1:case 12:if(!T.sheetStubs||F)break;G={t:"z",v:void 0},X=Ve[0].c==-1?X+1:Ve[0].c,T.dense?(o[J]||(o[J]=[]),o[J][X]=G):o[ca(X)+_e]=G,R.s.r>V.r&&(R.s.r=V.r),R.s.c>X&&(R.s.c=X),R.e.r<V.r&&(R.e.r=V.r),R.e.c<X&&(R.e.c=X),qt&&(qt.type=="XLDAPR"&&(G.D=!0),qt=void 0);break;case 176:Ae.push(Ve);break;case 49:qt=((T.xlmeta||{}).Cell||[])[Ve-1];break;case 494:var He=u["!id"][Ve.relId];for(He?(Ve.Target=He.Target,Ve.loc&&(Ve.Target+="#"+Ve.loc),Ve.Rel=He):Ve.relId==""&&(Ve.Target="#"+Ve.loc),J=Ve.rfx.s.r;J<=Ve.rfx.e.r;++J)for(X=Ve.rfx.s.c;X<=Ve.rfx.e.c;++X)T.dense?(o[J]||(o[J]=[]),o[J][X]||(o[J][X]={t:"z",v:void 0}),o[J][X].l=Ve):(Y=yn({c:X,r:J}),o[Y]||(o[Y]={t:"z",v:void 0}),o[Y].l=Ve);break;case 426:if(!T.cellFormula)break;we.push(Ve),ke=T.dense?o[J][X]:o[ca(X)+_e],ke.f=Va(Ve[1],R,{r:V.r,c:X},rt,T),ke.F=jn(Ve[0]);break;case 427:if(!T.cellFormula)break;Je[yn(Ve[0].s)]=Ve[1],ke=T.dense?o[J][X]:o[ca(X)+_e],ke.f=Va(Ve[1],R,{r:V.r,c:X},rt,T);break;case 60:if(!T.cellStyles)break;for(;Ve.e>=Ve.s;)St[Ve.e--]={width:Ve.w/256,hidden:!!(Ve.flags&1),level:Ve.level},We||(We=!0,HS(Ve.w/256)),lp(St[Ve.e+1]);break;case 161:o["!autofilter"]={ref:jn(Ve)};break;case 476:o["!margins"]=Ve;break;case 147:f.Sheets[a]||(f.Sheets[a]={}),Ve.name&&(f.Sheets[a].CodeName=Ve.name),(Ve.above||Ve.left)&&(o["!outline"]={above:Ve.above,left:Ve.left});break;case 137:f.Views||(f.Views=[{}]),f.Views[0]||(f.Views[0]={}),Ve.RTL&&(f.Views[0].RTL=!0);break;case 485:break;case 64:case 1053:break;case 151:break;case 152:case 175:case 644:case 625:case 562:case 396:case 1112:case 1146:case 471:case 1050:case 649:case 1105:case 589:case 607:case 564:case 1055:case 168:case 174:case 1180:case 499:case 507:case 550:case 171:case 167:case 1177:case 169:case 1181:case 551:case 552:case 661:case 639:case 478:case 537:case 477:case 536:case 1103:case 680:case 1104:case 1024:case 663:case 535:case 678:case 504:case 1043:case 428:case 170:case 3072:case 50:case 2070:case 1045:break;case 35:F=!0;break;case 36:F=!1;break;case 37:F=!0;break;case 38:F=!1;break;default:if(!Et.T){if(!F||T.WTF)throw new Error("Unexpected record 0x"+Dt.toString(16))}}},T),delete T.supbooks,delete T["!row"],!o["!ref"]&&(R.s.r<2e6||k&&(k.e.r>0||k.e.c>0||k.s.r>0||k.s.c>0))&&(o["!ref"]=jn(k||R)),T.sheetRows&&o["!ref"]){var Ot=Vi(o["!ref"]);T.sheetRows<=+Ot.e.r&&(Ot.e.r=T.sheetRows-1,Ot.e.r>R.e.r&&(Ot.e.r=R.e.r),Ot.e.r<Ot.s.r&&(Ot.s.r=Ot.e.r),Ot.e.c>R.e.c&&(Ot.e.c=R.e.c),Ot.e.c<Ot.s.c&&(Ot.s.c=Ot.e.c),o["!fullref"]=o["!ref"],o["!ref"]=jn(Ot))}return Ae.length>0&&(o["!merges"]=Ae),St.length>0&&(o["!cols"]=St),Lt.length>0&&(o["!rows"]=Lt),o}function UG(e){var n=[],a=e.match(/^<c:numCache>/),u;(e.match(/<c:pt idx="(\d*)">(.*?)<\/c:pt>/mg)||[]).forEach(function(_){var w=_.match(/<c:pt idx="(\d*?)"><c:v>(.*)<\/c:v><\/c:pt>/);w&&(n[+w[1]]=a?+w[2]:w[2])});var f=Zn((e.match(/<c:formatCode>([\s\S]*?)<\/c:formatCode>/)||["","General"])[1]);return(e.match(/<c:f>(.*?)<\/c:f>/mg)||[]).forEach(function(_){u=_.replace(/<.*?>/g,"")}),[n,f,u]}function VG(e,n,a,u,f,_){var w=_||{"!type":"chart"};if(!e)return _;var T=0,o=0,k="A",R={s:{r:2e6,c:2e6},e:{r:0,c:0}};return(e.match(/<c:numCache>[\s\S]*?<\/c:numCache>/gm)||[]).forEach(function(F){var B=UG(F);R.s.r=R.s.c=0,R.e.c=T,k=ca(T),B[0].forEach(function(V,G){w[k+Ca(G)]={t:"n",v:V,z:B[1]},o=G}),R.e.r<o&&(R.e.r=o),++T}),T>0&&(w["!ref"]=jn(R)),w}function $G(e,n,a,u,f){if(!e)return e;u||(u={"!id":{}});var _={"!type":"chart","!drawel":null,"!rel":""},w,T=e.match(gL);return T&&qS(T[0],_,f,a),(w=e.match(/drawing r:id="(.*?)"/))&&(_["!rel"]=w[1]),u["!id"][_["!rel"]]&&(_["!drawel"]=u["!id"][_["!rel"]]),_}function jG(e,n){e.l+=10;var a=Ha(e);return{name:a}}function GG(e,n,a,u,f){if(!e)return e;u||(u={"!id":{}});var _={"!type":"chart","!drawel":null,"!rel":""},w=!1;return Sc(e,function(o,k,R){switch(R){case 550:_["!rel"]=o;break;case 651:f.Sheets[a]||(f.Sheets[a]={}),o.name&&(f.Sheets[a].CodeName=o.name);break;case 562:case 652:case 669:case 679:case 551:case 552:case 476:case 3072:break;case 35:w=!0;break;case 36:w=!1;break;case 37:break;case 38:break;default:if(!(k.T>0)){if(!(k.T<0)){if(!w||n.WTF)throw new Error("Unexpected record 0x"+R.toString(16))}}}},n),u["!id"][_["!rel"]]&&(_["!drawel"]=u["!id"][_["!rel"]]),_}var xL=[["allowRefreshQuery",!1,"bool"],["autoCompressPictures",!0,"bool"],["backupFile",!1,"bool"],["checkCompatibility",!1,"bool"],["CodeName",""],["date1904",!1,"bool"],["defaultThemeVersion",0,"int"],["filterPrivacy",!1,"bool"],["hidePivotFieldList",!1,"bool"],["promptedSolutions",!1,"bool"],["publishItems",!1,"bool"],["refreshAllConnections",!1,"bool"],["saveExternalLinkValues",!0,"bool"],["showBorderUnselectedTables",!0,"bool"],["showInkAnnotation",!0,"bool"],["showObjects","all"],["showPivotChartFilter",!1,"bool"],["updateLinks","userSet"]],HG=[["activeTab",0,"int"],["autoFilterDateGrouping",!0,"bool"],["firstSheet",0,"int"],["minimized",!1,"bool"],["showHorizontalScroll",!0,"bool"],["showSheetTabs",!0,"bool"],["showVerticalScroll",!0,"bool"],["tabRatio",600,"int"],["visibility","visible"]],WG=[],qG=[["calcCompleted","true"],["calcMode","auto"],["calcOnSave","true"],["concurrentCalc","true"],["fullCalcOnLoad","false"],["fullPrecision","true"],["iterate","false"],["iterateCount","100"],["iterateDelta","0.001"],["refMode","A1"]];function CP(e,n){for(var a=0;a!=e.length;++a)for(var u=e[a],f=0;f!=n.length;++f){var _=n[f];if(u[_[0]]==null)u[_[0]]=_[1];else switch(_[2]){case"bool":typeof u[_[0]]=="string"&&(u[_[0]]=Ci(u[_[0]]));break;case"int":typeof u[_[0]]=="string"&&(u[_[0]]=parseInt(u[_[0]],10));break}}}function kP(e,n){for(var a=0;a!=n.length;++a){var u=n[a];if(e[u[0]]==null)e[u[0]]=u[1];else switch(u[2]){case"bool":typeof e[u[0]]=="string"&&(e[u[0]]=Ci(e[u[0]]));break;case"int":typeof e[u[0]]=="string"&&(e[u[0]]=parseInt(e[u[0]],10));break}}}function yL(e){kP(e.WBProps,xL),kP(e.CalcPr,qG),CP(e.WBView,HG),CP(e.Sheets,WG),Kd.date1904=Ci(e.WBProps.date1904)}var ZG="][*?/\\".split("");function XG(e,n){if(e.length>31){if(n)return!1;throw new Error("Sheet names cannot exceed 31 chars")}var a=!0;return ZG.forEach(function(u){if(e.indexOf(u)!=-1){if(!n)throw new Error("Sheet name cannot contain : \\ / ? * [ ]");a=!1}}),a}var YG=/<\w+:workbook/;function KG(e,n){if(!e)throw new Error("Could not find file");var a={AppVersion:{},WBProps:{},WBView:[],Sheets:[],CalcPr:{},Names:[],xmlns:""},u=!1,f="xmlns",_={},w=0;if(e.replace(Za,function(o,k){var R=on(o);switch(Fl(R[0])){case"<?xml":break;case"<workbook":o.match(YG)&&(f="xmlns"+o.match(/<(\w+):/)[1]),a.xmlns=R[f];break;case"</workbook>":break;case"<fileVersion":delete R[0],a.AppVersion=R;break;case"<fileVersion/>":case"</fileVersion>":break;case"<fileSharing":break;case"<fileSharing/>":break;case"<workbookPr":case"<workbookPr/>":xL.forEach(function(F){if(R[F[0]]!=null)switch(F[2]){case"bool":a.WBProps[F[0]]=Ci(R[F[0]]);break;case"int":a.WBProps[F[0]]=parseInt(R[F[0]],10);break;default:a.WBProps[F[0]]=R[F[0]]}}),R.codeName&&(a.WBProps.CodeName=gi(R.codeName));break;case"</workbookPr>":break;case"<workbookProtection":break;case"<workbookProtection/>":break;case"<bookViews":case"<bookViews>":case"</bookViews>":break;case"<workbookView":case"<workbookView/>":delete R[0],a.WBView.push(R);break;case"</workbookView>":break;case"<sheets":case"<sheets>":case"</sheets>":break;case"<sheet":switch(R.state){case"hidden":R.Hidden=1;break;case"veryHidden":R.Hidden=2;break;default:R.Hidden=0}delete R.state,R.name=Zn(gi(R.name)),delete R[0],a.Sheets.push(R);break;case"</sheet>":break;case"<functionGroups":case"<functionGroups/>":break;case"<functionGroup":break;case"<externalReferences":case"</externalReferences>":case"<externalReferences>":break;case"<externalReference":break;case"<definedNames/>":break;case"<definedNames>":case"<definedNames":u=!0;break;case"</definedNames>":u=!1;break;case"<definedName":_={},_.Name=gi(R.name),R.comment&&(_.Comment=R.comment),R.localSheetId&&(_.Sheet=+R.localSheetId),Ci(R.hidden||"0")&&(_.Hidden=!0),w=k+o.length;break;case"</definedName>":_.Ref=Zn(gi(e.slice(w,k))),a.Names.push(_);break;case"<definedName/>":break;case"<calcPr":delete R[0],a.CalcPr=R;break;case"<calcPr/>":delete R[0],a.CalcPr=R;break;case"</calcPr>":break;case"<oleSize":break;case"<customWorkbookViews>":case"</customWorkbookViews>":case"<customWorkbookViews":break;case"<customWorkbookView":case"</customWorkbookView>":break;case"<pivotCaches>":case"</pivotCaches>":case"<pivotCaches":break;case"<pivotCache":break;case"<smartTagPr":case"<smartTagPr/>":break;case"<smartTagTypes":case"<smartTagTypes>":case"</smartTagTypes>":break;case"<smartTagType":break;case"<webPublishing":case"<webPublishing/>":break;case"<fileRecoveryPr":case"<fileRecoveryPr/>":break;case"<webPublishObjects>":case"<webPublishObjects":case"</webPublishObjects>":break;case"<webPublishObject":break;case"<extLst":case"<extLst>":case"</extLst>":case"<extLst/>":break;case"<ext":u=!0;break;case"</ext>":u=!1;break;case"<ArchID":break;case"<AlternateContent":case"<AlternateContent>":u=!0;break;case"</AlternateContent>":u=!1;break;case"<revisionPtr":break;default:if(!u&&n.WTF)throw new Error("unrecognized "+R[0]+" in workbook")}return o}),m7.indexOf(a.xmlns)===-1)throw new Error("Unknown Namespace: "+a.xmlns);return yL(a),a}function JG(e,n){var a={};return a.Hidden=e.read_shift(4),a.iTabID=e.read_shift(4),a.strRelID=rE(e),a.name=Ha(e),a}function QG(e,n){var a={},u=e.read_shift(4);a.defaultThemeVersion=e.read_shift(4);var f=n>8?Ha(e):"";return f.length>0&&(a.CodeName=f),a.autoCompressPictures=!!(u&65536),a.backupFile=!!(u&64),a.checkCompatibility=!!(u&4096),a.date1904=!!(u&1),a.filterPrivacy=!!(u&8),a.hidePivotFieldList=!!(u&1024),a.promptedSolutions=!!(u&16),a.publishItems=!!(u&2048),a.refreshAllConnections=!!(u&262144),a.saveExternalLinkValues=!!(u&128),a.showBorderUnselectedTables=!!(u&4),a.showInkAnnotation=!!(u&32),a.showObjects=["all","placeholders","none"][u>>13&3],a.showPivotChartFilter=!!(u&32768),a.updateLinks=["userSet","never","always"][u>>8&3],a}function eH(e,n){var a={};return e.read_shift(4),a.ArchID=e.read_shift(4),e.l+=n-8,a}function tH(e,n,a){var u=e.l+n;e.l+=4,e.l+=1;var f=e.read_shift(4),_=D7(e),w=z2(e,0,a),T=US(e);e.l=u;var o={Name:_,Ptg:w};return f<268435455&&(o.Sheet=f),T&&(o.Comment=T),o}function rH(e,n){var a={AppVersion:{},WBProps:{},WBView:[],Sheets:[],CalcPr:{},xmlns:""},u=[],f=!1;n||(n={}),n.biff=12;var _=[],w=[[]];return w.SheetNames=[],w.XTI=[],L1[16]={n:"BrtFRTArchID$",f:eH},Sc(e,function(o,k,R){switch(R){case 156:w.SheetNames.push(o.name),a.Sheets.push(o);break;case 153:a.WBProps=o;break;case 39:o.Sheet!=null&&(n.SID=o.Sheet),o.Ref=Va(o.Ptg,null,null,w,n),delete n.SID,delete o.Ptg,_.push(o);break;case 1036:break;case 357:case 358:case 355:case 667:w[0].length?w.push([R,o]):w[0]=[R,o],w[w.length-1].XTI=[];break;case 362:w.length===0&&(w[0]=[],w[0].XTI=[]),w[w.length-1].XTI=w[w.length-1].XTI.concat(o),w.XTI=w.XTI.concat(o);break;case 361:break;case 2071:case 158:case 143:case 664:case 353:break;case 3072:case 3073:case 534:case 677:case 157:case 610:case 2050:case 155:case 548:case 676:case 128:case 665:case 2128:case 2125:case 549:case 2053:case 596:case 2076:case 2075:case 2082:case 397:case 154:case 1117:case 553:case 2091:break;case 35:u.push(R),f=!0;break;case 36:u.pop(),f=!1;break;case 37:u.push(R),f=!0;break;case 38:u.pop(),f=!1;break;case 16:break;default:if(!k.T){if(!f||n.WTF&&u[u.length-1]!=37&&u[u.length-1]!=35)throw new Error("Unexpected record 0x"+R.toString(16))}}},n),yL(a),a.Names=_,a.supbooks=w,a}function nH(e,n,a){return n.slice(-4)===".bin"?rH(e,a):KG(e,a)}function iH(e,n,a,u,f,_,w,T){return n.slice(-4)===".bin"?BG(e,u,a,f,_,w,T):J2(e,u,a,f,_,w,T)}function aH(e,n,a,u,f,_,w,T){return n.slice(-4)===".bin"?GG(e,u,a,f,_):$G(e,u,a,f,_)}function sH(e,n,a,u,f,_,w,T){return n.slice(-4)===".bin"?pj():mj()}function oH(e,n,a,u,f,_,w,T){return n.slice(-4)===".bin"?fj():dj()}function lH(e,n,a,u){return n.slice(-4)===".bin"?M$(e,a,u):T$(e,a,u)}function cH(e,n,a){return aL(e,a)}function uH(e,n,a){return n.slice(-4)===".bin"?HV(e,a):jV(e,a)}function hH(e,n,a){return n.slice(-4)===".bin"?cj(e,a):ij(e,a)}function fH(e,n,a){return n.slice(-4)===".bin"?tj(e):Q$(e)}function dH(e,n,a,u){return a.slice(-4)===".bin"?rj(e,n,a,u):void 0}function pH(e,n,a){return n.slice(-4)===".bin"?K$(e,n,a):J$(e,n,a)}var vL=/([\w:]+)=((?:")([^"]*)(?:")|(?:')([^']*)(?:'))/g,wL=/([\w:]+)=((?:")(?:[^"]*)(?:")|(?:')(?:[^']*)(?:'))/;function zo(e,n){var a=e.split(/\s+/),u=[];if(n||(u[0]=a[0]),a.length===1)return u;var f=e.match(vL),_,w,T,o;if(f)for(o=0;o!=f.length;++o)_=f[o].match(wL),(w=_[1].indexOf(":"))===-1?u[_[1]]=_[2].slice(1,_[2].length-1):(_[1].slice(0,6)==="xmlns:"?T="xmlns"+_[1].slice(6):T=_[1].slice(w+1),u[T]=_[2].slice(1,_[2].length-1));return u}function mH(e){var n=e.split(/\s+/),a={};if(n.length===1)return a;var u=e.match(vL),f,_,w,T;if(u)for(T=0;T!=u.length;++T)f=u[T].match(wL),(_=f[1].indexOf(":"))===-1?a[f[1]]=f[2].slice(1,f[2].length-1):(f[1].slice(0,6)==="xmlns:"?w="xmlns"+f[1].slice(6):w=f[1].slice(_+1),a[w]=f[2].slice(1,f[2].length-1));return a}var ug;function gH(e,n){var a=ug[e]||Zn(e);return a==="General"?sf(n):fo(a,n)}function _H(e,n,a,u){var f=u;switch((a[0].match(/dt:dt="([\w.]+)"/)||["",""])[1]){case"boolean":f=Ci(u);break;case"i2":case"int":f=parseInt(u,10);break;case"r4":case"float":f=parseFloat(u);break;case"date":case"dateTime.tz":f=_a(u);break;case"i8":case"string":case"fixed":case"uuid":case"bin.base64":break;default:throw new Error("bad custprop:"+a[0])}e[Zn(n)]=f}function xH(e,n,a){if(e.t!=="z"){if(!a||a.cellText!==!1)try{e.t==="e"?e.w=e.w||gf[e.v]:n==="General"?e.t==="n"?(e.v|0)===e.v?e.w=e.v.toString(10):e.w=kg(e.v):e.w=sf(e.v):e.w=gH(n||"General",e.v)}catch(_){if(a.WTF)throw _}try{var u=ug[n]||n||"General";if(a.cellNF&&(e.z=u),a.cellDates&&e.t=="n"&&gp(u)){var f=Zh(e.v);f&&(e.t="d",e.v=new Date(f.y,f.m-1,f.d,f.H,f.M,f.S,f.u))}}catch(_){if(a.WTF)throw _}}}function yH(e,n,a){if(a.cellStyles&&n.Interior){var u=n.Interior;u.Pattern&&(u.patternType=_$[u.Pattern]||u.Pattern)}e[n.ID]=n}function vH(e,n,a,u,f,_,w,T,o,k){var R="General",F=u.StyleID,B={};k=k||{};var V=[],G=0;for(F===void 0&&T&&(F=T.StyleID),F===void 0&&w&&(F=w.StyleID);_[F]!==void 0&&(_[F].nf&&(R=_[F].nf),_[F].Interior&&V.push(_[F].Interior),!!_[F].Parent);)F=_[F].Parent;switch(a.Type){case"Boolean":u.t="b",u.v=Ci(e);break;case"String":u.t="s",u.r=YI(Zn(e)),u.v=e.indexOf("<")>-1?Zn(n||e).replace(/<.*?>/g,""):u.r;break;case"DateTime":e.slice(-1)!="Z"&&(e+="Z"),u.v=(_a(e)-new Date(Date.UTC(1899,11,30)))/(24*60*60*1e3),u.v!==u.v?u.v=Zn(e):u.v<60&&(u.v=u.v-1),(!R||R=="General")&&(R="yyyy-mm-dd");case"Number":u.v===void 0&&(u.v=+e),u.t||(u.t="n");break;case"Error":u.t="e",u.v=NF[e],k.cellText!==!1&&(u.w=e);break;default:e==""&&n==""?u.t="z":(u.t="s",u.v=YI(n||e));break}if(xH(u,R,k),k.cellFormula!==!1)if(u.Formula){var U=Zn(u.Formula);U.charCodeAt(0)==61&&(U=U.slice(1)),u.f=Yd(U,f),delete u.Formula,u.ArrayRange=="RC"?u.F=Yd("RC:RC",f):u.ArrayRange&&(u.F=Yd(u.ArrayRange,f),o.push([Vi(u.F),u.F]))}else for(G=0;G<o.length;++G)f.r>=o[G][0].s.r&&f.r<=o[G][0].e.r&&f.c>=o[G][0].s.c&&f.c<=o[G][0].e.c&&(u.F=o[G][1]);k.cellStyles&&(V.forEach(function(J){!B.patternType&&J.patternType&&(B.patternType=J.patternType)}),u.s=B),u.StyleID!==void 0&&(u.ixfe=u.StyleID)}function wH(e){e.t=e.v||"",e.t=e.t.replace(/\r\n/g,`
`).replace(/\r/g,`
`),e.v=e.w=e.ixfe=void 0}function $b(e,n){var a=n||{};lF();var u=Vm(LS(e));(a.type=="binary"||a.type=="array"||a.type=="base64")&&(u=gi(u));var f=u.slice(0,1024).toLowerCase(),_=!1;if(f=f.replace(/".*?"/g,""),(f.indexOf(">")&1023)>Math.min(f.indexOf(",")&1023,f.indexOf(";")&1023)){var w=Aa(a);return w.type="string",Pg.to_workbook(u,w)}if(f.indexOf("<?xml")==-1&&["html","table","head","meta","script","style","div"].forEach(function(En){f.indexOf("<"+En)>=0&&(_=!0)}),_)return IH(u,a);ug={"General Number":"General","General Date":Tn[22],"Long Date":"dddd, mmmm dd, yyyy","Medium Date":Tn[15],"Short Date":Tn[14],"Long Time":Tn[19],"Medium Time":Tn[18],"Short Time":Tn[20],Currency:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',Fixed:Tn[2],Standard:Tn[4],Percent:Tn[10],Scientific:Tn[11],"Yes/No":'"Yes";"Yes";"No";@',"True/False":'"True";"True";"False";@',"On/Off":'"Yes";"Yes";"No";@'};var T,o=[],k,R={},F=[],B=a.dense?[]:{},V="",G={},U={},J=zo('<Data ss:Type="String">'),X=0,Y=0,Z=0,_e={s:{r:2e6,c:2e6},e:{r:0,c:0}},ke={},Ae={},me="",De=0,we=[],Je={},rt={},Re=0,St=[],Lt=[],We={},qt=[],Ot,st=!1,Ve=[],Et=[],Dt={},Se=0,at=0,He={Sheets:[],WBProps:{date1904:!1}},Xe={};Ig.lastIndex=0,u=u.replace(/<!--([\s\S]*?)-->/mg,"");for(var yt="";T=Ig.exec(u);)switch(T[3]=(yt=T[3]).toLowerCase()){case"data":if(yt=="data"){if(T[1]==="/"){if((k=o.pop())[0]!==T[3])throw new Error("Bad state: "+k.join("|"))}else T[0].charAt(T[0].length-2)!=="/"&&o.push([T[3],!0]);break}if(o[o.length-1][1])break;T[1]==="/"?vH(u.slice(X,T.index),me,J,o[o.length-1][0]=="comment"?We:G,{c:Y,r:Z},ke,qt[Y],U,Ve,a):(me="",J=zo(T[0]),X=T.index+T[0].length);break;case"cell":if(T[1]==="/")if(Lt.length>0&&(G.c=Lt),(!a.sheetRows||a.sheetRows>Z)&&G.v!==void 0&&(a.dense?(B[Z]||(B[Z]=[]),B[Z][Y]=G):B[ca(Y)+Ca(Z)]=G),G.HRef&&(G.l={Target:Zn(G.HRef)},G.HRefScreenTip&&(G.l.Tooltip=G.HRefScreenTip),delete G.HRef,delete G.HRefScreenTip),(G.MergeAcross||G.MergeDown)&&(Se=Y+(parseInt(G.MergeAcross,10)|0),at=Z+(parseInt(G.MergeDown,10)|0),we.push({s:{c:Y,r:Z},e:{c:Se,r:at}})),!a.sheetStubs)G.MergeAcross?Y=Se+1:++Y;else if(G.MergeAcross||G.MergeDown){for(var Jt=Y;Jt<=Se;++Jt)for(var sr=Z;sr<=at;++sr)(Jt>Y||sr>Z)&&(a.dense?(B[sr]||(B[sr]=[]),B[sr][Jt]={t:"z"}):B[ca(Jt)+Ca(sr)]={t:"z"});Y=Se+1}else++Y;else G=mH(T[0]),G.Index&&(Y=+G.Index-1),Y<_e.s.c&&(_e.s.c=Y),Y>_e.e.c&&(_e.e.c=Y),T[0].slice(-2)==="/>"&&++Y,Lt=[];break;case"row":T[1]==="/"||T[0].slice(-2)==="/>"?(Z<_e.s.r&&(_e.s.r=Z),Z>_e.e.r&&(_e.e.r=Z),T[0].slice(-2)==="/>"&&(U=zo(T[0]),U.Index&&(Z=+U.Index-1)),Y=0,++Z):(U=zo(T[0]),U.Index&&(Z=+U.Index-1),Dt={},(U.AutoFitHeight=="0"||U.Height)&&(Dt.hpx=parseInt(U.Height,10),Dt.hpt=iL(Dt.hpx),Et[Z]=Dt),U.Hidden=="1"&&(Dt.hidden=!0,Et[Z]=Dt));break;case"worksheet":if(T[1]==="/"){if((k=o.pop())[0]!==T[3])throw new Error("Bad state: "+k.join("|"));F.push(V),_e.s.r<=_e.e.r&&_e.s.c<=_e.e.c&&(B["!ref"]=jn(_e),a.sheetRows&&a.sheetRows<=_e.e.r&&(B["!fullref"]=B["!ref"],_e.e.r=a.sheetRows-1,B["!ref"]=jn(_e))),we.length&&(B["!merges"]=we),qt.length>0&&(B["!cols"]=qt),Et.length>0&&(B["!rows"]=Et),R[V]=B}else _e={s:{r:2e6,c:2e6},e:{r:0,c:0}},Z=Y=0,o.push([T[3],!1]),k=zo(T[0]),V=Zn(k.Name),B=a.dense?[]:{},we=[],Ve=[],Et=[],Xe={name:V,Hidden:0},He.Sheets.push(Xe);break;case"table":if(T[1]==="/"){if((k=o.pop())[0]!==T[3])throw new Error("Bad state: "+k.join("|"))}else{if(T[0].slice(-2)=="/>")break;o.push([T[3],!1]),qt=[],st=!1}break;case"style":T[1]==="/"?yH(ke,Ae,a):Ae=zo(T[0]);break;case"numberformat":Ae.nf=Zn(zo(T[0]).Format||"General"),ug[Ae.nf]&&(Ae.nf=ug[Ae.nf]);for(var Xt=0;Xt!=392&&Tn[Xt]!=Ae.nf;++Xt);if(Xt==392){for(Xt=57;Xt!=392;++Xt)if(Tn[Xt]==null){Jh(Ae.nf,Xt);break}}break;case"column":if(o[o.length-1][0]!=="table")break;if(Ot=zo(T[0]),Ot.Hidden&&(Ot.hidden=!0,delete Ot.Hidden),Ot.Width&&(Ot.wpx=parseInt(Ot.Width,10)),!st&&Ot.wpx>10){st=!0,ts=rL;for(var zt=0;zt<qt.length;++zt)qt[zt]&&lp(qt[zt])}st&&lp(Ot),qt[Ot.Index-1||qt.length]=Ot;for(var Or=0;Or<+Ot.Span;++Or)qt[qt.length]=Aa(Ot);break;case"namedrange":if(T[1]==="/")break;He.Names||(He.Names=[]);var Be=on(T[0]),Fn={Name:Be.Name,Ref:Yd(Be.RefersTo.slice(1),{r:0,c:0})};He.Sheets.length>0&&(Fn.Sheet=He.Sheets.length-1),He.Names.push(Fn);break;case"namedcell":break;case"b":break;case"i":break;case"u":break;case"s":break;case"em":break;case"h2":break;case"h3":break;case"sub":break;case"sup":break;case"span":break;case"alignment":break;case"borders":break;case"border":break;case"font":if(T[0].slice(-2)==="/>")break;T[1]==="/"?me+=u.slice(De,T.index):De=T.index+T[0].length;break;case"interior":if(!a.cellStyles)break;Ae.Interior=zo(T[0]);break;case"protection":break;case"author":case"title":case"description":case"created":case"keywords":case"subject":case"category":case"company":case"lastauthor":case"lastsaved":case"lastprinted":case"version":case"revision":case"totaltime":case"hyperlinkbase":case"manager":case"contentstatus":case"identifier":case"language":case"appname":if(T[0].slice(-2)==="/>")break;T[1]==="/"?i9(Je,yt,u.slice(Re,T.index)):Re=T.index+T[0].length;break;case"paragraphs":break;case"styles":case"workbook":if(T[1]==="/"){if((k=o.pop())[0]!==T[3])throw new Error("Bad state: "+k.join("|"))}else o.push([T[3],!1]);break;case"comment":if(T[1]==="/"){if((k=o.pop())[0]!==T[3])throw new Error("Bad state: "+k.join("|"));wH(We),Lt.push(We)}else o.push([T[3],!1]),k=zo(T[0]),We={a:k.Author};break;case"autofilter":if(T[1]==="/"){if((k=o.pop())[0]!==T[3])throw new Error("Bad state: "+k.join("|"))}else if(T[0].charAt(T[0].length-2)!=="/"){var Tr=zo(T[0]);B["!autofilter"]={ref:Yd(Tr.Range).replace(/\$/g,"")},o.push([T[3],!0])}break;case"name":break;case"datavalidation":if(T[1]==="/"){if((k=o.pop())[0]!==T[3])throw new Error("Bad state: "+k.join("|"))}else T[0].charAt(T[0].length-2)!=="/"&&o.push([T[3],!0]);break;case"pixelsperinch":break;case"componentoptions":case"documentproperties":case"customdocumentproperties":case"officedocumentsettings":case"pivottable":case"pivotcache":case"names":case"mapinfo":case"pagebreaks":case"querytable":case"sorting":case"schema":case"conditionalformatting":case"smarttagtype":case"smarttags":case"excelworkbook":case"workbookoptions":case"worksheetoptions":if(T[1]==="/"){if((k=o.pop())[0]!==T[3])throw new Error("Bad state: "+k.join("|"))}else T[0].charAt(T[0].length-2)!=="/"&&o.push([T[3],!0]);break;case"null":break;default:if(o.length==0&&T[3]=="document"||o.length==0&&T[3]=="uof")return FP(u,a);var Er=!0;switch(o[o.length-1][0]){case"officedocumentsettings":switch(T[3]){case"allowpng":break;case"removepersonalinformation":break;case"downloadcomponents":break;case"locationofcomponents":break;case"colors":break;case"color":break;case"index":break;case"rgb":break;case"targetscreensize":break;case"readonlyrecommended":break;default:Er=!1}break;case"componentoptions":switch(T[3]){case"toolbar":break;case"hideofficelogo":break;case"spreadsheetautofit":break;case"label":break;case"caption":break;case"maxheight":break;case"maxwidth":break;case"nextsheetnumber":break;default:Er=!1}break;case"excelworkbook":switch(T[3]){case"date1904":He.WBProps.date1904=!0;break;case"windowheight":break;case"windowwidth":break;case"windowtopx":break;case"windowtopy":break;case"tabratio":break;case"protectstructure":break;case"protectwindow":break;case"protectwindows":break;case"activesheet":break;case"displayinknotes":break;case"firstvisiblesheet":break;case"supbook":break;case"sheetname":break;case"sheetindex":break;case"sheetindexfirst":break;case"sheetindexlast":break;case"dll":break;case"acceptlabelsinformulas":break;case"donotsavelinkvalues":break;case"iteration":break;case"maxiterations":break;case"maxchange":break;case"path":break;case"xct":break;case"count":break;case"selectedsheets":break;case"calculation":break;case"uncalced":break;case"startupprompt":break;case"crn":break;case"externname":break;case"formula":break;case"colfirst":break;case"collast":break;case"wantadvise":break;case"boolean":break;case"error":break;case"text":break;case"ole":break;case"noautorecover":break;case"publishobjects":break;case"donotcalculatebeforesave":break;case"number":break;case"refmoder1c1":break;case"embedsavesmarttags":break;default:Er=!1}break;case"workbookoptions":switch(T[3]){case"owcversion":break;case"height":break;case"width":break;default:Er=!1}break;case"worksheetoptions":switch(T[3]){case"visible":if(T[0].slice(-2)!=="/>")if(T[1]==="/")switch(u.slice(Re,T.index)){case"SheetHidden":Xe.Hidden=1;break;case"SheetVeryHidden":Xe.Hidden=2;break}else Re=T.index+T[0].length;break;case"header":B["!margins"]||cg(B["!margins"]={},"xlml"),isNaN(+on(T[0]).Margin)||(B["!margins"].header=+on(T[0]).Margin);break;case"footer":B["!margins"]||cg(B["!margins"]={},"xlml"),isNaN(+on(T[0]).Margin)||(B["!margins"].footer=+on(T[0]).Margin);break;case"pagemargins":var Ir=on(T[0]);B["!margins"]||cg(B["!margins"]={},"xlml"),isNaN(+Ir.Top)||(B["!margins"].top=+Ir.Top),isNaN(+Ir.Left)||(B["!margins"].left=+Ir.Left),isNaN(+Ir.Right)||(B["!margins"].right=+Ir.Right),isNaN(+Ir.Bottom)||(B["!margins"].bottom=+Ir.Bottom);break;case"displayrighttoleft":He.Views||(He.Views=[]),He.Views[0]||(He.Views[0]={}),He.Views[0].RTL=!0;break;case"freezepanes":break;case"frozennosplit":break;case"splithorizontal":case"splitvertical":break;case"donotdisplaygridlines":break;case"activerow":break;case"activecol":break;case"toprowbottompane":break;case"leftcolumnrightpane":break;case"unsynced":break;case"print":break;case"printerrors":break;case"panes":break;case"scale":break;case"pane":break;case"number":break;case"layout":break;case"pagesetup":break;case"selected":break;case"protectobjects":break;case"enableselection":break;case"protectscenarios":break;case"validprinterinfo":break;case"horizontalresolution":break;case"verticalresolution":break;case"numberofcopies":break;case"activepane":break;case"toprowvisible":break;case"leftcolumnvisible":break;case"fittopage":break;case"rangeselection":break;case"papersizeindex":break;case"pagelayoutzoom":break;case"pagebreakzoom":break;case"filteron":break;case"fitwidth":break;case"fitheight":break;case"commentslayout":break;case"zoom":break;case"lefttoright":break;case"gridlines":break;case"allowsort":break;case"allowfilter":break;case"allowinsertrows":break;case"allowdeleterows":break;case"allowinsertcols":break;case"allowdeletecols":break;case"allowinserthyperlinks":break;case"allowformatcells":break;case"allowsizecols":break;case"allowsizerows":break;case"nosummaryrowsbelowdetail":B["!outline"]||(B["!outline"]={}),B["!outline"].above=!0;break;case"tabcolorindex":break;case"donotdisplayheadings":break;case"showpagelayoutzoom":break;case"nosummarycolumnsrightdetail":B["!outline"]||(B["!outline"]={}),B["!outline"].left=!0;break;case"blackandwhite":break;case"donotdisplayzeros":break;case"displaypagebreak":break;case"rowcolheadings":break;case"donotdisplayoutline":break;case"noorientation":break;case"allowusepivottables":break;case"zeroheight":break;case"viewablerange":break;case"selection":break;case"protectcontents":break;default:Er=!1}break;case"pivottable":case"pivotcache":switch(T[3]){case"immediateitemsondrop":break;case"showpagemultipleitemlabel":break;case"compactrowindent":break;case"location":break;case"pivotfield":break;case"orientation":break;case"layoutform":break;case"layoutsubtotallocation":break;case"layoutcompactrow":break;case"position":break;case"pivotitem":break;case"datatype":break;case"datafield":break;case"sourcename":break;case"parentfield":break;case"ptlineitems":break;case"ptlineitem":break;case"countofsameitems":break;case"item":break;case"itemtype":break;case"ptsource":break;case"cacheindex":break;case"consolidationreference":break;case"filename":break;case"reference":break;case"nocolumngrand":break;case"norowgrand":break;case"blanklineafteritems":break;case"hidden":break;case"subtotal":break;case"basefield":break;case"mapchilditems":break;case"function":break;case"refreshonfileopen":break;case"printsettitles":break;case"mergelabels":break;case"defaultversion":break;case"refreshname":break;case"refreshdate":break;case"refreshdatecopy":break;case"versionlastrefresh":break;case"versionlastupdate":break;case"versionupdateablemin":break;case"versionrefreshablemin":break;case"calculation":break;default:Er=!1}break;case"pagebreaks":switch(T[3]){case"colbreaks":break;case"colbreak":break;case"rowbreaks":break;case"rowbreak":break;case"colstart":break;case"colend":break;case"rowend":break;default:Er=!1}break;case"autofilter":switch(T[3]){case"autofiltercolumn":break;case"autofiltercondition":break;case"autofilterand":break;case"autofilteror":break;default:Er=!1}break;case"querytable":switch(T[3]){case"id":break;case"autoformatfont":break;case"autoformatpattern":break;case"querysource":break;case"querytype":break;case"enableredirections":break;case"refreshedinxl9":break;case"urlstring":break;case"htmltables":break;case"connection":break;case"commandtext":break;case"refreshinfo":break;case"notitles":break;case"nextid":break;case"columninfo":break;case"overwritecells":break;case"donotpromptforfile":break;case"textwizardsettings":break;case"source":break;case"number":break;case"decimal":break;case"thousandseparator":break;case"trailingminusnumbers":break;case"formatsettings":break;case"fieldtype":break;case"delimiters":break;case"tab":break;case"comma":break;case"autoformatname":break;case"versionlastedit":break;case"versionlastrefresh":break;default:Er=!1}break;case"datavalidation":switch(T[3]){case"range":break;case"type":break;case"min":break;case"max":break;case"sort":break;case"descending":break;case"order":break;case"casesensitive":break;case"value":break;case"errorstyle":break;case"errormessage":break;case"errortitle":break;case"inputmessage":break;case"inputtitle":break;case"combohide":break;case"inputhide":break;case"condition":break;case"qualifier":break;case"useblank":break;case"value1":break;case"value2":break;case"format":break;case"cellrangelist":break;default:Er=!1}break;case"sorting":case"conditionalformatting":switch(T[3]){case"range":break;case"type":break;case"min":break;case"max":break;case"sort":break;case"descending":break;case"order":break;case"casesensitive":break;case"value":break;case"errorstyle":break;case"errormessage":break;case"errortitle":break;case"cellrangelist":break;case"inputmessage":break;case"inputtitle":break;case"combohide":break;case"inputhide":break;case"condition":break;case"qualifier":break;case"useblank":break;case"value1":break;case"value2":break;case"format":break;default:Er=!1}break;case"mapinfo":case"schema":case"data":switch(T[3]){case"map":break;case"entry":break;case"range":break;case"xpath":break;case"field":break;case"xsdtype":break;case"filteron":break;case"aggregate":break;case"elementtype":break;case"attributetype":break;case"schema":case"element":case"complextype":case"datatype":case"all":case"attribute":case"extends":break;case"row":break;default:Er=!1}break;case"smarttags":break;default:Er=!1;break}if(Er||T[3].match(/!\[CDATA/))break;if(!o[o.length-1][1])throw"Unrecognized tag: "+T[3]+"|"+o.join("|");if(o[o.length-1][0]==="customdocumentproperties"){if(T[0].slice(-2)==="/>")break;T[1]==="/"?_H(rt,yt,St,u.slice(Re,T.index)):(St=T,Re=T.index+T[0].length);break}if(a.WTF)throw"Unrecognized tag: "+T[3]+"|"+o.join("|")}var nr={};return!a.bookSheets&&!a.bookProps&&(nr.Sheets=R),nr.SheetNames=F,nr.Workbook=He,nr.SSF=Aa(Tn),nr.Props=Je,nr.Custprops=rt,nr}function sE(e,n){switch(YS(n=n||{}),n.type||"base64"){case"base64":return $b(Ws(e),n);case"binary":case"buffer":case"file":return $b(e,n);case"array":return $b(df(e),n)}}function bH(e){var n={},a=e.content;if(a.l=28,n.AnsiUserType=a.read_shift(0,"lpstr-ansi"),n.AnsiClipboardFormat=O7(a),a.length-a.l<=4)return n;var u=a.read_shift(4);if(u==0||u>40||(a.l-=4,n.Reserved1=a.read_shift(0,"lpstr-ansi"),a.length-a.l<=4)||(u=a.read_shift(4),u!==1907505652)||(n.UnicodeClipboardFormat=N7(a),u=a.read_shift(4),u==0||u>40))return n;a.l-=4,n.Reserved2=a.read_shift(0,"lpwstr")}var TH=[60,1084,2066,2165,2175];function EH(e,n,a,u,f){var _=u,w=[],T=a.slice(a.l,a.l+_);if(f&&f.enc&&f.enc.insitu&&T.length>0)switch(e){case 9:case 521:case 1033:case 2057:case 47:case 405:case 225:case 406:case 312:case 404:case 10:break;case 133:break;default:f.enc.insitu(T)}w.push(T),a.l+=_;for(var o=hc(a,a.l),k=oE[o],R=0;k!=null&&TH.indexOf(o)>-1;)_=hc(a,a.l+2),R=a.l+4,o==2066?R+=4:(o==2165||o==2175)&&(R+=12),T=a.slice(R,a.l+4+_),w.push(T),a.l+=4+_,k=oE[o=hc(a,a.l)];var F=wu(w);Ea(F,0);var B=0;F.lens=[];for(var V=0;V<w.length;++V)F.lens.push(B),B+=w[V].length;if(F.length<u)throw"XLS Record 0x"+e.toString(16)+" Truncated: "+F.length+" < "+u;return n.f(F,F.length,f)}function Tl(e,n,a){if(e.t!=="z"&&e.XF){var u=0;try{u=e.z||e.XF.numFmtId||0,n.cellNF&&(e.z=Tn[u])}catch(_){if(n.WTF)throw _}if(!n||n.cellText!==!1)try{e.t==="e"?e.w=e.w||gf[e.v]:u===0||u=="General"?e.t==="n"?(e.v|0)===e.v?e.w=e.v.toString(10):e.w=kg(e.v):e.w=sf(e.v):e.w=fo(u,e.v,{date1904:!!a,dateNF:n&&n.dateNF})}catch(_){if(n.WTF)throw _}if(n.cellDates&&u&&e.t=="n"&&gp(Tn[u]||String(u))){var f=Zh(e.v);f&&(e.t="d",e.v=new Date(f.y,f.m-1,f.d,f.H,f.M,f.S,f.u))}}}function by(e,n,a){return{v:e,ixfe:n,t:a}}function SH(e,n){var a={opts:{}},u={},f=n.dense?[]:{},_={},w={},T=null,o=[],k="",R={},F,B="",V,G,U,J,X={},Y=[],Z,_e,ke=[],Ae=[],me={Sheets:[],WBProps:{date1904:!1},Views:[{}]},De={},we=function(et){return et<8?Qh[et]:et<64&&Ae[et-8]||Qh[et]},Je=function(et,ut,_t){var $t=ut.XF.data;if(!(!$t||!$t.patternType||!_t||!_t.cellStyles)){ut.s={},ut.s.patternType=$t.patternType;var dt;(dt=Rg(we($t.icvFore)))&&(ut.s.fgColor={rgb:dt}),(dt=Rg(we($t.icvBack)))&&(ut.s.bgColor={rgb:dt})}},rt=function(et,ut,_t){if(!(Dt>1)&&!(_t.sheetRows&&et.r>=_t.sheetRows)){if(_t.cellStyles&&ut.XF&&ut.XF.data&&Je(et,ut,_t),delete ut.ixfe,delete ut.XF,F=et,B=yn(et),(!w||!w.s||!w.e)&&(w={s:{r:0,c:0},e:{r:0,c:0}}),et.r<w.s.r&&(w.s.r=et.r),et.c<w.s.c&&(w.s.c=et.c),et.r+1>w.e.r&&(w.e.r=et.r+1),et.c+1>w.e.c&&(w.e.c=et.c+1),_t.cellFormula&&ut.f){for(var $t=0;$t<Y.length;++$t)if(!(Y[$t][0].s.c>et.c||Y[$t][0].s.r>et.r)&&!(Y[$t][0].e.c<et.c||Y[$t][0].e.r<et.r)){ut.F=jn(Y[$t][0]),(Y[$t][0].s.c!=et.c||Y[$t][0].s.r!=et.r)&&delete ut.f,ut.f&&(ut.f=""+Va(Y[$t][1],w,et,Ve,Re));break}}_t.dense?(f[et.r]||(f[et.r]=[]),f[et.r][et.c]=ut):f[B]=ut}},Re={enc:!1,sbcch:0,snames:[],sharedf:X,arrayf:Y,rrtabid:[],lastuser:"",biff:8,codepage:0,winlocked:0,cellStyles:!!n&&!!n.cellStyles,WTF:!!n&&!!n.wtf};n.password&&(Re.password=n.password);var St,Lt=[],We=[],qt=[],Ot=[],st=!1,Ve=[];Ve.SheetNames=Re.snames,Ve.sharedf=Re.sharedf,Ve.arrayf=Re.arrayf,Ve.names=[],Ve.XTI=[];var Et=0,Dt=0,Se=0,at=[],He=[],Xe;Re.codepage=1200,Wo(1200);for(var yt=!1;e.l<e.length-1;){var Jt=e.l,sr=e.read_shift(2);if(sr===0&&Et===10)break;var Xt=e.l===e.length?0:e.read_shift(2),zt=oE[sr];if(zt&&zt.f){if(n.bookSheets&&Et===133&&sr!==133)break;if(Et=sr,zt.r===2||zt.r==12){var Or=e.read_shift(2);if(Xt-=2,!Re.enc&&Or!==sr&&((Or&255)<<8|Or>>8)!==sr)throw new Error("rt mismatch: "+Or+"!="+sr);zt.r==12&&(e.l+=10,Xt-=10)}var Be={};if(sr===10?Be=zt.f(e,Xt,Re):Be=EH(sr,zt,e,Xt,Re),Dt==0&&[9,521,1033,2057].indexOf(Et)===-1)continue;switch(sr){case 34:a.opts.Date1904=me.WBProps.date1904=Be;break;case 134:a.opts.WriteProtect=!0;break;case 47:if(Re.enc||(e.l=0),Re.enc=Be,!n.password)throw new Error("File is password-protected");if(Be.valid==null)throw new Error("Encryption scheme unsupported");if(!Be.valid)throw new Error("Password is incorrect");break;case 92:Re.lastuser=Be;break;case 66:var Fn=Number(Be);switch(Fn){case 21010:Fn=1200;break;case 32768:Fn=1e4;break;case 32769:Fn=1252;break}Wo(Re.codepage=Fn),yt=!0;break;case 317:Re.rrtabid=Be;break;case 25:Re.winlocked=Be;break;case 439:a.opts.RefreshAll=Be;break;case 12:a.opts.CalcCount=Be;break;case 16:a.opts.CalcDelta=Be;break;case 17:a.opts.CalcIter=Be;break;case 13:a.opts.CalcMode=Be;break;case 14:a.opts.CalcPrecision=Be;break;case 95:a.opts.CalcSaveRecalc=Be;break;case 15:Re.CalcRefMode=Be;break;case 2211:a.opts.FullCalc=Be;break;case 129:Be.fDialog&&(f["!type"]="dialog"),Be.fBelow||((f["!outline"]||(f["!outline"]={})).above=!0),Be.fRight||((f["!outline"]||(f["!outline"]={})).left=!0);break;case 224:ke.push(Be);break;case 430:Ve.push([Be]),Ve[Ve.length-1].XTI=[];break;case 35:case 547:Ve[Ve.length-1].push(Be);break;case 24:case 536:Xe={Name:Be.Name,Ref:Va(Be.rgce,w,null,Ve,Re)},Be.itab>0&&(Xe.Sheet=Be.itab-1),Ve.names.push(Xe),Ve[0]||(Ve[0]=[],Ve[0].XTI=[]),Ve[Ve.length-1].push(Be),Be.Name=="_xlnm._FilterDatabase"&&Be.itab>0&&Be.rgce&&Be.rgce[0]&&Be.rgce[0][0]&&Be.rgce[0][0][0]=="PtgArea3d"&&(He[Be.itab-1]={ref:jn(Be.rgce[0][0][1][2])});break;case 22:Re.ExternCount=Be;break;case 23:Ve.length==0&&(Ve[0]=[],Ve[0].XTI=[]),Ve[Ve.length-1].XTI=Ve[Ve.length-1].XTI.concat(Be),Ve.XTI=Ve.XTI.concat(Be);break;case 2196:if(Re.biff<8)break;Xe!=null&&(Xe.Comment=Be[1]);break;case 18:f["!protect"]=Be;break;case 19:Be!==0&&Re.WTF&&console.error("Password verifier: "+Be);break;case 133:_[Be.pos]=Be,Re.snames.push(Be.name);break;case 10:{if(--Dt)break;if(w.e){if(w.e.r>0&&w.e.c>0){if(w.e.r--,w.e.c--,f["!ref"]=jn(w),n.sheetRows&&n.sheetRows<=w.e.r){var Tr=w.e.r;w.e.r=n.sheetRows-1,f["!fullref"]=f["!ref"],f["!ref"]=jn(w),w.e.r=Tr}w.e.r++,w.e.c++}Lt.length>0&&(f["!merges"]=Lt),We.length>0&&(f["!objects"]=We),qt.length>0&&(f["!cols"]=qt),Ot.length>0&&(f["!rows"]=Ot),me.Sheets.push(De)}k===""?R=f:u[k]=f,f=n.dense?[]:{}}break;case 9:case 521:case 1033:case 2057:{if(Re.biff===8&&(Re.biff={9:2,521:3,1033:4}[sr]||{512:2,768:3,1024:4,1280:5,1536:8,2:2,7:2}[Be.BIFFVer]||8),Re.biffguess=Be.BIFFVer==0,Be.BIFFVer==0&&Be.dt==4096&&(Re.biff=5,yt=!0,Wo(Re.codepage=28591)),Re.biff==8&&Be.BIFFVer==0&&Be.dt==16&&(Re.biff=2),Dt++)break;if(f=n.dense?[]:{},Re.biff<8&&!yt&&(yt=!0,Wo(Re.codepage=n.codepage||1252)),Re.biff<5||Be.BIFFVer==0&&Be.dt==4096){k===""&&(k="Sheet1"),w={s:{r:0,c:0},e:{r:0,c:0}};var Er={pos:e.l-Xt,name:k};_[Er.pos]=Er,Re.snames.push(k)}else k=(_[Jt]||{name:""}).name;Be.dt==32&&(f["!type"]="chart"),Be.dt==64&&(f["!type"]="macro"),Lt=[],We=[],Re.arrayf=Y=[],qt=[],Ot=[],st=!1,De={Hidden:(_[Jt]||{hs:0}).hs,name:k}}break;case 515:case 3:case 2:f["!type"]=="chart"&&(n.dense?(f[Be.r]||[])[Be.c]:f[yn({c:Be.c,r:Be.r})])&&++Be.c,Z={ixfe:Be.ixfe,XF:ke[Be.ixfe]||{},v:Be.val,t:"n"},Se>0&&(Z.z=at[Z.ixfe>>8&63]),Tl(Z,n,a.opts.Date1904),rt({c:Be.c,r:Be.r},Z,n);break;case 5:case 517:Z={ixfe:Be.ixfe,XF:ke[Be.ixfe],v:Be.val,t:Be.t},Se>0&&(Z.z=at[Z.ixfe>>8&63]),Tl(Z,n,a.opts.Date1904),rt({c:Be.c,r:Be.r},Z,n);break;case 638:Z={ixfe:Be.ixfe,XF:ke[Be.ixfe],v:Be.rknum,t:"n"},Se>0&&(Z.z=at[Z.ixfe>>8&63]),Tl(Z,n,a.opts.Date1904),rt({c:Be.c,r:Be.r},Z,n);break;case 189:for(var Ir=Be.c;Ir<=Be.C;++Ir){var nr=Be.rkrec[Ir-Be.c][0];Z={ixfe:nr,XF:ke[nr],v:Be.rkrec[Ir-Be.c][1],t:"n"},Se>0&&(Z.z=at[Z.ixfe>>8&63]),Tl(Z,n,a.opts.Date1904),rt({c:Ir,r:Be.r},Z,n)}break;case 6:case 518:case 1030:{if(Be.val=="String"){T=Be;break}if(Z=by(Be.val,Be.cell.ixfe,Be.tt),Z.XF=ke[Z.ixfe],n.cellFormula){var En=Be.formula;if(En&&En[0]&&En[0][0]&&En[0][0][0]=="PtgExp"){var Xn=En[0][0][1][0],wn=En[0][0][1][1],ei=yn({r:Xn,c:wn});X[ei]?Z.f=""+Va(Be.formula,w,Be.cell,Ve,Re):Z.F=((n.dense?(f[Xn]||[])[wn]:f[ei])||{}).F}else Z.f=""+Va(Be.formula,w,Be.cell,Ve,Re)}Se>0&&(Z.z=at[Z.ixfe>>8&63]),Tl(Z,n,a.opts.Date1904),rt(Be.cell,Z,n),T=Be}break;case 7:case 519:if(T)T.val=Be,Z=by(Be,T.cell.ixfe,"s"),Z.XF=ke[Z.ixfe],n.cellFormula&&(Z.f=""+Va(T.formula,w,T.cell,Ve,Re)),Se>0&&(Z.z=at[Z.ixfe>>8&63]),Tl(Z,n,a.opts.Date1904),rt(T.cell,Z,n),T=null;else throw new Error("String record expects Formula");break;case 33:case 545:{Y.push(Be);var bi=yn(Be[0].s);if(V=n.dense?(f[Be[0].s.r]||[])[Be[0].s.c]:f[bi],n.cellFormula&&V){if(!T||!bi||!V)break;V.f=""+Va(Be[1],w,Be[0],Ve,Re),V.F=jn(Be[0])}}break;case 1212:{if(!n.cellFormula)break;if(B){if(!T)break;X[yn(T.cell)]=Be[0],V=n.dense?(f[T.cell.r]||[])[T.cell.c]:f[yn(T.cell)],(V||{}).f=""+Va(Be[0],w,F,Ve,Re)}}break;case 253:Z=by(o[Be.isst].t,Be.ixfe,"s"),o[Be.isst].h&&(Z.h=o[Be.isst].h),Z.XF=ke[Z.ixfe],Se>0&&(Z.z=at[Z.ixfe>>8&63]),Tl(Z,n,a.opts.Date1904),rt({c:Be.c,r:Be.r},Z,n);break;case 513:n.sheetStubs&&(Z={ixfe:Be.ixfe,XF:ke[Be.ixfe],t:"z"},Se>0&&(Z.z=at[Z.ixfe>>8&63]),Tl(Z,n,a.opts.Date1904),rt({c:Be.c,r:Be.r},Z,n));break;case 190:if(n.sheetStubs)for(var Mn=Be.c;Mn<=Be.C;++Mn){var Nn=Be.ixfe[Mn-Be.c];Z={ixfe:Nn,XF:ke[Nn],t:"z"},Se>0&&(Z.z=at[Z.ixfe>>8&63]),Tl(Z,n,a.opts.Date1904),rt({c:Mn,r:Be.r},Z,n)}break;case 214:case 516:case 4:Z=by(Be.val,Be.ixfe,"s"),Z.XF=ke[Z.ixfe],Se>0&&(Z.z=at[Z.ixfe>>8&63]),Tl(Z,n,a.opts.Date1904),rt({c:Be.c,r:Be.r},Z,n);break;case 0:case 512:Dt===1&&(w=Be);break;case 252:o=Be;break;case 1054:if(Re.biff==4){at[Se++]=Be[1];for(var ti=0;ti<Se+163&&Tn[ti]!=Be[1];++ti);ti>=163&&Jh(Be[1],Se+163)}else Jh(Be[1],Be[0]);break;case 30:{at[Se++]=Be;for(var gt=0;gt<Se+163&&Tn[gt]!=Be;++gt);gt>=163&&Jh(Be,Se+163)}break;case 229:Lt=Lt.concat(Be);break;case 93:We[Be.cmo[0]]=Re.lastobj=Be;break;case 438:Re.lastobj.TxO=Be;break;case 127:Re.lastobj.ImData=Be;break;case 440:for(J=Be[0].s.r;J<=Be[0].e.r;++J)for(U=Be[0].s.c;U<=Be[0].e.c;++U)V=n.dense?(f[J]||[])[U]:f[yn({c:U,r:J})],V&&(V.l=Be[1]);break;case 2048:for(J=Be[0].s.r;J<=Be[0].e.r;++J)for(U=Be[0].s.c;U<=Be[0].e.c;++U)V=n.dense?(f[J]||[])[U]:f[yn({c:U,r:J})],V&&V.l&&(V.l.Tooltip=Be[1]);break;case 28:{if(Re.biff<=5&&Re.biff>=2)break;V=n.dense?(f[Be[0].r]||[])[Be[0].c]:f[yn(Be[0])];var le=We[Be[2]];V||(n.dense?(f[Be[0].r]||(f[Be[0].r]=[]),V=f[Be[0].r][Be[0].c]={t:"z"}):V=f[yn(Be[0])]={t:"z"},w.e.r=Math.max(w.e.r,Be[0].r),w.s.r=Math.min(w.s.r,Be[0].r),w.e.c=Math.max(w.e.c,Be[0].c),w.s.c=Math.min(w.s.c,Be[0].c)),V.c||(V.c=[]),G={a:Be[1],t:le.TxO.t},V.c.push(G)}break;case 2173:q$(ke[Be.ixfe],Be.ext);break;case 125:{if(!Re.cellStyles)break;for(;Be.e>=Be.s;)qt[Be.e--]={width:Be.w/256,level:Be.level||0,hidden:!!(Be.flags&1)},st||(st=!0,HS(Be.w/256)),lp(qt[Be.e+1])}break;case 520:{var Te={};Be.level!=null&&(Ot[Be.r]=Te,Te.level=Be.level),Be.hidden&&(Ot[Be.r]=Te,Te.hidden=!0),Be.hpt&&(Ot[Be.r]=Te,Te.hpt=Be.hpt,Te.hpx=Dg(Be.hpt))}break;case 38:case 39:case 40:case 41:f["!margins"]||cg(f["!margins"]={}),f["!margins"][{38:"left",39:"right",40:"top",41:"bottom"}[sr]]=Be;break;case 161:f["!margins"]||cg(f["!margins"]={}),f["!margins"].header=Be.header,f["!margins"].footer=Be.footer;break;case 574:Be.RTL&&(me.Views[0].RTL=!0);break;case 146:Ae=Be;break;case 2198:St=Be;break;case 140:_e=Be;break;case 442:k?De.CodeName=Be||De.name:me.WBProps.CodeName=Be||"ThisWorkbook";break}}else zt||console.error("Missing Info for XLS Record 0x"+sr.toString(16)),e.l+=Xt}return a.SheetNames=Pl(_).sort(function(Ne,et){return Number(Ne)-Number(et)}).map(function(Ne){return _[Ne].name}),n.bookSheets||(a.Sheets=u),!a.SheetNames.length&&R["!ref"]?(a.SheetNames.push("Sheet1"),a.Sheets&&(a.Sheets.Sheet1=R)):a.Preamble=R,a.Sheets&&He.forEach(function(Ne,et){a.Sheets[a.SheetNames[et]]["!autofilter"]=Ne}),a.Strings=o,a.SSF=Aa(Tn),Re.enc&&(a.Encryption=Re.enc),St&&(a.Themes=St),a.Metadata={},_e!==void 0&&(a.Metadata.Country=_e),Ve.names.length>0&&(me.Names=Ve.names),a.Workbook=me,a}var MP={SI:"e0859ff2f94f6810ab9108002b27b3d9",DSI:"02d5cdd59c2e1b10939708002b2cf9ae",UDI:"05d5cdd59c2e1b10939708002b2cf9ae"};function AH(e,n,a){var u=$n.find(e,"/!DocumentSummaryInformation");if(u&&u.size>0)try{var f=fP(u,j7,MP.DSI);for(var _ in f)n[_]=f[_]}catch(k){if(a.WTF)throw k}var w=$n.find(e,"/!SummaryInformation");if(w&&w.size>0)try{var T=fP(w,G7,MP.SI);for(var o in T)n[o]==null&&(n[o]=T[o])}catch(k){if(a.WTF)throw k}n.HeadingPairs&&n.TitlesOfParts&&(BF(n.HeadingPairs,n.TitlesOfParts,n,a),delete n.HeadingPairs,delete n.TitlesOfParts)}function bL(e,n){n||(n={}),YS(n),YD(),n.codepage&&kS(n.codepage);var a,u;if(e.FullPaths){if($n.find(e,"/encryption"))throw new Error("File is password-protected");a=$n.find(e,"!CompObj"),u=$n.find(e,"/Workbook")||$n.find(e,"/Book")}else{switch(n.type){case"base64":e=Ho(Ws(e));break;case"binary":e=Ho(e);break;case"buffer":break;case"array":Array.isArray(e)||(e=Array.prototype.slice.call(e));break}Ea(e,0),u={content:e}}var f,_;if(a&&bH(a),n.bookProps&&!n.bookSheets)f={};else{var w=zn?"buffer":"array";if(u&&u.content)f=SH(u.content,n);else if((_=$n.find(e,"PerfectOffice_MAIN"))&&_.content)f=og.to_workbook(_.content,(n.type=w,n));else if((_=$n.find(e,"NativeContent_MAIN"))&&_.content)f=og.to_workbook(_.content,(n.type=w,n));else throw(_=$n.find(e,"MN0"))&&_.content?new Error("Unsupported Works 4 for Mac file"):new Error("Cannot find Workbook stream");n.bookVBA&&e.FullPaths&&$n.find(e,"/_VBA_PROJECT_CUR/VBA/dir")&&(f.vbaraw=hj(e))}var T={};return e.FullPaths&&AH(e,T,n),f.Props=f.Custprops=T,n.bookFiles&&(f.cfb=e),f}var L1={0:{f:oG},1:{f:hG},2:{f:vG},3:{f:mG},4:{f:dG},5:{f:yG},6:{f:TG},7:{f:_G},8:{f:kG},9:{f:CG},10:{f:SG},11:{f:AG},12:{f:fG},13:{f:wG},14:{f:gG},15:{f:pG},16:{f:_L},17:{f:EG},18:{f:xG},19:{f:BS},20:{},21:{},22:{},23:{},24:{},25:{},26:{},27:{},28:{},29:{},30:{},31:{},32:{},33:{},34:{},35:{T:1},36:{T:-1},37:{T:1},38:{T:-1},39:{f:tH},40:{},42:{},43:{f:S$},44:{f:E$},45:{f:A$},46:{f:k$},47:{f:C$},48:{},49:{f:M7},50:{},51:{f:X$},52:{T:1},53:{T:-1},54:{T:1},55:{T:-1},56:{T:1},57:{T:-1},58:{},59:{},60:{f:KF},62:{f:bG},63:{f:ej},64:{f:NG},65:{},66:{},67:{},68:{},69:{},70:{},128:{},129:{T:1},130:{T:-1},131:{T:1,f:qa,p:0},132:{T:-1},133:{T:1},134:{T:-1},135:{T:1},136:{T:-1},137:{T:1,f:OG},138:{T:-1},139:{T:1},140:{T:-1},141:{T:1},142:{T:-1},143:{T:1},144:{T:-1},145:{T:1},146:{T:-1},147:{f:uG},148:{f:lG,p:16},151:{f:PG},152:{},153:{f:QG},154:{},155:{},156:{f:JG},157:{},158:{},159:{T:1,f:GV},160:{T:-1},161:{T:1,f:mf},162:{T:-1},163:{T:1},164:{T:-1},165:{T:1},166:{T:-1},167:{},168:{},169:{},170:{},171:{},172:{T:1},173:{T:-1},174:{},175:{},176:{f:MG},177:{T:1},178:{T:-1},179:{T:1},180:{T:-1},181:{T:1},182:{T:-1},183:{T:1},184:{T:-1},185:{T:1},186:{T:-1},187:{T:1},188:{T:-1},189:{T:1},190:{T:-1},191:{T:1},192:{T:-1},193:{T:1},194:{T:-1},195:{T:1},196:{T:-1},197:{T:1},198:{T:-1},199:{T:1},200:{T:-1},201:{T:1},202:{T:-1},203:{T:1},204:{T:-1},205:{T:1},206:{T:-1},207:{T:1},208:{T:-1},209:{T:1},210:{T:-1},211:{T:1},212:{T:-1},213:{T:1},214:{T:-1},215:{T:1},216:{T:-1},217:{T:1},218:{T:-1},219:{T:1},220:{T:-1},221:{T:1},222:{T:-1},223:{T:1},224:{T:-1},225:{T:1},226:{T:-1},227:{T:1},228:{T:-1},229:{T:1},230:{T:-1},231:{T:1},232:{T:-1},233:{T:1},234:{T:-1},235:{T:1},236:{T:-1},237:{T:1},238:{T:-1},239:{T:1},240:{T:-1},241:{T:1},242:{T:-1},243:{T:1},244:{T:-1},245:{T:1},246:{T:-1},247:{T:1},248:{T:-1},249:{T:1},250:{T:-1},251:{T:1},252:{T:-1},253:{T:1},254:{T:-1},255:{T:1},256:{T:-1},257:{T:1},258:{T:-1},259:{T:1},260:{T:-1},261:{T:1},262:{T:-1},263:{T:1},264:{T:-1},265:{T:1},266:{T:-1},267:{T:1},268:{T:-1},269:{T:1},270:{T:-1},271:{T:1},272:{T:-1},273:{T:1},274:{T:-1},275:{T:1},276:{T:-1},277:{},278:{T:1},279:{T:-1},280:{T:1},281:{T:-1},282:{T:1},283:{T:1},284:{T:-1},285:{T:1},286:{T:-1},287:{T:1},288:{T:-1},289:{T:1},290:{T:-1},291:{T:1},292:{T:-1},293:{T:1},294:{T:-1},295:{T:1},296:{T:-1},297:{T:1},298:{T:-1},299:{T:1},300:{T:-1},301:{T:1},302:{T:-1},303:{T:1},304:{T:-1},305:{T:1},306:{T:-1},307:{T:1},308:{T:-1},309:{T:1},310:{T:-1},311:{T:1},312:{T:-1},313:{T:-1},314:{T:1},315:{T:-1},316:{T:1},317:{T:-1},318:{T:1},319:{T:-1},320:{T:1},321:{T:-1},322:{T:1},323:{T:-1},324:{T:1},325:{T:-1},326:{T:1},327:{T:-1},328:{T:1},329:{T:-1},330:{T:1},331:{T:-1},332:{T:1},333:{T:-1},334:{T:1},335:{f:Z$},336:{T:-1},337:{f:Y$,T:1},338:{T:-1},339:{T:1},340:{T:-1},341:{T:1},342:{T:-1},343:{T:1},344:{T:-1},345:{T:1},346:{T:-1},347:{T:1},348:{T:-1},349:{T:1},350:{T:-1},351:{},352:{},353:{T:1},354:{T:-1},355:{f:rE},357:{},358:{},359:{},360:{T:1},361:{},362:{f:YF},363:{},364:{},366:{},367:{},368:{},369:{},370:{},371:{},372:{T:1},373:{T:-1},374:{T:1},375:{T:-1},376:{T:1},377:{T:-1},378:{T:1},379:{T:-1},380:{T:1},381:{T:-1},382:{T:1},383:{T:-1},384:{T:1},385:{T:-1},386:{T:1},387:{T:-1},388:{T:1},389:{T:-1},390:{T:1},391:{T:-1},392:{T:1},393:{T:-1},394:{T:1},395:{T:-1},396:{},397:{},398:{},399:{},400:{},401:{T:1},403:{},404:{},405:{},406:{},407:{},408:{},409:{},410:{},411:{},412:{},413:{},414:{},415:{},416:{},417:{},418:{},419:{},420:{},421:{},422:{T:1},423:{T:1},424:{T:-1},425:{T:-1},426:{f:RG},427:{f:DG},428:{},429:{T:1},430:{T:-1},431:{T:1},432:{T:-1},433:{T:1},434:{T:-1},435:{T:1},436:{T:-1},437:{T:1},438:{T:-1},439:{T:1},440:{T:-1},441:{T:1},442:{T:-1},443:{T:1},444:{T:-1},445:{T:1},446:{T:-1},447:{T:1},448:{T:-1},449:{T:1},450:{T:-1},451:{T:1},452:{T:-1},453:{T:1},454:{T:-1},455:{T:1},456:{T:-1},457:{T:1},458:{T:-1},459:{T:1},460:{T:-1},461:{T:1},462:{T:-1},463:{T:1},464:{T:-1},465:{T:1},466:{T:-1},467:{T:1},468:{T:-1},469:{T:1},470:{T:-1},471:{},472:{},473:{T:1},474:{T:-1},475:{},476:{f:LG},477:{},478:{},479:{T:1},480:{T:-1},481:{T:1},482:{T:-1},483:{T:1},484:{T:-1},485:{f:cG},486:{T:1},487:{T:-1},488:{T:1},489:{T:-1},490:{T:1},491:{T:-1},492:{T:1},493:{T:-1},494:{f:IG},495:{T:1},496:{T:-1},497:{T:1},498:{T:-1},499:{},500:{T:1},501:{T:-1},502:{T:1},503:{T:-1},504:{},505:{T:1},506:{T:-1},507:{},508:{T:1},509:{T:-1},510:{T:1},511:{T:-1},512:{},513:{},514:{T:1},515:{T:-1},516:{T:1},517:{T:-1},518:{T:1},519:{T:-1},520:{T:1},521:{T:-1},522:{},523:{},524:{},525:{},526:{},527:{},528:{T:1},529:{T:-1},530:{T:1},531:{T:-1},532:{T:1},533:{T:-1},534:{},535:{},536:{},537:{},538:{T:1},539:{T:-1},540:{T:1},541:{T:-1},542:{T:1},548:{},549:{},550:{f:rE},551:{},552:{},553:{},554:{T:1},555:{T:-1},556:{T:1},557:{T:-1},558:{T:1},559:{T:-1},560:{T:1},561:{T:-1},562:{},564:{},565:{T:1},566:{T:-1},569:{T:1},570:{T:-1},572:{},573:{T:1},574:{T:-1},577:{},578:{},579:{},580:{},581:{},582:{},583:{},584:{},585:{},586:{},587:{},588:{T:-1},589:{},590:{T:1},591:{T:-1},592:{T:1},593:{T:-1},594:{T:1},595:{T:-1},596:{},597:{T:1},598:{T:-1},599:{T:1},600:{T:-1},601:{T:1},602:{T:-1},603:{T:1},604:{T:-1},605:{T:1},606:{T:-1},607:{},608:{T:1},609:{T:-1},610:{},611:{T:1},612:{T:-1},613:{T:1},614:{T:-1},615:{T:1},616:{T:-1},617:{T:1},618:{T:-1},619:{T:1},620:{T:-1},625:{},626:{T:1},627:{T:-1},628:{T:1},629:{T:-1},630:{T:1},631:{T:-1},632:{f:lj},633:{T:1},634:{T:-1},635:{T:1,f:oj},636:{T:-1},637:{f:P7},638:{T:1},639:{},640:{T:-1},641:{T:1},642:{T:-1},643:{T:1},644:{},645:{T:-1},646:{T:1},648:{T:1},649:{},650:{T:-1},651:{f:jG},652:{},653:{T:1},654:{T:-1},655:{T:1},656:{T:-1},657:{T:1},658:{T:-1},659:{},660:{T:1},661:{},662:{T:-1},663:{},664:{T:1},665:{},666:{T:-1},667:{},668:{},669:{},671:{T:1},672:{T:-1},673:{T:1},674:{T:-1},675:{},676:{},677:{},678:{},679:{},680:{},681:{},1024:{},1025:{},1026:{T:1},1027:{T:-1},1028:{T:1},1029:{T:-1},1030:{},1031:{T:1},1032:{T:-1},1033:{T:1},1034:{T:-1},1035:{},1036:{},1037:{},1038:{T:1},1039:{T:-1},1040:{},1041:{T:1},1042:{T:-1},1043:{},1044:{},1045:{},1046:{T:1},1047:{T:-1},1048:{T:1},1049:{T:-1},1050:{},1051:{T:1},1052:{T:1},1053:{f:zG},1054:{T:1},1055:{},1056:{T:1},1057:{T:-1},1058:{T:1},1059:{T:-1},1061:{},1062:{T:1},1063:{T:-1},1064:{T:1},1065:{T:-1},1066:{T:1},1067:{T:-1},1068:{T:1},1069:{T:-1},1070:{T:1},1071:{T:-1},1072:{T:1},1073:{T:-1},1075:{T:1},1076:{T:-1},1077:{T:1},1078:{T:-1},1079:{T:1},1080:{T:-1},1081:{T:1},1082:{T:-1},1083:{T:1},1084:{T:-1},1085:{},1086:{T:1},1087:{T:-1},1088:{T:1},1089:{T:-1},1090:{T:1},1091:{T:-1},1092:{T:1},1093:{T:-1},1094:{T:1},1095:{T:-1},1096:{},1097:{T:1},1098:{},1099:{T:-1},1100:{T:1},1101:{T:-1},1102:{},1103:{},1104:{},1105:{},1111:{},1112:{},1113:{T:1},1114:{T:-1},1115:{T:1},1116:{T:-1},1117:{},1118:{T:1},1119:{T:-1},1120:{T:1},1121:{T:-1},1122:{T:1},1123:{T:-1},1124:{T:1},1125:{T:-1},1126:{},1128:{T:1},1129:{T:-1},1130:{},1131:{T:1},1132:{T:-1},1133:{T:1},1134:{T:-1},1135:{T:1},1136:{T:-1},1137:{T:1},1138:{T:-1},1139:{T:1},1140:{T:-1},1141:{},1142:{T:1},1143:{T:-1},1144:{T:1},1145:{T:-1},1146:{},1147:{T:1},1148:{T:-1},1149:{T:1},1150:{T:-1},1152:{T:1},1153:{T:-1},1154:{T:-1},1155:{T:-1},1156:{T:-1},1157:{T:1},1158:{T:-1},1159:{T:1},1160:{T:-1},1161:{T:1},1162:{T:-1},1163:{T:1},1164:{T:-1},1165:{T:1},1166:{T:-1},1167:{T:1},1168:{T:-1},1169:{T:1},1170:{T:-1},1171:{},1172:{T:1},1173:{T:-1},1177:{},1178:{T:1},1180:{},1181:{},1182:{},2048:{T:1},2049:{T:-1},2050:{},2051:{T:1},2052:{T:-1},2053:{},2054:{},2055:{T:1},2056:{T:-1},2057:{T:1},2058:{T:-1},2060:{},2067:{},2068:{T:1},2069:{T:-1},2070:{},2071:{},2072:{T:1},2073:{T:-1},2075:{},2076:{},2077:{T:1},2078:{T:-1},2079:{},2080:{T:1},2081:{T:-1},2082:{},2083:{T:1},2084:{T:-1},2085:{T:1},2086:{T:-1},2087:{T:1},2088:{T:-1},2089:{T:1},2090:{T:-1},2091:{},2092:{},2093:{T:1},2094:{T:-1},2095:{},2096:{T:1},2097:{T:-1},2098:{T:1},2099:{T:-1},2100:{T:1},2101:{T:-1},2102:{},2103:{T:1},2104:{T:-1},2105:{},2106:{T:1},2107:{T:-1},2108:{},2109:{T:1},2110:{T:-1},2111:{T:1},2112:{T:-1},2113:{T:1},2114:{T:-1},2115:{},2116:{},2117:{},2118:{T:1},2119:{T:-1},2120:{},2121:{T:1},2122:{T:-1},2123:{T:1},2124:{T:-1},2125:{},2126:{T:1},2127:{T:-1},2128:{},2129:{T:1},2130:{T:-1},2131:{T:1},2132:{T:-1},2133:{T:1},2134:{},2135:{},2136:{},2137:{T:1},2138:{T:-1},2139:{T:1},2140:{T:-1},2141:{},3072:{},3073:{},4096:{T:1},4097:{T:-1},5002:{T:1},5003:{T:-1},5081:{T:1},5082:{T:-1},5083:{},5084:{T:1},5085:{T:-1},5086:{T:1},5087:{T:-1},5088:{},5089:{},5090:{},5092:{T:1},5093:{T:-1},5094:{},5095:{T:1},5096:{T:-1},5097:{},5099:{},65535:{n:""}},oE={6:{f:Ub},10:{f:hu},12:{f:ra},13:{f:ra},14:{f:qi},15:{f:qi},16:{f:ja},17:{f:qi},18:{f:qi},19:{f:ra},20:{f:gP},21:{f:gP},23:{f:YF},24:{f:xP},25:{f:qi},26:{},27:{},28:{f:aV},29:{},34:{f:qi},35:{f:_P},38:{f:ja},39:{f:ja},40:{f:ja},41:{f:ja},42:{f:qi},43:{f:qi},47:{f:c$},49:{f:U9},51:{f:ra},60:{},61:{f:N9},64:{f:qi},65:{f:B9},66:{f:ra},77:{},80:{},81:{},82:{},85:{f:ra},89:{},90:{},91:{},92:{f:M9},93:{f:oV},94:{},95:{f:qi},96:{},97:{},99:{f:qi},125:{f:KF},128:{f:Y9},129:{f:I9},130:{f:ra},131:{f:qi},132:{f:qi},133:{f:P9},134:{},140:{f:dV},141:{f:ra},144:{},146:{f:mV},151:{},152:{},153:{},154:{},155:{},156:{f:ra},157:{},158:{},160:{f:vV},161:{f:_V},174:{},175:{},176:{},177:{},178:{},180:{},181:{},182:{},184:{},185:{},189:{f:W9},190:{f:q9},193:{f:hu},197:{},198:{},199:{},200:{},201:{},202:{f:qi},203:{},204:{},205:{},206:{},207:{},208:{},209:{},210:{},211:{},213:{},215:{},216:{},217:{},218:{f:ra},220:{},221:{f:qi},222:{},224:{f:X9},225:{f:k9},226:{f:hu},227:{},229:{f:sV},233:{},235:{},236:{},237:{},239:{},240:{},241:{},242:{},244:{},245:{},246:{},247:{},248:{},249:{},251:{},252:{f:R9},253:{f:V9},255:{f:D9},256:{},259:{},290:{},311:{},312:{},315:{},317:{f:GF},318:{},319:{},320:{},330:{},331:{},333:{},334:{},335:{},336:{},337:{},338:{},339:{},340:{},351:{},352:{f:qi},353:{f:hu},401:{},402:{},403:{},404:{},405:{},406:{},407:{},408:{},425:{},426:{},427:{},428:{},429:{},430:{f:J9},431:{f:qi},432:{},433:{},434:{},437:{},438:{f:uV},439:{f:qi},440:{f:hV},441:{},442:{f:Xg},443:{},444:{f:ra},445:{},446:{},448:{f:hu},449:{f:O9,r:2},450:{f:hu},512:{f:pP},513:{f:yV},515:{f:K9},516:{f:$9},517:{f:mP},519:{f:wV},520:{f:F9},523:{},545:{f:yP},549:{f:dP},566:{},574:{f:z9},638:{f:H9},659:{},1048:{},1054:{f:j9},1084:{},1212:{f:rV},2048:{f:fV},2049:{},2050:{},2051:{},2052:{},2053:{},2054:{},2055:{},2056:{},2057:{f:yy},2058:{},2059:{},2060:{},2061:{},2062:{},2063:{},2064:{},2066:{},2067:{},2128:{},2129:{},2130:{},2131:{},2132:{},2133:{},2134:{},2135:{},2136:{},2137:{},2138:{},2146:{},2147:{r:12},2148:{},2149:{},2150:{},2151:{f:hu},2152:{},2154:{},2155:{},2156:{},2161:{},2162:{},2164:{},2165:{},2166:{},2167:{},2168:{},2169:{},2170:{},2171:{},2172:{f:gV,r:12},2173:{f:W$,r:12},2174:{},2175:{},2180:{},2181:{},2182:{},2183:{},2184:{},2185:{},2186:{},2187:{},2188:{f:qi,r:12},2189:{},2190:{r:12},2191:{},2192:{},2194:{},2195:{},2196:{f:tV,r:12},2197:{},2198:{f:U$,r:12},2199:{},2200:{},2201:{},2202:{f:nV,r:12},2203:{f:hu},2204:{},2205:{},2206:{},2207:{},2211:{f:L9},2212:{},2213:{},2214:{},2215:{},4097:{},4098:{},4099:{},4102:{},4103:{},4105:{},4106:{},4107:{},4108:{},4109:{},4116:{},4117:{},4118:{},4119:{},4120:{},4121:{},4122:{},4123:{},4124:{},4125:{},4126:{},4127:{},4128:{},4129:{},4130:{},4132:{},4133:{},4134:{f:ra},4135:{},4146:{},4147:{},4148:{},4149:{},4154:{},4156:{},4157:{},4158:{},4159:{},4160:{},4161:{},4163:{},4164:{f:xV},4165:{},4166:{},4168:{},4170:{},4171:{},4174:{},4175:{},4176:{},4177:{},4187:{},4188:{f:pV},4189:{},4191:{},4192:{},4193:{},4194:{},4195:{},4196:{},4197:{},4198:{},4199:{},4200:{},0:{f:pP},1:{},2:{f:SV},3:{f:EV},4:{f:TV},5:{f:mP},7:{f:AV},8:{},9:{f:yy},11:{},22:{f:ra},30:{f:G9},31:{},32:{},33:{f:yP},36:{},37:{f:dP},50:{f:CV},62:{},52:{},67:{},68:{f:ra},69:{},86:{},126:{},127:{f:bV},135:{},136:{},137:{},145:{},148:{},149:{},150:{},169:{},171:{},188:{},191:{},192:{},194:{},195:{},214:{f:kV},223:{},234:{},354:{},421:{},518:{f:Ub},521:{f:yy},536:{f:xP},547:{f:_P},561:{},579:{},1030:{f:Ub},1033:{f:yy},1091:{},2157:{},2163:{},2177:{},2240:{},2241:{},2242:{},2243:{},2244:{},2245:{},2246:{},2247:{},2248:{},2249:{},2250:{},2251:{},2262:{r:12},29282:{}};function Bo(e,n,a,u){var f=n;if(!isNaN(f)){var _=u||(a||[]).length||0,w=e.next(4);w.write_shift(2,f),w.write_shift(2,_),_>0&&PF(a)&&e.push(a)}}function IP(e,n){var a=n||{},u=a.dense?[]:{};e=e.replace(/<!--.*?-->/g,"");var f=e.match(/<table/i);if(!f)throw new Error("Invalid HTML: could not find <table>");var _=e.match(/<\/table/i),w=f.index,T=_&&_.index||e.length,o=JU(e.slice(w,T),/(:?<tr[^>]*>)/i,"<tr>"),k=-1,R=0,F=0,B=0,V={s:{r:1e7,c:1e7},e:{r:0,c:0}},G=[];for(w=0;w<o.length;++w){var U=o[w].trim(),J=U.slice(0,3).toLowerCase();if(J=="<tr"){if(++k,a.sheetRows&&a.sheetRows<=k){--k;break}R=0;continue}if(!(J!="<td"&&J!="<th")){var X=U.split(/<\/t[dh]>/i);for(T=0;T<X.length;++T){var Y=X[T].trim();if(Y.match(/<t[dh]/i)){for(var Z=Y,_e=0;Z.charAt(0)=="<"&&(_e=Z.indexOf(">"))>-1;)Z=Z.slice(_e+1);for(var ke=0;ke<G.length;++ke){var Ae=G[ke];Ae.s.c==R&&Ae.s.r<k&&k<=Ae.e.r&&(R=Ae.e.c+1,ke=-1)}var me=on(Y.slice(0,Y.indexOf(">")));B=me.colspan?+me.colspan:1,((F=+me.rowspan)>1||B>1)&&G.push({s:{r:k,c:R},e:{r:k+(F||1)-1,c:R+B-1}});var De=me.t||me["data-t"]||"";if(!Z.length){R+=B;continue}if(Z=xF(Z),V.s.r>k&&(V.s.r=k),V.e.r<k&&(V.e.r=k),V.s.c>R&&(V.s.c=R),V.e.c<R&&(V.e.c=R),!Z.length){R+=B;continue}var we={t:"s",v:Z};a.raw||!Z.trim().length||De=="s"||(Z==="TRUE"?we={t:"b",v:!0}:Z==="FALSE"?we={t:"b",v:!1}:isNaN(Yo(Z))?isNaN(op(Z).getDate())||(we={t:"d",v:_a(Z)},a.cellDates||(we={t:"n",v:as(we.v)}),we.z=a.dateNF||Tn[14]):we={t:"n",v:Yo(Z)}),a.dense?(u[k]||(u[k]=[]),u[k][R]=we):u[yn({r:k,c:R})]=we,R+=B}}}}return u["!ref"]=jn(V),G.length&&(u["!merges"]=G),u}function CH(e,n,a,u){for(var f=e["!merges"]||[],_=[],w=n.s.c;w<=n.e.c;++w){for(var T=0,o=0,k=0;k<f.length;++k)if(!(f[k].s.r>a||f[k].s.c>w)&&!(f[k].e.r<a||f[k].e.c<w)){if(f[k].s.r<a||f[k].s.c<w){T=-1;break}T=f[k].e.r-f[k].s.r+1,o=f[k].e.c-f[k].s.c+1;break}if(!(T<0)){var R=yn({r:a,c:w}),F=u.dense?(e[a]||[])[w]:e[R],B=F&&F.v!=null&&(F.h||FS(F.w||(vc(F),F.w)||""))||"",V={};T>1&&(V.rowspan=T),o>1&&(V.colspan=o),u.editable?B='<span contenteditable="true">'+B+"</span>":F&&(V["data-t"]=F&&F.t||"z",F.v!=null&&(V["data-v"]=F.v),F.z!=null&&(V["data-z"]=F.z),F.l&&(F.l.Target||"#").charAt(0)!="#"&&(B='<a href="'+F.l.Target+'">'+B+"</a>")),V.id=(u.id||"sjs")+"-"+R,_.push(d7("td",B,V))}}var G="<tr>";return G+_.join("")+"</tr>"}var kH='<html><head><meta charset="utf-8"/><title>SheetJS Table Export</title></head><body>',MH="</body></html>";function IH(e,n){var a=e.match(/<table[\s\S]*?>[\s\S]*?<\/table>/gi);if(!a||a.length==0)throw new Error("Invalid HTML: could not find <table>");if(a.length==1)return Hu(IP(a[0],n),n);var u=JS();return a.forEach(function(f,_){QS(u,IP(f,n),"Sheet"+(_+1))}),u}function PH(e,n,a){var u=[];return u.join("")+"<table"+(a&&a.id?' id="'+a.id+'"':"")+">"}function RH(e,n){var a=n||{},u=a.header!=null?a.header:kH,f=a.footer!=null?a.footer:MH,_=[u],w=_p(e["!ref"]);a.dense=Array.isArray(e),_.push(PH(e,w,a));for(var T=w.s.r;T<=w.e.r;++T)_.push(CH(e,w,T,a));return _.push("</table>"+f),_.join("")}function TL(e,n,a){var u=a||{},f=0,_=0;if(u.origin!=null)if(typeof u.origin=="number")f=u.origin;else{var w=typeof u.origin=="string"?rs(u.origin):u.origin;f=w.r,_=w.c}var T=n.getElementsByTagName("tr"),o=Math.min(u.sheetRows||1e7,T.length),k={s:{r:0,c:0},e:{r:f,c:_}};if(e["!ref"]){var R=_p(e["!ref"]);k.s.r=Math.min(k.s.r,R.s.r),k.s.c=Math.min(k.s.c,R.s.c),k.e.r=Math.max(k.e.r,R.e.r),k.e.c=Math.max(k.e.c,R.e.c),f==-1&&(k.e.r=f=R.e.r+1)}var F=[],B=0,V=e["!rows"]||(e["!rows"]=[]),G=0,U=0,J=0,X=0,Y=0,Z=0;for(e["!cols"]||(e["!cols"]=[]);G<T.length&&U<o;++G){var _e=T[G];if(PP(_e)){if(u.display)continue;V[U]={hidden:!0}}var ke=_e.children;for(J=X=0;J<ke.length;++J){var Ae=ke[J];if(!(u.display&&PP(Ae))){var me=Ae.hasAttribute("data-v")?Ae.getAttribute("data-v"):Ae.hasAttribute("v")?Ae.getAttribute("v"):xF(Ae.innerHTML),De=Ae.getAttribute("data-z")||Ae.getAttribute("z");for(B=0;B<F.length;++B){var we=F[B];we.s.c==X+_&&we.s.r<U+f&&U+f<=we.e.r&&(X=we.e.c+1-_,B=-1)}Z=+Ae.getAttribute("colspan")||1,((Y=+Ae.getAttribute("rowspan")||1)>1||Z>1)&&F.push({s:{r:U+f,c:X+_},e:{r:U+f+(Y||1)-1,c:X+_+(Z||1)-1}});var Je={t:"s",v:me},rt=Ae.getAttribute("data-t")||Ae.getAttribute("t")||"";me!=null&&(me.length==0?Je.t=rt||"z":u.raw||me.trim().length==0||rt=="s"||(me==="TRUE"?Je={t:"b",v:!0}:me==="FALSE"?Je={t:"b",v:!1}:isNaN(Yo(me))?isNaN(op(me).getDate())||(Je={t:"d",v:_a(me)},u.cellDates||(Je={t:"n",v:as(Je.v)}),Je.z=u.dateNF||Tn[14]):Je={t:"n",v:Yo(me)})),Je.z===void 0&&De!=null&&(Je.z=De);var Re="",St=Ae.getElementsByTagName("A");if(St&&St.length)for(var Lt=0;Lt<St.length&&!(St[Lt].hasAttribute("href")&&(Re=St[Lt].getAttribute("href"),Re.charAt(0)!="#"));++Lt);Re&&Re.charAt(0)!="#"&&(Je.l={Target:Re}),u.dense?(e[U+f]||(e[U+f]=[]),e[U+f][X+_]=Je):e[yn({c:X+_,r:U+f})]=Je,k.e.c<X+_&&(k.e.c=X+_),X+=Z}}++U}return F.length&&(e["!merges"]=(e["!merges"]||[]).concat(F)),k.e.r=Math.max(k.e.r,U-1+f),e["!ref"]=jn(k),U>=o&&(e["!fullref"]=jn((k.e.r=T.length-G+U-1+f,k))),e}function EL(e,n){var a=n||{},u=a.dense?[]:{};return TL(u,e,n)}function DH(e,n){return Hu(EL(e,n),n)}function PP(e){var n="",a=FH(e);return a&&(n=a(e).getPropertyValue("display")),n||(n=e.style&&e.style.display),n==="none"}function FH(e){return e.ownerDocument.defaultView&&typeof e.ownerDocument.defaultView.getComputedStyle=="function"?e.ownerDocument.defaultView.getComputedStyle:typeof getComputedStyle=="function"?getComputedStyle:null}function LH(e){var n=e.replace(/[\t\r\n]/g," ").trim().replace(/ +/g," ").replace(/<text:s\/>/g," ").replace(/<text:s text:c="(\d+)"\/>/g,function(u,f){return Array(parseInt(f,10)+1).join(" ")}).replace(/<text:tab[^>]*\/>/g,"	").replace(/<text:line-break\/>/g,`
`),a=Zn(n.replace(/<[^>]*>/g,""));return[a]}var RP={day:["d","dd"],month:["m","mm"],year:["y","yy"],hours:["h","hh"],minutes:["m","mm"],seconds:["s","ss"],"am-pm":["A/P","AM/PM"],"day-of-week":["ddd","dddd"],era:["e","ee"],quarter:["\\Qm",'m\\"th quarter"']};function SL(e,n){var a=n||{},u=LS(e),f=[],_,w,T={name:""},o="",k=0,R,F,B={},V=[],G=a.dense?[]:{},U,J,X={value:""},Y="",Z=0,_e=[],ke=-1,Ae=-1,me={s:{r:1e6,c:1e7},e:{r:0,c:0}},De=0,we={},Je=[],rt={},Re=0,St=0,Lt=[],We=1,qt=1,Ot=[],st={Names:[]},Ve={},Et=["",""],Dt=[],Se={},at="",He=0,Xe=!1,yt=!1,Jt=0;for(Ig.lastIndex=0,u=u.replace(/<!--([\s\S]*?)-->/mg,"").replace(/<!DOCTYPE[^\[]*\[[^\]]*\]>/gm,"");U=Ig.exec(u);)switch(U[3]=U[3].replace(/_.*$/,"")){case"table":case"工作表":U[1]==="/"?(me.e.c>=me.s.c&&me.e.r>=me.s.r?G["!ref"]=jn(me):G["!ref"]="A1:A1",a.sheetRows>0&&a.sheetRows<=me.e.r&&(G["!fullref"]=G["!ref"],me.e.r=a.sheetRows-1,G["!ref"]=jn(me)),Je.length&&(G["!merges"]=Je),Lt.length&&(G["!rows"]=Lt),R.name=R.名称||R.name,typeof JSON<"u"&&JSON.stringify(R),V.push(R.name),B[R.name]=G,yt=!1):U[0].charAt(U[0].length-2)!=="/"&&(R=on(U[0],!1),ke=Ae=-1,me.s.r=me.s.c=1e7,me.e.r=me.e.c=0,G=a.dense?[]:{},Je=[],Lt=[],yt=!0);break;case"table-row-group":U[1]==="/"?--De:++De;break;case"table-row":case"行":if(U[1]==="/"){ke+=We,We=1;break}if(F=on(U[0],!1),F.行号?ke=F.行号-1:ke==-1&&(ke=0),We=+F["number-rows-repeated"]||1,We<10)for(Jt=0;Jt<We;++Jt)De>0&&(Lt[ke+Jt]={level:De});Ae=-1;break;case"covered-table-cell":U[1]!=="/"&&++Ae,a.sheetStubs&&(a.dense?(G[ke]||(G[ke]=[]),G[ke][Ae]={t:"z"}):G[yn({r:ke,c:Ae})]={t:"z"}),Y="",_e=[];break;case"table-cell":case"数据":if(U[0].charAt(U[0].length-2)==="/")++Ae,X=on(U[0],!1),qt=parseInt(X["number-columns-repeated"]||"1",10),J={t:"z",v:null},X.formula&&a.cellFormula!=!1&&(J.f=AP(Zn(X.formula))),(X.数据类型||X["value-type"])=="string"&&(J.t="s",J.v=Zn(X["string-value"]||""),a.dense?(G[ke]||(G[ke]=[]),G[ke][Ae]=J):G[yn({r:ke,c:Ae})]=J),Ae+=qt-1;else if(U[1]!=="/"){++Ae,Y="",Z=0,_e=[],qt=1;var sr=We?ke+We-1:ke;if(Ae>me.e.c&&(me.e.c=Ae),Ae<me.s.c&&(me.s.c=Ae),ke<me.s.r&&(me.s.r=ke),sr>me.e.r&&(me.e.r=sr),X=on(U[0],!1),Dt=[],Se={},J={t:X.数据类型||X["value-type"],v:null},a.cellFormula)if(X.formula&&(X.formula=Zn(X.formula)),X["number-matrix-columns-spanned"]&&X["number-matrix-rows-spanned"]&&(Re=parseInt(X["number-matrix-rows-spanned"],10)||0,St=parseInt(X["number-matrix-columns-spanned"],10)||0,rt={s:{r:ke,c:Ae},e:{r:ke+Re-1,c:Ae+St-1}},J.F=jn(rt),Ot.push([rt,J.F])),X.formula)J.f=AP(X.formula);else for(Jt=0;Jt<Ot.length;++Jt)ke>=Ot[Jt][0].s.r&&ke<=Ot[Jt][0].e.r&&Ae>=Ot[Jt][0].s.c&&Ae<=Ot[Jt][0].e.c&&(J.F=Ot[Jt][1]);switch((X["number-columns-spanned"]||X["number-rows-spanned"])&&(Re=parseInt(X["number-rows-spanned"],10)||0,St=parseInt(X["number-columns-spanned"],10)||0,rt={s:{r:ke,c:Ae},e:{r:ke+Re-1,c:Ae+St-1}},Je.push(rt)),X["number-columns-repeated"]&&(qt=parseInt(X["number-columns-repeated"],10)),J.t){case"boolean":J.t="b",J.v=Ci(X["boolean-value"]);break;case"float":J.t="n",J.v=parseFloat(X.value);break;case"percentage":J.t="n",J.v=parseFloat(X.value);break;case"currency":J.t="n",J.v=parseFloat(X.value);break;case"date":J.t="d",J.v=_a(X["date-value"]),a.cellDates||(J.t="n",J.v=as(J.v)),J.z="m/d/yy";break;case"time":J.t="n",J.v=XU(X["time-value"])/86400,a.cellDates&&(J.t="d",J.v=iv(J.v)),J.z="HH:MM:SS";break;case"number":J.t="n",J.v=parseFloat(X.数据数值);break;default:if(J.t==="string"||J.t==="text"||!J.t)J.t="s",X["string-value"]!=null&&(Y=Zn(X["string-value"]),_e=[]);else throw new Error("Unsupported value type "+J.t)}}else{if(Xe=!1,J.t==="s"&&(J.v=Y||"",_e.length&&(J.R=_e),Xe=Z==0),Ve.Target&&(J.l=Ve),Dt.length>0&&(J.c=Dt,Dt=[]),Y&&a.cellText!==!1&&(J.w=Y),Xe&&(J.t="z",delete J.v),(!Xe||a.sheetStubs)&&!(a.sheetRows&&a.sheetRows<=ke))for(var Xt=0;Xt<We;++Xt){if(qt=parseInt(X["number-columns-repeated"]||"1",10),a.dense)for(G[ke+Xt]||(G[ke+Xt]=[]),G[ke+Xt][Ae]=Xt==0?J:Aa(J);--qt>0;)G[ke+Xt][Ae+qt]=Aa(J);else for(G[yn({r:ke+Xt,c:Ae})]=J;--qt>0;)G[yn({r:ke+Xt,c:Ae+qt})]=Aa(J);me.e.c<=Ae&&(me.e.c=Ae)}qt=parseInt(X["number-columns-repeated"]||"1",10),Ae+=qt-1,qt=0,J={},Y="",_e=[]}Ve={};break;case"document":case"document-content":case"电子表格文档":case"spreadsheet":case"主体":case"scripts":case"styles":case"font-face-decls":case"master-styles":if(U[1]==="/"){if((_=f.pop())[0]!==U[3])throw"Bad state: "+_}else U[0].charAt(U[0].length-2)!=="/"&&f.push([U[3],!0]);break;case"annotation":if(U[1]==="/"){if((_=f.pop())[0]!==U[3])throw"Bad state: "+_;Se.t=Y,_e.length&&(Se.R=_e),Se.a=at,Dt.push(Se)}else U[0].charAt(U[0].length-2)!=="/"&&f.push([U[3],!1]);at="",He=0,Y="",Z=0,_e=[];break;case"creator":U[1]==="/"?at=u.slice(He,U.index):He=U.index+U[0].length;break;case"meta":case"元数据":case"settings":case"config-item-set":case"config-item-map-indexed":case"config-item-map-entry":case"config-item-map-named":case"shapes":case"frame":case"text-box":case"image":case"data-pilot-tables":case"list-style":case"form":case"dde-links":case"event-listeners":case"chart":if(U[1]==="/"){if((_=f.pop())[0]!==U[3])throw"Bad state: "+_}else U[0].charAt(U[0].length-2)!=="/"&&f.push([U[3],!1]);Y="",Z=0,_e=[];break;case"scientific-number":break;case"currency-symbol":break;case"currency-style":break;case"number-style":case"percentage-style":case"date-style":case"time-style":if(U[1]==="/"){if(we[T.name]=o,(_=f.pop())[0]!==U[3])throw"Bad state: "+_}else U[0].charAt(U[0].length-2)!=="/"&&(o="",T=on(U[0],!1),f.push([U[3],!0]));break;case"script":break;case"libraries":break;case"automatic-styles":break;case"default-style":case"page-layout":break;case"style":break;case"map":break;case"font-face":break;case"paragraph-properties":break;case"table-properties":break;case"table-column-properties":break;case"table-row-properties":break;case"table-cell-properties":break;case"number":switch(f[f.length-1][0]){case"time-style":case"date-style":w=on(U[0],!1),o+=RP[U[3]][w.style==="long"?1:0];break}break;case"fraction":break;case"day":case"month":case"year":case"era":case"day-of-week":case"week-of-year":case"quarter":case"hours":case"minutes":case"seconds":case"am-pm":switch(f[f.length-1][0]){case"time-style":case"date-style":w=on(U[0],!1),o+=RP[U[3]][w.style==="long"?1:0];break}break;case"boolean-style":break;case"boolean":break;case"text-style":break;case"text":if(U[0].slice(-2)==="/>")break;if(U[1]==="/")switch(f[f.length-1][0]){case"number-style":case"date-style":case"time-style":o+=u.slice(k,U.index);break}else k=U.index+U[0].length;break;case"named-range":w=on(U[0],!1),Et=Vb(w["cell-range-address"]);var zt={Name:w.name,Ref:Et[0]+"!"+Et[1]};yt&&(zt.Sheet=V.length),st.Names.push(zt);break;case"text-content":break;case"text-properties":break;case"embedded-text":break;case"body":case"电子表格":break;case"forms":break;case"table-column":break;case"table-header-rows":break;case"table-rows":break;case"table-column-group":break;case"table-header-columns":break;case"table-columns":break;case"null-date":break;case"graphic-properties":break;case"calculation-settings":break;case"named-expressions":break;case"label-range":break;case"label-ranges":break;case"named-expression":break;case"sort":break;case"sort-by":break;case"sort-groups":break;case"tab":break;case"line-break":break;case"span":break;case"p":case"文本串":if(["master-styles"].indexOf(f[f.length-1][0])>-1)break;if(U[1]==="/"&&(!X||!X["string-value"])){var Or=LH(u.slice(Z,U.index));Y=(Y.length>0?Y+`
`:"")+Or[0]}else on(U[0],!1),Z=U.index+U[0].length;break;case"s":break;case"database-range":if(U[1]==="/")break;try{Et=Vb(on(U[0])["target-range-address"]),B[Et[0]]["!autofilter"]={ref:Et[1]}}catch{}break;case"date":break;case"object":break;case"title":case"标题":break;case"desc":break;case"binary-data":break;case"table-source":break;case"scenario":break;case"iteration":break;case"content-validations":break;case"content-validation":break;case"help-message":break;case"error-message":break;case"database-ranges":break;case"filter":break;case"filter-and":break;case"filter-or":break;case"filter-condition":break;case"list-level-style-bullet":break;case"list-level-style-number":break;case"list-level-properties":break;case"sender-firstname":case"sender-lastname":case"sender-initials":case"sender-title":case"sender-position":case"sender-email":case"sender-phone-private":case"sender-fax":case"sender-company":case"sender-phone-work":case"sender-street":case"sender-city":case"sender-postal-code":case"sender-country":case"sender-state-or-province":case"author-name":case"author-initials":case"chapter":case"file-name":case"template-name":case"sheet-name":break;case"event-listener":break;case"initial-creator":case"creation-date":case"print-date":case"generator":case"document-statistic":case"user-defined":case"editing-duration":case"editing-cycles":break;case"config-item":break;case"page-number":break;case"page-count":break;case"time":break;case"cell-range-source":break;case"detective":break;case"operation":break;case"highlighted-range":break;case"data-pilot-table":case"source-cell-range":case"source-service":case"data-pilot-field":case"data-pilot-level":case"data-pilot-subtotals":case"data-pilot-subtotal":case"data-pilot-members":case"data-pilot-member":case"data-pilot-display-info":case"data-pilot-sort-info":case"data-pilot-layout-info":case"data-pilot-field-reference":case"data-pilot-groups":case"data-pilot-group":case"data-pilot-group-member":break;case"rect":break;case"dde-connection-decls":case"dde-connection-decl":case"dde-link":case"dde-source":break;case"properties":break;case"property":break;case"a":if(U[1]!=="/"){if(Ve=on(U[0],!1),!Ve.href)break;Ve.Target=Zn(Ve.href),delete Ve.href,Ve.Target.charAt(0)=="#"&&Ve.Target.indexOf(".")>-1?(Et=Vb(Ve.Target.slice(1)),Ve.Target="#"+Et[0]+"!"+Et[1]):Ve.Target.match(/^\.\.[\\\/]/)&&(Ve.Target=Ve.Target.slice(3))}break;case"table-protection":break;case"data-pilot-grand-total":break;case"office-document-common-attrs":break;default:switch(U[2]){case"dc:":case"calcext:":case"loext:":case"ooo:":case"chartooo:":case"draw:":case"style:":case"chart:":case"form:":case"uof:":case"表:":case"字:":break;default:if(a.WTF)throw new Error(U)}}var Be={Sheets:B,SheetNames:V,Workbook:st};return a.bookSheets&&delete Be.Sheets,Be}function DP(e,n){n=n||{},io(e,"META-INF/manifest.xml")&&K7(ta(e,"META-INF/manifest.xml"),n);var a=Vs(e,"content.xml");if(!a)throw new Error("Missing content.xml in ODS / UOF file");var u=SL(gi(a),n);return io(e,"meta.xml")&&(u.Props=zF(ta(e,"meta.xml"))),u}function FP(e,n){return SL(e,n)}/*! sheetjs (C) 2013-present SheetJS -- http://sheetjs.com */function ZS(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function lE(e){return typeof TextDecoder<"u"?new TextDecoder().decode(e):gi(df(e))}function cE(e){var n=e.reduce(function(f,_){return f+_.length},0),a=new Uint8Array(n),u=0;return e.forEach(function(f){a.set(f,u),u+=f.length}),a}function LP(e){return e-=e>>1&1431655765,e=(e&858993459)+(e>>2&858993459),(e+(e>>4)&252645135)*16843009>>>24}function OH(e,n){for(var a=(e[n+15]&127)<<7|e[n+14]>>1,u=e[n+14]&1,f=n+13;f>=n;--f)u=u*256+e[f];return(e[n+15]&128?-u:u)*Math.pow(10,a-6176)}function Fg(e,n){var a=n?n[0]:0,u=e[a]&127;e:if(e[a++]>=128&&(u|=(e[a]&127)<<7,e[a++]<128||(u|=(e[a]&127)<<14,e[a++]<128)||(u|=(e[a]&127)<<21,e[a++]<128)||(u+=(e[a]&127)*Math.pow(2,28),++a,e[a++]<128)||(u+=(e[a]&127)*Math.pow(2,35),++a,e[a++]<128)||(u+=(e[a]&127)*Math.pow(2,42),++a,e[a++]<128)))break e;return n&&(n[0]=a),u}function ua(e){var n=0,a=e[n]&127;e:if(e[n++]>=128){if(a|=(e[n]&127)<<7,e[n++]<128||(a|=(e[n]&127)<<14,e[n++]<128)||(a|=(e[n]&127)<<21,e[n++]<128))break e;a|=(e[n]&127)<<28}return a}function Ga(e){for(var n=[],a=[0];a[0]<e.length;){var u=a[0],f=Fg(e,a),_=f&7;f=Math.floor(f/8);var w=0,T;if(f==0)break;switch(_){case 0:{for(var o=a[0];e[a[0]++]>=128;);T=e.slice(o,a[0])}break;case 5:w=4,T=e.slice(a[0],a[0]+w),a[0]+=w;break;case 1:w=8,T=e.slice(a[0],a[0]+w),a[0]+=w;break;case 2:w=Fg(e,a),T=e.slice(a[0],a[0]+w),a[0]+=w;break;case 3:case 4:default:throw new Error("PB Type ".concat(_," for Field ").concat(f," at offset ").concat(u))}var k={data:T,type:_};n[f]==null?n[f]=[k]:n[f].push(k)}return n}function XS(e,n){return(e==null?void 0:e.map(function(a){return n(a.data)}))||[]}function NH(e){for(var n,a=[],u=[0];u[0]<e.length;){var f=Fg(e,u),_=Ga(e.slice(u[0],u[0]+f));u[0]+=f;var w={id:ua(_[1][0].data),messages:[]};_[2].forEach(function(T){var o=Ga(T.data),k=ua(o[3][0].data);w.messages.push({meta:o,data:e.slice(u[0],u[0]+k)}),u[0]+=k}),(n=_[3])!=null&&n[0]&&(w.merge=ua(_[3][0].data)>>>0>0),a.push(w)}return a}function zH(e,n){if(e!=0)throw new Error("Unexpected Snappy chunk type ".concat(e));for(var a=[0],u=Fg(n,a),f=[];a[0]<n.length;){var _=n[a[0]]&3;if(_==0){var w=n[a[0]++]>>2;if(w<60)++w;else{var T=w-59;w=n[a[0]],T>1&&(w|=n[a[0]+1]<<8),T>2&&(w|=n[a[0]+2]<<16),T>3&&(w|=n[a[0]+3]<<24),w>>>=0,w++,a[0]+=T}f.push(n.slice(a[0],a[0]+w)),a[0]+=w;continue}else{var o=0,k=0;if(_==1?(k=(n[a[0]]>>2&7)+4,o=(n[a[0]++]&224)<<3,o|=n[a[0]++]):(k=(n[a[0]++]>>2)+1,_==2?(o=n[a[0]]|n[a[0]+1]<<8,a[0]+=2):(o=(n[a[0]]|n[a[0]+1]<<8|n[a[0]+2]<<16|n[a[0]+3]<<24)>>>0,a[0]+=4)),f=[cE(f)],o==0)throw new Error("Invalid offset 0");if(o>f[0].length)throw new Error("Invalid offset beyond length");if(k>=o)for(f.push(f[0].slice(-o)),k-=o;k>=f[f.length-1].length;)f.push(f[f.length-1]),k-=f[f.length-1].length;f.push(f[0].slice(-o,-o+k))}}var R=cE(f);if(R.length!=u)throw new Error("Unexpected length: ".concat(R.length," != ").concat(u));return R}function BH(e){for(var n=[],a=0;a<e.length;){var u=e[a++],f=e[a]|e[a+1]<<8|e[a+2]<<16;a+=3,n.push(zH(u,e.slice(a,a+f))),a+=f}if(a!==e.length)throw new Error("data is not a valid framed stream!");return cE(n)}function UH(e,n,a,u){var f=ZS(e),_=f.getUint32(4,!0),w=(u>1?12:8)+LP(_&(u>1?3470:398))*4,T=-1,o=-1,k=NaN,R=new Date(2001,0,1);_&512&&(T=f.getUint32(w,!0),w+=4),w+=LP(_&(u>1?12288:4096))*4,_&16&&(o=f.getUint32(w,!0),w+=4),_&32&&(k=f.getFloat64(w,!0),w+=8),_&64&&(R.setTime(R.getTime()+f.getFloat64(w,!0)*1e3),w+=8);var F;switch(e[2]){case 0:break;case 2:F={t:"n",v:k};break;case 3:F={t:"s",v:n[o]};break;case 5:F={t:"d",v:R};break;case 6:F={t:"b",v:k>0};break;case 7:F={t:"n",v:k/86400};break;case 8:F={t:"e",v:0};break;case 9:if(T>-1)F={t:"s",v:a[T]};else if(o>-1)F={t:"s",v:n[o]};else if(!isNaN(k))F={t:"n",v:k};else throw new Error("Unsupported cell type ".concat(e.slice(0,4)));break;default:throw new Error("Unsupported cell type ".concat(e.slice(0,4)))}return F}function VH(e,n,a){var u=ZS(e),f=u.getUint32(8,!0),_=12,w=-1,T=-1,o=NaN,k=NaN,R=new Date(2001,0,1);f&1&&(o=OH(e,_),_+=16),f&2&&(k=u.getFloat64(_,!0),_+=8),f&4&&(R.setTime(R.getTime()+u.getFloat64(_,!0)*1e3),_+=8),f&8&&(T=u.getUint32(_,!0),_+=4),f&16&&(w=u.getUint32(_,!0),_+=4);var F;switch(e[1]){case 0:break;case 2:F={t:"n",v:o};break;case 3:F={t:"s",v:n[T]};break;case 5:F={t:"d",v:R};break;case 6:F={t:"b",v:k>0};break;case 7:F={t:"n",v:k/86400};break;case 8:F={t:"e",v:0};break;case 9:if(w>-1)F={t:"s",v:a[w]};else throw new Error("Unsupported cell type ".concat(e[1]," : ").concat(f&31," : ").concat(e.slice(0,4)));break;case 10:F={t:"n",v:o};break;default:throw new Error("Unsupported cell type ".concat(e[1]," : ").concat(f&31," : ").concat(e.slice(0,4)))}return F}function $H(e,n,a){switch(e[0]){case 0:case 1:case 2:case 3:return UH(e,n,a,e[0]);case 5:return VH(e,n,a);default:throw new Error("Unsupported payload version ".concat(e[0]))}}function Fu(e){var n=Ga(e);return Fg(n[1][0].data)}function OP(e,n){var a=Ga(n.data),u=ua(a[1][0].data),f=a[3],_=[];return(f||[]).forEach(function(w){var T=Ga(w.data),o=ua(T[1][0].data)>>>0;switch(u){case 1:_[o]=lE(T[3][0].data);break;case 8:{var k=e[Fu(T[9][0].data)][0],R=Ga(k.data),F=e[Fu(R[1][0].data)][0],B=ua(F.meta[1][0].data);if(B!=2001)throw new Error("2000 unexpected reference to ".concat(B));var V=Ga(F.data);_[o]=V[3].map(function(G){return lE(G.data)}).join("")}break}}),_}function jH(e,n){var a,u,f,_,w,T,o,k,R,F,B,V,G,U,J=Ga(e),X=ua(J[1][0].data)>>>0,Y=ua(J[2][0].data)>>>0,Z=((u=(a=J[8])==null?void 0:a[0])==null?void 0:u.data)&&ua(J[8][0].data)>0||!1,_e,ke;if((_=(f=J[7])==null?void 0:f[0])!=null&&_.data&&n!=0)_e=(T=(w=J[7])==null?void 0:w[0])==null?void 0:T.data,ke=(k=(o=J[6])==null?void 0:o[0])==null?void 0:k.data;else if((F=(R=J[4])==null?void 0:R[0])!=null&&F.data&&n!=1)_e=(V=(B=J[4])==null?void 0:B[0])==null?void 0:V.data,ke=(U=(G=J[3])==null?void 0:G[0])==null?void 0:U.data;else throw"NUMBERS Tile missing ".concat(n," cell storage");for(var Ae=Z?4:1,me=ZS(_e),De=[],we=0;we<_e.length/2;++we){var Je=me.getUint16(we*2,!0);Je<65535&&De.push([we,Je])}if(De.length!=Y)throw"Expected ".concat(Y," cells, found ").concat(De.length);var rt=[];for(we=0;we<De.length-1;++we)rt[De[we][0]]=ke.subarray(De[we][1]*Ae,De[we+1][1]*Ae);return De.length>=1&&(rt[De[De.length-1][0]]=ke.subarray(De[De.length-1][1]*Ae)),{R:X,cells:rt}}function GH(e,n){var a,u=Ga(n.data),f=(a=u==null?void 0:u[7])!=null&&a[0]?ua(u[7][0].data)>>>0>0?1:0:-1,_=XS(u[5],function(w){return jH(w,f)});return{nrows:ua(u[4][0].data)>>>0,data:_.reduce(function(w,T){return w[T.R]||(w[T.R]=[]),T.cells.forEach(function(o,k){if(w[T.R][k])throw new Error("Duplicate cell r=".concat(T.R," c=").concat(k));w[T.R][k]=o}),w},[])}}function HH(e,n,a){var u,f=Ga(n.data),_={s:{r:0,c:0},e:{r:0,c:0}};if(_.e.r=(ua(f[6][0].data)>>>0)-1,_.e.r<0)throw new Error("Invalid row varint ".concat(f[6][0].data));if(_.e.c=(ua(f[7][0].data)>>>0)-1,_.e.c<0)throw new Error("Invalid col varint ".concat(f[7][0].data));a["!ref"]=jn(_);var w=Ga(f[4][0].data),T=OP(e,e[Fu(w[4][0].data)][0]),o=(u=w[17])!=null&&u[0]?OP(e,e[Fu(w[17][0].data)][0]):[],k=Ga(w[3][0].data),R=0;k[1].forEach(function(F){var B=Ga(F.data),V=e[Fu(B[2][0].data)][0],G=ua(V.meta[1][0].data);if(G!=6002)throw new Error("6001 unexpected reference to ".concat(G));var U=GH(e,V);U.data.forEach(function(J,X){J.forEach(function(Y,Z){var _e=yn({r:R+X,c:Z}),ke=$H(Y,T,o);ke&&(a[_e]=ke)})}),R+=U.nrows})}function WH(e,n){var a=Ga(n.data),u={"!ref":"A1"},f=e[Fu(a[2][0].data)],_=ua(f[0].meta[1][0].data);if(_!=6001)throw new Error("6000 unexpected reference to ".concat(_));return HH(e,f[0],u),u}function qH(e,n){var a,u=Ga(n.data),f={name:(a=u[1])!=null&&a[0]?lE(u[1][0].data):"",sheets:[]},_=XS(u[2],Fu);return _.forEach(function(w){e[w].forEach(function(T){var o=ua(T.meta[1][0].data);o==6e3&&f.sheets.push(WH(e,T))})}),f}function ZH(e,n){var a=JS(),u=Ga(n.data),f=XS(u[1],Fu);if(f.forEach(function(_){e[_].forEach(function(w){var T=ua(w.meta[1][0].data);if(T==2){var o=qH(e,w);o.sheets.forEach(function(k,R){QS(a,k,R==0?o.name:o.name+"_"+R,!0)})}})}),a.SheetNames.length==0)throw new Error("Empty NUMBERS file");return a}function jb(e){var n,a,u,f,_={},w=[];if(e.FullPaths.forEach(function(o){if(o.match(/\.iwpv2/))throw new Error("Unsupported password protection")}),e.FileIndex.forEach(function(o){if(o.name.match(/\.iwa$/)){var k;try{k=BH(o.content)}catch(F){return console.log("?? "+o.content.length+" "+(F.message||F))}var R;try{R=NH(k)}catch(F){return console.log("## "+(F.message||F))}R.forEach(function(F){_[F.id]=F.messages,w.push(F.id)})}}),!w.length)throw new Error("File has no messages");var T=((f=(u=(a=(n=_==null?void 0:_[1])==null?void 0:n[0])==null?void 0:a.meta)==null?void 0:u[1])==null?void 0:f[0].data)&&ua(_[1][0].meta[1][0].data)==1&&_[1][0];if(T||w.forEach(function(o){_[o].forEach(function(k){var R=ua(k.meta[1][0].data)>>>0;if(R==1)if(!T)T=k;else throw new Error("Document has multiple roots")})}),!T)throw new Error("Cannot find Document root");return ZH(_,T)}function XH(e){return function(a){for(var u=0;u!=e.length;++u){var f=e[u];a[f[0]]===void 0&&(a[f[0]]=f[1]),f[2]==="n"&&(a[f[0]]=Number(a[f[0]]))}}}function YS(e){XH([["cellNF",!1],["cellHTML",!0],["cellFormula",!0],["cellStyles",!1],["cellText",!0],["cellDates",!1],["sheetStubs",!1],["sheetRows",0,"n"],["bookDeps",!1],["bookSheets",!1],["bookProps",!1],["bookFiles",!1],["bookVBA",!1],["password",""],["WTF",!1]])(e)}function YH(e){return $d.WS.indexOf(e)>-1?"sheet":e==$d.CS?"chart":e==$d.DS?"dialog":e==$d.MS?"macro":e&&e.length?e:"sheet"}function KH(e,n){if(!e)return 0;try{e=n.map(function(u){return u.id||(u.id=u.strRelID),[u.name,e["!id"][u.id].Target,YH(e["!id"][u.id].Type)]})}catch{return null}return!e||e.length===0?null:e}function JH(e,n,a,u,f,_,w,T,o,k,R,F){try{_[u]=ag(Vs(e,a,!0),n);var B=ta(e,n),V;switch(T){case"sheet":V=iH(B,n,f,o,_[u],k,R,F);break;case"chart":if(V=aH(B,n,f,o,_[u],k,R,F),!V||!V["!drawel"])break;var G=jm(V["!drawel"].Target,n),U=nE(G),J=nj(Vs(e,G,!0),ag(Vs(e,U,!0),G)),X=jm(J,G),Y=nE(X);V=VG(Vs(e,X,!0),X,o,ag(Vs(e,Y,!0),X),k,V);break;case"macro":V=sH(B,n,f,o,_[u],k,R,F);break;case"dialog":V=oH(B,n,f,o,_[u],k,R,F);break;default:throw new Error("Unrecognized sheet type "+T)}w[u]=V;var Z=[];_&&_[u]&&Pl(_[u]).forEach(function(_e){var ke="";if(_[u][_e].Type==$d.CMNT){ke=jm(_[u][_e].Target,n);var Ae=hH(ta(e,ke,!0),ke,o);if(!Ae||!Ae.length)return;wP(V,Ae,!1)}_[u][_e].Type==$d.TCMNT&&(ke=jm(_[u][_e].Target,n),Z=Z.concat(aj(ta(e,ke,!0),o)))}),Z&&Z.length&&wP(V,Z,!0,o.people||[])}catch(_e){if(o.WTF)throw _e}}function ro(e){return e.charAt(0)=="/"?e.slice(1):e}function QH(e,n){if(lF(),n=n||{},YS(n),io(e,"META-INF/manifest.xml")||io(e,"objectdata.xml"))return DP(e,n);if(io(e,"Index/Document.iwa")){if(typeof Uint8Array>"u")throw new Error("NUMBERS file parsing requires Uint8Array support");if(typeof jb<"u"){if(e.FileIndex)return jb(e);var a=$n.utils.cfb_new();return ZI(e).forEach(function(Lt){e7(a,Lt,pF(e,Lt))}),jb(a)}throw new Error("Unsupported NUMBERS file")}if(!io(e,"[Content_Types].xml"))throw io(e,"index.xml.gz")?new Error("Unsupported NUMBERS 08 file"):io(e,"index.xml")?new Error("Unsupported NUMBERS 09 file"):new Error("Unsupported ZIP file");var u=ZI(e),f=X7(Vs(e,"[Content_Types].xml")),_=!1,w,T;if(f.workbooks.length===0&&(T="xl/workbook.xml",ta(e,T,!0)&&f.workbooks.push(T)),f.workbooks.length===0){if(T="xl/workbook.bin",!ta(e,T,!0))throw new Error("Could not find workbook");f.workbooks.push(T),_=!0}f.workbooks[0].slice(-3)=="bin"&&(_=!0);var o={},k={};if(!n.bookSheets&&!n.bookProps){if(lg=[],f.sst)try{lg=uH(ta(e,ro(f.sst)),f.sst,n)}catch(Lt){if(n.WTF)throw Lt}n.cellStyles&&f.themes.length&&(o=cH(Vs(e,f.themes[0].replace(/^\//,""),!0)||"",f.themes[0],n)),f.style&&(k=lH(ta(e,ro(f.style)),f.style,o,n))}f.links.map(function(Lt){try{var We=ag(Vs(e,nE(ro(Lt))),Lt);return dH(ta(e,ro(Lt)),We,Lt,n)}catch{}});var R=nH(ta(e,ro(f.workbooks[0])),f.workbooks[0],n),F={},B="";f.coreprops.length&&(B=ta(e,ro(f.coreprops[0]),!0),B&&(F=zF(B)),f.extprops.length!==0&&(B=ta(e,ro(f.extprops[0]),!0),B&&e9(B,F,n)));var V={};(!n.bookSheets||n.bookProps)&&f.custprops.length!==0&&(B=Vs(e,ro(f.custprops[0]),!0),B&&(V=r9(B,n)));var G={};if((n.bookSheets||n.bookProps)&&(R.Sheets?w=R.Sheets.map(function(We){return We.name}):F.Worksheets&&F.SheetNames.length>0&&(w=F.SheetNames),n.bookProps&&(G.Props=F,G.Custprops=V),n.bookSheets&&typeof w<"u"&&(G.SheetNames=w),n.bookSheets?G.SheetNames:n.bookProps))return G;w={};var U={};n.bookDeps&&f.calcchain&&(U=fH(ta(e,ro(f.calcchain)),f.calcchain));var J=0,X={},Y,Z;{var _e=R.Sheets;F.Worksheets=_e.length,F.SheetNames=[];for(var ke=0;ke!=_e.length;++ke)F.SheetNames[ke]=_e[ke].name}var Ae=_?"bin":"xml",me=f.workbooks[0].lastIndexOf("/"),De=(f.workbooks[0].slice(0,me+1)+"_rels/"+f.workbooks[0].slice(me+1)+".rels").replace(/^\//,"");io(e,De)||(De="xl/_rels/workbook."+Ae+".rels");var we=ag(Vs(e,De,!0),De.replace(/_rels.*/,"s5s"));(f.metadata||[]).length>=1&&(n.xlmeta=pH(ta(e,ro(f.metadata[0])),f.metadata[0],n)),(f.people||[]).length>=1&&(n.people=sj(ta(e,ro(f.people[0])),n)),we&&(we=KH(we,R.Sheets));var Je=ta(e,"xl/worksheets/sheet.xml",!0)?1:0;e:for(J=0;J!=F.Worksheets;++J){var rt="sheet";if(we&&we[J]?(Y="xl/"+we[J][1].replace(/[\/]?xl\//,""),io(e,Y)||(Y=we[J][1]),io(e,Y)||(Y=De.replace(/_rels\/.*$/,"")+we[J][1]),rt=we[J][2]):(Y="xl/worksheets/sheet"+(J+1-Je)+"."+Ae,Y=Y.replace(/sheet0\./,"sheet.")),Z=Y.replace(/^(.*)(\/)([^\/]*)$/,"$1/_rels/$3.rels"),n&&n.sheets!=null)switch(typeof n.sheets){case"number":if(J!=n.sheets)continue e;break;case"string":if(F.SheetNames[J].toLowerCase()!=n.sheets.toLowerCase())continue e;break;default:if(Array.isArray&&Array.isArray(n.sheets)){for(var Re=!1,St=0;St!=n.sheets.length;++St)typeof n.sheets[St]=="number"&&n.sheets[St]==J&&(Re=1),typeof n.sheets[St]=="string"&&n.sheets[St].toLowerCase()==F.SheetNames[J].toLowerCase()&&(Re=1);if(!Re)continue e}}JH(e,Y,Z,F.SheetNames[J],J,X,w,rt,n,R,o,k)}return G={Directory:f,Workbook:R,Props:F,Custprops:V,Deps:U,Sheets:w,SheetNames:F.SheetNames,Strings:lg,Styles:k,Themes:o,SSF:Aa(Tn)},n&&n.bookFiles&&(e.files?(G.keys=u,G.files=e.files):(G.keys=[],G.files={},e.FullPaths.forEach(function(Lt,We){Lt=Lt.replace(/^Root Entry[\/]/,""),G.keys.push(Lt),G.files[Lt]=e.FileIndex[We]}))),n&&n.bookVBA&&(f.vba.length>0?G.vbaraw=ta(e,ro(f.vba[0]),!0):f.defaults&&f.defaults.bin===uj&&(G.vbaraw=ta(e,"xl/vbaProject.bin",!0))),G}function eW(e,n){var a=n||{},u="Workbook",f=$n.find(e,u);try{if(u="/!DataSpaces/Version",f=$n.find(e,u),!f||!f.content)throw new Error("ECMA-376 Encrypted file missing "+u);if(WV(f.content),u="/!DataSpaces/DataSpaceMap",f=$n.find(e,u),!f||!f.content)throw new Error("ECMA-376 Encrypted file missing "+u);var _=ZV(f.content);if(_.length!==1||_[0].comps.length!==1||_[0].comps[0].t!==0||_[0].name!=="StrongEncryptionDataSpace"||_[0].comps[0].v!=="EncryptedPackage")throw new Error("ECMA-376 Encrypted file bad "+u);if(u="/!DataSpaces/DataSpaceInfo/StrongEncryptionDataSpace",f=$n.find(e,u),!f||!f.content)throw new Error("ECMA-376 Encrypted file missing "+u);var w=XV(f.content);if(w.length!=1||w[0]!="StrongEncryptionTransform")throw new Error("ECMA-376 Encrypted file bad "+u);if(u="/!DataSpaces/TransformInfo/StrongEncryptionTransform/!Primary",f=$n.find(e,u),!f||!f.content)throw new Error("ECMA-376 Encrypted file missing "+u);KV(f.content)}catch{}if(u="/EncryptionInfo",f=$n.find(e,u),!f||!f.content)throw new Error("ECMA-376 Encrypted file missing "+u);var T=JV(f.content);if(u="/EncryptedPackage",f=$n.find(e,u),!f||!f.content)throw new Error("ECMA-376 Encrypted file missing "+u);if(T[0]==4&&typeof decrypt_agile<"u")return decrypt_agile(T[1],f.content,a.password||"",a);if(T[0]==2&&typeof decrypt_std76<"u")return decrypt_std76(T[1],f.content,a.password||"",a);throw new Error("File is password-protected")}function KS(e,n){var a="";switch((n||{}).type||"base64"){case"buffer":return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7]];case"base64":a=Ws(e.slice(0,12));break;case"binary":a=e;break;case"array":return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7]];default:throw new Error("Unrecognized type "+(n&&n.type||"undefined"))}return[a.charCodeAt(0),a.charCodeAt(1),a.charCodeAt(2),a.charCodeAt(3),a.charCodeAt(4),a.charCodeAt(5),a.charCodeAt(6),a.charCodeAt(7)]}function tW(e,n){return $n.find(e,"EncryptedPackage")?eW(e,n):bL(e,n)}function rW(e,n){var a,u=e,f=n||{};return f.type||(f.type=zn&&Buffer.isBuffer(e)?"buffer":"base64"),a=mF(u,f),QH(a,f)}function AL(e,n){var a=0;e:for(;a<e.length;)switch(e.charCodeAt(a)){case 10:case 13:case 32:++a;break;case 60:return sE(e.slice(a),n);default:break e}return Pg.to_workbook(e,n)}function nW(e,n){var a="",u=KS(e,n);switch(n.type){case"base64":a=Ws(e);break;case"binary":a=e;break;case"buffer":a=e.toString("binary");break;case"array":a=of(e);break;default:throw new Error("Unrecognized type "+n.type)}return u[0]==239&&u[1]==187&&u[2]==191&&(a=gi(a)),n.type="binary",AL(a,n)}function iW(e,n){var a=e;return n.type=="base64"&&(a=Ws(a)),a=vu.utils.decode(1200,a.slice(2),"str"),n.type="binary",AL(a,n)}function aW(e){return e.match(/[^\x00-\x7F]/)?Gm(e):e}function Gb(e,n,a,u){return u?(a.type="string",Pg.to_workbook(e,a)):Pg.to_workbook(n,a)}function uE(e,n){YD();var a=n||{};if(typeof ArrayBuffer<"u"&&e instanceof ArrayBuffer)return uE(new Uint8Array(e),(a=Aa(a),a.type="array",a));typeof Uint8Array<"u"&&e instanceof Uint8Array&&!a.type&&(a.type=typeof Deno<"u"?"buffer":"array");var u=e,f=[0,0,0,0],_=!1;if(a.cellStyles&&(a.cellNF=!0,a.sheetStubs=!0),Kd={},a.dateNF&&(Kd.dateNF=a.dateNF),a.type||(a.type=zn&&Buffer.isBuffer(e)?"buffer":"base64"),a.type=="file"&&(a.type=zn?"buffer":"binary",u=qU(e),typeof Uint8Array<"u"&&!zn&&(a.type="array")),a.type=="string"&&(_=!0,a.type="binary",a.codepage=65001,u=aW(e)),a.type=="array"&&typeof Uint8Array<"u"&&e instanceof Uint8Array&&typeof ArrayBuffer<"u"){var w=new ArrayBuffer(3),T=new Uint8Array(w);if(T.foo="bar",!T.foo)return a=Aa(a),a.type="array",uE(MS(u),a)}switch((f=KS(u,a))[0]){case 208:if(f[1]===207&&f[2]===17&&f[3]===224&&f[4]===161&&f[5]===177&&f[6]===26&&f[7]===225)return tW($n.read(u,a),a);break;case 9:if(f[1]<=8)return bL(u,a);break;case 60:return sE(u,a);case 73:if(f[1]===73&&f[2]===42&&f[3]===0)throw new Error("TIFF Image File is not a spreadsheet");if(f[1]===68)return DV(u,a);break;case 84:if(f[1]===65&&f[2]===66&&f[3]===76)return PV.to_workbook(u,a);break;case 80:return f[1]===75&&f[2]<9&&f[3]<9?rW(u,a):Gb(e,u,a,_);case 239:return f[3]===60?sE(u,a):Gb(e,u,a,_);case 255:if(f[1]===254)return iW(u,a);if(f[1]===0&&f[2]===2&&f[3]===0)return og.to_workbook(u,a);break;case 0:if(f[1]===0&&(f[2]>=2&&f[3]===0||f[2]===0&&(f[3]===8||f[3]===9)))return og.to_workbook(u,a);break;case 3:case 131:case 139:case 140:return vP.to_workbook(u,a);case 123:if(f[1]===92&&f[2]===114&&f[3]===116)return u$.to_workbook(u,a);break;case 10:case 13:case 32:return nW(u,a);case 137:if(f[1]===80&&f[2]===78&&f[3]===71)throw new Error("PNG Image File is not a spreadsheet");break}return MV.indexOf(f[0])>-1&&f[2]<=12&&f[3]<=31?vP.to_workbook(u,a):Gb(e,u,a,_)}function sW(e,n,a,u,f,_,w,T){var o=Ca(a),k=T.defval,R=T.raw||!Object.prototype.hasOwnProperty.call(T,"raw"),F=!0,B=f===1?[]:{};if(f!==1)if(Object.defineProperty)try{Object.defineProperty(B,"__rowNum__",{value:a,enumerable:!1})}catch{B.__rowNum__=a}else B.__rowNum__=a;if(!w||e[a])for(var V=n.s.c;V<=n.e.c;++V){var G=w?e[a][V]:e[u[V]+o];if(G===void 0||G.t===void 0){if(k===void 0)continue;_[V]!=null&&(B[_[V]]=k);continue}var U=G.v;switch(G.t){case"z":if(U==null)break;continue;case"e":U=U==0?null:void 0;break;case"s":case"d":case"b":case"n":break;default:throw new Error("unrecognized type "+G.t)}if(_[V]!=null){if(U==null)if(G.t=="e"&&U===null)B[_[V]]=null;else if(k!==void 0)B[_[V]]=k;else if(R&&U===null)B[_[V]]=null;else continue;else B[_[V]]=R&&(G.t!=="n"||G.t==="n"&&T.rawNumbers!==!1)?U:vc(G,U,T);U!=null&&(F=!1)}}return{row:B,isempty:F}}function hE(e,n){if(e==null||e["!ref"]==null)return[];var a={t:"n",v:0},u=0,f=1,_=[],w=0,T="",o={s:{r:0,c:0},e:{r:0,c:0}},k=n||{},R=k.range!=null?k.range:e["!ref"];switch(k.header===1?u=1:k.header==="A"?u=2:Array.isArray(k.header)?u=3:k.header==null&&(u=0),typeof R){case"string":o=Vi(R);break;case"number":o=Vi(e["!ref"]),o.s.r=R;break;default:o=R}u>0&&(f=0);var F=Ca(o.s.r),B=[],V=[],G=0,U=0,J=Array.isArray(e),X=o.s.r,Y=0,Z={};J&&!e[X]&&(e[X]=[]);var _e=k.skipHidden&&e["!cols"]||[],ke=k.skipHidden&&e["!rows"]||[];for(Y=o.s.c;Y<=o.e.c;++Y)if(!(_e[Y]||{}).hidden)switch(B[Y]=ca(Y),a=J?e[X][Y]:e[B[Y]+F],u){case 1:_[Y]=Y-o.s.c;break;case 2:_[Y]=B[Y];break;case 3:_[Y]=k.header[Y-o.s.c];break;default:if(a==null&&(a={w:"__EMPTY",t:"s"}),T=w=vc(a,null,k),U=Z[w]||0,!U)Z[w]=1;else{do T=w+"_"+U++;while(Z[T]);Z[w]=U,Z[T]=1}_[Y]=T}for(X=o.s.r+f;X<=o.e.r;++X)if(!(ke[X]||{}).hidden){var Ae=sW(e,o,X,B,u,_,J,k);(Ae.isempty===!1||(u===1?k.blankrows!==!1:k.blankrows))&&(V[G++]=Ae.row)}return V.length=G,V}var NP=/"/g;function oW(e,n,a,u,f,_,w,T){for(var o=!0,k=[],R="",F=Ca(a),B=n.s.c;B<=n.e.c;++B)if(u[B]){var V=T.dense?(e[a]||[])[B]:e[u[B]+F];if(V==null)R="";else if(V.v!=null){o=!1,R=""+(T.rawNumbers&&V.t=="n"?V.v:vc(V,null,T));for(var G=0,U=0;G!==R.length;++G)if((U=R.charCodeAt(G))===f||U===_||U===34||T.forceQuotes){R='"'+R.replace(NP,'""')+'"';break}R=="ID"&&(R='"ID"')}else V.f!=null&&!V.F?(o=!1,R="="+V.f,R.indexOf(",")>=0&&(R='"'+R.replace(NP,'""')+'"')):R="";k.push(R)}return T.blankrows===!1&&o?null:k.join(w)}function CL(e,n){var a=[],u=n??{};if(e==null||e["!ref"]==null)return"";var f=Vi(e["!ref"]),_=u.FS!==void 0?u.FS:",",w=_.charCodeAt(0),T=u.RS!==void 0?u.RS:`
`,o=T.charCodeAt(0),k=new RegExp((_=="|"?"\\|":_)+"+$"),R="",F=[];u.dense=Array.isArray(e);for(var B=u.skipHidden&&e["!cols"]||[],V=u.skipHidden&&e["!rows"]||[],G=f.s.c;G<=f.e.c;++G)(B[G]||{}).hidden||(F[G]=ca(G));for(var U=0,J=f.s.r;J<=f.e.r;++J)(V[J]||{}).hidden||(R=oW(e,f,J,F,w,o,_,u),R!=null&&(u.strip&&(R=R.replace(k,"")),(R||u.blankrows!==!1)&&a.push((U++?T:"")+R)));return delete u.dense,a.join("")}function lW(e,n){n||(n={}),n.FS="	",n.RS=`
`;var a=CL(e,n);return a}function cW(e){var n="",a,u="";if(e==null||e["!ref"]==null)return[];var f=Vi(e["!ref"]),_="",w=[],T,o=[],k=Array.isArray(e);for(T=f.s.c;T<=f.e.c;++T)w[T]=ca(T);for(var R=f.s.r;R<=f.e.r;++R)for(_=Ca(R),T=f.s.c;T<=f.e.c;++T)if(n=w[T]+_,a=k?(e[R]||[])[T]:e[n],u="",a!==void 0){if(a.F!=null){if(n=a.F,!a.f)continue;u=a.f,n.indexOf(":")==-1&&(n=n+":"+n)}if(a.f!=null)u=a.f;else{if(a.t=="z")continue;if(a.t=="n"&&a.v!=null)u=""+a.v;else if(a.t=="b")u=a.v?"TRUE":"FALSE";else if(a.w!==void 0)u="'"+a.w;else{if(a.v===void 0)continue;a.t=="s"?u="'"+a.v:u=""+a.v}}o[o.length]=n+"="+u}return o}function kL(e,n,a){var u=a||{},f=+!u.skipHeader,_=e||{},w=0,T=0;if(_&&u.origin!=null)if(typeof u.origin=="number")w=u.origin;else{var o=typeof u.origin=="string"?rs(u.origin):u.origin;w=o.r,T=o.c}var k,R={s:{c:0,r:0},e:{c:T,r:w+n.length-1+f}};if(_["!ref"]){var F=Vi(_["!ref"]);R.e.c=Math.max(R.e.c,F.e.c),R.e.r=Math.max(R.e.r,F.e.r),w==-1&&(w=F.e.r+1,R.e.r=w+n.length-1+f)}else w==-1&&(w=0,R.e.r=n.length-1+f);var B=u.header||[],V=0;n.forEach(function(U,J){Pl(U).forEach(function(X){(V=B.indexOf(X))==-1&&(B[V=B.length]=X);var Y=U[X],Z="z",_e="",ke=yn({c:T+V,r:w+J+f});k=Lg(_,ke),Y&&typeof Y=="object"&&!(Y instanceof Date)?_[ke]=Y:(typeof Y=="number"?Z="n":typeof Y=="boolean"?Z="b":typeof Y=="string"?Z="s":Y instanceof Date?(Z="d",u.cellDates||(Z="n",Y=as(Y)),_e=u.dateNF||Tn[14]):Y===null&&u.nullError&&(Z="e",Y=0),k?(k.t=Z,k.v=Y,delete k.w,delete k.R,_e&&(k.z=_e)):_[ke]=k={t:Z,v:Y},_e&&(k.z=_e))})}),R.e.c=Math.max(R.e.c,T+B.length-1);var G=Ca(w);if(f)for(V=0;V<B.length;++V)_[ca(V+T)+G]={t:"s",v:B[V]};return _["!ref"]=jn(R),_}function uW(e,n){return kL(null,e,n)}function Lg(e,n,a){if(typeof n=="string"){if(Array.isArray(e)){var u=rs(n);return e[u.r]||(e[u.r]=[]),e[u.r][u.c]||(e[u.r][u.c]={t:"z"})}return e[n]||(e[n]={t:"z"})}return typeof n!="number"?Lg(e,yn(n)):Lg(e,yn({r:n,c:a||0}))}function hW(e,n){if(typeof n=="number"){if(n>=0&&e.SheetNames.length>n)return n;throw new Error("Cannot find sheet # "+n)}else if(typeof n=="string"){var a=e.SheetNames.indexOf(n);if(a>-1)return a;throw new Error("Cannot find sheet name |"+n+"|")}else throw new Error("Cannot find sheet |"+n+"|")}function JS(){return{SheetNames:[],Sheets:{}}}function QS(e,n,a,u){var f=1;if(!a)for(;f<=65535&&e.SheetNames.indexOf(a="Sheet"+f)!=-1;++f,a=void 0);if(!a||e.SheetNames.length>=65535)throw new Error("Too many worksheets");if(u&&e.SheetNames.indexOf(a)>=0){var _=a.match(/(^.*?)(\d+)$/);f=_&&+_[2]||0;var w=_&&_[1]||a;for(++f;f<=65535&&e.SheetNames.indexOf(a=w+f)!=-1;++f);}if(XG(a),e.SheetNames.indexOf(a)>=0)throw new Error("Worksheet with name |"+a+"| already exists!");return e.SheetNames.push(a),e.Sheets[a]=n,a}function fW(e,n,a){e.Workbook||(e.Workbook={}),e.Workbook.Sheets||(e.Workbook.Sheets=[]);var u=hW(e,n);switch(e.Workbook.Sheets[u]||(e.Workbook.Sheets[u]={}),a){case 0:case 1:case 2:break;default:throw new Error("Bad sheet visibility setting "+a)}e.Workbook.Sheets[u].Hidden=a}function dW(e,n){return e.z=n,e}function ML(e,n,a){return n?(e.l={Target:n},a&&(e.l.Tooltip=a)):delete e.l,e}function pW(e,n,a){return ML(e,"#"+n,a)}function mW(e,n,a){e.c||(e.c=[]),e.c.push({t:n,a:a||"SheetJS"})}function gW(e,n,a,u){for(var f=typeof n!="string"?n:Vi(n),_=typeof n=="string"?n:jn(n),w=f.s.r;w<=f.e.r;++w)for(var T=f.s.c;T<=f.e.c;++T){var o=Lg(e,w,T);o.t="n",o.F=_,delete o.v,w==f.s.r&&T==f.s.c&&(o.f=a,u&&(o.D=!0))}return e}var _W={encode_col:ca,encode_row:Ca,encode_cell:yn,encode_range:jn,decode_col:zS,decode_row:NS,split_cell:k7,decode_cell:rs,decode_range:_p,format_cell:vc,sheet_add_aoa:DF,sheet_add_json:kL,sheet_add_dom:TL,aoa_to_sheet:xp,json_to_sheet:uW,table_to_sheet:EL,table_to_book:DH,sheet_to_csv:CL,sheet_to_txt:lW,sheet_to_json:hE,sheet_to_html:RH,sheet_to_formulae:cW,sheet_to_row_object_array:hE,sheet_get_cell:Lg,book_new:JS,book_append_sheet:QS,book_set_sheet_visibility:fW,cell_set_number_format:dW,cell_set_hyperlink:ML,cell_set_internal_link:pW,cell_add_comment:mW,sheet_set_array_formula:gW,consts:{SHEET_VISIBLE:0,SHEET_HIDDEN:1,SHEET_VERY_HIDDEN:2}};function IL(e,n){return function(){return e.apply(n,arguments)}}const{toString:xW}=Object.prototype,{getPrototypeOf:eA}=Object,lv=(e=>n=>{const a=xW.call(n);return e[a]||(e[a]=a.slice(8,-1).toLowerCase())})(Object.create(null)),Ol=e=>(e=e.toLowerCase(),n=>lv(n)===e),cv=e=>n=>typeof n===e,{isArray:yp}=Array,Og=cv("undefined");function yW(e){return e!==null&&!Og(e)&&e.constructor!==null&&!Og(e.constructor)&&co(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const PL=Ol("ArrayBuffer");function vW(e){let n;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?n=ArrayBuffer.isView(e):n=e&&e.buffer&&PL(e.buffer),n}const wW=cv("string"),co=cv("function"),RL=cv("number"),uv=e=>e!==null&&typeof e=="object",bW=e=>e===!0||e===!1,qy=e=>{if(lv(e)!=="object")return!1;const n=eA(e);return(n===null||n===Object.prototype||Object.getPrototypeOf(n)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},TW=Ol("Date"),EW=Ol("File"),SW=Ol("Blob"),AW=Ol("FileList"),CW=e=>uv(e)&&co(e.pipe),kW=e=>{let n;return e&&(typeof FormData=="function"&&e instanceof FormData||co(e.append)&&((n=lv(e))==="formdata"||n==="object"&&co(e.toString)&&e.toString()==="[object FormData]"))},MW=Ol("URLSearchParams"),IW=e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Qg(e,n,{allOwnKeys:a=!1}={}){if(e===null||typeof e>"u")return;let u,f;if(typeof e!="object"&&(e=[e]),yp(e))for(u=0,f=e.length;u<f;u++)n.call(null,e[u],u,e);else{const _=a?Object.getOwnPropertyNames(e):Object.keys(e),w=_.length;let T;for(u=0;u<w;u++)T=_[u],n.call(null,e[T],T,e)}}function DL(e,n){n=n.toLowerCase();const a=Object.keys(e);let u=a.length,f;for(;u-- >0;)if(f=a[u],n===f.toLowerCase())return f;return null}const FL=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,LL=e=>!Og(e)&&e!==FL;function fE(){const{caseless:e}=LL(this)&&this||{},n={},a=(u,f)=>{const _=e&&DL(n,f)||f;qy(n[_])&&qy(u)?n[_]=fE(n[_],u):qy(u)?n[_]=fE({},u):yp(u)?n[_]=u.slice():n[_]=u};for(let u=0,f=arguments.length;u<f;u++)arguments[u]&&Qg(arguments[u],a);return n}const PW=(e,n,a,{allOwnKeys:u}={})=>(Qg(n,(f,_)=>{a&&co(f)?e[_]=IL(f,a):e[_]=f},{allOwnKeys:u}),e),RW=e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),DW=(e,n,a,u)=>{e.prototype=Object.create(n.prototype,u),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:n.prototype}),a&&Object.assign(e.prototype,a)},FW=(e,n,a,u)=>{let f,_,w;const T={};if(n=n||{},e==null)return n;do{for(f=Object.getOwnPropertyNames(e),_=f.length;_-- >0;)w=f[_],(!u||u(w,e,n))&&!T[w]&&(n[w]=e[w],T[w]=!0);e=a!==!1&&eA(e)}while(e&&(!a||a(e,n))&&e!==Object.prototype);return n},LW=(e,n,a)=>{e=String(e),(a===void 0||a>e.length)&&(a=e.length),a-=n.length;const u=e.indexOf(n,a);return u!==-1&&u===a},OW=e=>{if(!e)return null;if(yp(e))return e;let n=e.length;if(!RL(n))return null;const a=new Array(n);for(;n-- >0;)a[n]=e[n];return a},NW=(e=>n=>e&&n instanceof e)(typeof Uint8Array<"u"&&eA(Uint8Array)),zW=(e,n)=>{const u=(e&&e[Symbol.iterator]).call(e);let f;for(;(f=u.next())&&!f.done;){const _=f.value;n.call(e,_[0],_[1])}},BW=(e,n)=>{let a;const u=[];for(;(a=e.exec(n))!==null;)u.push(a);return u},UW=Ol("HTMLFormElement"),VW=e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(a,u,f){return u.toUpperCase()+f}),zP=(({hasOwnProperty:e})=>(n,a)=>e.call(n,a))(Object.prototype),$W=Ol("RegExp"),OL=(e,n)=>{const a=Object.getOwnPropertyDescriptors(e),u={};Qg(a,(f,_)=>{let w;(w=n(f,_,e))!==!1&&(u[_]=w||f)}),Object.defineProperties(e,u)},jW=e=>{OL(e,(n,a)=>{if(co(e)&&["arguments","caller","callee"].indexOf(a)!==-1)return!1;const u=e[a];if(co(u)){if(n.enumerable=!1,"writable"in n){n.writable=!1;return}n.set||(n.set=()=>{throw Error("Can not rewrite read-only method '"+a+"'")})}})},GW=(e,n)=>{const a={},u=f=>{f.forEach(_=>{a[_]=!0})};return yp(e)?u(e):u(String(e).split(n)),a},HW=()=>{},WW=(e,n)=>(e=+e,Number.isFinite(e)?e:n),Hb="abcdefghijklmnopqrstuvwxyz",BP="0123456789",NL={DIGIT:BP,ALPHA:Hb,ALPHA_DIGIT:Hb+Hb.toUpperCase()+BP},qW=(e=16,n=NL.ALPHA_DIGIT)=>{let a="";const{length:u}=n;for(;e--;)a+=n[Math.random()*u|0];return a};function ZW(e){return!!(e&&co(e.append)&&e[Symbol.toStringTag]==="FormData"&&e[Symbol.iterator])}const XW=e=>{const n=new Array(10),a=(u,f)=>{if(uv(u)){if(n.indexOf(u)>=0)return;if(!("toJSON"in u)){n[f]=u;const _=yp(u)?[]:{};return Qg(u,(w,T)=>{const o=a(w,f+1);!Og(o)&&(_[T]=o)}),n[f]=void 0,_}}return u};return a(e,0)},YW=Ol("AsyncFunction"),KW=e=>e&&(uv(e)||co(e))&&co(e.then)&&co(e.catch),Zt={isArray:yp,isArrayBuffer:PL,isBuffer:yW,isFormData:kW,isArrayBufferView:vW,isString:wW,isNumber:RL,isBoolean:bW,isObject:uv,isPlainObject:qy,isUndefined:Og,isDate:TW,isFile:EW,isBlob:SW,isRegExp:$W,isFunction:co,isStream:CW,isURLSearchParams:MW,isTypedArray:NW,isFileList:AW,forEach:Qg,merge:fE,extend:PW,trim:IW,stripBOM:RW,inherits:DW,toFlatObject:FW,kindOf:lv,kindOfTest:Ol,endsWith:LW,toArray:OW,forEachEntry:zW,matchAll:BW,isHTMLForm:UW,hasOwnProperty:zP,hasOwnProp:zP,reduceDescriptors:OL,freezeMethods:jW,toObjectSet:GW,toCamelCase:VW,noop:HW,toFiniteNumber:WW,findKey:DL,global:FL,isContextDefined:LL,ALPHABET:NL,generateString:qW,isSpecCompliantForm:ZW,toJSONObject:XW,isAsyncFn:YW,isThenable:KW};function Vn(e,n,a,u,f){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",n&&(this.code=n),a&&(this.config=a),u&&(this.request=u),f&&(this.response=f)}Zt.inherits(Vn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Zt.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const zL=Vn.prototype,BL={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{BL[e]={value:e}});Object.defineProperties(Vn,BL);Object.defineProperty(zL,"isAxiosError",{value:!0});Vn.from=(e,n,a,u,f,_)=>{const w=Object.create(zL);return Zt.toFlatObject(e,w,function(o){return o!==Error.prototype},T=>T!=="isAxiosError"),Vn.call(w,e.message,n,a,u,f),w.cause=e,w.name=e.name,_&&Object.assign(w,_),w};const JW=null;function dE(e){return Zt.isPlainObject(e)||Zt.isArray(e)}function UL(e){return Zt.endsWith(e,"[]")?e.slice(0,-2):e}function UP(e,n,a){return e?e.concat(n).map(function(f,_){return f=UL(f),!a&&_?"["+f+"]":f}).join(a?".":""):n}function QW(e){return Zt.isArray(e)&&!e.some(dE)}const eq=Zt.toFlatObject(Zt,{},null,function(n){return/^is[A-Z]/.test(n)});function hv(e,n,a){if(!Zt.isObject(e))throw new TypeError("target must be an object");n=n||new FormData,a=Zt.toFlatObject(a,{metaTokens:!0,dots:!1,indexes:!1},!1,function(U,J){return!Zt.isUndefined(J[U])});const u=a.metaTokens,f=a.visitor||R,_=a.dots,w=a.indexes,o=(a.Blob||typeof Blob<"u"&&Blob)&&Zt.isSpecCompliantForm(n);if(!Zt.isFunction(f))throw new TypeError("visitor must be a function");function k(G){if(G===null)return"";if(Zt.isDate(G))return G.toISOString();if(!o&&Zt.isBlob(G))throw new Vn("Blob is not supported. Use a Buffer instead.");return Zt.isArrayBuffer(G)||Zt.isTypedArray(G)?o&&typeof Blob=="function"?new Blob([G]):Buffer.from(G):G}function R(G,U,J){let X=G;if(G&&!J&&typeof G=="object"){if(Zt.endsWith(U,"{}"))U=u?U:U.slice(0,-2),G=JSON.stringify(G);else if(Zt.isArray(G)&&QW(G)||(Zt.isFileList(G)||Zt.endsWith(U,"[]"))&&(X=Zt.toArray(G)))return U=UL(U),X.forEach(function(Z,_e){!(Zt.isUndefined(Z)||Z===null)&&n.append(w===!0?UP([U],_e,_):w===null?U:U+"[]",k(Z))}),!1}return dE(G)?!0:(n.append(UP(J,U,_),k(G)),!1)}const F=[],B=Object.assign(eq,{defaultVisitor:R,convertValue:k,isVisitable:dE});function V(G,U){if(!Zt.isUndefined(G)){if(F.indexOf(G)!==-1)throw Error("Circular reference detected in "+U.join("."));F.push(G),Zt.forEach(G,function(X,Y){(!(Zt.isUndefined(X)||X===null)&&f.call(n,X,Zt.isString(Y)?Y.trim():Y,U,B))===!0&&V(X,U?U.concat(Y):[Y])}),F.pop()}}if(!Zt.isObject(e))throw new TypeError("data must be an object");return V(e),n}function VP(e){const n={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(u){return n[u]})}function tA(e,n){this._pairs=[],e&&hv(e,this,n)}const VL=tA.prototype;VL.append=function(n,a){this._pairs.push([n,a])};VL.toString=function(n){const a=n?function(u){return n.call(this,u,VP)}:VP;return this._pairs.map(function(f){return a(f[0])+"="+a(f[1])},"").join("&")};function tq(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function $L(e,n,a){if(!n)return e;const u=a&&a.encode||tq,f=a&&a.serialize;let _;if(f?_=f(n,a):_=Zt.isURLSearchParams(n)?n.toString():new tA(n,a).toString(u),_){const w=e.indexOf("#");w!==-1&&(e=e.slice(0,w)),e+=(e.indexOf("?")===-1?"?":"&")+_}return e}class $P{constructor(){this.handlers=[]}use(n,a,u){return this.handlers.push({fulfilled:n,rejected:a,synchronous:u?u.synchronous:!1,runWhen:u?u.runWhen:null}),this.handlers.length-1}eject(n){this.handlers[n]&&(this.handlers[n]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(n){Zt.forEach(this.handlers,function(u){u!==null&&n(u)})}}const jL={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},rq=typeof URLSearchParams<"u"?URLSearchParams:tA,nq=typeof FormData<"u"?FormData:null,iq=typeof Blob<"u"?Blob:null,aq={isBrowser:!0,classes:{URLSearchParams:rq,FormData:nq,Blob:iq},protocols:["http","https","file","blob","url","data"]},GL=typeof window<"u"&&typeof document<"u",sq=(e=>GL&&["ReactNative","NativeScript","NS"].indexOf(e)<0)(typeof navigator<"u"&&navigator.product),oq=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",lq=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:GL,hasStandardBrowserEnv:sq,hasStandardBrowserWebWorkerEnv:oq},Symbol.toStringTag,{value:"Module"})),kl={...lq,...aq};function cq(e,n){return hv(e,new kl.classes.URLSearchParams,Object.assign({visitor:function(a,u,f,_){return kl.isNode&&Zt.isBuffer(a)?(this.append(u,a.toString("base64")),!1):_.defaultVisitor.apply(this,arguments)}},n))}function uq(e){return Zt.matchAll(/\w+|\[(\w*)]/g,e).map(n=>n[0]==="[]"?"":n[1]||n[0])}function hq(e){const n={},a=Object.keys(e);let u;const f=a.length;let _;for(u=0;u<f;u++)_=a[u],n[_]=e[_];return n}function HL(e){function n(a,u,f,_){let w=a[_++];if(w==="__proto__")return!0;const T=Number.isFinite(+w),o=_>=a.length;return w=!w&&Zt.isArray(f)?f.length:w,o?(Zt.hasOwnProp(f,w)?f[w]=[f[w],u]:f[w]=u,!T):((!f[w]||!Zt.isObject(f[w]))&&(f[w]=[]),n(a,u,f[w],_)&&Zt.isArray(f[w])&&(f[w]=hq(f[w])),!T)}if(Zt.isFormData(e)&&Zt.isFunction(e.entries)){const a={};return Zt.forEachEntry(e,(u,f)=>{n(uq(u),f,a,0)}),a}return null}function fq(e,n,a){if(Zt.isString(e))try{return(n||JSON.parse)(e),Zt.trim(e)}catch(u){if(u.name!=="SyntaxError")throw u}return(a||JSON.stringify)(e)}const rA={transitional:jL,adapter:["xhr","http"],transformRequest:[function(n,a){const u=a.getContentType()||"",f=u.indexOf("application/json")>-1,_=Zt.isObject(n);if(_&&Zt.isHTMLForm(n)&&(n=new FormData(n)),Zt.isFormData(n))return f?JSON.stringify(HL(n)):n;if(Zt.isArrayBuffer(n)||Zt.isBuffer(n)||Zt.isStream(n)||Zt.isFile(n)||Zt.isBlob(n))return n;if(Zt.isArrayBufferView(n))return n.buffer;if(Zt.isURLSearchParams(n))return a.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),n.toString();let T;if(_){if(u.indexOf("application/x-www-form-urlencoded")>-1)return cq(n,this.formSerializer).toString();if((T=Zt.isFileList(n))||u.indexOf("multipart/form-data")>-1){const o=this.env&&this.env.FormData;return hv(T?{"files[]":n}:n,o&&new o,this.formSerializer)}}return _||f?(a.setContentType("application/json",!1),fq(n)):n}],transformResponse:[function(n){const a=this.transitional||rA.transitional,u=a&&a.forcedJSONParsing,f=this.responseType==="json";if(n&&Zt.isString(n)&&(u&&!this.responseType||f)){const w=!(a&&a.silentJSONParsing)&&f;try{return JSON.parse(n)}catch(T){if(w)throw T.name==="SyntaxError"?Vn.from(T,Vn.ERR_BAD_RESPONSE,this,null,this.response):T}}return n}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:kl.classes.FormData,Blob:kl.classes.Blob},validateStatus:function(n){return n>=200&&n<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Zt.forEach(["delete","get","head","post","put","patch"],e=>{rA.headers[e]={}});const nA=rA,dq=Zt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),pq=e=>{const n={};let a,u,f;return e&&e.split(`
`).forEach(function(w){f=w.indexOf(":"),a=w.substring(0,f).trim().toLowerCase(),u=w.substring(f+1).trim(),!(!a||n[a]&&dq[a])&&(a==="set-cookie"?n[a]?n[a].push(u):n[a]=[u]:n[a]=n[a]?n[a]+", "+u:u)}),n},jP=Symbol("internals");function Pm(e){return e&&String(e).trim().toLowerCase()}function Zy(e){return e===!1||e==null?e:Zt.isArray(e)?e.map(Zy):String(e)}function mq(e){const n=Object.create(null),a=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let u;for(;u=a.exec(e);)n[u[1]]=u[2];return n}const gq=e=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim());function Wb(e,n,a,u,f){if(Zt.isFunction(u))return u.call(this,n,a);if(f&&(n=a),!!Zt.isString(n)){if(Zt.isString(u))return n.indexOf(u)!==-1;if(Zt.isRegExp(u))return u.test(n)}}function _q(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(n,a,u)=>a.toUpperCase()+u)}function xq(e,n){const a=Zt.toCamelCase(" "+n);["get","set","has"].forEach(u=>{Object.defineProperty(e,u+a,{value:function(f,_,w){return this[u].call(this,n,f,_,w)},configurable:!0})})}class fv{constructor(n){n&&this.set(n)}set(n,a,u){const f=this;function _(T,o,k){const R=Pm(o);if(!R)throw new Error("header name must be a non-empty string");const F=Zt.findKey(f,R);(!F||f[F]===void 0||k===!0||k===void 0&&f[F]!==!1)&&(f[F||o]=Zy(T))}const w=(T,o)=>Zt.forEach(T,(k,R)=>_(k,R,o));return Zt.isPlainObject(n)||n instanceof this.constructor?w(n,a):Zt.isString(n)&&(n=n.trim())&&!gq(n)?w(pq(n),a):n!=null&&_(a,n,u),this}get(n,a){if(n=Pm(n),n){const u=Zt.findKey(this,n);if(u){const f=this[u];if(!a)return f;if(a===!0)return mq(f);if(Zt.isFunction(a))return a.call(this,f,u);if(Zt.isRegExp(a))return a.exec(f);throw new TypeError("parser must be boolean|regexp|function")}}}has(n,a){if(n=Pm(n),n){const u=Zt.findKey(this,n);return!!(u&&this[u]!==void 0&&(!a||Wb(this,this[u],u,a)))}return!1}delete(n,a){const u=this;let f=!1;function _(w){if(w=Pm(w),w){const T=Zt.findKey(u,w);T&&(!a||Wb(u,u[T],T,a))&&(delete u[T],f=!0)}}return Zt.isArray(n)?n.forEach(_):_(n),f}clear(n){const a=Object.keys(this);let u=a.length,f=!1;for(;u--;){const _=a[u];(!n||Wb(this,this[_],_,n,!0))&&(delete this[_],f=!0)}return f}normalize(n){const a=this,u={};return Zt.forEach(this,(f,_)=>{const w=Zt.findKey(u,_);if(w){a[w]=Zy(f),delete a[_];return}const T=n?_q(_):String(_).trim();T!==_&&delete a[_],a[T]=Zy(f),u[T]=!0}),this}concat(...n){return this.constructor.concat(this,...n)}toJSON(n){const a=Object.create(null);return Zt.forEach(this,(u,f)=>{u!=null&&u!==!1&&(a[f]=n&&Zt.isArray(u)?u.join(", "):u)}),a}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([n,a])=>n+": "+a).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(n){return n instanceof this?n:new this(n)}static concat(n,...a){const u=new this(n);return a.forEach(f=>u.set(f)),u}static accessor(n){const u=(this[jP]=this[jP]={accessors:{}}).accessors,f=this.prototype;function _(w){const T=Pm(w);u[T]||(xq(f,w),u[T]=!0)}return Zt.isArray(n)?n.forEach(_):_(n),this}}fv.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Zt.reduceDescriptors(fv.prototype,({value:e},n)=>{let a=n[0].toUpperCase()+n.slice(1);return{get:()=>e,set(u){this[a]=u}}});Zt.freezeMethods(fv);const mc=fv;function qb(e,n){const a=this||nA,u=n||a,f=mc.from(u.headers);let _=u.data;return Zt.forEach(e,function(T){_=T.call(a,_,f.normalize(),n?n.status:void 0)}),f.normalize(),_}function WL(e){return!!(e&&e.__CANCEL__)}function e_(e,n,a){Vn.call(this,e??"canceled",Vn.ERR_CANCELED,n,a),this.name="CanceledError"}Zt.inherits(e_,Vn,{__CANCEL__:!0});function yq(e,n,a){const u=a.config.validateStatus;!a.status||!u||u(a.status)?e(a):n(new Vn("Request failed with status code "+a.status,[Vn.ERR_BAD_REQUEST,Vn.ERR_BAD_RESPONSE][Math.floor(a.status/100)-4],a.config,a.request,a))}const vq=kl.hasStandardBrowserEnv?{write(e,n,a,u,f,_){const w=[e+"="+encodeURIComponent(n)];Zt.isNumber(a)&&w.push("expires="+new Date(a).toGMTString()),Zt.isString(u)&&w.push("path="+u),Zt.isString(f)&&w.push("domain="+f),_===!0&&w.push("secure"),document.cookie=w.join("; ")},read(e){const n=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return n?decodeURIComponent(n[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function wq(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}function bq(e,n){return n?e.replace(/\/?\/$/,"")+"/"+n.replace(/^\/+/,""):e}function qL(e,n){return e&&!wq(n)?bq(e,n):n}const Tq=kl.hasStandardBrowserEnv?function(){const n=/(msie|trident)/i.test(navigator.userAgent),a=document.createElement("a");let u;function f(_){let w=_;return n&&(a.setAttribute("href",w),w=a.href),a.setAttribute("href",w),{href:a.href,protocol:a.protocol?a.protocol.replace(/:$/,""):"",host:a.host,search:a.search?a.search.replace(/^\?/,""):"",hash:a.hash?a.hash.replace(/^#/,""):"",hostname:a.hostname,port:a.port,pathname:a.pathname.charAt(0)==="/"?a.pathname:"/"+a.pathname}}return u=f(window.location.href),function(w){const T=Zt.isString(w)?f(w):w;return T.protocol===u.protocol&&T.host===u.host}}():function(){return function(){return!0}}();function Eq(e){const n=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return n&&n[1]||""}function Sq(e,n){e=e||10;const a=new Array(e),u=new Array(e);let f=0,_=0,w;return n=n!==void 0?n:1e3,function(o){const k=Date.now(),R=u[_];w||(w=k),a[f]=o,u[f]=k;let F=_,B=0;for(;F!==f;)B+=a[F++],F=F%e;if(f=(f+1)%e,f===_&&(_=(_+1)%e),k-w<n)return;const V=R&&k-R;return V?Math.round(B*1e3/V):void 0}}function GP(e,n){let a=0;const u=Sq(50,250);return f=>{const _=f.loaded,w=f.lengthComputable?f.total:void 0,T=_-a,o=u(T),k=_<=w;a=_;const R={loaded:_,total:w,progress:w?_/w:void 0,bytes:T,rate:o||void 0,estimated:o&&w&&k?(w-_)/o:void 0,event:f};R[n?"download":"upload"]=!0,e(R)}}const Aq=typeof XMLHttpRequest<"u",Cq=Aq&&function(e){return new Promise(function(a,u){let f=e.data;const _=mc.from(e.headers).normalize();let{responseType:w,withXSRFToken:T}=e,o;function k(){e.cancelToken&&e.cancelToken.unsubscribe(o),e.signal&&e.signal.removeEventListener("abort",o)}let R;if(Zt.isFormData(f)){if(kl.hasStandardBrowserEnv||kl.hasStandardBrowserWebWorkerEnv)_.setContentType(!1);else if((R=_.getContentType())!==!1){const[U,...J]=R?R.split(";").map(X=>X.trim()).filter(Boolean):[];_.setContentType([U||"multipart/form-data",...J].join("; "))}}let F=new XMLHttpRequest;if(e.auth){const U=e.auth.username||"",J=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";_.set("Authorization","Basic "+btoa(U+":"+J))}const B=qL(e.baseURL,e.url);F.open(e.method.toUpperCase(),$L(B,e.params,e.paramsSerializer),!0),F.timeout=e.timeout;function V(){if(!F)return;const U=mc.from("getAllResponseHeaders"in F&&F.getAllResponseHeaders()),X={data:!w||w==="text"||w==="json"?F.responseText:F.response,status:F.status,statusText:F.statusText,headers:U,config:e,request:F};yq(function(Z){a(Z),k()},function(Z){u(Z),k()},X),F=null}if("onloadend"in F?F.onloadend=V:F.onreadystatechange=function(){!F||F.readyState!==4||F.status===0&&!(F.responseURL&&F.responseURL.indexOf("file:")===0)||setTimeout(V)},F.onabort=function(){F&&(u(new Vn("Request aborted",Vn.ECONNABORTED,e,F)),F=null)},F.onerror=function(){u(new Vn("Network Error",Vn.ERR_NETWORK,e,F)),F=null},F.ontimeout=function(){let J=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded";const X=e.transitional||jL;e.timeoutErrorMessage&&(J=e.timeoutErrorMessage),u(new Vn(J,X.clarifyTimeoutError?Vn.ETIMEDOUT:Vn.ECONNABORTED,e,F)),F=null},kl.hasStandardBrowserEnv&&(T&&Zt.isFunction(T)&&(T=T(e)),T||T!==!1&&Tq(B))){const U=e.xsrfHeaderName&&e.xsrfCookieName&&vq.read(e.xsrfCookieName);U&&_.set(e.xsrfHeaderName,U)}f===void 0&&_.setContentType(null),"setRequestHeader"in F&&Zt.forEach(_.toJSON(),function(J,X){F.setRequestHeader(X,J)}),Zt.isUndefined(e.withCredentials)||(F.withCredentials=!!e.withCredentials),w&&w!=="json"&&(F.responseType=e.responseType),typeof e.onDownloadProgress=="function"&&F.addEventListener("progress",GP(e.onDownloadProgress,!0)),typeof e.onUploadProgress=="function"&&F.upload&&F.upload.addEventListener("progress",GP(e.onUploadProgress)),(e.cancelToken||e.signal)&&(o=U=>{F&&(u(!U||U.type?new e_(null,e,F):U),F.abort(),F=null)},e.cancelToken&&e.cancelToken.subscribe(o),e.signal&&(e.signal.aborted?o():e.signal.addEventListener("abort",o)));const G=Eq(B);if(G&&kl.protocols.indexOf(G)===-1){u(new Vn("Unsupported protocol "+G+":",Vn.ERR_BAD_REQUEST,e));return}F.send(f||null)})},pE={http:JW,xhr:Cq};Zt.forEach(pE,(e,n)=>{if(e){try{Object.defineProperty(e,"name",{value:n})}catch{}Object.defineProperty(e,"adapterName",{value:n})}});const HP=e=>`- ${e}`,kq=e=>Zt.isFunction(e)||e===null||e===!1,ZL={getAdapter:e=>{e=Zt.isArray(e)?e:[e];const{length:n}=e;let a,u;const f={};for(let _=0;_<n;_++){a=e[_];let w;if(u=a,!kq(a)&&(u=pE[(w=String(a)).toLowerCase()],u===void 0))throw new Vn(`Unknown adapter '${w}'`);if(u)break;f[w||"#"+_]=u}if(!u){const _=Object.entries(f).map(([T,o])=>`adapter ${T} `+(o===!1?"is not supported by the environment":"is not available in the build"));let w=n?_.length>1?`since :
`+_.map(HP).join(`
`):" "+HP(_[0]):"as no adapter specified";throw new Vn("There is no suitable adapter to dispatch the request "+w,"ERR_NOT_SUPPORT")}return u},adapters:pE};function Zb(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new e_(null,e)}function WP(e){return Zb(e),e.headers=mc.from(e.headers),e.data=qb.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),ZL.getAdapter(e.adapter||nA.adapter)(e).then(function(u){return Zb(e),u.data=qb.call(e,e.transformResponse,u),u.headers=mc.from(u.headers),u},function(u){return WL(u)||(Zb(e),u&&u.response&&(u.response.data=qb.call(e,e.transformResponse,u.response),u.response.headers=mc.from(u.response.headers))),Promise.reject(u)})}const qP=e=>e instanceof mc?{...e}:e;function cp(e,n){n=n||{};const a={};function u(k,R,F){return Zt.isPlainObject(k)&&Zt.isPlainObject(R)?Zt.merge.call({caseless:F},k,R):Zt.isPlainObject(R)?Zt.merge({},R):Zt.isArray(R)?R.slice():R}function f(k,R,F){if(Zt.isUndefined(R)){if(!Zt.isUndefined(k))return u(void 0,k,F)}else return u(k,R,F)}function _(k,R){if(!Zt.isUndefined(R))return u(void 0,R)}function w(k,R){if(Zt.isUndefined(R)){if(!Zt.isUndefined(k))return u(void 0,k)}else return u(void 0,R)}function T(k,R,F){if(F in n)return u(k,R);if(F in e)return u(void 0,k)}const o={url:_,method:_,data:_,baseURL:w,transformRequest:w,transformResponse:w,paramsSerializer:w,timeout:w,timeoutMessage:w,withCredentials:w,withXSRFToken:w,adapter:w,responseType:w,xsrfCookieName:w,xsrfHeaderName:w,onUploadProgress:w,onDownloadProgress:w,decompress:w,maxContentLength:w,maxBodyLength:w,beforeRedirect:w,transport:w,httpAgent:w,httpsAgent:w,cancelToken:w,socketPath:w,responseEncoding:w,validateStatus:T,headers:(k,R)=>f(qP(k),qP(R),!0)};return Zt.forEach(Object.keys(Object.assign({},e,n)),function(R){const F=o[R]||f,B=F(e[R],n[R],R);Zt.isUndefined(B)&&F!==T||(a[R]=B)}),a}const XL="1.6.8",iA={};["object","boolean","number","function","string","symbol"].forEach((e,n)=>{iA[e]=function(u){return typeof u===e||"a"+(n<1?"n ":" ")+e}});const ZP={};iA.transitional=function(n,a,u){function f(_,w){return"[Axios v"+XL+"] Transitional option '"+_+"'"+w+(u?". "+u:"")}return(_,w,T)=>{if(n===!1)throw new Vn(f(w," has been removed"+(a?" in "+a:"")),Vn.ERR_DEPRECATED);return a&&!ZP[w]&&(ZP[w]=!0,console.warn(f(w," has been deprecated since v"+a+" and will be removed in the near future"))),n?n(_,w,T):!0}};function Mq(e,n,a){if(typeof e!="object")throw new Vn("options must be an object",Vn.ERR_BAD_OPTION_VALUE);const u=Object.keys(e);let f=u.length;for(;f-- >0;){const _=u[f],w=n[_];if(w){const T=e[_],o=T===void 0||w(T,_,e);if(o!==!0)throw new Vn("option "+_+" must be "+o,Vn.ERR_BAD_OPTION_VALUE);continue}if(a!==!0)throw new Vn("Unknown option "+_,Vn.ERR_BAD_OPTION)}}const mE={assertOptions:Mq,validators:iA},fu=mE.validators;class O1{constructor(n){this.defaults=n,this.interceptors={request:new $P,response:new $P}}async request(n,a){try{return await this._request(n,a)}catch(u){if(u instanceof Error){let f;Error.captureStackTrace?Error.captureStackTrace(f={}):f=new Error;const _=f.stack?f.stack.replace(/^.+\n/,""):"";u.stack?_&&!String(u.stack).endsWith(_.replace(/^.+\n.+\n/,""))&&(u.stack+=`
`+_):u.stack=_}throw u}}_request(n,a){typeof n=="string"?(a=a||{},a.url=n):a=n||{},a=cp(this.defaults,a);const{transitional:u,paramsSerializer:f,headers:_}=a;u!==void 0&&mE.assertOptions(u,{silentJSONParsing:fu.transitional(fu.boolean),forcedJSONParsing:fu.transitional(fu.boolean),clarifyTimeoutError:fu.transitional(fu.boolean)},!1),f!=null&&(Zt.isFunction(f)?a.paramsSerializer={serialize:f}:mE.assertOptions(f,{encode:fu.function,serialize:fu.function},!0)),a.method=(a.method||this.defaults.method||"get").toLowerCase();let w=_&&Zt.merge(_.common,_[a.method]);_&&Zt.forEach(["delete","get","head","post","put","patch","common"],G=>{delete _[G]}),a.headers=mc.concat(w,_);const T=[];let o=!0;this.interceptors.request.forEach(function(U){typeof U.runWhen=="function"&&U.runWhen(a)===!1||(o=o&&U.synchronous,T.unshift(U.fulfilled,U.rejected))});const k=[];this.interceptors.response.forEach(function(U){k.push(U.fulfilled,U.rejected)});let R,F=0,B;if(!o){const G=[WP.bind(this),void 0];for(G.unshift.apply(G,T),G.push.apply(G,k),B=G.length,R=Promise.resolve(a);F<B;)R=R.then(G[F++],G[F++]);return R}B=T.length;let V=a;for(F=0;F<B;){const G=T[F++],U=T[F++];try{V=G(V)}catch(J){U.call(this,J);break}}try{R=WP.call(this,V)}catch(G){return Promise.reject(G)}for(F=0,B=k.length;F<B;)R=R.then(k[F++],k[F++]);return R}getUri(n){n=cp(this.defaults,n);const a=qL(n.baseURL,n.url);return $L(a,n.params,n.paramsSerializer)}}Zt.forEach(["delete","get","head","options"],function(n){O1.prototype[n]=function(a,u){return this.request(cp(u||{},{method:n,url:a,data:(u||{}).data}))}});Zt.forEach(["post","put","patch"],function(n){function a(u){return function(_,w,T){return this.request(cp(T||{},{method:n,headers:u?{"Content-Type":"multipart/form-data"}:{},url:_,data:w}))}}O1.prototype[n]=a(),O1.prototype[n+"Form"]=a(!0)});const Xy=O1;class aA{constructor(n){if(typeof n!="function")throw new TypeError("executor must be a function.");let a;this.promise=new Promise(function(_){a=_});const u=this;this.promise.then(f=>{if(!u._listeners)return;let _=u._listeners.length;for(;_-- >0;)u._listeners[_](f);u._listeners=null}),this.promise.then=f=>{let _;const w=new Promise(T=>{u.subscribe(T),_=T}).then(f);return w.cancel=function(){u.unsubscribe(_)},w},n(function(_,w,T){u.reason||(u.reason=new e_(_,w,T),a(u.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(n){if(this.reason){n(this.reason);return}this._listeners?this._listeners.push(n):this._listeners=[n]}unsubscribe(n){if(!this._listeners)return;const a=this._listeners.indexOf(n);a!==-1&&this._listeners.splice(a,1)}static source(){let n;return{token:new aA(function(f){n=f}),cancel:n}}}const Iq=aA;function Pq(e){return function(a){return e.apply(null,a)}}function Rq(e){return Zt.isObject(e)&&e.isAxiosError===!0}const gE={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(gE).forEach(([e,n])=>{gE[n]=e});const Dq=gE;function YL(e){const n=new Xy(e),a=IL(Xy.prototype.request,n);return Zt.extend(a,Xy.prototype,n,{allOwnKeys:!0}),Zt.extend(a,n,null,{allOwnKeys:!0}),a.create=function(f){return YL(cp(e,f))},a}const ia=YL(nA);ia.Axios=Xy;ia.CanceledError=e_;ia.CancelToken=Iq;ia.isCancel=WL;ia.VERSION=XL;ia.toFormData=hv;ia.AxiosError=Vn;ia.Cancel=ia.CanceledError;ia.all=function(n){return Promise.all(n)};ia.spread=Pq;ia.isAxiosError=Rq;ia.mergeConfig=cp;ia.AxiosHeaders=mc;ia.formToJSON=e=>HL(Zt.isHTMLForm(e)?new FormData(e):e);ia.getAdapter=ZL.getAdapter;ia.HttpStatusCode=Dq;ia.default=ia;function KL(e){var n,a,u="";if(typeof e=="string"||typeof e=="number")u+=e;else if(typeof e=="object")if(Array.isArray(e)){var f=e.length;for(n=0;n<f;n++)e[n]&&(a=KL(e[n]))&&(u&&(u+=" "),u+=a)}else for(a in e)e[a]&&(u&&(u+=" "),u+=a);return u}function Fq(){for(var e,n,a=0,u="",f=arguments.length;a<f;a++)(e=arguments[a])&&(n=KL(e))&&(u&&(u+=" "),u+=n);return u}const sA="-";function Lq(e){const n=Nq(e),{conflictingClassGroups:a,conflictingClassGroupModifiers:u}=e;function f(w){const T=w.split(sA);return T[0]===""&&T.length!==1&&T.shift(),JL(T,n)||Oq(w)}function _(w,T){const o=a[w]||[];return T&&u[w]?[...o,...u[w]]:o}return{getClassGroupId:f,getConflictingClassGroupIds:_}}function JL(e,n){var w;if(e.length===0)return n.classGroupId;const a=e[0],u=n.nextPart.get(a),f=u?JL(e.slice(1),u):void 0;if(f)return f;if(n.validators.length===0)return;const _=e.join(sA);return(w=n.validators.find(({validator:T})=>T(_)))==null?void 0:w.classGroupId}const XP=/^\[(.+)\]$/;function Oq(e){if(XP.test(e)){const n=XP.exec(e)[1],a=n==null?void 0:n.substring(0,n.indexOf(":"));if(a)return"arbitrary.."+a}}function Nq(e){const{theme:n,prefix:a}=e,u={nextPart:new Map,validators:[]};return Bq(Object.entries(e.classGroups),a).forEach(([_,w])=>{_E(w,u,_,n)}),u}function _E(e,n,a,u){e.forEach(f=>{if(typeof f=="string"){const _=f===""?n:YP(n,f);_.classGroupId=a;return}if(typeof f=="function"){if(zq(f)){_E(f(u),n,a,u);return}n.validators.push({validator:f,classGroupId:a});return}Object.entries(f).forEach(([_,w])=>{_E(w,YP(n,_),a,u)})})}function YP(e,n){let a=e;return n.split(sA).forEach(u=>{a.nextPart.has(u)||a.nextPart.set(u,{nextPart:new Map,validators:[]}),a=a.nextPart.get(u)}),a}function zq(e){return e.isThemeGetter}function Bq(e,n){return n?e.map(([a,u])=>{const f=u.map(_=>typeof _=="string"?n+_:typeof _=="object"?Object.fromEntries(Object.entries(_).map(([w,T])=>[n+w,T])):_);return[a,f]}):e}function Uq(e){if(e<1)return{get:()=>{},set:()=>{}};let n=0,a=new Map,u=new Map;function f(_,w){a.set(_,w),n++,n>e&&(n=0,u=a,a=new Map)}return{get(_){let w=a.get(_);if(w!==void 0)return w;if((w=u.get(_))!==void 0)return f(_,w),w},set(_,w){a.has(_)?a.set(_,w):f(_,w)}}}const QL="!";function Vq(e){const n=e.separator,a=n.length===1,u=n[0],f=n.length;return function(w){const T=[];let o=0,k=0,R;for(let U=0;U<w.length;U++){let J=w[U];if(o===0){if(J===u&&(a||w.slice(U,U+f)===n)){T.push(w.slice(k,U)),k=U+f;continue}if(J==="/"){R=U;continue}}J==="["?o++:J==="]"&&o--}const F=T.length===0?w:w.substring(k),B=F.startsWith(QL),V=B?F.substring(1):F,G=R&&R>k?R-k:void 0;return{modifiers:T,hasImportantModifier:B,baseClassName:V,maybePostfixModifierPosition:G}}}function $q(e){if(e.length<=1)return e;const n=[];let a=[];return e.forEach(u=>{u[0]==="["?(n.push(...a.sort(),u),a=[]):a.push(u)}),n.push(...a.sort()),n}function jq(e){return{cache:Uq(e.cacheSize),splitModifiers:Vq(e),...Lq(e)}}const Gq=/\s+/;function Hq(e,n){const{splitModifiers:a,getClassGroupId:u,getConflictingClassGroupIds:f}=n,_=new Set;return e.trim().split(Gq).map(w=>{const{modifiers:T,hasImportantModifier:o,baseClassName:k,maybePostfixModifierPosition:R}=a(w);let F=u(R?k.substring(0,R):k),B=!!R;if(!F){if(!R)return{isTailwindClass:!1,originalClassName:w};if(F=u(k),!F)return{isTailwindClass:!1,originalClassName:w};B=!1}const V=$q(T).join(":");return{isTailwindClass:!0,modifierId:o?V+QL:V,classGroupId:F,originalClassName:w,hasPostfixModifier:B}}).reverse().filter(w=>{if(!w.isTailwindClass)return!0;const{modifierId:T,classGroupId:o,hasPostfixModifier:k}=w,R=T+o;return _.has(R)?!1:(_.add(R),f(o,k).forEach(F=>_.add(T+F)),!0)}).reverse().map(w=>w.originalClassName).join(" ")}function Wq(){let e=0,n,a,u="";for(;e<arguments.length;)(n=arguments[e++])&&(a=eO(n))&&(u&&(u+=" "),u+=a);return u}function eO(e){if(typeof e=="string")return e;let n,a="";for(let u=0;u<e.length;u++)e[u]&&(n=eO(e[u]))&&(a&&(a+=" "),a+=n);return a}function qq(e,...n){let a,u,f,_=w;function w(o){const k=n.reduce((R,F)=>F(R),e());return a=jq(k),u=a.cache.get,f=a.cache.set,_=T,T(o)}function T(o){const k=u(o);if(k)return k;const R=Hq(o,a);return f(o,R),R}return function(){return _(Wq.apply(null,arguments))}}function yi(e){const n=a=>a[e]||[];return n.isThemeGetter=!0,n}const tO=/^\[(?:([a-z-]+):)?(.+)\]$/i,Zq=/^\d+\/\d+$/,Xq=new Set(["px","full","screen"]),Yq=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,Kq=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Jq=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,Qq=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,eZ=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/;function sc(e){return Xh(e)||Xq.has(e)||Zq.test(e)}function du(e){return vp(e,"length",lZ)}function Xh(e){return!!e&&!Number.isNaN(Number(e))}function Ty(e){return vp(e,"number",Xh)}function Rm(e){return!!e&&Number.isInteger(Number(e))}function tZ(e){return e.endsWith("%")&&Xh(e.slice(0,-1))}function Sn(e){return tO.test(e)}function pu(e){return Yq.test(e)}const rZ=new Set(["length","size","percentage"]);function nZ(e){return vp(e,rZ,rO)}function iZ(e){return vp(e,"position",rO)}const aZ=new Set(["image","url"]);function sZ(e){return vp(e,aZ,uZ)}function oZ(e){return vp(e,"",cZ)}function Dm(){return!0}function vp(e,n,a){const u=tO.exec(e);return u?u[1]?typeof n=="string"?u[1]===n:n.has(u[1]):a(u[2]):!1}function lZ(e){return Kq.test(e)&&!Jq.test(e)}function rO(){return!1}function cZ(e){return Qq.test(e)}function uZ(e){return eZ.test(e)}function hZ(){const e=yi("colors"),n=yi("spacing"),a=yi("blur"),u=yi("brightness"),f=yi("borderColor"),_=yi("borderRadius"),w=yi("borderSpacing"),T=yi("borderWidth"),o=yi("contrast"),k=yi("grayscale"),R=yi("hueRotate"),F=yi("invert"),B=yi("gap"),V=yi("gradientColorStops"),G=yi("gradientColorStopPositions"),U=yi("inset"),J=yi("margin"),X=yi("opacity"),Y=yi("padding"),Z=yi("saturate"),_e=yi("scale"),ke=yi("sepia"),Ae=yi("skew"),me=yi("space"),De=yi("translate"),we=()=>["auto","contain","none"],Je=()=>["auto","hidden","clip","visible","scroll"],rt=()=>["auto",Sn,n],Re=()=>[Sn,n],St=()=>["",sc,du],Lt=()=>["auto",Xh,Sn],We=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],qt=()=>["solid","dashed","dotted","double","none"],Ot=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity","plus-lighter"],st=()=>["start","end","center","between","around","evenly","stretch"],Ve=()=>["","0",Sn],Et=()=>["auto","avoid","all","avoid-page","page","left","right","column"],Dt=()=>[Xh,Ty],Se=()=>[Xh,Sn];return{cacheSize:500,separator:":",theme:{colors:[Dm],spacing:[sc,du],blur:["none","",pu,Sn],brightness:Dt(),borderColor:[e],borderRadius:["none","","full",pu,Sn],borderSpacing:Re(),borderWidth:St(),contrast:Dt(),grayscale:Ve(),hueRotate:Se(),invert:Ve(),gap:Re(),gradientColorStops:[e],gradientColorStopPositions:[tZ,du],inset:rt(),margin:rt(),opacity:Dt(),padding:Re(),saturate:Dt(),scale:Dt(),sepia:Ve(),skew:Se(),space:Re(),translate:Re()},classGroups:{aspect:[{aspect:["auto","square","video",Sn]}],container:["container"],columns:[{columns:[pu]}],"break-after":[{"break-after":Et()}],"break-before":[{"break-before":Et()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...We(),Sn]}],overflow:[{overflow:Je()}],"overflow-x":[{"overflow-x":Je()}],"overflow-y":[{"overflow-y":Je()}],overscroll:[{overscroll:we()}],"overscroll-x":[{"overscroll-x":we()}],"overscroll-y":[{"overscroll-y":we()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[U]}],"inset-x":[{"inset-x":[U]}],"inset-y":[{"inset-y":[U]}],start:[{start:[U]}],end:[{end:[U]}],top:[{top:[U]}],right:[{right:[U]}],bottom:[{bottom:[U]}],left:[{left:[U]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Rm,Sn]}],basis:[{basis:rt()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",Sn]}],grow:[{grow:Ve()}],shrink:[{shrink:Ve()}],order:[{order:["first","last","none",Rm,Sn]}],"grid-cols":[{"grid-cols":[Dm]}],"col-start-end":[{col:["auto",{span:["full",Rm,Sn]},Sn]}],"col-start":[{"col-start":Lt()}],"col-end":[{"col-end":Lt()}],"grid-rows":[{"grid-rows":[Dm]}],"row-start-end":[{row:["auto",{span:[Rm,Sn]},Sn]}],"row-start":[{"row-start":Lt()}],"row-end":[{"row-end":Lt()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",Sn]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",Sn]}],gap:[{gap:[B]}],"gap-x":[{"gap-x":[B]}],"gap-y":[{"gap-y":[B]}],"justify-content":[{justify:["normal",...st()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...st(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...st(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[Y]}],px:[{px:[Y]}],py:[{py:[Y]}],ps:[{ps:[Y]}],pe:[{pe:[Y]}],pt:[{pt:[Y]}],pr:[{pr:[Y]}],pb:[{pb:[Y]}],pl:[{pl:[Y]}],m:[{m:[J]}],mx:[{mx:[J]}],my:[{my:[J]}],ms:[{ms:[J]}],me:[{me:[J]}],mt:[{mt:[J]}],mr:[{mr:[J]}],mb:[{mb:[J]}],ml:[{ml:[J]}],"space-x":[{"space-x":[me]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[me]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",Sn,n]}],"min-w":[{"min-w":[Sn,n,"min","max","fit"]}],"max-w":[{"max-w":[Sn,n,"none","full","min","max","fit","prose",{screen:[pu]},pu]}],h:[{h:[Sn,n,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[Sn,n,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[Sn,n,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[Sn,n,"auto","min","max","fit"]}],"font-size":[{text:["base",pu,du]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",Ty]}],"font-family":[{font:[Dm]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractons"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",Sn]}],"line-clamp":[{"line-clamp":["none",Xh,Ty]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",sc,Sn]}],"list-image":[{"list-image":["none",Sn]}],"list-style-type":[{list:["none","disc","decimal",Sn]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[e]}],"placeholder-opacity":[{"placeholder-opacity":[X]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[e]}],"text-opacity":[{"text-opacity":[X]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...qt(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",sc,du]}],"underline-offset":[{"underline-offset":["auto",sc,Sn]}],"text-decoration-color":[{decoration:[e]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:Re()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Sn]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Sn]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[X]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...We(),iZ]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",nZ]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},sZ]}],"bg-color":[{bg:[e]}],"gradient-from-pos":[{from:[G]}],"gradient-via-pos":[{via:[G]}],"gradient-to-pos":[{to:[G]}],"gradient-from":[{from:[V]}],"gradient-via":[{via:[V]}],"gradient-to":[{to:[V]}],rounded:[{rounded:[_]}],"rounded-s":[{"rounded-s":[_]}],"rounded-e":[{"rounded-e":[_]}],"rounded-t":[{"rounded-t":[_]}],"rounded-r":[{"rounded-r":[_]}],"rounded-b":[{"rounded-b":[_]}],"rounded-l":[{"rounded-l":[_]}],"rounded-ss":[{"rounded-ss":[_]}],"rounded-se":[{"rounded-se":[_]}],"rounded-ee":[{"rounded-ee":[_]}],"rounded-es":[{"rounded-es":[_]}],"rounded-tl":[{"rounded-tl":[_]}],"rounded-tr":[{"rounded-tr":[_]}],"rounded-br":[{"rounded-br":[_]}],"rounded-bl":[{"rounded-bl":[_]}],"border-w":[{border:[T]}],"border-w-x":[{"border-x":[T]}],"border-w-y":[{"border-y":[T]}],"border-w-s":[{"border-s":[T]}],"border-w-e":[{"border-e":[T]}],"border-w-t":[{"border-t":[T]}],"border-w-r":[{"border-r":[T]}],"border-w-b":[{"border-b":[T]}],"border-w-l":[{"border-l":[T]}],"border-opacity":[{"border-opacity":[X]}],"border-style":[{border:[...qt(),"hidden"]}],"divide-x":[{"divide-x":[T]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[T]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[X]}],"divide-style":[{divide:qt()}],"border-color":[{border:[f]}],"border-color-x":[{"border-x":[f]}],"border-color-y":[{"border-y":[f]}],"border-color-t":[{"border-t":[f]}],"border-color-r":[{"border-r":[f]}],"border-color-b":[{"border-b":[f]}],"border-color-l":[{"border-l":[f]}],"divide-color":[{divide:[f]}],"outline-style":[{outline:["",...qt()]}],"outline-offset":[{"outline-offset":[sc,Sn]}],"outline-w":[{outline:[sc,du]}],"outline-color":[{outline:[e]}],"ring-w":[{ring:St()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[e]}],"ring-opacity":[{"ring-opacity":[X]}],"ring-offset-w":[{"ring-offset":[sc,du]}],"ring-offset-color":[{"ring-offset":[e]}],shadow:[{shadow:["","inner","none",pu,oZ]}],"shadow-color":[{shadow:[Dm]}],opacity:[{opacity:[X]}],"mix-blend":[{"mix-blend":Ot()}],"bg-blend":[{"bg-blend":Ot()}],filter:[{filter:["","none"]}],blur:[{blur:[a]}],brightness:[{brightness:[u]}],contrast:[{contrast:[o]}],"drop-shadow":[{"drop-shadow":["","none",pu,Sn]}],grayscale:[{grayscale:[k]}],"hue-rotate":[{"hue-rotate":[R]}],invert:[{invert:[F]}],saturate:[{saturate:[Z]}],sepia:[{sepia:[ke]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[a]}],"backdrop-brightness":[{"backdrop-brightness":[u]}],"backdrop-contrast":[{"backdrop-contrast":[o]}],"backdrop-grayscale":[{"backdrop-grayscale":[k]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[R]}],"backdrop-invert":[{"backdrop-invert":[F]}],"backdrop-opacity":[{"backdrop-opacity":[X]}],"backdrop-saturate":[{"backdrop-saturate":[Z]}],"backdrop-sepia":[{"backdrop-sepia":[ke]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[w]}],"border-spacing-x":[{"border-spacing-x":[w]}],"border-spacing-y":[{"border-spacing-y":[w]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",Sn]}],duration:[{duration:Se()}],ease:[{ease:["linear","in","out","in-out",Sn]}],delay:[{delay:Se()}],animate:[{animate:["none","spin","ping","pulse","bounce",Sn]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[_e]}],"scale-x":[{"scale-x":[_e]}],"scale-y":[{"scale-y":[_e]}],rotate:[{rotate:[Rm,Sn]}],"translate-x":[{"translate-x":[De]}],"translate-y":[{"translate-y":[De]}],"skew-x":[{"skew-x":[Ae]}],"skew-y":[{"skew-y":[Ae]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",Sn]}],accent:[{accent:["auto",e]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Sn]}],"caret-color":[{caret:[e]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":Re()}],"scroll-mx":[{"scroll-mx":Re()}],"scroll-my":[{"scroll-my":Re()}],"scroll-ms":[{"scroll-ms":Re()}],"scroll-me":[{"scroll-me":Re()}],"scroll-mt":[{"scroll-mt":Re()}],"scroll-mr":[{"scroll-mr":Re()}],"scroll-mb":[{"scroll-mb":Re()}],"scroll-ml":[{"scroll-ml":Re()}],"scroll-p":[{"scroll-p":Re()}],"scroll-px":[{"scroll-px":Re()}],"scroll-py":[{"scroll-py":Re()}],"scroll-ps":[{"scroll-ps":Re()}],"scroll-pe":[{"scroll-pe":Re()}],"scroll-pt":[{"scroll-pt":Re()}],"scroll-pr":[{"scroll-pr":Re()}],"scroll-pb":[{"scroll-pb":Re()}],"scroll-pl":[{"scroll-pl":Re()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Sn]}],fill:[{fill:[e,"none"]}],"stroke-w":[{stroke:[sc,du,Ty]}],stroke:[{stroke:[e,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}}const fZ=qq(hZ);function ws(...e){return fZ(Fq(e))}const dZ=e=>{let n=0;for(let u=0;u<e.length;u++)n=e.charCodeAt(1)+((n<<5)-n);let a="#";for(let u=0;u<3;u++){const f=n>>u*8&255;a+=("00"+f.toString(16)).substr(-2)}return a},pZ=({data:e,setData:n,legend:a,setkmlData:u,setXlsData:f,map:_})=>{const w=R=>{const F=/(\d+)\s*°\s*(\d+)\s*'\s*(\d+(?:\.\d+)?)\s*"/,B=R.match(F);if(!B)return console.error("Invalid DMS string:",R),NaN;const V=parseInt(B[1],10),G=parseInt(B[2],10),U=parseFloat(B[3]);return V+G/60+U/3600},T=(R,F)=>{const B=w(R);return isNaN(B)?(console.error("Invalid DMS string:",R),NaN):F==="S"||F==="W"?-B:B},o=R=>{let F=R.trim().split("  ");const[B,V]=F.map(Ae=>parseFloat(Ae.trim().substring(0,Ae.length-2)));if(!isNaN(B)&&!isNaN(V))return[V,B];const G=/(\d+°\s*\d+'\s*\d+(?:\.\d+)?"\s*[NS])\s+(\d+°\s*\d+'\s*\d+(?:\.\d+)?"\s*[EW])/,U=R.match(G);if(!U)return console.error("Invalid GR string:",R),[NaN,NaN];const J=U[1],X=U[2],Y=J.slice(-1),Z=X.slice(-1),_e=T(J,Y);return[T(X,Z),_e]},k=R=>{var V;const F=(V=R.target.files)==null?void 0:V[0];if(!F)return;const B=new FileReader;B.onload=G=>{if(!G.target||!G.target.result)return;const U=new Uint8Array(G.target.result),X=uE(U,{type:"array"}).Sheets["Int Main Sheet"],Y=ke=>ke.map(Ae=>{const me={};for(const De in Ae)De==="Police Station"?me.PoliceStation=Ae[De]:De==="Area Committee"?me.AreaCommittee=Ae[De]:De==="Int Unique No"?me.IntUniqueNo=Ae[De]:De==="Int Content"?me.IntContent=Ae[De]:De==="...."?me.Date=Ae[De]:me[De]=Ae[De];return me}),Z=_W.sheet_to_json(X),_e=Y(Z);n(_e),f(_e)},B.onerror=G=>{console.error("Error reading file:",G)},B.readAsArrayBuffer(F)};return Ie.useEffect(()=>{const R=[],F=()=>{u(V=>[]);const B=new tg.LngLatBounds;e.forEach(V=>{if(V.GR&&V.GR.length>0){const G=o(V.GR);if(!isNaN(G[0])&&!isNaN(G[1])){const U=document.createElement("div");U.className="marker";const J=document.createElement("div");J.className="marker-icon",U.appendChild(J),J.style.backgroundRepeat="no-repeat";const X=document.createElement("div");X.className="marker-info",X.innerHTML=`<h3>${V[a]}</h3>`,X.style.backgroundColor=dZ(V.Name_),X.style.position="absolute",X.style.left="0",X.style.maxWidth="200px",X.style.color="#333",X.style.padding="6px",X.style.borderRadius="6px",X.style.width="max-content",X.style.fontSize="12px",X.style.boxShadow="0 0 4px rgba(0, 0, 0, 0.05)",U.appendChild(X);const Y=new tg.Popup({offset:25}).setHTML(`<h3>${V.IntContent}</h3>`),Z=new tg.Marker({element:U}).setLngLat(G).setPopup(Y).addTo(_.current);R.push(Z),B.extend(G);const _e={name:V[a],longitude:G[0],latitude:G[1]};u(ke=>[...ke,_e])}}}),_.current.fitBounds(B,{padding:50})};return e.length!==0&&(console.log(e),F()),()=>{R.forEach(B=>{B.remove()})}},[e,a]),Ie.useEffect(()=>{(async()=>{const B=(await ia.get("https://sheetdb.io/api/v1/1s3s2lkndkhr4?sheet=Int%20Main%20Sheet")).data.map(V=>({Date:V.Date,IntContent:V["Int Content"],Name:V.Name,Name_:V.Name_,IntUniqueNo:parseInt(V["Int Unique No"]),GR:V.GR,Strength:parseInt(V.Strength),Source:V.Source,Type:V.Type,Rank:V.Rank,AreaCommittee:V["Area Committee"],District:V.District,PoliceStation:V["Police Station"],Division:V.Division,Week:parseInt(V.Week),Month:parseInt(V.Month)}));n(B),f(B)})()},[]),Lr.jsxs(Lr.Fragment,{children:[Lr.jsx("label",{htmlFor:"xls-file",className:"absolute hidden top-4 left-4 p-2 px-3 z-10 bg-blue-500 text-white rounded",children:"Import Excel"}),Lr.jsx("input",{id:"xls-file",type:"file",onChange:k,className:"hidden"})]})};var nO={exports:{}};(function(e,n){(function(a,u){u()})(kd,function(){function a(k,R){return typeof R>"u"?R={autoBom:!1}:typeof R!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),R={autoBom:!R}),R.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(k.type)?new Blob(["\uFEFF",k],{type:k.type}):k}function u(k,R,F){var B=new XMLHttpRequest;B.open("GET",k),B.responseType="blob",B.onload=function(){o(B.response,R,F)},B.onerror=function(){console.error("could not download file")},B.send()}function f(k){var R=new XMLHttpRequest;R.open("HEAD",k,!1);try{R.send()}catch{}return 200<=R.status&&299>=R.status}function _(k){try{k.dispatchEvent(new MouseEvent("click"))}catch{var R=document.createEvent("MouseEvents");R.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),k.dispatchEvent(R)}}var w=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof kd=="object"&&kd.global===kd?kd:void 0,T=w.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),o=w.saveAs||(typeof window!="object"||window!==w?function(){}:"download"in HTMLAnchorElement.prototype&&!T?function(k,R,F){var B=w.URL||w.webkitURL,V=document.createElement("a");R=R||k.name||"download",V.download=R,V.rel="noopener",typeof k=="string"?(V.href=k,V.origin===location.origin?_(V):f(V.href)?u(k,R,F):_(V,V.target="_blank")):(V.href=B.createObjectURL(k),setTimeout(function(){B.revokeObjectURL(V.href)},4e4),setTimeout(function(){_(V)},0))}:"msSaveOrOpenBlob"in navigator?function(k,R,F){if(R=R||k.name||"download",typeof k!="string")navigator.msSaveOrOpenBlob(a(k,F),R);else if(f(k))u(k,R,F);else{var B=document.createElement("a");B.href=k,B.target="_blank",setTimeout(function(){_(B)})}}:function(k,R,F,B){if(B=B||open("","_blank"),B&&(B.document.title=B.document.body.innerText="downloading..."),typeof k=="string")return u(k,R,F);var V=k.type==="application/octet-stream",G=/constructor/i.test(w.HTMLElement)||w.safari,U=/CriOS\/[\d]+/.test(navigator.userAgent);if((U||V&&G||T)&&typeof FileReader<"u"){var J=new FileReader;J.onloadend=function(){var Z=J.result;Z=U?Z:Z.replace(/^data:[^;]*;/,"data:attachment/file;"),B?B.location.href=Z:location=Z,B=null},J.readAsDataURL(k)}else{var X=w.URL||w.webkitURL,Y=X.createObjectURL(k);B?B.location=Y:location.href=Y,B=null,setTimeout(function(){X.revokeObjectURL(Y)},4e4)}});w.saveAs=o.saveAs=o,e.exports=o})})(nO);var mZ=nO.exports;const gZ=({kmlData:e})=>{const n=()=>{const u=a(e),f=new Blob([u],{type:"text/plain;charset=utf-8"});mZ.saveAs(f,"markers.kml")},a=u=>{let f=`<?xml version="1.0" encoding="UTF-8"?>
          <kml xmlns="http://www.opengis.net/kml/2.2">
          <Document>
          `;return u.forEach(_=>{const{longitude:w,latitude:T,name:o}=_;f+=`
            <Placemark>
              <name>${o}</name>
              <Point>
                <coordinates>${w},${T}</coordinates>
              </Point>
            </Placemark>
          `}),f+=`
          </Document>
          </kml>
        `,f};return Lr.jsx("button",{onClick:n,className:"bg-orange-500 text-white p-2 px-3 absolute z-10 right-4 top-4 rounded-md",children:"Generate KML"})};function vn(){return vn=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var u in a)Object.prototype.hasOwnProperty.call(a,u)&&(e[u]=a[u])}return e},vn.apply(this,arguments)}function _Z(e,n){typeof e=="function"?e(n):e!=null&&(e.current=n)}function dv(...e){return n=>e.forEach(a=>_Z(a,n))}function qs(...e){return Ie.useCallback(dv(...e),e)}const up=Ie.forwardRef((e,n)=>{const{children:a,...u}=e,f=Ie.Children.toArray(a),_=f.find(yZ);if(_){const w=_.props.children,T=f.map(o=>o===_?Ie.Children.count(w)>1?Ie.Children.only(null):Ie.isValidElement(w)?w.props.children:null:o);return Ie.createElement(xE,vn({},u,{ref:n}),Ie.isValidElement(w)?Ie.cloneElement(w,void 0,T):null)}return Ie.createElement(xE,vn({},u,{ref:n}),a)});up.displayName="Slot";const xE=Ie.forwardRef((e,n)=>{const{children:a,...u}=e;return Ie.isValidElement(a)?Ie.cloneElement(a,{...vZ(u,a.props),ref:n?dv(n,a.ref):a.ref}):Ie.Children.count(a)>1?Ie.Children.only(null):null});xE.displayName="SlotClone";const xZ=({children:e})=>Ie.createElement(Ie.Fragment,null,e);function yZ(e){return Ie.isValidElement(e)&&e.type===xZ}function vZ(e,n){const a={...n};for(const u in n){const f=e[u],_=n[u];/^on[A-Z]/.test(u)?f&&_?a[u]=(...T)=>{_(...T),f(...T)}:f&&(a[u]=f):u==="style"?a[u]={...f,..._}:u==="className"&&(a[u]=[f,_].filter(Boolean).join(" "))}return{...e,...a}}function iO(e){var n,a,u="";if(typeof e=="string"||typeof e=="number")u+=e;else if(typeof e=="object")if(Array.isArray(e))for(n=0;n<e.length;n++)e[n]&&(a=iO(e[n]))&&(u&&(u+=" "),u+=a);else for(n in e)e[n]&&(u&&(u+=" "),u+=n);return u}function wZ(){for(var e,n,a=0,u="";a<arguments.length;)(e=arguments[a++])&&(n=iO(e))&&(u&&(u+=" "),u+=n);return u}const KP=e=>typeof e=="boolean"?"".concat(e):e===0?"0":e,JP=wZ,bZ=(e,n)=>a=>{var u;if((n==null?void 0:n.variants)==null)return JP(e,a==null?void 0:a.class,a==null?void 0:a.className);const{variants:f,defaultVariants:_}=n,w=Object.keys(f).map(k=>{const R=a==null?void 0:a[k],F=_==null?void 0:_[k];if(R===null)return null;const B=KP(R)||KP(F);return f[k][B]}),T=a&&Object.entries(a).reduce((k,R)=>{let[F,B]=R;return B===void 0||(k[F]=B),k},{}),o=n==null||(u=n.compoundVariants)===null||u===void 0?void 0:u.reduce((k,R)=>{let{class:F,className:B,...V}=R;return Object.entries(V).every(G=>{let[U,J]=G;return Array.isArray(J)?J.includes({..._,...T}[U]):{..._,...T}[U]===J})?[...k,F,B]:k},[]);return JP(e,w,o,a==null?void 0:a.class,a==null?void 0:a.className)},TZ=bZ("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline",primary:"bg-blue-600 hover:bg-opacity-90 text-white",dropDown:"border border-slate-400 rounded-md"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),Yy=Ie.forwardRef(({className:e,variant:n,size:a,asChild:u=!1,...f},_)=>{const w=u?up:"button";return Lr.jsx(w,{className:ws(TZ({variant:n,size:a,className:e})),ref:_,...f})});Yy.displayName="Button";const aO=Ie.forwardRef(({className:e,type:n,...a},u)=>Lr.jsx("input",{type:n,className:ws("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:u,...a}));aO.displayName="Input";const EZ=({id:e,label:n,value:a,onChange:u,suggestions:f})=>{const[_,w]=Ie.useState(!1),[T,o]=Ie.useState([]),k=F=>{const B=F.target.value;u(B);const V=f.filter(G=>G.toLowerCase().includes(B.toLowerCase()));o(V),w(!0)},R=F=>{u(F),w(!1)};return Lr.jsxs("div",{className:"relative",children:[Lr.jsx("label",{htmlFor:e,children:n}),Lr.jsx(aO,{id:e,onChange:k,value:a,className:"border-slate-300"}),_&&T.length>0&&Lr.jsx("ul",{className:"absolute z-10 mt-1 w-full bg-white border border-gray-300 rounded-md shadow-lg",children:T.map(F=>Lr.jsx("li",{className:"px-4 py-2 cursor-pointer hover:bg-gray-200",onClick:()=>R(F),children:F},F))})]})};function Gn(e,n,{checkForDefaultPrevented:a=!0}={}){return function(f){if(e==null||e(f),a===!1||!f.defaultPrevented)return n==null?void 0:n(f)}}function t_(e,n=[]){let a=[];function u(_,w){const T=Ie.createContext(w),o=a.length;a=[...a,w];function k(F){const{scope:B,children:V,...G}=F,U=(B==null?void 0:B[e][o])||T,J=Ie.useMemo(()=>G,Object.values(G));return Ie.createElement(U.Provider,{value:J},V)}function R(F,B){const V=(B==null?void 0:B[e][o])||T,G=Ie.useContext(V);if(G)return G;if(w!==void 0)return w;throw new Error(`\`${F}\` must be used within \`${_}\``)}return k.displayName=_+"Provider",[k,R]}const f=()=>{const _=a.map(w=>Ie.createContext(w));return function(T){const o=(T==null?void 0:T[e])||_;return Ie.useMemo(()=>({[`__scope${e}`]:{...T,[e]:o}}),[T,o])}};return f.scopeName=e,[u,SZ(f,...n)]}function SZ(...e){const n=e[0];if(e.length===1)return n;const a=()=>{const u=e.map(f=>({useScope:f(),scopeName:f.scopeName}));return function(_){const w=u.reduce((T,{useScope:o,scopeName:k})=>{const F=o(_)[`__scope${k}`];return{...T,...F}},{});return Ie.useMemo(()=>({[`__scope${n.scopeName}`]:w}),[w])}};return a.scopeName=n.scopeName,a}function Rl(e){const n=Ie.useRef(e);return Ie.useEffect(()=>{n.current=e}),Ie.useMemo(()=>(...a)=>{var u;return(u=n.current)===null||u===void 0?void 0:u.call(n,...a)},[])}function sO({prop:e,defaultProp:n,onChange:a=()=>{}}){const[u,f]=AZ({defaultProp:n,onChange:a}),_=e!==void 0,w=_?e:u,T=Rl(a),o=Ie.useCallback(k=>{if(_){const F=typeof k=="function"?k(e):k;F!==e&&T(F)}else f(k)},[_,e,f,T]);return[w,o]}function AZ({defaultProp:e,onChange:n}){const a=Ie.useState(e),[u]=a,f=Ie.useRef(u),_=Rl(n);return Ie.useEffect(()=>{f.current!==u&&(_(u),f.current=u)},[u,f,_]),a}const CZ=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],_o=CZ.reduce((e,n)=>{const a=Ie.forwardRef((u,f)=>{const{asChild:_,...w}=u,T=_?up:n;return Ie.useEffect(()=>{window[Symbol.for("radix-ui")]=!0},[]),Ie.createElement(T,vn({},w,{ref:f}))});return a.displayName=`Primitive.${n}`,{...e,[n]:a}},{});function oO(e,n){e&&Wg.flushSync(()=>e.dispatchEvent(n))}function lO(e){const n=e+"CollectionProvider",[a,u]=t_(n),[f,_]=a(n,{collectionRef:{current:null},itemMap:new Map}),w=V=>{const{scope:G,children:U}=V,J=dr.useRef(null),X=dr.useRef(new Map).current;return dr.createElement(f,{scope:G,itemMap:X,collectionRef:J},U)},T=e+"CollectionSlot",o=dr.forwardRef((V,G)=>{const{scope:U,children:J}=V,X=_(T,U),Y=qs(G,X.collectionRef);return dr.createElement(up,{ref:Y},J)}),k=e+"CollectionItemSlot",R="data-radix-collection-item",F=dr.forwardRef((V,G)=>{const{scope:U,children:J,...X}=V,Y=dr.useRef(null),Z=qs(G,Y),_e=_(k,U);return dr.useEffect(()=>(_e.itemMap.set(Y,{ref:Y,...X}),()=>void _e.itemMap.delete(Y))),dr.createElement(up,{[R]:"",ref:Z},J)});function B(V){const G=_(e+"CollectionConsumer",V);return dr.useCallback(()=>{const J=G.collectionRef.current;if(!J)return[];const X=Array.from(J.querySelectorAll(`[${R}]`));return Array.from(G.itemMap.values()).sort((_e,ke)=>X.indexOf(_e.ref.current)-X.indexOf(ke.ref.current))},[G.collectionRef,G.itemMap])}return[{Provider:w,Slot:o,ItemSlot:F},B,u]}const kZ=Ie.createContext(void 0);function cO(e){const n=Ie.useContext(kZ);return e||n||"ltr"}function MZ(e,n=globalThis==null?void 0:globalThis.document){const a=Rl(e);Ie.useEffect(()=>{const u=f=>{f.key==="Escape"&&a(f)};return n.addEventListener("keydown",u),()=>n.removeEventListener("keydown",u)},[a,n])}const yE="dismissableLayer.update",IZ="dismissableLayer.pointerDownOutside",PZ="dismissableLayer.focusOutside";let QP;const RZ=Ie.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),DZ=Ie.forwardRef((e,n)=>{var a;const{disableOutsidePointerEvents:u=!1,onEscapeKeyDown:f,onPointerDownOutside:_,onFocusOutside:w,onInteractOutside:T,onDismiss:o,...k}=e,R=Ie.useContext(RZ),[F,B]=Ie.useState(null),V=(a=F==null?void 0:F.ownerDocument)!==null&&a!==void 0?a:globalThis==null?void 0:globalThis.document,[,G]=Ie.useState({}),U=qs(n,De=>B(De)),J=Array.from(R.layers),[X]=[...R.layersWithOutsidePointerEventsDisabled].slice(-1),Y=J.indexOf(X),Z=F?J.indexOf(F):-1,_e=R.layersWithOutsidePointerEventsDisabled.size>0,ke=Z>=Y,Ae=FZ(De=>{const we=De.target,Je=[...R.branches].some(rt=>rt.contains(we));!ke||Je||(_==null||_(De),T==null||T(De),De.defaultPrevented||o==null||o())},V),me=LZ(De=>{const we=De.target;[...R.branches].some(rt=>rt.contains(we))||(w==null||w(De),T==null||T(De),De.defaultPrevented||o==null||o())},V);return MZ(De=>{Z===R.layers.size-1&&(f==null||f(De),!De.defaultPrevented&&o&&(De.preventDefault(),o()))},V),Ie.useEffect(()=>{if(F)return u&&(R.layersWithOutsidePointerEventsDisabled.size===0&&(QP=V.body.style.pointerEvents,V.body.style.pointerEvents="none"),R.layersWithOutsidePointerEventsDisabled.add(F)),R.layers.add(F),e4(),()=>{u&&R.layersWithOutsidePointerEventsDisabled.size===1&&(V.body.style.pointerEvents=QP)}},[F,V,u,R]),Ie.useEffect(()=>()=>{F&&(R.layers.delete(F),R.layersWithOutsidePointerEventsDisabled.delete(F),e4())},[F,R]),Ie.useEffect(()=>{const De=()=>G({});return document.addEventListener(yE,De),()=>document.removeEventListener(yE,De)},[]),Ie.createElement(_o.div,vn({},k,{ref:U,style:{pointerEvents:_e?ke?"auto":"none":void 0,...e.style},onFocusCapture:Gn(e.onFocusCapture,me.onFocusCapture),onBlurCapture:Gn(e.onBlurCapture,me.onBlurCapture),onPointerDownCapture:Gn(e.onPointerDownCapture,Ae.onPointerDownCapture)}))});function FZ(e,n=globalThis==null?void 0:globalThis.document){const a=Rl(e),u=Ie.useRef(!1),f=Ie.useRef(()=>{});return Ie.useEffect(()=>{const _=T=>{if(T.target&&!u.current){let R=function(){uO(IZ,a,k,{discrete:!0})};var o=R;const k={originalEvent:T};T.pointerType==="touch"?(n.removeEventListener("click",f.current),f.current=R,n.addEventListener("click",f.current,{once:!0})):R()}else n.removeEventListener("click",f.current);u.current=!1},w=window.setTimeout(()=>{n.addEventListener("pointerdown",_)},0);return()=>{window.clearTimeout(w),n.removeEventListener("pointerdown",_),n.removeEventListener("click",f.current)}},[n,a]),{onPointerDownCapture:()=>u.current=!0}}function LZ(e,n=globalThis==null?void 0:globalThis.document){const a=Rl(e),u=Ie.useRef(!1);return Ie.useEffect(()=>{const f=_=>{_.target&&!u.current&&uO(PZ,a,{originalEvent:_},{discrete:!1})};return n.addEventListener("focusin",f),()=>n.removeEventListener("focusin",f)},[n,a]),{onFocusCapture:()=>u.current=!0,onBlurCapture:()=>u.current=!1}}function e4(){const e=new CustomEvent(yE);document.dispatchEvent(e)}function uO(e,n,a,{discrete:u}){const f=a.originalEvent.target,_=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:a});n&&f.addEventListener(e,n,{once:!0}),u?oO(f,_):f.dispatchEvent(_)}let Xb=0;function OZ(){Ie.useEffect(()=>{var e,n;const a=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",(e=a[0])!==null&&e!==void 0?e:t4()),document.body.insertAdjacentElement("beforeend",(n=a[1])!==null&&n!==void 0?n:t4()),Xb++,()=>{Xb===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(u=>u.remove()),Xb--}},[])}function t4(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.cssText="outline: none; opacity: 0; position: fixed; pointer-events: none",e}const Yb="focusScope.autoFocusOnMount",Kb="focusScope.autoFocusOnUnmount",r4={bubbles:!1,cancelable:!0},NZ=Ie.forwardRef((e,n)=>{const{loop:a=!1,trapped:u=!1,onMountAutoFocus:f,onUnmountAutoFocus:_,...w}=e,[T,o]=Ie.useState(null),k=Rl(f),R=Rl(_),F=Ie.useRef(null),B=qs(n,U=>o(U)),V=Ie.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;Ie.useEffect(()=>{if(u){let Y=function(Ae){if(V.paused||!T)return;const me=Ae.target;T.contains(me)?F.current=me:mu(F.current,{select:!0})},Z=function(Ae){if(V.paused||!T)return;const me=Ae.relatedTarget;me!==null&&(T.contains(me)||mu(F.current,{select:!0}))},_e=function(Ae){if(document.activeElement===document.body)for(const De of Ae)De.removedNodes.length>0&&mu(T)};var U=Y,J=Z,X=_e;document.addEventListener("focusin",Y),document.addEventListener("focusout",Z);const ke=new MutationObserver(_e);return T&&ke.observe(T,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",Y),document.removeEventListener("focusout",Z),ke.disconnect()}}},[u,T,V.paused]),Ie.useEffect(()=>{if(T){i4.add(V);const U=document.activeElement;if(!T.contains(U)){const X=new CustomEvent(Yb,r4);T.addEventListener(Yb,k),T.dispatchEvent(X),X.defaultPrevented||(zZ(jZ(hO(T)),{select:!0}),document.activeElement===U&&mu(T))}return()=>{T.removeEventListener(Yb,k),setTimeout(()=>{const X=new CustomEvent(Kb,r4);T.addEventListener(Kb,R),T.dispatchEvent(X),X.defaultPrevented||mu(U??document.body,{select:!0}),T.removeEventListener(Kb,R),i4.remove(V)},0)}}},[T,k,R,V]);const G=Ie.useCallback(U=>{if(!a&&!u||V.paused)return;const J=U.key==="Tab"&&!U.altKey&&!U.ctrlKey&&!U.metaKey,X=document.activeElement;if(J&&X){const Y=U.currentTarget,[Z,_e]=BZ(Y);Z&&_e?!U.shiftKey&&X===_e?(U.preventDefault(),a&&mu(Z,{select:!0})):U.shiftKey&&X===Z&&(U.preventDefault(),a&&mu(_e,{select:!0})):X===Y&&U.preventDefault()}},[a,u,V.paused]);return Ie.createElement(_o.div,vn({tabIndex:-1},w,{ref:B,onKeyDown:G}))});function zZ(e,{select:n=!1}={}){const a=document.activeElement;for(const u of e)if(mu(u,{select:n}),document.activeElement!==a)return}function BZ(e){const n=hO(e),a=n4(n,e),u=n4(n.reverse(),e);return[a,u]}function hO(e){const n=[],a=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:u=>{const f=u.tagName==="INPUT"&&u.type==="hidden";return u.disabled||u.hidden||f?NodeFilter.FILTER_SKIP:u.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;a.nextNode();)n.push(a.currentNode);return n}function n4(e,n){for(const a of e)if(!UZ(a,{upTo:n}))return a}function UZ(e,{upTo:n}){if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(n!==void 0&&e===n)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1}function VZ(e){return e instanceof HTMLInputElement&&"select"in e}function mu(e,{select:n=!1}={}){if(e&&e.focus){const a=document.activeElement;e.focus({preventScroll:!0}),e!==a&&VZ(e)&&n&&e.select()}}const i4=$Z();function $Z(){let e=[];return{add(n){const a=e[0];n!==a&&(a==null||a.pause()),e=a4(e,n),e.unshift(n)},remove(n){var a;e=a4(e,n),(a=e[0])===null||a===void 0||a.resume()}}}function a4(e,n){const a=[...e],u=a.indexOf(n);return u!==-1&&a.splice(u,1),a}function jZ(e){return e.filter(n=>n.tagName!=="A")}const hp=globalThis!=null&&globalThis.document?Ie.useLayoutEffect:()=>{},GZ=aB.useId||(()=>{});let HZ=0;function vE(e){const[n,a]=Ie.useState(GZ());return hp(()=>{e||a(u=>u??String(HZ++))},[e]),e||(n?`radix-${n}`:"")}const WZ=["top","right","bottom","left"],Bu=Math.min,Us=Math.max,N1=Math.round,Ey=Math.floor,Uu=e=>({x:e,y:e}),qZ={left:"right",right:"left",bottom:"top",top:"bottom"},ZZ={start:"end",end:"start"};function wE(e,n,a){return Us(e,Bu(n,a))}function wc(e,n){return typeof e=="function"?e(n):e}function bc(e){return e.split("-")[0]}function wp(e){return e.split("-")[1]}function oA(e){return e==="x"?"y":"x"}function lA(e){return e==="y"?"height":"width"}function bp(e){return["top","bottom"].includes(bc(e))?"y":"x"}function cA(e){return oA(bp(e))}function XZ(e,n,a){a===void 0&&(a=!1);const u=wp(e),f=cA(e),_=lA(f);let w=f==="x"?u===(a?"end":"start")?"right":"left":u==="start"?"bottom":"top";return n.reference[_]>n.floating[_]&&(w=z1(w)),[w,z1(w)]}function YZ(e){const n=z1(e);return[bE(e),n,bE(n)]}function bE(e){return e.replace(/start|end/g,n=>ZZ[n])}function KZ(e,n,a){const u=["left","right"],f=["right","left"],_=["top","bottom"],w=["bottom","top"];switch(e){case"top":case"bottom":return a?n?f:u:n?u:f;case"left":case"right":return n?_:w;default:return[]}}function JZ(e,n,a,u){const f=wp(e);let _=KZ(bc(e),a==="start",u);return f&&(_=_.map(w=>w+"-"+f),n&&(_=_.concat(_.map(bE)))),_}function z1(e){return e.replace(/left|right|bottom|top/g,n=>qZ[n])}function QZ(e){return{top:0,right:0,bottom:0,left:0,...e}}function fO(e){return typeof e!="number"?QZ(e):{top:e,right:e,bottom:e,left:e}}function B1(e){return{...e,top:e.y,left:e.x,right:e.x+e.width,bottom:e.y+e.height}}function s4(e,n,a){let{reference:u,floating:f}=e;const _=bp(n),w=cA(n),T=lA(w),o=bc(n),k=_==="y",R=u.x+u.width/2-f.width/2,F=u.y+u.height/2-f.height/2,B=u[T]/2-f[T]/2;let V;switch(o){case"top":V={x:R,y:u.y-f.height};break;case"bottom":V={x:R,y:u.y+u.height};break;case"right":V={x:u.x+u.width,y:F};break;case"left":V={x:u.x-f.width,y:F};break;default:V={x:u.x,y:u.y}}switch(wp(n)){case"start":V[w]-=B*(a&&k?-1:1);break;case"end":V[w]+=B*(a&&k?-1:1);break}return V}const eX=async(e,n,a)=>{const{placement:u="bottom",strategy:f="absolute",middleware:_=[],platform:w}=a,T=_.filter(Boolean),o=await(w.isRTL==null?void 0:w.isRTL(n));let k=await w.getElementRects({reference:e,floating:n,strategy:f}),{x:R,y:F}=s4(k,u,o),B=u,V={},G=0;for(let U=0;U<T.length;U++){const{name:J,fn:X}=T[U],{x:Y,y:Z,data:_e,reset:ke}=await X({x:R,y:F,initialPlacement:u,placement:B,strategy:f,middlewareData:V,rects:k,platform:w,elements:{reference:e,floating:n}});R=Y??R,F=Z??F,V={...V,[J]:{...V[J],..._e}},ke&&G<=50&&(G++,typeof ke=="object"&&(ke.placement&&(B=ke.placement),ke.rects&&(k=ke.rects===!0?await w.getElementRects({reference:e,floating:n,strategy:f}):ke.rects),{x:R,y:F}=s4(k,B,o)),U=-1)}return{x:R,y:F,placement:B,strategy:f,middlewareData:V}};async function Ng(e,n){var a;n===void 0&&(n={});const{x:u,y:f,platform:_,rects:w,elements:T,strategy:o}=e,{boundary:k="clippingAncestors",rootBoundary:R="viewport",elementContext:F="floating",altBoundary:B=!1,padding:V=0}=wc(n,e),G=fO(V),J=T[B?F==="floating"?"reference":"floating":F],X=B1(await _.getClippingRect({element:(a=await(_.isElement==null?void 0:_.isElement(J)))==null||a?J:J.contextElement||await(_.getDocumentElement==null?void 0:_.getDocumentElement(T.floating)),boundary:k,rootBoundary:R,strategy:o})),Y=F==="floating"?{...w.floating,x:u,y:f}:w.reference,Z=await(_.getOffsetParent==null?void 0:_.getOffsetParent(T.floating)),_e=await(_.isElement==null?void 0:_.isElement(Z))?await(_.getScale==null?void 0:_.getScale(Z))||{x:1,y:1}:{x:1,y:1},ke=B1(_.convertOffsetParentRelativeRectToViewportRelativeRect?await _.convertOffsetParentRelativeRectToViewportRelativeRect({elements:T,rect:Y,offsetParent:Z,strategy:o}):Y);return{top:(X.top-ke.top+G.top)/_e.y,bottom:(ke.bottom-X.bottom+G.bottom)/_e.y,left:(X.left-ke.left+G.left)/_e.x,right:(ke.right-X.right+G.right)/_e.x}}const tX=e=>({name:"arrow",options:e,async fn(n){const{x:a,y:u,placement:f,rects:_,platform:w,elements:T,middlewareData:o}=n,{element:k,padding:R=0}=wc(e,n)||{};if(k==null)return{};const F=fO(R),B={x:a,y:u},V=cA(f),G=lA(V),U=await w.getDimensions(k),J=V==="y",X=J?"top":"left",Y=J?"bottom":"right",Z=J?"clientHeight":"clientWidth",_e=_.reference[G]+_.reference[V]-B[V]-_.floating[G],ke=B[V]-_.reference[V],Ae=await(w.getOffsetParent==null?void 0:w.getOffsetParent(k));let me=Ae?Ae[Z]:0;(!me||!await(w.isElement==null?void 0:w.isElement(Ae)))&&(me=T.floating[Z]||_.floating[G]);const De=_e/2-ke/2,we=me/2-U[G]/2-1,Je=Bu(F[X],we),rt=Bu(F[Y],we),Re=Je,St=me-U[G]-rt,Lt=me/2-U[G]/2+De,We=wE(Re,Lt,St),qt=!o.arrow&&wp(f)!=null&&Lt!==We&&_.reference[G]/2-(Lt<Re?Je:rt)-U[G]/2<0,Ot=qt?Lt<Re?Lt-Re:Lt-St:0;return{[V]:B[V]+Ot,data:{[V]:We,centerOffset:Lt-We-Ot,...qt&&{alignmentOffset:Ot}},reset:qt}}}),rX=function(e){return e===void 0&&(e={}),{name:"flip",options:e,async fn(n){var a,u;const{placement:f,middlewareData:_,rects:w,initialPlacement:T,platform:o,elements:k}=n,{mainAxis:R=!0,crossAxis:F=!0,fallbackPlacements:B,fallbackStrategy:V="bestFit",fallbackAxisSideDirection:G="none",flipAlignment:U=!0,...J}=wc(e,n);if((a=_.arrow)!=null&&a.alignmentOffset)return{};const X=bc(f),Y=bc(T)===T,Z=await(o.isRTL==null?void 0:o.isRTL(k.floating)),_e=B||(Y||!U?[z1(T)]:YZ(T));!B&&G!=="none"&&_e.push(...JZ(T,U,G,Z));const ke=[T,..._e],Ae=await Ng(n,J),me=[];let De=((u=_.flip)==null?void 0:u.overflows)||[];if(R&&me.push(Ae[X]),F){const Re=XZ(f,w,Z);me.push(Ae[Re[0]],Ae[Re[1]])}if(De=[...De,{placement:f,overflows:me}],!me.every(Re=>Re<=0)){var we,Je;const Re=(((we=_.flip)==null?void 0:we.index)||0)+1,St=ke[Re];if(St)return{data:{index:Re,overflows:De},reset:{placement:St}};let Lt=(Je=De.filter(We=>We.overflows[0]<=0).sort((We,qt)=>We.overflows[1]-qt.overflows[1])[0])==null?void 0:Je.placement;if(!Lt)switch(V){case"bestFit":{var rt;const We=(rt=De.map(qt=>[qt.placement,qt.overflows.filter(Ot=>Ot>0).reduce((Ot,st)=>Ot+st,0)]).sort((qt,Ot)=>qt[1]-Ot[1])[0])==null?void 0:rt[0];We&&(Lt=We);break}case"initialPlacement":Lt=T;break}if(f!==Lt)return{reset:{placement:Lt}}}return{}}}};function o4(e,n){return{top:e.top-n.height,right:e.right-n.width,bottom:e.bottom-n.height,left:e.left-n.width}}function l4(e){return WZ.some(n=>e[n]>=0)}const nX=function(e){return e===void 0&&(e={}),{name:"hide",options:e,async fn(n){const{rects:a}=n,{strategy:u="referenceHidden",...f}=wc(e,n);switch(u){case"referenceHidden":{const _=await Ng(n,{...f,elementContext:"reference"}),w=o4(_,a.reference);return{data:{referenceHiddenOffsets:w,referenceHidden:l4(w)}}}case"escaped":{const _=await Ng(n,{...f,altBoundary:!0}),w=o4(_,a.floating);return{data:{escapedOffsets:w,escaped:l4(w)}}}default:return{}}}}};async function iX(e,n){const{placement:a,platform:u,elements:f}=e,_=await(u.isRTL==null?void 0:u.isRTL(f.floating)),w=bc(a),T=wp(a),o=bp(a)==="y",k=["left","top"].includes(w)?-1:1,R=_&&o?-1:1,F=wc(n,e);let{mainAxis:B,crossAxis:V,alignmentAxis:G}=typeof F=="number"?{mainAxis:F,crossAxis:0,alignmentAxis:null}:{mainAxis:0,crossAxis:0,alignmentAxis:null,...F};return T&&typeof G=="number"&&(V=T==="end"?G*-1:G),o?{x:V*R,y:B*k}:{x:B*k,y:V*R}}const aX=function(e){return e===void 0&&(e=0),{name:"offset",options:e,async fn(n){var a,u;const{x:f,y:_,placement:w,middlewareData:T}=n,o=await iX(n,e);return w===((a=T.offset)==null?void 0:a.placement)&&(u=T.arrow)!=null&&u.alignmentOffset?{}:{x:f+o.x,y:_+o.y,data:{...o,placement:w}}}}},sX=function(e){return e===void 0&&(e={}),{name:"shift",options:e,async fn(n){const{x:a,y:u,placement:f}=n,{mainAxis:_=!0,crossAxis:w=!1,limiter:T={fn:J=>{let{x:X,y:Y}=J;return{x:X,y:Y}}},...o}=wc(e,n),k={x:a,y:u},R=await Ng(n,o),F=bp(bc(f)),B=oA(F);let V=k[B],G=k[F];if(_){const J=B==="y"?"top":"left",X=B==="y"?"bottom":"right",Y=V+R[J],Z=V-R[X];V=wE(Y,V,Z)}if(w){const J=F==="y"?"top":"left",X=F==="y"?"bottom":"right",Y=G+R[J],Z=G-R[X];G=wE(Y,G,Z)}const U=T.fn({...n,[B]:V,[F]:G});return{...U,data:{x:U.x-a,y:U.y-u}}}}},oX=function(e){return e===void 0&&(e={}),{options:e,fn(n){const{x:a,y:u,placement:f,rects:_,middlewareData:w}=n,{offset:T=0,mainAxis:o=!0,crossAxis:k=!0}=wc(e,n),R={x:a,y:u},F=bp(f),B=oA(F);let V=R[B],G=R[F];const U=wc(T,n),J=typeof U=="number"?{mainAxis:U,crossAxis:0}:{mainAxis:0,crossAxis:0,...U};if(o){const Z=B==="y"?"height":"width",_e=_.reference[B]-_.floating[Z]+J.mainAxis,ke=_.reference[B]+_.reference[Z]-J.mainAxis;V<_e?V=_e:V>ke&&(V=ke)}if(k){var X,Y;const Z=B==="y"?"width":"height",_e=["top","left"].includes(bc(f)),ke=_.reference[F]-_.floating[Z]+(_e&&((X=w.offset)==null?void 0:X[F])||0)+(_e?0:J.crossAxis),Ae=_.reference[F]+_.reference[Z]+(_e?0:((Y=w.offset)==null?void 0:Y[F])||0)-(_e?J.crossAxis:0);G<ke?G=ke:G>Ae&&(G=Ae)}return{[B]:V,[F]:G}}}},lX=function(e){return e===void 0&&(e={}),{name:"size",options:e,async fn(n){const{placement:a,rects:u,platform:f,elements:_}=n,{apply:w=()=>{},...T}=wc(e,n),o=await Ng(n,T),k=bc(a),R=wp(a),F=bp(a)==="y",{width:B,height:V}=u.floating;let G,U;k==="top"||k==="bottom"?(G=k,U=R===(await(f.isRTL==null?void 0:f.isRTL(_.floating))?"start":"end")?"left":"right"):(U=k,G=R==="end"?"top":"bottom");const J=V-o[G],X=B-o[U],Y=!n.middlewareData.shift;let Z=J,_e=X;if(F){const Ae=B-o.left-o.right;_e=R||Y?Bu(X,Ae):Ae}else{const Ae=V-o.top-o.bottom;Z=R||Y?Bu(J,Ae):Ae}if(Y&&!R){const Ae=Us(o.left,0),me=Us(o.right,0),De=Us(o.top,0),we=Us(o.bottom,0);F?_e=B-2*(Ae!==0||me!==0?Ae+me:Us(o.left,o.right)):Z=V-2*(De!==0||we!==0?De+we:Us(o.top,o.bottom))}await w({...n,availableWidth:_e,availableHeight:Z});const ke=await f.getDimensions(_.floating);return B!==ke.width||V!==ke.height?{reset:{rects:!0}}:{}}}};function Vu(e){return dO(e)?(e.nodeName||"").toLowerCase():"#document"}function Gs(e){var n;return(e==null||(n=e.ownerDocument)==null?void 0:n.defaultView)||window}function Ac(e){var n;return(n=(dO(e)?e.ownerDocument:e.document)||window.document)==null?void 0:n.documentElement}function dO(e){return e instanceof Node||e instanceof Gs(e).Node}function Tc(e){return e instanceof Element||e instanceof Gs(e).Element}function Dl(e){return e instanceof HTMLElement||e instanceof Gs(e).HTMLElement}function c4(e){return typeof ShadowRoot>"u"?!1:e instanceof ShadowRoot||e instanceof Gs(e).ShadowRoot}function r_(e){const{overflow:n,overflowX:a,overflowY:u,display:f}=po(e);return/auto|scroll|overlay|hidden|clip/.test(n+u+a)&&!["inline","contents"].includes(f)}function cX(e){return["table","td","th"].includes(Vu(e))}function uA(e){const n=hA(),a=po(e);return a.transform!=="none"||a.perspective!=="none"||(a.containerType?a.containerType!=="normal":!1)||!n&&(a.backdropFilter?a.backdropFilter!=="none":!1)||!n&&(a.filter?a.filter!=="none":!1)||["transform","perspective","filter"].some(u=>(a.willChange||"").includes(u))||["paint","layout","strict","content"].some(u=>(a.contain||"").includes(u))}function uX(e){let n=fp(e);for(;Dl(n)&&!pv(n);){if(uA(n))return n;n=fp(n)}return null}function hA(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function pv(e){return["html","body","#document"].includes(Vu(e))}function po(e){return Gs(e).getComputedStyle(e)}function mv(e){return Tc(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.pageXOffset,scrollTop:e.pageYOffset}}function fp(e){if(Vu(e)==="html")return e;const n=e.assignedSlot||e.parentNode||c4(e)&&e.host||Ac(e);return c4(n)?n.host:n}function pO(e){const n=fp(e);return pv(n)?e.ownerDocument?e.ownerDocument.body:e.body:Dl(n)&&r_(n)?n:pO(n)}function zg(e,n,a){var u;n===void 0&&(n=[]),a===void 0&&(a=!0);const f=pO(e),_=f===((u=e.ownerDocument)==null?void 0:u.body),w=Gs(f);return _?n.concat(w,w.visualViewport||[],r_(f)?f:[],w.frameElement&&a?zg(w.frameElement):[]):n.concat(f,zg(f,[],a))}function mO(e){const n=po(e);let a=parseFloat(n.width)||0,u=parseFloat(n.height)||0;const f=Dl(e),_=f?e.offsetWidth:a,w=f?e.offsetHeight:u,T=N1(a)!==_||N1(u)!==w;return T&&(a=_,u=w),{width:a,height:u,$:T}}function fA(e){return Tc(e)?e:e.contextElement}function Jd(e){const n=fA(e);if(!Dl(n))return Uu(1);const a=n.getBoundingClientRect(),{width:u,height:f,$:_}=mO(n);let w=(_?N1(a.width):a.width)/u,T=(_?N1(a.height):a.height)/f;return(!w||!Number.isFinite(w))&&(w=1),(!T||!Number.isFinite(T))&&(T=1),{x:w,y:T}}const hX=Uu(0);function gO(e){const n=Gs(e);return!hA()||!n.visualViewport?hX:{x:n.visualViewport.offsetLeft,y:n.visualViewport.offsetTop}}function fX(e,n,a){return n===void 0&&(n=!1),!a||n&&a!==Gs(e)?!1:n}function cf(e,n,a,u){n===void 0&&(n=!1),a===void 0&&(a=!1);const f=e.getBoundingClientRect(),_=fA(e);let w=Uu(1);n&&(u?Tc(u)&&(w=Jd(u)):w=Jd(e));const T=fX(_,a,u)?gO(_):Uu(0);let o=(f.left+T.x)/w.x,k=(f.top+T.y)/w.y,R=f.width/w.x,F=f.height/w.y;if(_){const B=Gs(_),V=u&&Tc(u)?Gs(u):u;let G=B,U=G.frameElement;for(;U&&u&&V!==G;){const J=Jd(U),X=U.getBoundingClientRect(),Y=po(U),Z=X.left+(U.clientLeft+parseFloat(Y.paddingLeft))*J.x,_e=X.top+(U.clientTop+parseFloat(Y.paddingTop))*J.y;o*=J.x,k*=J.y,R*=J.x,F*=J.y,o+=Z,k+=_e,G=Gs(U),U=G.frameElement}}return B1({width:R,height:F,x:o,y:k})}const dX=[":popover-open",":modal"];function _O(e){return dX.some(n=>{try{return e.matches(n)}catch{return!1}})}function pX(e){let{elements:n,rect:a,offsetParent:u,strategy:f}=e;const _=f==="fixed",w=Ac(u),T=n?_O(n.floating):!1;if(u===w||T&&_)return a;let o={scrollLeft:0,scrollTop:0},k=Uu(1);const R=Uu(0),F=Dl(u);if((F||!F&&!_)&&((Vu(u)!=="body"||r_(w))&&(o=mv(u)),Dl(u))){const B=cf(u);k=Jd(u),R.x=B.x+u.clientLeft,R.y=B.y+u.clientTop}return{width:a.width*k.x,height:a.height*k.y,x:a.x*k.x-o.scrollLeft*k.x+R.x,y:a.y*k.y-o.scrollTop*k.y+R.y}}function mX(e){return Array.from(e.getClientRects())}function xO(e){return cf(Ac(e)).left+mv(e).scrollLeft}function gX(e){const n=Ac(e),a=mv(e),u=e.ownerDocument.body,f=Us(n.scrollWidth,n.clientWidth,u.scrollWidth,u.clientWidth),_=Us(n.scrollHeight,n.clientHeight,u.scrollHeight,u.clientHeight);let w=-a.scrollLeft+xO(e);const T=-a.scrollTop;return po(u).direction==="rtl"&&(w+=Us(n.clientWidth,u.clientWidth)-f),{width:f,height:_,x:w,y:T}}function _X(e,n){const a=Gs(e),u=Ac(e),f=a.visualViewport;let _=u.clientWidth,w=u.clientHeight,T=0,o=0;if(f){_=f.width,w=f.height;const k=hA();(!k||k&&n==="fixed")&&(T=f.offsetLeft,o=f.offsetTop)}return{width:_,height:w,x:T,y:o}}function xX(e,n){const a=cf(e,!0,n==="fixed"),u=a.top+e.clientTop,f=a.left+e.clientLeft,_=Dl(e)?Jd(e):Uu(1),w=e.clientWidth*_.x,T=e.clientHeight*_.y,o=f*_.x,k=u*_.y;return{width:w,height:T,x:o,y:k}}function u4(e,n,a){let u;if(n==="viewport")u=_X(e,a);else if(n==="document")u=gX(Ac(e));else if(Tc(n))u=xX(n,a);else{const f=gO(e);u={...n,x:n.x-f.x,y:n.y-f.y}}return B1(u)}function yO(e,n){const a=fp(e);return a===n||!Tc(a)||pv(a)?!1:po(a).position==="fixed"||yO(a,n)}function yX(e,n){const a=n.get(e);if(a)return a;let u=zg(e,[],!1).filter(T=>Tc(T)&&Vu(T)!=="body"),f=null;const _=po(e).position==="fixed";let w=_?fp(e):e;for(;Tc(w)&&!pv(w);){const T=po(w),o=uA(w);!o&&T.position==="fixed"&&(f=null),(_?!o&&!f:!o&&T.position==="static"&&!!f&&["absolute","fixed"].includes(f.position)||r_(w)&&!o&&yO(e,w))?u=u.filter(R=>R!==w):f=T,w=fp(w)}return n.set(e,u),u}function vX(e){let{element:n,boundary:a,rootBoundary:u,strategy:f}=e;const w=[...a==="clippingAncestors"?yX(n,this._c):[].concat(a),u],T=w[0],o=w.reduce((k,R)=>{const F=u4(n,R,f);return k.top=Us(F.top,k.top),k.right=Bu(F.right,k.right),k.bottom=Bu(F.bottom,k.bottom),k.left=Us(F.left,k.left),k},u4(n,T,f));return{width:o.right-o.left,height:o.bottom-o.top,x:o.left,y:o.top}}function wX(e){const{width:n,height:a}=mO(e);return{width:n,height:a}}function bX(e,n,a){const u=Dl(n),f=Ac(n),_=a==="fixed",w=cf(e,!0,_,n);let T={scrollLeft:0,scrollTop:0};const o=Uu(0);if(u||!u&&!_)if((Vu(n)!=="body"||r_(f))&&(T=mv(n)),u){const F=cf(n,!0,_,n);o.x=F.x+n.clientLeft,o.y=F.y+n.clientTop}else f&&(o.x=xO(f));const k=w.left+T.scrollLeft-o.x,R=w.top+T.scrollTop-o.y;return{x:k,y:R,width:w.width,height:w.height}}function h4(e,n){return!Dl(e)||po(e).position==="fixed"?null:n?n(e):e.offsetParent}function vO(e,n){const a=Gs(e);if(!Dl(e)||_O(e))return a;let u=h4(e,n);for(;u&&cX(u)&&po(u).position==="static";)u=h4(u,n);return u&&(Vu(u)==="html"||Vu(u)==="body"&&po(u).position==="static"&&!uA(u))?a:u||uX(e)||a}const TX=async function(e){const n=this.getOffsetParent||vO,a=this.getDimensions;return{reference:bX(e.reference,await n(e.floating),e.strategy),floating:{x:0,y:0,...await a(e.floating)}}};function EX(e){return po(e).direction==="rtl"}const SX={convertOffsetParentRelativeRectToViewportRelativeRect:pX,getDocumentElement:Ac,getClippingRect:vX,getOffsetParent:vO,getElementRects:TX,getClientRects:mX,getDimensions:wX,getScale:Jd,isElement:Tc,isRTL:EX};function AX(e,n){let a=null,u;const f=Ac(e);function _(){var T;clearTimeout(u),(T=a)==null||T.disconnect(),a=null}function w(T,o){T===void 0&&(T=!1),o===void 0&&(o=1),_();const{left:k,top:R,width:F,height:B}=e.getBoundingClientRect();if(T||n(),!F||!B)return;const V=Ey(R),G=Ey(f.clientWidth-(k+F)),U=Ey(f.clientHeight-(R+B)),J=Ey(k),Y={rootMargin:-V+"px "+-G+"px "+-U+"px "+-J+"px",threshold:Us(0,Bu(1,o))||1};let Z=!0;function _e(ke){const Ae=ke[0].intersectionRatio;if(Ae!==o){if(!Z)return w();Ae?w(!1,Ae):u=setTimeout(()=>{w(!1,1e-7)},100)}Z=!1}try{a=new IntersectionObserver(_e,{...Y,root:f.ownerDocument})}catch{a=new IntersectionObserver(_e,Y)}a.observe(e)}return w(!0),_}function CX(e,n,a,u){u===void 0&&(u={});const{ancestorScroll:f=!0,ancestorResize:_=!0,elementResize:w=typeof ResizeObserver=="function",layoutShift:T=typeof IntersectionObserver=="function",animationFrame:o=!1}=u,k=fA(e),R=f||_?[...k?zg(k):[],...zg(n)]:[];R.forEach(X=>{f&&X.addEventListener("scroll",a,{passive:!0}),_&&X.addEventListener("resize",a)});const F=k&&T?AX(k,a):null;let B=-1,V=null;w&&(V=new ResizeObserver(X=>{let[Y]=X;Y&&Y.target===k&&V&&(V.unobserve(n),cancelAnimationFrame(B),B=requestAnimationFrame(()=>{var Z;(Z=V)==null||Z.observe(n)})),a()}),k&&!o&&V.observe(k),V.observe(n));let G,U=o?cf(e):null;o&&J();function J(){const X=cf(e);U&&(X.x!==U.x||X.y!==U.y||X.width!==U.width||X.height!==U.height)&&a(),U=X,G=requestAnimationFrame(J)}return a(),()=>{var X;R.forEach(Y=>{f&&Y.removeEventListener("scroll",a),_&&Y.removeEventListener("resize",a)}),F==null||F(),(X=V)==null||X.disconnect(),V=null,o&&cancelAnimationFrame(G)}}const kX=sX,MX=rX,IX=lX,PX=nX,f4=tX,RX=oX,DX=(e,n,a)=>{const u=new Map,f={platform:SX,...a},_={...f.platform,_c:u};return eX(e,n,{...f,platform:_})},FX=e=>{function n(a){return{}.hasOwnProperty.call(a,"current")}return{name:"arrow",options:e,fn(a){const{element:u,padding:f}=typeof e=="function"?e(a):e;return u&&n(u)?u.current!=null?f4({element:u.current,padding:f}).fn(a):{}:u?f4({element:u,padding:f}).fn(a):{}}}};var Ky=typeof document<"u"?Ie.useLayoutEffect:Ie.useEffect;function U1(e,n){if(e===n)return!0;if(typeof e!=typeof n)return!1;if(typeof e=="function"&&e.toString()===n.toString())return!0;let a,u,f;if(e&&n&&typeof e=="object"){if(Array.isArray(e)){if(a=e.length,a!==n.length)return!1;for(u=a;u--!==0;)if(!U1(e[u],n[u]))return!1;return!0}if(f=Object.keys(e),a=f.length,a!==Object.keys(n).length)return!1;for(u=a;u--!==0;)if(!{}.hasOwnProperty.call(n,f[u]))return!1;for(u=a;u--!==0;){const _=f[u];if(!(_==="_owner"&&e.$$typeof)&&!U1(e[_],n[_]))return!1}return!0}return e!==e&&n!==n}function wO(e){return typeof window>"u"?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function d4(e,n){const a=wO(e);return Math.round(n*a)/a}function p4(e){const n=Ie.useRef(e);return Ky(()=>{n.current=e}),n}function LX(e){e===void 0&&(e={});const{placement:n="bottom",strategy:a="absolute",middleware:u=[],platform:f,elements:{reference:_,floating:w}={},transform:T=!0,whileElementsMounted:o,open:k}=e,[R,F]=Ie.useState({x:0,y:0,strategy:a,placement:n,middlewareData:{},isPositioned:!1}),[B,V]=Ie.useState(u);U1(B,u)||V(u);const[G,U]=Ie.useState(null),[J,X]=Ie.useState(null),Y=Ie.useCallback(Ot=>{Ot!==Ae.current&&(Ae.current=Ot,U(Ot))},[]),Z=Ie.useCallback(Ot=>{Ot!==me.current&&(me.current=Ot,X(Ot))},[]),_e=_||G,ke=w||J,Ae=Ie.useRef(null),me=Ie.useRef(null),De=Ie.useRef(R),we=o!=null,Je=p4(o),rt=p4(f),Re=Ie.useCallback(()=>{if(!Ae.current||!me.current)return;const Ot={placement:n,strategy:a,middleware:B};rt.current&&(Ot.platform=rt.current),DX(Ae.current,me.current,Ot).then(st=>{const Ve={...st,isPositioned:!0};St.current&&!U1(De.current,Ve)&&(De.current=Ve,Wg.flushSync(()=>{F(Ve)}))})},[B,n,a,rt]);Ky(()=>{k===!1&&De.current.isPositioned&&(De.current.isPositioned=!1,F(Ot=>({...Ot,isPositioned:!1})))},[k]);const St=Ie.useRef(!1);Ky(()=>(St.current=!0,()=>{St.current=!1}),[]),Ky(()=>{if(_e&&(Ae.current=_e),ke&&(me.current=ke),_e&&ke){if(Je.current)return Je.current(_e,ke,Re);Re()}},[_e,ke,Re,Je,we]);const Lt=Ie.useMemo(()=>({reference:Ae,floating:me,setReference:Y,setFloating:Z}),[Y,Z]),We=Ie.useMemo(()=>({reference:_e,floating:ke}),[_e,ke]),qt=Ie.useMemo(()=>{const Ot={position:a,left:0,top:0};if(!We.floating)return Ot;const st=d4(We.floating,R.x),Ve=d4(We.floating,R.y);return T?{...Ot,transform:"translate("+st+"px, "+Ve+"px)",...wO(We.floating)>=1.5&&{willChange:"transform"}}:{position:a,left:st,top:Ve}},[a,T,We.floating,R.x,R.y]);return Ie.useMemo(()=>({...R,update:Re,refs:Lt,elements:We,floatingStyles:qt}),[R,Re,Lt,We,qt])}function OX(e){const[n,a]=Ie.useState(void 0);return hp(()=>{if(e){a({width:e.offsetWidth,height:e.offsetHeight});const u=new ResizeObserver(f=>{if(!Array.isArray(f)||!f.length)return;const _=f[0];let w,T;if("borderBoxSize"in _){const o=_.borderBoxSize,k=Array.isArray(o)?o[0]:o;w=k.inlineSize,T=k.blockSize}else w=e.offsetWidth,T=e.offsetHeight;a({width:w,height:T})});return u.observe(e,{box:"border-box"}),()=>u.unobserve(e)}else a(void 0)},[e]),n}const bO="Popper",[TO,EO]=t_(bO),[NX,SO]=TO(bO),zX=e=>{const{__scopePopper:n,children:a}=e,[u,f]=Ie.useState(null);return Ie.createElement(NX,{scope:n,anchor:u,onAnchorChange:f},a)},BX="PopperAnchor",UX=Ie.forwardRef((e,n)=>{const{__scopePopper:a,virtualRef:u,...f}=e,_=SO(BX,a),w=Ie.useRef(null),T=qs(n,w);return Ie.useEffect(()=>{_.onAnchorChange((u==null?void 0:u.current)||w.current)}),u?null:Ie.createElement(_o.div,vn({},f,{ref:T}))}),AO="PopperContent",[VX,pQ]=TO(AO),$X=Ie.forwardRef((e,n)=>{var a,u,f,_,w,T,o,k;const{__scopePopper:R,side:F="bottom",sideOffset:B=0,align:V="center",alignOffset:G=0,arrowPadding:U=0,avoidCollisions:J=!0,collisionBoundary:X=[],collisionPadding:Y=0,sticky:Z="partial",hideWhenDetached:_e=!1,updatePositionStrategy:ke="optimized",onPlaced:Ae,...me}=e,De=SO(AO,R),[we,Je]=Ie.useState(null),rt=qs(n,Er=>Je(Er)),[Re,St]=Ie.useState(null),Lt=OX(Re),We=(a=Lt==null?void 0:Lt.width)!==null&&a!==void 0?a:0,qt=(u=Lt==null?void 0:Lt.height)!==null&&u!==void 0?u:0,Ot=F+(V!=="center"?"-"+V:""),st=typeof Y=="number"?Y:{top:0,right:0,bottom:0,left:0,...Y},Ve=Array.isArray(X)?X:[X],Et=Ve.length>0,Dt={padding:st,boundary:Ve.filter(jX),altBoundary:Et},{refs:Se,floatingStyles:at,placement:He,isPositioned:Xe,middlewareData:yt}=LX({strategy:"fixed",placement:Ot,whileElementsMounted:(...Er)=>CX(...Er,{animationFrame:ke==="always"}),elements:{reference:De.anchor},middleware:[aX({mainAxis:B+qt,alignmentAxis:G}),J&&kX({mainAxis:!0,crossAxis:!1,limiter:Z==="partial"?RX():void 0,...Dt}),J&&MX({...Dt}),IX({...Dt,apply:({elements:Er,rects:Ir,availableWidth:nr,availableHeight:En})=>{const{width:Xn,height:wn}=Ir.reference,ei=Er.floating.style;ei.setProperty("--radix-popper-available-width",`${nr}px`),ei.setProperty("--radix-popper-available-height",`${En}px`),ei.setProperty("--radix-popper-anchor-width",`${Xn}px`),ei.setProperty("--radix-popper-anchor-height",`${wn}px`)}}),Re&&FX({element:Re,padding:U}),GX({arrowWidth:We,arrowHeight:qt}),_e&&PX({strategy:"referenceHidden",...Dt})]}),[Jt,sr]=CO(He),Xt=Rl(Ae);hp(()=>{Xe&&(Xt==null||Xt())},[Xe,Xt]);const zt=(f=yt.arrow)===null||f===void 0?void 0:f.x,Or=(_=yt.arrow)===null||_===void 0?void 0:_.y,Be=((w=yt.arrow)===null||w===void 0?void 0:w.centerOffset)!==0,[Fn,Tr]=Ie.useState();return hp(()=>{we&&Tr(window.getComputedStyle(we).zIndex)},[we]),Ie.createElement("div",{ref:Se.setFloating,"data-radix-popper-content-wrapper":"",style:{...at,transform:Xe?at.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Fn,"--radix-popper-transform-origin":[(T=yt.transformOrigin)===null||T===void 0?void 0:T.x,(o=yt.transformOrigin)===null||o===void 0?void 0:o.y].join(" ")},dir:e.dir},Ie.createElement(VX,{scope:R,placedSide:Jt,onArrowChange:St,arrowX:zt,arrowY:Or,shouldHideArrow:Be},Ie.createElement(_o.div,vn({"data-side":Jt,"data-align":sr},me,{ref:rt,style:{...me.style,animation:Xe?void 0:"none",opacity:(k=yt.hide)!==null&&k!==void 0&&k.referenceHidden?0:void 0}}))))});function jX(e){return e!==null}const GX=e=>({name:"transformOrigin",options:e,fn(n){var a,u,f,_,w;const{placement:T,rects:o,middlewareData:k}=n,F=((a=k.arrow)===null||a===void 0?void 0:a.centerOffset)!==0,B=F?0:e.arrowWidth,V=F?0:e.arrowHeight,[G,U]=CO(T),J={start:"0%",center:"50%",end:"100%"}[U],X=((u=(f=k.arrow)===null||f===void 0?void 0:f.x)!==null&&u!==void 0?u:0)+B/2,Y=((_=(w=k.arrow)===null||w===void 0?void 0:w.y)!==null&&_!==void 0?_:0)+V/2;let Z="",_e="";return G==="bottom"?(Z=F?J:`${X}px`,_e=`${-V}px`):G==="top"?(Z=F?J:`${X}px`,_e=`${o.floating.height+V}px`):G==="right"?(Z=`${-V}px`,_e=F?J:`${Y}px`):G==="left"&&(Z=`${o.floating.width+V}px`,_e=F?J:`${Y}px`),{data:{x:Z,y:_e}}}});function CO(e){const[n,a="center"]=e.split("-");return[n,a]}const HX=zX,WX=UX,qX=$X,ZX=Ie.forwardRef((e,n)=>{var a;const{container:u=globalThis==null||(a=globalThis.document)===null||a===void 0?void 0:a.body,...f}=e;return u?WD.createPortal(Ie.createElement(_o.div,vn({},f,{ref:n})),u):null});function XX(e,n){return Ie.useReducer((a,u)=>{const f=n[a][u];return f??a},e)}const n_=e=>{const{present:n,children:a}=e,u=YX(n),f=typeof a=="function"?a({present:u.isPresent}):Ie.Children.only(a),_=qs(u.ref,f.ref);return typeof a=="function"||u.isPresent?Ie.cloneElement(f,{ref:_}):null};n_.displayName="Presence";function YX(e){const[n,a]=Ie.useState(),u=Ie.useRef({}),f=Ie.useRef(e),_=Ie.useRef("none"),w=e?"mounted":"unmounted",[T,o]=XX(w,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return Ie.useEffect(()=>{const k=Sy(u.current);_.current=T==="mounted"?k:"none"},[T]),hp(()=>{const k=u.current,R=f.current;if(R!==e){const B=_.current,V=Sy(k);e?o("MOUNT"):V==="none"||(k==null?void 0:k.display)==="none"?o("UNMOUNT"):o(R&&B!==V?"ANIMATION_OUT":"UNMOUNT"),f.current=e}},[e,o]),hp(()=>{if(n){const k=F=>{const V=Sy(u.current).includes(F.animationName);F.target===n&&V&&Wg.flushSync(()=>o("ANIMATION_END"))},R=F=>{F.target===n&&(_.current=Sy(u.current))};return n.addEventListener("animationstart",R),n.addEventListener("animationcancel",k),n.addEventListener("animationend",k),()=>{n.removeEventListener("animationstart",R),n.removeEventListener("animationcancel",k),n.removeEventListener("animationend",k)}}else o("ANIMATION_END")},[n,o]),{isPresent:["mounted","unmountSuspended"].includes(T),ref:Ie.useCallback(k=>{k&&(u.current=getComputedStyle(k)),a(k)},[])}}function Sy(e){return(e==null?void 0:e.animationName)||"none"}const Jb="rovingFocusGroup.onEntryFocus",KX={bubbles:!1,cancelable:!0},dA="RovingFocusGroup",[TE,kO,JX]=lO(dA),[QX,MO]=t_(dA,[JX]),[eY,tY]=QX(dA),rY=Ie.forwardRef((e,n)=>Ie.createElement(TE.Provider,{scope:e.__scopeRovingFocusGroup},Ie.createElement(TE.Slot,{scope:e.__scopeRovingFocusGroup},Ie.createElement(nY,vn({},e,{ref:n}))))),nY=Ie.forwardRef((e,n)=>{const{__scopeRovingFocusGroup:a,orientation:u,loop:f=!1,dir:_,currentTabStopId:w,defaultCurrentTabStopId:T,onCurrentTabStopIdChange:o,onEntryFocus:k,...R}=e,F=Ie.useRef(null),B=qs(n,F),V=cO(_),[G=null,U]=sO({prop:w,defaultProp:T,onChange:o}),[J,X]=Ie.useState(!1),Y=Rl(k),Z=kO(a),_e=Ie.useRef(!1),[ke,Ae]=Ie.useState(0);return Ie.useEffect(()=>{const me=F.current;if(me)return me.addEventListener(Jb,Y),()=>me.removeEventListener(Jb,Y)},[Y]),Ie.createElement(eY,{scope:a,orientation:u,dir:V,loop:f,currentTabStopId:G,onItemFocus:Ie.useCallback(me=>U(me),[U]),onItemShiftTab:Ie.useCallback(()=>X(!0),[]),onFocusableItemAdd:Ie.useCallback(()=>Ae(me=>me+1),[]),onFocusableItemRemove:Ie.useCallback(()=>Ae(me=>me-1),[])},Ie.createElement(_o.div,vn({tabIndex:J||ke===0?-1:0,"data-orientation":u},R,{ref:B,style:{outline:"none",...e.style},onMouseDown:Gn(e.onMouseDown,()=>{_e.current=!0}),onFocus:Gn(e.onFocus,me=>{const De=!_e.current;if(me.target===me.currentTarget&&De&&!J){const we=new CustomEvent(Jb,KX);if(me.currentTarget.dispatchEvent(we),!we.defaultPrevented){const Je=Z().filter(We=>We.focusable),rt=Je.find(We=>We.active),Re=Je.find(We=>We.id===G),Lt=[rt,Re,...Je].filter(Boolean).map(We=>We.ref.current);IO(Lt)}}_e.current=!1}),onBlur:Gn(e.onBlur,()=>X(!1))})))}),iY="RovingFocusGroupItem",aY=Ie.forwardRef((e,n)=>{const{__scopeRovingFocusGroup:a,focusable:u=!0,active:f=!1,tabStopId:_,...w}=e,T=vE(),o=_||T,k=tY(iY,a),R=k.currentTabStopId===o,F=kO(a),{onFocusableItemAdd:B,onFocusableItemRemove:V}=k;return Ie.useEffect(()=>{if(u)return B(),()=>V()},[u,B,V]),Ie.createElement(TE.ItemSlot,{scope:a,id:o,focusable:u,active:f},Ie.createElement(_o.span,vn({tabIndex:R?0:-1,"data-orientation":k.orientation},w,{ref:n,onMouseDown:Gn(e.onMouseDown,G=>{u?k.onItemFocus(o):G.preventDefault()}),onFocus:Gn(e.onFocus,()=>k.onItemFocus(o)),onKeyDown:Gn(e.onKeyDown,G=>{if(G.key==="Tab"&&G.shiftKey){k.onItemShiftTab();return}if(G.target!==G.currentTarget)return;const U=lY(G,k.orientation,k.dir);if(U!==void 0){G.preventDefault();let X=F().filter(Y=>Y.focusable).map(Y=>Y.ref.current);if(U==="last")X.reverse();else if(U==="prev"||U==="next"){U==="prev"&&X.reverse();const Y=X.indexOf(G.currentTarget);X=k.loop?cY(X,Y+1):X.slice(Y+1)}setTimeout(()=>IO(X))}})})))}),sY={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function oY(e,n){return n!=="rtl"?e:e==="ArrowLeft"?"ArrowRight":e==="ArrowRight"?"ArrowLeft":e}function lY(e,n,a){const u=oY(e.key,a);if(!(n==="vertical"&&["ArrowLeft","ArrowRight"].includes(u))&&!(n==="horizontal"&&["ArrowUp","ArrowDown"].includes(u)))return sY[u]}function IO(e){const n=document.activeElement;for(const a of e)if(a===n||(a.focus(),document.activeElement!==n))return}function cY(e,n){return e.map((a,u)=>e[(n+u)%e.length])}const uY=rY,hY=aY;var fY=function(e){if(typeof document>"u")return null;var n=Array.isArray(e)?e[0]:e;return n.ownerDocument.body},Sd=new WeakMap,Ay=new WeakMap,Cy={},Qb=0,PO=function(e){return e&&(e.host||PO(e.parentNode))},dY=function(e,n){return n.map(function(a){if(e.contains(a))return a;var u=PO(a);return u&&e.contains(u)?u:(console.error("aria-hidden",a,"in not contained inside",e,". Doing nothing"),null)}).filter(function(a){return!!a})},pY=function(e,n,a,u){var f=dY(n,Array.isArray(e)?e:[e]);Cy[a]||(Cy[a]=new WeakMap);var _=Cy[a],w=[],T=new Set,o=new Set(f),k=function(F){!F||T.has(F)||(T.add(F),k(F.parentNode))};f.forEach(k);var R=function(F){!F||o.has(F)||Array.prototype.forEach.call(F.children,function(B){if(T.has(B))R(B);else try{var V=B.getAttribute(u),G=V!==null&&V!=="false",U=(Sd.get(B)||0)+1,J=(_.get(B)||0)+1;Sd.set(B,U),_.set(B,J),w.push(B),U===1&&G&&Ay.set(B,!0),J===1&&B.setAttribute(a,"true"),G||B.setAttribute(u,"true")}catch(X){console.error("aria-hidden: cannot operate on ",B,X)}})};return R(n),T.clear(),Qb++,function(){w.forEach(function(F){var B=Sd.get(F)-1,V=_.get(F)-1;Sd.set(F,B),_.set(F,V),B||(Ay.has(F)||F.removeAttribute(u),Ay.delete(F)),V||F.removeAttribute(a)}),Qb--,Qb||(Sd=new WeakMap,Sd=new WeakMap,Ay=new WeakMap,Cy={})}},mY=function(e,n,a){a===void 0&&(a="data-aria-hidden");var u=Array.from(Array.isArray(e)?e:[e]),f=n||fY(e);return f?(u.push.apply(u,Array.from(f.querySelectorAll("[aria-live]"))),pY(u,f,a,"aria-hidden")):function(){return null}},Cl=function(){return Cl=Object.assign||function(n){for(var a,u=1,f=arguments.length;u<f;u++){a=arguments[u];for(var _ in a)Object.prototype.hasOwnProperty.call(a,_)&&(n[_]=a[_])}return n},Cl.apply(this,arguments)};function RO(e,n){var a={};for(var u in e)Object.prototype.hasOwnProperty.call(e,u)&&n.indexOf(u)<0&&(a[u]=e[u]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var f=0,u=Object.getOwnPropertySymbols(e);f<u.length;f++)n.indexOf(u[f])<0&&Object.prototype.propertyIsEnumerable.call(e,u[f])&&(a[u[f]]=e[u[f]]);return a}function gY(e,n,a){if(a||arguments.length===2)for(var u=0,f=n.length,_;u<f;u++)(_||!(u in n))&&(_||(_=Array.prototype.slice.call(n,0,u)),_[u]=n[u]);return e.concat(_||Array.prototype.slice.call(n))}var Jy="right-scroll-bar-position",Qy="width-before-scroll-bar",_Y="with-scroll-bars-hidden",xY="--removed-body-scroll-bar-size";function eT(e,n){return typeof e=="function"?e(n):e&&(e.current=n),e}function yY(e,n){var a=Ie.useState(function(){return{value:e,callback:n,facade:{get current(){return a.value},set current(u){var f=a.value;f!==u&&(a.value=u,a.callback(u,f))}}}})[0];return a.callback=n,a.facade}var vY=typeof window<"u"?Ie.useLayoutEffect:Ie.useEffect,m4=new WeakMap;function wY(e,n){var a=yY(n||null,function(u){return e.forEach(function(f){return eT(f,u)})});return vY(function(){var u=m4.get(a);if(u){var f=new Set(u),_=new Set(e),w=a.current;f.forEach(function(T){_.has(T)||eT(T,null)}),_.forEach(function(T){f.has(T)||eT(T,w)})}m4.set(a,e)},[e]),a}function bY(e){return e}function TY(e,n){n===void 0&&(n=bY);var a=[],u=!1,f={read:function(){if(u)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return a.length?a[a.length-1]:e},useMedium:function(_){var w=n(_,u);return a.push(w),function(){a=a.filter(function(T){return T!==w})}},assignSyncMedium:function(_){for(u=!0;a.length;){var w=a;a=[],w.forEach(_)}a={push:function(T){return _(T)},filter:function(){return a}}},assignMedium:function(_){u=!0;var w=[];if(a.length){var T=a;a=[],T.forEach(_),w=a}var o=function(){var R=w;w=[],R.forEach(_)},k=function(){return Promise.resolve().then(o)};k(),a={push:function(R){w.push(R),k()},filter:function(R){return w=w.filter(R),a}}}};return f}function EY(e){e===void 0&&(e={});var n=TY(null);return n.options=Cl({async:!0,ssr:!1},e),n}var DO=function(e){var n=e.sideCar,a=RO(e,["sideCar"]);if(!n)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var u=n.read();if(!u)throw new Error("Sidecar medium not found");return Ie.createElement(u,Cl({},a))};DO.isSideCarExport=!0;function SY(e,n){return e.useMedium(n),DO}var FO=EY(),tT=function(){},gv=Ie.forwardRef(function(e,n){var a=Ie.useRef(null),u=Ie.useState({onScrollCapture:tT,onWheelCapture:tT,onTouchMoveCapture:tT}),f=u[0],_=u[1],w=e.forwardProps,T=e.children,o=e.className,k=e.removeScrollBar,R=e.enabled,F=e.shards,B=e.sideCar,V=e.noIsolation,G=e.inert,U=e.allowPinchZoom,J=e.as,X=J===void 0?"div":J,Y=RO(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as"]),Z=B,_e=wY([a,n]),ke=Cl(Cl({},Y),f);return Ie.createElement(Ie.Fragment,null,R&&Ie.createElement(Z,{sideCar:FO,removeScrollBar:k,shards:F,noIsolation:V,inert:G,setCallbacks:_,allowPinchZoom:!!U,lockRef:a}),w?Ie.cloneElement(Ie.Children.only(T),Cl(Cl({},ke),{ref:_e})):Ie.createElement(X,Cl({},ke,{className:o,ref:_e}),T))});gv.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};gv.classNames={fullWidth:Qy,zeroRight:Jy};var AY=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function CY(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var n=AY();return n&&e.setAttribute("nonce",n),e}function kY(e,n){e.styleSheet?e.styleSheet.cssText=n:e.appendChild(document.createTextNode(n))}function MY(e){var n=document.head||document.getElementsByTagName("head")[0];n.appendChild(e)}var IY=function(){var e=0,n=null;return{add:function(a){e==0&&(n=CY())&&(kY(n,a),MY(n)),e++},remove:function(){e--,!e&&n&&(n.parentNode&&n.parentNode.removeChild(n),n=null)}}},PY=function(){var e=IY();return function(n,a){Ie.useEffect(function(){return e.add(n),function(){e.remove()}},[n&&a])}},LO=function(){var e=PY(),n=function(a){var u=a.styles,f=a.dynamic;return e(u,f),null};return n},RY={left:0,top:0,right:0,gap:0},rT=function(e){return parseInt(e||"",10)||0},DY=function(e){var n=window.getComputedStyle(document.body),a=n[e==="padding"?"paddingLeft":"marginLeft"],u=n[e==="padding"?"paddingTop":"marginTop"],f=n[e==="padding"?"paddingRight":"marginRight"];return[rT(a),rT(u),rT(f)]},FY=function(e){if(e===void 0&&(e="margin"),typeof window>"u")return RY;var n=DY(e),a=document.documentElement.clientWidth,u=window.innerWidth;return{left:n[0],top:n[1],right:n[2],gap:Math.max(0,u-a+n[2]-n[0])}},LY=LO(),Qd="data-scroll-locked",OY=function(e,n,a,u){var f=e.left,_=e.top,w=e.right,T=e.gap;return a===void 0&&(a="margin"),`
  .`.concat(_Y,` {
   overflow: hidden `).concat(u,`;
   padding-right: `).concat(T,"px ").concat(u,`;
  }
  body[`).concat(Qd,`] {
    overflow: hidden `).concat(u,`;
    overscroll-behavior: contain;
    `).concat([n&&"position: relative ".concat(u,";"),a==="margin"&&`
    padding-left: `.concat(f,`px;
    padding-top: `).concat(_,`px;
    padding-right: `).concat(w,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(T,"px ").concat(u,`;
    `),a==="padding"&&"padding-right: ".concat(T,"px ").concat(u,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(Jy,` {
    right: `).concat(T,"px ").concat(u,`;
  }
  
  .`).concat(Qy,` {
    margin-right: `).concat(T,"px ").concat(u,`;
  }
  
  .`).concat(Jy," .").concat(Jy,` {
    right: 0 `).concat(u,`;
  }
  
  .`).concat(Qy," .").concat(Qy,` {
    margin-right: 0 `).concat(u,`;
  }
  
  body[`).concat(Qd,`] {
    `).concat(xY,": ").concat(T,`px;
  }
`)},g4=function(){var e=parseInt(document.body.getAttribute(Qd)||"0",10);return isFinite(e)?e:0},NY=function(){Ie.useEffect(function(){return document.body.setAttribute(Qd,(g4()+1).toString()),function(){var e=g4()-1;e<=0?document.body.removeAttribute(Qd):document.body.setAttribute(Qd,e.toString())}},[])},zY=function(e){var n=e.noRelative,a=e.noImportant,u=e.gapMode,f=u===void 0?"margin":u;NY();var _=Ie.useMemo(function(){return FY(f)},[f]);return Ie.createElement(LY,{styles:OY(_,!n,f,a?"":"!important")})},EE=!1;if(typeof window<"u")try{var ky=Object.defineProperty({},"passive",{get:function(){return EE=!0,!0}});window.addEventListener("test",ky,ky),window.removeEventListener("test",ky,ky)}catch{EE=!1}var Ad=EE?{passive:!1}:!1,BY=function(e){return e.tagName==="TEXTAREA"},OO=function(e,n){var a=window.getComputedStyle(e);return a[n]!=="hidden"&&!(a.overflowY===a.overflowX&&!BY(e)&&a[n]==="visible")},UY=function(e){return OO(e,"overflowY")},VY=function(e){return OO(e,"overflowX")},_4=function(e,n){var a=n;do{typeof ShadowRoot<"u"&&a instanceof ShadowRoot&&(a=a.host);var u=NO(e,a);if(u){var f=zO(e,a),_=f[1],w=f[2];if(_>w)return!0}a=a.parentNode}while(a&&a!==document.body);return!1},$Y=function(e){var n=e.scrollTop,a=e.scrollHeight,u=e.clientHeight;return[n,a,u]},jY=function(e){var n=e.scrollLeft,a=e.scrollWidth,u=e.clientWidth;return[n,a,u]},NO=function(e,n){return e==="v"?UY(n):VY(n)},zO=function(e,n){return e==="v"?$Y(n):jY(n)},GY=function(e,n){return e==="h"&&n==="rtl"?-1:1},HY=function(e,n,a,u,f){var _=GY(e,window.getComputedStyle(n).direction),w=_*u,T=a.target,o=n.contains(T),k=!1,R=w>0,F=0,B=0;do{var V=zO(e,T),G=V[0],U=V[1],J=V[2],X=U-J-_*G;(G||X)&&NO(e,T)&&(F+=X,B+=G),T=T.parentNode}while(!o&&T!==document.body||o&&(n.contains(T)||n===T));return(R&&(f&&F===0||!f&&w>F)||!R&&(f&&B===0||!f&&-w>B))&&(k=!0),k},My=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},x4=function(e){return[e.deltaX,e.deltaY]},y4=function(e){return e&&"current"in e?e.current:e},WY=function(e,n){return e[0]===n[0]&&e[1]===n[1]},qY=function(e){return`
  .block-interactivity-`.concat(e,` {pointer-events: none;}
  .allow-interactivity-`).concat(e,` {pointer-events: all;}
`)},ZY=0,Cd=[];function XY(e){var n=Ie.useRef([]),a=Ie.useRef([0,0]),u=Ie.useRef(),f=Ie.useState(ZY++)[0],_=Ie.useState(function(){return LO()})[0],w=Ie.useRef(e);Ie.useEffect(function(){w.current=e},[e]),Ie.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(f));var U=gY([e.lockRef.current],(e.shards||[]).map(y4),!0).filter(Boolean);return U.forEach(function(J){return J.classList.add("allow-interactivity-".concat(f))}),function(){document.body.classList.remove("block-interactivity-".concat(f)),U.forEach(function(J){return J.classList.remove("allow-interactivity-".concat(f))})}}},[e.inert,e.lockRef.current,e.shards]);var T=Ie.useCallback(function(U,J){if("touches"in U&&U.touches.length===2)return!w.current.allowPinchZoom;var X=My(U),Y=a.current,Z="deltaX"in U?U.deltaX:Y[0]-X[0],_e="deltaY"in U?U.deltaY:Y[1]-X[1],ke,Ae=U.target,me=Math.abs(Z)>Math.abs(_e)?"h":"v";if("touches"in U&&me==="h"&&Ae.type==="range")return!1;var De=_4(me,Ae);if(!De)return!0;if(De?ke=me:(ke=me==="v"?"h":"v",De=_4(me,Ae)),!De)return!1;if(!u.current&&"changedTouches"in U&&(Z||_e)&&(u.current=ke),!ke)return!0;var we=u.current||ke;return HY(we,J,U,we==="h"?Z:_e,!0)},[]),o=Ie.useCallback(function(U){var J=U;if(!(!Cd.length||Cd[Cd.length-1]!==_)){var X="deltaY"in J?x4(J):My(J),Y=n.current.filter(function(ke){return ke.name===J.type&&ke.target===J.target&&WY(ke.delta,X)})[0];if(Y&&Y.should){J.cancelable&&J.preventDefault();return}if(!Y){var Z=(w.current.shards||[]).map(y4).filter(Boolean).filter(function(ke){return ke.contains(J.target)}),_e=Z.length>0?T(J,Z[0]):!w.current.noIsolation;_e&&J.cancelable&&J.preventDefault()}}},[]),k=Ie.useCallback(function(U,J,X,Y){var Z={name:U,delta:J,target:X,should:Y};n.current.push(Z),setTimeout(function(){n.current=n.current.filter(function(_e){return _e!==Z})},1)},[]),R=Ie.useCallback(function(U){a.current=My(U),u.current=void 0},[]),F=Ie.useCallback(function(U){k(U.type,x4(U),U.target,T(U,e.lockRef.current))},[]),B=Ie.useCallback(function(U){k(U.type,My(U),U.target,T(U,e.lockRef.current))},[]);Ie.useEffect(function(){return Cd.push(_),e.setCallbacks({onScrollCapture:F,onWheelCapture:F,onTouchMoveCapture:B}),document.addEventListener("wheel",o,Ad),document.addEventListener("touchmove",o,Ad),document.addEventListener("touchstart",R,Ad),function(){Cd=Cd.filter(function(U){return U!==_}),document.removeEventListener("wheel",o,Ad),document.removeEventListener("touchmove",o,Ad),document.removeEventListener("touchstart",R,Ad)}},[]);var V=e.removeScrollBar,G=e.inert;return Ie.createElement(Ie.Fragment,null,G?Ie.createElement(_,{styles:qY(f)}):null,V?Ie.createElement(zY,{gapMode:"margin"}):null)}const YY=SY(FO,XY);var BO=Ie.forwardRef(function(e,n){return Ie.createElement(gv,Cl({},e,{ref:n,sideCar:YY}))});BO.classNames=gv.classNames;const KY=BO,SE=["Enter"," "],JY=["ArrowDown","PageUp","Home"],UO=["ArrowUp","PageDown","End"],QY=[...JY,...UO],eK={ltr:[...SE,"ArrowRight"],rtl:[...SE,"ArrowLeft"]},tK={ltr:["ArrowLeft"],rtl:["ArrowRight"]},_v="Menu",[Bg,rK,nK]=lO(_v),[xf,VO]=t_(_v,[nK,EO,MO]),pA=EO(),$O=MO(),[iK,yf]=xf(_v),[aK,i_]=xf(_v),sK=e=>{const{__scopeMenu:n,open:a=!1,children:u,dir:f,onOpenChange:_,modal:w=!0}=e,T=pA(n),[o,k]=Ie.useState(null),R=Ie.useRef(!1),F=Rl(_),B=cO(f);return Ie.useEffect(()=>{const V=()=>{R.current=!0,document.addEventListener("pointerdown",G,{capture:!0,once:!0}),document.addEventListener("pointermove",G,{capture:!0,once:!0})},G=()=>R.current=!1;return document.addEventListener("keydown",V,{capture:!0}),()=>{document.removeEventListener("keydown",V,{capture:!0}),document.removeEventListener("pointerdown",G,{capture:!0}),document.removeEventListener("pointermove",G,{capture:!0})}},[]),Ie.createElement(HX,T,Ie.createElement(iK,{scope:n,open:a,onOpenChange:F,content:o,onContentChange:k},Ie.createElement(aK,{scope:n,onClose:Ie.useCallback(()=>F(!1),[F]),isUsingKeyboardRef:R,dir:B,modal:w},u)))},jO=Ie.forwardRef((e,n)=>{const{__scopeMenu:a,...u}=e,f=pA(a);return Ie.createElement(WX,vn({},f,u,{ref:n}))}),GO="MenuPortal",[oK,HO]=xf(GO,{forceMount:void 0}),lK=e=>{const{__scopeMenu:n,forceMount:a,children:u,container:f}=e,_=yf(GO,n);return Ie.createElement(oK,{scope:n,forceMount:a},Ie.createElement(n_,{present:a||_.open},Ie.createElement(ZX,{asChild:!0,container:f},u)))},Ko="MenuContent",[cK,mA]=xf(Ko),uK=Ie.forwardRef((e,n)=>{const a=HO(Ko,e.__scopeMenu),{forceMount:u=a.forceMount,...f}=e,_=yf(Ko,e.__scopeMenu),w=i_(Ko,e.__scopeMenu);return Ie.createElement(Bg.Provider,{scope:e.__scopeMenu},Ie.createElement(n_,{present:u||_.open},Ie.createElement(Bg.Slot,{scope:e.__scopeMenu},w.modal?Ie.createElement(hK,vn({},f,{ref:n})):Ie.createElement(fK,vn({},f,{ref:n})))))}),hK=Ie.forwardRef((e,n)=>{const a=yf(Ko,e.__scopeMenu),u=Ie.useRef(null),f=qs(n,u);return Ie.useEffect(()=>{const _=u.current;if(_)return mY(_)},[]),Ie.createElement(gA,vn({},e,{ref:f,trapFocus:a.open,disableOutsidePointerEvents:a.open,disableOutsideScroll:!0,onFocusOutside:Gn(e.onFocusOutside,_=>_.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>a.onOpenChange(!1)}))}),fK=Ie.forwardRef((e,n)=>{const a=yf(Ko,e.__scopeMenu);return Ie.createElement(gA,vn({},e,{ref:n,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>a.onOpenChange(!1)}))}),gA=Ie.forwardRef((e,n)=>{const{__scopeMenu:a,loop:u=!1,trapFocus:f,onOpenAutoFocus:_,onCloseAutoFocus:w,disableOutsidePointerEvents:T,onEntryFocus:o,onEscapeKeyDown:k,onPointerDownOutside:R,onFocusOutside:F,onInteractOutside:B,onDismiss:V,disableOutsideScroll:G,...U}=e,J=yf(Ko,a),X=i_(Ko,a),Y=pA(a),Z=$O(a),_e=rK(a),[ke,Ae]=Ie.useState(null),me=Ie.useRef(null),De=qs(n,me,J.onContentChange),we=Ie.useRef(0),Je=Ie.useRef(""),rt=Ie.useRef(0),Re=Ie.useRef(null),St=Ie.useRef("right"),Lt=Ie.useRef(0),We=G?KY:Ie.Fragment,qt=G?{as:up,allowPinchZoom:!0}:void 0,Ot=Ve=>{var Et,Dt;const Se=Je.current+Ve,at=_e().filter(Xt=>!Xt.disabled),He=document.activeElement,Xe=(Et=at.find(Xt=>Xt.ref.current===He))===null||Et===void 0?void 0:Et.textValue,yt=at.map(Xt=>Xt.textValue),Jt=kK(yt,Se,Xe),sr=(Dt=at.find(Xt=>Xt.textValue===Jt))===null||Dt===void 0?void 0:Dt.ref.current;(function Xt(zt){Je.current=zt,window.clearTimeout(we.current),zt!==""&&(we.current=window.setTimeout(()=>Xt(""),1e3))})(Se),sr&&setTimeout(()=>sr.focus())};Ie.useEffect(()=>()=>window.clearTimeout(we.current),[]),OZ();const st=Ie.useCallback(Ve=>{var Et,Dt;return St.current===((Et=Re.current)===null||Et===void 0?void 0:Et.side)&&IK(Ve,(Dt=Re.current)===null||Dt===void 0?void 0:Dt.area)},[]);return Ie.createElement(cK,{scope:a,searchRef:Je,onItemEnter:Ie.useCallback(Ve=>{st(Ve)&&Ve.preventDefault()},[st]),onItemLeave:Ie.useCallback(Ve=>{var Et;st(Ve)||((Et=me.current)===null||Et===void 0||Et.focus(),Ae(null))},[st]),onTriggerLeave:Ie.useCallback(Ve=>{st(Ve)&&Ve.preventDefault()},[st]),pointerGraceTimerRef:rt,onPointerGraceIntentChange:Ie.useCallback(Ve=>{Re.current=Ve},[])},Ie.createElement(We,qt,Ie.createElement(NZ,{asChild:!0,trapped:f,onMountAutoFocus:Gn(_,Ve=>{var Et;Ve.preventDefault(),(Et=me.current)===null||Et===void 0||Et.focus()}),onUnmountAutoFocus:w},Ie.createElement(DZ,{asChild:!0,disableOutsidePointerEvents:T,onEscapeKeyDown:k,onPointerDownOutside:R,onFocusOutside:F,onInteractOutside:B,onDismiss:V},Ie.createElement(uY,vn({asChild:!0},Z,{dir:X.dir,orientation:"vertical",loop:u,currentTabStopId:ke,onCurrentTabStopIdChange:Ae,onEntryFocus:Gn(o,Ve=>{X.isUsingKeyboardRef.current||Ve.preventDefault()})}),Ie.createElement(qX,vn({role:"menu","aria-orientation":"vertical","data-state":YO(J.open),"data-radix-menu-content":"",dir:X.dir},Y,U,{ref:De,style:{outline:"none",...U.style},onKeyDown:Gn(U.onKeyDown,Ve=>{const Dt=Ve.target.closest("[data-radix-menu-content]")===Ve.currentTarget,Se=Ve.ctrlKey||Ve.altKey||Ve.metaKey,at=Ve.key.length===1;Dt&&(Ve.key==="Tab"&&Ve.preventDefault(),!Se&&at&&Ot(Ve.key));const He=me.current;if(Ve.target!==He||!QY.includes(Ve.key))return;Ve.preventDefault();const yt=_e().filter(Jt=>!Jt.disabled).map(Jt=>Jt.ref.current);UO.includes(Ve.key)&&yt.reverse(),AK(yt)}),onBlur:Gn(e.onBlur,Ve=>{Ve.currentTarget.contains(Ve.target)||(window.clearTimeout(we.current),Je.current="")}),onPointerMove:Gn(e.onPointerMove,Ug(Ve=>{const Et=Ve.target,Dt=Lt.current!==Ve.clientX;if(Ve.currentTarget.contains(Et)&&Dt){const Se=Ve.clientX>Lt.current?"right":"left";St.current=Se,Lt.current=Ve.clientX}}))})))))))}),dK=Ie.forwardRef((e,n)=>{const{__scopeMenu:a,...u}=e;return Ie.createElement(_o.div,vn({},u,{ref:n}))}),AE="MenuItem",v4="menu.itemSelect",_A=Ie.forwardRef((e,n)=>{const{disabled:a=!1,onSelect:u,...f}=e,_=Ie.useRef(null),w=i_(AE,e.__scopeMenu),T=mA(AE,e.__scopeMenu),o=qs(n,_),k=Ie.useRef(!1),R=()=>{const F=_.current;if(!a&&F){const B=new CustomEvent(v4,{bubbles:!0,cancelable:!0});F.addEventListener(v4,V=>u==null?void 0:u(V),{once:!0}),oO(F,B),B.defaultPrevented?k.current=!1:w.onClose()}};return Ie.createElement(WO,vn({},f,{ref:o,disabled:a,onClick:Gn(e.onClick,R),onPointerDown:F=>{var B;(B=e.onPointerDown)===null||B===void 0||B.call(e,F),k.current=!0},onPointerUp:Gn(e.onPointerUp,F=>{var B;k.current||(B=F.currentTarget)===null||B===void 0||B.click()}),onKeyDown:Gn(e.onKeyDown,F=>{const B=T.searchRef.current!=="";a||B&&F.key===" "||SE.includes(F.key)&&(F.currentTarget.click(),F.preventDefault())})}))}),WO=Ie.forwardRef((e,n)=>{const{__scopeMenu:a,disabled:u=!1,textValue:f,..._}=e,w=mA(AE,a),T=$O(a),o=Ie.useRef(null),k=qs(n,o),[R,F]=Ie.useState(!1),[B,V]=Ie.useState("");return Ie.useEffect(()=>{const G=o.current;if(G){var U;V(((U=G.textContent)!==null&&U!==void 0?U:"").trim())}},[_.children]),Ie.createElement(Bg.ItemSlot,{scope:a,disabled:u,textValue:f??B},Ie.createElement(hY,vn({asChild:!0},T,{focusable:!u}),Ie.createElement(_o.div,vn({role:"menuitem","data-highlighted":R?"":void 0,"aria-disabled":u||void 0,"data-disabled":u?"":void 0},_,{ref:k,onPointerMove:Gn(e.onPointerMove,Ug(G=>{u?w.onItemLeave(G):(w.onItemEnter(G),G.defaultPrevented||G.currentTarget.focus())})),onPointerLeave:Gn(e.onPointerLeave,Ug(G=>w.onItemLeave(G))),onFocus:Gn(e.onFocus,()=>F(!0)),onBlur:Gn(e.onBlur,()=>F(!1))}))))}),pK=Ie.forwardRef((e,n)=>{const{checked:a=!1,onCheckedChange:u,...f}=e;return Ie.createElement(ZO,{scope:e.__scopeMenu,checked:a},Ie.createElement(_A,vn({role:"menuitemcheckbox","aria-checked":V1(a)?"mixed":a},f,{ref:n,"data-state":xA(a),onSelect:Gn(f.onSelect,()=>u==null?void 0:u(V1(a)?!0:!a),{checkForDefaultPrevented:!1})})))}),mK="MenuRadioGroup",[mQ,gK]=xf(mK,{value:void 0,onValueChange:()=>{}}),_K="MenuRadioItem",xK=Ie.forwardRef((e,n)=>{const{value:a,...u}=e,f=gK(_K,e.__scopeMenu),_=a===f.value;return Ie.createElement(ZO,{scope:e.__scopeMenu,checked:_},Ie.createElement(_A,vn({role:"menuitemradio","aria-checked":_},u,{ref:n,"data-state":xA(_),onSelect:Gn(u.onSelect,()=>{var w;return(w=f.onValueChange)===null||w===void 0?void 0:w.call(f,a)},{checkForDefaultPrevented:!1})})))}),qO="MenuItemIndicator",[ZO,yK]=xf(qO,{checked:!1}),vK=Ie.forwardRef((e,n)=>{const{__scopeMenu:a,forceMount:u,...f}=e,_=yK(qO,a);return Ie.createElement(n_,{present:u||V1(_.checked)||_.checked===!0},Ie.createElement(_o.span,vn({},f,{ref:n,"data-state":xA(_.checked)})))}),wK=Ie.forwardRef((e,n)=>{const{__scopeMenu:a,...u}=e;return Ie.createElement(_o.div,vn({role:"separator","aria-orientation":"horizontal"},u,{ref:n}))}),bK="MenuSub",[gQ,XO]=xf(bK),Iy="MenuSubTrigger",TK=Ie.forwardRef((e,n)=>{const a=yf(Iy,e.__scopeMenu),u=i_(Iy,e.__scopeMenu),f=XO(Iy,e.__scopeMenu),_=mA(Iy,e.__scopeMenu),w=Ie.useRef(null),{pointerGraceTimerRef:T,onPointerGraceIntentChange:o}=_,k={__scopeMenu:e.__scopeMenu},R=Ie.useCallback(()=>{w.current&&window.clearTimeout(w.current),w.current=null},[]);return Ie.useEffect(()=>R,[R]),Ie.useEffect(()=>{const F=T.current;return()=>{window.clearTimeout(F),o(null)}},[T,o]),Ie.createElement(jO,vn({asChild:!0},k),Ie.createElement(WO,vn({id:f.triggerId,"aria-haspopup":"menu","aria-expanded":a.open,"aria-controls":f.contentId,"data-state":YO(a.open)},e,{ref:dv(n,f.onTriggerChange),onClick:F=>{var B;(B=e.onClick)===null||B===void 0||B.call(e,F),!(e.disabled||F.defaultPrevented)&&(F.currentTarget.focus(),a.open||a.onOpenChange(!0))},onPointerMove:Gn(e.onPointerMove,Ug(F=>{_.onItemEnter(F),!F.defaultPrevented&&!e.disabled&&!a.open&&!w.current&&(_.onPointerGraceIntentChange(null),w.current=window.setTimeout(()=>{a.onOpenChange(!0),R()},100))})),onPointerLeave:Gn(e.onPointerLeave,Ug(F=>{var B;R();const V=(B=a.content)===null||B===void 0?void 0:B.getBoundingClientRect();if(V){var G;const U=(G=a.content)===null||G===void 0?void 0:G.dataset.side,J=U==="right",X=J?-5:5,Y=V[J?"left":"right"],Z=V[J?"right":"left"];_.onPointerGraceIntentChange({area:[{x:F.clientX+X,y:F.clientY},{x:Y,y:V.top},{x:Z,y:V.top},{x:Z,y:V.bottom},{x:Y,y:V.bottom}],side:U}),window.clearTimeout(T.current),T.current=window.setTimeout(()=>_.onPointerGraceIntentChange(null),300)}else{if(_.onTriggerLeave(F),F.defaultPrevented)return;_.onPointerGraceIntentChange(null)}})),onKeyDown:Gn(e.onKeyDown,F=>{const B=_.searchRef.current!=="";if(!(e.disabled||B&&F.key===" ")&&eK[u.dir].includes(F.key)){var V;a.onOpenChange(!0),(V=a.content)===null||V===void 0||V.focus(),F.preventDefault()}})})))}),EK="MenuSubContent",SK=Ie.forwardRef((e,n)=>{const a=HO(Ko,e.__scopeMenu),{forceMount:u=a.forceMount,...f}=e,_=yf(Ko,e.__scopeMenu),w=i_(Ko,e.__scopeMenu),T=XO(EK,e.__scopeMenu),o=Ie.useRef(null),k=qs(n,o);return Ie.createElement(Bg.Provider,{scope:e.__scopeMenu},Ie.createElement(n_,{present:u||_.open},Ie.createElement(Bg.Slot,{scope:e.__scopeMenu},Ie.createElement(gA,vn({id:T.contentId,"aria-labelledby":T.triggerId},f,{ref:k,align:"start",side:w.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:R=>{var F;w.isUsingKeyboardRef.current&&((F=o.current)===null||F===void 0||F.focus()),R.preventDefault()},onCloseAutoFocus:R=>R.preventDefault(),onFocusOutside:Gn(e.onFocusOutside,R=>{R.target!==T.trigger&&_.onOpenChange(!1)}),onEscapeKeyDown:Gn(e.onEscapeKeyDown,R=>{w.onClose(),R.preventDefault()}),onKeyDown:Gn(e.onKeyDown,R=>{const F=R.currentTarget.contains(R.target),B=tK[w.dir].includes(R.key);if(F&&B){var V;_.onOpenChange(!1),(V=T.trigger)===null||V===void 0||V.focus(),R.preventDefault()}})})))))});function YO(e){return e?"open":"closed"}function V1(e){return e==="indeterminate"}function xA(e){return V1(e)?"indeterminate":e?"checked":"unchecked"}function AK(e){const n=document.activeElement;for(const a of e)if(a===n||(a.focus(),document.activeElement!==n))return}function CK(e,n){return e.map((a,u)=>e[(n+u)%e.length])}function kK(e,n,a){const f=n.length>1&&Array.from(n).every(k=>k===n[0])?n[0]:n,_=a?e.indexOf(a):-1;let w=CK(e,Math.max(_,0));f.length===1&&(w=w.filter(k=>k!==a));const o=w.find(k=>k.toLowerCase().startsWith(f.toLowerCase()));return o!==a?o:void 0}function MK(e,n){const{x:a,y:u}=e;let f=!1;for(let _=0,w=n.length-1;_<n.length;w=_++){const T=n[_].x,o=n[_].y,k=n[w].x,R=n[w].y;o>u!=R>u&&a<(k-T)*(u-o)/(R-o)+T&&(f=!f)}return f}function IK(e,n){if(!n)return!1;const a={x:e.clientX,y:e.clientY};return MK(a,n)}function Ug(e){return n=>n.pointerType==="mouse"?e(n):void 0}const PK=sK,RK=jO,DK=lK,FK=uK,LK=dK,OK=_A,NK=pK,zK=xK,BK=vK,UK=wK,VK=TK,$K=SK,KO="DropdownMenu",[jK,_Q]=t_(KO,[VO]),xo=VO(),[GK,JO]=jK(KO),HK=e=>{const{__scopeDropdownMenu:n,children:a,dir:u,open:f,defaultOpen:_,onOpenChange:w,modal:T=!0}=e,o=xo(n),k=Ie.useRef(null),[R=!1,F]=sO({prop:f,defaultProp:_,onChange:w});return Ie.createElement(GK,{scope:n,triggerId:vE(),triggerRef:k,contentId:vE(),open:R,onOpenChange:F,onOpenToggle:Ie.useCallback(()=>F(B=>!B),[F]),modal:T},Ie.createElement(PK,vn({},o,{open:R,onOpenChange:F,dir:u,modal:T}),a))},WK="DropdownMenuTrigger",qK=Ie.forwardRef((e,n)=>{const{__scopeDropdownMenu:a,disabled:u=!1,...f}=e,_=JO(WK,a),w=xo(a);return Ie.createElement(RK,vn({asChild:!0},w),Ie.createElement(_o.button,vn({type:"button",id:_.triggerId,"aria-haspopup":"menu","aria-expanded":_.open,"aria-controls":_.open?_.contentId:void 0,"data-state":_.open?"open":"closed","data-disabled":u?"":void 0,disabled:u},f,{ref:dv(n,_.triggerRef),onPointerDown:Gn(e.onPointerDown,T=>{!u&&T.button===0&&T.ctrlKey===!1&&(_.onOpenToggle(),_.open||T.preventDefault())}),onKeyDown:Gn(e.onKeyDown,T=>{u||(["Enter"," "].includes(T.key)&&_.onOpenToggle(),T.key==="ArrowDown"&&_.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(T.key)&&T.preventDefault())})})))}),ZK=e=>{const{__scopeDropdownMenu:n,...a}=e,u=xo(n);return Ie.createElement(DK,vn({},u,a))},XK="DropdownMenuContent",YK=Ie.forwardRef((e,n)=>{const{__scopeDropdownMenu:a,...u}=e,f=JO(XK,a),_=xo(a),w=Ie.useRef(!1);return Ie.createElement(FK,vn({id:f.contentId,"aria-labelledby":f.triggerId},_,u,{ref:n,onCloseAutoFocus:Gn(e.onCloseAutoFocus,T=>{var o;w.current||(o=f.triggerRef.current)===null||o===void 0||o.focus(),w.current=!1,T.preventDefault()}),onInteractOutside:Gn(e.onInteractOutside,T=>{const o=T.detail.originalEvent,k=o.button===0&&o.ctrlKey===!0,R=o.button===2||k;(!f.modal||R)&&(w.current=!0)}),style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}}))}),KK=Ie.forwardRef((e,n)=>{const{__scopeDropdownMenu:a,...u}=e,f=xo(a);return Ie.createElement(LK,vn({},f,u,{ref:n}))}),JK=Ie.forwardRef((e,n)=>{const{__scopeDropdownMenu:a,...u}=e,f=xo(a);return Ie.createElement(OK,vn({},f,u,{ref:n}))}),QK=Ie.forwardRef((e,n)=>{const{__scopeDropdownMenu:a,...u}=e,f=xo(a);return Ie.createElement(NK,vn({},f,u,{ref:n}))}),eJ=Ie.forwardRef((e,n)=>{const{__scopeDropdownMenu:a,...u}=e,f=xo(a);return Ie.createElement(zK,vn({},f,u,{ref:n}))}),tJ=Ie.forwardRef((e,n)=>{const{__scopeDropdownMenu:a,...u}=e,f=xo(a);return Ie.createElement(BK,vn({},f,u,{ref:n}))}),rJ=Ie.forwardRef((e,n)=>{const{__scopeDropdownMenu:a,...u}=e,f=xo(a);return Ie.createElement(UK,vn({},f,u,{ref:n}))}),nJ=Ie.forwardRef((e,n)=>{const{__scopeDropdownMenu:a,...u}=e,f=xo(a);return Ie.createElement(VK,vn({},f,u,{ref:n}))}),iJ=Ie.forwardRef((e,n)=>{const{__scopeDropdownMenu:a,...u}=e,f=xo(a);return Ie.createElement($K,vn({},f,u,{ref:n,style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}}))}),aJ=HK,sJ=qK,oJ=ZK,QO=YK,e5=KK,t5=JK,r5=QK,n5=eJ,i5=tJ,a5=rJ,s5=nJ,o5=iJ;/**
 * @license lucide-react v0.368.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var lJ={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.368.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cJ=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase();/**
 * @license lucide-react v0.368.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yA=(e,n)=>{const a=Ie.forwardRef(({color:u="currentColor",size:f=24,strokeWidth:_=2,absoluteStrokeWidth:w,className:T="",children:o,...k},R)=>Ie.createElement("svg",{ref:R,...lJ,width:f,height:f,stroke:u,strokeWidth:w?Number(_)*24/Number(f):_,className:["lucide",`lucide-${cJ(e)}`,T].join(" "),...k},[...n.map(([F,B])=>Ie.createElement(F,B)),...Array.isArray(o)?o:[o]]));return a.displayName=`${e}`,a};/**
 * @license lucide-react v0.368.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uJ=yA("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.368.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hJ=yA("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.368.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fJ=yA("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),w4=aJ,b4=sJ,dJ=Ie.forwardRef(({className:e,inset:n,children:a,...u},f)=>Lr.jsxs(s5,{ref:f,className:ws("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",n&&"pl-8",e),...u,children:[a,Lr.jsx(hJ,{className:"ml-auto h-4 w-4"})]}));dJ.displayName=s5.displayName;const pJ=Ie.forwardRef(({className:e,...n},a)=>Lr.jsx(o5,{ref:a,className:ws("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...n}));pJ.displayName=o5.displayName;const CE=Ie.forwardRef(({className:e,sideOffset:n=4,...a},u)=>Lr.jsx(oJ,{children:Lr.jsx(QO,{ref:u,sideOffset:n,className:ws("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...a})}));CE.displayName=QO.displayName;const kE=Ie.forwardRef(({className:e,inset:n,...a},u)=>Lr.jsx(t5,{ref:u,className:ws("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",n&&"pl-8",e),...a}));kE.displayName=t5.displayName;const Hm=Ie.forwardRef(({className:e,children:n,checked:a,...u},f)=>Lr.jsxs(r5,{ref:f,className:ws("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),checked:a,...u,children:[Lr.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:Lr.jsx(i5,{children:Lr.jsx(uJ,{className:"h-4 w-4"})})}),n]}));Hm.displayName=r5.displayName;const mJ=Ie.forwardRef(({className:e,children:n,...a},u)=>Lr.jsxs(n5,{ref:u,className:ws("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...a,children:[Lr.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:Lr.jsx(i5,{children:Lr.jsx(fJ,{className:"h-2 w-2 fill-current"})})}),n]}));mJ.displayName=n5.displayName;const gJ=Ie.forwardRef(({className:e,inset:n,...a},u)=>Lr.jsx(e5,{ref:u,className:ws("px-2 py-1.5 text-sm font-semibold",n&&"pl-8",e),...a}));gJ.displayName=e5.displayName;const _J=Ie.forwardRef(({className:e,...n},a)=>Lr.jsx(a5,{ref:a,className:ws("-mx-1 my-1 h-px bg-muted",e),...n}));_J.displayName=a5.displayName;var{entries:l5,setPrototypeOf:T4,isFrozen:xJ,getPrototypeOf:yJ,getOwnPropertyDescriptor:vJ}=Object,{freeze:ss,seal:mo,create:c5}=Object,{apply:ME,construct:IE}=typeof Reflect<"u"&&Reflect;ss||(ss=function(e){return e});mo||(mo=function(e){return e});ME||(ME=function(e,n,a){return e.apply(n,a)});IE||(IE=function(e,n){return new e(...n)});var Py=Zs(Array.prototype.forEach),E4=Zs(Array.prototype.pop),Fm=Zs(Array.prototype.push),e1=Zs(String.prototype.toLowerCase),nT=Zs(String.prototype.toString),S4=Zs(String.prototype.match),Lm=Zs(String.prototype.replace),wJ=Zs(String.prototype.indexOf),bJ=Zs(String.prototype.trim),Uo=Zs(Object.prototype.hasOwnProperty),Ns=Zs(RegExp.prototype.test),Om=TJ(TypeError);function Zs(e){return function(n){for(var a=arguments.length,u=new Array(a>1?a-1:0),f=1;f<a;f++)u[f-1]=arguments[f];return ME(e,n,u)}}function TJ(e){return function(){for(var n=arguments.length,a=new Array(n),u=0;u<n;u++)a[u]=arguments[u];return IE(e,a)}}function Dn(e,n){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e1;T4&&T4(e,null);let u=n.length;for(;u--;){let f=n[u];if(typeof f=="string"){let _=a(f);_!==f&&(xJ(n)||(n[u]=_),f=_)}e[f]=!0}return e}function EJ(e){for(let n=0;n<e.length;n++)Uo(e,n)||(e[n]=null);return e}function jh(e){let n=c5(null);for(let[a,u]of l5(e))Uo(e,a)&&(Array.isArray(u)?n[a]=EJ(u):u&&typeof u=="object"&&u.constructor===Object?n[a]=jh(u):n[a]=u);return n}function Ry(e,n){for(;e!==null;){let u=vJ(e,n);if(u){if(u.get)return Zs(u.get);if(typeof u.value=="function")return Zs(u.value)}e=yJ(e)}function a(){return null}return a}var A4=ss(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),iT=ss(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),aT=ss(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),SJ=ss(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),sT=ss(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),AJ=ss(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),C4=ss(["#text"]),k4=ss(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","xmlns","slot"]),oT=ss(["accent-height","accumulate","additive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),M4=ss(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Dy=ss(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),CJ=mo(/\{\{[\w\W]*|[\w\W]*\}\}/gm),kJ=mo(/<%[\w\W]*|[\w\W]*%>/gm),MJ=mo(/\${[\w\W]*}/gm),IJ=mo(/^data-[\-\w.\u00B7-\uFFFF]/),PJ=mo(/^aria-[\-\w]+$/),u5=mo(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),RJ=mo(/^(?:\w+script|data):/i),DJ=mo(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),h5=mo(/^html$/i),FJ=mo(/^[a-z][a-z\d]*(-[a-z\d]+)+$/i),I4=Object.freeze({__proto__:null,MUSTACHE_EXPR:CJ,ERB_EXPR:kJ,TMPLIT_EXPR:MJ,DATA_ATTR:IJ,ARIA_ATTR:PJ,IS_ALLOWED_URI:u5,IS_SCRIPT_OR_DATA:RJ,ATTR_WHITESPACE:DJ,DOCTYPE_NAME:h5,CUSTOM_ELEMENT:FJ}),LJ=function(){return typeof window>"u"?null:window},OJ=function(e,n){if(typeof e!="object"||typeof e.createPolicy!="function")return null;let a=null,u="data-tt-policy-suffix";n&&n.hasAttribute(u)&&(a=n.getAttribute(u));let f="dompurify"+(a?"#"+a:"");try{return e.createPolicy(f,{createHTML(_){return _},createScriptURL(_){return _}})}catch{return console.warn("TrustedTypes policy "+f+" could not be created."),null}};function f5(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:LJ(),n=ce=>f5(ce);if(n.version="3.0.10",n.removed=[],!e||!e.document||e.document.nodeType!==9)return n.isSupported=!1,n;let{document:a}=e,u=a,f=u.currentScript,{DocumentFragment:_,HTMLTemplateElement:w,Node:T,Element:o,NodeFilter:k,NamedNodeMap:R=e.NamedNodeMap||e.MozNamedAttrMap,HTMLFormElement:F,DOMParser:B,trustedTypes:V}=e,G=o.prototype,U=Ry(G,"cloneNode"),J=Ry(G,"nextSibling"),X=Ry(G,"childNodes"),Y=Ry(G,"parentNode");if(typeof w=="function"){let ce=a.createElement("template");ce.content&&ce.content.ownerDocument&&(a=ce.content.ownerDocument)}let Z,_e="",{implementation:ke,createNodeIterator:Ae,createDocumentFragment:me,getElementsByTagName:De}=a,{importNode:we}=u,Je={};n.isSupported=typeof l5=="function"&&typeof Y=="function"&&ke&&ke.createHTMLDocument!==void 0;let{MUSTACHE_EXPR:rt,ERB_EXPR:Re,TMPLIT_EXPR:St,DATA_ATTR:Lt,ARIA_ATTR:We,IS_SCRIPT_OR_DATA:qt,ATTR_WHITESPACE:Ot,CUSTOM_ELEMENT:st}=I4,{IS_ALLOWED_URI:Ve}=I4,Et=null,Dt=Dn({},[...A4,...iT,...aT,...sT,...C4]),Se=null,at=Dn({},[...k4,...oT,...M4,...Dy]),He=Object.seal(c5(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),Xe=null,yt=null,Jt=!0,sr=!0,Xt=!1,zt=!0,Or=!1,Be=!1,Fn=!1,Tr=!1,Er=!1,Ir=!1,nr=!1,En=!0,Xn=!1,wn="user-content-",ei=!0,bi=!1,Mn={},Nn=null,ti=Dn({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]),gt=null,le=Dn({},["audio","video","img","source","image","track"]),Te=null,Ne=Dn({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),et="http://www.w3.org/1998/Math/MathML",ut="http://www.w3.org/2000/svg",_t="http://www.w3.org/1999/xhtml",$t=_t,dt=!1,kt=null,Vt=Dn({},[et,ut,_t],nT),Wt=null,br=["application/xhtml+xml","text/html"],Hr="text/html",Nr=null,tn=null,ln=a.createElement("form"),Xr=function(ce){return ce instanceof RegExp||ce instanceof Function},dn=function(){let ce=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(tn&&tn===ce)){if((!ce||typeof ce!="object")&&(ce={}),ce=jh(ce),Wt=br.indexOf(ce.PARSER_MEDIA_TYPE)===-1?Hr:ce.PARSER_MEDIA_TYPE,Nr=Wt==="application/xhtml+xml"?nT:e1,Et=Uo(ce,"ALLOWED_TAGS")?Dn({},ce.ALLOWED_TAGS,Nr):Dt,Se=Uo(ce,"ALLOWED_ATTR")?Dn({},ce.ALLOWED_ATTR,Nr):at,kt=Uo(ce,"ALLOWED_NAMESPACES")?Dn({},ce.ALLOWED_NAMESPACES,nT):Vt,Te=Uo(ce,"ADD_URI_SAFE_ATTR")?Dn(jh(Ne),ce.ADD_URI_SAFE_ATTR,Nr):Ne,gt=Uo(ce,"ADD_DATA_URI_TAGS")?Dn(jh(le),ce.ADD_DATA_URI_TAGS,Nr):le,Nn=Uo(ce,"FORBID_CONTENTS")?Dn({},ce.FORBID_CONTENTS,Nr):ti,Xe=Uo(ce,"FORBID_TAGS")?Dn({},ce.FORBID_TAGS,Nr):{},yt=Uo(ce,"FORBID_ATTR")?Dn({},ce.FORBID_ATTR,Nr):{},Mn=Uo(ce,"USE_PROFILES")?ce.USE_PROFILES:!1,Jt=ce.ALLOW_ARIA_ATTR!==!1,sr=ce.ALLOW_DATA_ATTR!==!1,Xt=ce.ALLOW_UNKNOWN_PROTOCOLS||!1,zt=ce.ALLOW_SELF_CLOSE_IN_ATTR!==!1,Or=ce.SAFE_FOR_TEMPLATES||!1,Be=ce.WHOLE_DOCUMENT||!1,Er=ce.RETURN_DOM||!1,Ir=ce.RETURN_DOM_FRAGMENT||!1,nr=ce.RETURN_TRUSTED_TYPE||!1,Tr=ce.FORCE_BODY||!1,En=ce.SANITIZE_DOM!==!1,Xn=ce.SANITIZE_NAMED_PROPS||!1,ei=ce.KEEP_CONTENT!==!1,bi=ce.IN_PLACE||!1,Ve=ce.ALLOWED_URI_REGEXP||u5,$t=ce.NAMESPACE||_t,He=ce.CUSTOM_ELEMENT_HANDLING||{},ce.CUSTOM_ELEMENT_HANDLING&&Xr(ce.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(He.tagNameCheck=ce.CUSTOM_ELEMENT_HANDLING.tagNameCheck),ce.CUSTOM_ELEMENT_HANDLING&&Xr(ce.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(He.attributeNameCheck=ce.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),ce.CUSTOM_ELEMENT_HANDLING&&typeof ce.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(He.allowCustomizedBuiltInElements=ce.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Or&&(sr=!1),Ir&&(Er=!0),Mn&&(Et=Dn({},C4),Se=[],Mn.html===!0&&(Dn(Et,A4),Dn(Se,k4)),Mn.svg===!0&&(Dn(Et,iT),Dn(Se,oT),Dn(Se,Dy)),Mn.svgFilters===!0&&(Dn(Et,aT),Dn(Se,oT),Dn(Se,Dy)),Mn.mathMl===!0&&(Dn(Et,sT),Dn(Se,M4),Dn(Se,Dy))),ce.ADD_TAGS&&(Et===Dt&&(Et=jh(Et)),Dn(Et,ce.ADD_TAGS,Nr)),ce.ADD_ATTR&&(Se===at&&(Se=jh(Se)),Dn(Se,ce.ADD_ATTR,Nr)),ce.ADD_URI_SAFE_ATTR&&Dn(Te,ce.ADD_URI_SAFE_ATTR,Nr),ce.FORBID_CONTENTS&&(Nn===ti&&(Nn=jh(Nn)),Dn(Nn,ce.FORBID_CONTENTS,Nr)),ei&&(Et["#text"]=!0),Be&&Dn(Et,["html","head","body"]),Et.table&&(Dn(Et,["tbody"]),delete Xe.tbody),ce.TRUSTED_TYPES_POLICY){if(typeof ce.TRUSTED_TYPES_POLICY.createHTML!="function")throw Om('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof ce.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw Om('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');Z=ce.TRUSTED_TYPES_POLICY,_e=Z.createHTML("")}else Z===void 0&&(Z=OJ(V,f)),Z!==null&&typeof _e=="string"&&(_e=Z.createHTML(""));ss&&ss(ce),tn=ce}},kn=Dn({},["mi","mo","mn","ms","mtext"]),fi=Dn({},["foreignobject","desc","title","annotation-xml"]),In=Dn({},["title","style","font","a","script"]),Li=Dn({},[...iT,...aT,...SJ]),Mi=Dn({},[...sT,...AJ]),Xi=function(ce){let Oe=Y(ce);(!Oe||!Oe.tagName)&&(Oe={namespaceURI:$t,tagName:"template"});let Me=e1(ce.tagName),Ke=e1(Oe.tagName);return kt[ce.namespaceURI]?ce.namespaceURI===ut?Oe.namespaceURI===_t?Me==="svg":Oe.namespaceURI===et?Me==="svg"&&(Ke==="annotation-xml"||kn[Ke]):!!Li[Me]:ce.namespaceURI===et?Oe.namespaceURI===_t?Me==="math":Oe.namespaceURI===ut?Me==="math"&&fi[Ke]:!!Mi[Me]:ce.namespaceURI===_t?Oe.namespaceURI===ut&&!fi[Ke]||Oe.namespaceURI===et&&!kn[Ke]?!1:!Mi[Me]&&(In[Me]||!Li[Me]):!!(Wt==="application/xhtml+xml"&&kt[ce.namespaceURI]):!1},Hn=function(ce){Fm(n.removed,{element:ce});try{ce.parentNode.removeChild(ce)}catch{ce.remove()}},Wn=function(ce,Oe){try{Fm(n.removed,{attribute:Oe.getAttributeNode(ce),from:Oe})}catch{Fm(n.removed,{attribute:null,from:Oe})}if(Oe.removeAttribute(ce),ce==="is"&&!Se[ce])if(Er||Ir)try{Hn(Oe)}catch{}else try{Oe.setAttribute(ce,"")}catch{}},pt=function(ce){let Oe=null,Me=null;if(Tr)ce="<remove></remove>"+ce;else{let Rt=S4(ce,/^[\r\n\t ]+/);Me=Rt&&Rt[0]}Wt==="application/xhtml+xml"&&$t===_t&&(ce='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+ce+"</body></html>");let Ke=Z?Z.createHTML(ce):ce;if($t===_t)try{Oe=new B().parseFromString(Ke,Wt)}catch{}if(!Oe||!Oe.documentElement){Oe=ke.createDocument($t,"template",null);try{Oe.documentElement.innerHTML=dt?_e:Ke}catch{}}let At=Oe.body||Oe.documentElement;return ce&&Me&&At.insertBefore(a.createTextNode(Me),At.childNodes[0]||null),$t===_t?De.call(Oe,Be?"html":"body")[0]:Be?Oe.documentElement:At},xt=function(ce){return Ae.call(ce.ownerDocument||ce,ce,k.SHOW_ELEMENT|k.SHOW_COMMENT|k.SHOW_TEXT|k.SHOW_PROCESSING_INSTRUCTION,null)},Ft=function(ce){return ce instanceof F&&(typeof ce.nodeName!="string"||typeof ce.textContent!="string"||typeof ce.removeChild!="function"||!(ce.attributes instanceof R)||typeof ce.removeAttribute!="function"||typeof ce.setAttribute!="function"||typeof ce.namespaceURI!="string"||typeof ce.insertBefore!="function"||typeof ce.hasChildNodes!="function")},re=function(ce){return typeof T=="function"&&ce instanceof T},fe=function(ce,Oe,Me){Je[ce]&&Py(Je[ce],Ke=>{Ke.call(n,Oe,Me,tn)})},se=function(ce){let Oe=null;if(fe("beforeSanitizeElements",ce,null),Ft(ce))return Hn(ce),!0;let Me=Nr(ce.nodeName);if(fe("uponSanitizeElement",ce,{tagName:Me,allowedTags:Et}),ce.hasChildNodes()&&!re(ce.firstElementChild)&&Ns(/<[/\w]/g,ce.innerHTML)&&Ns(/<[/\w]/g,ce.textContent))return Hn(ce),!0;if(!Et[Me]||Xe[Me]){if(!Xe[Me]&&ge(Me)&&(He.tagNameCheck instanceof RegExp&&Ns(He.tagNameCheck,Me)||He.tagNameCheck instanceof Function&&He.tagNameCheck(Me)))return!1;if(ei&&!Nn[Me]){let Ke=Y(ce)||ce.parentNode,At=X(ce)||ce.childNodes;if(At&&Ke){let Rt=At.length;for(let er=Rt-1;er>=0;--er)Ke.insertBefore(U(At[er],!0),J(ce))}}return Hn(ce),!0}return ce instanceof o&&!Xi(ce)||(Me==="noscript"||Me==="noembed"||Me==="noframes")&&Ns(/<\/no(script|embed|frames)/i,ce.innerHTML)?(Hn(ce),!0):(Or&&ce.nodeType===3&&(Oe=ce.textContent,Py([rt,Re,St],Ke=>{Oe=Lm(Oe,Ke," ")}),ce.textContent!==Oe&&(Fm(n.removed,{element:ce.cloneNode()}),ce.textContent=Oe)),fe("afterSanitizeElements",ce,null),!1)},he=function(ce,Oe,Me){if(En&&(Oe==="id"||Oe==="name")&&(Me in a||Me in ln))return!1;if(!(sr&&!yt[Oe]&&Ns(Lt,Oe))&&!(Jt&&Ns(We,Oe))){if(!Se[Oe]||yt[Oe]){if(!(ge(ce)&&(He.tagNameCheck instanceof RegExp&&Ns(He.tagNameCheck,ce)||He.tagNameCheck instanceof Function&&He.tagNameCheck(ce))&&(He.attributeNameCheck instanceof RegExp&&Ns(He.attributeNameCheck,Oe)||He.attributeNameCheck instanceof Function&&He.attributeNameCheck(Oe))||Oe==="is"&&He.allowCustomizedBuiltInElements&&(He.tagNameCheck instanceof RegExp&&Ns(He.tagNameCheck,Me)||He.tagNameCheck instanceof Function&&He.tagNameCheck(Me))))return!1}else if(!Te[Oe]&&!Ns(Ve,Lm(Me,Ot,""))&&!((Oe==="src"||Oe==="xlink:href"||Oe==="href")&&ce!=="script"&&wJ(Me,"data:")===0&&gt[ce])&&!(Xt&&!Ns(qt,Lm(Me,Ot,"")))&&Me)return!1}return!0},ge=function(ce){return ce!=="annotation-xml"&&S4(ce,st)},be=function(ce){fe("beforeSanitizeAttributes",ce,null);let{attributes:Oe}=ce;if(!Oe)return;let Me={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:Se},Ke=Oe.length;for(;Ke--;){let At=Oe[Ke],{name:Rt,namespaceURI:er,value:Ht}=At,Nt=Nr(Rt),yr=Rt==="value"?Ht:bJ(Ht);if(Me.attrName=Nt,Me.attrValue=yr,Me.keepAttr=!0,Me.forceKeepAttr=void 0,fe("uponSanitizeAttribute",ce,Me),yr=Me.attrValue,Me.forceKeepAttr||(Wn(Rt,ce),!Me.keepAttr))continue;if(!zt&&Ns(/\/>/i,yr)){Wn(Rt,ce);continue}Or&&Py([rt,Re,St],cn=>{yr=Lm(yr,cn," ")});let An=Nr(ce.nodeName);if(he(An,Nt,yr)){if(Xn&&(Nt==="id"||Nt==="name")&&(Wn(Rt,ce),yr=wn+yr),Z&&typeof V=="object"&&typeof V.getAttributeType=="function"&&!er)switch(V.getAttributeType(An,Nt)){case"TrustedHTML":{yr=Z.createHTML(yr);break}case"TrustedScriptURL":{yr=Z.createScriptURL(yr);break}}try{er?ce.setAttributeNS(er,Rt,yr):ce.setAttribute(Rt,yr),E4(n.removed)}catch{}}}fe("afterSanitizeAttributes",ce,null)},ze=function ce(Oe){let Me=null,Ke=xt(Oe);for(fe("beforeSanitizeShadowDOM",Oe,null);Me=Ke.nextNode();)fe("uponSanitizeShadowNode",Me,null),!se(Me)&&(Me.content instanceof _&&ce(Me.content),be(Me));fe("afterSanitizeShadowDOM",Oe,null)};return n.sanitize=function(ce){let Oe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},Me=null,Ke=null,At=null,Rt=null;if(dt=!ce,dt&&(ce="<!-->"),typeof ce!="string"&&!re(ce))if(typeof ce.toString=="function"){if(ce=ce.toString(),typeof ce!="string")throw Om("dirty is not a string, aborting")}else throw Om("toString is not a function");if(!n.isSupported)return ce;if(Fn||dn(Oe),n.removed=[],typeof ce=="string"&&(bi=!1),bi){if(ce.nodeName){let Nt=Nr(ce.nodeName);if(!Et[Nt]||Xe[Nt])throw Om("root node is forbidden and cannot be sanitized in-place")}}else if(ce instanceof T)Me=pt("<!---->"),Ke=Me.ownerDocument.importNode(ce,!0),Ke.nodeType===1&&Ke.nodeName==="BODY"||Ke.nodeName==="HTML"?Me=Ke:Me.appendChild(Ke);else{if(!Er&&!Or&&!Be&&ce.indexOf("<")===-1)return Z&&nr?Z.createHTML(ce):ce;if(Me=pt(ce),!Me)return Er?null:nr?_e:""}Me&&Tr&&Hn(Me.firstChild);let er=xt(bi?ce:Me);for(;At=er.nextNode();)se(At)||(At.content instanceof _&&ze(At.content),be(At));if(bi)return ce;if(Er){if(Ir)for(Rt=me.call(Me.ownerDocument);Me.firstChild;)Rt.appendChild(Me.firstChild);else Rt=Me;return(Se.shadowroot||Se.shadowrootmode)&&(Rt=we.call(u,Rt,!0)),Rt}let Ht=Be?Me.outerHTML:Me.innerHTML;return Be&&Et["!doctype"]&&Me.ownerDocument&&Me.ownerDocument.doctype&&Me.ownerDocument.doctype.name&&Ns(h5,Me.ownerDocument.doctype.name)&&(Ht="<!DOCTYPE "+Me.ownerDocument.doctype.name+`>
`+Ht),Or&&Py([rt,Re,St],Nt=>{Ht=Lm(Ht,Nt," ")}),Z&&nr?Z.createHTML(Ht):Ht},n.setConfig=function(){let ce=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};dn(ce),Fn=!0},n.clearConfig=function(){tn=null,Fn=!1},n.isValidAttribute=function(ce,Oe,Me){tn||dn({});let Ke=Nr(ce),At=Nr(Oe);return he(Ke,At,Me)},n.addHook=function(ce,Oe){typeof Oe=="function"&&(Je[ce]=Je[ce]||[],Fm(Je[ce],Oe))},n.removeHook=function(ce){if(Je[ce])return E4(Je[ce])},n.removeHooks=function(ce){Je[ce]&&(Je[ce]=[])},n.removeAllHooks=function(){Je={}},n}var NJ=f5(),zJ=e=>{switch(e){case"success":return VJ;case"info":return jJ;case"warning":return $J;case"error":return GJ;default:return null}},BJ=Array(12).fill(0),UJ=({visible:e})=>dr.createElement("div",{className:"sonner-loading-wrapper","data-visible":e},dr.createElement("div",{className:"sonner-spinner"},BJ.map((n,a)=>dr.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${a}`})))),VJ=dr.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},dr.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),$J=dr.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},dr.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),jJ=dr.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},dr.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),GJ=dr.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},dr.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),HJ=()=>{let[e,n]=dr.useState(!1);return dr.useEffect(()=>{let a=()=>{n(document.hidden)};return document.addEventListener("visibilitychange",a),()=>window.removeEventListener("visibilitychange",a)},[]),e},PE=1,WJ=class{constructor(){this.subscribe=e=>(this.subscribers.push(e),()=>{let n=this.subscribers.indexOf(e);this.subscribers.splice(n,1)}),this.publish=e=>{this.subscribers.forEach(n=>n(e))},this.addToast=e=>{this.publish(e),this.toasts=[...this.toasts,e]},this.create=e=>{var n;let{message:a,...u}=e,f=typeof(e==null?void 0:e.id)=="number"||((n=e.id)==null?void 0:n.length)>0?e.id:PE++,_=this.toasts.find(T=>T.id===f),w=e.dismissible===void 0?!0:e.dismissible;return _?this.toasts=this.toasts.map(T=>T.id===f?(this.publish({...T,...e,id:f,title:a}),{...T,...e,id:f,dismissible:w,title:a}):T):this.addToast({title:a,...u,dismissible:w,id:f}),f},this.dismiss=e=>(e||this.toasts.forEach(n=>{this.subscribers.forEach(a=>a({id:n.id,dismiss:!0}))}),this.subscribers.forEach(n=>n({id:e,dismiss:!0})),e),this.message=(e,n)=>this.create({...n,message:e}),this.error=(e,n)=>this.create({...n,message:e,type:"error"}),this.success=(e,n)=>this.create({...n,type:"success",message:e}),this.info=(e,n)=>this.create({...n,type:"info",message:e}),this.warning=(e,n)=>this.create({...n,type:"warning",message:e}),this.loading=(e,n)=>this.create({...n,type:"loading",message:e}),this.promise=(e,n)=>{if(!n)return;let a;n.loading!==void 0&&(a=this.create({...n,promise:e,type:"loading",message:n.loading,description:typeof n.description!="function"?n.description:void 0}));let u=e instanceof Promise?e:e(),f=a!==void 0;return u.then(_=>{if(_&&typeof _.ok=="boolean"&&!_.ok){f=!1;let w=typeof n.error=="function"?n.error(`HTTP error! status: ${_.status}`):n.error,T=typeof n.description=="function"?n.description(`HTTP error! status: ${_.status}`):n.description;this.create({id:a,type:"error",message:w,description:T})}else if(n.success!==void 0){f=!1;let w=typeof n.success=="function"?n.success(_):n.success,T=typeof n.description=="function"?n.description(_):n.description;this.create({id:a,type:"success",message:w,description:T})}}).catch(_=>{if(n.error!==void 0){f=!1;let w=typeof n.error=="function"?n.error(_):n.error,T=typeof n.description=="function"?n.description(_):n.description;this.create({id:a,type:"error",message:w,description:T})}}).finally(()=>{var _;f&&(this.dismiss(a),a=void 0),(_=n.finally)==null||_.call(n)}),a},this.custom=(e,n)=>{let a=(n==null?void 0:n.id)||PE++;return this.create({jsx:e(a),id:a,...n}),a},this.subscribers=[],this.toasts=[]}},Vo=new WJ,qJ=(e,n)=>{let a=(n==null?void 0:n.id)||PE++;return Vo.addToast({title:e,...n,id:a}),a},ZJ=qJ,XJ=Object.assign(ZJ,{success:Vo.success,info:Vo.info,warning:Vo.warning,error:Vo.error,custom:Vo.custom,message:Vo.message,promise:Vo.promise,dismiss:Vo.dismiss,loading:Vo.loading});function YJ(e,{insertAt:n}={}){if(!e||typeof document>"u")return;let a=document.head||document.getElementsByTagName("head")[0],u=document.createElement("style");u.type="text/css",n==="top"&&a.firstChild?a.insertBefore(u,a.firstChild):a.appendChild(u),u.styleSheet?u.styleSheet.cssText=e:u.appendChild(document.createTextNode(e))}YJ(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999}:where([data-sonner-toaster][data-x-position="right"]){right:max(var(--offset),env(safe-area-inset-right))}:where([data-sonner-toaster][data-x-position="left"]){left:max(var(--offset),env(safe-area-inset-left))}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:max(var(--offset),env(safe-area-inset-top))}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:max(var(--offset),env(safe-area-inset-bottom))}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;background:var(--gray1);color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:0;right:0;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount, 0px));transition:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation:swipe-out .2s ease-out forwards}@keyframes swipe-out{0%{transform:translateY(calc(var(--lift) * var(--offset) + var(--swipe-amount)));opacity:1}to{transform:translateY(calc(var(--lift) * var(--offset) + var(--swipe-amount) + var(--lift) * -100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;--mobile-offset: 16px;right:var(--mobile-offset);left:var(--mobile-offset);width:100%}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset)}[data-sonner-toaster][data-y-position=bottom]{bottom:20px}[data-sonner-toaster][data-y-position=top]{top:20px}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset);right:var(--mobile-offset);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-rich-colors=true] [data-sonner-toast][data-type=success],[data-rich-colors=true] [data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true] [data-sonner-toast][data-type=info],[data-rich-colors=true] [data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true] [data-sonner-toast][data-type=warning],[data-rich-colors=true] [data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true] [data-sonner-toast][data-type=error],[data-rich-colors=true] [data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function Fy(e){return e.label!==void 0&&typeof e.onClick=="function"}var KJ=3,JJ="32px",QJ=4e3,eQ=356,tQ=14,rQ=20,nQ=200;function iQ(...e){return e.filter(Boolean).join(" ")}var aQ=e=>{var n,a,u,f,_,w,T;let{invert:o,toast:k,unstyled:R,interacting:F,setHeights:B,visibleToasts:V,heights:G,index:U,toasts:J,expanded:X,removeToast:Y,closeButton:Z,style:_e,cancelButtonStyle:ke,actionButtonStyle:Ae,className:me="",descriptionClassName:De="",duration:we,position:Je,gap:rt,loadingIcon:Re,expandByDefault:St,classNames:Lt,icons:We,closeButtonAriaLabel:qt="Close toast",pauseWhenPageIsHidden:Ot,cn:st}=e,[Ve,Et]=dr.useState(!1),[Dt,Se]=dr.useState(!1),[at,He]=dr.useState(!1),[Xe,yt]=dr.useState(!1),[Jt,sr]=dr.useState(0),[Xt,zt]=dr.useState(0),Or=dr.useRef(null),Be=dr.useRef(null),Fn=U===0,Tr=U+1<=V,Er=k.type,Ir=k.dismissible!==!1,nr=k.className||"",En=k.descriptionClassName||"",Xn=dr.useMemo(()=>G.findIndex(kt=>kt.toastId===k.id)||0,[G,k.id]),wn=dr.useMemo(()=>{var kt;return(kt=k.closeButton)!=null?kt:Z},[k.closeButton,Z]),ei=dr.useMemo(()=>k.duration||we||QJ,[k.duration,we]),bi=dr.useRef(0),Mn=dr.useRef(0),Nn=dr.useRef(0),ti=dr.useRef(null),[gt,le]=Je.split("-"),Te=dr.useMemo(()=>G.reduce((kt,Vt,Wt)=>Wt>=Xn?kt:kt+Vt.height,0),[G,Xn]),Ne=HJ(),et=k.invert||o,ut=Er==="loading";Mn.current=dr.useMemo(()=>Xn*rt+Te,[Xn,Te]),dr.useEffect(()=>{Et(!0)},[]),dr.useLayoutEffect(()=>{if(!Ve)return;let kt=Be.current,Vt=kt.style.height;kt.style.height="auto";let Wt=kt.getBoundingClientRect().height;kt.style.height=Vt,zt(Wt),B(br=>br.find(Hr=>Hr.toastId===k.id)?br.map(Hr=>Hr.toastId===k.id?{...Hr,height:Wt}:Hr):[{toastId:k.id,height:Wt,position:k.position},...br])},[Ve,k.title,k.description,B,k.id]);let _t=dr.useCallback(()=>{Se(!0),sr(Mn.current),B(kt=>kt.filter(Vt=>Vt.toastId!==k.id)),setTimeout(()=>{Y(k)},nQ)},[k,Y,B,Mn]);dr.useEffect(()=>{if(k.promise&&Er==="loading"||k.duration===1/0||k.type==="loading")return;let kt,Vt=ei;return X||F||Ot&&Ne?(()=>{if(Nn.current<bi.current){let Wt=new Date().getTime()-bi.current;Vt=Vt-Wt}Nn.current=new Date().getTime()})():Vt!==1/0&&(bi.current=new Date().getTime(),kt=setTimeout(()=>{var Wt;(Wt=k.onAutoClose)==null||Wt.call(k,k),_t()},Vt)),()=>clearTimeout(kt)},[X,F,St,k,ei,_t,k.promise,Er,Ot,Ne]),dr.useEffect(()=>{let kt=Be.current;if(kt){let Vt=kt.getBoundingClientRect().height;return zt(Vt),B(Wt=>[{toastId:k.id,height:Vt,position:k.position},...Wt]),()=>B(Wt=>Wt.filter(br=>br.toastId!==k.id))}},[B,k.id]),dr.useEffect(()=>{k.delete&&_t()},[_t,k.delete]);function $t(){return We!=null&&We.loading?dr.createElement("div",{className:"sonner-loader","data-visible":Er==="loading"},We.loading):Re?dr.createElement("div",{className:"sonner-loader","data-visible":Er==="loading"},Re):dr.createElement(UJ,{visible:Er==="loading"})}function dt(kt){return{__html:NJ.sanitize(kt)}}return dr.createElement("li",{"aria-live":k.important?"assertive":"polite","aria-atomic":"true",role:"status",tabIndex:0,ref:Be,className:st(me,nr,Lt==null?void 0:Lt.toast,(n=k==null?void 0:k.classNames)==null?void 0:n.toast,Lt==null?void 0:Lt.default,Lt==null?void 0:Lt[Er],(a=k==null?void 0:k.classNames)==null?void 0:a[Er]),"data-sonner-toast":"","data-styled":!(k.jsx||k.unstyled||R),"data-mounted":Ve,"data-promise":!!k.promise,"data-removed":Dt,"data-visible":Tr,"data-y-position":gt,"data-x-position":le,"data-index":U,"data-front":Fn,"data-swiping":at,"data-dismissible":Ir,"data-type":Er,"data-invert":et,"data-swipe-out":Xe,"data-expanded":!!(X||St&&Ve),style:{"--index":U,"--toasts-before":U,"--z-index":J.length-U,"--offset":`${Dt?Jt:Mn.current}px`,"--initial-height":St?"auto":`${Xt}px`,..._e,...k.style},onPointerDown:kt=>{ut||!Ir||(Or.current=new Date,sr(Mn.current),kt.target.setPointerCapture(kt.pointerId),kt.target.tagName!=="BUTTON"&&(He(!0),ti.current={x:kt.clientX,y:kt.clientY}))},onPointerUp:()=>{var kt,Vt,Wt,br;if(Xe||!Ir)return;ti.current=null;let Hr=Number(((kt=Be.current)==null?void 0:kt.style.getPropertyValue("--swipe-amount").replace("px",""))||0),Nr=new Date().getTime()-((Vt=Or.current)==null?void 0:Vt.getTime()),tn=Math.abs(Hr)/Nr;if(Math.abs(Hr)>=rQ||tn>.11){sr(Mn.current),(Wt=k.onDismiss)==null||Wt.call(k,k),_t(),yt(!0);return}(br=Be.current)==null||br.style.setProperty("--swipe-amount","0px"),He(!1)},onPointerMove:kt=>{var Vt;if(!ti.current||!Ir)return;let Wt=kt.clientY-ti.current.y,br=kt.clientX-ti.current.x,Hr=(gt==="top"?Math.min:Math.max)(0,Wt),Nr=kt.pointerType==="touch"?10:2;Math.abs(Hr)>Nr?(Vt=Be.current)==null||Vt.style.setProperty("--swipe-amount",`${Wt}px`):Math.abs(br)>Nr&&(ti.current=null)}},wn&&!k.jsx?dr.createElement("button",{"aria-label":qt,"data-disabled":ut,"data-close-button":!0,onClick:ut||!Ir?()=>{}:()=>{var kt;_t(),(kt=k.onDismiss)==null||kt.call(k,k)},className:st(Lt==null?void 0:Lt.closeButton,(u=k==null?void 0:k.classNames)==null?void 0:u.closeButton)},dr.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},dr.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),dr.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"}))):null,k.jsx||dr.isValidElement(k.title)?k.jsx||k.title:dr.createElement(dr.Fragment,null,Er||k.icon||k.promise?dr.createElement("div",{"data-icon":"",className:st(Lt==null?void 0:Lt.icon)},k.promise||k.type==="loading"&&!k.icon?k.icon||$t():null,k.type!=="loading"?k.icon||(We==null?void 0:We[Er])||zJ(Er):null):null,dr.createElement("div",{"data-content":"",className:st(Lt==null?void 0:Lt.content)},dr.createElement("div",{"data-title":"",className:st(Lt==null?void 0:Lt.title,(f=k==null?void 0:k.classNames)==null?void 0:f.title),dangerouslySetInnerHTML:dt(k.title)}),k.description?dr.createElement("div",{"data-description":"",className:st(De,En,Lt==null?void 0:Lt.description,(_=k==null?void 0:k.classNames)==null?void 0:_.description),dangerouslySetInnerHTML:dt(k.description)}):null),dr.isValidElement(k.cancel)?k.cancel:k.cancel&&Fy(k.cancel)?dr.createElement("button",{"data-button":!0,"data-cancel":!0,style:k.cancelButtonStyle||ke,onClick:kt=>{Fy(k.cancel)&&Ir&&(_t(),k.cancel.onClick(kt))},className:st(Lt==null?void 0:Lt.cancelButton,(w=k==null?void 0:k.classNames)==null?void 0:w.cancelButton)},k.cancel.label):null,dr.isValidElement(k.action)?k.action:k.action&&Fy(k.action)?dr.createElement("button",{"data-button":"",style:k.actionButtonStyle||Ae,onClick:kt=>{Fy(k.action)&&(k.action.onClick(kt),!kt.defaultPrevented&&_t())},className:st(Lt==null?void 0:Lt.actionButton,(T=k==null?void 0:k.classNames)==null?void 0:T.actionButton)},k.action.label):null))};function P4(){if(typeof window>"u"||typeof document>"u")return"ltr";let e=document.documentElement.getAttribute("dir");return e==="auto"||!e?window.getComputedStyle(document.documentElement).direction:e}var sQ=e=>{let{invert:n,position:a="bottom-right",hotkey:u=["altKey","KeyT"],expand:f,closeButton:_,className:w,offset:T,theme:o="light",richColors:k,duration:R,style:F,visibleToasts:B=KJ,toastOptions:V,dir:G=P4(),gap:U=tQ,loadingIcon:J,icons:X,containerAriaLabel:Y="Notifications",pauseWhenPageIsHidden:Z,cn:_e=iQ}=e,[ke,Ae]=dr.useState([]),me=dr.useMemo(()=>Array.from(new Set([a].concat(ke.filter(Dt=>Dt.position).map(Dt=>Dt.position)))),[ke,a]),[De,we]=dr.useState([]),[Je,rt]=dr.useState(!1),[Re,St]=dr.useState(!1),[Lt,We]=dr.useState(o!=="system"?o:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),qt=dr.useRef(null),Ot=u.join("+").replace(/Key/g,"").replace(/Digit/g,""),st=dr.useRef(null),Ve=dr.useRef(!1),Et=dr.useCallback(Dt=>Ae(Se=>Se.filter(({id:at})=>at!==Dt.id)),[]);return dr.useEffect(()=>Vo.subscribe(Dt=>{if(Dt.dismiss){Ae(Se=>Se.map(at=>at.id===Dt.id?{...at,delete:!0}:at));return}setTimeout(()=>{WD.flushSync(()=>{Ae(Se=>{let at=Se.findIndex(He=>He.id===Dt.id);return at!==-1?[...Se.slice(0,at),{...Se[at],...Dt},...Se.slice(at+1)]:[Dt,...Se]})})})}),[]),dr.useEffect(()=>{if(o!=="system"){We(o);return}o==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?We("dark"):We("light")),typeof window<"u"&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",({matches:Dt})=>{We(Dt?"dark":"light")})},[o]),dr.useEffect(()=>{ke.length<=1&&rt(!1)},[ke]),dr.useEffect(()=>{let Dt=Se=>{var at,He;u.every(Xe=>Se[Xe]||Se.code===Xe)&&(rt(!0),(at=qt.current)==null||at.focus()),Se.code==="Escape"&&(document.activeElement===qt.current||(He=qt.current)!=null&&He.contains(document.activeElement))&&rt(!1)};return document.addEventListener("keydown",Dt),()=>document.removeEventListener("keydown",Dt)},[u]),dr.useEffect(()=>{if(qt.current)return()=>{st.current&&(st.current.focus({preventScroll:!0}),st.current=null,Ve.current=!1)}},[qt.current]),ke.length?dr.createElement("section",{"aria-label":`${Y} ${Ot}`,tabIndex:-1},me.map((Dt,Se)=>{var at;let[He,Xe]=Dt.split("-");return dr.createElement("ol",{key:Dt,dir:G==="auto"?P4():G,tabIndex:-1,ref:qt,className:w,"data-sonner-toaster":!0,"data-theme":Lt,"data-rich-colors":k,"data-y-position":He,"data-x-position":Xe,style:{"--front-toast-height":`${((at=De[0])==null?void 0:at.height)||0}px`,"--offset":typeof T=="number"?`${T}px`:T||JJ,"--width":`${eQ}px`,"--gap":`${U}px`,...F},onBlur:yt=>{Ve.current&&!yt.currentTarget.contains(yt.relatedTarget)&&(Ve.current=!1,st.current&&(st.current.focus({preventScroll:!0}),st.current=null))},onFocus:yt=>{yt.target instanceof HTMLElement&&yt.target.dataset.dismissible==="false"||Ve.current||(Ve.current=!0,st.current=yt.relatedTarget)},onMouseEnter:()=>rt(!0),onMouseMove:()=>rt(!0),onMouseLeave:()=>{Re||rt(!1)},onPointerDown:yt=>{yt.target instanceof HTMLElement&&yt.target.dataset.dismissible==="false"||St(!0)},onPointerUp:()=>St(!1)},ke.filter(yt=>!yt.position&&Se===0||yt.position===Dt).map((yt,Jt)=>{var sr,Xt;return dr.createElement(aQ,{key:yt.id,icons:X,index:Jt,toast:yt,duration:(sr=V==null?void 0:V.duration)!=null?sr:R,className:V==null?void 0:V.className,descriptionClassName:V==null?void 0:V.descriptionClassName,invert:n,visibleToasts:B,closeButton:(Xt=V==null?void 0:V.closeButton)!=null?Xt:_,interacting:Re,position:Dt,style:V==null?void 0:V.style,unstyled:V==null?void 0:V.unstyled,classNames:V==null?void 0:V.classNames,cancelButtonStyle:V==null?void 0:V.cancelButtonStyle,actionButtonStyle:V==null?void 0:V.actionButtonStyle,removeToast:Et,toasts:ke.filter(zt=>zt.position==yt.position),heights:De.filter(zt=>zt.position==yt.position),setHeights:we,expandByDefault:f,gap:U,loadingIcon:J,expanded:Je,pauseWhenPageIsHidden:Z,cn:_e})}))})):null};/*! Bundled license information:

dompurify/dist/purify.es.mjs:
  (*! @license DOMPurify 3.0.10 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.0.10/LICENSE *)
*/const oQ=({data:e,setData:n,xlsData:a,legend:u,setLegend:f})=>{const[_,w]=Ie.useState([]),[T,o]=Ie.useState({}),k=U=>{switch(U){case"PoliceStation":return"Police Station";case"AreaCommittee":return"Area Committee";case"IntUniqueNo":return"Int Unique No";case"IntContent":return"Int Content";default:return U}};Ie.useEffect(()=>{a.length>0&&w(Object.keys(a[0]))},[a]);const R=U=>{U.preventDefault();const{startDate:J,endDate:X,...Y}=T,_e=a.filter(ke=>{if(ke.Date&&typeof ke.Date=="string"){const Ae=new Date(String(ke.Date).split("/").reverse().join("-"));if(J&&X)return Ae>=new Date(J)&&Ae<=new Date(X);if(J)return Ae>=new Date(J);if(X)return Ae<=new Date(X)}return!0}).filter(ke=>Object.entries(Y).every(([Ae,me])=>{var Je;if(me===void 0||me==="")return!0;const De=(Je=ke[Ae])==null?void 0:Je.toString().toLowerCase(),we=typeof me<"u"&&me!==null?me.toString().toLowerCase():"";return De===we}));n(_e)};Ie.useEffect(()=>{e.length===0&&XJ.info("No data found!")},[e]);const F=(U,J)=>{o(X=>{const Y=X;if(J)switch(U){case"Name":case"Name_":case"AreaCommittee":case"District":case"Division":case"GR":case"Rank":case"Source":case"IntContent":case"PoliceStation":case"Type":return{...Y,[U]:""};case"Date":return{...Y,[U]:null};case"startDate":case"endDate":return{...X,[U]:null};case"Month":case"Strength":case"IntUniqueNo":case"Week":return{...Y,[U]:0};default:throw console.log("Unhandled Property Error"),new Error("Unhandled property name")}else{const{[U]:Z,..._e}=Y;return _e}})},B=U=>!!Object.keys(T).includes(U),V=(U,J)=>{o(X=>({...X,[J]:U}))},G=U=>{const J=Array.from(new Set(a.map(Y=>Y[U])));return["Month","Strength","IntUniqueNo","Week"].includes(U)?J.map(Y=>Y!==null?Y.toString():""):J.map(Y=>Y!==null?Y.toString().toLowerCase():"")};return Lr.jsxs("form",{onSubmit:R,className:"h-[200px] w-full shadow-xl p-4 shadow-slate-300 flex gap-x-2",children:[Lr.jsxs("div",{className:"w-fit flex flex-col gap-y-2",children:[Lr.jsx("h2",{className:"text-lg",children:"Filters"}),Lr.jsxs(w4,{children:[Lr.jsx(b4,{className:"w-fit",asChild:!0,children:Lr.jsx(Yy,{variant:"dropDown",children:"Choose Filters"})}),Lr.jsxs(CE,{className:"flex flex-col gap-y-1 overflow-auto",children:[_.length!==0?_.map(U=>Lr.jsx(Hm,{checked:B(U),onCheckedChange:J=>F(U,J),className:ws(B(U)&&"bg-blue-600 text-white focus:bg-blue-600 focus:text-white focus:bg-opacity-90"),children:k(U)},U)):Lr.jsx(Hm,{children:"No filters yet"}),Lr.jsx(Hm,{checked:B("startDate"),onCheckedChange:U=>F("startDate",U),className:ws(B("startDate")&&"bg-blue-600 text-white focus:bg-blue-600 focus:text-white focus:bg-opacity-90"),children:"Start Date"},"startDate"),Lr.jsx(Hm,{checked:B("endDate"),onCheckedChange:U=>F("endDate",U),className:ws(B("endDate")&&"bg-blue-600 text-white focus:bg-blue-600 focus:text-white focus:bg-opacity-90"),children:"End Date"},"endDate")]})]}),Lr.jsx(Yy,{type:"submit",variant:"primary",className:"w-full",children:"Apply Filters"}),Lr.jsxs(w4,{children:[Lr.jsx(b4,{className:"w-fit",asChild:!0,children:Lr.jsx(Yy,{variant:"dropDown",className:"bg-orange-500 text-white",children:"Choose legend"})}),Lr.jsx(CE,{className:"flex flex-col gap-y-1",children:_.length!==0?_.map(U=>Lr.jsx(kE,{onClick:()=>f(U),className:ws(u===U&&"bg-blue-600 text-white focus:bg-blue-600 focus:text-white focus:bg-opacity-90"),children:k(U)},U)):Lr.jsx(kE,{children:"No filters yet"})})]})]}),Lr.jsx("div",{className:"w-full flex flex-col flex-wrap p-2 gap-2",children:T?Object.keys(T).map(U=>{var J,X;return Lr.jsx("div",{className:"flex flex-col gap-y-2",children:U==="startDate"||U==="endDate"?Lr.jsx("input",{type:"date",id:U,value:((J=T[U])==null?void 0:J.toString())||"",onChange:Y=>V(Y.target.value,U),className:"border border-gray-300 rounded-md px-3 py-2"}):Lr.jsx(EZ,{id:U,label:k(U),value:((X=T[U])==null?void 0:X.toString())||"",onChange:Y=>V(Y,U),suggestions:G(U)})},U)}):Lr.jsx("p",{children:"No Filters Selected"})})]})};var R4=["light","dark"],lQ="(prefers-color-scheme: dark)",cQ=Ie.createContext(void 0),uQ={setTheme:e=>{},themes:[]},hQ=()=>{var e;return(e=Ie.useContext(cQ))!=null?e:uQ};Ie.memo(({forcedTheme:e,storageKey:n,attribute:a,enableSystem:u,enableColorScheme:f,defaultTheme:_,value:w,attrs:T,nonce:o})=>{let k=_==="system",R=a==="class"?`var d=document.documentElement,c=d.classList;${`c.remove(${T.map(G=>`'${G}'`).join(",")})`};`:`var d=document.documentElement,n='${a}',s='setAttribute';`,F=f?R4.includes(_)&&_?`if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'${_}'`:"if(e==='light'||e==='dark')d.style.colorScheme=e":"",B=(G,U=!1,J=!0)=>{let X=w?w[G]:G,Y=U?G+"|| ''":`'${X}'`,Z="";return f&&J&&!U&&R4.includes(G)&&(Z+=`d.style.colorScheme = '${G}';`),a==="class"?U||X?Z+=`c.add(${Y})`:Z+="null":X&&(Z+=`d[s](n,${Y})`),Z},V=e?`!function(){${R}${B(e)}}()`:u?`!function(){try{${R}var e=localStorage.getItem('${n}');if('system'===e||(!e&&${k})){var t='${lQ}',m=window.matchMedia(t);if(m.media!==t||m.matches){${B("dark")}}else{${B("light")}}}else if(e){${w?`var x=${JSON.stringify(w)};`:""}${B(w?"x[e]":"e",!0)}}${k?"":"else{"+B(_,!1,!1)+"}"}${F}}catch(e){}}()`:`!function(){try{${R}var e=localStorage.getItem('${n}');if(e){${w?`var x=${JSON.stringify(w)};`:""}${B(w?"x[e]":"e",!0)}}else{${B(_,!1,!1)};}${F}}catch(t){}}();`;return Ie.createElement("script",{nonce:o,dangerouslySetInnerHTML:{__html:V}})});const fQ=({...e})=>{const{theme:n="system"}=hQ();return Lr.jsx(sQ,{theme:n,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...e})},dQ=()=>{const e=Ie.useRef(null),[n,a]=Ie.useState([]),[u,f]=Ie.useState([]),[_,w]=Ie.useState([]),[T,o]=Ie.useState("Name");return Lr.jsxs("main",{className:"flex flex-col h-screen",children:[Lr.jsx(pZ,{map:e,legend:T,data:n,setData:a,setXlsData:w,setkmlData:f}),Lr.jsx(gZ,{kmlData:u}),Lr.jsx(gU,{map:e}),Lr.jsx(oQ,{data:n,legend:T,setLegend:o,xlsData:_,setData:a}),Lr.jsx(fQ,{position:"top-center"})]})};lT.createRoot(document.getElementById("root")).render(Lr.jsx(dr.StrictMode,{children:Lr.jsx(dQ,{})}));
